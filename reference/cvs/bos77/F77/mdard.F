      FUNCTION MDARD(JW,LUN,NAME,NR)

*     READ BANK (NAME,NR) FROM RECORD IREC IN DATASET LUN
*     RETURNS INDEX OF BANK
*     IF BANK EXISTING IN ARRAY JW, ITS INDEX IS RETURNED
*     IND = 0 MEANS BANK NOT EXISTING ON DATA SET
*             OR DATA SET NOT OPENED (BDABF)
*
      COMMON/BCS/IW(1000)
#include "dacom.h"
#include "param.h"
      INTEGER JW(*)
      CHARACTER*4 NAME
*     ...
      JW1=JW(1)
      JW(1)=0
      JW(2)=0
      MDARD=MLINK(JW,NAME,NR)
      IF(MDARD.NE.0) GOTO 100
      IUB=NLINK('+BUF',LUN)
      IF(IUB.EQ.0) GOTO 100
      LUNDA=LUN
      NWRDA=IW(IUB+11)
      NADA=INTCHA(NAME)
      NRDA=NR
      NDDA=0
      INDA=0
      IDRR=0
      IDDR=0
      CALL DADIR(1)
      IF(NRD.EQ.0) GOTO 100
      NDDA=NDDR
      JW(1)=JW1
      INDA=MBANK(JW,NAME,NR,NDDA)
      CALL DADAT(1,JW,*10)
      MDARD=INDA
      JW(2)=NDTR
      GOTO 100

   10 IF(JW(LUP).GT.0) WRITE(JW(LUP),101) LUNDA,NAME,NRDA
      CALL DARES
      CALL DADAT(2,JW,*20)
   20 CALL DADIR(2)
      CALL DAFWR(0,1)
      CALL DAFWR(0,0)
      CALL DADES
      CALL BABEND('MDARD')

  100 RETURN
  101 FORMAT('0----------  INCONSISTENCY FOUND ON DIRECT ACCESS DATA',
     + 'SET',I3,/13X,'DIRECTORY ENTRY FOR BANK ',A4,I9,' SHOWS LENGTH ',
     + 'DIFFERENT FROM LENGTH OF BANK IN DATA RECORD'/
     + 13X,'THE INCONSISTENCY WILL BE REMOVED BY DELETING THE BANK,'
     + ,' AND THE PROGRAM WILL STOP WITH ABEND'/)
      END
