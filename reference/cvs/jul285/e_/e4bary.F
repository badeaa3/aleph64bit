      SUBROUTINE E4BARY
C----------------------------------------------------------------------
C!  - JOB FOR R2 ESTIMATOR CALCULATION
C!
C!    AUTHOR  : D. PALLIN
C!    MODIFIED:
C!
C!      GIVE 3X4 STOREYS CENTERED ON CLUSTER BARYCENTER
C!
C?
C!======================================================================
#ifndef DOC
#include "eiflag.h"
#include "rlunit.h"
#include "rflags.h"
#include "rparac.h"
      COMMON/EIJDEU/ICOL1,ICOL2,ICOL3,ICOL4,JROW1,JROW2,JROW3,JROW4
      CHARACTER*23 WRONG
#include "bcs.h"
#include "ecnamc.h"
#include "eclujj.h"
#include "e4com0.h"
      DIMENSION XYZBEA(3)
#include "bmacro.h"
      KECLU=IW(NAECLU)
      RRO=RTABL(KECLU,ICLU,JECLR4)
      TTH=RTABL(KECLU,ICLU,JECLT4)
      PPH=RTABL(KECLU,ICLU,JECLF4)
      ROS=RRO*SIN(TTH)
      XYZBEA(1)=ROS*COS(PPH)
      XYZBEA(2)=ROS*SIN(PPH)
      XYZBEA(3)=RRO*COS(TTH)
C
      CALL EFNCRS(XYZBEA,ROWJ,COLI,STK,WRONG)
C
C
C
      IBAR=1
      CALL E4DEIJ(IFLAG,IBAR,COLI,ROWJ)
      TETIFL=COLI
      PHIFL=ROWJ

C
CXXXXXXXXXXXXXXX
C
C   WE KEPT SELECTED STOREYS
       IF(JDBDRF(JULEC).EQ.9)WRITE(LDEBRL,*)'E4BARY ',COLI,ROWJ
CXX IFLAG GIVE THE COMBINATION TO CONSIDERED
CXX FLAG=0 (I1,J1)(I1,J2)(I2,J1)(I2,J2)               NORMAL
CXX      1 IDEM FALG 0 +(I3,J3)(I3,J4)(I4,J3)(I4,J4)  OVERLAP
CXX      2 (I3,J1)(I3,J2)(I4,J3)(I4,J4)               REGIONS LIMITS
CXX      3 (I3,J1)(I3,J2)(I3,J5)(I4,J3)    PATHOLOGICAL LIMIT R1-R2
C
      IF(IFLAG.EQ.0)THEN
      IF(JDBDRF(JULEC).GT.7)
     &WRITE(LDEBRL,10)ICOL1,JROW1,ICOL1,JROW2,ICOL2,JROW1,ICOL2,JROW2
      CALL E4GTTW(ICOL1,ICOL2,JROW1,JROW2)
      ENDIF
      IF(IFLAG.EQ.1)THEN
      IF(JDBDRF(JULEC).GT.7)
     &WRITE(LDEBRL,10)ICOL1,JROW1,ICOL1,JROW2,ICOL2,JROW1,ICOL2,JROW2
      IF(JDBDRF(JULEC).GT.7)
     &WRITE(LDEBRL,10)ICOL3,JROW3,ICOL3,JROW4,ICOL4,JROW3,ICOL4,JROW4
      CALL E4GTTW(ICOL1,ICOL2,JROW1,JROW2)
      CALL E4GTTW(ICOL3,ICOL4,JROW3,JROW4)
      ENDIF
      IF(IFLAG.EQ.2)THEN
      IF(JDBDRF(JULEC).GT.7)
     &WRITE(LDEBRL,10)ICOL3,JROW1,ICOL3,JROW2,ICOL4,JROW3,ICOL4,JROW4
      CALL E4GTTW(ICOL3,DUMMY,JROW1,JROW2)
      CALL E4GTTW(ICOL4,DUMMY,JROW3,JROW4)
      ENDIF
      IF(IFLAG.EQ.3)THEN
      IF(JDBDRF(JULEC).GT.7)
     &WRITE(LDEBRL,10)ICOL3,JROW1,ICOL3,JROW2,ICOL3,JROW4,ICOL4,JROW3
      CALL E4GTTW(ICOL3,DUMMY,JROW1,JROW2)
      CALL E4GTTW(ICOL3,DUMMY,JROW4,DUMMY)
      CALL E4GTTW(ICOL4,DUMMY,JROW3,DUMMY)
      ENDIF
 10   FORMAT(1X,4('(',I3,1X,I3,')'))
C
C
      RETURN
      END
#endif
