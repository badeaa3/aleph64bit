head	1.1;
access;
symbols
	jul313_3:1.1
	jul313_2:1.1
	jul313_1:1.1
	jul313:1.1
	jul312_1:1.1
	jul312:1.1
	jul311:1.1
	jul310_1:1.1
	jul310:1.1
	jul309_1:1.1
	jul309:1.1
	jul308_6:1.1
	jul308_5:1.1
	jul308_4:1.1
	jul308_3:1.1
	jul308_2:1.1
	jul308_1:1.1
	jul308:1.1
	jul307_4:1.1
	jul307_3:1.1
	jul307_2:1.1
	jul307_1:1.1
	jul307:1.1
	jul306_3:1.1
	jul306_2:1.1
	jul306_1:1.1
	jul306:1.1
	jul305_4:1.1
	jul305_3:1.1
	jul305_2:1.1
	jul305_1:1.1
	jul305:1.1
	jul304_3:1.1
	jul304_2:1.1
	jul304_1:1.1
	jul304:1.1
	jul303_7:1.1
	jul303_6:1.1
	jul303_5:1.1
	jul303_4:1.1
	jul303_3:1.1
	jul303_2_mc1:1.1
	jul303_2:1.1
	jul303_1_mc1:1.1
	jul303_1:1.1
	jul303_v:1.1
	jul303:1.1
	jul302_6:1.1
	jul302_5:1.1
	jul302_4:1.1
	jul302_3:1.1
	jul302_2:1.1
	jul302_1:1.1
	jul302:1.1
	jul285_1:1.1
	jul285:1.1
	jul284_1:1.1
	jul284:1.1
	jul283_1:1.1
	jul283:1.1
	jul282_1:1.1
	jul282:1.1
	jul281_3:1.1
	jul281_2:1.1
	jul281_1:1.1
	jul281:1.1
	jul280_1:1.1
	jul280:1.1;
locks; strict;
comment	@c @;


1.1
date	96.05.06.15.52.39;	author flr;	state Exp;
branches;
next	;


desc
@@


1.1
log
@re-installed jul280 from the historian source because some routines were missing.
@
text
@      SUBROUTINE VDALXY
C ----------------------------------------------------------------------
C!  Smears the VDXY in accordance with
C!         the errors in the alignment quantities.
C!
C -  Author         Manoj Thulasidas  5-Nov-1994
CKEY V_DECK VDET
C
C!   Description
C!  ===========
C!  Called by VDALIN to do half the job
C!
C
C  Output : smeard VDXY bank
C
C -----------------------------------------------------------------------
#ifndef DOC
#include "bcs.h"
#include "vdxyjj.h"
      INTEGER KVDXY, IXY
      REAL VUW(3), XYZ(3), SIGU, TNG
      INTEGER IV, NAMIND, IERR, JWAF, NREAL, VJWABR, NR, NH, IROW,
     $   VVUWXY, VXYZVU
      REAL VDGAUS, COSTH, SAV
C   bit 29 now means that smearing has been added to a cluster
      INTEGER IMCSMR
      PARAMETER (IMCSMR=268435456)
#include "bmacro.h"
      IV = 2
      NVDXY=NAMIND('VDXY')
      KVDXY=NVDXY+1
 30   KVDXY=IW(KVDXY-1)
      IF(KVDXY.EQ.0)GO TO 31
      NR=IW(KVDXY-2)
      NH=LROWS(KVDXY)
      DO 60 IXY=1,NH
        IF(IAND(ITABL(KVDXY,IXY,JVDXQF),IMCSMR).NE.0)
     $     GOTO 60
C-- get the global coordinate of the hit from the VDHT bank
C-- also get the tangent of the angle (slope of the track, projected
C-- to the view.
        CALL VDGTXL(IV,NR,IXY,XYZ,TNG,IERR)
        IF(IERR.NE.0)GO TO 60
C-- from the bank number and global XYZ, get wafer number JWAF
C-- also get the real VALC bank to use
        IERR = VJWABR(NR,XYZ(3),JWAF,NREAL)
C-- get the alignment error to be applied to the RPHI coordinate
        CALL VDALSG(NREAL,JWAF,IV,XYZ,TNG,SIGU)
C-- go to the local coordinates VUW
        IERR = VXYZVU(XYZ,JWAF,VUW)
C-- smear the U coordinate
        SAV = RTABL(KVDXY,IXY,JVDXUC)
        VUW(2) = SAV
        VUW(2) = VDGAUS(VUW(2),SIGU)
C-- go back to the global coordinates
        IERR = VVUWXY(VUW,JWAF,XYZ)
C-- put the smeared quantities back in VDXY and VDXY
        IROW = KROW(KVDXY,IXY)
C-- note that VUW(1) and VUW(3) are true positions from VDHT.
C-- does that make a difference?????
        IROW = KROW(KVDXY,IXY)
        RW(IROW+JVDXXC) = XYZ(1)
        RW(IROW+JVDXYC) = XYZ(2)
        RW(IROW+JVDXUC) = VUW(2)
        RW(IROW+JVDXSU) = SQRT(RW(IROW+JVDXSU)**2+SIGU**2)
C  Flag the hit
        IW(IROW+JVDXQF) = IOR(IW(IROW+JVDXQF),IMCSMR)
 60   CONTINUE
      GO TO 30
 31   CONTINUE
      RETURN
      END
#endif
@
