head	1.1;
access;
symbols
	jul313_3:1.1
	jul313_2:1.1
	jul313_1:1.1
	jul313:1.1
	jul312_1:1.1
	jul312:1.1
	jul311:1.1
	jul310_1:1.1
	jul310:1.1
	jul309_1:1.1
	jul309:1.1
	jul308_6:1.1
	jul308_5:1.1
	jul308_4:1.1
	jul308_3:1.1
	jul308_2:1.1
	jul308_1:1.1
	jul308:1.1
	jul307_4:1.1
	jul307_3:1.1
	jul307_2:1.1
	jul307_1:1.1
	jul307:1.1
	jul306_3:1.1
	jul306_2:1.1
	jul306_1:1.1
	jul306:1.1
	jul305_4:1.1
	jul305_3:1.1
	jul305_2:1.1
	jul305_1:1.1
	jul305:1.1
	jul304_3:1.1
	jul304_2:1.1
	jul304_1:1.1
	jul304:1.1
	jul303_7:1.1
	jul303_6:1.1
	jul303_5:1.1
	jul303_4:1.1
	jul303_3:1.1
	jul303_2_mc1:1.1
	jul303_2:1.1
	jul303_1_mc1:1.1
	jul303_1:1.1
	jul303_v:1.1
	jul303:1.1
	jul302_6:1.1
	jul302_5:1.1
	jul302_4:1.1
	jul302_3:1.1
	jul302_2:1.1
	jul302_1:1.1
	jul302:1.1;
locks; strict;
comment	@c @;


1.1
date	97.03.06.09.54.43;	author cattanem;	state Exp;
branches;
next	;


desc
@@


1.1
log
@Tracking upgrade
@
text
@      SUBROUTINE FDETCO(DET,RCO,ITK,ICOOR)
C -----------------------------------------------------------------------
C!  Find DET coordinate number for coordinate at radius RCO on track ITK
C - F.Ranjard from D.Casper - 970218
C
C - Input  :  DET   / A = detector 'TP','VD', 'IT' or 'TG'
C             RCO   / R = radius
C             ITK   / I = track #
C - Output :  ICOOR / I = coordinate #
C ------------------------------------------------------------------------
#ifndef DOC
      IMPLICIT NONE
#include "frtljj.h"
#include "tpcojj.h"
#include "ftcljj.h"
#include "vdcojj.h"
#include "fvcljj.h"
#include "iccojj.h"
#include "ficljj.h"
#include "tgcljj.h"
#include "tgtljj.h"
#include "bcs.h"
#include "bosext.h"
#include "bmacrod.h"
C
      CHARACTER*(*) DET
      REAL RCO
      INTEGER ITK, ICOOR
C
      INTEGER KTKCL,KTKPL,KCOOR,JCOORA,IND,IOTKCL,NCO,JTKPOF,N
      REAL    RCOOR
      INTEGER NFRTL,NFTCL,NFVCL,NTPCO,NVDCO,NFICL,NICCO,NTGCL,NTGTL
      DATA    NFRTL,NFTCL,NFVCL,NTPCO,NVDCO,NFICL,NICCO,NTGCL,NTGTL/9*0/

#include "bmacro.h"
C ------------------------------------------------------------------------
C
C - 1st entry
      IF(NFRTL.EQ.0)THEN
        NFRTL = NAMIND('FRTL')
        NFTCL = NAMIND('FTCL')
        NTPCO = NAMIND('TPCO')
        NFVCL = NAMIND('FVCL')
        NVDCO = NAMIND('VDCO')
        NFICL = NAMIND('FICL')
        NICCO = NAMIND('ICCO')
        NTGTL = NAMIND('TGTL')
        NTGCL = NAMIND('TGCL')
      ENDIF
C
C - select the detector
C     TKPL is the TrackPointList (FRTL or TGTL)
C     TKCL is the TrackCoordinateList (FVCL, FICL, FTCL or TGCL)
C     COOR is the coordinate bank (VDCO, ICCO, TPCO)
C     JTKPOF is the TKPL HAC parameter of the offset to TKCL
C     JCOORA is the COOR HAC parameter of the coordinate radius
C
      IF (DET(1:2).EQ.'TG') THEN
        KTKPL  = IW(NTGTL)
        KTKCL  = IW(NTGCL)
        JTKPOF = JTGTIO
        KCOOR  = IW(NTPCO)
        JCOORA = JTPCRV
      ELSEIF (DET(1:1).EQ.'T') THEN 
        KTKPL  = IW(NFRTL)
        KTKCL  = IW(NFTCL)
        JTKPOF = JFRTIT
        KCOOR  = IW(NTPCO)
        JCOORA = JTPCRV
      ELSEIF (DET(1:1).EQ.'V') THEN
        KTKPL  = IW(NFRTL)
        KTKCL  = IW(NFVCL)
        JTKPOF = JFRTIV
        KCOOR  = IW(NVDCO)
        JCOORA = JVDCR0
      ELSEIF (DET(1:1).EQ.'I') THEN
        KTKPL  = IW(NFRTL)
        KTKCL  = IW(NFICL)
        JTKPOF = JFRTII
        KCOOR  = IW(NICCO)
        JCOORA = JICCRV
      ENDIF
C
C - check banks
      IF (KTKPL.LE.0 .OR. KTKCL.LE.0 .OR. KCOOR.LE.0)THEN
        CALL RERROR('FDETCO',1,'Missing track bank(s)')
        GOTO 998
      ENDIF
C
C - loop on track coordinates
      IOTKCL = ITABL(KTKPL,ITK,JTKPOF)
      NCO = ITABL(KTKPL,ITK,JTKPOF+1)
      DO N =1,NCO
        ICOOR = ABS(ITABL(KTKCL,IOTKCL+N,1))
        RCOOR = RTABL(KCOOR,ICOOR,JCOORA)
        IF (ABS(RCO - RCOOR).LE.0.1) GOTO 999
      ENDDO

C - coordinate not found
 998  ICOOR = 0

C - end
 999  CONTINUE
      RETURN
      END
#endif

@
