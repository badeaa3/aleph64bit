head	1.7;
access;
symbols
	jul313_3:1.7
	jul313_2:1.7
	jul313_1:1.7
	jul313:1.7
	jul312_1:1.7
	jul312:1.7
	jul311:1.6
	jul310_1:1.6
	jul310:1.6
	jul309_1:1.6
	jul309:1.6
	jul308_6:1.6
	jul308_5:1.6
	jul308_4:1.6
	jul308_3:1.6
	jul308_2:1.6
	jul308_1:1.6
	jul308:1.6
	jul307_4:1.6
	jul307_3:1.6
	jul307_2:1.6
	jul307_1:1.6
	jul307:1.6
	jul306_3:1.6
	jul306_2:1.6
	jul306_1:1.6
	jul306:1.6
	jul305_4:1.6
	jul305_3:1.6
	jul305_2:1.6
	jul305_1:1.6
	jul305:1.6
	jul304_3:1.6
	jul304_2:1.6
	jul304_1:1.6
	jul304:1.6
	jul303_7:1.5
	jul303_6:1.5
	jul303_5:1.5
	jul303_4:1.5
	jul303_3:1.5
	jul303_2_mc1:1.5
	jul303_2:1.4
	jul303_1_mc1:1.4
	jul303_1:1.4
	jul303_v:1.4
	jul303:1.4
	jul302_6:1.4
	jul302_5:1.4
	jul302_4:1.4
	jul302_3:1.4
	jul302_2:1.4
	jul302_1:1.4
	jul302:1.4
	jul285_1:1.4
	jul285:1.4
	jul284_1:1.4
	jul284:1.4
	jul283_1:1.4
	jul283:1.4
	jul282_1:1.4
	jul282:1.4
	jul281_3:1.4
	jul281_2:1.4
	jul281_1:1.4
	jul281:1.4
	jul280_1:1.3
	jul280:1.3
	jul279:1.2
	v300:1.1.1.1
	flr:1.1.1;
locks; strict;
comment	@c @;


1.7
date	2000.03.20.12.52.48;	author cattanem;	state Exp;
branches;
next	1.6;

1.6
date	97.08.19.15.02.28;	author cattanem;	state Exp;
branches;
next	1.5;

1.5
date	97.06.16.11.45.08;	author cattanem;	state Exp;
branches;
next	1.4;

1.4
date	96.06.03.10.26.54;	author cattanem;	state Exp;
branches;
next	1.3;

1.3
date	96.03.12.15.25.36;	author flr;	state Exp;
branches;
next	1.2;

1.2
date	95.11.29.17.17.21;	author flr;	state Exp;
branches;
next	1.1;

1.1
date	94.12.07.14.18.56;	author aljul;	state Exp;
branches
	1.1.1.1;
next	;

1.1.1.1
date	94.12.07.14.18.57;	author aljul;	state Exp;
branches;
next	;


desc
@@


1.7
log
@Julia 312
@
text
@      SUBROUTINE LPRLUM
C--------------------------------------------------------------------
C! Calculate and print luminosity for this run
C!
C!  Author       :- P.H.Hansen 89/01/01
C!  Modified     :- J. Wear and P. H. Hansen   89/11/19
C!                - J. Wear 90/02/09
C!                - P.H.Hansen 92/02/19
C!  Modified     : P. Comas      940502
C!           Use of X1TT instead of XTOP dropped in the readout upgrade.
C!  Modified     : P.H.Hansen    960501
C!           Print only Method 10. Background estimate is #events with
C!           dphi<20deg - corrected for the possible anisotropy of the
C!           the single arm combinations recorded in LBAK. If not
C!           enough method 10 events in LBAK use method 4.
C!  Modified : P. H. Hansen  16-Jun-1997 Use BHZ0 bank for Z0 runs from 1996
C!  Modified : P. H. Hansen  11-Aug-1997 Compensate for dead module in early
C!                                       1997 running
C!  Modified : P. H. Hansen  15-March-2000 Fill new row (11th) in LUMI
C!                                         with Lumi including miniramp 
C!
C!  Input:       'LUMI' 'BHAB'  'LBAK' 'LONL'
C!
C!  Description:
C!  ============
C!  Do final background update for this run
C!  Print energy and vertex summary
C!  Print summary of lumi triggers for this run
C!  For each method
C!     Print selection criteria
C!     Print numbers of events surviving successive cuts
C!     Print corresponding numbers of fake events
C!     Calculate background contribution
C!     Calculate luminosity and its statistical error
C--------------------------------------------------------------------
#ifndef DOC
#include "bcs.h"
#include "rcurnt.h"
#include "rconds.h"
#include "rparac.h"
#include "rflags.h"
#include "lcnamc.h"
#include "bhabjj.h"
#include "lumijj.h"
#include "lonljj.h"
#include "lbakjj.h"
#include "lphist.h"
#include "lehijj.h"
#include "xtopjj.h"
#include "x1ttjj.h"
#include "rlunit.h"
#include "rstatr.h"
      EXTERNAL NDROP
      PARAMETER (LLEN=50)
      CHARACTER*(LLEN) XLUMI(2)
      CHARACTER*(LLEN) TLUMI(9)
      CHARACTER*(LLEN) TCALC(4)
      CHARACTER*(LLEN) TMETH(11)
      CHARACTER*(LLEN) TQUAL(2)
      CHARACTER*(LLEN) TCUTS(16)
      CHARACTER*(LLEN) TRIGS(8)
      DATA XLUMI /
     $ '  Events inside fiducial area with dphi=180.......',
     $ '  Events inside fiducial area with dphi=0.........'/
      DATA TLUMI /
     $ '  Events with E1,E2 > threshold...................',
     $ '  Events with E1+E2 > threshold...................',
     $ '  Events inside fiducial with dphi=180 (signal)...',
     $ '  Events inside fiducial with dphi=0   (backgr)...',
     $ '  Accepted events with LCAL and ECAL on...........',
     $ '  Accepted events with LCAL ECAL ITC on...........',
     $ '  Accepted exclusive Low-Low triggers.............',
     $ '  Accepted exclusive Very High Singles............',
     $ '  Accepted without Very High Single bit...........'/
      DATA TCALC /
     $ '  Corrected Background contribution...............',
     $ '  Luminosity (HV on) for this run (nb-1)..........',
     $ '  Statistical error...............................',
     $ '  Systematic error................................'/
      DATA TMETH /
     $ 'Method 1: Use tracks to get accepted fraction     ',
     $ 'Method 2: Require track on small side             ',
     $ 'Method 3: Require tracks on both sides            ',
     $ 'Method 4: Use only cluster centroids              ',
     $ 'Method 5: Use asymmetry across loose  boundaries  ',
     $ 'Method 6: Use asymmetry across strict boundaries  ',
     $ 'Method 7: Require central tower inside boundaries ',
     $ 'Method 8: Improved Method 5                       ',
     $ 'Method 9: Improved Method 6                       ',
     $ 'Method10: Improved Method 6 with Sical in front   ',
     $ 'Method11: Method 10 including miniramp            '/
      DATA TQUAL /
     $ '  Track quality : track                           ',
     $ '  Track quality : track or patch                  '/
      DATA TCUTS /
     $ '  high energy threshold...........................',
     $ '  low energy threshold............................',
     $ '  acoplanarity cut................................',
     $ '  minimum distance to X edge (small area).........',
     $ '  minimum distance to X edge (large area).........',
     $ '  minimum distance to Y edge (small area).........',
     $ '  minimum distance to Y edge (large area).........',
     $ '  minimum abs(cos(phi)) (small area)..............',
     $ '  minimum abs(cos(phi)) (large area)..............',
     $ '  maximum abs(cos(phi)) (small area)..............',
     $ '  maximum abs(cos(phi)) (large area)..............',
     $ '  minimum theta (small area)......................',
     $ '  minimum theta (large area)......................',
     $ '  maximum theta (small area)......................',
     $ '  maximum theta (large area)......................',
     $ '  cross-section ..................................'/
      DATA TRIGS /
     $ '  GBX counts divided by 1024......................',
     $ '  Other triggers..................................',
     $ '  Exclusive single low triggers...................',
     $ '  Exclusive single high triggers..................',
     $ '  Exclusive single very high triggers.............',
     $ '  Exclusive low-low triggers......................',
     $ '  High-Low triggers...............................',
     $ '  Background collections..........................'/
C
C Fraction of Bhabhas with delta_phi=0
      DATA BHSS/0.00025/
#include "bmacro.h"
C--------------------------------------------------------------------
C
C Do background combinations on last events of this run
C
      CALL LBLDBA
      KLSIN=IW(NALSIN)
      IF(KLSIN.GT.0) KLSIN=NDROP('LSIN',0)
C
      KBHAB = IW(NABHAB)
C
C For LEPII calibration runs use BHZ0:
      IF( IRUNRC.GE.40000 .AND. ENERRC.LT.96. ) THEN
        KBHAB = IW(NABHZ0)
      ENDIF
C
      KLUMI = IW(NALUMI)
      KLONL = IW(NALONL)
      IF(KBHAB.LE.0.OR.KLUMI.LE.0.OR.KLONL.LE.0)            GOTO 999
      NMETH = LROWS(KBHAB)
      WRITE(LOUTRL,500)
C
C Print energy calibration
      CALL LPRCAL
C
C Trigger summary
      IF(JPRERF(5).GT.1) THEN
        WRITE(LOUTRL,'(/,1X,A)') 'Trigger summary:'
        DO 81 I=1,8
          WRITE(LOUTRL,'(1X,A,E12.4)') TRIGS(I),RTABL(KLONL,1,I)
   81   CONTINUE
        WRITE(LOUTRL,'(1X,A)') 'Downscale factors:'
        KXTOP = IW(NAMIND('XTOP'))
        IF(KXTOP.GT.0) THEN
          JOFF = KXTOP+LMHLEN+JXTODS-1
          WRITE(LOUTRL,'(1X,8I7)') (IW(JOFF+J),J=1,8)
        ELSE
          KX1TT = IW(NAMIND('X1TT'))
          IF(KX1TT.GT.0) THEN
             JOFF = KX1TT+LMHLEN+JX1TDS-1
             WRITE(LOUTRL,'(1X,8I7)') (IW(JOFF+J),J=1,8)
          ENDIF
        ENDIF
      ENDIF
C
C Determine correction factor - sqrt(s) dependence -
C for Bhabha xsect from reference MC
      CALL LBHCOR(FACT)
C
C Loop over requested methods
      IMMIN=10
      IMMAX=11
      IF(JPRERF(5).GT.1) IMMIN=8
      JBHAB = 0
      DO 100 IM=IMMIN,IMMAX
        IF(RTABL(KLUMI,IM,JLUMCP).LE.0.) GOTO 100
        JBHAB=1
        MET = ITABL(KBHAB,IM,JBHAME)
        IQUA = ITABL(KBHAB,IM,JBHAQF)
        IGEN = ITABL(KBHAB,IM,JBHAGE)
C
C Header for this method
        WRITE(LOUTRL,'(/,1X,A)') TMETH(MET)
C
C Signal is #events with delta_phi=180
        WRITE(LOUTRL,'(/,1X,A)') 'Real coincidences:'
        DO 92 I=1,2
          WRITE(LOUTRL,'(1X,A,F10.1)') TLUMI(I),RTABL(KLUMI,IM,I)
   92   CONTINUE
        DO 93 I=3,9
          WRITE(LOUTRL,'(1X,A,F10.1)') TLUMI(I),RTABL(KLUMI,IM,I+8)
   93   CONTINUE
        IF(MET.EQ.1.AND.RTABL(KLUMI,IM,JLUMTR).GT.0.) THEN
          FACC = RTABL(KLUMI,IM,JLUMF2)/RTABL(KLUMI,IM,JLUMTR)
          ABHA = RTABL(KLUMI,IM,JLUMSA)*FACC +
     &             RTABL(KLUMI,IM,JLUMF4)
          DABHA = SQRT(RTABL(KLUMI,IM,JLUMBH))
          ABHV = RTABL(KLUMI,IM,JLUMB2)
          DABHV = SQRT(ABHV)
        ELSE
          ABHA = RTABL(KLUMI,IM,JLUMBH)
          DABHA = SQRT(ABHA)
          ABHV = RTABL(KLUMI,IM,JLUMB2)
          DABHV = SQRT(ABHV)
        ENDIF
C
C Background is #events with delta_phi=0
C - real coincidences corrected for real Bhabhas
        AFORW = MAX(RTABL(KLUMI,IM,JLUMNP)-ABHV*BHSS,0.)
C - fake coincidences (require at least 10 for statistics)
        RLR=1.
        KLBAK = IW(NALBAK)
        IF(KLBAK.GT.0.) THEN
          IMB=IM
          BBNP=RTABL(KLBAK,IMB,JLBANP)
          BBBH=RTABL(KLBAK,IMB,JLBABH)
          IF(BBNP.LT.10.) THEN
            IMB=4
            BBBH=RTABL(KLBAK,IMB,JLBABH)
            BBNP=RTABL(KLBAK,IMB,JLBANP)
          ENDIF
          WRITE(LOUTRL,'(/,1X,A,I4,A)')
     &    'Fake coincidences:  Method',IMB,'  (low and VH)'
          WRITE(LOUTRL,'(1X,A,2F10.2)')
     &      XLUMI(1),BBBH,RTABL(KLBAK,IMB,JLBABH+1)
          WRITE(LOUTRL,'(1X,A,2F10.2)')
     &      XLUMI(2),BBNP,RTABL(KLBAK,IMB,JLBANP+1)
          IF(BBNP.GE.10.) RLR=BBBH/BBNP
        ENDIF
C
C Scale background by ratio of fake coincidences
C with delta_phi=180 to those with delpta_phi=0
        BBHV = 0.
        DBBHV = 0.
        IF (AFORW.GT.0.) THEN
          BBHV = AFORW*RLR
          DBBHV = SQRT(AFORW)*RLR
        ENDIF
C
C Now get luminosity
        SIGMA = RTABL(KBHAB,IM,JBHACS)*FACT
        IF(SIGMA.NE.0.)THEN
           ALUM  = (ABHV-BBHV)/SIGMA
           DALUM = SQRT(DABHV**2+DBBHV**2)/SIGMA
           SYST = RTABL(KBHAB,IM,JBHAER)/SIGMA
        ELSE
           ALUM=0.
           DALUM=0.
           SYST=0.
        ENDIF
        IF(IRUNRC.GE.43484.AND.IRUNRC.LE.43542) THEN
           ALUM = 2.*ALUM
           DALUM = 2.*DALUM
           SYST = 2.*SYST
        ENDIF
        WRITE(LOUTRL,'(//,1X,A,F10.2)') TCALC(2),ALUM
        WRITE(LOUTRL,'(1X,A,F10.2)') TCALC(3),DALUM
        WRITE(LOUTRL,'(1X,A,35X,F10.2)') '  Cross-section',SIGMA
        KLUM = KROW(KLUMI,IM)
        RW(KLUM+JLUMLU) = ALUM
        RW(KLUM+JLUMSE) = DALUM
        RW(KLUM+JLUMSY) = SYST
  100 CONTINUE
      IF(JBHAB.EQ.1) THEN
        WRITE(LOUTRL,510)
      ELSE
        WRITE(LOUTRL,'(1X,A)') 'No Bhabha events'
      ENDIF
C
  999 CONTINUE
C
  500 FORMAT(1X,80('!'),/,1X,
     &'Luminosity summary :',
     &//)
  510 FORMAT(1X,'--------------------------------------------',/)
      END
#endif
@


1.6
log
@modifs for julia 304
@
text
@d19 2
d58 1
a58 1
      CHARACTER*(LLEN) TMETH(10)
d90 2
a91 1
     $ 'Method10: Improved Method 6 with Sical in front   '/
d175 1
a175 1
      IMMAX=10
@


1.5
log
@LCAL changes for BHZ0 bank
@
text
@d17 2
d250 5
@


1.4
log
@Mods for julia 281 release. See news for details
@
text
@d16 1
d34 2
d129 6
d251 1
@


1.3
log
@import jul280 from historian
Modified Files:
	aamain.F aboldr.F ajmmcl.F almmcl.F altime.F aulpol.F
	bccrun.F bcpack.F binijo.F biniru.F bmsum.F bpreda.F bprsum.F
	bslowc.F
	cabook.F calrec.F calrel.F calrep.F calsup.F cashet.F casmp.F
	casneu.F casnmp.F cclorl.F cctrmi.F ccutpe.F cdang.F cdths.F
 	cegclu.F cencch.F cencne.F cesclu.F cexcob.F cexhis.F cfpass.F
 	cfpmip.F cfpnmp.F cgrunc.F chclu.F chgclu.F chsclu.F cinijo.F
 	cinirl.F cinpar.F cinsrl.F cisgam.F cishit.F cludis.F cmoni.F
 	cnighb.F coslst.F cpadwr.F cparad.F cpotcr.F cpoteh.F cpotlc.F
 	cptcom.F crcalo.F crchrl.F crcjob.F crcpar.F crhclu.F cthclu.F
 	ctkchg.F ctrmip.F ctrpar.F ctrtoc.F cvrify.F
 	e1bpei.F e2bpei.F e3bpei.F e4bary.F e4cosz.F e4dead.F e4deij.F
 	e4fdij.F e4fide.F e4find.F e4fnec.F e4frac.F e4gtbr.F e4gtpl.F
 	e4gtso.F e4gtst.F e4gttw.F e4indi.F e4lea1.F e4ovrl.F e4pal.F
 	e4r1r2.F e4r2r3.F e4r3r4.F e4radc.F e4res2.F e4res3.F e4tstl.F
 	e4xyz0.F eautop.F ebegid.F eboxki.F ecalig.F ecblda.F ecboba.F
	ecbook.F eccaob.F ecchkb.F ecclco.F ecclus.F ecdamp.F ecdebg.F
 	ecdete.F ecdigi.F ecener.F eceras.F ecfclu.F ecfils.F ecfmip.F
 	ecfobj.F ecgflw.F ecgmix.F echarg.F echcgl.F echedc.F echiba.F
 	echist.F echtag.F ecinit.F ecinrv.F eclamp.F eclana.F ecleib.F
 	eclgeo.F eclope.F eclorl.F eclost.F ecltag.F ecltrk.F ecltyp.F
 	ecluar.F ecmesp.F ecmod.F ecmopl.F ecncob.F ecobnk.F ecoent.F
 	ecoidp.F ecos.F ecpasr.F ecplm.F ecprin.F ecprlo.F ecrcob.F
 	ecre4d.F ecreib.F ecrmip.F ecrndx.F ecrpei.F ecrtr.F ecrunq.F
 	ecscmd.F ecst.F ecsupp.F ecsw1093.F ecsw94.F ectemp.F ecthre.F
 	ectopo.F ectpc.F ectrap.F ectrea.F ecxmod.F edisal.F edlist.F
 	efaxe.F efbook.F eferrr.F eficlp.F eficv.F efiecp.F efieib.F
 	efijob.F efix.F efixi94.F eflcst.F efolmk.F efpard.F eftiel.F
 	egacst.F egaest.F egetds.F egfcst.F egttks.F ehcflo.F ehlix.F
 	ehreg.F eidedx.F eident.F eieffl.F einhlx.F einijo.F einirl.F
 	einiru.F einitk.F einsrl.F eipard.F eithr.F eknewb.F eknewe.F
 	elecid.F elongi.F emfill.F emskei.F emskev.F emskf.F emski.F
 	emskji.F emskmu.F enfmsk.F enighb.F enoise.F enprox.F enstat.F
 	epadcl.F epatrn.F epcalo.F epchg.F epneu.F epreda.F eproba.F
 	eprsto.F eprsum.F eprtpc.F ereset.F eroad.F escdef.F escoun.F
 	esfil.F eslas.F eslct.F eslctf.F eslowc.F estag.F esveto.F
 	eswpst.F etdifp.F ethres.F etrdev.F ewdifp.F ewircl.F ex3ijk.F
 	fawian.F ffield.F fidhea.F fidrot.F finiru.F fitall.F fitwri.F
 	fkink.F fkkpar.F floweh.F flowfi.F flowtr.F fmuid.F fpiden.F
 	frefit.F ftpcer.F ftrack.F
 	gambnk.F gapeco.F gasteer.F
 	hcalib.F hcalrd.F hcatow.F hcbhis.F hcfclu.F hchist.F hclcra.F
 	hcltst.F hclufi.F hcos.F hcsimm.F hdgdeb.F hdgfil.F hdgpot.F
 	hdgsum.F hdprec.F hdspre.F hflnoi.F hinijo.F hiniru.F hmener.F
 	hmfind.F hmroad.F hnoise.F hnoisy.F hpatco.F hphnoi.F hplink.F
 	hprana.F hpranp.F hprdig.F hpreda.F hprpot.F hprsum.F hprunc.F
 	hrcomp.F hrcpat.F hrdcal.F hroad.F hslink.F hslowc.F hspare.F
 	hsptre.F hstofi.F htrack.F htubfi.F htwcr.F
 	iasign.F iattma.F ibnkin.F icaswt.F icftoi.F iclimb.F icrcco.F
 	ideadw.F idigpr.F ienang.F ifind1.F ifind2.F ifitp.F iftrak.F
 	igetti.F igettp.F igicha.F iheler.F iinijo.F iiniru.F iintrk.F
 	imatch.F inigap.F insect.F intrak.F ipakdi.F ipdsti.F iphcor.F
 	ipreda.F iprsum.F ipstat.F irefin.F ireopd.F isave.F ishuff.F
 	ishufl.F islowc.F isrch.F itbook.F itccut.F itcopr.F itcrec.F
 	itcrep.F itctpc.F itctrk.F itcxng.F iterr.F itextn.F ithist.F
 	itidy1.F itidy2.F itlnk1.F itlnk2.F itpcan.F itrak.F itrecf.F
 	itreci.F itree.F itrkci.F itrkeq.F itrkzr.F itrmca.F
@
text
@d11 5
d28 1
a28 2
C!     Calculate background contribution using both dphi
C!     and GBX technique.
d46 1
a46 1
      COMMON/DWNSCL/ SCALE(2)
d56 2
a57 2
     $ '  Events inside fiducial area with dphi>cut.......',
     $ '  Events inside fiducial area with dphi<cut.......'/
d61 2
a62 2
     $ '  Events inside fiducial area with dphi>cut.......',
     $ '  Events inside fiducial area with dphi<cut.......',
d64 1
a64 1
     $ '  Accepted events with LCAL ECAL HCAL TPC ITC on..',
d69 2
a70 2
     $ '  Background contribution.........................',
     $ '  Luminosity (with HV on) for this run (nb-1).....',
d113 3
d122 2
a135 7
C ACROS is no. of GBX's per background update
      RW(KLONL+LMHLEN+JLONRA) = AMAX1(RTABL(KLONL,1,JLONRA),1.)
      ONRA=RTABL(KLONL,1,JLONRA)
      IF(ONRA.NE.0.)THEN
         ACROS = 1024.*(RTABL(KLONL,1,JLONGB)/ONRA)
      ENDIF
      IF(ACROS.LE.0.)ACROS = 1.
d155 2
a156 1
C Determine correction factors (energy scale,electroweak) to cross secti
d174 1
a174 1
C Accepted events
a185 1
          AFORW = RTABL(KLUMI,IM,JLUMNP)
a190 1
          AFORW = RTABL(KLUMI,IM,JLUMNP)
d196 5
a200 1
C Background events
a201 2
        BBHA  = 0.
        DBBHA = 0.
d203 15
a217 8
          WRITE(LOUTRL,'(/,1X,A)')
     &    'Fake coincidences (High-Low and High-High):'
          WRITE(LOUTRL,'(1X,A,F10.2,1X,F10.2)')
     &      XLUMI(1),(RTABL(KLBAK,IM,JLBABH)/ACROS),
     &      (RTABL(KLBAK,IM,JLBABH+1)/ACROS)
          WRITE(LOUTRL,'(1X,A,F10.2,1X,F10.2)')
     &      XLUMI(2),(RTABL(KLBAK,IM,JLBANP)/ACROS),
     &      (RTABL(KLBAK,IM,JLBANP+1)/ACROS)
d220 2
a221 1
C Scale background by ratio of bhabhas with HV on and total bhabha count
d224 3
a226 3
        IF (AFORW.GT.0..AND.ABHA.GT.0.) THEN
          BBHV = AFORW*ABHV/ABHA
          DBBHV = SQRT(AFORW)*ABHV/ABHA
d240 1
a240 1
        WRITE(LOUTRL,'(1X,A,F10.2)') TCALC(2),ALUM
a241 1
        WRITE(LOUTRL,'(1X,A,F10.2)') TCALC(4),SYST*ALUM
d245 1
a245 1
        RW(KLUM+JLUMSY) = SYST*ALUM
@


1.2
log
@julia version 279
@
text
@a0 1
*DK lprlum
@


1.1
log
@Initial revision
@
text
@d209 1
a209 20
C
C Add backgrounds of the two combinations for the >dphi and <dphi sample
C Divide each sample by its weighted factor to get the number of bkg
C combinations.  (Required to get the statistical error correct)
          BBACK = RTABL(KLBAK,IM,JLBABH)+RTABL(KLBAK,IM,JLBABH+1)
          BFORW = RTABL(KLBAK,IM,JLBANP)+RTABL(KLBAK,IM,JLBANP+1)
          NBBK  = RTABL(KLBAK,IM,JLBABH)/SCALE(1)
     &          + RTABL(KLBAK,IM,JLBABH+1)/SCALE(2)
          NBFW  = RTABL(KLBAK,IM,JLBANP)/SCALE(1)
     &          + RTABL(KLBAK,IM,JLBANP+1)/SCALE(2)
          IF(BFORW.GT.0.) THEN
            BBHA = BBACK*AFORW/BFORW
            IF(NBBK.GT.0..AND.AFORW.GT.0..AND.NBFW.GT.0) THEN
              DBBHA = 1./NBBK + 1./NBFW + 1./AFORW
              DBBHA = SQRT(DBBHA)*BBHA
            ENDIF
          ENDIF
          KLBA = KROW(KLBAK,IM)
          RW(KLBA+JLBABA) = BBHA
          WRITE(LOUTRL,'(1X,A,F10.2,/)') TCALC(1),BBHA
d212 5
a216 6
          BBHV = 0.
          DBBHV = 0.
          IF (ABHA.GT.0.) THEN
            BBHV = BBHA*ABHV/ABHA
            DBBHV = DBBHA*ABHV/ABHA
          ENDIF
d223 1
a223 1
           DALUM = (DABHV**2+DBBHV**2)/SIGMA**2
d231 1
a231 1
        WRITE(LOUTRL,'(1X,A,F10.2)') TCALC(3),SQRT(DALUM)
@


1.1.1.1
log
@import julia 300
@
text
@@
