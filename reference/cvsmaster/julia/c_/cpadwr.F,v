head	1.3;
access;
symbols
	jul313_3:1.3
	jul313_2:1.3
	jul313_1:1.3
	jul313:1.3
	jul312_1:1.3
	jul312:1.3
	jul311:1.3
	jul310_1:1.3
	jul310:1.3
	jul309_1:1.3
	jul309:1.3
	jul308_6:1.3
	jul308_5:1.3
	jul308_4:1.3
	jul308_3:1.3
	jul308_2:1.3
	jul308_1:1.3
	jul308:1.3
	jul307_4:1.3
	jul307_3:1.3
	jul307_2:1.3
	jul307_1:1.3
	jul307:1.3
	jul306_3:1.3
	jul306_2:1.3
	jul306_1:1.3
	jul306:1.3
	jul305_4:1.3
	jul305_3:1.3
	jul305_2:1.3
	jul305_1:1.3
	jul305:1.3
	jul304_3:1.3
	jul304_2:1.3
	jul304_1:1.3
	jul304:1.3
	jul303_7:1.3
	jul303_6:1.3
	jul303_5:1.3
	jul303_4:1.3
	jul303_3:1.3
	jul303_2_mc1:1.3
	jul303_2:1.3
	jul303_1_mc1:1.3
	jul303_1:1.3
	jul303_v:1.3
	jul303:1.3
	jul302_6:1.3
	jul302_5:1.3
	jul302_4:1.3
	jul302_3:1.3
	jul302_2:1.3
	jul302_1:1.3
	jul302:1.3
	jul285_1:1.3
	jul285:1.3
	jul284_1:1.3
	jul284:1.3
	jul283_1:1.3
	jul283:1.3
	jul282_1:1.3
	jul282:1.3
	jul281_3:1.3
	jul281_2:1.3
	jul281_1:1.3
	jul281:1.3
	jul280_1:1.3
	jul280:1.3
	jul279:1.2
	v300:1.1.1.1
	flr:1.1.1;
locks; strict;
comment	@c @;


1.3
date	96.03.12.14.41.26;	author flr;	state Exp;
branches;
next	1.2;

1.2
date	95.11.29.17.15.49;	author flr;	state Exp;
branches;
next	1.1;

1.1
date	94.12.07.14.17.28;	author aljul;	state Exp;
branches
	1.1.1.1;
next	;

1.1.1.1
date	94.12.07.14.17.29;	author aljul;	state Exp;
branches;
next	;


desc
@@


1.3
log
@import jul280 from historian
Modified Files:
	aamain.F aboldr.F ajmmcl.F almmcl.F altime.F aulpol.F
 Modified Files:
	bccrun.F bcpack.F binijo.F biniru.F bmsum.F bpreda.F bprsum.F
	bslowc.F
	cabook.F calrec.F calrel.F calrep.F calsup.F cashet.F casmp.F
	casneu.F casnmp.F cclorl.F cctrmi.F ccutpe.F cdang.F cdths.F
 	cegclu.F cencch.F cencne.F cesclu.F cexcob.F cexhis.F cfpass.F
 	cfpmip.F cfpnmp.F cgrunc.F chclu.F chgclu.F chsclu.F cinijo.F
 	cinirl.F cinpar.F cinsrl.F cisgam.F cishit.F cludis.F cmoni.F
 	cnighb.F coslst.F cpadwr.F cparad.F cpotcr.F cpoteh.F cpotlc.F
 	cptcom.F crcalo.F crchrl.F crcjob.F crcpar.F crhclu.F cthclu.F
 	ctkchg.F ctrmip.F ctrpar.F ctrtoc.F cvrify.F
@
text
@      SUBROUTINE CPADWR (IERR)
C==================================================
C
C!    Create & fill PRPW banks
C-
C-     Author  : M.N. Minard                 26/08/89
C-     Relation Between PECO  & Module #
C
C      Banks Created PRPW
C      Banks used PECO , PEST , ETDI , PEWI
C?
C!======================================================================
#ifndef DOC
#include "bcs.h"
#include "etdijj.h"
#include "pecojj.h"
#include "pestjj.h"
#include "prpwjj.h"
      DIMENSION EFIL (3,36),IFIL(36)
      DIMENSION IPOS ( 36)
#include "bmacro.h"
C
C-    Loop on PECO
C
      IERR = 0
      NAPECO = NAMIND ('PECO')
      KPECO = IW (NAPECO)
      IF ( KPECO .LE. 0) GO TO 999
      NPECO = LROWS (KPECO)
C
C-    Lift relation banks wires - PECO
C
      LEN = LMHLEN + LPRPWA*NPECO*2
      CALL AUBOS ( 'PRPW',0,LEN,KPRPW,IGARB)
      IF ( IGARB.EQ.2 ) GO TO 997
      CALL BLIST (IW,'E+','PRPW')
      IW ( KPRPW + LMHCOL ) = LPRPWA
      IW ( KPRPW + LMHROW ) = 0
      NLMAX = NPECO*2
      IF ( IGARB.EQ.1) THEN
        KPECO = IW (NAPECO)
      ENDIF
C
C-    Initialise pointers
C
      NAPEST = NAMIND ('PEST')
      KPEST = IW (NAPEST)
      IF (KPEST .EQ.0) GO TO 999
      NPEST = LROWS(KPEST)
      NAETDI = NAMIND ('ETDI')
      KETDI = IW ( NAETDI)
C
C-    Fill from PEWI bank module position
C
      CALL VZERO (IPOS,36)
      NAPEWI = NAMIND ('PEWI')
      NPEWI = 0
      KPEWI = IW ( NAPEWI)
      IF ( KPEWI.EQ.0) KPEWI = IW(NAMIND('PWEI'))
      IF ( KPEWI.GT.0) NPEWI = LROWS ( KPEWI)
      DO 20 IPEWI = 1,NPEWI
      IMOD = ITABL ( KPEWI,IPEWI,1)
      IF ( IMOD.LT.1.OR.IMOD.GT.36) GO TO 998
      IPOS (IMOD) = IPEWI
 20   CONTINUE
C
C-    Loop on PECO
C
      DO 100 IPECO = 1,NPECO
      ECSUM = 0.
C
C-    Skip LCAL PECO
C
      IF ( ITABL (KPECO,IPECO,JPECKD).EQ.192) GO TO 100
C
C-    Extract info from PECO bank
C
      CALL VZERO (EFIL,36*3)
      CALL VZERO (IFIL,36)
C
C-    Search for PEST elements belonging to this cluster
C
      DO 50 IPEST = 1,NPEST
      IF ( ITABL(KPEST,IPEST,JPESED).NE.0 ) GO TO 50
      IF ( ITABL(KPEST,IPEST,JPESPE).NE.IPECO ) GO TO 50
      IK = ITABL ( KPEST,IPEST,JPESKS)
      IETDI = ITABL (KPEST ,IPEST,JPESET)
      ITOW = ITABL (KETDI,IETDI,JETDTL)
      ITETA = IBITS ( ITOW , 16 , 8)
      IPHI  = IBITS ( ITOW , 2 , 9 )
      CALL ECSCMD ( IPHI,ITETA,IMOD,ISC)
      IGMOD = (ISC-1)*12+IMOD
      IFIL ( IGMOD ) = IFIL (IGMOD) +1
      ESDT = FLOAT ( ITABL(KETDI,IETDI,IK+1))/1000000.
      EFIL ( IK,IGMOD) = EFIL ( IK,IGMOD) + ESDT
      ECSUM = ECSUM + ESDT
 50   CONTINUE
C
C-    Now store fraction
C
      DO 60 IL =1,36
      IF ( IFIL(IL).EQ.0) GO TO 60
C
C-    Look if bank should be enlarged
C
      NRMOD = LROWS(KPRPW)
      IF ( NRMOD.LE.NLMAX ) THEN
         LEN = LMHLEN + NRMOD*LPRPWA + NPECO*LPRPWA
         CALL AUBOS ( 'PRPW',0,LEN,KPRPW,IGARB)
         IF ( IGARB.EQ.2 ) GO TO 997
         NLMAX = NLMAX + NPECO
C
C-     In case garbage collection update pointers
C
        IF ( IGARB.EQ.1) THEN
           KPECO = IW (NAPECO)
           KPEST = IW (NAPEST)
           KETDI = IW (NAETDI)
        ENDIF
      ENDIF
C
C-      Fill PRPW bank
C
      NPRPW = LROWS ( KPRPW )
      JPRPW = KROW ( KPRPW , NPRPW+1)
      IW ( JPRPW + JPRPPN ) = IPECO
      IW ( JPRPW + JPRPMR ) = IPOS (IL)
      IW ( JPRPW + JPRPMN ) = IL
      ERAW = EFIL ( 1,IL)+EFIL(2,IL)+EFIL(3,IL)
      DO 70 IKL = 1,2
      RW ( JPRPW + JPRPMN + IKL ) = EFIL (IKL,IL)/ERAW
 70   CONTINUE
      RW ( JPRPW + JPRPER ) = ERAW
      IW ( KPRPW + LMHROW ) = IW (KPRPW + LMHROW) + 1
 60   CONTINUE
 100  CONTINUE
C
C-    Compress PRPW  banks
C
      CALL AUBPRS ( 'PRPW' )
      GO TO 999
 997  CALL REPORT ( 'CPADWR' , 'AUBOS failure',1)
      IERR = 1
      GO TO 999
 998  CALL RERROR ( 'CPADWR',1, ' Ecal Wire Module out of range')
      IERR = 1
      GO TO 999
 999  CONTINUE
      RETURN
      END
#endif
@


1.2
log
@julia version 279
@
text
@a0 1
*DK cpadwr
@


1.1
log
@Initial revision
@
text
@d60 1
@


1.1.1.1
log
@import julia 300
@
text
@@
