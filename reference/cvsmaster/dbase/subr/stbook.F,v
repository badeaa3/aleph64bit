head	1.2;
access;
symbols
	dbase22:1.2
	dbase21:1.2
	dbase20:1.1
	dbase19:1.1
	dbase18:1.1
	dbase17:1.1
	dbase04:1.1
	dbase03:1.1;
locks; strict;
comment	@c @;


1.2
date	99.03.04.10.47.47;	author flr;	state Exp;
branches;
next	1.1;

1.1
date	97.02.14.16.11.53;	author flr;	state Exp;
branches;
next	;


desc
@@


1.2
log
@change if UNIX for if defined(UNIX)
@
text
@      SUBROUTINE STBOOK(NINARR)
C-----------------------------------------------------------------------
C! set list of lines where a bank is booked
C!    Author: A. McSporran    19/8/88
CKEY CREATE BOOK BANK
C!    Input:
C!         -  NINARR  I           : Number of names in NAMARR.
C!
C!    Use from /FILCAR/
C!         -  NAMARR  C*4         : Array containing names of banks to
C!                                  be checked for booking in
C!                                  alphabetic order.
C!    Fill in /FILDAT/
C!         -  NUMBKD  I           : Number of bookings found for bank
C!                                  with name in NAMARR(IND).
C!         -  BKDLIN  C*40        : 40 character line of text for
C!                                  where bank is booked. (up to
C!                                  50 are stored, usual max = 25.
C!
C!    Description
C!    -----------
C!
C!    The file ALL.ASSIGN contains code from various programs in
C!    reconstruction/analysis projects. On reading this file, if a
C!    command is found that books, ie opens for use, a BOS bank,
C!    then if the bank opened is in the given list NAMARR, the name of
C!    the program is added to the BKDLIN array, to be returned to
C!    the calling routine.
C!
C?    Algorithm
C?    =========
C?
C?    Repeat
C?        Open input file DOC:ALL.ASSIGN;
C?        Repeat read line;
C?        until line contains code for booking a bank;
C?        put bank name in BANK_NAME;
C?        check BANK_NAME with BANK_NAME_ARRAY;
C?        if found then add booking description to BOOKED_ARRAY;
C?    Until end of input file;
C?    return.
C=======================================================================
#ifndef DOC
#include "sbkpar.h"
#include "sbkloc.h"
#include "fildat.h"
      CHARACTER*5  SSTRING
      LOGICAL      FOUND
C ---------------------------------------------------------------------
C
#if defined(UNIX)
      OPEN (UNIT=LINP2,FILE=ALDOCC(:ILDOCC)//'/all.assign',STATUS='OLD')
#else
      OPEN (UNIT=LINP2,FILE='DOC:ALL.ASSIGN',STATUS='OLD',READONLY)
#endif
C
   18 READ(LINP2,'(A)',END=99)INPLIN
      IF((INDEX(INPLIN,'CALLA').EQ.0.OR.
     +     INDEX(INPLIN,'BOS(').EQ.0).AND.
     +     INDEX(INPLIN,'NBANK(''').EQ.0.AND.
     +     INDEX(INPLIN,'MBANK(').EQ.0)GOTO 18
      FOUND=.FALSE.
      I=0
   10 I=I+1
      IF (I.GT.NINARR.OR.FOUND) GOTO 18
      SSTRING=''''//NAMARR(I)
      ISTRING=INDEX(INPLIN,SSTRING)
      IF(ISTRING.EQ.0)GOTO 10
      FOUND = .TRUE.
      IF (NUMBKD(I).GE.NENTR) THEN
         WRITE(LOUT,*) ' Too many entries for ',NAMARR(I),
     &                 ' increase NENTR in SBKPAR'
         GOTO 10
      ENDIF
      NUMBKD(I)=NUMBKD(I)+1
      IND=INDEX(INPLIN(ISTRING+7:80),',')
      BKDLIN(I,NUMBKD(I))=INPLIN(1:25)//'   '
     +             //INPLIN(ISTRING+7:ISTRING+5+IND)
      GOTO 10
C
   99 CONTINUE
      CLOSE (LINP2)
      RETURN
      END
#endif
@


1.1
log
@move subroutine in subr andprograms in prog sbk becomes empty
@
text
@d51 1
a51 1
#if UNIX
@
