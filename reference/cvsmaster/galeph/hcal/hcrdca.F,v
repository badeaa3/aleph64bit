head	1.4;
access;
symbols
	gal309_3:1.4
	gal309_2:1.4
	gal309_1:1.4
	gal309:1.4
	gal308_2:1.3
	gal308_1:1.3
	gal308:1.3
	gal307_2:1.3
	gal307_1:1.3
	gal307:1.1;
locks; strict;
comment	@c @;


1.4
date	99.12.03.14.10.54;	author flr;	state Exp;
branches;
next	1.3;

1.3
date	98.08.31.09.54.28;	author flr;	state Exp;
branches
	1.3.2.1;
next	1.2;

1.2
date	98.08.21.15.09.09;	author flr;	state Exp;
branches;
next	1.1;

1.1
date	98.07.03.14.47.30;	author flr;	state Exp;
branches;
next	;

1.3.2.1
date	99.12.02.12.25.40;	author flr;	state Exp;
branches;
next	;


desc
@@


1.4
log
@gal309 - Y2K compliant
@
text
@      SUBROUTINE HCRDCA
C------------------------------------------------------------------
C
C!  Reads the calibration constants for the year
C!
C!           Author: A.Sciaba`  29/04/98
C!           Modified: 18/08/98
C!                -added HIMM bank
C!           Input banks: HSCA,HT0C,HIMC,HSTD,HIFC,HIMM
C!
C!
C!         -Called by : HCIRUN
C!         -Calls     : MDARD                      from BOS
C------------------------------------------------------------------
#ifndef DOC
      INTEGER YEAR, GTSTUP, ALGTDB
#include "asimjj.h"
#include "jobcom.h"
#include "iocom.h"
#include "bcs.h"
#include "hcalct.h"
#include "hccoun.h"
#include "bmacro.h"
C -----------------------------------------------------------------
C
C     Initializing some variables
      DO I=1,24
         CALBA(I) = 1.
         CALIMB(I) = 1.
         CALMCB(I) = 1.
      ENDDO
      DO I=1,12
         CALEC(I) = 1.
         CALIME(I) = 1.
         CALMCE(I) = 1.
      ENDDO
      CALTBA = 1.
      CALTEC = 1.
      CT0MCB = 1.
      CT0MCE = 1.
      CT0DAB = 1.
      CT0DAE = 1.
      CALTUB = 1.
      CALTUE = 1.
      JHSCA = 0
      JHIFC = 0
      JHIMM = 0
C     
C     
C     Load HNGR
      IND = MDARD(IW,LRDBIO,'HNGR',0)
C
      IF(IPRIJO(7).GT.0)THEN
         WRITE(LOUTIO,*)' HCRDCA - Reading HCAL calibration',
     &        ' constants:'
      ENDIF
C
C     Look at the period number
      JSTUP = GTSTUP('HC',1)
C
C     Select the appropriate calibration costants for each year
      IND = MDARD(IW,LRDBIO,'HSCA',0)
      JHSCA = IW(NAMIND('HSCA'))
      IF(JHSCA.NE.0) THEN
         IRHT0C = ITABL(JHSCA,JSTUP,1)
         IRHSTD = ITABL(JHSCA,JSTUP,2)
         IRHIMC = ITABL(JHSCA,JSTUP,3)
         IF(IPRIJO(7).GT.0)THEN
            WRITE(LOUTIO,*)'SETUP CODE  HT0C    HSTD    HIMC' 
            WRITE(LOUTIO,'(4(I8))')JSTUP,IRHT0C,IRHSTD,IRHIMC
         ENDIF
      ELSE
         IF(IPRIJO(7).GT.0)THEN
            WRITE(LOUTIO,*)'ERROR: HCSA NOT FOUND!'
         ENDIF
         GOTO 10
      ENDIF
C
C     Calibration constants from HT0C, HSTD, HIMC
      IND = ALGTDB(LRDBIO,'HIMC',IRHIMC)
      JHIMC = IW(NAMIND('HIMC'))
      IF(JHIMC.NE.0) THEN
         DO I=1,24
            CALBA(I) = RTABL(JHIMC,1,I)
         ENDDO
         DO I=1,12
            CALEC(I) = RTABL(JHIMC,1,24+I)
         ENDDO
      ENDIF
      IND = ALGTDB(LRDBIO,'HSTD',IRHSTD)
      JHSTD = IW(NAMIND('HSTD'))
      IF(JHSTD.NE.0) THEN
         CALTBA = RTABL(JHSTD,1,1)
         CALTEC = RTABL(JHSTD,1,2)
      ENDIF
      IND = ALGTDB(LRDBIO,'HT0C',IRHT0C)
      JHT0C = IW(NAMIND('HT0C'))
      IF(JHT0C.NE.0) THEN
         CT0MCB = RTABL(JHT0C,1,1)
         CT0MCE = RTABL(JHT0C,1,3)
         CT0DAB = RTABL(JHT0C,1,2)
         CT0DAE = RTABL(JHT0C,1,4)
      ENDIF
C
C     Load HIFC (with calibration costants on FICs)
      NR = NDANR(LRDBIO,'HIFC','LE',JSTUP)
      IF (NR.EQ.0) GOTO 3
      IND = MDARD(IW,LRDBIO,'HIFC',NR)
      JHIFC = IW(NAMIND('HIFC'))
 3    IF(JHIFC.NE.0) THEN
         DO I=1,24
            CALIMB(I) = RTABL(JHIFC,1,I)
         ENDDO
         DO I=1,12
            CALIME(I) = RTABL(JHIFC,1,24+I)
         ENDDO
      ENDIF

C     Load HIMM (with calibration costants of MC)
      NR = NDANR(LRDBIO,'HIMM','LE',JSTUP)
      IF (NR.EQ.0) GOTO 4
      IND = MDARD(IW,LRDBIO,'HIMM',NR)
      JHIMM = IW(NAMIND('HIMM'))
 4    IF(JHIMM.NE.0) THEN
         DO I=1,24
            CALMCB(I) = RTABL(JHIMM,1,I)
         ENDDO
         DO I=1,12
            CALMCE(I) = RTABL(JHIMM,1,24+I)
         ENDDO
      ENDIF
C      
C     Load calibration constant from online monitoring
      IND = MDARD(IW,LRDBIO,'HCOL',0)
      JHCOL = IW(NAMIND('HCOL'))
      IF(JHCOL.NE.0) THEN
         CALTUB = RTABL(JHCOL,JSTUP,1)
         CALTUE = CALTUB
      ENDIF
C
 10   CONTINUE
C
c     Printout of the calibration constants
      IF(IPRIJO(7).GT.0)THEN
         WRITE(LOUTIO,*) ' HCRDCA : Intermodule Calib Barrel'
         WRITE(LOUTIO,1) (CALBA(J),J=1,24)
         WRITE(LOUTIO,*) ' HCRDCA : Intermodule Calib Endcaps'
         WRITE(LOUTIO,1) (CALEC(J),J=1,12)
         WRITE(LOUTIO,*) ' HCRDCA : Normalizations at T=0'
         WRITE(LOUTIO,*) CT0MCB,CT0MCE,CT0DAB,CT0DAE
         WRITE(LOUTIO,*) ' HCRDCA : time dependence'
         WRITE(LOUTIO,*) CALTBA,CALTEC
         WRITE(LOUTIO,*) ' HCRDCA : Online Intermodule Calib Barrel'
         WRITE(LOUTIO,1) (CALIMB(J),J=1,24)
         WRITE(LOUTIO,*) ' HCRDCA : Online Intermodule Calib Endcaps'
         WRITE(LOUTIO,2) (CALIME(J),J=1,12)
         WRITE(LOUTIO,*) ' HCRDCA : MC  Intermodule Calib Barrel'
         WRITE(LOUTIO,1) (CALMCB(J),J=1,24)
         WRITE(LOUTIO,*) ' HCRDCA : MC Intermodule Calib Endcaps'
         WRITE(LOUTIO,2) (CALMCE(J),J=1,12)
         WRITE(LOUTIO,*) ' HCRDCA : Online Monitoring Constant'
         WRITE(LOUTIO,*) CALTUB
         WRITE(LOUTIO,*) ' '
      ENDIF
C
 1    FORMAT(6(2X,F8.4))
 2    FORMAT(4(2X,F8.4))
C
      RETURN
      END
#endif
@


1.3
log
@gal307_1: remove CR in hcfora.F and hcrdca.F
@
text
@d16 1
a16 1
      INTEGER YEAR, ADBRPN, ALGTDB
d53 1
a53 1
      IF(FHCDEB)THEN
d59 1
a59 5
      JASIM = IW(NAMIND('ASIM'))
      IPERIOD = ITABL(JASIM,1,JASIYM)
C
C      Get the setup code
      IER = ADBRPN('HC',IROW,IPERIOD,JRUN,JSTUP)
d68 1
a68 1
         IF(FHCDEB)THEN
d73 1
a73 1
         IF(FHCDEB)THEN
d144 1
a144 1
      IF(FHCDEB)THEN
@


1.3.2.1
log
@gal308_2 Y2K fix in skel/ geom/ hcal/
@
text
@d16 1
a16 1
      INTEGER YEAR, GTSTUP, ALGTDB
d53 1
a53 1
      IF(IPRIJO(7).GT.0)THEN
d59 5
a63 1
      JSTUP = GTSTUP('HC',1)
d72 1
a72 1
         IF(IPRIJO(7).GT.0)THEN
d77 1
a77 1
         IF(IPRIJO(7).GT.0)THEN
d148 1
a148 1
      IF(IPRIJO(7).GT.0)THEN
@


1.2
log
@gal307.1 see ChangeLog
@
text
@d1 175
a175 175
      SUBROUTINE HCRDCA
C------------------------------------------------------------------
C
C!  Reads the calibration constants for the year
C!
C!           Author: A.Sciaba`  29/04/98
C!           Modified: 18/08/98
C!                -added HIMM bank
C!           Input banks: HSCA,HT0C,HIMC,HSTD,HIFC,HIMM
C!
C!
C!         -Called by : HCIRUN
C!         -Calls     : MDARD                      from BOS
C------------------------------------------------------------------
#ifndef DOC
      INTEGER YEAR, ADBRPN, ALGTDB
#include "asimjj.h"
#include "jobcom.h"
#include "iocom.h"
#include "bcs.h"
#include "hcalct.h"
#include "hccoun.h"
#include "bmacro.h"
C -----------------------------------------------------------------
C
C     Initializing some variables
      DO I=1,24
         CALBA(I) = 1.
         CALIMB(I) = 1.
         CALMCB(I) = 1.
      ENDDO
      DO I=1,12
         CALEC(I) = 1.
         CALIME(I) = 1.
         CALMCE(I) = 1.
      ENDDO
      CALTBA = 1.
      CALTEC = 1.
      CT0MCB = 1.
      CT0MCE = 1.
      CT0DAB = 1.
      CT0DAE = 1.
      CALTUB = 1.
      CALTUE = 1.
      JHSCA = 0
      JHIFC = 0
      JHIMM = 0
C     
C     
C     Load HNGR
      IND = MDARD(IW,LRDBIO,'HNGR',0)
C
      IF(FHCDEB)THEN
         WRITE(LOUTIO,*)' HCRDCA - Reading HCAL calibration',
     &        ' constants:'
      ENDIF
C
C     Look at the period number
      JASIM = IW(NAMIND('ASIM'))
      IPERIOD = ITABL(JASIM,1,JASIYM)
C
C      Get the setup code
      IER = ADBRPN('HC',IROW,IPERIOD,JRUN,JSTUP)
C
C     Select the appropriate calibration costants for each year
      IND = MDARD(IW,LRDBIO,'HSCA',0)
      JHSCA = IW(NAMIND('HSCA'))
      IF(JHSCA.NE.0) THEN
         IRHT0C = ITABL(JHSCA,JSTUP,1)
         IRHSTD = ITABL(JHSCA,JSTUP,2)
         IRHIMC = ITABL(JHSCA,JSTUP,3)
         IF(FHCDEB)THEN
            WRITE(LOUTIO,*)'SETUP CODE  HT0C    HSTD    HIMC' 
            WRITE(LOUTIO,'(4(I8))')JSTUP,IRHT0C,IRHSTD,IRHIMC
         ENDIF
      ELSE
         IF(FHCDEB)THEN
            WRITE(LOUTIO,*)'ERROR: HCSA NOT FOUND!'
         ENDIF
         GOTO 10
      ENDIF
C
C     Calibration constants from HT0C, HSTD, HIMC
      IND = ALGTDB(LRDBIO,'HIMC',IRHIMC)
      JHIMC = IW(NAMIND('HIMC'))
      IF(JHIMC.NE.0) THEN
         DO I=1,24
            CALBA(I) = RTABL(JHIMC,1,I)
         ENDDO
         DO I=1,12
            CALEC(I) = RTABL(JHIMC,1,24+I)
         ENDDO
      ENDIF
      IND = ALGTDB(LRDBIO,'HSTD',IRHSTD)
      JHSTD = IW(NAMIND('HSTD'))
      IF(JHSTD.NE.0) THEN
         CALTBA = RTABL(JHSTD,1,1)
         CALTEC = RTABL(JHSTD,1,2)
      ENDIF
      IND = ALGTDB(LRDBIO,'HT0C',IRHT0C)
      JHT0C = IW(NAMIND('HT0C'))
      IF(JHT0C.NE.0) THEN
         CT0MCB = RTABL(JHT0C,1,1)
         CT0MCE = RTABL(JHT0C,1,3)
         CT0DAB = RTABL(JHT0C,1,2)
         CT0DAE = RTABL(JHT0C,1,4)
      ENDIF
C
C     Load HIFC (with calibration costants on FICs)
      NR = NDANR(LRDBIO,'HIFC','LE',JSTUP)
      IF (NR.EQ.0) GOTO 3
      IND = MDARD(IW,LRDBIO,'HIFC',NR)
      JHIFC = IW(NAMIND('HIFC'))
 3    IF(JHIFC.NE.0) THEN
         DO I=1,24
            CALIMB(I) = RTABL(JHIFC,1,I)
         ENDDO
         DO I=1,12
            CALIME(I) = RTABL(JHIFC,1,24+I)
         ENDDO
      ENDIF

C     Load HIMM (with calibration costants of MC)
      NR = NDANR(LRDBIO,'HIMM','LE',JSTUP)
      IF (NR.EQ.0) GOTO 4
      IND = MDARD(IW,LRDBIO,'HIMM',NR)
      JHIMM = IW(NAMIND('HIMM'))
 4    IF(JHIMM.NE.0) THEN
         DO I=1,24
            CALMCB(I) = RTABL(JHIMM,1,I)
         ENDDO
         DO I=1,12
            CALMCE(I) = RTABL(JHIMM,1,24+I)
         ENDDO
      ENDIF
C      
C     Load calibration constant from online monitoring
      IND = MDARD(IW,LRDBIO,'HCOL',0)
      JHCOL = IW(NAMIND('HCOL'))
      IF(JHCOL.NE.0) THEN
         CALTUB = RTABL(JHCOL,JSTUP,1)
         CALTUE = CALTUB
      ENDIF
C
 10   CONTINUE
C
c     Printout of the calibration constants
      IF(FHCDEB)THEN
         WRITE(LOUTIO,*) ' HCRDCA : Intermodule Calib Barrel'
         WRITE(LOUTIO,1) (CALBA(J),J=1,24)
         WRITE(LOUTIO,*) ' HCRDCA : Intermodule Calib Endcaps'
         WRITE(LOUTIO,1) (CALEC(J),J=1,12)
         WRITE(LOUTIO,*) ' HCRDCA : Normalizations at T=0'
         WRITE(LOUTIO,*) CT0MCB,CT0MCE,CT0DAB,CT0DAE
         WRITE(LOUTIO,*) ' HCRDCA : time dependence'
         WRITE(LOUTIO,*) CALTBA,CALTEC
         WRITE(LOUTIO,*) ' HCRDCA : Online Intermodule Calib Barrel'
         WRITE(LOUTIO,1) (CALIMB(J),J=1,24)
         WRITE(LOUTIO,*) ' HCRDCA : Online Intermodule Calib Endcaps'
         WRITE(LOUTIO,2) (CALIME(J),J=1,12)
         WRITE(LOUTIO,*) ' HCRDCA : MC  Intermodule Calib Barrel'
         WRITE(LOUTIO,1) (CALMCB(J),J=1,24)
         WRITE(LOUTIO,*) ' HCRDCA : MC Intermodule Calib Endcaps'
         WRITE(LOUTIO,2) (CALMCE(J),J=1,12)
         WRITE(LOUTIO,*) ' HCRDCA : Online Monitoring Constant'
         WRITE(LOUTIO,*) CALTUB
         WRITE(LOUTIO,*) ' '
      ENDIF
C
 1    FORMAT(6(2X,F8.4))
 2    FORMAT(4(2X,F8.4))
C
      RETURN
      END
#endif
@


1.1
log
@gal307 look at galeph/news/news.h
@
text
@d1 175
a175 152
      SUBROUTINE HCRDCA
C------------------------------------------------------------------
C
C!  Reads the calibration constants for the year
C!
C!           Author: A.Sciaba`  02/07/98
C!           Input banks: HSCA,HT0C,HIMC,HSTD,HIFC
C!
C!
C!         -Called by : HCIRUN
C!         -Calls     : MDARD                      from BOS
C------------------------------------------------------------------
#ifndef DOC
      INTEGER YEAR, ADBRPN, ALGTDB
#include "asimjj.h"
#include "jobcom.h"
#include "iocom.h"
#include "bcs.h"
#include "hcalct.h"
#include "hccoun.h"
#include "bmacro.h"
C -----------------------------------------------------------------
C
C     Initializing some variables
      DO I=1,24
         CALBA(I) = 1.
         CALIMB(I) = 1.
      ENDDO
      DO I=1,12
         CALEC(I) = 1.
         CALIME(I) = 1.
      ENDDO
      CALTBA = 1.
      CALTEC = 1.
      CT0MCB = 1.
      CT0MCE = 1.
      CT0DAB = 1.
      CT0DAE = 1.
      CALTUB = 1.
      CALTUE = 1.
      JHSCA = 0
      JHIFC = 0
C     
C     
C     Load HNGR
      IND = MDARD(IW,LRDBIO,'HNGR',0)
C
      IF(FHCDEB)THEN
         WRITE(LOUTIO,*)' HCRDCA - Reading HCAL calibration',
     &        ' constants:'
      ENDIF
C
C     Look at the period number
      JASIM = IW(NAMIND('ASIM'))
      IPERIOD = ITABL(JASIM,1,JASIYM)
C
C      Get the setup code
      IER = ADBRPN('HC',IROW,IPERIOD,JRUN,JSTUP)
C
C     Select the appropriate calibration costants for each year
      IND = MDARD(IW,LRDBIO,'HSCA',0)
      JHSCA = IW(NAMIND('HSCA'))
      IF(JHSCA.NE.0) THEN
         IRHT0C = ITABL(JHSCA,JSTUP,1)
         IRHSTD = ITABL(JHSCA,JSTUP,2)
         IRHIMC = ITABL(JHSCA,JSTUP,3)
         IF(FHCDEB)THEN
            WRITE(LOUTIO,*)'SETUP CODE  HT0C    HSTD    HIMC' 
            WRITE(LOUTIO,'(4(I8))')JSTUP,IRHT0C,IRHSTD,IRHIMC
         ENDIF
      ELSE
         IF(FHCDEB)THEN
            WRITE(LOUTIO,*)'ERROR: HCSA NOT FOUND!'
         ENDIF
         GOTO 10
      ENDIF
C
C     Calibration constants from HT0C, HSTD, HIMC
      IND = ALGTDB(LRDBIO,'HIMC',IRHIMC)
      JHIMC = IW(NAMIND('HIMC'))
      IF(JHIMC.NE.0) THEN
         DO I=1,24
            CALBA(I) = RTABL(JHIMC,1,I)
         ENDDO
         DO I=1,12
            CALEC(I) = RTABL(JHIMC,1,24+I)
         ENDDO
      ENDIF
      IND = ALGTDB(LRDBIO,'HSTD',IRHSTD)
      JHSTD = IW(NAMIND('HSTD'))
      IF(JHSTD.NE.0) THEN
         CALTBA = RTABL(JHSTD,1,1)
         CALTEC = RTABL(JHSTD,1,2)
      ENDIF
      IND = ALGTDB(LRDBIO,'HT0C',IRHT0C)
      JHT0C = IW(NAMIND('HT0C'))
      IF(JHT0C.NE.0) THEN
         CT0MCB = RTABL(JHT0C,1,1)
         CT0MCE = RTABL(JHT0C,1,3)
         CT0DAB = RTABL(JHT0C,1,2)
         CT0DAE = RTABL(JHT0C,1,4)
      ENDIF
C
C     Load HIFC (with calibration costants on FICs)
      NR = NDANR(LRDBIO,'HIFC','LE',JSTUP)
      IF (NR.EQ.0) GOTO 3
      IND = MDARD(IW,LRDBIO,'HIFC',NR)
      JHIFC = IW(NAMIND('HIFC'))
 3    IF(JHIFC.NE.0) THEN
         DO I=1,24
            CALIMB(I) = RTABL(JHIFC,1,I)
         ENDDO
         DO I=1,12
            CALIME(I) = RTABL(JHIFC,1,24+I)
         ENDDO
      ENDIF
C      
C     Load calibration constant from online monitoring
      IND = MDARD(IW,LRDBIO,'HCOL',0)
      JHCOL = IW(NAMIND('HCOL'))
      IF(JHCOL.NE.0) THEN
         CALTUB = RTABL(JHCOL,JSTUP,1)
         CALTUE = CALTUB
      ENDIF
C
 10   CONTINUE
C
c     Printout of the calibration constants
      IF(FHCDEB)THEN
         WRITE(LOUTIO,*) ' HCRDCA : Intermodule Calib Barrel'
         WRITE(LOUTIO,1) (CALBA(J),J=1,24)
         WRITE(LOUTIO,*) ' HCRDCA : Intermodule Calib Endcaps'
         WRITE(LOUTIO,1) (CALEC(J),J=1,12)
         WRITE(LOUTIO,*) ' HCRDCA : Normalizations at T=0'
         WRITE(LOUTIO,*) CT0MCB,CT0MCE,CT0DAB,CT0DAE
         WRITE(LOUTIO,*) ' HCRDCA : time dependence'
         WRITE(LOUTIO,*) CALTBA,CALTEC
         WRITE(LOUTIO,*) ' HCRDCA : Online Intermodule Calib Barrel'
         WRITE(LOUTIO,1) (CALIMB(J),J=1,24)
         WRITE(LOUTIO,*) ' HCRDCA : Online Intermodule Calib Endcaps'
         WRITE(LOUTIO,2) (CALIME(J),J=1,12)
         WRITE(LOUTIO,*) ' HCRDCA : Online Monitoring Constant'
         WRITE(LOUTIO,*) CALTUB
         WRITE(LOUTIO,*) ' '
      ENDIF
C
 1    FORMAT(6(2X,F8.4))
 2    FORMAT(4(2X,F8.4))
C
      RETURN
      END
#endif
@
