head	1.2;
access;
symbols
	gal309_3:1.2
	gal309_2:1.2
	gal309_1:1.2
	gal309:1.2
	gal308_2:1.2
	gal308_1:1.2
	gal308:1.2
	gal307_2:1.2
	gal307_1:1.2
	gal307:1.2
	gal306_3:1.2
	gal306_2:1.2
	gal306_1:1.2
	gal306:1.2
	gal305_3:1.2
	gal305_2:1.2
	gal305_1:1.2
	gal305:1.2
	gal304_11:1.2
	gal304_10:1.2
	gal304_9:1.2
	gal304_8:1.2
	gal304_7:1.2
	gal304_6:1.2
	gal304_5:1.2
	gal304_4:1.2
	gal304_3:1.2
	gal304_2:1.2
	gal304_1:1.2
	gal304:1.2
	gal303_3:1.2
	gal303_2:1.2
	gal303_1:1.2
	v-303:1.2
	gal302_2:1.2
	flr:1.1.1;
locks; strict;
comment	@c @;


1.2
date	95.06.29.16.22.31;	author flr;	state Exp;
branches;
next	1.1;

1.1
date	94.12.07.14.02.19;	author flr;	state Exp;
branches
	1.1.1.1;
next	;

1.1.1.1
date	94.12.07.14.02.20;	author flr;	state Exp;
branches;
next	;


desc
@@


1.2
log
@release galeph 302
 Modified files:
 gadoc.doc itdoc.doc
 adinit.F adrz.F adview.F adxy.F gaxeph.F
 ecasig.F ecbook.F ecdigi.F echit.F ecirun.F ecista.F ecnami.F
 ectrig.F ecwsum.F edfilh.F edinip.F edtadj.F edtain.F edtcor.F
 edtcut.F edtdig.F edtono.F edtrgi.F edtzsu.F edwbru.F edwdgt.F
 ehbari.F ehcutg.F eprimi.F
 galeph.F qnext.F
 agbeam.F agchck.F agcoil.F agecal.F agecpm.F ageome.F aggean.F
 aghcal.F agitch.F aglcal.F agmate.F agmedi.F agmuch.F agquad.F
 agscal.F agsmba.F agtpch.F
 gstmed.F guhadr.F guphad.F gustep.F gutrak.F
 Removed Files:
 guinti.F
 aggatt.F aggord.F
@
text
@*DK hcindu
      SUBROUTINE HCINDU
C------------------------------------------------
C!  Consider effects of inductions between tubes
CKEY HCAL INDUCTION
C!      Author       : G. Iaselli  880119
C!                     F.Ranjard   920115
C!
C!      Input  Bank    : JDHCHI  McHcHits
C!                       JDHCSE  McHcTubesSegment
C!                       HWHT    McHcTubeSignal
C!
C!      Output Bank    : HWHT
C!      temporary Bank : JDHTEM
C!      Called by      : HCASIG
C!
C!
C ----------------------------------------------------
#ifndef DOC
#include "bcs.h"
#include "hcnamc.h"
#include "hcgega.h"
#include "hcsejj.h"
#include "hchijj.h"
#include "hwhtjj.h"
#include "iocom.h"
#include "hccong.h"
      PARAMETER (LTUB=320)
      DIMENSION IVET(LTUB)
#include "bmacro.h"
C  ---------------------------------------------------------------
C - return if no HWHT bank
      JHWHT=IW(NAHWHT)
      IF(JHWHT.EQ.0) RETURN
C - initialize temporary storing space
      JDHTEM = 0
      CALL WBANK(IW,JDHTEM,3*IW(JHWHT),*10)
      IW(JDHTEM+1)=LHWHTA
      IW(JDHTEM+2)=0
C
      NRHI = 1
C
      IPL0=-1
      IPOR0=-1
      NSTRE=0
      NTR=0
C?    Loop on fired tubes
      DO 90 ITUBE= 1,LROWS(JHWHT)
         ITADR=ITABL (JHWHT,ITUBE,1)
         NSEG=ITABL(JDHCHI,NRHI,JHCHTS)
         KHCSE=KROW(JDHCSE,NSEG)
C
C?    Count number of streamers
         NSTRE=0
   30    CONTINUE
         IF(NRHI.GT.LROWS(JDHCHI)) GO TO 40
         NSEG = ITABL(JDHCHI,NRHI,JHCHTS)
         ITADR1=ITABL(JDHCSE,NSEG,JHCSTA)
         IF(ITADR.NE.ITADR1) GOTO 40
         NSTRE=NSTRE+ITABL(JDHCHI,NRHI,JHCHNS)
         NRHI = NRHI+1
         GO TO 30
   40    CONTINUE
C
C?    Compute number of tubes to be fired
         CALL POISSN(NSTRE*HPINDU,NT,IER)
         IS=SIGN(1.,(RNDM(DUMMY)-.5))
C
C
         IPL=IW(KHCSE+2)
         IPOR = IW(KHCSE+4)
         IF (IPL.NE.IPL0 .OR. IPOR.NE.IPOR0)THEN
            IPL0=IPL
            IPOR0=IPOR
            IF (IPOR.EQ.LPBAR) THEN
               ITLAS = NHCTU1(IPL)
            ELSE
               ITLAS = NHCTRE
            ENDIF
C
            IF (NTR.GT.0) THEN
C            Fill the temporary bank with tubes addresses
               IF(NTR.GT.1)CALL SORTIQ(IVET,1,NTR,1)
               IF (LFRROW(JDHTEM).LT.NTR) THEN
                  IF (NTR.GT.50) THEN
                     CALL ALTELL ('HCINDU: POISSN is corrupted-STOP',0,
     &                            'END')
                  ENDIF
                  CALL WBANK (IW,JDHTEM,IW(JDHTEM)+50,*10)
               ENDIF
               KHTEM = KNEXT(JDHTEM)
               CALL UCOPY(IVET,IW(KHTEM+1),NTR)
               IW(JDHTEM+2)=LROWS(JDHTEM) + NTR
               NTR=0
            ENDIF
C
         ENDIF
C
         ITEM=MOD(ITADR,1000)
         MTEM = (ITEM-1) / ITLAS
         NEW = 0
C     fill IVET but suppress double tube addresses
         DO 80 IT=1,NT+1
            JADR=ITADR+IS*(IT-1)
            DO 60 NV=1,NTR
               IF(JADR.EQ.IVET(NV)) GO TO 80
   60       CONTINUE
            ITUL=ITEM+IS*(IT-1)
            MTUL = (ITUL-1) / ITLAS
            IF (ITUL.GE.1.AND.MTUL.EQ.MTEM)THEN
               NEW=NEW+1
               IVET(NTR+NEW)=JADR
            ENDIF
   80    CONTINUE
         NTR = NTR + NEW
   90 CONTINUE
C - copy last set of tube addresses into the temporary buffer
      IF (NTR.GT.0) THEN
C       Fill the temporary bank with tubes addresses
         IF(NTR.GT.1)CALL SORTIQ(IVET,1,NTR,1)
         IF (LFRROW(JDHTEM).LT.NTR) THEN
            CALL WBANK (IW,JDHTEM,IW(JDHTEM)+50,*10)
         ENDIF
         KHTEM = KNEXT(JDHTEM)
         CALL UCOPY(IVET,IW(KHTEM+1),NTR)
         IW(JDHTEM+2)=LROWS(JDHTEM) + NTR
      ENDIF
C
C - copy the temporary buffer into HWHT
      CALL WBANK(IW,JDHTEM,IW(JDHTEM+1)*IW(JDHTEM+2)+LMHLEN,*10)
      CALL BKFRW(IW,'HWHT',0,IW,JDHTEM,*10)
      CALL WDROP(IW,JDHTEM)
      RETURN
C
C - not enough space to book temporary space
   10 CONTINUE
      CALL ALTELL('HCINDU:not enough space to book JDHTEM ',1,'NEXT')
      END
#endif
@


1.1
log
@Initial revision
@
text
@d17 2
a18 1
C ---------------------------------------------------------------
@


1.1.1.1
log
@import galeph 300
@
text
@@
