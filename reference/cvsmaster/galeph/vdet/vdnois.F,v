head	1.1;
branch	1.1.1;
access;
symbols
	gal309_3:1.1.1.1
	gal309_2:1.1.1.1
	gal309_1:1.1.1.1
	gal309:1.1.1.1
	gal308_2:1.1.1.1
	gal308_1:1.1.1.1
	gal308:1.1.1.1
	gal307_2:1.1.1.1
	gal307_1:1.1.1.1
	gal307:1.1.1.1
	gal306_3:1.1.1.1
	gal306_2:1.1.1.1
	gal306_1:1.1.1.1
	gal306:1.1.1.1
	gal305_3:1.1.1.1
	gal305_2:1.1.1.1
	gal305_1:1.1.1.1
	gal305:1.1.1.1
	gal304_11:1.1.1.1
	gal304_10:1.1.1.1
	gal304_9:1.1.1.1
	gal304_8:1.1.1.1
	gal304_7:1.1.1.1
	gal304_6:1.1.1.1
	gal304_5:1.1.1.1
	gal304_4:1.1.1.1
	gal304_3:1.1.1.1
	gal304_2:1.1.1.1
	gal304_1:1.1.1.1
	gal304:1.1.1.1
	gal303_3:1.1.1.1
	gal303_2:1.1.1.1
	gal303_1:1.1.1.1
	v-303:1.1.1.1
	gal302_2:1.1.1.1
	flr:1.1.1;
locks; strict;
comment	@c @;


1.1
date	94.12.07.14.02.56;	author flr;	state Exp;
branches
	1.1.1.1;
next	;

1.1.1.1
date	94.12.07.14.02.57;	author flr;	state Exp;
branches;
next	;


desc
@@



1.1
log
@Initial revision
@
text
@*DK vdnois
      SUBROUTINE VDNOIS(IMOD)
C!----------------------------------------------------------------------
C! Generate noise on fired strips
C! noise outside of hits not implemented yet
C!
C!  Author         A. Bonissent 15-Jan-1994
C!
C!  Description
C!  ===========
C!  Algorithm copied from VDNOFS from P. Cattaneo :
C!  Compute electronic noise for fired readout channel
C!  and their neighbours, but no more than once per channel
C!  then, compute the noise on each channel due to capacitive couplings
C!  Finally, compute the parallel noise for each channel where there is
C!  signal
C!
C! Input :  VWC1, VWC2 banks
C! Input :  Module number
C! Output : VWC1, VWC2 banks
C!
C-----------------------------------------------------------------------
C
#ifndef DOC
      SAVE NAVWCX
C
      DIMENSION NBCLN(2),NVDCR(2),VDSLP(2),VDPAL(2),VDELC(2)
      DIMENSION MXCNO(2),MXCSI(2),VELGV(2),VDLCO(2),IOFSET(2),NBITSH(2)
      DIMENSION NAVWCX(2)
      PARAMETER (ICDIM=10)
      DIMENSION CCOEF(2,0:ICDIM),MXCPL(2),COEFN(2,ICDIM)
      DIMENSION MUXL(2),MAXC(2)
      DIMENSION MAXS(2),ISOFF(2),IPICH(2),CSTRP(2)
#include "vwc1jj.h"
#include "bcs.h"
      LOGICAL FIRST
      DATA FIRST /.TRUE./
#include "bmacro.h"

      IF(FIRST)THEN
        FIRST=.FALSE.
        NAVWCX(1) = NAMIND('VWC1')
        NAVWCX(2) = NAMIND('VWC2')
      ENDIF
C
C Get some module quantities
C
      CALL VFNDMP
     $   (IMOD,MAXS,IPICH,MAXC,MUXL,CCOEF,
     $   COEFN,CSTRP,ICDIM,MXCPL)
C
C Get electronic constants
C
      CALL VFNDEL
     $   (IMOD,NBCLN,NVDCR,VDSLP,VDPAL,VDELC,
     $    MXCSI,MXCNO,VELGV,VDLCO,IOFSET,NBITSH)
C
C  Loop on 2 views
C
      DO 100 IV=1,2
C
C First, compute the correlated noise :
C
        KVWCX = IW(NAVWCX(IV))
C
C skip in case of nonexistent bank
C
        IF(KVWCX.EQ.0)GO TO 100
C
        NVWCX = LROWS(KVWCX)
C
C For each readout channel
C     If there is signal then
C       loop over 9 neighbours
C       For each neighbour
C         If no signal in second column of VWCX bank then
C           Compute series noise from random number
C           put it in second column of VWCX bank
C         Endif
C       end neighbours
C     Endif
C
        DO 10 IVWCX = 1,NVWCX
          SIG = RTABL(KVWCX,IVWCX,JVWCCC)
          IF(SIG.NE.0)THEN
            NNEIG = NBCLN(IV)
C
C Minimum and maximum readout channels for this strip
C
          IMIN = MAX(IVWCX - NNEIG,1)
          IMAX = MIN(IVWCX + NNEIG,NVWCX)
C
            DO 11 INEIG=IMIN,IMAX
              SERN = RTABL(KVWCX,INEIG,JVWCSN)
              IF(SERN.EQ.0)THEN
                CALL RANNOR(RDM,DUM)
C
C Compute the noise due to the amplifier on this strip.
C This is a voltage (expressed in e/pf)
C
                RW(KROW(KVWCX,INEIG)+JVWCSN) =
     $            VDSLP(IV)*RDM
              ENDIF
 11         CONTINUE
          ENDIF
 10     CONTINUE
C
C For each readout channel
C     If there is noise in second column then
C        Channel noise = Vdot(noise(channel-2),coefficients,NVDCR(=5))
C        Channel signal = channel signal + channel noise
C     endif
C Endloop
C
        DO 20 IVWCX = 1,NVWCX
          CNOI = RTABL(KVWCX,IVWCX,JVWCSN)
          IF(CNOI.NE.0)THEN
            DO 21 INEIG=1,NVDCR(IV)
              SOLD = RTABL(KVWCX,IVWCX,JVWCCC)
              IF (IVWCX-INEIG .GT. 0) THEN
                SNM = RTABL(KVWCX,IVWCX-INEIG,JVWCSN)
              ELSE
                SNM = 0.0
              ENDIF
              IF (IVWCX+INEIG .LE. NVWCX) THEN
                SNP = RTABL(KVWCX,IVWCX+INEIG,JVWCSN)
              ELSE
                SNP = 0.0
              ENDIF
              RW(KROW(KVWCX,IVWCX)+JVWCCC) = SOLD+
     $           (SNM+SNP)*COEFN(IV,INEIG)*VELGV(IV)
 21         CONTINUE
C
C Now, compute the contribution to the strip itself
C This is (like above) voltage multiplied by strip capacitance,
C then transformed into Gev
C
            RW(KROW(KVWCX,IVWCX)+JVWCCC) = RTABL(KVWCX,IVWCX,JVWCCC)+
     >                                     RTABL(KVWCX,IVWCX,JVWCSN)*
     >                                     CSTRP(IV)*VELGV(IV)
          ENDIF
 20     CONTINUE
C
C parallel noise
C For each readout channel
C     If there is signal in first column
C        compute random noise for the channel
C        add it to signal in first column
C     endif
C Endloop
C
        DO 30 IVWCX = 1,NVWCX
          SIG = RTABL(KVWCX,IVWCX,JVWCCC)
          IF(SIG.NE.0)THEN
            CALL RANNOR(RDM,DUM)
            RW(KROW(KVWCX,IVWCX)+JVWCCC) = SIG +
     $         VDPAL(IV)*RDM*VELGV(IV)
          ENDIF
 30     CONTINUE
 100  CONTINUE
      RETURN
      END
#endif
@


1.1.1.1
log
@import galeph 300
@
text
@@
