head	1.5;
access;
symbols
	gal309_3:1.5
	gal309_2:1.4
	gal309_1:1.4
	gal309:1.4
	gal308_2:1.3
	gal308_1:1.3
	gal308:1.3
	gal307_2:1.3
	gal307_1:1.3
	gal307:1.3
	gal306_3:1.3
	gal306_2:1.3
	gal306_1:1.3
	gal306:1.3
	gal305_3:1.3
	gal305_2:1.3
	gal305_1:1.3
	gal305:1.3
	gal304_11:1.3
	gal304_10:1.3
	gal304_9:1.3
	gal304_8:1.3
	gal304_7:1.3
	gal304_6:1.3
	gal304_5:1.3
	gal304_4:1.3
	gal304_3:1.3
	gal304_2:1.3
	gal304_1:1.3
	gal304:1.3
	gal303_3:1.3
	gal303_2:1.3
	gal303_1:1.3
	v-303:1.2
	gal302_2:1.2
	flr:1.1.1;
locks; strict;
comment	@c @;


1.5
date	2001.06.20.06.17.18;	author flr;	state Exp;
branches;
next	1.4;

1.4
date	99.12.03.16.28.10;	author flr;	state Exp;
branches;
next	1.3;

1.3
date	96.01.25.13.45.08;	author flr;	state Exp;
branches;
next	1.2;

1.2
date	95.06.30.07.13.14;	author flr;	state Exp;
branches;
next	1.1;

1.1
date	94.12.07.14.01.44;	author flr;	state Exp;
branches
	1.1.1.1;
next	;

1.1.1.1
date	94.12.07.14.01.45;	author flr;	state Exp;
branches;
next	;


desc
@@


1.5
log
@galeph309_3 - check ADBS version no and last event during production
@
text
@*DK asijob
      SUBROUTINE ASIJOB
C ----------------------------------------------------------------------
C. - F.RANJARD - 850325
C! Job initialization
C.  Modified     B.Bloch                  May 2001
C         call ADBCHK to check against DB official production version
C. - called by   GALEPH
C. - calls       ASINIT, ASREDC, ASREAD, ASIMOD          from this .HLB
C.               ASIGEA, AGEOME, ASIPAC, USIJOB          from this . HLB
C.               AOPDBS, ADBVER                          from ALEPHLIB
C                GINIT, GPMATE, GPTMED, GPROTM, GPVOLU   from GEANT
C.               TIMED                                   from KERNLIB
C.               ADBCHK                                  from ALEPHLIB
C---------------------------------------------------------
#ifndef DOC
      SAVE
#include "iocom.h"
#include "jobcom.h"
#include "alfgeo.h"
#include "bcs.h"
#include "asimjj.h"
C ----------------------------------------------------------------------
C - Keep initial time
C
      TLIM = 3600.
      CALL TIMEST (TLIM)
      CALL TIMED(TIMEJO(1))
C
C - Initialize flags and constants
C
      CALL ASINIT
C
C - Read STEERING data cards to set necessary flags for this job
C
      CALL ASREDC
C
C - Build ASIM with date of the geometry
C
      CALL AUBOS ('ASIM',0,LASIMA+LMHLEN,JASIM,IGARB)
      IF (JASIM.EQ.0) CALL ALTELL ('ASIJOB: no space for ASIM bank',0,
     &                             'STOP')
      IW(JASIM+LMHCOL) = LASIMA
      IW(JASIM+LMHROW) = 1
      IW(JASIM+LMHLEN+JASIYM) = IDATJO
      CALL BKFMT ('ASIM','I')
C
C - Do not compress output file
C
      JCOMP = IW(NAMIND('COMP'))
      IF (JCOMP.EQ.0) THEN
         CALL AUBOS ('COMP',0,1,JCOMP,IGARB)
         IF (JCOMP.EQ.0) CALL ALTELL ('ASIJOB: no space for COMP bank',
     &                                 0,'STOP')
         IW(JCOMP+1) = INTCHA ('NONE')
      ENDIF
C
C - check coherence of data cards
C     you cannot read the KINEmatics and PROCess KINEmatics
      IF (MGETJO.NE.0 .AND. IPROJO(1).NE.0) THEN
        CALL ALTELL ('ASIJOB: GET and PROC KINE are incompatible',0,
     &                'STOP')
      ENDIF
C     check the mag.field level
      IF (ABS(ALFIEL) .GT. 20.) THEN
       WRITE(LOUTIO,*)' +++ASIJOB +++ the mag.field is greater than',
     &                ' 20KGauss. Is that normal ?'
      ENDIF
C
C     set parametrization flag and bank format
      FPARJO = ICECJO(5).EQ.2
      IF (FPARJO) CALL BKFMT ('CAPA','4I,F')
C
C - print geometry date
C
      WRITE (LOUTIO,*)' +++ASIJOB+++ geometry date ', IDATJO
C
C - Open DAF file
C
      LRDBIO = JUNIDB(0)
      TFILIO(4) = ' '
      CALL AOPDBS (TFILIO(4),IRETD)
      IF (IRETD.NE.0) THEN
        CALL AWERRC (LOUTIO,'AOPDBS',TFILIO(4),IRETD)
        CALL ALTELL('ASIJOB :DB not found reported by AOPDBS ',
     &        0,'STOP')
      ENDIF
      CALL ADBVER(IDAFJO,IDCHJO)
      call adbchk(idafjo)   ! check on version # for official prod
      IF (IDAFJO.LT.300) THEN
         WRITE(LOUTIO,*)' +++ASIJOB+++ DB ',IDAFJO,
     &   ' is NOT Y2K compliant - please use DB >= 300'
         CALL ALTELL('ASIJOB : DB not Y2K compliant ',0,'STOP')
      ENDIF 
C
C - read run record and get  the run #, PART, GDEC, ASIM banks
C
      CALL ASREAD
C
C - Initialize GEANT3 and get the GEANT version #
C
      CALL GINIT
C
C - Initialize various modules (detectors, trigger) depending on
C   the run # and the GEANT version #.
C
      CALL ASIMOD
C
C - Interface to GEANT3 : set GEANT3 flags
C
      CALL ASIGEA
C
C - Build the geometry in GEANT3
C
      CALL AGEOME
C
C - Initialize various packages used during this run
C
      CALL ASIPAC
C
C - print out materials , media , rotation matrices ,volumes
C
      IF (IPRIJO(19).EQ.1) THEN
        CALL GPMATE(0)
        CALL GPTMED(0)
        CALL GPROTM(0)
        CALL GPVOLU(0)
      ENDIF
C
C - write run record if required
C
      CALL ASIRUN
C
C - Call USER routine
      CALL USIJOB
C
      RETURN
      END
#endif
@


1.4
log
@gal309 - STOP if DB<300
@
text
@d6 2
d14 1
a14 1
C.
d89 1
@


1.3
log
@put a ifndef DOC in gdray
modify WRITE statment to please fpp on alpha/vms
 Modified Files:
 	catino.F
	agchck.F
 	gdray.F
 	hchist.F hcshow.F hcstat.F hnewtk.F
 	lcasig.F
	sabook.F sahist.F sahit.F sawsum.F
 	siasig.F sidfrt.F sishow.F sitrak.F
 	asfxxx.F asijob.F asread.F asrrun.F
@
text
@d87 5
@


1.2
log
@release galeph 302
 Modified files:
 gadoc.doc itdoc.doc
 adinit.F adrz.F adview.F adxy.F gaxeph.F
 ecasig.F ecbook.F ecdigi.F echit.F ecirun.F ecista.F ecnami.F
 ectrig.F ecwsum.F edfilh.F edinip.F edtadj.F edtain.F edtcor.F
 edtcut.F edtdig.F edtono.F edtrgi.F edtzsu.F edwbru.F edwdgt.F
 ehbari.F ehcutg.F eprimi.F
 galeph.F qnext.F
 agbeam.F agchck.F agcoil.F agecal.F agecpm.F ageome.F aggean.F
 aghcal.F agitch.F aglcal.F agmate.F agmedi.F agmuch.F agquad.F
 agscal.F agsmba.F agtpch.F
 gstmed.F guhadr.F guphad.F gustep.F gutrak.F
 cahtra.h gmacro.h lccomc.h lcnamc.h ljjpar.h siconst.h
 sigeco.h version.h
 itmsk1.F itmsk2.F itnois.F itres.F itxtlk.F
 lcadc.F lcamp.F lcasig.F lcbhab.F lcbkpr.F lcdigi.F lcfral.F
 lchit.F lcirun.F lcnami.F lcnois.F lcpad.F lcroc.F lcsamp.F
 lcsatu.F lcshow.F lcstrt.F lctrak.F lctrdi.F lctrht.F lcwire.F
 lcwsum.F lcwtri.F
 muasig.F mubook.F muirun.F muunoi.F muwsum.F
 trignews.h
 siasig.F sitrak.F siwsum.F
 asasig.F asbook.F ascjob.F ascrun.F asctra.F asevst.F asfxxx.F
 asieve.F asigea.F asijob.F asimod.F asinit.F asipac.F asirun.F
 askine.F asksin.F asktrk.F aspeve.F asprun.F asread.F asredc.F
 asreve.F asrkin.F asrtyp.F asrust.F astdeb.F astgea.F astrac.F
 astrig.F aswkin.F aswrtp.F aswsum.F
 Removed Files:
 guinti.F
 aggatt.F aggord.F
 xtrcom.h
 ecalnews.h geomnews.h lcalnews.h news.h skelnews.h vdetnews.h
@
text
@d11 1
a11 1
C.               TIMAD                                   from KERNLIB
d25 2
a26 2
      CALL TIMAST (TLIM)
      CALL TIMAD(TIMEJO(1))
d64 2
a65 2
        CALL ALTELL ('ASIJOB: the mag.field is greater than 20KGauss.
     &Is that normal ?',0,'RETURN')
d74 1
a74 1
      WRITE (LOUTIO,'(/1X,''+++ASREAD+++ geometry date '',I4)') IDATJO
@


1.1
log
@Initial revision
@
text
@d12 2
a13 1
C ---------------------------------------------------------------------
d15 1
@


1.1.1.1
log
@import galeph 300
@
text
@@
