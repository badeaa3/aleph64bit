head	1.3;
access;
symbols
	gal309_3:1.3
	gal309_2:1.3
	gal309_1:1.3
	gal309:1.2
	gal308_2:1.2
	gal308_1:1.2
	gal308:1.2
	gal307_2:1.2
	gal307_1:1.2
	gal307:1.2
	gal306_3:1.2
	gal306_2:1.2
	gal306_1:1.2
	gal306:1.2
	gal305_3:1.2
	gal305_2:1.2
	gal305_1:1.2
	gal305:1.2
	gal304_11:1.2
	gal304_10:1.2
	gal304_9:1.2
	gal304_8:1.2
	gal304_7:1.2
	gal304_6:1.2
	gal304_5:1.2
	gal304_4:1.2
	gal304_3:1.2
	gal304_2:1.2
	gal304_1:1.2
	gal304:1.2
	gal303_3:1.2
	gal303_2:1.2
	gal303_1:1.2
	v-303:1.2
	gal302_2:1.2
	flr:1.1.1;
locks; strict;
comment	@c @;


1.3
date	2000.02.01.18.00.12;	author flr;	state Exp;
branches;
next	1.2;

1.2
date	95.06.30.07.08.27;	author flr;	state Exp;
branches;
next	1.1;

1.1
date	94.12.07.14.02.34;	author flr;	state Exp;
branches
	1.1.1.1;
next	;

1.1.1.1
date	94.12.07.14.02.35;	author flr;	state Exp;
branches;
next	;


desc
@@


1.3
log
@ gal309.1 look at news/news.h for details
@
text
@*DK lcadc
      SUBROUTINE LCADC
C--------------------------------------------------------------
C! Fills banks LTDI and LWDI
C. - J.Dines Hansen & P.Hansen - 860417
C.                               modified by F.Ranjard - 890317
C.                               modified by P.H.Hansen -950202
C. - Stores digitizations for LCal towers and wireplanes in MeV
C. - Called by  LCDIGI                           from this .HLB
C -----------------------------------------------
#ifndef DOC
      SAVE
      EXTERNAL RNDM
#include "iocom.h"
#include "jobcom.h"
#include "bcs.h"
#include "lcparm.h"
#include "ljjpar.h"
#include "lcnamc.h"
#include "lccomc.h"
#include "bmacro.h"
#include "lcmacr.h"
C -------------------------------------------------------------
C
C -  Find length of the wire hit bank
      KWH = IW(NALWHT)
      IF(KWH .LE. 0)                                  GOTO 999
      NROW = LROWS(KWH)
      IF(NROW .LE. 0)                                 GOTO 999
C
C - Geometric cell-to-cell variations in percent
      KLCCA = IW(NALCCA)
C
C - Book wire digitalisation bank
      LEN = NROW*(LCNWPL+1) + LMHLEN
      CALL ALBOS ('LWDI',0,LEN,KWD,IGARB)
      IW(KWD+1) = LCNWPL+1
      IW(KWD+2) = NROW
      CALL BLIST(IW,'E+','LWDI')
      IF (IGARB.EQ.1) KWH = IW(NALWHT)
      KWS  = IW(NALCWS)
C
C - Loop over modules, storeyes and wire planes
        DO 130 MODU = 1,NROW
          IF(MODU.GE.3) THEN
            IFB=2
          ELSE
            IFB=1
          ENDIF
          KRWH = KROW(KWH,MODU)
          KRWD = KROW(KWD,MODU)
          IW(KRWD+1) = IW(KRWH+1)
          LAY = 0
          DO 120 IST = 1,3
            LAYMX = LCNLAY(IST)
            DO 110 L = 1,LAYMX
              LAY = LAY + 1
C
C - Convert plane hits to MeV
              ADCC = 1000.*ECRTLC*FLOAT(IW(KRWH+1+LAY))/16.
C
C - Apply gain variations
              ADCC = ADCC*(1.+GVARLC*(RNDM(DUMMY)-0.5))
C
C - Check saturation
              ADCC = AMIN1(ADCC,6250.)
C
C - Convert to integer MeV
              FACT = 1.
              IF(IST.EQ.3) FACT = SSTPLC(3)/SSTPLC(2)
              IW(KRWD+1+LAY) = NINT(ADCC*FACT)
C
C - Update summary bank
              IF(KWS.GT.0) THEN
                IW(KWS+LMHLEN+8+IFB) = IW(KWS+LMHLEN+8+IFB)+
     &                                 IW(KRWD+1+LAY)
              ENDIF
  110       CONTINUE
  120     CONTINUE
  130   CONTINUE
C
C -  Find length of the tower hit bank
      KTH = IW(NALTHT)
      IF(KTH .LE. 0)                                  GOTO 999
      NROW = LROWS(KTH)
      IF(NROW .LE. 0)                                 GOTO 999
C
C - Book tower digitalisation bank
      LEN = NROW*LTDIC + LMHLEN
      CALL ALBOS ('LTDI',0,LEN,KDI,IGARB)
      IW(KDI+1) = LTDIC
      IW(KDI+2) = NROW
      CALL BLIST(IW,'E+','LTDI')
      IF (IGARB.EQ.1) KTH = IW(NALTHT)
      KWS  = IW(NALCWS)
C
C - Loop over tower hits
      DO 230 ITOW = 1,NROW
        KRTH = KROW(KTH,ITOW)
        KRDI = KROW(KDI,ITOW)
C - Store address
        IADDR = IW(KRTH+1)
        IW(KRDI+1) = IADDR
C - Decode cell address
        IROW = LCROW(IADDR)
        ICOL = LCCOL(IADDR)
        MODU = LCMOD(IADDR)
        IF(IROW.GE.16) IROW = 31-IROW
C - Find geometrical gain variation
        GCORR = 1.
C        IF(KLCCA.GT.0) THEN
C          ICELL = JLCCDI - 1 + ICOL
C          GCORR = 1.+FLOAT(ITABL(KLCCA,IROW,ICELL))/100.
C        ENDIF
C
        DO 220 IST  = 1,3
C
C - Convert storey hits to MeV
          ADCC = 1000.*ECRTLC*FLOAT(IW(KRTH+1+IST))/16.
C
C - Apply gain variations and smear Ecrit quantization
          ADCC = ADCC*(1.+GVARLC*(RNDM(DUMMY)-0.5))*GCORR
C
C - Convert to integer MeV
          FACT = 1.
          IF(IST.EQ.3) FACT = SSTPLC(3)/SSTPLC(2)
          IW(KRDI+1+IST) = NINT(ADCC*FACT)
C
C - Update summary bank
          IF(KWS.GT.0) THEN
             IW(KWS+LMHLEN+6+IFB) = IW(KWS+LMHLEN+6+IFB)+
     &                              IW(KRDI+1+IST)
          ENDIF
  220   CONTINUE
  230 CONTINUE
C
C - debug
      IF (FDEBJO .AND. IPRIJO(5).NE.0) THEN
         WRITE(LOUTIO,*) ' +++LCADC+++ debug banks LTDI and LWDI '
         CALL PRTABL ('LTDI',0)
         CALL PRTABL ('LWDI',0)
      ENDIF
C
  999 RETURN
      END
#endif
@


1.2
log
@release galeph 302
 Modified files:
 gadoc.doc itdoc.doc
 adinit.F adrz.F adview.F adxy.F gaxeph.F
 ecasig.F ecbook.F ecdigi.F echit.F ecirun.F ecista.F ecnami.F
 ectrig.F ecwsum.F edfilh.F edinip.F edtadj.F edtain.F edtcor.F
 edtcut.F edtdig.F edtono.F edtrgi.F edtzsu.F edwbru.F edwdgt.F
 ehbari.F ehcutg.F eprimi.F
 galeph.F qnext.F
 agbeam.F agchck.F agcoil.F agecal.F agecpm.F ageome.F aggean.F
 aghcal.F agitch.F aglcal.F agmate.F agmedi.F agmuch.F agquad.F
 agscal.F agsmba.F agtpch.F
 gstmed.F guhadr.F guphad.F gustep.F gutrak.F
 cahtra.h gmacro.h lccomc.h lcnamc.h ljjpar.h siconst.h
 sigeco.h version.h
 itmsk1.F itmsk2.F itnois.F itres.F itxtlk.F
 lcadc.F lcamp.F lcasig.F lcbhab.F lcbkpr.F lcdigi.F lcfral.F
 lchit.F lcirun.F lcnami.F lcnois.F lcpad.F lcroc.F lcsamp.F
 lcsatu.F lcshow.F lcstrt.F lctrak.F lctrdi.F lctrht.F lcwire.F
 lcwsum.F lcwtri.F
 Removed Files:
 guinti.F
 aggatt.F aggord.F
 xtrcom.h
@
text
@a123 3
C - Check saturation
          ADCC = AMIN1(ADCC,100000.)
C
@


1.1
log
@Initial revision
@
text
@d7 1
d10 1
a10 1
C --------------------------------------------------------------
d41 1
a41 3
C
C Wires have 16 times less MeV per ADC count
      ADCW = ADCOLC/16.
d45 5
d59 2
a60 2
C - Convert plane hits to ADC counts
              ADCC = 1000.*ECRTLC*FLOAT(IW(KRWH+1+LAY))/ADCW
d63 4
a66 1
              NADC = NINT(ADCC*(1.+GVARLC*(RNDM(DUMMY)-0.5)))
d71 7
a77 1
              IW(KRWD+1+LAY) = NINT(ADCW*FLOAT(NADC)*FACT)
d95 1
d104 1
a104 1
C - Find "generic" cell
d107 1
d118 2
a119 2
C - Convert storey hits to ADC counts
          ADCC = 1000.*ECRTLC*FLOAT(IW(KRTH+1+IST))/ADCOLC
d121 1
a121 1
C - Apply gain variations
d124 3
a127 1
          NADC = NINT(ADCC)
d130 7
a136 1
          IW(KRDI+1+IST) = NINT(ADCOLC*FLOAT(NADC)*FACT)
@


1.1.1.1
log
@import galeph 300
@
text
@@
