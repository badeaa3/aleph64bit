head	1.2;
access;
symbols
	gal309_3:1.2
	gal309_2:1.2
	gal309_1:1.2
	gal309:1.2
	gal308_2:1.2
	gal308_1:1.2
	gal308:1.2
	gal307_2:1.2
	gal307_1:1.2
	gal307:1.2
	gal306_3:1.2
	gal306_2:1.2
	gal306_1:1.2
	gal306:1.2
	gal305_3:1.2
	gal305_2:1.2
	gal305_1:1.2
	gal305:1.2
	gal304_11:1.2
	gal304_10:1.2
	gal304_9:1.2
	gal304_8:1.2
	gal304_7:1.2
	gal304_6:1.2
	gal304_5:1.2
	gal304_4:1.2
	gal304_3:1.2
	gal304_2:1.2
	gal304_1:1.2
	gal304:1.2
	gal303_3:1.2
	gal303_2:1.2
	gal303_1:1.2
	v-303:1.2
	gal302_2:1.2
	flr:1.1.1;
locks; strict;
comment	@c @;


1.2
date	95.06.30.07.08.40;	author flr;	state Exp;
branches;
next	1.1;

1.1
date	94.12.07.14.02.35;	author flr;	state Exp;
branches
	1.1.1.1;
next	;

1.1.1.1
date	94.12.07.14.02.36;	author flr;	state Exp;
branches;
next	;


desc
@@


1.2
log
@release galeph 302
 Modified files:
 gadoc.doc itdoc.doc
 adinit.F adrz.F adview.F adxy.F gaxeph.F
 ecasig.F ecbook.F ecdigi.F echit.F ecirun.F ecista.F ecnami.F
 ectrig.F ecwsum.F edfilh.F edinip.F edtadj.F edtain.F edtcor.F
 edtcut.F edtdig.F edtono.F edtrgi.F edtzsu.F edwbru.F edwdgt.F
 ehbari.F ehcutg.F eprimi.F
 galeph.F qnext.F
 agbeam.F agchck.F agcoil.F agecal.F agecpm.F ageome.F aggean.F
 aghcal.F agitch.F aglcal.F agmate.F agmedi.F agmuch.F agquad.F
 agscal.F agsmba.F agtpch.F
 gstmed.F guhadr.F guphad.F gustep.F gutrak.F
 cahtra.h gmacro.h lccomc.h lcnamc.h ljjpar.h siconst.h
 sigeco.h version.h
 itmsk1.F itmsk2.F itnois.F itres.F itxtlk.F
 lcadc.F lcamp.F lcasig.F lcbhab.F lcbkpr.F lcdigi.F lcfral.F
 lchit.F lcirun.F lcnami.F lcnois.F lcpad.F lcroc.F lcsamp.F
 lcsatu.F lcshow.F lcstrt.F lctrak.F lctrdi.F lctrht.F lcwire.F
 lcwsum.F lcwtri.F
 Removed Files:
 guinti.F
 aggatt.F aggord.F
 xtrcom.h
@
text
@*DK lcfral
      SUBROUTINE LCFRAL(IFB,MODU,XIN,XOUT,DXIN)
C--------------------------------------------------------------
C! Track element coordinate tranformation
C. - J.Dines Hansen & P.Hansen - 860505
C. - Mdified P.Hansen - 900415
C. - Transform track element from global to subdetector frame
C. - Input  : TRKELE
C. - Output : MODU   = Module No. [1,4]
C.            IFB    = endcap #
C. -          XIN    = xyz of track element TRKELE
C. -          XOUT   = xyz of track element TRKNXT
C. -          DXIN   = direction cosines of TRKELE
C. - Called by  LCSHOW, LCTRAK                   from this .HLB
C -------------------------------------------------
#ifndef DOC
      SAVE
      DIMENSION XIN(*),XOUT(*),DXIN(*)
#include "bcs.h"
#include "lcnamc.h"
#include "ljjpar.h"
#include "lccomc.h"
#include "trkcom.h"
#include "bmacro.h"
C -------------------------------------------------------------
C - Define origin of module at the start of the sensitive area
      MODU=1
      IF(TRKELE(3).GT.0.) MODU=3
      IF(TRKELE(1).GT.0.) MODU=MODU+1
      IFB=(MODU-1)/2+1
C
      KLMTY = IW(NALMTY)
      KLALI = IW(NALALI)
C
C
C - Translate track element to nominal local coordinates
      DO 10 I=1,3
        XIN(I)  = TRKELE(I) - XYZOLC(I,IFB)
        IF (ITRKEL(8).NE.1) XOUT(I)  = TRKNXT(I) - XYZOLC(I,IFB)
        DXIN(I) = TRKELE(3+I)
 10   CONTINUE
C
C Alignment correction :
C  Let the local module system be translated by
C  (Oxyz+Dxyz) and rotated by Rotvec with respect to ALEPH.
C  Let ALEPH coordinates be XYZ and local coordinates xyz:
C
C  XYZ = Oxyz + Dxyz + xyz + Rotvec x xyz
C
C  We modifify the nominal xyz in the following approximate way:
C
      ZIN  = RTABL(KLMTY,1,JLMTFL)*SIGN(1.,XIN(3))
     &      + XIN(3) - RTABL(KLALI,MODU,JLALDX+2)
C
      DXIN(3) = DXIN(3)-RTABL(KLALI,MODU,JLALDR+1)*DXIN(1)
     &                 +RTABL(KLALI,MODU,JLALDR)*DXIN(2)
      DXIN(1) = DXIN(1)
     &               - RTABL(KLALI,MODU,JLALDR+2)*DXIN(2)
     &               + RTABL(KLALI,MODU,JLALDR+1)*DXIN(3)
C
      DXIN(2) = DXIN(2)
     &               - RTABL(KLALI,MODU,JLALDR)*DXIN(3)
     &               + RTABL(KLALI,MODU,JLALDR+2)*DXIN(1)
C
C
      XIN(1) = XIN(1) - RTABL(KLALI,MODU,JLALDX)
     &                - RTABL(KLALI,MODU,JLALDR+2)*XIN(2)
     &                + RTABL(KLALI,MODU,JLALDR+1)*ZIN
C
      XIN(2)= XIN(2) - RTABL(KLALI,MODU,JLALDX+1)
     &               - RTABL(KLALI,MODU,JLALDR)*ZIN
     &               + RTABL(KLALI,MODU,JLALDR+2)*XIN(1)
C
      XIN(3)= XIN(3) - RTABL(KLALI,MODU,JLALDX+2)
     &               - RTABL(KLALI,MODU,JLALDR+1)*XIN(1)
     &               + RTABL(KLALI,MODU,JLALDR)*XIN(2)
C
      IF (ITRKEL(8).EQ.1) GOTO 999
C
      ZOUT = RTABL(KLMTY,1,JLMTFL)*SIGN(1.,XOUT(3))
     &      + XOUT(3) - RTABL(KLALI,MODU,JLALDX+2)
C
      XOUT(1) = XOUT(1) - RTABL(KLALI,MODU,JLALDX)
     &                - RTABL(KLALI,MODU,JLALDR+2)*XOUT(2)
     &                + RTABL(KLALI,MODU,JLALDR+1)*ZOUT
C
      XOUT(2)= XOUT(2) - RTABL(KLALI,MODU,JLALDX+1)
     &               - RTABL(KLALI,MODU,JLALDR)*ZOUT
     &               + RTABL(KLALI,MODU,JLALDR+2)*XOUT(1)
C
      XOUT(3)= XOUT(3) - RTABL(KLALI,MODU,JLALDX+2)
     &               - RTABL(KLALI,MODU,JLALDR+1)*XOUT(1)
     &               + RTABL(KLALI,MODU,JLALDR)*XOUT(2)
C
 999  CONTINUE
      END
#endif
@


1.1
log
@Initial revision
@
text
@d15 1
@


1.1.1.1
log
@import galeph 300
@
text
@@
