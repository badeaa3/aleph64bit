head	1.1;
branch	1.1.1;
access;
symbols
	gal309_3:1.1.1.1
	gal309_2:1.1.1.1
	gal309_1:1.1.1.1
	gal309:1.1.1.1
	gal308_2:1.1.1.1
	gal308_1:1.1.1.1
	gal308:1.1.1.1
	gal307_2:1.1.1.1
	gal307_1:1.1.1.1
	gal307:1.1.1.1
	gal306_3:1.1.1.1
	gal306_2:1.1.1.1
	gal306_1:1.1.1.1
	gal306:1.1.1.1
	gal305_3:1.1.1.1
	gal305_2:1.1.1.1
	gal305_1:1.1.1.1
	gal305:1.1.1.1
	gal304_11:1.1.1.1
	gal304_10:1.1.1.1
	gal304_9:1.1.1.1
	gal304_8:1.1.1.1
	gal304_7:1.1.1.1
	gal304_6:1.1.1.1
	gal304_5:1.1.1.1
	gal304_4:1.1.1.1
	gal304_3:1.1.1.1
	gal304_2:1.1.1.1
	gal304_1:1.1.1.1
	gal304:1.1.1.1
	gal303_3:1.1.1.1
	gal303_2:1.1.1.1
	gal303_1:1.1.1.1
	v-303:1.1.1.1
	gal302_2:1.1.1.1
	flr:1.1.1;
locks; strict;
comment	@c @;


1.1
date	94.12.07.14.02.25;	author flr;	state Exp;
branches
	1.1.1.1;
next	;

1.1.1.1
date	94.12.07.14.02.26;	author flr;	state Exp;
branches;
next	;


desc
@@



1.1
log
@Initial revision
@
text
@*DK isbend
      SUBROUTINE ISBEND(Z, ZM)
C.
C...ISBEND  2.00  920213  18:59                        R.Beuselinck
C.
C!  Calculate apparent measured Z with non-linear S-bend parameters.
C.
C.  Arguments:
C.  Z   [S,I,REAL] : Z coordinate on ITC wire (cm).
C.  ZM  [S,O,REAL] : "Measured Z" from inverting S-bend relation.
C.
C.  The measured Z is computed according to an interpolation
C.  table generated from the parametrisation of Z = F(ZM) of the form
C.           Z = S1*ZM + S2*SIN(2*Pi/S3 * ZM)
C.  where S1,S2,S3 are the "S-bend" coefficients from the IZNL bank.
C.  This routine must be initialised by first calling ISBGIN.
C.
C-----------------------------------------------------------------------
#ifndef DOC
      SAVE
#include "alcons.h"
      REAL TDIF(101), Z, ZMIN, ZBIN, ZMAX, DZ, ZM, S1, S2, S3
      REAL FLZ, PRED, AA, BB, CC, DD, EE, T1, T2, TT, Z1, Z2, ZZ, TOLZ
      REAL SA, SB, SC, ZWANT
      INTEGER IZB, I
C
C--  Statement functions for parametrization and interpolation.
C--
      FLZ(AA,SA,SB,SC) = SA*AA + SB*SIN(TWOPI*AA/SC)
      PRED(AA,BB,CC,DD,EE) = EE + (DD-EE)*(CC-BB)/(AA-BB)
C
      IF (Z .EQ. ZMIN) THEN
         ZM = TDIF(1)
      ELSEIF (Z.EQ.-ZMIN) THEN
         ZM = TDIF(101)
      ELSE
         IZB = (Z - ZMIN)/ZBIN + 1
         DZ = Z - ZMIN - (IZB - 1)*ZBIN
         ZM = (TDIF(IZB+1) - TDIF(IZB))*DZ/ZBIN + TDIF(IZB)
      ENDIF
      RETURN
#endif
      ENTRY ISBGIN(ZMAX, S1, S2, S3)
C.
C...ISBGIN  2.00  920213  19:13                        R.Beuselinck
C.
C!  Setup lookup table for inverse S-bend parametrisation.
C.
C.  Arguments:
C.  ZMAX  [S,I,REAL] : Maximum Z coordinate to interpolate.
C.  S1    [S,I,REAL] : S-bend parameter 1.
C.  S2    [S,I,REAL] : S-bend parameter 2.
C.  S3    [S,I,REAL] : S-bend parameter 3.
C.
C.  The input S-bend parameters describe the non-linearity of time
C.  difference measured as a function of Z along the ITC wires.
C.  This routine computes the true Z for a set of equally spaced
C.  measured Z positions along the wires which are then used for a fast
C.  interpolation of the inverse function, i.e. Zmease as a function
C.  of Ztrue.
C.  This routine is the initialisation entry point for ISBEND.
C.
C.  NB: This routine used to work in terms of time difference rather
C.  than measured Z, so the variables T1, T2, TT, TDIF should now
C.  be understood as referring to measured Z values.
C.
C-----------------------------------------------------------------------
#ifndef DOC
      ZMIN = -ZMAX
      ZBIN = (ZMAX - ZMIN)/100.
      TOLZ = ZBIN/100.
C
C--  Loop over values of Zm required for interpolation table and seek
C--  a Zt value using a search technique.
C--
      DO 100 I=1,101
        ZWANT = ZMIN + (I-1)*ZBIN
        T1 = 1.5*ZMAX
        T2 = -T1
        Z1 = FLZ(T1,S1,S2,S3)
        Z2 = FLZ(T2,S1,S2,S3)
   10   TT = PRED(Z1,Z2,ZWANT,T1,T2)
        ZZ = FLZ(TT,S1,S2,S3)
        IF (ABS(ZZ-ZWANT).LE.TOLZ) THEN
          TDIF(I) = TT
        ELSE IF (ZZ.GT.ZWANT) THEN
          Z1 = ZZ
          T1 = TT
          GO TO 10
        ELSE
          Z2 = ZZ
          T2 = TT
          GO TO 10
        ENDIF
  100 CONTINUE
      END
#endif
@


1.1.1.1
log
@import galeph 300
@
text
@@
