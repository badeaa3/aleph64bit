head	1.3;
access;
symbols
	gal309_3:1.3
	gal309_2:1.3
	gal309_1:1.3
	gal309:1.3
	gal308_2:1.3
	gal308_1:1.3
	gal308:1.3
	gal307_2:1.3
	gal307_1:1.3
	gal307:1.3
	gal306_3:1.3
	gal306_2:1.3
	gal306_1:1.3
	gal306:1.3
	gal305_3:1.3
	gal305_2:1.3
	gal305_1:1.3
	gal305:1.3
	gal304_11:1.3
	gal304_10:1.3
	gal304_9:1.3
	gal304_8:1.3
	gal304_7:1.3
	gal304_6:1.3
	gal304_5:1.3
	gal304_4:1.3
	gal304_3:1.3
	gal304_2:1.3
	gal304_1:1.3
	gal304:1.3
	gal303_3:1.3
	gal303_2:1.3
	gal303_1:1.3
	v-303:1.3
	gal302_2:1.3
	flr:1.1.1;
locks; strict;
comment	@c @;


1.3
date	95.06.30.07.06.07;	author flr;	state Exp;
branches;
next	1.2;

1.2
date	95.02.06.15.19.55;	author algal;	state Exp;
branches;
next	1.1;

1.1
date	94.12.07.14.02.29;	author flr;	state Exp;
branches
	1.1.1.1;
next	;

1.1.1.1
date	94.12.07.14.02.30;	author flr;	state Exp;
branches;
next	;


desc
@@


1.3
log
@release galeph 302
 Modified files:
 gadoc.doc itdoc.doc
 adinit.F adrz.F adview.F adxy.F gaxeph.F
 ecasig.F ecbook.F ecdigi.F echit.F ecirun.F ecista.F ecnami.F
 ectrig.F ecwsum.F edfilh.F edinip.F edtadj.F edtain.F edtcor.F
 edtcut.F edtdig.F edtono.F edtrgi.F edtzsu.F edwbru.F edwdgt.F
 ehbari.F ehcutg.F eprimi.F
 galeph.F qnext.F
 agbeam.F agchck.F agcoil.F agecal.F agecpm.F ageome.F aggean.F
 aghcal.F agitch.F aglcal.F agmate.F agmedi.F agmuch.F agquad.F
 agscal.F agsmba.F agtpch.F
 gstmed.F guhadr.F guphad.F gustep.F gutrak.F
 cahtra.h gmacro.h lccomc.h lcnamc.h ljjpar.h siconst.h
 sigeco.h version.h
 itmsk1.F itmsk2.F itnois.F itres.F itxtlk.F
 Removed Files:
 guinti.F
 aggatt.F aggord.F
 xtrcom.h
@
text
@*DK itmsk1
      SUBROUTINE ITMSK1(MASI, IB16, LBUS)
C.
C...ITMSK1  1.00  860518  22:46                     R.Beuselinck
C.
C!  Map the ITC trigger segments onto the 18 bus-lines.
C.  This is the first stage in correlating the ITC trigger to the
C.  calorimeter trigger segments.
C.  To understand this routine you need to look at the curcuit diagram.
C.
C.  Calling arguments:
C.  MASI - Array containing the results of the 48 ITC phi masks  (INPUT)
C.  IB16 - Word containing the 16 software controllable bits.    (INPUT)
C.  LBUS - Word containing the 18 bit bus-line mask.            (OUTPUT)
C.
C-----------------------------------------------------------------------
#ifndef DOC
      INTEGER MASI(48), IB16, IMI(4), IMB(4), I, J, MASK, IAND, IOR
      INTEGER IBT16, LBUS
      INTEGER IAM(12), IAM1(12), IAM2(12), IAM3(12), IAM4(12)
C
C
C--  IMI and IMB are masks for the initial combination of the 48
C--  input sector bits with the 16 software-selectable bits.
C--
#if defined(IBM)
      DATA IMI/ZF,ZF0,ZF00,ZF000/
      DATA IMB/Z1111,Z2222,Z4444,Z8888/
#else
      DATA IMI/15,240,3840,61440/
      DATA IMB/4369,8738,17476,34952/
#endif
C
C--  IAM and IAMn represent the fan-out of the bits resulting from
C--  the initial AND.  When the appropriate bits are set the following
C--  bit patterns are mapped onto the 18-bit bus line mask.
C--
#if defined(IBM)
      DATA IAM/Z3,Z6,Z18,Z30,ZC0,Z180,Z600,ZC00,Z3000,Z6000,Z18000,
     +Z30000/
      DATA IAM1/Z10000,Z10000,Z2,Z2,Z10,Z10,Z80,Z80,Z400,Z400,Z2000,
     +Z2000/
      DATA IAM2/Z20000,Z1,Z4,Z8,Z20,Z40,Z100,Z200,Z800,Z1000,Z4000,
     +Z8000/
      DATA IAM3/Z10,Z10,Z80,Z80,Z400,Z400,Z2000,Z2000,Z10000,Z10000,Z2,
     +Z2/
      DATA IAM4/Z4,Z8,Z20,Z40,Z100,Z200,Z800,Z1000,Z4000,Z8000,Z20000,
     +Z1/
#else
      DATA IAM/3,6,24,48,192,384,1536,3072,12288,24576,98304,196608/
      DATA IAM1/65536,65536,2,2,16,16,128,128,1024,1024,8192,8192/
      DATA IAM2/131072,1,4,8,32,64,256,512,2048,4096,16384,32768/
      DATA IAM3/16,16,128,128,1024,1024,8192,8192,65536,65536,2,2/
      DATA IAM4/4,8,32,64,256,512,2048,4096,16384,32768,131072,1/
#endif
C ------------------------------------------------------------------
C
C--  Loop over twelve identical curcuits.  The 48 ITC sectors are
C--  reduced to 12 phi sectors.  For each one of these there are also
C--  4 "side-bits" which may be set to activate adjacent sectors.
C--  The side-bits are controlled by a pattern of 16 software loadable
C--  bits specified by IB16.
C--
      LBUS = 0
      DO 10 I=1,12
        MASK = 0
        J = (I-1)*4
        IF (MASI(J+1).NE.0) MASK = MASK + IMI(1)
        IF (MASI(J+2).NE.0) MASK = MASK + IMI(2)
        IF (MASI(J+3).NE.0) MASK = MASK + IMI(3)
        IF (MASI(J+4).NE.0) MASK = MASK + IMI(4)
        IBT16 = IAND(MASK,IB16)
        IF (MASK.NE.0) LBUS = IOR(IAM(I),LBUS)
        IF (IAND(IMB(1),IBT16).NE.0) LBUS = IOR(IAM1(I),LBUS)
        IF (IAND(IMB(2),IBT16).NE.0) LBUS = IOR(IAM2(I),LBUS)
        IF (IAND(IMB(3),IBT16).NE.0) LBUS = IOR(IAM3(I),LBUS)
        IF (IAND(IMB(4),IBT16).NE.0) LBUS = IOR(IAM4(I),LBUS)
   10 CONTINUE
      END
#endif
@


1.2
log
@remove include BMACRO
equivalence (NAPART,NAPAR) to cope with KMACRO
je ne sais plus
@
text
@d26 4
a29 4
      SAVE IMI, IMB
      SAVE IAM, IAM1, IAM2, IAM3, IAM4
C      DATA IMI/ZF,ZF0,ZF00,ZF000/
C      DATA IMB/Z1111,Z2222,Z4444,Z8888/
d32 1
d38 12
a49 10
C      DATA IAM/Z3,Z6,Z18,Z30,ZC0,Z180,Z600,ZC00,Z3000,Z6000,Z18000,
C     +Z30000/
C      DATA IAM1/Z10000,Z10000,Z2,Z2,Z10,Z10,Z80,Z80,Z400,Z400,Z2000,
C     +Z2000/
C      DATA IAM2/Z20000,Z1,Z4,Z8,Z20,Z40,Z100,Z200,Z800,Z1000,Z4000,
C     +Z8000/
C      DATA IAM3/Z10,Z10,Z80,Z80,Z400,Z400,Z2000,Z2000,Z10000,Z10000,Z2,
C     +Z2/
C      DATA IAM4/Z4,Z8,Z20,Z40,Z100,Z200,Z800,Z1000,Z4000,Z8000,Z20000,
C     +Z1/
d55 2
@


1.1
log
@Initial revision
@
text
@a51 1
#include "bmacro.h"
@


1.1.1.1
log
@import galeph 300
@
text
@@
