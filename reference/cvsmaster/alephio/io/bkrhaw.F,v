head	1.1;
access;
symbols
	alio83:1.1
	alio82:1.1
	alio81:1.1
	alio80:1.1
	alio74:1.1
	alio73:1.1
	alio72:1.1
	alio71:1.1
	alio70:1.1
	alio68:1.1
	alio69:1.1
	alio67:1.1
	alio66:1.1
	alio65:1.1
	alio64:1.1
	alio63:1.1
	alio62:1.1
	alio61:1.1
	alio60:1.1;
locks; strict;
comment	@c @;


1.1
date	96.04.23.10.00.33;	author flr;	state Exp;
branches;
next	;


desc
@@


1.1
log
@move alph, dbas, a part of alef and a part of c to alephio
Modified Files:
 	version.h
 Added Files:
 	adbrow.F adbrpn.F adbrun.F adbswp.F adbver.F agetdb.F agtfil.F
	albos.F aldawr.F aldtyp.F aleveh.F alfind.F alfmt.F algtbk.F
 	algtdb.F algtlu.F algtro.F algtyp.F alinst.F alk7fil.F
 	alk7fru.F alk7op.F alk7tru.F alredb.F alrune.F alrunh.F
 	alrunr.F alseed.F alstho.F alstin.F alstri.F altabl.F alvsn.F
 	aopdbs.F aublis.F aubos.F aubprs.F bkcari.F bkinca.F bkrhab.F
 	bkrhal.F bkrhaw.F bktobk.F cafiht.F chahol.F dafrds.F gtdbas.F
 	gtstup.F igtfmt.F jhocha.F julrec.F junial.F junidb.F
 	kbytrec.F loctab.F nameru.F ubpack.F uclean.F uindxs.F usbos.F
 	usgtdb.F utcblk.F utccop.F utcofo.F utwocl.F utwoex.F
Removed Files:
	noibm.F
@
text
@      SUBROUTINE BKRHAW(PRNAM,IPVER,ICVER,NATOU,IFAIL)
C-----------------------------------------------------------------------
C! Fills the RHAH bank ( Run Header Analysis History )
CKEY BOOK RUN HEADER / INTERNAL
C  Called at each beginning of run , in JULIA or ALPHA  ,
C  for each output stream
C  Calls BKRHAB,BKRHAL                              from ALEPHLIB
C  Calls BKFMT                                      from BOS77
C Author     J. Boucrot  25-Sep-1988  , modified 02-Feb-1989
C Input arguments :
C   PRNAM = Name of the calling program : JULIA , ALPHA
C   IPVER = Version number of the calling program
C   ICVER = Correction set version number
C   NATOU = Code for the nature of what is being written :
C              3 = POT           4 = DST           5 = MiniDST
C              6 = MicroDST      7 = NanoDST
C Output argument :
C   IFAIL = 0 if all OK
C         = 1 if RHAH bank could not be booked / enlarged
C         = 2 if no RUNH bank , or wrong input arguments
C Input bank needed :  RUNH
C Modified: P. Comas  8-JUN-1994, change RHAH format so that last word
C                                 is character to store the computer type.
C ----------------------------------------------------------------------
#ifndef DOC
      SAVE
#include "bcs.h"
#include "rhahjj.h"
#include "runhjj.h"
      COMMON / NAMRHA / NARHAH,NARHOH,NARUNH,NAAJOB,
     +                  NAKJOB,NAKRUN
      EXTERNAL NAMIND
      CHARACTER LIST*1,LISTA*2,LISTW*2,PRNAM*8
      CHARACTER*4 NAMD(5)
      PARAMETER  ( IPOT = 3 , INANO = 7 , ISEL = 10 )
      LOGICAL FIRST
      DATA NAMD / 'POT ' , 'DST ' , 'MINI' , 'MICR' , 'NANO' /
      DATA FIRST / .TRUE. /
      DATA  IOLR  / -1  /
#include "bmacro.h"
C-----------------------------------------------------------------------
C Define 'RHAH' format , and Namindices on first call :
        IF (FIRST) THEN
           FIRST=.FALSE.
           CALL BKFMT('RHAH','2I,(2A,9I,A)')
           NARHAH=NAMIND('RHAH')
           NARHOH=NAMIND('RHOH')
           NARUNH=NAMIND('RUNH')
           NAAJOB=NAMIND('AJOB')
           NAKJOB=NAMIND('KJOB')
           NAKRUN=NAMIND('KRUN')
        ENDIF
C Check input parameters and bank :
        IFAIL=2
        INDN=MOD(NATOU,ISEL)
        IF (INDN.LT.IPOT.OR.INDN.GT.INANO) GO TO 999
C Use 'RUNR' if 'RUNH' absent :
        JRUNH=IW(NARUNH)
        IF (JRUNH.GT.0) THEN
           NRUN=IW(JRUNH+JRUNRN)
        ELSE
           JRUNR=IW(NAMIND('RUNR'))
           IF (JRUNR.EQ.0) GO TO 999
           NRUN=IW(JRUNR+2)
        ENDIF
        INDX=INDN-IPOT+1
        IFAIL=1
C
C When JULIA reads a RAW data tape or a GALEPH output , the RHAH bank
C doesn't exist. It must be created on first call of this routine
C for the current output stream , and filled with the information
C concerning previous steps .
C When this routine is called from ALPHA , RHAH may not exist if one
C reads e.g. a SIMDST or a KINGAL output .
C
        JRHAH=IW(NARHAH)
        IF (JRHAH.EQ.0) THEN
           CALL BKRHAB(JRHAH)
           IF (JRHAH.EQ.0) GO TO 999
C Check if this is the first call for this run ; if not , the bank RHAH
C must be restored to its status on first call :
        ELSE
           LSROW=LROWS(JRHAH)
           IF (NRUN.EQ.IOLR) THEN
              IW(JRHAH+LMHROW)=LSROW-1
              CALL AUBPRS('RHAH')
           ENDIF
        ENDIF
        IOLR=NRUN
C
C Enlarge the bank 'RHAH' with the new row corresponding to the
C characteristics of the output stream currently being written :
C
        CALL BKRHAL(PRNAM,IPVER,ICVER,NATOU,IFAIL)
        IF (IFAIL.NE.0) GO TO 999
C
        IFAIL=0
 999    RETURN
        END
#endif
@
