head	1.2;
access;
symbols
	alio83:1.2
	alio82:1.2
	alio81:1.2
	alio80:1.2
	alio74:1.1
	alio73:1.1
	alio72:1.1
	alio71:1.1
	alio70:1.1
	alio68:1.1
	alio69:1.1
	alio67:1.1
	alio66:1.1
	alio65:1.1
	alio64:1.1
	alio63:1.1
	alio62:1.1
	alio61:1.1
	alio60:1.1;
locks; strict;
comment	@c @;


1.2
date	99.12.03.14.19.40;	author flr;	state Exp;
branches;
next	1.1;

1.1
date	96.04.23.10.00.11;	author flr;	state Exp;
branches;
next	;


desc
@@


1.2
log
@alio80 - Y2K compliant
@
text
@      SUBROUTINE ALVSN(ITYP,IPV,IAV,IYR)
C-----------------------------------------------------------------------
C! Return data type and version numbers of ALEPH programs from RHAH.
CKEY ALEF DATA TYPE / USER
C Author: S.Haywood        22-DEC-1992
C Input banks:      RHAH, ASIM
C Output arguments: ITYP    = data type (as read in)
C                             1=Kingal; 2=Raw; 3=Pot; 4=DST; 5=Mini;
C                             6=Micro; 7=Nano
C                   IPV(10) = version numbers of ALEPH programs.
C                             1: Kingal
C                             2: Galeph
C                             3: Julia
C                             4: Redpot
C                             5: Mini
C                             6: Nano
C                             7: Alpha
C                   IAV(10) = corresponding ALEPHLIB version.
C                   IYR     = year when data taken (89,90,91,92,....)
C                             or to which MC corresponds
C
C This is a more robust version of ALDTYP, however it only uses RHAH and
C is intended for use in Alpha.
C To be effective, it should be called before the RHAH bank is modified
C in case of event output. For a given run, information is saved to
C protect against this situation.
C In case of repeated entries, the last entry is taken.
C
C Whether the data is DATA or MC can be determined from checking whether
C IPV(1) (the Kingal code) is 0 or not.
C-----------------------------------------------------------------------
#ifndef DOC
#include "bcs.h"
#include "rhahjj.h"
#include "asimjj.h"
      SAVE LRUN,ITYPS,IPVS,IAVS,IYRS,IDATE
      CHARACTER * 4 CHAINT,NAME,PNAME(10)
      DIMENSION IPV(10),IPVS(10),IAV(10),IAVS(10)
      DATA PNAME / 'KING','GALE','JULI','REDP','MINI','NANO','ALPH',
     &          3 * '   ' /
      DATA LRUN, ITYPS, IPVS, IAVS, IYRS / -999, 0, 10 * 0, 10 * 0, 0 /
      DATA IDATE / 0 /
#include "bmacro.h"
C
C++   Check if new run, if so, pick up version numbers.
C
      CALL ABRUEV(IRUN,IEVT)
      IF (IRUN.NE.LRUN .AND. IRUN.GT.0) THEN
         LRUN = IRUN
C
C++      Look at RHAH bank for program versions.
C
         KRHAH = IW(NAMIND('RHAH'))
         IF (KRHAH.GT.0) THEN
            NRHAH = LROWS(KRHAH)
            ITYPS = ITABL(KRHAH,NRHAH,JRHANO)
            DO 10 I=1,NRHAH
               NAME = CHAINT(ITABL(KRHAH,I,JRHAPN))
               JVSP = ITABL(KRHAH,I,JRHAPV)
               JVSA = ITABL(KRHAH,I,JRHAAV)
               DO 20 J=1,10
               IF (NAME.EQ.PNAME(J)) THEN
                  IPVS(J) = JVSP
                  IAVS(J) = JVSA
               ENDIF
   20          CONTINUE
               IF (NAME.EQ.'ON L') IDATE = ITABL(KRHAH,I,JRHAPD)
   10       CONTINUE
         ENDIF
C
C++      Determine corresponding year.
C++      For MC: use ASIM.
C++      For data: use run number upto 91, and RHAH after.
C
         IYRS = 0
         IF (IRUN.LT.2000) THEN
            KASIM = IW(NAMIND('ASIM'))
            IF (KASIM.GT.0) THEN
              IYRS = ITABL(KASIM,1,JASIYM) / 100
              IF (IYRS.GT.100) IYRS = MOD(IYRS,100)
            ENDIF
         ELSE
            IF (IRUN.LT.14000) THEN
               IF (IRUN.GE. 4000) IYRS = 89
               IF (IRUN.GE. 6000) IYRS = 90
               IF (IRUN.GE.10000) IYRS = 91
            ELSE
               IYRS = IDATE / 10000
            ENDIF
         ENDIF
      ENDIF
C
C++   Fill return arguments.
C
      ITYP = ITYPS
      DO 100 J=1,10
         IPV(J) = IPVS(J)
         IAV(J) = IAVS(J)
  100 CONTINUE
      IYR = IYRS
C
      RETURN
      END
#endif
@


1.1
log
@move alph, dbas, a part of alef and a part of c to alephio
Modified Files:
 	version.h
 Added Files:
 	adbrow.F adbrpn.F adbrun.F adbswp.F adbver.F agetdb.F agtfil.F
	albos.F aldawr.F aldtyp.F aleveh.F alfind.F alfmt.F algtbk.F
 	algtdb.F algtlu.F algtro.F algtyp.F alinst.F alk7fil.F
 	alk7fru.F alk7op.F alk7tru.F alredb.F alrune.F alrunh.F
 	alrunr.F alseed.F alstho.F alstin.F alstri.F altabl.F alvsn.F
 	aopdbs.F aublis.F aubos.F aubprs.F bkcari.F bkinca.F bkrhab.F
 	bkrhal.F bkrhaw.F bktobk.F cafiht.F chahol.F dafrds.F gtdbas.F
 	gtstup.F igtfmt.F jhocha.F julrec.F junial.F junidb.F
 	kbytrec.F loctab.F nameru.F ubpack.F uclean.F uindxs.F usbos.F
 	usgtdb.F utcblk.F utccop.F utcofo.F utwocl.F utwoex.F
Removed Files:
	noibm.F
@
text
@d78 4
a81 1
            IF (KASIM.GT.0) IYRS = ITABL(KASIM,1,JASIYM) / 100
@

