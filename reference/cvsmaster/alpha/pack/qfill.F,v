head	1.16;
access;
symbols
	alpha126_22:1.16
	alpha126_21:1.16
	alpha126_20:1.16
	alpha126_19:1.16
	alpha126_18:1.16
	alpha126_17:1.16
	alpha126_16:1.16
	alpha126_15:1.16
	alpha126_14:1.16
	alpha126_13:1.15
	alpha126_12:1.15
	alpha126_11:1.15
	alpha126_10:1.15
	alpha126_09:1.15
	alpha126_08:1.15
	alpha126_07:1.15
	alpha126_06:1.15
	alpha126_05:1.15
	alpha126_04:1.15
	alpha126_03:1.14
	alpha126_02:1.14
	alpha126_1:1.14
	alpha125_17:1.14
	alpha125_16:1.14
	alpha125_15:1.14
	alpha125_14:1.14
	alpha125_13:1.14
	alpha125_12:1.14
	alpha125_11:1.14
	alpha125_10:1.12
	alpha125_09:1.12
	alpha125_08:1.12
	alpha125_07:1.12
	alpha125_06:1.12
	alpha125_05:1.12
	alpha125_04:1.12
	alpha125_03:1.12
	alpha125_02:1.12
	alpha125_01:1.12
	alpha124_19:1.12
	alpha125:1.12
	alpha124_18:1.12
	alpha124_17:1.12
	alpha124_16:1.12
	alpha124_15:1.12
	alpha124_14:1.12
	alpha124_13:1.12
	alpha124_12:1.12
	alpha124_11:1.12
	alpha124_10:1.12
	alpha124_09:1.12
	alpha124_08:1.12
	alpha124_07:1.12
	alpha124_7:1.12
	alpha124_06:1.11
	alpha124_05:1.11
	alpha124_04:1.11
	alpha124_03:1.11
	alpha124_02:1.11
	alpha124_01:1.11
	alpha124:1.11
	alpha123_12:1.11
	alpha123_11:1.11
	alpha123_10:1.11
	alpha123_9:1.11
	alpha123_8:1.11
	alpha123_7:1.11
	alpha123_6:1.10
	alpha123_5:1.10
	alpha123_4:1.9
	alpha123_3:1.8
	alpha123_2:1.8
	alpha123:1.7
	alpha122_48:1.6
	alpha122_47:1.5
	alpha122_46:1.5
	alpha122_45:1.5
	alpha122_44:1.4
	alpha122_43:1.4
	alpha122_42:1.3
	alpha122_41:1.3
	alpha122_40:1.3
	alpha122_39:1.3
	alpha122_38:1.3
	alpha122_37:1.3
	alpha122_36:1.3
	alpha122_35:1.3
	alpha122_34:1.3
	alpha122_33:1.3
	alpha122_32:1.3
	alpha122_31:1.3
	alpha122_30:1.3
	alpha122_29:1.3
	alpha122_28:1.3
	alpha122_27:1.2
	alpha122_26:1.2
	alpha122_25:1.2
	alpha122_24:1.2
	alpha122_23:1.2
	alpha122_22:1.2
	alpha122_21:1.2
	alpha122_20:1.2
	alpha122_19:1.1.1.1
	alpha122_18:1.1.1.1
	alpha122_17:1.1.1.1
	alpha122_16:1.1.1.1
	alpha122_15:1.1.1.1
	alpha122_14:1.1.1.1
	alpha122_13:1.1.1.1
	alpha122_12:1.1.1.1
	alpha122_11:1.1.1.1
	alpha122_10:1.1.1.1
	alpha122_9:1.1.1.1
	alpha122_8:1.1.1.1
	alpha122_6:1.1.1.1
	alpha122_5:1.1.1.1
	alpha122:1.1.1.1
	alpha212:1.1.1.1
	ALPHA212:1.1.1;
locks; strict;
comment	@c @;


1.16
date	2001.12.13.16.20.52;	author alphy;	state Exp;
branches;
next	1.15;

1.15
date	2001.02.06.07.58.23;	author boucrot;	state Exp;
branches;
next	1.14;

1.14
date	2000.10.17.13.14.43;	author boucrot;	state Exp;
branches;
next	1.13;

1.13
date	2000.10.17.13.01.20;	author boucrot;	state Exp;
branches;
next	1.12;

1.12
date	99.05.12.07.21.06;	author boucrot;	state Exp;
branches;
next	1.11;

1.11
date	99.01.16.16.44.04;	author boucrot;	state Exp;
branches;
next	1.10;

1.10
date	98.11.05.09.35.35;	author boucrot;	state Exp;
branches;
next	1.9;

1.9
date	98.10.28.14.54.05;	author boucrot;	state Exp;
branches;
next	1.8;

1.8
date	98.10.20.07.37.33;	author boucrot;	state Exp;
branches;
next	1.7;

1.7
date	98.10.01.15.05.14;	author boucrot;	state Exp;
branches;
next	1.6;

1.6
date	98.07.17.09.50.15;	author boucrot;	state Exp;
branches;
next	1.5;

1.5
date	98.03.02.08.00.57;	author boucrot;	state Exp;
branches;
next	1.4;

1.4
date	98.02.09.10.53.48;	author boucrot;	state Exp;
branches;
next	1.3;

1.3
date	97.05.05.13.12.14;	author boucrot;	state Exp;
branches;
next	1.2;

1.2
date	97.02.18.08.19.15;	author boucrot;	state Exp;
branches;
next	1.1;

1.1
date	96.03.14.12.41.40;	author flr;	state Exp;
branches
	1.1.1.1;
next	;

1.1.1.1
date	96.03.14.12.41.41;	author flr;	state Exp;
branches;
next	;


desc
@@


1.16
log
@*** empty log message ***
@
text
@      SUBROUTINE QFILL
CKEY FILL /INTERNAL
C-----------------------------------------------------------------------
C! fill QVEC and QVRT
C!called from QMEVNT
C!                                                   H.Albrecht 20.09.88
C!                                                   E.Blucher  01.02.92
C!                                                   G.Graefe   22.04.94
C!                                                   P.Perret   11.02.97
C!                                                   J.Boucrot  23.02.98
C!                                                   F.Ligabue  16.07.98
C!                                                   J.Boucrot  10.05.99
C!                                                   J.Boucrot  12.01.01
C-----------------------------------------------------------------------
#ifndef DOC
#include "qcdesh.h"
      COMMON / QFILBPI /   ISWGET 
      COMMON / QTRESCI /   ITRESC
C-----------------------------------------------------------------------
C       If we have a Mini or a Nano, unpack into POT/DST banks.
C
      IF (XMINI) THEN
        CALL MINFIL
      ELSE IF (XNANO) THEN
        CALL NANFIL
      ELSE
C
C if PCPA banks have to be filled :
C
        IF (XFILPC) CALL PCPATQ(IER)
      ENDIF
C
C Correction of the online HCAL bug :
C
      CALL HCALENSC
      CALL QURESC
C
C   DEAL with FRFT banks and FRxy data cards:
C
      CALL QFFRFT         
C
C       reset ALPHA buffers if necesssary (normally done in QMREAD)
C
      IF (KFFILL .NE. 0)  CALL QMCLR
C
C       Get LEP energy and beam luminous region for the current event:
C
      ISWGET = 1  
      CALL QFILBP
C
C       fill header
C
      CALL QFHEAD
C
C       fill reconstructed charged tracks
C
      IF (XFILCH) THEN
        IF (IW(NAFRFT) .NE. 0)  THEN
          CALL QFCHGD
        ENDIF
      ENDIF
C
C Drop the 'PGAC' bank if requested by the data card 'DRGA' :
C
      IF (IW(NAMIND('DRGA')).GT.0) CALL BDROP(IW,'PGAC')
C
C       fill calorimeter objects ECAL and HCAL
C
      IF (XFILCO) THEN
        IF (IW(NAPECO).NE.0.OR.IW(NAPHCO).NE.0)  THEN
          CALL QFCALD
        ENDIF
        IF (IW(NADEWI).NE.0) THEN
          CALL QFECWM
        ELSEIF (IW(NAPEWI).NE.0.OR.NLINK('PWEI',0).NE.0) THEN
          CALL QFECWD
        ENDIF
      ENDIF
C
C       fill bit masks for reconstructed objects
C
      CALL QFBITM
C
C       fill reconstructed vertices and V0's
C
      IF(XFILV0)THEN
        CALL QFREV0
      ENDIF
C
C       fill special vertices from 1997 new tracking:
C
      CALL QFILNV
C
      KNRET = KLRET - KFRET + 1
      KNCOT = KLCOT - KFCOT + 1
C
C     Rescale charged track momenta if requested by card 'PCOR':
C
      ITRESC=1
      IF (IW(NAMIND('PCOR')) .GT. 0)  CALL QTRESC 
C
C       rerun GAMPEX if needed, then fill GAT section of QVEC
C
      IF (IW(NAMIND('REPG')).GT.0) THEN   
        IF (XFILGA) THEN
          CALL QFGAMP
C Photon energies on NanoDst are already corrected:
          IF(.NOT.XNANO) CALL FIXGAEN
        ENDIF
      ENDIF
C Get the result of the E14 algorithm:
      CALL QFDE14

C
C       fill EFT section of QVEC
C
      IF (XFILEF)THEN
        IMINE=1
        IF (XMINI) IMINE=0
        IF (XMINI.AND.MINGTV(DUM).GE.205) IMINE=1
        IF ( KEFOPT.NE.2 .AND. IMINE.EQ.1 ) THEN
          IF ( NLINK('RENF',0) .GT. 0 ) IND = NDROP('EFOL',3)
          IF ( NLINK('EFOL',3) .LE. 0 ) CALL QUEFLO
        ENDIF
        CALL QFEFLO
      ENDIF
C
C        Rescale EFLOW objects which are charged tracks, 
C        if reading a MINI and if requested by data card 'PCOR':
C
      ITRESC=2
      IF (XMINI.AND.IW(NAMIND('PCOR')) .GT. 0) CALL QTRESC 
C
C       fill NET section of QVEC
C
      IF (XFILPC) THEN
        CALL QFNEOB
      ENDIF
C
C       fill GAT section of QVEC
C    
      IF (XFILGA) THEN
          CALL QFGAMP
C Photon energies on NanoDst are already corrected:
          IF(.NOT.XNANO.AND.IW(NAMIND('REPG')).EQ.0) CALL FIXGAEN
      ENDIF
C
C
C   fill jet section
C
      IF (XFILJE) THEN
        CALL QFJETS
      ENDIF
C
C       fill Monte Carlo truth
C
      IF (XFILMC) THEN
        CALL QFILMC
      ENDIF
C
C fill tags and jets for leptons from QSELEP when reading a MINI or a NANO
C
      IF (XMINI.OR.XNANO) CALL QFLEPT
C
C        find the event interaction point from QFNDIP, if requested:
C
      ISWGET = 2
      CALL QFILBP
C
C Recalculate d0,z0 of charged tracks according to beam position,
C if requested by data card 'D0NW' :
C
      IF (IW(NAMIND('D0NW')) .GT. 0) CALL QFD0Z0
C
C Recalculate RT and RL for electron candidates , when necessary
C
      CALL FIXRTRL
C
C Recalculate Rl for 1996 MC events :
C
      CALL FIXPRL
C
      KFFILL = 1
C
C
C   Heavy flavour lepton selection :
C
        CALL QLEVNT
C
C   Recreate the PTPX bank if necessary :
C
        CALL QFPTPX 
C
C   Statistics for Kingal generated triggers:
C
        IF (XFILMC) CALL QFKIREV
C
      END
#endif
@


1.15
log
@*** empty log message ***
@
text
@d63 4
@


1.14
log
@*** empty log message ***
@
text
@d13 1
a19 4
C Correction of the online HCAL bug :
      CALL HCALENSC
      CALL QURESC
C
d33 5
d93 1
a93 1
C       Rescale charged track momenta if requested by card 'PCOR':
d114 4
a117 1
        IF ( KEFOPT.NE.2 .AND. (.NOT.XMINI) ) THEN
d189 4
@


1.13
log
@*** empty log message ***
@
text
@a0 1
#endif
d186 1
@


1.12
log
@*** empty log message ***
@
text
@d1 1
d106 3
a186 1
#endif
@


1.11
log
@*** empty log message ***
@
text
@d12 1
a12 1
C!                                                   J.Boucrot  10.12.98
d19 2
a20 1
C
@


1.10
log
@*** empty log message ***
@
text
@d12 1
a12 1
C!                                                   J.Boucrot  28.10.98
d176 4
@


1.9
log
@*** empty log message ***
@
text
@d95 1
a95 1
C       fill GAT section of QVEC
d97 3
a99 2
      IF (XFILGA) THEN
        CALL QFGAMP
d101 2
a102 1
        IF(.NOT.XNANO) CALL FIXGAEN
d127 9
a178 1

@


1.8
log
@*** empty log message ***
@
text
@d12 1
a12 1
C!                                                   J.Boucrot  19.10.98
d95 8
a122 8
      ENDIF
C
C       fill GAT section of QVEC
C
      IF (XFILGA) THEN
        CALL QFGAMP
C Photon energies on NanoDst are already corrected:
        IF(.NOT.XNANO) CALL FIXGAEN
@


1.7
log
@*** empty log message ***
@
text
@d12 1
a12 1
C!                                                   J.Boucrot  24.09.98
d17 1
d54 1
a54 1
      IF(XFILCH)THEN
a59 1
C
d62 1
a62 1
      IF(XFILCO)THEN
d66 1
a66 1
        IF(IW(NADEWI).NE.0)THEN
d90 5
d97 1
a97 1
      IF(XFILEF)THEN
a98 2
C correct tracks b4 E-flow is called 
          IF ( NLINK('PCOR',0) .GT. 0 ) CALL QTRESC
d105 6
d113 1
a113 1
      IF(XFILPC)THEN
d119 1
a119 1
      IF(XFILGA)THEN
d127 1
a127 1
      IF(XFILJE)THEN
d133 1
a133 1
      IF(XFILMC)THEN
d146 2
a147 1
C Recalculate d0,z0 of charged tracks according to beam position:
d149 1
a149 1
      CALL QFD0Z0
@


1.6
log
@*** empty log message ***
@
text
@d12 1
d16 1
d28 1
d30 1
d42 5
d132 1
a132 1
C        fill the event-by-event beam position:
d134 1
d158 1
@


1.5
log
@*** empty log message ***
@
text
@d11 1
d17 2
d50 1
d85 2
a147 2


@


1.4
log
@*** empty log message ***
@
text
@d10 1
a10 1
C!                                                   J.Boucrot  03.02.98
a13 1
      INTEGER GTSTUP
a25 3
C Drop FRFT, NR=2 when it exists in 1989/1990 data (should not be the default)
      CALL ABRUEV(IRUN,IEVT)
      IF (GTSTUP('VD',IRUN).LE.2) KFRFT = NDROP('FRFT',2)
d27 1
a27 1
C   DEAL with FRF0 card
d29 1
a29 4
      IF(.NOT.XFRF0)THEN
C---SWAP FRFT 0 TO FRFT 3 OR VICE VERSA
         IND=NSWAP('FRFT',0,'FRFT',3)
      ENDIF
@


1.3
log
@*** empty log message ***
@
text
@d10 1
a10 1
C!                                                   J.Boucrot  21.04.97
d124 1
a124 1
C        fill the event-by-event beam position :
d128 4
d149 2
@


1.2
log
@*** empty log message ***
@
text
@a6 1
C!                                                   E.Blucher  07.05.89
d10 1
d77 3
d134 1
a134 1
      CALL FIXPRL 
@


1.1
log
@Initial revision
@
text
@d10 1
a10 1
C!                                                   G.Graefe   13.07.94
a124 1
C
d128 5
@


1.1.1.1
log
@import alpha122 from alws
@
text
@@
