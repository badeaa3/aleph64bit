head	1.4;
access;
symbols
	alpha126_22:1.4
	alpha122_22:1.4
	alpha126_21:1.4
	alpha126_20:1.4
	alpha126_19:1.4
	alpha126_18:1.4
	alpha126_17:1.4
	alpha126_16:1.4
	alpha126_15:1.4
	alpha126_14:1.4
	alpha126_13:1.4
	alpha126_12:1.4
	alpha126_11:1.4
	alpha126_10:1.4
	alpha126_09:1.4
	alpha126_08:1.4
	alpha126_07:1.4
	alpha126_06:1.4
	alpha126_05:1.4
	alpha126_04:1.4
	alpha126_03:1.4
	alpha126_02:1.4
	alpha126_1:1.4
	alpha125_17:1.4
	alpha125_16:1.4
	alpha125_15:1.4
	alpha125_14:1.4
	alpha125_13:1.4
	alpha125_12:1.4
	alpha125_11:1.4
	alpha125_10:1.4
	alpha125_09:1.4
	alpha125_08:1.4
	alpha125_07:1.4
	alpha125_06:1.4
	alpha125_05:1.4
	alpha125_04:1.4
	alpha125_03:1.4
	alpha125_02:1.4
	alpha125_01:1.4
	alpha124_19:1.4
	alpha125:1.4
	alpha124_18:1.4
	alpha124_17:1.3
	alpha124_16:1.3
	alpha124_15:1.3
	alpha124_14:1.3
	alpha124_13:1.3
	alpha124_12:1.2
	alpha124_11:1.2
	alpha124_10:1.2
	alpha124_09:1.2
	alpha124_08:1.2
	alpha124_07:1.2
	alpha124_7:1.2
	alpha124_06:1.2
	alpha124_05:1.2
	alpha124_04:1.1
	alpha124_03:1.1
	alpha124_02:1.1
	alpha124_01:1.1
	alpha124:1.1
	alpha123_12:1.1
	alpha123_11:1.1
	alpha123_10:1.1
	alpha123_9:1.1
	alpha123_8:1.1
	alpha123_7:1.1
	alpha123_6:1.1
	alpha123_5:1.1
	alpha123_4:1.1
	alpha123_3:1.1
	alpha123_2:1.1
	alpha123:1.1
	alpha122_48:1.1
	alpha122_47:1.1
	alpha122_46:1.1
	alpha122_45:1.1
	alpha122_44:1.1
	alpha122_43:1.1
	alpha122_42:1.1;
locks; strict;
comment	@c @;


1.4
date	99.10.28.14.19.23;	author boucrot;	state Exp;
branches;
next	1.3;

1.3
date	99.08.25.09.42.04;	author boucrot;	state Exp;
branches;
next	1.2;

1.2
date	99.04.19.14.04.40;	author boucrot;	state Exp;
branches;
next	1.1;

1.1
date	98.01.19.09.00.56;	author boucrot;	state Exp;
branches;
next	;


desc
@@


1.4
log
@*** empty log message ***
@
text
@      SUBROUTINE GTIPBK(NDIM,ARRAY,BANK,OLDBNK,NOPT)
CKEY   QIPBTAG / INTERNAL
C-----------------------------------------------------------------------
C! Read in the given BANK into ARRAY(NDIM,*). 
C  Issue warnings if the obselete OLDBNK is given as cards
C  eg:  Read in calibration from the database bank QIPC, issue warnings if 
C  obselete cards FITP are given or information is missing.
C  Author  Manoj Thulasidas  Dec. 8, 1997
C  Modified 17-08-99 P-F Giraud : able to read smearing parameters
C
C  NOPT = 0 for QIPBTAG calibration
C       = 1 for smearing/deletion cards, QIPBTAG1
C       = 2 for smearing/deletion cards, QIPBTAG2
C
C     Output:  FITP  10x6 calibration constants
C-----------------------------------------------------------------------
#ifndef DOC
      IMPLICIT NONE
#include "bcs.h"
C  Arguments
      INTEGER NDIM, NOPT
      REAL ARRAY(NDIM,*)
      CHARACTER*4 BANK, OLDBNK
C  Functions
      INTEGER ALGTDB, GTSTUP, NAMIND, NLINK, JUNIDB
C  Local variables
      INTEGER IBANK, IRET, IVS, NABANK, LUNDB, KCARD, KBANK,  NAOBNK, 
     &        KOBNK, IRUN, IEVT, IDIM, ITYPE, NTYPE, IPASS
      SAVE IPASS 
      INTEGER KQPYR, IYEAR, KASIM, KIVS
      LOGICAL LSMEAR, ALLEP1
      INTEGER NDANR
      DATA IPASS / 0 /
#include "asimjj.h"
#include "bmacrod.h"
#include "bmacro.h"
C-----------------------------------------------------------------------
C Check if the user is asking for a smearing period that is different from 
C that of the Monte Carlo, change ASIM entry.
      KQPYR = IW(NAMIND('QPYR'))
      IF (KQPYR.NE.0) THEN
        IF (IW(KQPYR).NE.1)
     +       CALL QMTERM('GTIPBK : Missing argument for QPYR')
        IYEAR = IW(KQPYR+1)
        KASIM = IW(NAMIND('ASIM'))
        IF (KASIM.NE.0) IW(KASIM+LMHLEN+JASIYM)=IYEAR
      ENDIF

C  Check for calibration cards
      NAOBNK = NAMIND(OLDBNK)
      KOBNK = IW(NAOBNK)
      IF(KOBNK .GT. 0)THEN
        CALL QMTERM('GTIPBK:  Unsupported bank used')
      END IF
C Check the option and set a logical in case a smearing/deletion card
C is asked
      LSMEAR=.FALSE.
      IF (NOPT.GE.1) THEN
        LSMEAR=.TRUE.
      ELSE
        LSMEAR=.FALSE.
      ENDIF
C Get the run number :
C if the event is not Monte Carlo, do nothing
      CALL ABRUEV(IRUN,IEVT)
      IPASS = IPASS + 1
C Get database Calibration bank
      IVS  = GTSTUP ('VD',IRUN)
      IF (IVS.LT.0) CALL QMTERM(
     +     'QIPBTAG/GTIPBK: Unable to find VDET setup code.')
      IF (LSMEAR) THEN
        IF(ALLEP1(IRUN)) THEN
          KIVS = 100*IVS + NOPT
        ELSE
          KIVS = 100*IVS + 1 + NOPT
        ENDIF
      ELSE
        KIVS = IVS
      ENDIF
      LUNDB = JUNIDB()
      KCARD = NLINK(BANK,-1)
C If the user supplies the 'OQIP' card and forgets to give the smearing
C parameters cardfile :
      IF (KCARD.LE.0.AND.LSMEAR.AND.IW(NAMIND('OQIP')).GT.0)
     +     CALL QMTERM('QIPBTAG/GTIPBK: please supply smearing card '//
     +     'files when using OQIP.')
C Access the database :
      IRET = ALGTDB(LUNDB,BANK,KIVS)
      NABANK = NAMIND(BANK)
      KBANK = IW(NABANK)
      IF(KBANK .GT. 0)THEN
        IF (KCARD.GT.0) THEN
          IF (IPASS.LE.1) WRITE (IW(6),10) BANK
 10       FORMAT(' QIPBTAG/GTIPBK: reading ',A4,' from card file.')
        ELSE
          IF (IPASS.LE.1) WRITE (IW(6),20) BANK,KIVS
 20       FORMAT(' QIPBTAG/GTIPBK: reading database bank ',A4,I5)
          IF (LSMEAR.AND.IW(KBANK-2).NE.KIVS) THEN
            WRITE (IW(6),25) BANK, KIVS
 25         FORMAT(' QIPBTAG/GTIPBK: ERROR: Bank ',A4, I5,' not found.')
            CALL QMTERM('Quit from GTIPBK: cannot read bank')
          END IF
        END IF
        NTYPE = LROWS(KBANK)
        DO ITYPE=1,NTYPE
          DO IDIM=1,NDIM
            ARRAY(IDIM,ITYPE) = RTABL(KBANK,ITYPE,IDIM)
          END DO
        END DO
      ELSE
        WRITE (IW(6),*) 'GTIPBK: Can not read database bank ',BANK
        CALL QMTERM(
     &    ' Quit from GTIPBK: Can not read GTIPBK calib. from database')
      END IF
      RETURN
      END
#endif
@


1.3
log
@*** empty log message ***
@
text
@d28 2
a29 1
     &        KOBNK, IRUN, IEVT, IDIM, ITYPE, NTYPE
d33 1
d66 1
d93 1
a93 1
          WRITE (IW(6),10) BANK
d96 1
a96 1
          WRITE (IW(6),20) BANK,KIVS
@


1.2
log
@*** empty log message ***
@
text
@d1 1
a1 1
      SUBROUTINE GTIPBK(NDIM,ARRAY,BANK,OLDBNK)
d9 5
d21 1
a21 1
      INTEGER NDIM
d29 4
d36 11
d51 1
a51 3
        WRITE (IW(6),*)' GTIPBK: WARNING: ',OLDBNK,
     &     ' not supported any more.  Will quit...'
        CALL QMTERM('QMTERM called from GTIPBK:  Unsupported bank used')
d53 10
a62 2
C  get the run number
C  if the event is not Monte Carlo, do nothing
d66 11
d79 7
a85 1
      IRET = ALGTDB(LUNDB,BANK,IVS)
d91 1
a91 1
   10     FORMAT(' QIPBTAG/GTIPBK: reading ',A4,' from card file.')
d93 7
a99 2
          WRITE (IW(6),20) BANK,IVS
   20     FORMAT(' QIPBTAG/GTIPBK: reading database bank ',A4,I5)
a114 1

@


1.1
log
@*** empty log message ***
@
text
@d3 1
a3 1
C ------------------------------------------------------------------------------
d11 1
a11 1
C ------------------------------------------------------------------------------
d20 1
a20 1
      INTEGER ALGTDB, GTSTUP, NAMIND, JUNIDB
d22 2
a23 2
      INTEGER IBANK, IRET, IVS, NABANK, LUNDB, KBANK,  NAOBNK, KOBNK,
     $   IRUN, IEVT, IDIM, ITYPE, NTYPE
d26 1
a26 1
C ------------------------------------------------------------------------------
d32 1
a32 1
     $     ' not supported any more.  Will quit...'
d41 1
d46 7
a52 1
        WRITE (IW(6),*)' GTIPBK: reading the database bank ',BANK
d60 1
a60 1
        WRITE (IW(6),*)' GTIPBK: Can not read BANK database bank'
d62 1
a62 1
     $     ' Quit from GTIPBK: Can not read GTIPBK Calib from database')
d67 1
@
