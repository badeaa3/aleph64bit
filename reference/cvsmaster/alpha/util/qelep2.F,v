head	1.2;
access;
symbols
	alpha126_22:1.2
	alpha122_22:1.2
	alpha126_21:1.2
	alpha126_20:1.2
	alpha126_19:1.2
	alpha126_18:1.2
	alpha126_17:1.2
	alpha126_16:1.2
	alpha126_15:1.2
	alpha126_14:1.2
	alpha126_13:1.2
	alpha126_12:1.2
	alpha126_11:1.2
	alpha126_10:1.2
	alpha126_09:1.2
	alpha126_08:1.2
	alpha126_07:1.2
	alpha126_06:1.2
	alpha126_05:1.2
	alpha126_04:1.2
	alpha126_03:1.2
	alpha126_02:1.2
	alpha126_1:1.2
	alpha125_17:1.2
	alpha125_16:1.2
	alpha125_15:1.2
	alpha125_14:1.2
	alpha125_13:1.2
	alpha125_12:1.2
	alpha125_11:1.2
	alpha125_10:1.2
	alpha125_09:1.2
	alpha125_08:1.2
	alpha125_07:1.2
	alpha125_06:1.2
	alpha125_05:1.2
	alpha125_04:1.2
	alpha125_03:1.2
	alpha125_02:1.2
	alpha125_01:1.2
	alpha124_19:1.2
	alpha125:1.2
	alpha124_18:1.2
	alpha124_17:1.2
	alpha124_16:1.2
	alpha124_15:1.2
	alpha124_14:1.2
	alpha124_13:1.2
	alpha124_12:1.2
	alpha124_11:1.2
	alpha124_10:1.2
	alpha124_09:1.2
	alpha124_08:1.2
	alpha124_07:1.2
	alpha124_7:1.2
	alpha124_06:1.2
	alpha124_05:1.2
	alpha124_04:1.2
	alpha124_03:1.2
	alpha124_02:1.2
	alpha124_01:1.2
	alpha124:1.2
	alpha123_12:1.2
	alpha123_11:1.2
	alpha123_10:1.2
	alpha123_9:1.2
	alpha123_8:1.2
	alpha123_7:1.2
	alpha123_6:1.2
	alpha123_5:1.2
	alpha123_4:1.2
	alpha123_3:1.2
	alpha123_2:1.2
	alpha123:1.2
	alpha122_48:1.2
	alpha122_47:1.2
	alpha122_46:1.2
	alpha122_45:1.2
	alpha122_44:1.2
	alpha122_43:1.2
	alpha122_42:1.2
	alpha122_41:1.2
	alpha122_40:1.2
	alpha122_39:1.2
	alpha122_38:1.2
	alpha122_37:1.2
	alpha122_36:1.2
	alpha122_35:1.2
	alpha122_34:1.2
	alpha122_33:1.2
	alpha122_32:1.2
	alpha122_31:1.2
	alpha122_30:1.2
	alpha122_29:1.2
	alpha122_28:1.2
	alpha122_27:1.1
	alpha122_26:1.1;
locks; strict;
comment	@c @;


1.2
date	97.05.05.13.12.23;	author boucrot;	state Exp;
branches;
next	1.1;

1.1
date	97.03.24.12.25.15;	author boucrot;	state Exp;
branches;
next	;


desc
@@


1.2
log
@*** empty log message ***
@
text
@      SUBROUTINE QELEP2(ELEP,IFLAG)
C----------------------------------------------------------------------
C! Get the "instantaneous" exact LEP energy for LEP 2 runs
CKEY ENERGY/USER
C  Simple interface to ALEPHLIB routine GETLE2   J.Boucrot  26.3.97
C Output arguments :
C  ELEP  = LEP c.m.s. energy, in Gev
C  IFLAG = 1 if ELEP found from official time-slice LEP information
C        = 2 if ELEP found from average run energy
C        = 3 in all other cases (then ELEP taken from bank LFIL)
C----------------------------------------------------------------------
#ifndef DOC
#include "qcde.h"
C----------------------------------------------------------------------
      CALL GETLE2(ELEP,IFLAG)
      IF (IFLAG.EQ.3) ELEP=QELEP
      RETURN
      END
#endif
@


1.1
log
@*** empty log message ***
@
text
@d2 2
d5 1
a5 3
C----------------------------------------------------------------------
C! Get the "instantaneous" exact LEP energy for LEP2 runs
C                                                    J.Boucrot  20.3.97
d10 1
a10 1
C        = 3 in all other cases ( ==> then ELEP=QELEP)
d14 4
a17 100
#include "rlepjj.h"
C#include "enr2jj.h"    ! run-averaged LEP energies, bank ENR2
      PARAMETER  (JENRRN= 1,JENREN= 2, LENR2A =2)
C#include "enl2jj.h"    ! time-slice   LEP energies, bank ENL2
      PARAMETER  (JENLDA= 1,JENLTI= 2, JENLEN =3, LENL2A =3)
C#include "enf2jj.h"    ! definition of fills , bank ENF2
      PARAMETER  (JENFFN= 1,JENFDS= 2, JENFTS= 3, JENFDE =4,
     +            JENFTE=5, JENFRF= 6, JENFRL= 7, LENF2A =7)
      PARAMETER ( M1 = 1000000 , M2 = 10000 )
      LOGICAL TEST
C NRMIN is the first LEP 2 run for which the above banks contain infos
      DATA NRMIN / 41400 /
C EMIN is the LEP energy under which there is no time slice information
      DATA EMIN / 100. /
C inline function:
      TEST(IA,IB,IC) = IA.GE.IB.AND.IA.LT.IC
#include "qmacro.h"
C-----------------------------------------------------------------------
      ELEP=0.
      IFLAG=0
C Only LEP2 runs of 1996 and after are considered :
      IF (KRUN.LT.NRMIN) GO TO 800
C Get year IYEAR and time ITIEV (HHMMSS) of the present event:
      ITIEV=KEVETI/100
      IYEAD=KEVEDA/10000
      IF (IYEAD.GE.96) IYEAR=1900+IYEAD
      IF (IYEAD.LT.10) IYEAR=2000+IYEAD
      IDTEV=ITIEV+M1*MOD(KEVEDA,M2)
C
C - Get the bank of LEP2 run-averaged energies: 'ENR2', NR=IYEAR
C
      JENR2=NLINK('ENR2',IYEAR)
      IF (JENR2.EQ.0) GO TO 800
C Find the run-averaged energy for the present run:
      J=LOCTAB(IW(JENR2+LMHLEN+1),LCOLS(JENR2),LROWS(JENR2),JENRRN,KRUN)
      RELEP=0.
      IF (J.GT.0) RELEP = RTABL(JENR2,J,JENREN)
      IF (RELEP.LT.EMIN) GO TO 700
C
C - Get the fill number for this event from the 'RLEP' run header bank:
C
      JRLEP=IW(NAMIND('RLEP'))
      IF (JRLEP.EQ.0) GO TO 700
      IFILL=ITABL(JRLEP,1,JRLELF)
      IF (IFILL.LE.0) GO TO 700
C
C - Get the bank describing the fills : 'ENF2' , NR = IYEAR
C
      JENF2=NLINK('ENF2',IYEAR)
      IF (JENF2.EQ.0) GO TO 700
C Find fill IFILL in this bank:
      K=LOCTAB(IW(JENF2+LMHLEN+1),LCOLS(JENF2),LROWS(JENF2),
     +         JENFFN,IFILL)
      IF (K.EQ.0) GO TO 700
C Find if the current event is within the time slice of the fill:
      IDFDS=ITABL(JENF2,K,JENFDS)
      ITFTS=ITABL(JENF2,K,JENFTS)
      IDDST=ITFTS+M1*MOD(IDFDS,M2)
      IDFDE=ITABL(JENF2,K,JENFDE)
      ITFTE=ITABL(JENF2,K,JENFTE)
      IDDEN=ITFTE+M1*MOD(IDFDE,M2)
      IF (.NOT.TEST(IDTEV,IDDST,IDDEN))  GO TO 700
C
C - Get the bank of LEP2 time-sliced energies: 'ENL2' , NR = IYEAR
C
      JENL2=NLINK('ENL2',IYEAR)
      IF (JENL2.EQ.0) GO TO 700
C Loop on the time slices corresponding to fill IFILL:
      IRLMI=ITABL(JENF2,K,JENFRF)
      IRLMX=ITABL(JENF2,K,JENFRL)
      DO 100 IENL2=IRLMI,IRLMX-1
         IDLST=ITABL(JENL2,IENL2,JENLDA)
         ITLST=ITABL(JENL2,IENL2,JENLTI)
         IDDST=ITLST+M1*MOD(IDLST,M2)
         IDLEN=ITABL(JENL2,IENL2+1,JENLDA)
         ITLEN=ITABL(JENL2,IENL2+1,JENLTI)
         IDDEN=ITLEN+M1*MOD(IDLEN,M2)
         IF (TEST(IDTEV,IDDST,IDDEN)) THEN
C Get the "instantaneous" LEP energy for this event:
            ELEP=RTABL(JENL2,IENL2,JENLEN)
            IFLAG=1
            GO TO 999
         ENDIF
 100  CONTINUE
C
C No time-slice information found for this event:
C take the run-averaged one:
C
 700  IFLAG=2
      IF (RELEP.LT.DELMX) GO TO 800
      ELEP=RELEP
      GO TO 999
C
C Neither time-slice nor run-averaged information for this event:
C take the fill-averaged one (i.e. the standard QELEP):
C
 800  IFLAG=3
      ELEP=QELEP
      GO TO 999
 999  RETURN
@
