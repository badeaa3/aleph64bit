head	1.1;
branch	1.1.1;
access;
symbols
	aleph316_2:1.1.1.1
	aleph316_1:1.1.1.1
	aleph316:1.1.1.1
	aleph315_7:1.1.1.1
	aleph315_6:1.1.1.1
	aleph315_5:1.1.1.1
	aleph315_4:1.1.1.1
	aleph315_3:1.1.1.1
	aleph315_2:1.1.1.1
	aleph315_1:1.1.1.1
	aleph315:1.1.1.1
	aleph314_2:1.1.1.1
	aleph314_1:1.1.1.1
	aleph314:1.1.1.1
	aleph313_1:1.1.1.1
	aleph313:1.1.1.1
	aleph312_1:1.1.1.1
	aleph312:1.1.1.1
	aleph311_1:1.1.1.1
	aleph311:1.1.1.1
	aleph310_3:1.1.1.1
	aleph310_2:1.1.1.1
	aleph310_1:1.1.1.1
	aleph310:1.1.1.1
	aleph309_1:1.1.1.1
	aleph309:1.1.1.1
	aleph308_3:1.1.1.1
	aleph308_2:1.1.1.1
	aleph308_1:1.1.1.1
	aleph308:1.1.1.1
	aleph307_6:1.1.1.1
	aleph307_5:1.1.1.1
	aleph307_4:1.1.1.1
	aleph307_2:1.1.1.1
	aleph307_1:1.1.1.1
	aleph307:1.1.1.1
	aleph306:1.1.1.1
	aleph305_4:1.1.1.1
	aleph305_3:1.1.1.1
	aleph305_2:1.1.1.1
	aleph305_1:1.1.1.1
	aleph305:1.1.1.1
	aleph304_5:1.1.1.1
	aleph304_4:1.1.1.1
	aleph304_3:1.1.1.1
	aleph304_2:1.1.1.1
	aleph304_1:1.1.1.1
	aleph304:1.1.1.1
	aleph303_3:1.1.1.1
	aleph303_2:1.1.1.1
	aleph303_1_mc1:1.1.1.1
	aleph303_1:1.1.1.1
	aleph303:1.1.1.1
	aleph302_9:1.1.1.1
	aleph302_8:1.1.1.1
	aleph302_7:1.1.1.1
	aleph302_6:1.1.1.1
	aleph302_5:1.1.1.1
	aleph302_4:1.1.1.1
	aleph302_3:1.1.1.1
	aleph302_2:1.1.1.1
	aleph302_1:1.1.1.1
	aleph302:1.1.1.1
	aleph216:1.1.1.1
	aleph215_3:1.1.1.1
	aleph215_2:1.1.1.1
	aleph215:1.1.1.1
	aleph214:1.1.1.1
	aleph213:1.1.1.1
	aleph212:1.1.1.1
	ALEPH212:1.1.1;
locks; strict;
comment	@c @;


1.1
date	96.02.07.11.44.44;	author flr;	state Exp;
branches
	1.1.1.1;
next	;

1.1.1.1
date	96.02.07.11.44.45;	author flr;	state Exp;
branches;
next	;


desc
@@



1.1
log
@Initial revision
@
text
@      INTEGER FUNCTION VDEXCY(ILAY,TPAR,ZBUF,GPOS0,IPHI,IWAFF)
C----------------------------------------------------------------------
C!  Extrapolate a given track to all a Vdet cylinder
CKEY VDET TRACK
C!
C!   Author   :- A. Bonissent March 1995
C!   Inputs:
C!
C!        ILAY       - layer
C!        TPAR       - 5 Track parameters, as in FRFT
C!        ZBUF       - Quantity added to Vdet for X acceptance
C!
C!   Outputs:
C!        GPOS0(3)   - 3D position of track intersection with Vdet cyl.
C!        IPHI       - face number of above
C!        IWAFf      - wafer in face of above
C!
C!        VDEXCY     - return code. 0=OK
C!                                  1=track does not intersect
C!
C?
C!======================================================================
#ifndef DOC
C      IMPLICIT NONE
      REAL TPAR(*),GPOS0(3),ZBUF
      INTEGER ILAY,JFAC,IPHI(2),IWAFF(2),JPHI
      INTEGER ILL
C
      REAL PHI0,DPHI
      REAL RFAC(2),XYZ1(3),RFID,VPHIT
      REAL FULLU,FULLW,FULUW(3)
      INTEGER IRET,NFAC(2)
      LOGICAL FIRST
C
      INTEGER VNRFAC,VXYZFC,VWFFND,VFADIM,VJFACI
      REAL VDOTN
C
      PARAMETER (RFID = 1.0)
      REAL PHIOV(15,2)
      INTEGER IFOV(15,2,2)
      REAL XYZF(3,2),XOVL(2,2,15)
      INTEGER IOVL, I, KFAC, IWFF
      REAL CMAX, DIST
      DATA FIRST /.TRUE./
      SAVE RFAC,PHI0,DPHI,NFAC,FULLU,FULLW
      IF(FIRST)THEN
         FIRST=.FALSE.
         DO ILL=1,2
           JFAC=1+(ILL-1)*VNRFAC(1)
           IRET = VXYZFC(JFAC,XYZ1)
           RFAC(ILL) = SQRT(XYZ1(1)**2+XYZ1(2)**2)
C
           NFAC(ILL) = VNRFAC(ILL)
           DO IOVL=1,NFAC(ILL)
             DO I=1,2
               KFAC = IOVL+I-1
               IF(KFAC.GT.NFAC(ILL))KFAC=1
               IFOV(IOVL,I,ILL) = KFAC
               IRET = VJFACI(ILL,KFAC,JFAC)
               IRET = VXYZFC(JFAC,XYZF(1,I))
             ENDDO
             CALL VADD(XYZF(1,1),XYZF(1,2),XOVL(1,ILL,IOVL),2)
           ENDDO
         ENDDO
         IRET = VFADIM(FULUW)
         FULLU = FULUW(2)*.5
         FULLW = FULUW(3)*.5 + ZBUF
      ENDIF
      VDEXCY=1
C
C  Don't check tracks whose impact parameter is larger than the
C  VDET radius minus a small amount (~1 cm) to preclude the case
C  where the cylinder approximation is too crude.
C
      IF(ABS(TPAR(4)).GE.RFAC(ILAY)-RFID)GO TO 999
C
C  Crude extrapolation to a cylinder
C
      CALL VTXRAW (TPAR,RFAC(ILAY),GPOS0,VPHIT,IRET)
C
C  Reject this layer if there's an error, or
C  if abs(z) is outside the face
C
      IF ((IRET .NE. 0) .OR. (ABS(GPOS0(3)) .GT. FULLW)) GO TO 999
C
C  Decide which wafers to extrapolate to.  First find the phi, then
C  the Z. Find the closest two faces VDOTN is the cosine of the angle
C  between the track point and a given overlap
C
      CMAX = 0.
      DO IOVL=1,NFAC(ILAY)
         DIST = VDOTN(GPOS0,XOVL(1,ILAY,IOVL),2)
         IF(DIST.GT.CMAX)THEN
            IPHI(1) = IFOV(IOVL,1,ILAY)
            IPHI(2) = IFOV(IOVL,2,ILAY)
            CMAX = DIST
         ENDIF
      ENDDO
C
C  Determine the wafer (Z).
C
      IWFF = VWFFND(GPOS0(3))
      IWAFF(1) = IWFF
      IWAFF(2) = IWFF
      VDEXCY=0
  999 CONTINUE
      RETURN
      END
#endif
@


1.1.1.1
log
@import aleph212 from alws
@
text
@@
