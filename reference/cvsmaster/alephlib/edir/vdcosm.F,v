head	1.2;
access;
symbols
	aleph316_2:1.2
	aleph316_1:1.2
	aleph316:1.2
	aleph315_7:1.2
	aleph315_6:1.2
	aleph315_5:1.2
	aleph315_4:1.2
	aleph315_3:1.2
	aleph315_2:1.2
	aleph315_1:1.2
	aleph315:1.2
	aleph314_2:1.2
	aleph314_1:1.2
	aleph314:1.2
	aleph313_1:1.2
	aleph313:1.2
	aleph312_1:1.2
	aleph312:1.2
	aleph311_1:1.2
	aleph311:1.2
	aleph310_3:1.2
	aleph310_2:1.2
	aleph310_1:1.2
	aleph310:1.2
	aleph309_1:1.2
	aleph309:1.2
	aleph308_3:1.2
	aleph308_2:1.2
	aleph308_1:1.2
	aleph308:1.2
	aleph307_6:1.2
	aleph307_5:1.2
	aleph307_4:1.2
	aleph307_2:1.2
	aleph307_1:1.2
	aleph307:1.2
	aleph306:1.2
	aleph305_4:1.2
	aleph305_3:1.2
	aleph305_2:1.2
	aleph305_1:1.2
	aleph305:1.2
	aleph304_5:1.2
	aleph304_4:1.2
	aleph304_3:1.2
	aleph304_2:1.2
	aleph304_1:1.2
	aleph304:1.2
	aleph303_3:1.2
	aleph303_2:1.2
	aleph303_1_mc1:1.2
	aleph303_1:1.2
	aleph303:1.2
	aleph302_9:1.2
	aleph302_8:1.2
	aleph302_7:1.2
	aleph302_6:1.2
	aleph302_5:1.2
	aleph302_4:1.2
	aleph302_3:1.2
	aleph302_2:1.2
	aleph302_1:1.2
	aleph302:1.2
	aleph216:1.2
	aleph215_3:1.2
	aleph215_2:1.2
	aleph215:1.2
	aleph214:1.1;
locks; strict;
comment	@c @;


1.2
date	96.07.01.12.59.01;	author cattanem;	state Exp;
branches;
next	1.1;

1.1
date	96.06.14.09.43.33;	author cattanem;	state Exp;
branches;
next	;


desc
@@


1.2
log
@Protect against possible missing banks
@
text
@      LOGICAL FUNCTION VDCOSMJ(IDUMMY)
C-----------------------------------------------------------------------
CKEY EDIR VDET COSMIC
C! Select cosmic in vdet acceptance
C-
C     Input  : None
C     Output : VDCOSMJ - true if event passes VDET cosmic selection
C-
C     Called by  : SELEVT
C     Calls      : nothing
C     Banks used : PFRF, PFRT
C-
C!                                    Author D.Rousseau  15/03/95
C-----------------------------------------------------------------------
#ifndef DOC
      SAVE
C --
#include "bcs.h"
#include "pfrfjj.h"
#include "pfrtjj.h"
C --
      EXTERNAL NAMIND, NLINK
C --
      PARAMETER (PI=3.1415926535,TWOPI=2.*PI)
      PARAMETER(NTPCUT=10,D0MAX=10.0,Z0MAX=50,PMIN=10.0,
     & ANGCUT=1./180.*PI,
     + D0MIN=1., Z0MIN=2.,VDCOST=0.95,DD0MAX=0.5)
C --
      INTEGER ITK_(2)
      LOGICAL OK
      PARAMETER (QQIRP=.00029979)
      EXTERNAL ALFIEL
      DATA NAPFRT / 0 / 
C --
#include "bmacro.h"
C-----------------------------------------------------------------------

      VDCOSMJ=.FALSE.

C -- access PFRF 0 bank, (maybe swapped to PFRF 3 if ALPHA job
      KPFRF=NLINK('PFRF',0)
      IF (KPFRF.EQ.0) KPFRF=NLINK('PFRF',3)
      IF (KPFRF.EQ.0) KPFRF=NLINK('PFRF',2)
      IF (KPFRF.EQ.0) GOTO 999
      IF( NAPFRT .EQ. 0 ) NAPFRT = NAMIND('PFRT')
      KPFRT=IW(NAPFRT)
      IF (KPFRT.EQ.0) GOTO 999

      NPFRF=LROWS(KPFRF)
      QMFLD = ALFIEL (QMFLD)*QQIRP
C
C -- Select cosmic track candidate


C -- at least one charged track
      IF (NPFRF.LE.1) GOTO 999
      CALL VZERO(ITK_,2)
      NTK=0

      DO 20 IPFRF=1,NPFRF
        OMEGA=RTABL(KPFRF,IPFRF,JPFRIR)
        TANL= RTABL(KPFRF,IPFRF,JPFRTL)
        PHI= RTABL(KPFRF,IPFRF,JPFRP0)
        D0= RTABL(KPFRF,IPFRF,JPFRD0)
        Z0= RTABL(KPFRF,IPFRF,JPFRZ0)

        IF (ABS(D0).GT.D0MAX) GOTO 20
C
        IF (ABS(Z0).GT.Z0MAX) GOTO 20

        COST=SQRT(TANL**2/(1+TANL**2))
C in VDET acceptance
        IF (COST.GT.VDCOST) GOTO 20

        IF (OMEGA.EQ.0.) GOTO 20
        P =ABS(-QMFLD/OMEGA*SQRT(1+TANL**2))
        IF (P.LT.PMIN) GOTO 20

C some TPC hits
        IPFRT = KROW(KPFRT,IPFRF)
        NTPC  = IW(IPFRT+JPFRNT)

        IF (NTPC.LT.NTPCUT) GOTO 20


C good track found
        NTK=NTK+1
        IF (NTK.GT.2) GOTO 999
        ITK_(NTK)=IPFRF

 20   CONTINUE

C two good tracks
      IF (NTK.NE.2) GOTO 999

C acolinearity
      PHI1= RTABL(KPFRF,ITK_(1),JPFRP0)
      PHI2= RTABL(KPFRF,ITK_(2),JPFRP0)+PI
      IF (PHI2.GT.TWOPI) PHI2=PHI2-TWOPI
      DPHI=ABS(PHI1-PHI2)
      IF (DPHI.GT.PI) DPHI=TWOPI-DPHI
      IF (ABS(DPHI).GT.ANGCUT) GOTO 999

      DTHETA=ATAN(RTABL(KPFRF,ITK_(1),JPFRTL))+
     &      ATAN(RTABL(KPFRF,ITK_(2),JPFRTL))
      IF (ABS(DTHETA).GT.ANGCUT) GOTO 999

C tracks should match in d0 (z0 not usable because of bad tpc timing)
      DD0=ABS(RTABL(KPFRF,ITK_(1),JPFRD0)+
     &        RTABL(KPFRF,ITK_(2),JPFRD0))
      IF (DD0.GT.DD0MAX) GOTO 999

C at least one track inconsistent with primary
      OK=.FALSE.
      DO I=1,2
        IF (ABS(RTABL(KPFRF,ITK_(I),JPFRD0)).GT.1) OK=.TRUE.
        IF (ABS(RTABL(KPFRF,ITK_(I),JPFRZ0)).GT.2) OK=.TRUE.
      ENDDO
      IF (.NOT.OK) GOTO 999

      VDCOSMJ=.TRUE.

  999 CONTINUE
      END
#endif
@


1.1
log
@First test of alephlib 214
@
text
@d22 1
a22 1
      EXTERNAL NAMIND
a32 1
      EXTERNAL NLINK
@
