head	1.2;
access;
symbols
	aleph316_2:1.2
	aleph316_1:1.2
	aleph316:1.2
	aleph315_7:1.2
	aleph315_6:1.2
	aleph315_5:1.2
	aleph315_4:1.2
	aleph315_3:1.2
	aleph315_2:1.2
	aleph315_1:1.2
	aleph315:1.2
	aleph314_2:1.2
	aleph314_1:1.2
	aleph314:1.2
	aleph313_1:1.2
	aleph313:1.2
	aleph312_1:1.2
	aleph312:1.2
	aleph311_1:1.2
	aleph311:1.2
	aleph310_3:1.2
	aleph310_2:1.2
	aleph310_1:1.2
	aleph310:1.2
	aleph309_1:1.2
	aleph309:1.2
	aleph308_3:1.1.1.1
	aleph308_2:1.1.1.1
	aleph308_1:1.1.1.1
	aleph308:1.1.1.1
	aleph307_6:1.1.1.1
	aleph307_5:1.1.1.1
	aleph307_4:1.1.1.1
	aleph307_2:1.1.1.1
	aleph307_1:1.1.1.1
	aleph307:1.1.1.1
	aleph306:1.1.1.1
	aleph305_4:1.1.1.1
	aleph305_3:1.1.1.1
	aleph305_2:1.1.1.1
	aleph305_1:1.1.1.1
	aleph305:1.1.1.1
	aleph304_5:1.1.1.1
	aleph304_4:1.1.1.1
	aleph304_3:1.1.1.1
	aleph304_2:1.1.1.1
	aleph304_1:1.1.1.1
	aleph304:1.1.1.1
	aleph303_3:1.1.1.1
	aleph303_2:1.1.1.1
	aleph303_1_mc1:1.1.1.1
	aleph303_1:1.1.1.1
	aleph303:1.1.1.1
	aleph302_9:1.1.1.1
	aleph302_8:1.1.1.1
	aleph302_7:1.1.1.1
	aleph302_6:1.1.1.1
	aleph302_5:1.1.1.1
	aleph302_4:1.1.1.1
	aleph302_3:1.1.1.1
	aleph302_2:1.1.1.1
	aleph302_1:1.1.1.1
	aleph302:1.1.1.1
	aleph216:1.1.1.1
	aleph215_3:1.1.1.1
	aleph215_2:1.1.1.1
	aleph215:1.1.1.1
	aleph214:1.1.1.1
	aleph213:1.1.1.1
	aleph212:1.1.1.1
	ALEPH212:1.1.1;
locks; strict;
comment	@c @;


1.2
date	98.09.01.12.05.57;	author cattanem;	state Exp;
branches;
next	1.1;

1.1
date	96.02.07.11.42.21;	author flr;	state Exp;
branches
	1.1.1.1;
next	;

1.1.1.1
date	96.02.07.11.42.22;	author flr;	state Exp;
branches;
next	;


desc
@@


1.2
log
@Alephlib 309.0
@
text
@      REAL FUNCTION IDDIST(IL,TIME,DDDT)
C-----------------------------------------------------------------------
CKEY ITC
C! Drift-distance calc. from drift-time relation.
C!
C!    Author    :- J.Sedgbeer 93/07/01
C!    Modified  :- J.Sedgbeer 95/06/10 Protect for v.large times beyond
C!                 reasonable input range of t-d relation.
C!    Modified  :- J.Sedgbeer 98/08/16 Modify to use polynom. or spline
C!                            drift-time coeffs. depending on the flag 
C!                            IFLGID in /IDRPCC/.
C!                            Note that only the array of coeffs (in 
C!                            /IDRPCC/) corresponding to IFLGID will
C!                            be set - the other array is undefined.
C!    Input:
C!      IL     /I  : ITC layer number
C!      TIME   /I  : Drift time - fully corrected (ns)
C!      need commons     /IDRPCC/ Drift-time relation.
C!                       /ITWICC/ ITC geom.
C!
C!    Output:
C!     IDDIST  /R  : Drift-distance (cm.). Max value = cell width.
C!     DDDT    /R  : dD/dt - gradient of drift-relation at time TIME
C!                      - for poly. set negative if v. large input time.
C!                      - for spline set =  0.0  if v. large input time. 
C!
C!    calls     :          none
C!    Libraries required : none
C!
C! Use drift relation coeffs. in /IDRPCC/ and TIME to calculate
C! the drift distance and the gradient dD/dt at time TIME.
C-----------------------------------------------------------------------
#ifndef DOC
      SAVE
C I/O commons etc.
#include "itwicc.h"
#include "idrpcc.h"
      INTEGER IL,I
      REAL TIME,DDDT,DIST
      REAL TN,FSP
      real T1,T2,A1,A2,A3,B2
C-----------------------------------------------------------------------
C
      DIST = 0.0
      DDDT = 0.0
C 
C-----------------------------------------------------------------------
C Polynomial drift-time parametrisation (for data up to 1996 and all MC)
C
      IF (IFLGID.EQ.0) THEN
C
        DO 10 I=MCOFID,1,-1
          DDDT = DDDT*TIME + FLOAT(I)*DTCOID(I,IL)
          DIST = (DIST + DTCOID(I,IL)) * TIME
   10   CONTINUE
C
C Check distance and gradient:
C If grad. neg. and at edge of cell but dist small then set dist.
        IF(DDDT.LT.0.) THEN
          IF(TIME.GT.200. .AND.(DIST.LT.0.35*CELWIT(IL))) THEN
            DIST = CELWIT(IL)
          ENDIF
        ELSE
          IF(DIST.GT.CELWIT(IL)) THEN
            DIST = CELWIT(IL)
            DDDT = -DDDT
          ENDIF
        ENDIF
C
C-----------------------------------------------------------------------
C Spline drift-time  parametrisation (for data from 1997 onwards)
C
      ELSE
C
        T1 = DSPLID(1,IL)
        T2 = DSPLID(2,IL)
        A1 = DSPLID(3,IL)
        A2 = DSPLID(4,IL)
        A3 = DSPLID(5,IL)
        B2 = 3.0 * (1.0 - (5.0*A1/3.0 + 7.0*A2/3.0 + 3.0*A3) )
C
        FSP  = 0.0
C
        IF (TIME.GT.0.0 .AND. TIME.LE.T1) THEN
          TN  = TIME/T1
          FSP = A1*TN + A2*TN**2 + A3*TN**3
          DDDT = A1 + 2.0*A2*TN + 3.0*A3*TN**2
          DDDT = DDDT * 0.5*CELWIT(IL) /T1
C
        ELSEIF (TIME.GT.T1 .AND. TIME.LE.T2) THEN
          TN  = (TIME-T1)/(T2-T1)
          FSP = (A1+A2+A3) + (A1 + 2.0*A2 + 3.0*A3)*TN + B2*TN**2 
     +                     - (A1 + 2.0*A2 + 3.0*A3 + 2.0*B2)*TN**3/3.
          DDDT =           + (A1 + 2.0*A2 + 3.0*A3)    + 2.0*B2*TN
     +                     - (A1 + 2.0*A2 + 3.0*A3 + 2.0*B2)*TN**2
          DDDT = DDDT * 0.5*CELWIT(IL) / (T2-T1)
C          
        ELSEIF (TIME.GT.T2) THEN
          FSP  = 1.0
          DDDT = 0.0
        ENDIF
C      
        DIST = FSP * 0.5*CELWIT(IL)

      ENDIF
C
      IDDIST = DIST
C
      END
#endif
@


1.1
log
@Initial revision
@
text
@d9 6
a14 1
C!
d24 2
a25 1
C!                         - set negative if v. large input time.
d40 2
d46 10
a55 4
      DO 10 I=MCOFID,1,-1
        DDDT = DDDT*TIME + FLOAT(I)*DTCOID(I,IL)
        DIST = (DIST + DTCOID(I,IL)) * TIME
   10 CONTINUE
d59 9
a67 3
      IF(DDDT.LT.0.) THEN
        IF(TIME.GT.200. .AND.(DIST.LT.0.35*CELWIT(IL))) THEN
          DIST = CELWIT(IL)
d69 4
d74 27
a100 3
        IF(DIST.GT.CELWIT(IL)) THEN
          DIST = CELWIT(IL)
          DDDT = -DDDT
d102 3
@


1.1.1.1
log
@import aleph212 from alws
@
text
@@
