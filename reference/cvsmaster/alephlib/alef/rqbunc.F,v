head	1.2;
access;
symbols
	aleph316_2:1.2
	aleph316_1:1.2
	aleph316:1.2
	aleph315_7:1.2
	aleph315_6:1.2
	aleph315_5:1.2
	aleph315_4:1.2
	aleph315_3:1.2
	aleph315_2:1.2
	aleph315_1:1.2
	aleph315:1.2
	aleph314_2:1.2
	aleph314_1:1.2
	aleph314:1.2
	aleph313_1:1.2
	aleph313:1.2
	aleph312_1:1.2
	aleph312:1.2
	aleph311_1:1.2
	aleph311:1.2
	aleph310_3:1.2
	aleph310_2:1.2
	aleph310_1:1.2
	aleph310:1.2
	aleph309_1:1.2
	aleph309:1.2
	aleph308_3:1.2
	aleph308_2:1.2
	aleph308_1:1.2
	aleph308:1.2
	aleph307_6:1.2
	aleph307_5:1.2
	aleph307_4:1.2
	aleph307_2:1.2
	aleph307_1:1.2
	aleph307:1.2
	aleph306:1.2
	aleph305_4:1.2
	aleph305_3:1.2
	aleph305_2:1.2
	aleph305_1:1.2
	aleph305:1.2
	aleph304_5:1.2
	aleph304_4:1.2
	aleph304_3:1.2
	aleph304_2:1.2
	aleph304_1:1.2
	aleph304:1.2
	aleph303_3:1.2
	aleph303_2:1.2
	aleph303_1_mc1:1.2
	aleph303_1:1.2
	aleph303:1.2
	aleph302_9:1.2
	aleph302_8:1.2
	aleph302_7:1.2
	aleph302_6:1.2
	aleph302_5:1.2
	aleph302_4:1.2
	aleph302_3:1.2
	aleph302_2:1.2
	aleph302_1:1.2
	aleph302:1.2
	aleph216:1.2
	aleph215_3:1.2
	aleph215_2:1.2
	aleph215:1.2
	aleph214:1.2
	aleph213:1.2
	aleph212:1.1.1.1
	ALEPH212:1.1.1;
locks; strict;
comment	@c @;


1.2
date	96.05.29.08.57.28;	author cattanem;	state Exp;
branches;
next	1.1;

1.1
date	96.02.07.11.40.42;	author flr;	state Exp;
branches
	1.1.1.1;
next	;

1.1.1.1
date	96.02.07.11.40.43;	author flr;	state Exp;
branches;
next	;


desc
@@


1.2
log
@RQBUNC updated for 1996 bunch spacing
@
text
@      SUBROUTINE RQBUNC(IBUN,INBU,NWAG,IQUA)
C---------------------------------------------------------------------
CKEY ALEF BUNCH
C - P.Comas, 28-APR-95
C! Read the bunch number to be used for reconstruction from EVEH.
C! The routine provides:
C!      1 The wagon identification
C!      2 The interbunch distance from LZZT
C!      3 The number of wagons per train from LZZT
C!      4 The quality of the wagon identification
C!
C!  Input  : EVEH, LZZT banks
C!  Output : IBUN
C!           Wagon identification in the bunch
C!              0         no measure
C!              1,2,3,4
C!
C!           INBU
C!           Interbunch distance in ns
C!
C!           NWAG
C!           Number of wagons per train
C!
C!           IQUA
C!           Quality flag of the wagon identification
C!              0         no information, bunch number is zero
C!              1         ambiguous, inconsistent
C!              2         probable
C!              3         sure, no discussion
C!
C! Modified: P.Comas, 24-MAY-96
C!            Set NWAG and INBU for '96.
C!            Avoid trying to get the info from the
C!             unreliable LZZT as the bunch train scheme
C!             doesn't change wihtin the year.
C!
C---------------------------------------------------------------------
#ifndef DOC
#include "bcs.h"
#include "evehjj.h"
C
      LOGICAL BUNCH
      SAVE IBUNS,INBUS,NWAGS,IQUAS,NEVEH,BUNCH
      SAVE NWADEF,INBDEF
      DATA IEOLD,IROLD/2*0/
C
#include "bmacro.h"
C---------------------------------------------------------------------

      IF (IROLD.EQ.0) THEN
        NEVEH = NAMIND('EVEH')
      ENDIF
C
      CALL ABRUEV (IRUN,IEVT)
C
C - Once per run ===========================================
C
      IF (IRUN.NE.IROLD) THEN
         IROLD = IRUN
         BUNCH = .TRUE.

         IF (IRUN.GE.41000) THEN
C '96 running
           NWADEF = 2
           INBDEF = 335
         ELSE
C '95 running
           NWADEF = 4
           INBDEF = 247
         ENDIF
C
C - NO bunch trains for MC and data < '95 except Nov 94 test
         IF (IRUN.LT.35000) THEN
           IF ((IRUN.NE.29989).AND.
     .         (IRUN.NE.29990).AND.
     .         (IRUN.NE.29991).AND.
     .         (IRUN.NE.30038).AND.
     .         (IRUN.NE.30042).AND.
     .         (IRUN.NE.30043).AND.
     .         (IRUN.NE.30044).AND.
     .         (IRUN.NE.30045).AND.
     .         (IRUN.NE.30046).AND.
     .         (IRUN.NE.30060).AND.
     .         (IRUN.NE.30248).AND.
     .         (IRUN.NE.30249).AND.
     .         (IRUN.NE.30250).AND.
     .         (IRUN.NE.30251).AND.
     .         (IRUN.NE.30252).AND.
     .         (IRUN.NE.30253).AND.
     .         (IRUN.NE.30254).AND.
     .         (IRUN.NE.30255).AND.
     .         (IRUN.NE.30380).AND.
     .         (IRUN.NE.30381) ) THEN
              BUNCH = .FALSE.
           ELSE
C          Run of the bunch trains test of November 1994
              INBUS = INBDEF
              NWAGS = NWADEF
           ENDIF
C
         ELSE
           INBUS = INBDEF
           NWAGS = NWADEF
         ENDIF
C
      ENDIF
C
C - Once per event ==================================================
C
      IF (IEVT.NE.IEOLD) THEN
         IEOLD = IEVT
         IF (BUNCH) THEN
C        bunch trains get bunch number and quality flag
            KEVEH = IW(NEVEH)
            KBUNCH = IW(KEVEH+JEVEM4)
            IF (IRUN.LT.35000) THEN
               IBUNS = IBITS (KBUNCH,0,3)
               IQUAS = 3
C        tagging of level 3 was not working at the beginning of 95
C        so set IBUN=1, IQUA=3 for runs in 4x1 configuration and
C        leave as before those in 4x2 configuration
            ELSE IF ( (IRUN.GE.35000).AND.(IRUN.LT.35718).AND.
     .         (IRUN.NE.35600).AND.
     .         (IRUN.NE.35601).AND.
     .         (IRUN.NE.35602).AND.
     .         (IRUN.NE.35603).AND.
     .         (IRUN.NE.35604).AND.
     .         (IRUN.NE.35609).AND.
     .         (IRUN.NE.35610).AND.
     .         (IRUN.NE.35611).AND.
     .         (IRUN.NE.35612).AND.
     .         (IRUN.NE.35613).AND.
     .         (IRUN.NE.35662) ) THEN
               IBUNS = 1
               IQUAS = 3
            ELSE
               IBUNS = IBITS (KBUNCH,27,3)
               IQUAS = IBITS (KBUNCH,30,2)
            ENDIF
         ELSE
C        NO bunch trains
            IBUNS = 1
            INBUS = 0
            NWAGS = 1
            IQUAS = 3
         ENDIF
      ENDIF
C
C - end ===========================================================
C
999   IBUN=IBUNS
      IQUA=IQUAS
      INBU=INBUS
      NWAG=NWAGS

      RETURN

      END
#endif
@


1.1
log
@Initial revision
@
text
@d31 6
a40 1
#include "lzztjj.h"
d43 1
a43 1
      SAVE IBUNS,INBUS,NWAGS,IQUAS,NLZZT,NEVEH,BUNCH
d51 1
a51 5
         NLZZT = NAMIND('LZZT')
         NEVEH = NAMIND('EVEH')
C      set defaults used when LZZT bank is missing
         NWADEF = 4
         INBDEF = 247
d61 10
a70 3
C
C - IF BUNCH get NWAGS number of wagons per train AND
C      INBUS interbunch distance in ns
d102 2
a103 23
C
C - Bunch trains in data => '95
C   get NWAGS and INBUS from LEP info
C
            KLZZT=IW(NLZZT)
            IF (KLZZT.LE.0) THEN
               IF (IW(6).GT.0) WRITE (IW(6),*)
     &                     ' RQBUNC: Bank LZZT not available:',
     &                     ' assuming 4 bunches in a train'
                INBUS = INBDEF
                NWAGS = NWADEF
            ELSE IF (IW(KLZZT+LMHLEN+JLZZBP).NE.
     .                       IW(KLZZT+LMHLEN+JLZZBM)) THEN
                IF(IW(6).GT.0) WRITE(IW(6),*)
     &            ' RQBUNC',-2,'Electron bunches different than ',
     &            ' positron bunches: assuming 4 bunches in a train'
                INBUS = INBDEF
                NWAGS = NWADEF
            ELSE
                INBUS = NINT (IW(KLZZT+LMHLEN+JLZZBS) * 2.84)
                NWAGS = IW(KLZZT+LMHLEN+JLZZBP)
                IF (INBUS.EQ.0) INBUS = INBDEF
            ENDIF
@


1.1.1.1
log
@import aleph212 from alws
@
text
@@
