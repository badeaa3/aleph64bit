1 ALPHA

 ========================================================================
                              ALPHA 126 News
                         Last Update: 11 October 2002  
 ========================================================================
   ALPHA version 126 first release on 21 November 2000
   All features of the successive correction files are summarized below ,
   starting from the most recent one. 
   For previous corrections, refer to the ALPHA 125 News file
 =================================================
  Correction file 126.18 released 11 October 2002
  Modification w.r.t. ALPHA 126.17 :
  * Fix in QRKSEC for Kingal code 5030 --> 5300
  * Suppress routines SICLID and SIBKCL from /util:
    they are also in ALEPHLIB
 =================================================
  Correction file 126.17 released 24 September 2002
  Modification w.r.t. ALPHA 126.16 :
  * Fix in QRKSEC when all RKSE banks are on ADBSCONS.DAF
 =================================================
  Correction file 126.16 released 15 March 2002
  Modification w.r.t. ALPHA 126.15 :
  * Mod in FIXPRL to apply the correction to the RL electron estimator
    uniformly to all MCarlo data (all years, all energies)
 =================================================
  Correction file 126.15 released 30 January 2002
  Modifications w.r.t. ALPHA 126.14 :
  - Fix in QRKSEC for datasets having same Ranmars
 =================================================
  Correction file 126.14 released  13 December 2001
  Modifications w.r.t. ALPHA 126.13 :
  - drop the PGAC bank in QFILL instead of QFGAMP if DRGA card present
  - allow to redo PGAC for MINIs > = 205 (mod in QFGAMP)
 =================================================
  Correction file 126.13 released  10 September 2001
  Modifications w.r.t. ALPHA 126.12 :
  - put some local vars. in double precision in QETHPH to avoid
    dividing by zero in some very rare MCarlo events.
 =================================================
  Correction file 126.12 released  26 July  2001
  Modifications w.r.t. ALPHA 126.11 :
  - replace a TAB character by spaces in FIXPRL to avoid VMS compilation
    errors
 =================================================
  Correction file 126.11 released  25 July  2001
  Modifications w.r.t. ALPHA 126.10 :
 ** In FIXPRL: modifs. from I. Debonis to get a centered RL estimator 
               for Year 2000 Monte Carlo datasets, using the data card UPRL 
 =================================================
  Correction file 126.10 released  21 June  2001
  Modifications w.r.t. ALPHA 126.09 :
 ** In QMINIT: call ADBCHK  for MINI MCarlo official productions 
 ** In QMRDSB: call ALEVNUM for MINI MCarlo official productions
 =================================================
  Correction file 126.09 released  6 June  2001
  Modifications w.r.t. ALPHA 126.08 :
 ** Mod in qrksec: adaptation to the new structure of the 'RKSE' bank
 =================================================
  Correction file 126.08 released  15 March  2001
  Modifications w.r.t. ALPHA 126.06 :
 ** Bug fix in qfkirev: protection against too many FILI cards
    + increase size of arrays in comdeck krsktrg.h
 =================================================
  Correction file 126.06 released  5 March  2001
  Modifications w.r.t. ALPHA 126.05 :
 ** Protection added in ndigh_e14 (E14 algorithm) which crashed for
    one event in the Year 2000 data
 =================================================
  Correction file 126.05 released  6 Feb  2001
  Modifications w.r.t. ALPHA 126.03 :
  ** New MINI version and structure : MINI 205 , allowing 
      * to fully redo the Energy Flow on the MINIs
      * to have all muon identification information for all tracks
      * to have all V0s on the MINIs, not only the first 30 ones  
      * to write the new KINGAL KW4F bank on MINIS
     - Mods in the MINI-writing package: MINBLN,MINBLO,MINMUI,MINTRA,
                                         MINFVB,MINSUM,MINMSC,MINVSN
     - Mods in the MINI-reading package: MINFIL,MINFRF,MINPSC,MINYV0 
                                         new routine MINPFR        
     - Mods in /pack: QFILL,QFCHGD,QFFRFT
     - mods in /enfl: ENFLW                                      
  ** New facility: printout of statistics of KINGAL generated triggers 
     at the end of a job, and user's routine to access these quantities:
     - new internal routines in alpha/pack: QFKIREV,QTKIREV
     - new user-callable routine QUKISTAT
       Usage:
       call qukistat(nfili,tfilis,lirun,nktrg,ifail)
 C-----------------------------------------------------------------------
 C  user access to  KINGAL statistics on generated triggers 
 C  at the end of job
 C To be called in QUTERM - Meaningful for MCarlos only !
 C Output arguments:
 C
 C  nfili     = number of FILI CARDS read during the job
 C  tfilis(i) = list of tapes_files read during the job, e.g. R01234_125
 C              i = 1 , nfili
 C              must be declared character*12 tfilis(100) in the
 C              calling subroutine
 C  lirun(i)  = list of runs read during the job (Integer lirun(100))
 C  nktrg(i)  = number of generated KINGAL trigger for dataset read on
 C              tfilis(i)   - To be declared as Integer nktrg(100)
 C  ifail     = 1 if more than 100 FILI cards read on input
 =================================================
  Correction file 126.03 released 20 Dec  2000
  Modifications w.r.t. ALPHA 126.02 :
  ** Bug fix (typo) in QRKSEC (caused a crash on Linux machines only)
 =================================================
  Correction file 126.02 released 12 Dec  2000
  Modifications w.r.t. ALPHA 126.01 :
  ** Mods in QDATA,QMNEWR,QRKSEC for the new structure of
             the RKSE bank
  ** New user's routine QURKSEC to access MCarlo's generated
     cross sections.
  Usage:
      CALL QURKSEC(XSEC,XSECE,NEVPR,XPROD,XPRODE)
  Output arguments:
   xsec   = cross section (in pb) generated for the present run
          = -1. if not found
   xsece  = error on xsecru (in pb) , =-1. if not found
   nevpr  = total number of events for the whole prouction
          = 0 if not found
   xprod  = cross section (in pb) for the whole production
          = -1. if not found
   xprode = error on xsecpr (in pb), =-1. if not found
 =================================================
  Correction file 126.01 released 21 Nov  2000
  Modifications w.r.t. ALPHA 125.17 :
  ** Fixes for precision problems, from S. Jezequel, in
     routines V0DKPT.F (QFN) and XXP0FL (QPi0) 
  ** New routine QRKSEC.F to give the MCarlo generated 
     cross-sections from bank RKSE (J. Boucrot)
     and call this routine in QMNEWR.F
  ** Modifs in QUREFIT,QFREFIT to get the track refit
     with new tracking corrections by default on POTs/DSTs

2 ENFL

  >>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>
    CKEY 
      First entry of <ENFLW> set of ALPHA ENFLW Energy Flow routines
  <<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<
     ADDVEC     Store particles in class kenflw (i.e. -3)
     BKINI      Find bos bank indices - phco, peco, pcob, pest, etdi, ewhe, pewi ..
     BLDPECO    Rescue routine to rebuild from etdi the banks peco and pest if the
     BUILDAL    Build the alpha environment for the energy flow particles
     CALINIT    Initialize ebneut, bos banks, etc...
     CHARAD     Store charged particles in class kenflw (-3)
     CREFLW     Reconstruction of the event (charged + neutral particles)
     CREFOL     Create and fill the efol bank for the mini
     DECTRG     Trigger decoding
     DLOCKS     Unlock all the alpha-particles which have been locked before
     DZZZ       Return the d0 of an enflw charged object.
     ENFJET     Create jet bank corresponding to efol/3 (enflw).
     ENFLW      Create the enfw section if the user wishes
     ENFWLIST   Give a listing of the enflw objects with their lock status
     EXTRHC     Extrapolates track icht up to the hcal to prepare a re-link
     GAMIXED    Determine the energy carried by neutral particles (photons, hadrons)
     GAMREAD    Interface for gampex (use of the bank pgac)
     GOODMOD    Compute pad - wire differences in ecal
     ICHEFW     Return the enflw track index for any copy of it
     IDDEDX     Return the de/dx for four mass hypotheses in the micro dsts
     IDELEC     Return electron identication information for
     IDMUON     Return muon identication information for the enflw track ich
     INFOGA     Return information about a photon iph
     INVALID    Check the validity of the row and the column number of a storey.
     KALPHA     Return the original alpha index of an enflw object.
     KSISTER    Return the alpha index of the sister of a v0 track
     LKFORM     Checks clusters
     LOOSES     Event counter
     LUMIAD     Correct lcal clusters for clusterization effect and e/pi ratio
     LUMICA     Lcal cleaning
     LUMIMOD    Compute pad - wire differences in lcal
     MDSTRD     Transform micro_dsts from enflw into sth usable in alpha
     MDSTWR     Write the enflw output in micro-dst format to avoid waste of time...
     PARSET     Read the enflw datacards
     PARTID     Identify charged particles as muon or electrons.
     PRESEL     Preselection (charged particles)
     PRESELFW   Preselection (charged particles)
     QHMOST     Get the 4 most energetic hcal towers in phco clusters
     QHNEWR     Get hcal trigger thresholds and noisy towers for each new run
     QUDPPL     Number of planes of ppob idp
     QUHCRG     Get region and module number for a specified phco cluster
     QUHNOI     Look for energy in hcal noisy towers; fill enoph in /cuphco/
     QUPHCO     Check phco quality
     QUPHDP     Fill part of /cuphco/
     QUPHPL     Scan htub bank looking for the number of planes (total and
     QUPHTR     Look for fired planes in the corresponding trigger segment
     QURHNT     Read hcal noisy towers from database
     QURHTR     Decode hcal wires trigger thresholds
     QUTWMX     Number of towers and energy of the more energetic tower
     REBUILD    Rebuild the original environment when reading the minidst.
     RELKHC     Force a link of an isolated hcal cluster to a tpc track
     SICAMOD    Compute the e/pi ratios for the sical
     V0SUM      Determine the energy carried by v0's (k0l, lambda , conv. photon)
     X1DISC     Discriminate level1 trigger signals

3 ADDVEC
         SUBROUTINE ADDVEC(VEC, IPARTK, LINK1, LINK2, WEIGHT)
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Store particles in class kenflw (i.e. -3)
     ipartk --  1 : charged particles
                2 : V0s
                3 : photons
                4 : neutral hadrons
                5 : lumi + low part of ECAL/HCAL
                6 : SiCAL clusters
                7 : killed clusters (Weight=1 : ECAL
                                     Weight=0 : HCAL)
     link1  --    : original JULIA index
     link2  --    : JULIA index of the sister (V0 tracks only)
     weight --    : prop. of ECAL energy (neutral hadrons only)
    Patrick Janot -- 19 Apr 1990
    Modif -- 01 oct 1990. store temporary particles in kreco
             13 jun 1992. use banks instead of QVEC
   
 
3 BKINI
         SUBROUTINE BKINI(IER)
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Find bos bank indices - phco, peco, pcob, pest, etdi, ewhe, pewi ..
    Patrick Janot -- 18 Apr 1990
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   CALINIT                                                                         
        |---- BKINI                                                                
                   |----  SIGN                                External             
                   |----  SQRT                                External             
                   |----  ABS                                 External             
                   |----  NINT                                External             
                   |----  KMATIX                              External             
                   |----  ATG                                 External             
                   |----  KCLARM                              External             
                   |----  IAND                                External             
                   |----  KLOCK0                              External             
                   |----  IABS                                External             
                   |----  VZERO                               External             
                   |----  PRTABL                              External             
                   |----  NAMIND                              External             
                   |----  IW                                  External             
                   |----  LROWS                               External             
                   |----  NLINK                               External             
   
 
3 BLDPECO
         SUBROUTINE BLDPECO(ICLU,ERAW)
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Rescue routine to rebuild from etdi the banks peco and pest if the
    cluster energy is crazy (namely < 0 )!
    Patrick Janot - 19 mai 1989
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   GOODMOD                                                                         
        |---- BLDPECO                                                              
                   |----  SIGN                                External             
                   |----  SQRT                                External             
                   |----  ABS                                 External             
                   |----  NINT                                External             
                   |----  KMATIX                              External             
                   |----  ATG                                 External             
                   |----  KCLARM                              External             
                   |----  IAND                                External             
                   |----  KLOCK0                              External             
                   |----  IABS                                External             
                   |----  ITABL                               External             
   
 
3 BUILDAL
         SUBROUTINE BUILDAL
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Build the alpha environment for the energy flow particles
    P. Janot   20 April 1990
    Modif -- 01 oct 1990 : Work only in class KRECO
    Modif -- 17 oct 1990 : Prevent particle energies to be > sqrt(s)/2
    Modif -- 17 oct 1990 : Incorporate particle identification
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   ENFLW                                                                           
        |---- BUILDAL                                                              
                   |----  SIGN                                External             
                   |----  SQRT                                External             
                   |----  ABS                                 External             
                   |----  NINT                                External             
                   |----  KMATIX                              External             
                   |----  ATG                                 External             
                   |----  KCLARM                              External             
                   |----  IAND                                External             
                   |----  KLOCK0                              External             
                   |----  IABS                                External             
                   |----  NLINK                               External             
                   |----  NAMIND                              External             
                   |----  CHAINT                              External             
                   |----  KVNEW                                                    
                   |----  KVSAVC                                                   
                   |----  VZERO                               External             
                   |----  KFRTOT                              External             
                   |----  KLSTOT                              External             
                   |----  KVSAVE                                                   
                   |----  QVSET4                                                   
                   |----  REBUILD                                                  
                   |----  LEFLG                               External             
                   |----  ELRTR                               External             
                   |----  ELRLG                               External             
                   |----  DZERO                               External             
                   |----  YSUDNT                              External             
                   |----  JISHAD                              External             
                   |----  JIMCF                               External             
                   |----  KALPHA                                                   
                   |----  ITKMUE                              External             
                   |----  LEFLAG                              External             
                   |----  ELRT                                External             
                   |----  ELRL                                External             
                   |----  QDB                                 External             
                   |----  XSUDNT                              External             
                   |----  IISHAD                              External             
                   |----  IIMCF                               External             
                   |----  KSISTER                                                  
   
 
3 CALINIT
         SUBROUTINE CALINIT(KEEP)
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Initialize ebneut, bos banks, etc...
    Patrick Janot -- 18 Apr 1990
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
              CALINIT                                                              
                   |----  SIGN                                External             
                   |----  SQRT                                External             
                   |----  ABS                                 External             
                   |----  NINT                                External             
                   |----  KMATIX                              External             
                   |----  ATG                                 External             
                   |----  KCLARM                              External             
                   |----  IAND                                External             
                   |----  KLOCK0                              External             
                   |----  IABS                                External             
                   |----  LOOSES                                                   
                   |----  BKINI                                                    
                   |----  SICAMOD                                                  
                   |----  LUMIMOD                                                  
                   |----  GOODMOD                                                  
                   |----  QUPHCO                                                   
                   |----  QHMOST                                                   
   
 
3 CHARAD
         SUBROUTINE CHARAD(ICH)
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Store charged particles in class kenflw (-3)
    Patrick Janot -- 19 May 1990
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   PRESEL                                                                          
   PRESELFW                                                                        
        |---- CHARAD                                                               
                   |----  SIGN                                External             
                   |----  SQRT                                External             
                   |----  ABS                                 External             
                   |----  NINT                                External             
                   |----  KMATIX                              External             
                   |----  ATG                                 External             
                   |----  KCLARM                              External             
                   |----  IAND                                External             
                   |----  KLOCK0                              External             
                   |----  IABS                                External             
                   |----  QCH                                 External             
                   |----  QX                                  External             
                   |----  QY                                  External             
                   |----  QZ                                  External             
                   |----  QE                                  External             
                   |----  ADDVEC                                                   
   
 
3 CREFLW
         SUBROUTINE CREFLW(IREJET)
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Reconstruction of the event (charged + neutral particles)
    using :
             . Charged particles
             . Reconstructed V0's,
             . ELectron and muon identification,
             . Photons identified by GAMPEC,
             . Remaining neutral hadronic energy from PCOB.
    Needs PECO,PEST,EWHE,ETDI,PHCO,PPOB,PCOB,PCRL ...etc banks
    Inputs:  -- Data cards to perform a preselection on charged
                particle.
    Outputs: -- irejet = 0 if bad event (not preselected, or
                           missing bank)
             -- Banks EFOL and EAUX
    P. Janot -- 18 April 1990
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   QUEFLO                                                                          
        |---- CREFLW                                                               
                   |----  SIGN                                External             
                   |----  SQRT                                External             
                   |----  ABS                                 External             
                   |----  NINT                                External             
                   |----  KMATIX                              External             
                   |----  ATG                                 External             
                   |----  KCLARM                              External             
                   |----  IAND                                External             
                   |----  KLOCK0                              External             
                   |----  IABS                                External             
                   |----  BKFMT                               External             
                   |----  PARSET                                                   
                   |----  NLINK                               External             
                   |----  NAMIND                              External             
                   |----  CHAINT                              External             
                   |----  NBANK                               External             
                   |----  BLIST                               External             
                   |----  BDROP                               External             
                   |----  VZERO                               External             
                   |----  LOOSES                                                   
                   |----  PRESELFW                                                 
                   |----  V0SUM                                                    
                   |----  BKTOW                               External             
                   |----  CALLCALINIT                         External             
                   |----  PARTID                                                   
                   |----  GAMIXED                                                  
                   |----  CREFOL                                                   
                   |----  ENFJET                                                   
                   |----  DLOCKS                                                   
                   |----  BKFRW                               External             
                   |----  IF                                  External             
                   |----  CALLBKFRW                           External             
                   |----  QVSCAL                                                   
                   |----  QWMESE                                                   
                   |----  NDROP                               External             
                   |----  WDROP                               External             
   
 
3 CREFOL
         SUBROUTINE CREFOL(KEEP)
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Create and fill the efol bank for the mini
    Patrick Janot -- 14 Jun 1992
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   CREFLW                                                                          
        |---- CREFOL                                                               
                   |----  SIGN                                External             
                   |----  SQRT                                External             
                   |----  ABS                                 External             
                   |----  NINT                                External             
                   |----  KMATIX                              External             
                   |----  ATG                                 External             
                   |----  KCLARM                              External             
                   |----  IAND                                External             
                   |----  KLOCK0                              External             
                   |----  IABS                                External             
                   |----  NBANK                               External             
                   |----  KCHT                                                     
                   |----  KTN                                 External             
                   |----  QX                                  External             
                   |----  QY                                  External             
                   |----  QZ                                  External             
                   |----  QE                                  External             
                   |----  ITKMUE                              External             
                   |----  AMIN1                               External             
                   |----  FLOAT                               External             
                   |----  BDROP                               External             
                   |----  BLIST                               External             
                   |----  NLINK                               External             
                   |----  X1REDO                              External             
                   |----  X1INI                               External             
                   |----  X1TRG                               External             
                   |----  ALTRIG                              External             
                   |----  QWMESE                                                   
   
 
3 DECTRG
         SUBROUTINE DECTRG(IPECO,ITRGT1,ITRGT2)
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Trigger decoding
    : L. Duflot (30 Aug 95) : Include new trigger schemes
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
              DECTRG                                                               
                   |----  SIGN                                External             
                   |----  SQRT                                External             
                   |----  ABS                                 External             
                   |----  NINT                                External             
                   |----  KMATIX                              External             
                   |----  ATG                                 External             
                   |----  KCLARM                              External             
                   |----  IAND                                External             
                   |----  KLOCK0                              External             
                   |----  IABS                                External             
                   |----  NLINK                               External             
                   |----  X1REDO                              External             
                   |----  X1TRG                               External             
                   |----  ALTRIG                              External             
                   |----  IBITS                               External             
   
 
3 DLOCKS
         SUBROUTINE DLOCKS
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Unlock all the alpha-particles which have been locked before
    during the energy flow algorithm
    Patrick Janot -- 21 june 1990
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   CREFLW                                                                          
        |---- DLOCKS                                                               
                   |----  SIGN                                External             
                   |----  SQRT                                External             
                   |----  ABS                                 External             
                   |----  NINT                                External             
                   |----  KMATIX                              External             
                   |----  ATG                                 External             
                   |----  KCLARM                              External             
                   |----  IAND                                External             
                   |----  KLOCK0                              External             
                   |----  IABS                                External             
                   |----  QLZER                                                    
                   |----  QLUTRK                                                   
                   |----  XLOCK                               External             
                   |----  KPDIR                                                    
                   |----  IF                                  External             
                   |----  KFOLLO                              External             
   
 
3 DZZZ
         FUNCTION DZZZ(ICH)
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Return the d0 of an enflw charged object.
    Patrick Janot --  24 June 1991
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
              DZZZ                                                                 
                   |----  ICHEFW                                                   
   
 
3 ENFJET
         SUBROUTINE ENFJET(IREJET)
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Create jet bank corresponding to efol/3 (enflw).
       Author: Patrick Janot      18-Jul-92
       Input  : EFOL bank number 3
    Outputs: -- irejet = 0 if no room for bank EJET
                EJET bank number 3
       Called by CREFLW
       The jet link in EFOL/3 is supplied.
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   CREFLW                                                                          
   QFEFLO                                                                          
        |---- ENFJET                                                               
                   |----  SIGN                                External             
                   |----  SQRT                                External             
                   |----  ABS                                 External             
                   |----  NINT                                External             
                   |----  KMATIX                              External             
                   |----  ATG                                 External             
                   |----  KCLARM                              External             
                   |----  IAND                                External             
                   |----  KLOCK0                              External             
                   |----  IABS                                External             
                   |----  NLINK                               External             
                   |----  NAMIND                              External             
                   |----  CHAINT                              External             
                   |----  ABRUEV                              External             
                   |----  GETLEP                              External             
                   |----  FJMMCL                              External             
                   |----  NBANK                               External             
                   |----  BLIST                               External             
                   |----  QWMESE                                                   
   
 
3 ENFLW
         SUBROUTINE ENFLW(IREJET)
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Create the enfw section if the user wishes
    Inputs:  -- Bank EFOL, EAUX for the MiniDST
             -- Bank FWEV, FWPA for the MicroDST
    Outputs: -- ALPHA section ENFW
    P. Janot -- 22 august 1992
    Modified by A. Venturi 30 Nov 2000
             -- removed cut on maximum charged energy
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
              ENFLW                                                                
                   |----  SIGN                                External             
                   |----  SQRT                                External             
                   |----  ABS                                 External             
                   |----  NINT                                External             
                   |----  KMATIX                              External             
                   |----  ATG                                 External             
                   |----  KCLARM                              External             
                   |----  IAND                                External             
                   |----  KLOCK0                              External             
                   |----  IABS                                External             
                   |----  NLINK                               External             
                   |----  PARSET                                                   
                   |----  MDSTRD                                                   
                   |----  BUILDAL                                                  
                   |----  KLSTOT                              External             
                   |----  KFRTOT                              External             
                   |----  QE                                  External             
   
 
3 ENFWLIST
         SUBROUTINE ENFWLIST(ICLASS)
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Give a listing of the enflw objects with their lock status
    P. Janot   02 october 1990
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
              ENFWLIST                                                             
                   |----  SIGN                                External             
                   |----  SQRT                                External             
                   |----  ABS                                 External             
                   |----  NINT                                External             
                   |----  KMATIX                              External             
                   |----  ATG                                 External             
                   |----  KCLARM                              External             
                   |----  IAND                                External             
                   |----  KLOCK0                              External             
                   |----  IABS                                External             
                   |----  KFRTOT                              External             
                   |----  KLSTOT                              External             
                   |----  KSAME                               External             
                   |----  KALPHA                                                   
                   |----  KSISTER                                                  
                   |----  IDMUON                                                   
                   |----  IDELEC                                                   
                   |----  INFOGA                                                   
                   |----  KPDIR                                                    
   
 
3 EXTRHC
         SUBROUTINE EXTRHC(ICHT)
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Extrapolates track icht up to the hcal to prepare a re-link
    with isolated HCAL clusters.
    Janot.   13-jun-1991
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   PARTID                                                                          
        |---- EXTRHC                                                               
                   |----  SIGN                                External             
                   |----  SQRT                                External             
                   |----  ABS                                 External             
                   |----  NINT                                External             
                   |----  KMATIX                              External             
                   |----  ATG                                 External             
                   |----  KCLARM                              External             
                   |----  IAND                                External             
                   |----  KLOCK0                              External             
                   |----  IABS                                External             
                   |----  QCH                                 External             
                   |----  QFRFIR                              External             
                   |----  QFRFTL                              External             
                   |----  QFRFP0                              External             
                   |----  QFRFD0                              External             
                   |----  QFRFZ0                              External             
                   |----  QFRFAL                              External             
                   |----  EXPFRF                              External             
                   |----  KNECAL                              External             
                   |----  KECAL                               External             
                   |----  SIN                                 External             
                   |----  QPECTH                              External             
                   |----  COS                                 External             
                   |----  QPECPH                              External             
                   |----  QE                                  External             
                   |----  XLOCK                               External             
                   |----  QPECEC                              External             
                   |----  QM                                  External             
                   |----  QPECE1                              External             
                   |----  QPECE2                              External             
                   |----  UCOPY                               External             
                   |----  QPT                                 External             
                   |----  QP                                  External             
                   |----  VZERO                               External             
                   |----  AUHCYL                              External             
                   |----  AULCYL                              External             
   
 
3 GAMIXED
         SUBROUTINE GAMIXED
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Determine the energy carried by neutral particles (photons, hadrons)
    isolated or within charged clusters
    Patrick Janot -- 18 Apr 1990
    Modif -- 17 oct 1990. Prevent Neutr. Had. Energies to exceed QELEP/2
    Modif -- 17 oct 1990. Store particle id information
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   CREFLW                                                                          
        |---- GAMIXED                                                              
                   |----  SIGN                                External             
                   |----  SQRT                                External             
                   |----  ABS                                 External             
                   |----  NINT                                External             
                   |----  KMATIX                              External             
                   |----  ATG                                 External             
                   |----  KCLARM                              External             
                   |----  IAND                                External             
                   |----  KLOCK0                              External             
                   |----  IABS                                External             
                   |----  IW                                  External             
                   |----  KJQDET                              External             
                   |----  EVTVER                              External             
                   |----  VZERO                               External             
                   |----  KAG                                 External             
                   |----  NPHOCH                              External             
                   |----  NPHOCR                              External             
                   |----  LOOSES                                                   
                   |----  KPDIR                                                    
                   |----  IF                                  External             
                   |----  KPHCPC                              External             
                   |----  XLOCK                               External             
                   |----  KTN                                 External             
                   |----  IOKPH                               External             
                   |----  QLTRK                                                    
                   |----  QPHCEC                              External             
                   |----  COS                                 External             
                   |----  QPHCTH                              External             
                   |----  SIN                                 External             
                   |----  QPHCPH                              External             
                   |----  ADDVEC                                                   
                   |----  ENOPH                               External             
                   |----  KNECAL                              External             
                   |----  KECAL                               External             
                   |----  QPECER                              External             
                   |----  ELUPH                               External             
                   |----  KNCHGD                              External             
                   |----  KCHGD                               External             
                   |----  QE                                  External             
                   |----  KFOLLO                              External             
                   |----  KPECPC                              External             
                   |----  KPECKD                              External             
                   |----  NAMIND                              External             
                   |----  SICLID                                                   
                   |----  LUMIAD                                                   
                   |----  NLINK                               External             
                   |----  LUMICA                                                   
                   |----  LKFORM                                                   
                   |----  QPECEC                              External             
                   |----  QPECTH                              External             
                   |----  QPECPH                              External             
   
 
3 GAMREAD
         SUBROUTINE GAMREAD(ICLUS,EMIGA,NNGA,GAMVE,IRTFG)
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Interface for gampex (use of the bank pgac)
    Patrick Janot -- 30 sept 1991, Modified for PGPC -- 15 April 1993
                                   Modified for PGAC -- 30  oct  1994
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
              GAMREAD                                                              
                   |----  SIGN                                External             
                   |----  SQRT                                External             
                   |----  ABS                                 External             
                   |----  NINT                                External             
                   |----  KMATIX                              External             
                   |----  ATG                                 External             
                   |----  KCLARM                              External             
                   |----  IAND                                External             
                   |----  KLOCK0                              External             
                   |----  IABS                                External             
                   |----  VZERO                               External             
                   |----  NLINK                               External             
   
 
3 GOODMOD
         SUBROUTINE GOODMOD(KEEP)
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Compute pad - wire differences in ecal
    Patrick Janot -- 18 Apr 1990
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   CALINIT                                                                         
        |---- GOODMOD                                                              
                   |----  SIGN                                External             
                   |----  SQRT                                External             
                   |----  ABS                                 External             
                   |----  NINT                                External             
                   |----  KMATIX                              External             
                   |----  ATG                                 External             
                   |----  KCLARM                              External             
                   |----  IAND                                External             
                   |----  KLOCK0                              External             
                   |----  IABS                                External             
                   |----  VZERO                               External             
                   |----  EPAD                                External             
                   |----  EWIRE                               External             
                   |----  EDIFF                               External             
                   |----  ITABL                               External             
                   |----  LOOSES                                                   
                   |----  NAMIND                              External             
                   |----  IW                                  External             
                   |----  RTABL                               External             
                   |----  BLDPECO                                                  
                   |----  IBITS                               External             
                   |----  INVALID                                                  
                   |----  EMDTOW                              External             
   
 
3 ICHEFW
         FUNCTION ichefw(ich)
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Return the enflw track index for any copy of it
    Input:  -- ich:   The track index
    Output  -- ichefw: the corresponding ENFLW track index
    Patrick Janot - 24 Sep 1991
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   DZZZ                                                                            
   IDELEC                                                                          
   IDMUON                                                                          
   INFOGA                                                                          
   KALPHA                                                                          
   KSISTER                                                                         
        |---- ICHEFW                                                               
                   |----  SIGN                                External             
                   |----  SQRT                                External             
                   |----  ABS                                 External             
                   |----  NINT                                External             
                   |----  KMATIX                              External             
                   |----  ATG                                 External             
                   |----  KCLARM                              External             
                   |----  IAND                                External             
                   |----  KLOCK0                              External             
                   |----  IABS                                External             
                   |----  IF                                  External             
   
 
3 IDDEDX
         SUBROUTINE iddedx(itk,hypele,hyppio,hypkao,hyppro)
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Return the de/dx for four mass hypotheses in the micro dsts
    Input  : itk, charged particle ALPHA index in the ENFW section
                  between kfrtot(1) and klstot(2)
    Output : (I_meas-I_exp)/sigma_exp
                o Hypele : electron mass hypothesis
                o Hyppio : pion     mass hypothesis
                o Hypkao : kaon     mass hypothesis
                o Hyppro : proton   mass hypothesis
    Patrick Janot -- 12 Jan 1995
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
              IDDEDX                                                               
                   |----  KFRTOT                              External             
                   |----  KLSTOT                              External             
   
 
3 IDELEC
         SUBROUTINE IDELEC(ICH,IDIP,IDIF,RT,RL,LIDT)
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Return electron identication information for
    the ENFLW (CHARGED!) track ich.
    Input:  -- ich:   The ENFLW track
    Output  -- idip: 1 if electron (EIDT flag)
                     0 if not electron
                    -1 if no EIDT or p<800MeV/c
            -- idif: Quality flag  (EIDT flag)
            -- rt  : Transverse estimator
            -- rl  : Transverse estimator
            -- lidt: local identification flag
    Patrick Janot - 27 June 1991
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   ENFWLIST                                                                        
        |---- IDELEC                                                               
                   |----  SIGN                                External             
                   |----  SQRT                                External             
                   |----  ABS                                 External             
                   |----  NINT                                External             
                   |----  KMATIX                              External             
                   |----  ATG                                 External             
                   |----  KCLARM                              External             
                   |----  IAND                                External             
                   |----  KLOCK0                              External             
                   |----  IABS                                External             
                   |----  ICHEFW                                                   
                   |----  IF                                  External             
                   |----  KFRTOT                              External             
                   |----  LEFLG                               External             
                   |----  ELRTR                               External             
                   |----  ELRLG                               External             
   
 
3 IDMUON
         SUBROUTINE IDMUON(ICH,NEXP,NFIR,N10,N03,NMU,IDF,EHC,LIDT,
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
        .                  xmult,rapp,ang,ishad,sudnt,imcf)
   Return muon identication information for the enflw track ich
    Input:  -- ich:   The ENFLW track
    Output: -- nexp: number of expected planes in the HCAL
            -- nfir: number of fired    planes in the HCAL
            -- n10 : number of fired    planes in the last 10
            -- n03 : number of fired    planes in the last 3
            -- nmu : number of fired    muon chamber layers
            -- idf : official ALEPH muon flag
            -- ehc : energy of he PHCO associated to ich
            -- lidt: local identification flag
            -- xmult --> imcf : same definition as in QMUIDO
    Patrick Janot - 27 June 1991
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   ENFWLIST                                                                        
        |---- IDMUON                                                               
                   |----  SIGN                                External             
                   |----  SQRT                                External             
                   |----  ABS                                 External             
                   |----  NINT                                External             
                   |----  KMATIX                              External             
                   |----  ATG                                 External             
                   |----  KCLARM                              External             
                   |----  IAND                                External             
                   |----  KLOCK0                              External             
                   |----  IABS                                External             
                   |----  ICHEFW                                                   
                   |----  KFRTOT                              External             
                   |----  JISHAD                              External             
                   |----  YSUDNT                              External             
                   |----  JIMCF                               External             
   
 
3 INFOGA
         SUBROUTINE INFOGA(IPH,ICLUS,NCHFLG,NCRFLG,NGA)
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Return information about a photon iph
    Input:   -- IPH,    the photon index (ENFLW object)
    Output:  -- ICLUS,  the original index of the ECALobject
             -- NCHFLG, 1 if the photon has been extracted from
                          a charged cluster, 0 otherwise
             -- NCRFLG, 1 if the photon is in a crack region
                        0 otherwise.
             -- NG,     number of extracted photons in cluster ICLUS
    Patrick Janot - 02 July 1991
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   ENFWLIST                                                                        
   MDSTWR                                                                          
        |---- INFOGA                                                               
                   |----  ICHEFW                                                   
                   |----  KFRTOT                              External             
                   |----  KLSTOT                              External             
                   |----  KALPHA                                                   
                   |----  NPHOCH                              External             
                   |----  NPHOCR                              External             
                   |----  IF                                  External             
   
 
3 INVALID
         INTEGER FUNCTION INVALID(IROW,ICOL)
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Check the validity of the row and the column number of a storey.
    Patrick Janot -- 30 Sept 1992
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   GOODMOD                                                                         
   LKFORM                                                                          
        |---- INVALID                                                              
                   |----  LOOSES                                                   
   
 
3 KALPHA
         FUNCTION KALPHA(ICH)
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Return the original alpha index of an enflw object.
    Warning: It works only with charged particles and photons
    since the neutral hadrons are oftently made of several
    ECAL and HCAL objects...  Return 0 in that case.
    Patrick Janot - 27 June 1991
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   BUILDAL                                                                         
   ENFWLIST                                                                        
   INFOGA                                                                          
        |---- KALPHA                                                               
                   |----  ICHEFW                                                   
                   |----  KFRTOT                              External             
                   |----  KLSTOT                              External             
                   |----  KAN                                 External             
                   |----  KAV                                 External             
                   |----  KAG                                 External             
   
 
3 KSISTER
         FUNCTION KSISTER(ICH)
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Return the alpha index of the sister of a v0 track
    Warning: It works only with V0 tracks!!!
    Patrick Janot - 18 Nov. 1991
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   BUILDAL                                                                         
   ENFWLIST                                                                        
   MDSTWR                                                                          
        |---- KSISTER                                                              
                   |----  ICHEFW                                                   
                   |----  KFRTOT                              External             
                   |----  KLSTOT                              External             
                   |----  KAM                                 External             
   
 
3 LKFORM
         FUNCTION LKFORM(ICLUEC,IECOBJ,CORFAC)
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Checks clusters
    Returns  1 if the cluster is good ,  0 otherwise
    diftot = difference pad-wire in the cluster module .
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   GAMIXED                                                                         
        |---- LKFORM                                                               
                   |----  SIGN                                External             
                   |----  SQRT                                External             
                   |----  ABS                                 External             
                   |----  NINT                                External             
                   |----  KMATIX                              External             
                   |----  ATG                                 External             
                   |----  KCLARM                              External             
                   |----  IAND                                External             
                   |----  KLOCK0                              External             
                   |----  IABS                                External             
                   |----  RTABL                               External             
                   |----  LOOSES                                                   
                   |----  ITABL                               External             
                   |----  IBITS                               External             
                   |----  INVALID                                                  
                   |----  EMDTOW                              External             
                   |----  EDIFF                               External             
                   |----  EPAD                                External             
                   |----  EWIRE                               External             
                   |----  IW                                  External             
                   |----  QPECE1                              External             
                   |----  QPECE2                              External             
                   |----  KNHCAL                              External             
                   |----  AMAX1                               External             
                   |----  QPECER                              External             
                   |----  IF                                  External             
   
 
3 LOOSES
         SUBROUTINE LOOSES(ROUTIN,NCUT)
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Event counter
    Francois Le Diberder -- 1985
    Rewritten in Fortran 77 . Patrick Janot -- 18 Apr 1990
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   ADDVEC                                                                          
   CALINIT                                                                         
   CREFLW                                                                          
   GAMIXED                                                                         
   GOODMOD                                                                         
   INVALID                                                                         
   LKFORM                                                                          
   LUMICA                                                                          
   PARTID                                                                          
   PRESEL                                                                          
   PRESELFW                                                                        
        |---- LOOSES                                                               
                   |----  VZERO                               External             
   
 
3 LUMIAD
         SUBROUTINE LUMIAD(IECOBJ)
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Correct lcal clusters for clusterization effect and e/pi ratio
    Patrick Janot -- 26 April 1990
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   GAMIXED                                                                         
        |---- LUMIAD                                                               
                   |----  SIGN                                External             
                   |----  SQRT                                External             
                   |----  ABS                                 External             
                   |----  NINT                                External             
                   |----  KMATIX                              External             
                   |----  ATG                                 External             
                   |----  KCLARM                              External             
                   |----  IAND                                External             
                   |----  KLOCK0                              External             
                   |----  IABS                                External             
                   |----  KPECKD                              External             
                   |----  QPECE1                              External             
                   |----  QPECE2                              External             
                   |----  COS                                 External             
                   |----  QPECTH                              External             
                   |----  SICAPI                              External             
                   |----  QPECEC                              External             
                   |----  QPECPH                              External             
                   |----  SIN                                 External             
                   |----  ADDVEC                                                   
                   |----  KTN                                 External             
                   |----  QLTRK                                                    
   
 
3 LUMICA
         SUBROUTINE LUMICA(IECOBJ,IOK)
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Lcal cleaning
    Patrick Janot -- 26 April 1990
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   GAMIXED                                                                         
        |---- LUMICA                                                               
                   |----  SIGN                                External             
                   |----  SQRT                                External             
                   |----  ABS                                 External             
                   |----  NINT                                External             
                   |----  KMATIX                              External             
                   |----  ATG                                 External             
                   |----  KCLARM                              External             
                   |----  IAND                                External             
                   |----  KLOCK0                              External             
                   |----  IABS                                External             
                   |----  KTN                                 External             
                   |----  QPECER                              External             
                   |----  ITABL                               External             
                   |----  PADL                                External             
                   |----  WIRL                                External             
                   |----  DIFL                                External             
                   |----  HFILL                               External             
                   |----  LOOSES                                                   
                   |----  QE                                  External             
                   |----  IW                                  External             
                   |----  QPECE1                              External             
                   |----  QPECE2                              External             
   
 
3 LUMIMOD
         SUBROUTINE LUMIMOD
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Compute pad - wire differences in lcal
    Patrick Janot - 16 May 1990
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   CALINIT                                                                         
        |---- LUMIMOD                                                              
                   |----  SIGN                                External             
                   |----  SQRT                                External             
                   |----  ABS                                 External             
                   |----  NINT                                External             
                   |----  KMATIX                              External             
                   |----  ATG                                 External             
                   |----  KCLARM                              External             
                   |----  IAND                                External             
                   |----  KLOCK0                              External             
                   |----  IABS                                External             
                   |----  VZERO                               External             
                   |----  WIRL                                External             
                   |----  PADL                                External             
                   |----  DIFL                                External             
                   |----  NAMIND                              External             
                   |----  IW                                  External             
                   |----  RTABL                               External             
                   |----  ITABL                               External             
   
 
3 MDSTRD
         SUBROUTINE MDSTRD(LUMOK,HVOK,RUNQUA,IER)
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Transform micro_dsts from enflw into sth usable in alpha
    Patrick Janot -- 23 August 1990
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   ENFLW                                                                           
        |---- MDSTRD                                                               
                   |----  SIGN                                External             
                   |----  SQRT                                External             
                   |----  ABS                                 External             
                   |----  NINT                                External             
                   |----  KMATIX                              External             
                   |----  ATG                                 External             
                   |----  KCLARM                              External             
                   |----  IAND                                External             
                   |----  KLOCK0                              External             
                   |----  IABS                                External             
                   |----  BKFMT                               External             
                   |----  KPCOMP                                                   
                   |----  KFPADR                                                   
                   |----  NLINK                               External             
                   |----  NAMIND                              External             
                   |----  FLOAT                               External             
                   |----  IW                                  External             
                   |----  RW                                  External             
                   |----  BDROP                               External             
                   |----  NBANK                               External             
                   |----  KVNEW                                                    
                   |----  KVSAVC                                                   
                   |----  VZERO                               External             
                   |----  KFRTOT                              External             
                   |----  KLSTOT                              External             
                   |----  RTABL                               External             
                   |----  AMAX1                               External             
                   |----  QVSET4                                                   
                   |----  QVADDN                                                   
                   |----  QSBITM                                                   
   
 
3 MDSTWR
         SUBROUTINE MDSTWR(LOUT,FNAME,ATYPE,FDEVI,ILAST)
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Write the enflw output in micro-dst format to avoid waste of time...
    22 Aug 1990 -- Patrick Janot.
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
              MDSTWR                                                               
                   |----  SIGN                                External             
                   |----  SQRT                                External             
                   |----  ABS                                 External             
                   |----  NINT                                External             
                   |----  KMATIX                              External             
                   |----  ATG                                 External             
                   |----  KCLARM                              External             
                   |----  IAND                                External             
                   |----  KLOCK0                              External             
                   |----  IABS                                External             
                   |----  BKFMT                               External             
                   |----  AOPENW                              External             
                   |----  X1INI                               External             
                   |----  NLINK                               External             
                   |----  NBANK                               External             
                   |----  BKRHAW                              External             
                   |----  BWRITE                              External             
                   |----  BDROP                               External             
                   |----  X1REDO                              External             
                   |----  X1TRG                               External             
                   |----  ALTRIG                              External             
                   |----  GETLUM                              External             
                   |----  KLSTOT                              External             
                   |----  KFRTOT                              External             
                   |----  KSAME                               External             
                   |----  QX                                  External             
                   |----  QY                                  External             
                   |----  QZ                                  External             
                   |----  KTN                                 External             
                   |----  KSISTER                                                  
                   |----  INFOGA                                                   
                   |----  QP                                  External             
                   |----  AMAX1                               External             
                   |----  ELRTR                               External             
                   |----  MIN0                                External             
                   |----  ELRLG                               External             
                   |----  LEFLG                               External             
                   |----  DZERO                               External             
                   |----  QDEDX                                                    
   
 
3 PARSET
         SUBROUTINE PARSET
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Read the enflw datacards
    Patrick Janot -- 21 june 1990
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   CREFLW                                                                          
   ENFLW                                                                           
        |---- PARSET                                                               
                   |----  NAMIND                              External             
   
 
3 PARTID
         SUBROUTINE PARTID
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Identify charged particles as muon or electrons.
    Patrick Janot -- 07 Jun 1990
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   CREFLW                                                                          
        |---- PARTID                                                               
                   |----  SIGN                                External             
                   |----  SQRT                                External             
                   |----  ABS                                 External             
                   |----  NINT                                External             
                   |----  KMATIX                              External             
                   |----  ATG                                 External             
                   |----  KCLARM                              External             
                   |----  IAND                                External             
                   |----  KLOCK0                              External             
                   |----  IABS                                External             
                   |----  IW                                  External             
                   |----  KJQDET                              External             
                   |----  VZERO                               External             
                   |----  ITKMUE                              External             
                   |----  NPELEC                              External             
                   |----  LEFLAG                              External             
                   |----  ELRT                                External             
                   |----  ELRL                                External             
                   |----  XSUDNT                              External             
                   |----  IISHAD                              External             
                   |----  IIMCF                               External             
                   |----  XLOCK                               External             
                   |----  XEID                                External             
                   |----  KEIDIP                              External             
                   |----  KEIDIF                              External             
                   |----  QEIDRI                              External             
                   |----  QP                                  External             
                   |----  EXTRHC                                                   
                   |----  QMUIDO                                                   
                   |----  XHMA                                External             
                   |----  QHMAED                              External             
                   |----  LOOSES                                                   
                   |----  KNHCAL                              External             
                   |----  KHCAL                               External             
                   |----  QE                                  External             
                   |----  KTN                                 External             
                   |----  MAX0                                External             
                   |----  FLOAT                               External             
                   |----  QLTRK                                                    
                   |----  QEIDEC                              External             
                   |----  AMIN1                               External             
                   |----  KNECAL                              External             
                   |----  KECAL                               External             
   
 
3 PRESEL
         SUBROUTINE PRESEL(KEEP)
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Preselection (charged particles)
    Patrick Janot -- 18 Apr 1990
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
              PRESEL                                                               
                   |----  SIGN                                External             
                   |----  SQRT                                External             
                   |----  ABS                                 External             
                   |----  NINT                                External             
                   |----  KMATIX                              External             
                   |----  ATG                                 External             
                   |----  KCLARM                              External             
                   |----  IAND                                External             
                   |----  KLOCK0                              External             
                   |----  IABS                                External             
                   |----  NAMIND                              External             
                   |----  NLINK                               External             
                   |----  VZERO                               External             
                   |----  QLTRK                                                    
                   |----  KFRTNT                              External             
                   |----  XLOCK                               External             
                   |----  KEIDIP                              External             
                   |----  KEIDIF                              External             
                   |----  QP                                  External             
                   |----  AMIN1                               External             
                   |----  QEIDEC                              External             
                   |----  QCT                                 External             
                   |----  QVSCAL                                                   
                   |----  CHARAD                                                   
                   |----  QE                                  External             
                   |----  KSAME                               External             
                   |----  LOOSES                                                   
   
 
3 PRESELFW
         SUBROUTINE PRESELFW(KEEP)
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Preselection (charged particles)
    Patrick Janot -- 18 Apr 1990
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   CREFLW                                                                          
        |---- PRESELFW                                                             
                   |----  SIGN                                External             
                   |----  SQRT                                External             
                   |----  ABS                                 External             
                   |----  NINT                                External             
                   |----  KMATIX                              External             
                   |----  ATG                                 External             
                   |----  KCLARM                              External             
                   |----  IAND                                External             
                   |----  KLOCK0                              External             
                   |----  IABS                                External             
                   |----  NAMIND                              External             
                   |----  NLINK                               External             
                   |----  VZERO                               External             
                   |----  QLTRK                                                    
                   |----  KFRTNT                              External             
                   |----  XLOCK                               External             
                   |----  KEIDIP                              External             
                   |----  KEIDIF                              External             
                   |----  QP                                  External             
                   |----  AMIN1                               External             
                   |----  QEIDEC                              External             
                   |----  QCT                                 External             
                   |----  QVSCAL                                                   
                   |----  CHARAD                                                   
                   |----  QE                                  External             
                   |----  KSAME                               External             
                   |----  LOOSES                                                   
   
 
3 QHMOST
         SUBROUTINE QHMOST(IER)
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Get the 4 most energetic hcal towers in phco clusters
    Author   G.Ganis      2 July 1991
    Input    None
    Output         following arrays are dimensioned 4x200
                   for cluster  j-th. COMMON /CUMOST/
             ETW(i,j) energy in the 4 most energetic towers ( GeV )
                      i=1,...,4  descending order
             TWH(i,j) theta of i-th tower ( radians )
             PWH(i,j) phi   of i-th tower ( radians )
             JST(i,j) position in PHST bank of i-th tower
             IER= 0  ok
                  1  PHCO or PHST bank missing
                  2  PHCO too large
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   CALINIT                                                                         
        |---- QHMOST                                                               
                   |----  SIGN                                External             
                   |----  SQRT                                External             
                   |----  ABS                                 External             
                   |----  NINT                                External             
                   |----  KMATIX                              External             
                   |----  ATG                                 External             
                   |----  KCLARM                              External             
                   |----  IAND                                External             
                   |----  KLOCK0                              External             
                   |----  IABS                                External             
                   |----  NLINK                               External             
                   |----  VZERO                               External             
                   |----  HUSRAN                              External             
   
 
3 QHNEWR
         SUBROUTINE QHNEWR
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Get hcal trigger thresholds and noisy towers for each new run
    Gerardo Ganis -- 1989
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   QUPHCO                                                                          
        |---- QHNEWR                                                               
                   |----  SIGN                                External             
                   |----  SQRT                                External             
                   |----  ABS                                 External             
                   |----  NINT                                External             
                   |----  KMATIX                              External             
                   |----  ATG                                 External             
                   |----  KCLARM                              External             
                   |----  IAND                                External             
                   |----  KLOCK0                              External             
                   |----  IABS                                External             
                   |----  QURHTR                                                   
                   |----  QURHNT                                                   
   
 
3 QUDPPL
         SUBROUTINE QUDPPL(NPLPP,N10PP,IER)
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Number of planes of ppob idp
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   QUPHDP                                                                          
        |---- QUDPPL                                                               
                   |----  SIGN                                External             
                   |----  SQRT                                External             
                   |----  ABS                                 External             
                   |----  NINT                                External             
                   |----  KMATIX                              External             
                   |----  ATG                                 External             
                   |----  KCLARM                              External             
                   |----  IAND                                External             
                   |----  KLOCK0                              External             
                   |----  IABS                                External             
                   |----  NAMIND                              External             
   
 
3 QUHCRG
         SUBROUTINE QUHCRG(ICL,IREG,IMOD)
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Get region and module number for a specified phco cluster
    Ganis -- 1989
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   QUPHPL                                                                          
        |---- QUHCRG                                                               
                   |----  SIGN                                External             
                   |----  SQRT                                External             
                   |----  ABS                                 External             
                   |----  NINT                                External             
                   |----  KMATIX                              External             
                   |----  ATG                                 External             
                   |----  KCLARM                              External             
                   |----  IAND                                External             
                   |----  KLOCK0                              External             
                   |----  IABS                                External             
                   |----  INT                                 External             
   
 
3 QUHNOI
         SUBROUTINE QUHNOI(IER)
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Look for energy in hcal noisy towers; fill enoph in /cuphco/
    Gerardo Ganis -- 1989
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   QUPHCO                                                                          
        |---- QUHNOI                                                               
                   |----  SIGN                                External             
                   |----  SQRT                                External             
                   |----  ABS                                 External             
                   |----  NINT                                External             
                   |----  KMATIX                              External             
                   |----  ATG                                 External             
                   |----  KCLARM                              External             
                   |----  IAND                                External             
                   |----  KLOCK0                              External             
                   |----  IABS                                External             
                   |----  NAMIND                              External             
   
 
3 QUPHCO
         SUBROUTINE QUPHCO(IER)
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Check phco quality
    Input   HCAL banks
    Output  common /CUPHCO/
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   CALINIT                                                                         
        |---- QUPHCO                                                               
                   |----  SIGN                                External             
                   |----  SQRT                                External             
                   |----  ABS                                 External             
                   |----  NINT                                External             
                   |----  KMATIX                              External             
                   |----  ATG                                 External             
                   |----  KCLARM                              External             
                   |----  IAND                                External             
                   |----  KLOCK0                              External             
                   |----  IABS                                External             
                   |----  QHNEWR                                                   
                   |----  QUPHDP                                                   
                   |----  BTEST                                                    
                   |----  QUTWMX                                                   
                   |----  COS                                 External             
                   |----  QUPHPL                                                   
                   |----  INT                                 External             
                   |----  QUPHTR                                                   
                   |----  SIN                                 External             
                   |----  QUHNOI                                                   
   
 
3 QUPHDP
         SUBROUTINE QUPHDP
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Fill part of /cuphco/
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   QUPHCO                                                                          
        |---- QUPHDP                                                               
                   |----  SIGN                                External             
                   |----  SQRT                                External             
                   |----  ABS                                 External             
                   |----  NINT                                External             
                   |----  KMATIX                              External             
                   |----  ATG                                 External             
                   |----  KCLARM                              External             
                   |----  IAND                                External             
                   |----  KLOCK0                              External             
                   |----  IABS                                External             
                   |----  NAMIND                              External             
                   |----  QUDPPL                                                   
                   |----  IDPPH                               External             
                   |----  NPLPH                               External             
   
 
3 QUPHPL
         SUBROUTINE QUPHPL(ICL,NPL,N10,NHT)
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Scan htub bank looking for the number of planes (total and
     in the last 10 ) and for the number of hits associated to
     a given PHCO.
     Gerardo Ganis -- 1989
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   QUPHCO                                                                          
        |---- QUPHPL                                                               
                   |----  SIGN                                External             
                   |----  SQRT                                External             
                   |----  ABS                                 External             
                   |----  NINT                                External             
                   |----  KMATIX                              External             
                   |----  ATG                                 External             
                   |----  KCLARM                              External             
                   |----  IAND                                External             
                   |----  KLOCK0                              External             
                   |----  IABS                                External             
                   |----  QUHCRG                                                   
                   |----  NAMIND                              External             
                   |----  INT                                 External             
   
 
3 QUPHTR
         SUBROUTINE QUPHTR(ICL,NPL)
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Look for fired planes in the corresponding trigger segment
    Input  ICL  PHCO index
    Output NPL  # of fired planes
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   QUPHCO                                                                          
        |---- QUPHTR                                                               
                   |----  SIGN                                External             
                   |----  SQRT                                External             
                   |----  ABS                                 External             
                   |----  NINT                                External             
                   |----  KMATIX                              External             
                   |----  ATG                                 External             
                   |----  KCLARM                              External             
                   |----  IAND                                External             
                   |----  KLOCK0                              External             
                   |----  IABS                                External             
                   |----  NAMIND                              External             
                   |----  INT                                 External             
                   |----  BTEST                                                    
   
 
3 QURHNT
         SUBROUTINE QURHNT(KRNEW,IER)
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Read hcal noisy towers from database
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   QHNEWR                                                                          
        |---- QURHNT                                                               
                   |----  SIGN                                External             
                   |----  SQRT                                External             
                   |----  ABS                                 External             
                   |----  NINT                                External             
                   |----  KMATIX                              External             
                   |----  ATG                                 External             
                   |----  KCLARM                              External             
                   |----  IAND                                External             
                   |----  KLOCK0                              External             
                   |----  IABS                                External             
                   |----  NAMIND                              External             
                   |----  JUNIDB                              External             
                   |----  ALGTDB                              External             
                   |----  IBITS                               External             
   
 
3 QURHTR
         SUBROUTINE QURHTR
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Decode hcal wires trigger thresholds
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   QHNEWR                                                                          
        |---- QURHTR                                                               
                   |----  SIGN                                External             
                   |----  SQRT                                External             
                   |----  ABS                                 External             
                   |----  NINT                                External             
                   |----  KMATIX                              External             
                   |----  ATG                                 External             
                   |----  KCLARM                              External             
                   |----  IAND                                External             
                   |----  KLOCK0                              External             
                   |----  IABS                                External             
                   |----  NAMIND                              External             
                   |----  CHAINT                              External             
                   |----  INT                                 External             
   
 
3 QUTWMX
         SUBROUTINE QUTWMX(IPH,NTWPH,ITWMX,ETWMX)
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Number of towers and energy of the more energetic tower
       Input     IPH   PHCO index of the cluster
       Output    NTWPH number of fired towers (PHST)
                 ( -1 if PHST does not exist )
                 ITWMX PHST index of the more ener. tower
                 ETWMX energy of the more ener. tower
       G. Ganis - Oct 1990
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   QUPHCO                                                                          
        |---- QUTWMX                                                               
                   |----  SIGN                                External             
                   |----  SQRT                                External             
                   |----  ABS                                 External             
                   |----  NINT                                External             
                   |----  KMATIX                              External             
                   |----  ATG                                 External             
                   |----  KCLARM                              External             
                   |----  IAND                                External             
                   |----  KLOCK0                              External             
                   |----  IABS                                External             
   
 
3 REBUILD
         SUBROUTINE REBUILD
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Rebuild the original environment when reading the minidst.
    P. Janot   18 july  1992
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   BUILDAL                                                                         
        |---- REBUILD                                                              
                   |----  SIGN                                External             
                   |----  SQRT                                External             
                   |----  ABS                                 External             
                   |----  NINT                                External             
                   |----  KMATIX                              External             
                   |----  ATG                                 External             
                   |----  KCLARM                              External             
                   |----  IAND                                External             
                   |----  KLOCK0                              External             
                   |----  IABS                                External             
                   |----  VZERO                               External             
                   |----  ITKMUE                              External             
                   |----  LEFLAG                              External             
                   |----  ELRT                                External             
                   |----  ELRL                                External             
                   |----  XSUDNT                              External             
                   |----  IISHAD                              External             
                   |----  IIMCF                               External             
                   |----  KAN                                 External             
                   |----  KAV                                 External             
                   |----  KAM                                 External             
                   |----  KAG                                 External             
                   |----  ALVSN                               External             
                   |----  XMUI                                External             
                   |----  KMUIIF                              External             
                   |----  XEID                                External             
                   |----  KEIDIP                              External             
                   |----  KTN                                 External             
                   |----  KEIDIF                              External             
                   |----  QEIDRI                              External             
                   |----  QMUIDO                                                   
                   |----  NPHOCH                              External             
                   |----  NPHOCR                              External             
                   |----  NLINK                               External             
   
 
3 RELKHC
         SUBROUTINE RELKHC(IHCOBJ,ICHARG,ANGL,DELTAE)
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Force a link of an isolated hcal cluster to a tpc track
     when JULIA failed...
     Input :   -- ihcobj,  ALPHA index of the HCAL cluster
     Output:   -- icharg,  ALPHA index of the TPC track
               -- angl  ,  angle between HCAL and extrapolation (deg.)
               -- deltae,  energy difference (GeV)
    Patrick Janot -- 05 Sep 1990
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
              RELKHC                                                               
                   |----  SIGN                                External             
                   |----  SQRT                                External             
                   |----  ABS                                 External             
                   |----  NINT                                External             
                   |----  KMATIX                              External             
                   |----  ATG                                 External             
                   |----  KCLARM                              External             
                   |----  IAND                                External             
                   |----  KLOCK0                              External             
                   |----  IABS                                External             
                   |----  KTN                                 External             
                   |----  COS                                 External             
                   |----  TWH                                 External             
                   |----  SIN                                 External             
                   |----  PWH                                 External             
                   |----  QX                                  External             
                   |----  ACOS                                External             
                   |----  ETW                                 External             
                   |----  AMIN1                               External             
                   |----  QE                                  External             
   
 
3 SICAMOD
         SUBROUTINE SICAMOD
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Compute the e/pi ratios for the sical
    Patrick Janot -- 18 Apr 1993
   
 
3 V0SUM
         SUBROUTINE V0SUM
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Determine the energy carried by v0's (k0l, lambda , conv. photon)
    Patrick Janot -- 18 Apr 1990
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   CREFLW                                                                          
        |---- V0SUM                                                                
                   |----  SIGN                                External             
                   |----  SQRT                                External             
                   |----  ABS                                 External             
                   |----  NINT                                External             
                   |----  KMATIX                              External             
                   |----  ATG                                 External             
                   |----  KCLARM                              External             
                   |----  IAND                                External             
                   |----  KLOCK0                              External             
                   |----  IABS                                External             
                   |----  VZERO                               External             
                   |----  KAV                                 External             
                   |----  KAM                                 External             
                   |----  XLOCK                               External             
                   |----  KFRTNT                              External             
                   |----  KCHT                                                     
                   |----  KNMOTH                              External             
                   |----  KMOTH                               External             
                   |----  KDAU                                External             
                   |----  QX                                  External             
                   |----  QYV0VX                              External             
                   |----  QYV0VZ                              External             
                   |----  QZ                                  External             
                   |----  QY                                  External             
                   |----  QE                                  External             
                   |----  ADDVEC                                                   
                   |----  QLTRK                                                    
   
 
3 X1DISC
         SUBROUTINE X1DISC
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   
    - Author   : A. Putzer  - 86/08/08  FOR GALEPH 13.0
    - Modified : A. Putzer  - 88/02/02  FOR GALEPH 19.6
    - Modified : C. Geweniger - 88/10/11  for GALEPH 20.1
    - Modified : C. Geweniger - 88/11/06  for GALEPH 20.2
    - Modified : E. Blucher - 89/15/2 for ALEPHLIB
    - Modified : C. Geweniger - 89/9/00   for ALEPHLIB 9.9
    - Modified : B. Bloch-Devaux - 92/12/10 for Sical in 92
   
   
   Discriminate level1 trigger signals
   
    - The analog trigger sources for the level1 trigger are discriminated
      using up to 4 sets of thresholds.
   
    - Banks    : XTEB is filled
   
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
              X1DISC                                                               
                   |----  MOD                                 External             
                   |----  IBSET                               External             
                   |----  IEWSUM                              External             
                   |----  ILTSUM                              External             
                   |----  SIX2MK                              External             
                   |----  BTEST                                                    
                   |----  IITSUM                              External             
                   |----  MVBITS                              External             
                   |----  IHCTTE                              External             
                   |----  IECTTE                              External             
                   |----  IECWTE                              External             
   

2 MINI

  >>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>
    CKEY 
    
       The source code is maintained with CVS
    
       on AXP/VMS: 
                 $ define MINI102 $2$DKB200:[GENERAL_A.MINI.MINI202]
                 $ define ALINC  $2$DKB200:[GENERAL_A.ALE.INC]
    
                  source on MINI102:[*]*.F, *.h 
    
                  library   MIN:MINI102.OLB, _D.OLB, .NEWS
       
       on UNIX :  source on $ALROOT/mini102/
                  library   /aleph/phy/libmini202.a
                            /aleph/gal/libmini202_dbx.a
                  link      /aleph/lib/libmini.a
                            /aleph/lib/libmini_dbx.a
                            /aleph/src/mini
    
    =========================================================================
    
     05/02/2001 V 205
      ---------------
    
      - New Kingal bank KW4F added systematically to the MINI
      - New internal; bank DYV0 to store the V0 daughter tracks
        (to avoid truncation to 30 vertices maximum on the MINI)  
      - Banks DTRA and DMSC now transmitted for NR = 0 (for GAMPEX)
    
      - Several mods to the MINI routines to allow the calorimeter shaking
        to be done on the MINI
        
    
     12/10/2000 V 204
      ----------------
      - New algorithm E14 with new MINI bank DE14 for LEP2 MINIs
    
      - Added in LEP2 MINIs all banks necessary to redo the EFLOW
        on MINIs: PECO,PHCO,PCRL,PCOB,PEST,ETDI,EWHE,PWEI,PLPD,PLDS,PHST,PPDS
        suppress old MINI banks which give duplicate information:  
                   DECO,DHCO,DPOB,DWEI,DCRL,DHRL
    
     13/03/2000 V 203  with DMSC for all events in LEP2 MINIs
      ----------------
    
     07/01/99 V 202 in ALPHA                    
      -----------------------
       MINI is now a part of ALPHA - no more separate minilib
                         
     16/09/98 V 202    for 1998 production : new LEP2 structure
      --------------
    
    
     28/06/96 V 102    for 1996 production
      -------------
    
    1) Bank formats are now read from ALFMT : mod in MININI
    2) New run header bank for BOMs in 1996 added : BLQP
                  mod in MINXTR
    3) Protection added in MINFRF against weird MC tracks with P=0.
    4) in MINTRA : add VDET truth information for MC datasets
                   in bits 10-17 of last DTRA word
    5) Remove routines STRIGF and STMASK which are now in JULIA
    
     06/09/95 V 101    for 1995 production
      -------------
    
    1) Bug fixes in MINMSC and in several routines (SAVE for UNIX compilers)
    2) SICAL ONLY triggers are now thrown away from the MINI :
                  mods in MINPRE , JULIA routines STRIGF and STMASK are
                  provisionnally put in the MINI LIB
    3) Mod in MINEVT for the new PWEI ECAL bank defined in 1995
    4) TPC bank TSSR added to the Run Header list on the MINI
    
     20/12/94 V 100    for 1994 production
      -------------
    
    1) New routines: MINMSC, MINPSC, MINBIP, MINTHR, MINPTH, MINGAC, MINPGA, MINDLT,
                     MINPDL, MINMLT, MINPML,MINJLT,MINPJL
    2) New comdecks: DMSCJJ, DTHRJJ, DBTGJJ, DGACJJ, DDLTJJ, DLJTJJ,DMLTJJ
                     PMSCJJ, PTHRJJ, PGACJJ, PDLTJJ, PLJTJJ,PMLTJJ
    3) Bug fixes or protections in MINPRE,MINFKI,MINFVE
    4) Add new 1994 trigger bank X1RG in MINBLD
    5) Add new QSELEP run header bank PLSC in MINRUN
    6) Mod in MINEID : R2 stored now up to 20.48
    7) Mod in MINHIS : new histos for new MINI banks
    8) Mod in MINFRF : track momentum scaling for 1993 MINIs made with ALEPHLIB 156
    9) Mod in MINMUI : add D4CD bank for 1993 MCarlos
    
     01/05/93 V 90     for 1993 production
      -------------
    
    1) New routines: MININI, MINPRE, MINBLD, MINBLM, MINEVT, MINFVB, MINGID, MINGPC,
       MINPGI, MINPGP, MINSIC.
    2) New comdecks: DEVTJJ, DGIDJJ, DGPCJJ, PGIDJJ, PGPCJJ, DSICJJ, SILUJJ.
    3) Remove obsolete decks: MINGAM, MINFOT, MINMUO, MINNEU, MINRES, MINPV0,
       MINPCP. Also RLEPJJ (UFITQL), FGTPJJ (UFITQL), PCHYJJ (MINNEU,MINRES),
       PEHYJJ (MINNEU), PLSDJJ, RLUNIT (MINMUO).
    4) Allow version number to be set by data card - modify MINVSN.
    5) Input version number from: data card, DVRS bank or RHAH - modify MINGTV.
    6) Break MINDST into parts: MININI, MINPRE, MINBLD, MINBLM.
    7) Consider Sical events as Lumi events too - in MINPRE.
    8) Write Sical information for Lumi events - in MINBLD.
    9) Build class 24 - in MINPRE.
    10) Save extra banks for class 24 - in MINBLD.
    11) Do not save calorimter banks for class 16 or 17 - in MINBLD.
    12) Writing of EVEH (and DVRS) is compulsory - in MINBLD.
    13) No longer create DNEU and DRES.
    14) Simplify MINFMT and rely more on ALFMT.
    15) Transmit format information to MINOUT by modified MINCOM - modify MINOUT.
    16) Drop POT bank formats by refering to T list - modify MINNOF.
    17) Use ALVSN - in MINPRE and modify MINRUN.
    18) No longer use YV0V to build DVER - modify MINVER.
    19) Remove reference to dE/dx, old EM and calo link in DTRA - modify MINTRA.
    20) Move vertex bit pattern in MINTRA to MINFVB.
    21) Remove R6 and R7 from DEID - modify MINEID and MINEIT.
    22) Anticipate PECO/1 as input - modify MINECO and MINPEC.
    23) Only write out ENFLW jets - modify MINJET.
    24) Update histograms for DGID and DGPC banks - modify MINHIS.
    25) Simplify searches for compressed banks with CUTOL - modify MINMON.
    26) No longer call MINUPD in MINFIL - rather call it from filling routines
        where banks have to be updated. Use bank nr 100 for this.
    27) Neater use of logicals for filling, especially when considering existance
        of POT/Mini banks - modify MINFIL.
    28) Completely reorganise updating procedure so that input banks are not changed
        - modify MINUPD.
    29) For old track EM, move components to new location (MINUPD) - modify MINTRA.
    30) Use YMFMIN to reconstruct YV0V rather than MINPV0 - modify MINYV0.
    31) Decide with MINGTV to update PCQA if really necessary - modify MINPCQ.
    32) Decide with MINGTV to supply track quality for old data - modify MINFRI.
    33) Identify qqbar events from class word - modify MINHIS.
    34) Remove arguments in MINOUT.
    35) Add SLUM to run list - modify MINRUN.
    36) Print one bank table for MC events - modify MINMON.
    37) Store mass rather than energy in DENF - modify MINENF, MINEFO.
    38) For lumi events, ignore LUPA in 1993 - modify MINPRE.
    39) Add ALPB to run list - modify MINRUN.
    40) Remove all apparently 'undefined' variables detected by IBM compiler.
    
     30/03/93 v 89
      -------------
    
    1) Even more protection for EXP for eigen-value in MINFRF.
    2) Remove warning message in MINYV0.
    3) Create DVRS bank - new routine MINVRS; new comdeck DVRSJJ; modify MINFMT.
    4) Use NAMIND for YV0V in MINTRA and MINVER.
    5) Restore NR of YV0V from DVRS in MINYV0.
    
     22/02/93 v 88
      -------------
    
    1) Use MINGTV to determine whether have old or new EM - modify MINFRF.
    2) Protect EXP for eigen-value in MINFRF.
    3) Ensure that any old DTRA/3 banks read in result in FRFT/0 - modify MINFRF.
    4) SAVE CURNOM and CUR92C in MINUPD.
    5) Ensure PFRF/0 used if FRFT/3 used in MINTRA.
    6) Correct determination of logical PACK in MINTRA.
    
     05/01/93 v 87
      -------------
    
    1) If MINGTV returns 0 in MINPUD, STOP.
    2) Put NOCH in MINUPD for 7.3 modification.
    3) Switch NOCH off in MINFIL and MINUPD if Eflow required.
    4) Reinstall possibility to fill R5 in MINEIT.
    5) Remove VDAMB (now in ALEPHLIB) and VDHVFX.
    6) Update momenta from 1992 real data made with wrong B-field - modify MINUPD.
       Synchronised with ALEPHLIB 144.
    7) Correct E3 precision (by factor 100) in MINGAM and MINEGI.
    8) For 1990 MC, ensure FRFT/2 really not used (drop it) - modify MINTRA.
    9) Improve comment in MINUPD for mod to DTRA for vsn 6.1 and move it into body
       of MINUPD. Also force UFITQL for vsn before 5.3.
    10) Also move update to DEWI for vsn 5.0 into main body.
    11) Put check in MINUPD for Mini vsn before 6.1.
    12) In cases where input contains FRFT/3, ensure write DTRA/0 - modify MINTRA.
    
     20/11/92 v 86
      -------------
    
    1) Use MINGTV in MINUPD - which is better protected against bad run records.
    2) Avoid calling VDHVFX all together.
    
     17/11/92 v 85
      -------------
    
    1) Introduce ALFMT('ALL') in MINFMT to ensure supply FMTs for muon banks.
    
     02/11/92 v 84
      -------------
    
    1) Remove check on data type in VDHVFX (which caused it not to work).
    2) Avoid calling VDHVFX in MINDST for MC.
    
     22/10/92 v 83
      -------------
    
    1) New version of VDHVCK for 1992 data.
    2) New version of VDAMB - just two bits.
    3) Add MINGTV to obtain version number from data.
    
     05/10/92 v 82
      -------------
    
    1) Protect MINDST for boring Sical banks in reduced DST events.
       Ie. veto SPDA and SCLS banks.
    
     01/10/92 v 81
      -------------
    
    1) Correct typo in VDHVCK.
    
     01/09/92 v 80 (ALPHA version)
      -------------
    
    1) Incorporate ENFLW by using EFOL/3 - modify MINENF, MINJET, MINEFO, MINEJE.
    2) Correspondingly ALPHA is used and CREFLW is called to create EFOL/3.
    3) ENFLW jets created by ENFJET, called by CREFLW.
    4) Add new muon code (for MUID, HMAD, MCAD) in MINMUI and call from MINDST.
    5) Correspondingly ALPHA is used and MUNEWR-MUREDO are called to create MUID.
    6) Drop muon formats provided dummy CFMT exists - modify MINFMT.
    7) Muon histogram changed - modify MINHIS.
    8) Fix Vdet HV bit in REVH - call VDHVFX in MINDST.
    9) Increase precision for R2 and R3 - modify MINEID, MINEIT, MINUPD.
    10) Small changes to checks in PCPJET.
    11) Remove obsolete routines: MINREQ, MINCLA, MINEVT, MINMID, MINCAL, MINHEA,
        MINPRT.
    12) Consequently modify MINDST - assume format of DHEA is up to date.
    13) And modify MINOUT - assume EDIR will be created from REVH externally.
    14) Remove obsolete comdecks: DEVTJJ, DMIDJJ, DCALJJ.
    15) No longer create DEVT in MINUPD.
    16) Correct EJETE0 to EJETPE in EJETJJ and MINJET, MINEJE, PCPJET.
    17) Introduce NOPC, NOGA, NOEF, NOEJ - modify MINFIL.
    18) Include Vdet ambiguity code - call VDAMB in MINTRA.
    19) VDHVFX and VDAMB added temporarily to Mini library.
    
     30/04/92 v 71
      -------------
    1) Remove VDHITS as it is now in ALEPHLIB.
    2) Modify call to AMUIDO and dummy routine in MINMUO for extra argument.
    
     19/05/92 v 72
      -------------
    1) Create jets from PCPA with PCPJET. Move MINLIS in MINJET to avoid duplication
       of DJET on MLISTE.
    2) Extend timing histogram in MINHIS.
    
     04/06/92 v 73
      -------------
    1) Save Chisq/DoF rather than fit probability - modify MINTRA, MINFRF, MINUPD.
    2) Drop empty LUPA banks for MC events (POT).
    
     29/07/92 v 74
      -------------
    1) Use GTSTUP to decide whether to use FRFT 0 or 2 - important for MC - modify
       MINTRA.
    
     01/04/92 v 70
      -------------
    1) Save BOMB bank - modify MINDST and MINFMT.
    2) Introduce cards NNMC to avoid MC o/p of banks, while allowing ALPHA filling.
    3) Store Vdet hit information - modify MINTRA. Include VDHITS temporarily.
    4) Ensure large values of R3,R3 are set to 1000 - modify MINEID and MINEIT.
    5) Decouple NOEM and NOV0 in MINFRF.
    
     31/01/92 v 63
      -------------
    1) Correct handling of EPIO errors in MINIMAIN.
    2) Add relation bits in PECO - modify MINPEC.
    3) Solve unresolved references in MINMUO - add dummy QMUINI and AMUIDO.
    4) Correct units for photon momentum vector in EGPC - modify MINEGP.
    5) Also correct flag for EGPC - modify MINEGP.
    6) Modify N03 and N10 to be consistent with DST - modify MINQMU.
    
     22/11/91 v 62
      -------------
    1) Zero arrays in MINMON for cancatenation.
    2) Save and restore format pointers in MINNOF. Extra call to MINNOF in MINOUT.
       Otherwise, formats not dropped and fill space for concatenated files.
    3) Put MAXBNK in MINCOM - also modify MINMON to use this parameter.
    4) Further mods to MINIMAIN for concatenation.
    5) Include SAVE statements needed for DECStations.
    6) Remove unnecessary statements in MINDST and MINPCQ.
    7) Insert a missing data statement for FIRST in MINFRF.
    8) Rearangement in MINQMU to ensure all bits initialised before MVBITS.
    9) For MC, force IMAQQ=1 in MINHIS - ensures histograms. (LUPA always present
       on POT.)
    10) Ensure DTRA/2 is created for MC - modify MINTRA.
    
     05/11/91 v 61
      -------------
    1) Introduce DFOT bank (results from GAMLIB) - create MINFOT, MINEGP. Modify
       MINHIS to incorporate.
    2) New form of track error matrix - modify MINTRA, MINFRF, MINUPD. Incorporate
       NOEM option.
    3) Make FRFT/2 the default for 1991, 1992 ... - modify MINTRA.
    4) Make PTEX a formal part of Mini - modify MINTRA, MINDST.
    5) Update MINIMAIN to work on concatenated DST's - also modify MINSUM, MINMON.
    6) No longer call PRRHAH in MINOUT, but in MINIMAIN.
    
     07/08/91 v 60
      -------------
    1) Modify MINTRA to run on FRFT (because of proposed changes to error matrix in
       PFRF).
    2) Remove obsolete references to PFRT in MINTRA.
    3) Enable use of FRFT/2 in MINTRA. Modify all links to DTRA and FRFT in: MINDST,
       MINEID, MINMUO, MINRES, MINMID, MINHEA, MINUPD, MINFRF, MINFRT, MINPYF,
       MINYV0, MINEIT, MINFRI.
    4) If PTEX appears on MINA list, do not write dE/dx in DTRA - modify MINTRA.
    5) Add PTEX to lists in MINFMT.
    6) Improve histogramming in MINHIS.
    7) Ensure that a non-zero B field is used in MINTRA, MINFRF, MINYV0.
    
     31/07/91 v 57
      -------------
    1) Replace obsolete call in MINEIT to calculate R5 for EIDT.
    2) Set return code from MINQMU to 0 for tracks with no DMUO information.
    
     26/06/91 v 56
      -------------
    1) Perform calculations with wire energies in FP representation to avoid
       overflows - mod MINHEA, MINEWI.
    2) New version of MINPCQ - improved merging of particles.
    
     16/05/91 v 55
      -------------
    1) Ensure update of DNEU and DRES by MINUPD - move in front of DEWI update.
    2) Update DTBP - mod MINUPD.
    3) Correct handling of shadow information in MINMUO.
    4) Use SELEVT in ALEPHLIB - remove dummy in MINCLA.
    5) Use UFITQL in ALEPHLIB.
    6) Introduce MINPCQ to replace MINPCP in MINFIL; also add PCQAJJ.
    7) Move AUBOS in MINUPD to shrink DECO - avoid overwrite from NBANK.
    
     25/04/91 v 54
      -------------
    1) Protect for PCROS(3)=0 (for vax) in MINYV0.
    2) Set output stream for initialisation required by QMUIDO - mod MINMUO.
    3) Include banks with non-zero number in MINMON.
    4) Remove all BLIST's associated with unpacking POT banks - mod MINDST, MINTRA,
       MINEID, MINMUO, MINFIL.
    5) Change all 'E+'s to 'S+'s in BLIST calls in filling.
       Note: S-list is dropped by ABRREC. This may be modified by QWRITE.
    6) Restore MINLIS('0') call in MINDST.
    7) Don't write IPJT etc if both PASL and PITM exist - mod MINDST.
    8) Include PHMH in list of MC banks to be written.
    9) Move MINADD and change GOTO if read Mini in MINDST.
    10) Call MINTMC etc only if DTMC not present - mod MINDST.
    11) Swop order of link assignments for DEID - purely cosmetic.
    12) If don't find 'MINI' in RHAH, force update - mod MINUPD.
        RHAH is interogated at beginning of run, so not affected by update of RHAH.
    13) Allow DTRA and DEWI to be updated - mod MINUPD.
    14) Data type recognised by ALDTYP in MINDST.
    15) Check absence of MINA bank in MINADD.
    16) Ensure that run/evt numbers are updated on first call to MINLIS.
    17) Call MINUPD from MINDST if input is Mini.
    18) Remove arguments in MINUPD and obtain logicals inside routine.
    19) Do not update in MINUPD if called more than once for an event.
    20) Update EIDT hypothesis flag for 1991 convention - mod MINEIT.
    21) Use REVH, if filled, for class word in MINCLA.
    22) Include more POT banks in drop list for formats - mod MINFMT.
    23) Add XTBN to run reccord.
    24) Unpack DTBP to XTRB - create MINXTR.
    25) Add MCAD to E-list after AMUIDO - mod MINMUO.
    26) Add PCOB link to DNEU and replace DECO link by PCOB link in DRES - mod
        MINNEU, MINRES, MINUPD.
    27) Raise cut for qqbar identification to 25 GeV - mod MINHIS.
    28) Set NDRES immediately after loop to avoid changes in IDRES - mod MINRES.
        Similarly for NDNEU, but purely cosmetic.
    29) Swop order of check on IPCOB and IPFRF in MINRES - purely cosmetic.
    
     19/03/91 v 53
      -------------
    1) Loop over different bank numbers for EFOL, EJET - mod MINENF, MINJET,
       MINEFO, MINEJE.
    2) Update MINHEA to be same as in current Julia and update DHEA for old
       POT's by call to MINHEA in MINDST.
    3) No longer update DEWI in MINUPD.
    4) Remove Time of Flight from DVMC - mod MINVMC, MINFVE.
    5) Track quality from UFITQL added to DTRA - mod MINTRA, MINFRI.
    6) UFITQL added as temporary measure - eventually will be in ALEPHLIB.
    7) Improve initialisation of MINLIS, and move BLIST from MINDST.
    8) Only call BLIST in MINOUT if compression has occurred.
    
     05/03/91 v 52
      -------------
    
    1) Add word to DTBP - mod MINTBP.
    2) Update MINTBP to use XTRB.
    3) Replace DEVT by DHEA + DTBP - mod MINDST, MINUPD, MINFMT.
    4) Fix bug for MINI->MINI* in MINDST.
    5) Rename MINMOF deck MINNOF; remove junk in cols 73-80 in MINNOF and MINCLA.
    6) Return to use of DHEA in MINLOL.
    7) Improve accuracy of tan(lamda) to avoid problems - mod MINFRF.
    8) Extend timing histogram in MINHIS.
    
    
     25/02/91 v 51
      -------------
    
    1) Include RLUNIT in MINMUO to avoid empty file from initialisation.
    2) Bug in MINVSN.
    3) Remove NS from DECO - mod MINECO, MINUPD.
    4) Add XTYP to run list - mod MINRUN.
    5) Use trigger words 1 and 3 - mod MINEVT.
    6) Introduce MINCLA to provide class word - mod MINOUT, MINEVT.
    7) Use correct NDF in MINTRA.
    8) Fill chi-squared and NDF in FRFT - mod MINFRF.
    9) CMPINI modified, so remove code from library.
    10) Update N03 in MINQMU.
    11) Lower energy threshold for DGAM.
    12) Protect HMAD bank in MINMUO from AMUIDO, else it upsets SELEVT.
    13) Protect CHISIN from producing negative chi-squareds in MINYV0.
    14) Clean up MINCOM - mod MINSDT, MINMON, MINLIS.
    15) Avoid trailing blanks in lists in MINOUT.
    16) Move call to ABUNIT into MINOUT.
    17) Introduce MINNOF to kill formats for POT banks - called in MINOUT.
        Also mod MINDST, MINFMT and add MLISTF in MINCOM.
    18) Remove unwanted reference to DENF, DJET in MINDST.
    
     20/02/91 v 50
      -------------
    
    New Mini-DST code for 1991.
    
    urrent banks:
    Run record = RUNR RUNH RALE RLEP RHAH JSUM LEHI LUMI LBAK LVHI XTOP
                 XTYP
    Evt record = EVEH REVH LUPA DEVT DVER DTRA DCRL DECO DEWI DHCO DHRL
                 DPOB DEID DMUO DRES DNEU DGAM DENF DJET
    
    urrent routines:
    Writing = MINDST MINFMT MINREQ MINRUN MINLIS MINEVT MINVER MINTRA
              MINGAM MINEID MINMUO MINNEU MINRES MINCRL MINECO MINEWI
              MINHCO MINHRL MINPOB MINENF MINJET MINADD MINTMC MINVMC
              MINFMC MINOUT MINNOF MINHIS MINMON
    Reading = MINFIL MINUPD MINLOL MINFRF MINHIT MINFRT MINPYE MINYV0
              MINPV0 MINPYF MINPCP MINPCR MINPEC MINPHC MINEGI MINEIT
              MINFRI MINEFO MINEJE MINFKI MINFVE MINFZF MINQMU
    
    Major changes from 1990:
    1) New banks (replaced banks):
       DEVT (DHEA and DTBP), DGAM, DMUO (DMID), DNEU and DRES (DCAL),
       DENF, DJET (DMJT).
    2) DVER has a main vertex bit.
    3) R6, R7 and pointer to DECO included in DEID.
    4) Energy fractions in DECO in per mille; E4 removed.
    5) Energy fractions added in DEWI.
    6) Bank formats no longer written for ALEPH Mini.
    Backwards compatibility provided by MINUPD which is called automatically
    by MINFIL.
    
    
  <<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<
     MINADD     Add other requested banks to mini-dst list.
     MINALGO 
     MINBIP     Swap bank dbtg and nbip.
     MINBLD     Build mini banks for data.
     MINBLM     Build mini banks for monte-carlo.
     MINBLN     Build mini banks for data, with enfl banks for lep2 datasets
     MINBLO     Build mini banks for data, without enfl banks
     MINCHK     Write run information in file.
     MINCRL     Fill calorimeter relation bank dcrl for mini-dst.
     MINDLT     Fill reconstructed tagged lepton bank ddlt for mini-dst.
     MINDST     Steering routine to create mini-dst banks not already on pot.
     MINDTYP    Tels if one deals with lep1 or lep2 real data or mcarlo data
     MINECO     Fill ecal calorimeter bank deco for mini-dst.
     MINEFO     Fill efol bank from denf and denw.
     MINEGI     Fill egid bank from dgam.
     MINEGP     Fill egpc bank from dfot.
     MINEID     Fill electron id bank deid for mini-dst.
     MINEIT     Fill eidt bank from deid.
     MINEJE     Fill ejet bank from djet.
     MINENF     Fill energy flow bank denf for mini-dst.
     MINENW     Fill energy flow bank denw for mini-dst.
     MINEVT     Fill event information bank devt for mini-dst.
     MINEWI     Fill ecal wire energy bank dewi for mini-dst.
     MINEWS     Fill ecal wire energy sums bank dwes for mini-dst.
     MINFIL     Fill pot banks from mini-dst.
     MINFKI     Fill fkin from dtmc.
     MINFMC     Fill fragmentation mc bank dfmc for mini-dst.
     MINFMT     Define bank formats for mini-dst.
     MINFRF     Fill frft bank from dtra.
     MINFRI     Fill frid bank from dtra.
     MINFRT     Fill frtl bank from dtra.
     MINFVB     Fill vertex bit pattern in dtra, and 'dyv0' bank for minis >= 205
     MINFVE     Fill fver from dvmc.
     MINFZF     Fill fzfr from dfmc.
     MINGAC     Fill photon bank dgac for mini-dst.
     MINGID     Fill photon bank dgid for mini-dst.
     MINGPC     Fill photon bank dgpc for mini-dst.
     MINGTV     Mini-dst version number used to produce current data.
     MINHCO     Fill hcal calorimeter bank dhco for mini-dst.
     MINHIS     Fill some simple histograms to monitor the mini-dst.
     MINHIT     Find number of hits in mvd, itc or tpc from dtra bank.
     MINHRL     Fill hcal tower-digital relation dhrl for mini-dst.
     MININI     Mini code initialisation.
     MINJET     Fill jet bank djet for mini-dst.
     MINJLT     Fill reconstructed tagged lepton bank ddlt for mini-dst.
     MINKNK     Fill kink bank dknk for mini-dst.
     MINLIS     Add a bank to the list of mini-dst banks.
     MINLOL     Fill lole bank from devt or dhea.
     MINMLT     Fill history of tagged lepton bank dmlt for mini-dst.
     MINMON     Simple monitoring of the mini-dst.
     MINMSC     Fill  bank dmsc for mini-dst.
     MINMUI     Modify and save muon banks for mini-dst.
     MINNOF     Ensure no formats are written for pot banks.
     MINOUT     Simple routine to write a mini-dst.
     MINPCP     Fill pcpa bank from dneu and dres.
     MINPCQ     Fill pcqa bank from dneu and dres.
     MINPCR     Fill pcrl bank from dcrl.
     MINPDL     Fill pdlt bank from ddlt.
     MINPEC     Fill peco bank from deco.
     MINPFR 
     MINPGA     Fill pgac bank from dgac.
     MINPGI     Fill pgid bank from dgid.
     MINPGP     Fill pgpc bank from dgpc.
     MINPHC     Fill phco bank from dhco.
     MINPJL     Fill pljt bank from dljt.
     MINPML     Fill pmlt bank from dmlt.
     MINPOB     Fill hcal digital pattern object dpob for mini-dst.
     MINPRE     Mini code preparation of new event.
     MINPSC     Fill  bank pmsc for alpha   .
     MINPTH     Fill pthr bank from dthr.
     MINPYE     Fill pyer bank from dver.
     MINPYF     Fill pyfr bank from dtra.
     MINQMU     Mini-dst interface for qmuido.
     MINRUN     Define run banks to be written for mini-dst.
     MINSIC     Fill sical bank dsic for mini-dst.
     MINSUM     Write summary file for the mini-dst.
     MINTBP     Fill vertex bank dtbp for mini-dst.
     MINTHR     Fill thrust bank dthr for mini-dst.
     MINTMC     Fill track mc bank dtmc for mini-dst.
     MINTRA     Fill track bank dtra for mini-dst.
     MINUPD     Update style of mini-dst banks to ensure backward compatibility.
     MINVER     Fill vertex bank dver for mini-dst.
     MINVMC     Fill vertex mc bank dvmc for mini-dst.
     MINVRS     Fill version information bank dvrs for mini-dst.
     MINVSN     Mini-dst version number (of current library).
     MINXTR     Fill xtrb bank from dtbp.
     MINYNK     Fill kink bank yknk for alpha.
     MINYV0     Fill yv0v bank from dtra.
     MQUEVNT 
     MQUINIT 
     MQUNEWR 
     MQUSREC 
     MQUTERM 

3 MINADD
         SUBROUTINE MINADD
  ------------------------------------------------------------------------------
    CKEY MDST /INTERNAL
  ------------------------------------------------------------------------------
   Add other requested banks to mini-dst list.
       Author: Stephen Haywood      15-Mar-90
       Modify: Stephen Haywood      08-Jun-90   v 3.0
       Input  : MINA data card
       Output : Extra names in MLISTE in / MINCOM /
       Called by MINDST
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   MINDST                                                                          
        |---- MINADD                                                               
                   |----  NAMIND                              External             
                   |----  NLIST                               External             
                   |----  CHAINT                              External             
                   |----  INDEX                               External             
                   |----  LNBLNK                              External             
                   |----  MINLIS                                                   
   
 
3 MINALGO
         SUBROUTINE MINALGO
  ------------------------------------------------------------------------------
    CKEY MDST/INTERNAL
  ------------------------------------------------------------------------------
    thrust DTHR and impact parameter DBTG banks
   A. Jacholkowska Oct 1994
    in ALPHA 8-Jan-1999
    from MQUEVNT
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   MQUEVNT                                                                         
        |---- MINALGO                                                              
                   |----  SIGN                                External             
                   |----  SQRT                                External             
                   |----  ABS                                 External             
                   |----  NINT                                External             
                   |----  KMATIX                              External             
                   |----  ATG                                 External             
                   |----  KCLARM                              External             
                   |----  IAND                                External             
                   |----  KLOCK0                              External             
                   |----  IABS                                External             
                   |----  QJOPTR                                                   
                   |----  QJTHRU                                                   
                   |----  KPDIR                                                    
                   |----  MINTHR                                                   
                   |----  MDIPBT                                                   
                   |----  MDWRIP                                                   
   
 
3 MINBIP
         SUBROUTINE MINBIP
  ------------------------------------------------------------------------------
    CKEY MDST /INTERNAL
  ------------------------------------------------------------------------------
   Swap bank dbtg and nbip.
       Author: Agnieszka Jacholkowska 1-Oct-94
       Input  : DBTG bank
       Output : NBIP bank
       Called by ALPHA
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   MINFIL                                                                          
        |---- MINBIP                                                               
                   |----  NSWAP                               External             
                   |----  BLIST                               External             
   
 
3 MINBLD
         SUBROUTINE MINBLD(NWANT,WLIST,KEEP,CLASS)
  ------------------------------------------------------------------------------
    CKEY MDST /INTERNAL
  ------------------------------------------------------------------------------
   Build mini banks for data.
       Author: Stephen Haywood      06-Jan-93
       Modify: Agnieszka Jacholkowska   30-Sep-98
       Modified J. Boucrot  12-October 2000 : E14 and Eflow banks
       Input  : NWANT  = number of banks listed on MINI card
                WLIST  = Wish-list of banks to be written on Mini
                KEEP   = flag indicating whether event should be kept
                CLASS  = logical array set according to class word
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   MINDST                                                                          
        |---- MINBLD                                                               
                   |----  MINVSN                                                   
                   |----  MINBLO                                                   
                   |----  MINBLN                                                   
   
 
3 MINBLM
         SUBROUTINE MINBLM
  ------------------------------------------------------------------------------
    CKEY MDST /INTERNAL
  ------------------------------------------------------------------------------
   Build mini banks for monte-carlo.
       Author: Stephen Haywood      06-Jan-93
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   MINDST                                                                          
        |---- MINBLM                                                               
                   |----  NLINK                               External             
                   |----  MINLIS                                                   
                   |----  MINTMC                                                   
                   |----  MINVMC                                                   
                   |----  MINFMC                                                   
                   |----  NAMIND                              External             
   
 
3 MINBLN
         SUBROUTINE MINBLN(NWANT,WLIST,KEEP,CLASS)
  ------------------------------------------------------------------------------
    CKEY MDST /INTERNAL
  ------------------------------------------------------------------------------
   Build mini banks for data, with enfl banks for lep2 datasets
       Author: Stephen Haywood      06-Jan-93
       Modify: Agnieszka Jacholkowska   30-Sep-98
       Modified J. Boucrot  12-October 2000 : E14 and Eflow banks
       Input  : NWANT  = number of banks listed on MINI card
                WLIST  = Wish-list of banks to be written on Mini
                KEEP   = flag indicating whether event should be kept
                CLASS  = logical array set according to class word
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   MINBLD                                                                          
        |---- MINBLN                                                               
                   |----  INDEX                               External             
                   |----  MINDTYP                                                  
                   |----  ABRUEV                              External             
                   |----  MINLIS                                                   
                   |----  NLINK                               External             
                   |----  MINSIC                                                   
                   |----  MINVRS                                                   
                   |----  MINEVT                                                   
                   |----  MINTBP                                                   
                   |----  MINVER                                                   
                   |----  MINTRA                                                   
                   |----  MINGID                                                   
                   |----  MINGAC                                                   
                   |----  MINDLT                                                   
                   |----  MINMLT                                                   
                   |----  MINJLT                                                   
                   |----  MINKNK                                                   
                   |----  MINMUI                                                   
                   |----  MINMSC                                                   
                   |----  MINENF                                                   
                   |----  MINENW                                                   
                   |----  MINJET                                                   
                   |----  NAMIND                              External             
                   |----  NSWAP                               External             
                   |----  BLIST                               External             
   
 
3 MINBLO
         SUBROUTINE MINBLO(NWANT,WLIST,KEEP,CLASS)
  ------------------------------------------------------------------------------
    CKEY MDST /INTERNAL
  ------------------------------------------------------------------------------
   Build mini banks for data, without enfl banks
       Author: Stephen Haywood      06-Jan-93
       Modify: Agnieszka Jacholkowska   30-Sep-98
       Input  : NWANT  = number of banks listed on MINI card
                WLIST  = Wish-list of banks to be written on Mini
                KEEP   = flag indicating whether event should be kept
                CLASS  = logical array set according to class word
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   MINBLD                                                                          
        |---- MINBLO                                                               
                   |----  INDEX                               External             
                   |----  MINDTYP                                                  
                   |----  IDTYPFORMAT                         External             
                   |----  ABRUEV                              External             
                   |----  MINLIS                                                   
                   |----  NLINK                               External             
                   |----  MINSIC                                                   
                   |----  MINVRS                                                   
                   |----  MINEVT                                                   
                   |----  MINTBP                                                   
                   |----  MINVER                                                   
                   |----  MINTRA                                                   
                   |----  MINGID                                                   
                   |----  MINGAC                                                   
                   |----  MINEID                                                   
                   |----  MINDLT                                                   
                   |----  MINMLT                                                   
                   |----  MINJLT                                                   
                   |----  MINKNK                                                   
                   |----  MINEWS                                                   
                   |----  MINMUI                                                   
                   |----  MINMSC                                                   
                   |----  MINENF                                                   
                   |----  MINENW                                                   
                   |----  MINJET                                                   
                   |----  MINECO                                                   
                   |----  MINHCO                                                   
                   |----  NAMIND                              External             
                   |----  MINCRL                                                   
                   |----  MINEWI                                                   
                   |----  MINHRL                                                   
                   |----  MINPOB                                                   
                   |----  NSWAP                               External             
                   |----  BLIST                               External             
   
 
3 MINCHK
         SUBROUTINE MINCHK(MODE,LRUN,SUMRY)
  ------------------------------------------------------------------------------
    CKEY MDST /INTERNAL
  ------------------------------------------------------------------------------
   Write run information in file.
       Author: Stephen Haywood      08-May-90
       Input  : MODE   = -1 for initialisation of job
                       = +1 for run termination
                       = +2 for run termination and job termination
                LRUN   = last run number
                SUMRY  = summary array
   
   
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   MINSUM                                                                          
        |---- MINCHK                                                               
                   |----  DATIME                              External             
                   |----  NINT                                External             
   
 
3 MINCRL
         SUBROUTINE MINCRL
  ------------------------------------------------------------------------------
    CKEY MDST /INTERNAL
  ------------------------------------------------------------------------------
   Fill calorimeter relation bank dcrl for mini-dst.
       Author: Stephen Haywood      22-Jan-90
       Input  : PCRL bank
       Output : DCRL bank
       Called by MINDST
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   MINBLO                                                                          
        |---- MINCRL                                                               
                   |----  NLINK                               External             
                   |----  AUBOS                               External             
                   |----  WBANK                               External             
                   |----  SORTZV                              External             
                   |----  MINLIS                                                   
                   |----  BDROP                               External             
                   |----  WDROP                               External             
   
 
3 MINDLT
         SUBROUTINE MINDLT
  ------------------------------------------------------------------------------
    CKEY MDST /INTERNAL
  ------------------------------------------------------------------------------
   Fill reconstructed tagged lepton bank ddlt for mini-dst.
       Author: Agnieszka Jacholkowska    24-Oct-94
       Input  : PDLT bank
       Output : DDLT bank
       Called by MINDST
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   MINBLN                                                                          
   MINBLO                                                                          
        |---- MINDLT                                                               
                   |----  NLINK                               External             
                   |----  AUBOS                               External             
                   |----  MINLIS                                                   
   
 
3 MINDST
         SUBROUTINE MINDST(ELIST,RLIST)
  ------------------------------------------------------------------------------
    CKEY MDST /USER
  ------------------------------------------------------------------------------
   Steering routine to create mini-dst banks not already on pot.
       Author: Stephen Haywood      22-Jan-90
       Modify: Stephen Haywood      06-Jan-93 ! Break up into parts
       Input  : POT banks
       Output : MDST banks
                ELIST = event bank-list (character*800)
                RLIST = run   bank-list (character*800)
       A list of banks which are formed for the event are stored in the
       string MLISTE in / MINCOM /.
       The event and run lists are also passed as local variables.
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   MQUEVNT                                                                         
   QWRITE                                                                          
        |---- MINDST                                                               
                   |----  MININI                                                   
                   |----  MINPRE                                                   
                   |----  MINBLD                                                   
                   |----  MINBLM                                                   
                   |----  MINADD                                                   
   
 
3 MINDTYP
         SUBROUTINE MINDTYP(IFLAG)
  ------------------------------------------------------------------------------
    CKEY MDST /INTERNAL
  ------------------------------------------------------------------------------
   Tels if one deals with lep1 or lep2 real data or mcarlo data
       Author: Jacques Boucrot      02-Sep-98
      Output  : IFLAG  = 1 if LEP1 real data or MCarlo data
                       = 2 if LEP2 real data or MCarlo data
                       = 0 if unkown (should never happen !)
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   MINBLN                                                                          
   MINBLO                                                                          
   MINRUN                                                                          
   QFPTPX                                                                          
        |---- MINDTYP                                                              
                   |----  ABRUEV                              External             
                   |----  NAMIND                              External             
   
 
3 MINECO
         SUBROUTINE MINECO
  ------------------------------------------------------------------------------
    CKEY MDST /INTERNAL
  ------------------------------------------------------------------------------
   Fill ecal calorimeter bank deco for mini-dst.
       Author: Stephen Haywood      22-Jan-90
       Input  : PECO bank
       Output : DECO bank
       Called by MINDST
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   MINBLO                                                                          
        |---- MINECO                                                               
                   |----  NLINK                               External             
                   |----  NAMIND                              External             
                   |----  AUBOS                               External             
                   |----  MINLIS                                                   
   
 
3 MINEFO
         SUBROUTINE MINEFO
  ------------------------------------------------------------------------------
    CKEY MDST /USER
  ------------------------------------------------------------------------------
   Fill efol bank from denf and denw.
       Author: Stephen Haywood      05-Feb-91
       Modify: Agnieszka Jacholkowska   20-Oct-98
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   MINFIL                                                                          
        |---- MINEFO                                                               
                   |----  MINGTV                                                   
                   |----  NLINK                               External             
                   |----  AUBOS                               External             
                   |----  BLIST                               External             
                   |----  FLOAT                               External             
                   |----  VMOD                                External             
                   |----  SQRT                                External             
   
 
3 MINEGI
         SUBROUTINE MINEGI
  ------------------------------------------------------------------------------
    CKEY MDST /USER
  ------------------------------------------------------------------------------
   Fill egid bank from dgam.
       Author: Stephen Haywood      17-Jan-91
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   MINFIL                                                                          
        |---- MINEGI                                                               
                   |----  NLINK                               External             
                   |----  MINUPD                                                   
                   |----  AUBOS                               External             
                   |----  BLIST                               External             
                   |----  MOD                                 External             
                   |----  FLOAT                               External             
   
 
3 MINEGP
         SUBROUTINE MINEGP
  ------------------------------------------------------------------------------
    CKEY MDST /USER
  ------------------------------------------------------------------------------
   Fill egpc bank from dfot.
       Author: Stephen Haywood      04-Nov-91
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
              MINEGP                                                               
                   |----  NLINK                               External             
                   |----  AUBOS                               External             
                   |----  BLIST                               External             
                   |----  FLOAT                               External             
                   |----  MOD                                 External             
   
 
3 MINEID
         SUBROUTINE MINEID
  ------------------------------------------------------------------------------
    CKEY MDST /INTERNAL
  ------------------------------------------------------------------------------
   Fill electron id bank deid for mini-dst.
       Author: Stephen Haywood      22-Jan-90
       Modify: Agnieszka Jacholkowska   24-Oct-94
       Input  : EIDT,DTRA banks
       Output : DEID bank
       Called by MINDST
       Electron information is only interesting for particles with
       energies greater than about 2 GeV.
       Therefore, a conservative momentum cut is made.
       The DTRA track bank is used for this - if not present, it can be
       created from PFRF by calling MINTRA.
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   MINBLO                                                                          
        |---- MINEID                                                               
                   |----  NINT                                External             
                   |----  NLINK                               External             
                   |----  PEIDTJ                              External             
                   |----  NAMIND                              External             
                   |----  AUBOS                               External             
                   |----  MIN                                 External             
                   |----  MAX                                 External             
                   |----  MINLIS                                                   
                   |----  BDROP                               External             
   
 
3 MINEIT
         SUBROUTINE MINEIT
  ------------------------------------------------------------------------------
    CKEY MDST /USER
  ------------------------------------------------------------------------------
   Fill eidt bank from deid.
       Author: Stephen Haywood      11-Oct-90
       Modify: Agnieszka Jacholkowska 24-Oct-94
       Logically this routine should be called MINEID - but this name
       is already used for the routine to create DEID.
       R5 is not calculated unless GETR5 is set true. This calculation
       takes a long time, and is not yet done for the DST.
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   MINFIL                                                                          
        |---- MINEIT                                                               
                   |----  NAMIND                              External             
                   |----  NLINK                               External             
                   |----  MINUPD                                                   
                   |----  AUBOS                               External             
                   |----  BLIST                               External             
                   |----  FLOAT                               External             
                   |----  ABS                                 External             
                   |----  ALFIEL                              External             
                   |----  TIDHYP                              External             
   
 
3 MINEJE
         SUBROUTINE MINEJE
  ------------------------------------------------------------------------------
    CKEY MDST /USER
  ------------------------------------------------------------------------------
   Fill ejet bank from djet.
       Author: Stephen Haywood      05-Feb-91
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   MINFIL                                                                          
        |---- MINEJE                                                               
                   |----  NLINK                               External             
                   |----  AUBOS                               External             
                   |----  BLIST                               External             
                   |----  FLOAT                               External             
   
 
3 MINENF
         SUBROUTINE MINENF
  ------------------------------------------------------------------------------
    CKEY MDST /INTERNAL
  ------------------------------------------------------------------------------
   Fill energy flow bank denf for mini-dst.
       Author: Stephen Haywood      05-Feb-91
       Input  : EFOL banks
       Output : DENF bank
       Called by MINDST
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   MINBLN                                                                          
   MINBLO                                                                          
        |---- MINENF                                                               
                   |----  NLINK                               External             
                   |----  AUBOS                               External             
                   |----  NINT                                External             
                   |----  SQRT                                External             
                   |----  MAX                                 External             
                   |----  MINLIS                                                   
   
 
3 MINENW
         SUBROUTINE MINENW
  ------------------------------------------------------------------------------
    CKEY MDST /INTERNAL
  ------------------------------------------------------------------------------
   Fill energy flow bank denw for mini-dst.
       Author: Agnieszka Jacholkowska     20-Oct-98
       Input  : EFOL banks
       Output : DENW bank
       Called by MINDST
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   MINBLN                                                                          
   MINBLO                                                                          
        |---- MINENW                                                               
                   |----  NLINK                               External             
                   |----  AUBOS                               External             
                   |----  MINLIS                                                   
   
 
3 MINEVT
         SUBROUTINE MINEVT
  ------------------------------------------------------------------------------
    CKEY MDST /INTERNAL
  ------------------------------------------------------------------------------
   Fill event information bank devt for mini-dst.
       Author: Stephen Haywood      08-Jan-93
       Input  : LOLE, XTCN, VFHL, PECO, PRPW, PEWI, PHST banks
       Output : DEVT bank
       Called by MINDST
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   MINBLN                                                                          
   MINBLO                                                                          
        |---- MINEVT                                                               
                   |----  AUBOS                               External             
                   |----  NLINK                               External             
                   |----  VZERO                               External             
                   |----  FLOAT                               External             
                   |----  EMTZER                              External             
                   |----  NINT                                External             
                   |----  NAMIND                              External             
                   |----  VSUM                                External             
                   |----  MOD                                 External             
                   |----  MINLIS                                                   
   
 
3 MINEWI
         SUBROUTINE MINEWI
  ------------------------------------------------------------------------------
    CKEY MDST /INTERNAL
  ------------------------------------------------------------------------------
   Fill ecal wire energy bank dewi for mini-dst.
       Author: Stephen Haywood      22-Jan-90
       Input  : PEWI bank
       Output : DEWI bank
       Called by MINDST
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   MINBLO                                                                          
        |---- MINEWI                                                               
                   |----  NLINK                               External             
                   |----  AUBOS                               External             
                   |----  FLOAT                               External             
                   |----  NINT                                External             
                   |----  MINLIS                                                   
   
 
3 MINEWS
         SUBROUTINE MINEWS
  ------------------------------------------------------------------------------
    CKEY MDST /INTERNAL
  ------------------------------------------------------------------------------
   Fill ecal wire energy sums bank dwes for mini-dst.
       Author: Agnieszka Jacholkowska    30-Apr-97
       Input  : PEWI bank
       Output : DWES bank
       Called by MINDST
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   MINBLO                                                                          
        |---- MINEWS                                                               
                   |----  NLINK                               External             
                   |----  AUBOS                               External             
                   |----  FLOAT                               External             
                   |----  MOD                                 External             
                   |----  NINT                                External             
                   |----  MINLIS                                                   
   
 
3 MINFIL
         SUBROUTINE MINFIL
  ------------------------------------------------------------------------------
    CKEY MDST /USER
  ------------------------------------------------------------------------------
   Fill pot banks from mini-dst.
       Author: Stephen Haywood      03-Apr-90
       Modify: Stephen Haywood      17-Feb-93
       Modify: Agnieszka Jacholkowska  22-Nov-94
       Modify: Agnieszka Jacholkowska  30-Apr-97
       Modify: Jacques Boucrot       11-Oct-2000 for 'MEFL' card
       POT banks are filled as far as is possible from the Mini-DST.
       This is done provided the POT banks do not exist already.
       If the cards NOCH etc are present, then the corresponding banks
       will not be filled.
   
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   QFILL                                                                           
        |---- MINFIL                                                               
                   |----  MINGTV                                                   
                   |----  FORMAT                              External             
                   |----  NAMIND                              External             
                   |----  NLINK                               External             
                   |----  ALVSN                               External             
                   |----  MINLOL                                                   
                   |----  MINXTR                                                   
                   |----  MINPSC                                                   
                   |----  MINFRF                                                   
                   |----  MINFRT                                                   
                   |----  MINPYE                                                   
                   |----  MINYV0                                                   
                   |----  MINPYF                                                   
                   |----  MINPCQ                                                   
                   |----  MINPCR                                                   
                   |----  MINPEC                                                   
                   |----  MINPHC                                                   
                   |----  MINEGI                                                   
                   |----  MINPGA                                                   
                   |----  MINPDL                                                   
                   |----  MINPML                                                   
                   |----  MINPJL                                                   
                   |----  MINPTH                                                   
                   |----  MINYNK                                                   
                   |----  MINBIP                                                   
                   |----  MINPGI                                                   
                   |----  MINPGP                                                   
                   |----  MINEIT                                                   
                   |----  MINFRI                                                   
                   |----  MINEFO                                                   
                   |----  MINEJE                                                   
                   |----  MINFKI                                                   
                   |----  MINFVE                                                   
                   |----  MINFZF                                                   
                   |----  PTGMAJ                              External             
                   |----  ALFIEL                              External             
                   |----  PITMAJ                              External             
                   |----  MINUPD                                                   
   
 
3 MINFKI
         SUBROUTINE MINFKI
  ------------------------------------------------------------------------------
    CKEY MDST /INTERNAL
  ------------------------------------------------------------------------------
   Fill fkin from dtmc.
       Author: Stephen Haywood      21-Nov-90
       Input  : DTMC bank
       Output : FKIN bank
       Called by MINFIL
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   MINFIL                                                                          
        |---- MINFKI                                                               
                   |----  NLINK                               External             
                   |----  AUBOS                               External             
                   |----  BLIST                               External             
                   |----  FLOAT                               External             
                   |----  UCOPY                               External             
   
 
3 MINFMC
         SUBROUTINE MINFMC
  ------------------------------------------------------------------------------
    CKEY MDST /INTERNAL
  ------------------------------------------------------------------------------
   Fill fragmentation mc bank dfmc for mini-dst.
       Author: Stephen Haywood      21-Nov-90
       Input  : FZFR bank
       Output : DFMC bank
       Called by MINDST
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   MINBLM                                                                          
        |---- MINFMC                                                               
                   |----  NLINK                               External             
                   |----  AUBOS                               External             
                   |----  NINT                                External             
                   |----  MINLIS                                                   
   
 
3 MINFMT
         SUBROUTINE MINFMT
  ------------------------------------------------------------------------------
    CKEY MDST /INTERNAL
  ------------------------------------------------------------------------------
   Define bank formats for mini-dst.
       Author: Stephen Haywood      22-Jan-90
       Modify: Stephen Haywood      22-Feb-93
       On official Mini's the bank formats are absent to save space.
       This is a delicate operation and is not in general encouraged.
       It seems to work for data written on IBM and read on any machine.
       provided that the format does not contain an 'A'.
       For this reason, the format for DVMC is explicitly written out by
       MINVMC.
       MINFMT should be called at initialisation, before banks are
       written or read.
       On writing a Mini:
       If 'NOFM' is added to COMP card then
          formats for Mini banks are not invoked and formats for POT
          banks may be dropped by MINNOF (when MINOUT is called rather
          than QWRITE). This is communicated by NOFORM.
       Else
          formats for Mini banks are supplied by ALFMT, while those
          for the POT banks are already present.
       On reading a Mini:
       Formats are supplied by ALFMT (or implicitly by CMPINI).
       New banks which have not made it to BANKAL FMT can be handled
       temporarily by explicit calls to BKFMT.
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   QMINIT                                                                          
        |---- MINFMT                                                               
                   |----  NAMIND                              External             
                   |----  INTCHA                              External             
                   |----  ALFMT                               External             
   
 
3 MINFRF
         SUBROUTINE MINFRF(NB)
  ------------------------------------------------------------------------------
    CKEY MDST /USER
  ------------------------------------------------------------------------------
   Fill frft bank from dtra.
       Author: Stephen Haywood           03-Apr-1990
       Modified J. Boucrot for MINI 205  09-Jan-2001
    argument: NB = FRFT bank number
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   MINFIL                                                                          
        |---- MINFRF                                                               
                   |----  AMAX1                               External             
                   |----  FLOAT                               External             
                   |----  MINGTV                                                   
                   |----  NLINK                               External             
                   |----  MINUPD                                                   
                   |----  AUBOS                               External             
                   |----  BLIST                               External             
                   |----  ALFIEL                              External             
                   |----  ABS                                 External             
                   |----  SIN                                 External             
                   |----  TAN                                 External             
                   |----  KROW                                External             
                   |----  RW                                  External             
                   |----  SQRT                                External             
                   |----  AMIN1                               External             
                   |----  EXP                                 External             
                   |----  FUPKCM                              External             
                   |----  MINHIT                                                   
   
 
3 MINFRI
         SUBROUTINE MINFRI
  ------------------------------------------------------------------------------
    CKEY MDST /USER
  ------------------------------------------------------------------------------
   Fill frid bank from dtra.
       Author: Stephen Haywood      14-Jan-91
       Track quality is filled from DTRA if it is contained there.
       If not, UFITQL is called, and this requires FRFT, FRTL and YV0V.
       These banks can be obtained by calling MINFRF, MINFRT and MINYV0.
       These banks will not be present if NOCH or NOV0 are used.
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   MINFIL                                                                          
        |---- MINFRI                                                               
                   |----  NLINK                               External             
                   |----  MINUPD                                                   
                   |----  MINGTV                                                   
                   |----  AUBOS                               External             
                   |----  BLIST                               External             
                   |----  UFITQL                              External             
   
 
3 MINFRT
         SUBROUTINE MINFRT
  ------------------------------------------------------------------------------
    CKEY MDST /USER
  ------------------------------------------------------------------------------
   Fill frtl bank from dtra.
       Author: Stephen Haywood      03-Apr-90
       The number of hits is available in the bit pattern stored in the
       DTRA bank. This word (or parts of it) is used as the index to a
       look up table, K, which contains the bit sums.
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   MINFIL                                                                          
        |---- MINFRT                                                               
                   |----  JBIT                                External             
                   |----  NLINK                               External             
                   |----  MINUPD                                                   
                   |----  AUBOS                               External             
                   |----  BLIST                               External             
                   |----  JBYT                                External             
   
 
3 MINFVB
         SUBROUTINE MINFVB(KDTRA)
  ------------------------------------------------------------------------------
    CKEY MDST /INTERNAL
  ------------------------------------------------------------------------------
   Fill vertex bit pattern in dtra, and 'dyv0' bank for minis >= 205
       Author: Stephen Haywood      10-Feb-1993
       Modif : Jacques Boucrot      09-Jan-2001
       Input  : PYER,PYFR,YV0V banks
                KDTRA  = index of DTRA bank
       Output : vertex bits of DTRA bank
                and 'DYV0 bank for MINIs >= 205
       Called by MINTRA
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   MINTRA                                                                          
        |---- MINFVB                                                               
                   |----  NLINK                               External             
                   |----  SBIT1                               External             
                   |----  NAMIND                              External             
                   |----  AUBOS                               External             
                   |----  SORTZV                              External             
   
 
3 MINFVE
         SUBROUTINE MINFVE
  ------------------------------------------------------------------------------
    CKEY MDST /INTERNAL
  ------------------------------------------------------------------------------
   Fill fver from dvmc.
       Author: Stephen Haywood      21-Nov-90
       Input  : DVMC bank
       Output : FVER bank
       Called by MINFIL
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   MINFIL                                                                          
        |---- MINFVE                                                               
                   |----  NLINK                               External             
                   |----  INTCHA                              External             
                   |----  AUBOS                               External             
                   |----  BLIST                               External             
                   |----  FLOAT                               External             
   
 
3 MINFZF
         SUBROUTINE MINFZF
  ------------------------------------------------------------------------------
    CKEY MDST /INTERNAL
  ------------------------------------------------------------------------------
   Fill fzfr from dfmc.
       Author: Stephen Haywood      21-Nov-90
       Input  : DFMC bank
       Output : FZFR bank
       Called by MINFIL
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   MINFIL                                                                          
        |---- MINFZF                                                               
                   |----  NLINK                               External             
                   |----  AUBOS                               External             
                   |----  BLIST                               External             
                   |----  FLOAT                               External             
   
 
3 MINGAC
         SUBROUTINE MINGAC
  ------------------------------------------------------------------------------
    CKEY MDST /INTERNAL
  ------------------------------------------------------------------------------
   Fill photon bank dgac for mini-dst.
       Author: Agnieszka Jacholkowska    17-Oct-94
       Input  : PGAC bank
       Output : DGAC bank
       Called by MINDST
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   MINBLN                                                                          
   MINBLO                                                                          
        |---- MINGAC                                                               
                   |----  NLINK                               External             
                   |----  AUBOS                               External             
                   |----  NINT                                External             
                   |----  MINLIS                                                   
   
 
3 MINGID
         SUBROUTINE MINGID
  ------------------------------------------------------------------------------
    CKEY MDST /INTERNAL
  ------------------------------------------------------------------------------
   Fill photon bank dgid for mini-dst.
       Author: Stephen Haywood      02-Mar-93
       Input  : PGID bank
       Output : DGID bank
       Called by MINDST
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   MINBLN                                                                          
   MINBLO                                                                          
        |---- MINGID                                                               
                   |----  NLINK                               External             
                   |----  AUBOS                               External             
                   |----  NINT                                External             
                   |----  MINLIS                                                   
   
 
3 MINGPC
         SUBROUTINE MINGPC
  ------------------------------------------------------------------------------
    CKEY MDST /INTERNAL
  ------------------------------------------------------------------------------
   Fill photon bank dgpc for mini-dst.
       Author: Stephen Haywood      02-Mar-93
       Input  : PGPC bank
       Output : DGPC bank
       Called by MINDST
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
              MINGPC                                                               
                   |----  NLINK                               External             
                   |----  AUBOS                               External             
                   |----  NINT                                External             
                   |----  MINLIS                                                   
   
 
3 MINGTV
         INTEGER FUNCTION MINGTV(DUMMY)
  ------------------------------------------------------------------------------
    CKEY MDST /INTERNAL
  ------------------------------------------------------------------------------
   Mini-dst version number used to produce current data.
       This is obtained from the event bank DVRS or the run bank RHAH by
       a call to ALVSN.
       It can be overrode by the MVOK data card.
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   MINEFO                                                                          
   MINFIL                                                                          
   MINFRF                                                                          
   MINFRI                                                                          
   MINPCQ                                                                          
   MINPFR                                                                          
   MINUPD                                                                          
   ECGATI                                                                          
   FIXPECO                                                                         
   FIXRTRL                                                                         
   QFGAMP                                                                          
   QFILL                                                                           
   QWRUNR                                                                          
   QURHAH                                                                          
   BTVDHITS                                                                        
   QVDHIT                                                                          
   QVTRUH                                                                          
        |---- MINGTV                                                               
                   |----  ABRUEV                              External             
                   |----  NLINK                               External             
                   |----  ALVSN                               External             
   
 
3 MINHCO
         SUBROUTINE MINHCO
  ------------------------------------------------------------------------------
    CKEY MDST /INTERNAL
  ------------------------------------------------------------------------------
   Fill hcal calorimeter bank dhco for mini-dst.
       Author: Stephen Haywood      22-Jan-90
       Input  : PHCO bank
       Output : DHCO bank
       Called by MINDST
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   MINBLO                                                                          
        |---- MINHCO                                                               
                   |----  NLINK                               External             
                   |----  AUBOS                               External             
                   |----  SBIT1                               External             
                   |----  MINLIS                                                   
   
 
3 MINHIS
         SUBROUTINE MINHIS(IMAQQ)
  ------------------------------------------------------------------------------
    CKEY MDST /INTERNAL
  ------------------------------------------------------------------------------
   Fill some simple histograms to monitor the mini-dst.
       Author: Stephen Haywood      25-Apr-90
       Modify: Agnieszka Jacholkowska  16-Nov-94
       To obtain histograms, HBOOK must already be initialised.
       Output : IMAQQ  = 1 for hadronic event candidate (Class 16)
                       = 0 for other events written to Mini-DST
                       =-1 for events which are not writen to Mini-DST
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   MQUEVNT                                                                         
        |---- MINHIS                                                               
                   |----  FLOAT                               External             
                   |----  TIMED                               External             
                   |----  HBOOK1                              External             
                   |----  HIDOPT                              External             
                   |----  INDEX                               External             
                   |----  NAMIND                              External             
                   |----  BTEST                                                    
                   |----  HFILL                               External             
                   |----  SUMMIN                                                   
                   |----  NLINK                               External             
                   |----  F                                   External             
                   |----  JBIT                                External             
                   |----  JBYT                                External             
                   |----  SQRT                                External             
   
 
3 MINHIT
         FUNCTION MINHIT(IH,IDET)
  ------------------------------------------------------------------------------
    CKEY MDST /USER
  ------------------------------------------------------------------------------
   Find number of hits in mvd, itc or tpc from dtra bank.
       Author: Stephen Haywood      22-Jan-90
       Input  : IH     = hit pattern from DTRA bank
                IDET   = 1, 2 or 3 for MVD, ITC or TPC
       Output : MINHIT = number of hits observed in specified detector
       The routine counts the number of bits in the part of the hit
       pattern word (word-part) corresponding to the specified detector.
       For reasons of speed, it uses the word-part (or 8-bit sub-parts)
       as indices to an array K which contains the bit sums
       corresponding to the addressing byte.
       This is a factor 4 faster than doing the bit sums dirrectly, and
       a factor 6 faster than using a logical bit test.
       This method was suggested to me by David Asbury of DD.
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   MINFRF                                                                          
   MINUPD                                                                          
        |---- MINHIT                                                               
                   |----  JBIT                                External             
                   |----  JBYT                                External             
   
 
3 MINHRL
         SUBROUTINE MINHRL
  ------------------------------------------------------------------------------
    CKEY MDST /INTERNAL
  ------------------------------------------------------------------------------
   Fill hcal tower-digital relation dhrl for mini-dst.
       Author: Stephen Haywood      22-Jan-90
       Input  : PCRL bank
       Output : DHRL bank
       Called by MINDST
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   MINBLO                                                                          
        |---- MINHRL                                                               
                   |----  NLINK                               External             
                   |----  AUBOS                               External             
                   |----  WBANK                               External             
                   |----  SORTZV                              External             
                   |----  MINLIS                                                   
                   |----  BDROP                               External             
                   |----  WDROP                               External             
   
 
3 MININI
         SUBROUTINE MININI(NWANT,WLIST)
  ------------------------------------------------------------------------------
    CKEY MDST /INTERNAL
  ------------------------------------------------------------------------------
   Mini code initialisation.
       Author: Stephen Haywood      06-Jan-93
       Output : NWANT  = number of banks listed on MINI card
                       = 1 if no MINI card
                WLIST  = list of banks on MINI card
                       = ' ' if no MINI card
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   MINDST                                                                          
        |---- MININI                                                               
                   |----  NLINK                               External             
                   |----  CHAINT                              External             
                   |----  MINRUN                                                   
   
 
3 MINJET
         SUBROUTINE MINJET
  ------------------------------------------------------------------------------
    CKEY MDST /INTERNAL
  ------------------------------------------------------------------------------
   Fill jet bank djet for mini-dst.
       Author: Stephen Haywood      05-Feb-91
       Input  : EJET banks
       Output : DJET bank
       Called by MINDST
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   MINBLN                                                                          
   MINBLO                                                                          
        |---- MINJET                                                               
                   |----  NLINK                               External             
                   |----  AUBOS                               External             
                   |----  MINLIS                                                   
   
 
3 MINJLT
         SUBROUTINE MINJLT
  ------------------------------------------------------------------------------
    CKEY MDST /INTERNAL
  ------------------------------------------------------------------------------
   Fill reconstructed tagged lepton bank ddlt for mini-dst.
       Author: Agnieszka Jacholkowska    14-Nov-94
       Input  : PLJT bank
       Output : DLJT bank
       Called by MINDST
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   MINBLN                                                                          
   MINBLO                                                                          
        |---- MINJLT                                                               
                   |----  NLINK                               External             
                   |----  AUBOS                               External             
                   |----  MINLIS                                                   
   
 
3 MINKNK
         SUBROUTINE MINKNK
  ------------------------------------------------------------------------------
    CKEY MDST /INTERNAL
  ------------------------------------------------------------------------------
   Fill kink bank dknk for mini-dst.
       Author: Agnieszka Jacholkowska    30-Apr-97
       Input  : YKNK bank
       Output : DKNK bank
       Called by MINDST
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   MINBLN                                                                          
   MINBLO                                                                          
        |---- MINKNK                                                               
                   |----  NLINK                               External             
                   |----  AUBOS                               External             
                   |----  NINT                                External             
                   |----  MINLIS                                                   
   
 
3 MINLIS
         SUBROUTINE MINLIS(BANK)
  ------------------------------------------------------------------------------
    CKEY MDST /INTERNAL
  ------------------------------------------------------------------------------
   Add a bank to the list of mini-dst banks.
       Author: Stephen Haywood      15-Mar-90
       Called by MINDST
       INPUT  : BANK  = bank name to be added to Mini list
                        '0   ' to initialise list for new event
       The common block / MINCOM / is modified.
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   MINADD                                                                          
   MINBLM                                                                          
   MINBLN                                                                          
   MINBLO                                                                          
   MINCRL                                                                          
   MINDLT                                                                          
   MINECO                                                                          
   MINEID                                                                          
   MINENF                                                                          
   MINENW                                                                          
   MINEVT                                                                          
   MINEWI                                                                          
   MINEWS                                                                          
   MINFMC                                                                          
   MINGAC                                                                          
   MINGID                                                                          
   MINGPC                                                                          
   MINHCO                                                                          
   MINHRL                                                                          
   MINJET                                                                          
   MINJLT                                                                          
   MINKNK                                                                          
   MINMLT                                                                          
   MINMSC                                                                          
   MINMUI                                                                          
   MINPOB                                                                          
   MINPRE                                                                          
   MINSIC                                                                          
   MINTBP                                                                          
   MINTHR                                                                          
   MINTMC                                                                          
   MINTRA                                                                          
   MINVER                                                                          
   MINVMC                                                                          
   MINVRS                                                                          
   MINYNK                                                                          
   MQUSREC                                                                         
   MDWRIP                                                                          
        |---- MINLIS                                                               
                   |----  ABRUEV                              External             
                   |----  LNBLNK                              External             
                   |----  BLIST                               External             
   
 
3 MINLOL
         SUBROUTINE MINLOL
  ------------------------------------------------------------------------------
    CKEY MDST /USER
  ------------------------------------------------------------------------------
   Fill lole bank from devt or dhea.
       Author: Stephen Haywood      03-Apr-90
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   MINFIL                                                                          
        |---- MINLOL                                                               
                   |----  NLINK                               External             
                   |----  AUBOS                               External             
                   |----  BLIST                               External             
   
 
3 MINMLT
         SUBROUTINE MINMLT
  ------------------------------------------------------------------------------
    CKEY MDST /INTERNAL
  ------------------------------------------------------------------------------
   Fill history of tagged lepton bank dmlt for mini-dst.
       Author: Agnieszka Jacholkowska    24-Oct-94
       Input  : PMLT bank
       Output : DMLT bank
       Called by MINDST
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   MINBLN                                                                          
   MINBLO                                                                          
        |---- MINMLT                                                               
                   |----  NLINK                               External             
                   |----  AUBOS                               External             
                   |----  MINLIS                                                   
   
 
3 MINMON
         SUBROUTINE MINMON(MODE,IMAQQ, SUMRY)
  ------------------------------------------------------------------------------
    CKEY MDST /INTERNAL
  ------------------------------------------------------------------------------
   Simple monitoring of the mini-dst.
       Author: Stephen Haywood      25-Apr-90
       Modify: Stephen Haywood      08-Jun-90   v 3.0
       Input  : MODE   = -1 for reset
                          0 for event monitoring
                         +1 for termination, then reset
                IMAQQ  = 1 for hadronic event candidate, 0 otherwise
       Output : SUMRY  = summary array
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   MQUEVNT                                                                         
   MQUINIT                                                                         
   MQUNEWR                                                                         
   MQUTERM                                                                         
        |---- MINMON                                                               
                   |----  LNBLNK                              External             
                   |----  IUCOMP                              External             
                   |----  INTCHA                              External             
                   |----  NAMIND                              External             
                   |----  CUTOL                               External             
                   |----  SORTZV                              External             
                   |----  VZERO                               External             
                   |----  FLOAT                               External             
   
 
3 MINMSC
         SUBROUTINE MINMSC
  ------------------------------------------------------------------------------
    CKEY MDST /INTERNAL
  ------------------------------------------------------------------------------
   Fill  bank dmsc for mini-dst.
       Author: Agnieszka Jacholkowska    30-Sep-1994
       Modified : J. Boucrot             19-Jan-2001
       Input  : FRFT bank
       Output : DMSC bank (multiple scattering angle)
       Called by MINDST
       FRFT is  used after call to MINTRA
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   MINBLN                                                                          
   MINBLO                                                                          
        |---- MINMSC                                                               
                   |----  NAMIND                              External             
                   |----  FPTOJ                               External             
                   |----  AUBOS                               External             
                   |----  NLINK                               External             
                   |----  MINLIS                                                   
   
 
3 MINMUI
         SUBROUTINE MINMUI
  ------------------------------------------------------------------------------
    CKEY MDST /USER
  ------------------------------------------------------------------------------
   Modify and save muon banks for mini-dst.
       Author: Stephen Haywood      28-Jul-1992
       Mod     J. Boucrot           09-Jan-2001
       Input  : HMAD, MCAD, MUID
       Output : HMAD, MCAD, MUID
       Called by MINDST.
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   MINBLN                                                                          
   MINBLO                                                                          
        |---- MINMUI                                                               
                   |----  MINVSN                                                   
                   |----  NLINK                               External             
                   |----  AMUID                               External             
                   |----  UCOPY                               External             
                   |----  AUBOS                               External             
                   |----  MINLIS                                                   
   
 
3 MINNOF
         SUBROUTINE MINNOF(MODE)
  ------------------------------------------------------------------------------
    CKEY MDST /INTERNAL
  ------------------------------------------------------------------------------
   Ensure no formats are written for pot banks.
       Author: Stephen Haywood      28-Feb-91
       Input  : MODE   = -1 to delete links to formats
                       = +1 to restore links to formats
       Called by MINOUT.
       The banks whose formats will be dropped are listed on 'T' list,
       which is prepared by MINOUT.
       This requires changes to BOS system common.
       The formats are disabled by zeroing their address. However, these
       are restablished by garbage collections in the work space, and so
       must be done just before the banks are written.
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
              MINNOF                                                               
                   |----  VZERO                               External             
                   |----  MOD                                 External             
                   |----  IABS                                External             
                   |----  INTCHA                              External             
                   |----  NLIST                               External             
   
 
3 MINOUT
         SUBROUTINE MINOUT
  ------------------------------------------------------------------------------
    CKEY MDST /USER
  ------------------------------------------------------------------------------
   Simple routine to write a mini-dst.
       Author: Stephen Haywood      15-Mar-90
       Input  : List of Mini-DST banks in / MINCOM /
       This routine is required for standalone output.
       The data base should be opened and events read with ABRSEL.
       The Mini o/p file should be closed with
          CALL BWRITE(IW,LMINI,'0')
       where LMINI is the o/p unit obtained from ABUNIT.
       The event records are dropped for each event by adding Mini banks
       to 'E' list; which is then dropped by ABRSEL.
       Since the compression package uses BLIST, one of the BOS lists
       must be used - we use the 'T' list.
       This routine used to create the EDIR. This is now done from REVH
       and the corresponding code has been removed.
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   MQUEVNT                                                                         
   MQUSREC                                                                         
        |---- MINOUT                                                               
                   |----  NAMIND                              External             
                   |----  INTCHA                              External             
                   |----  ABUNIT                              External             
                   |----  ABRUEV                              External             
                   |----  BKRHAL                              External             
                   |----  MINVSN                                                   
                   |----  BWRITE                              External             
                   |----  BLIST                               External             
                   |----  LNBLNK                              External             
                   |----  CMPLIS                              External             
                   |----  NLIST                               External             
   
 
3 MINPCP
         SUBROUTINE MINPCP
  ------------------------------------------------------------------------------
    CKEY MDST /USER
  ------------------------------------------------------------------------------
   Fill pcpa bank from dneu and dres.
       Author: Stephen Haywood      17-Jan-91
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
              MINPCP                                                               
                   |----  NLINK                               External             
                   |----  AUBOS                               External             
                   |----  BLIST                               External             
                   |----  FLOAT                               External             
   
 
3 MINPCQ
         SUBROUTINE MINPCQ
  ------------------------------------------------------------------------------
    CKEY MDST /USER
  ------------------------------------------------------------------------------
   Fill pcqa bank from dneu and dres.
       Author: J.Carr    14 May 1991
                 ( modified from MINPCP of Stephen Haywood )
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   MINFIL                                                                          
        |---- MINPCQ                                                               
                   |----  NLINK                               External             
                   |----  MINGTV                                                   
                   |----  FLOAT                               External             
                   |----  COS                                 External             
                   |----  SIN                                 External             
                   |----  PCMECU                              External             
   
 
3 MINPCR
         SUBROUTINE MINPCR
  ------------------------------------------------------------------------------
    CKEY MDST /USER
  ------------------------------------------------------------------------------
   Fill pcrl bank from dcrl.
       Author: Stephen Haywood      03-Apr-90
       It appears that the PCRL bank is essential for the operation of
       ALPHA.
       If no DCRL bank exists, a dummy PCRL with one empty row is made.
       This is necessary since, if there are simple isolated calobjects,
       they will not appear in the DCRL bank, and if all objects are of
       this form, then the DCRL bank will be empty.
       It would be better to create rows in the PCRL bank with the
       trivial relations in (ie. one object, and the other entries zero).
       However, this requires looking at PECO/PHCO banks and reduces
       simplicity.
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   MINFIL                                                                          
        |---- MINPCR                                                               
                   |----  NAMIND                              External             
                   |----  NLINK                               External             
                   |----  AUBOS                               External             
                   |----  BLIST                               External             
   
 
3 MINPDL
         SUBROUTINE MINPDL
  ------------------------------------------------------------------------------
    CKEY MDST /INTERNAL
  ------------------------------------------------------------------------------
   Fill pdlt bank from ddlt.
       Author: Agnieszka Jacholkowska    24-Oct-94
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   MINFIL                                                                          
        |---- MINPDL                                                               
                   |----  NLINK                               External             
                   |----  AUBOS                               External             
                   |----  BLIST                               External             
                   |----  FLOAT                               External             
   
 
3 MINPEC
         SUBROUTINE MINPEC
  ------------------------------------------------------------------------------
    CKEY MDST /USER
  ------------------------------------------------------------------------------
   Fill peco bank from deco.
       Author: Stephen Haywood      03-Apr-90
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   MINFIL                                                                          
        |---- MINPEC                                                               
                   |----  NAMIND                              External             
                   |----  NLINK                               External             
                   |----  MINUPD                                                   
                   |----  AUBOS                               External             
                   |----  BLIST                               External             
                   |----  FLOAT                               External             
                   |----  SBIT1                               External             
   
 
3 MINPFR
         SUBROUTINE MINPFR
  ------------------------------------------------------------------------------
    CKEY TERM/INTERNAL
  ------------------------------------------------------------------------------
    the PRFR bank for GAMPEX
    Boucrot 9-Jan-2001
    from QFCHGD
    the JULIA routine FITWRI
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   QFFRFT                                                                          
        |---- MINPFR                                                               
                   |----  MINGTV                                                   
                   |----  FITWRI                              External             
                   |----  BLIST                               External             
   
 
3 MINPGA
         SUBROUTINE MINPGA
  ------------------------------------------------------------------------------
    CKEY MDST /INTERNAL
  ------------------------------------------------------------------------------
   Fill pgac bank from dgac.
       Author: Agnieszka Jacholkowska    17-Oct-94
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   MINFIL                                                                          
        |---- MINPGA                                                               
                   |----  NLINK                               External             
                   |----  AUBOS                               External             
                   |----  BLIST                               External             
                   |----  FLOAT                               External             
   
 
3 MINPGI
         SUBROUTINE MINPGI
  ------------------------------------------------------------------------------
    CKEY MDST /INTERNAL
  ------------------------------------------------------------------------------
   Fill pgid bank from dgid.
       Author: Stephen Haywood      02-Mar-93
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   MINFIL                                                                          
        |---- MINPGI                                                               
                   |----  NLINK                               External             
                   |----  AUBOS                               External             
                   |----  BLIST                               External             
                   |----  FLOAT                               External             
   
 
3 MINPGP
         SUBROUTINE MINPGP
  ------------------------------------------------------------------------------
    CKEY MDST /INTERNAL
  ------------------------------------------------------------------------------
   Fill pgpc bank from dgpc.
       Author: Stephen Haywood      02-Mar-93
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   MINFIL                                                                          
        |---- MINPGP                                                               
                   |----  NLINK                               External             
                   |----  AUBOS                               External             
                   |----  BLIST                               External             
                   |----  FLOAT                               External             
   
 
3 MINPHC
         SUBROUTINE MINPHC
  ------------------------------------------------------------------------------
    CKEY MDST /USER
  ------------------------------------------------------------------------------
   Fill phco bank from dhco.
       Author: Stephen Haywood         03-Apr-90
       Modify: Agnieszka Jacholkowska  05-May-97
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   MINFIL                                                                          
        |---- MINPHC                                                               
                   |----  NAMIND                              External             
                   |----  NLINK                               External             
                   |----  AUBOS                               External             
                   |----  BLIST                               External             
                   |----  FLOAT                               External             
                   |----  JBYT                                External             
   
 
3 MINPJL
         SUBROUTINE MINPJL
  ------------------------------------------------------------------------------
    CKEY MDST /INTERNAL
  ------------------------------------------------------------------------------
   Fill pljt bank from dljt.
       Author: Agnieszka Jacholkowska    14-Nov-94
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   MINFIL                                                                          
        |---- MINPJL                                                               
                   |----  NLINK                               External             
                   |----  AUBOS                               External             
                   |----  BLIST                               External             
                   |----  FLOAT                               External             
   
 
3 MINPML
         SUBROUTINE MINPML
  ------------------------------------------------------------------------------
    CKEY MDST /INTERNAL
  ------------------------------------------------------------------------------
   Fill pmlt bank from dmlt.
       Author: Agnieszka Jacholkowska    24-Oct-94
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   MINFIL                                                                          
        |---- MINPML                                                               
                   |----  NLINK                               External             
                   |----  AUBOS                               External             
                   |----  BLIST                               External             
   
 
3 MINPOB
         SUBROUTINE MINPOB
  ------------------------------------------------------------------------------
    CKEY MDST /INTERNAL
  ------------------------------------------------------------------------------
   Fill hcal digital pattern object dpob for mini-dst.
       Author: Stephen Haywood      22-Jan-90
       Input  : PPOB bank
       Output : DPOB bank
       Called by MINDST
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   MINBLO                                                                          
        |---- MINPOB                                                               
                   |----  NLINK                               External             
                   |----  AUBOS                               External             
                   |----  MINLIS                                                   
   
 
3 MINPRE
         SUBROUTINE MINPRE(WLIST, CLASS,IMINI,KEEP)
  ------------------------------------------------------------------------------
    CKEY MDST /INTERNAL
  ------------------------------------------------------------------------------
   Mini code preparation of new event.
       Author: Stephen Haywood      06-Jan-93
       Modify: Agnieszka Jacholkowska   17-Jul-95
       Input  : WLIST  = Wish-list of banks to be written on Mini
       Output : CLASS  = logical array set according to class word
                IMINI  = flag indicating whether Mini is being read
                       = 0 if not Mini i/p
                       = 1 if Mini i/p with no wish-list on MINI card
                       = 2 if Mini i/p with wish-list on MINI card
                KEEP   = flag indicating whether event should be kept
                       =  0 do not keep event
                       = -1 lumi ervent: keep limited set of banks
                       = +1 interesting event: create all possible banks
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   MINDST                                                                          
        |---- MINPRE                                                               
                   |----  MINLIS                                                   
                   |----  ABRUEV                              External             
                   |----  ALVSN                               External             
                   |----  NAMIND                              External             
                   |----  CHAINT                              External             
                   |----  INDEX                               External             
                   |----  CLAS24                              External             
                   |----  SBIT1                               External             
                   |----  LASS                                External             
                   |----  BTEST                                                    
                   |----  NLIST                               External             
                   |----  NLINK                               External             
                   |----  NDROP                               External             
                   |----  STRIGF                              External             
   
 
3 MINPSC
         SUBROUTINE MINPSC
  ------------------------------------------------------------------------------
    CKEY MDST /INTERNAL
  ------------------------------------------------------------------------------
   Fill  bank pmsc for alpha   .
       Author: Agnieszka Jacholkowska              30-Sep-1994
       Modified J. Boucrot for multiple DMSC banks 18-Jan-2001
       Input  : DMSC bank
       Output : PMSC bank
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   MINFIL                                                                          
        |---- MINPSC                                                               
                   |----  NAMIND                              External             
                   |----  AUBOS                               External             
                   |----  BLIST                               External             
                   |----  NLINK                               External             
                   |----  FLOAT                               External             
   
 
3 MINPTH
         SUBROUTINE MINPTH
  ------------------------------------------------------------------------------
    CKEY MDST /USER
  ------------------------------------------------------------------------------
   Fill pthr bank from dthr.
       Author: Agnieszka Jacholkowska      19-Sep-94
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   MINFIL                                                                          
        |---- MINPTH                                                               
                   |----  NLINK                               External             
                   |----  AUBOS                               External             
                   |----  BLIST                               External             
                   |----  FLOAT                               External             
   
 
3 MINPYE
         SUBROUTINE MINPYE
  ------------------------------------------------------------------------------
    CKEY MDST /USER
  ------------------------------------------------------------------------------
   Fill pyer bank from dver.
       Author: Stephen Haywood      03-Apr-90
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   MINFIL                                                                          
        |---- MINPYE                                                               
                   |----  NLINK                               External             
                   |----  MINUPD                                                   
                   |----  AUBOS                               External             
                   |----  BLIST                               External             
                   |----  FLOAT                               External             
   
 
3 MINPYF
         SUBROUTINE MINPYF
  ------------------------------------------------------------------------------
    CKEY MDST /USER
  ------------------------------------------------------------------------------
   Fill pyfr bank from dtra.
       Author: Stephen Haywood      03-Apr-90
       DVER bank also used.
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   MINFIL                                                                          
        |---- MINPYF                                                               
                   |----  NLINK                               External             
                   |----  MINUPD                                                   
                   |----  AUBOS                               External             
                   |----  BLIST                               External             
                   |----  JBIT                                External             
   
 
3 MINQMU
         SUBROUTINE MINQMU(ITRK, IBE,IBT,IM1,IM2,NEXP,NFIR,N10,N03,XMULT,
  ------------------------------------------------------------------------------
    CKEY MDST /INTERNAL
  ------------------------------------------------------------------------------
        &  ISHAD,IER)
   Mini-dst interface for qmuido.
       Author: Stephen Haywood      09-Jan-91
       Input  : DMUO bank
                ITRK  = Julia track number
       Output : variables for QMUIDO - see QMUIDO for description
                IER   = error code: 0 if ok, +10 if no information
       Called by QMUIDO
       Note:
       Because some variables are stored in DMUO with limited precision,
       the results may not be identical to those obtained from the POT.
       However, the differences should not be important.
       XMULT is stored to 2 DP in range [0.00,5.11].
       If a charged track points to a shadowed muon track, then if the
       charged track is the best matching one, ISHAD is set to that track
       number; else it is set to -1.
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   QMUIDO                                                                          
        |---- MINQMU                                                               
                   |----  NAMIND                              External             
                   |----  MVBITS                              External             
                   |----  FLOAT                               External             
                   |----  JBIT                                External             
                   |----  NINT                                External             
                   |----  VSUM                                External             
   
 
3 MINRUN
         SUBROUTINE MINRUN
  ------------------------------------------------------------------------------
    CKEY MDST /INTERNAL
  ------------------------------------------------------------------------------
   Define run banks to be written for mini-dst.
       Author: Stephen Haywood      15-May-90
       Modify: Stephen Haywood      08-Jun-90   v 3.0
       Modify: Agnieszka Jacholkowska  1-Nov-1994
               use mindtyp :           3-Nov-1998
       Called by MINDST
       More banks may be added from MINA card, interpreted by MINADD.
       Also the nature of the data (MC or real) is determined.
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   MININI                                                                          
        |---- MINRUN                                                               
                   |----  MINDTYP                                                  
                   |----  IDTYPFORMAT                         External             
                   |----  ALVSN                               External             
                   |----  NLINK                               External             
                   |----  NLIST                               External             
   
 
3 MINSIC
         SUBROUTINE MINSIC
  ------------------------------------------------------------------------------
    CKEY MDST /INTERNAL
  ------------------------------------------------------------------------------
   Fill sical bank dsic for mini-dst.
       Author: Stephen Haywood      24-May-93
       Input  : SILU bank
       Output : DSIC bank
       Called by MINDST
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   MINBLN                                                                          
   MINBLO                                                                          
        |---- MINSIC                                                               
                   |----  NLINK                               External             
                   |----  AUBOS                               External             
                   |----  MINLIS                                                   
   
 
3 MINSUM
         SUBROUTINE MINSUM(MODE,LRUN,SUMRY)
  ------------------------------------------------------------------------------
    CKEY MDST /INTERNAL
  ------------------------------------------------------------------------------
   Write summary file for the mini-dst.
       Author: Stephen Haywood         08-May-90
       Modify: Agnieszka Jacholkowska  18-May-95
       Input  : MODE   = -1 for initialisation of job
                       = +1 for run termination, then run initialisation
                       = +2 for run termination only
                LRUN   = last run number
                SUMRY  = summary array
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   MQUINIT                                                                         
   MQUNEWR                                                                         
   MQUTERM                                                                         
        |---- MINSUM                                                               
                   |----  DATIMH                              External             
                   |----  NAMIND                              External             
                   |----  FLOAT                               External             
                   |----  TIMEX                               External             
                   |----  NINT                                External             
                   |----  MINVSN                                                   
                   |----  ABRUEV                              External             
                   |----  MINCHK                                                   
   
 
3 MINTBP
         SUBROUTINE MINTBP
  ------------------------------------------------------------------------------
    CKEY MDST /INTERNAL
  ------------------------------------------------------------------------------
   Fill vertex bank dtbp for mini-dst.
       Author: Stephen Haywood      04-Apr-90
       Input  : XTRB(or XTEB) bank
       Output : DTBP bank
       Called by MINDST
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   MINBLN                                                                          
   MINBLO                                                                          
        |---- MINTBP                                                               
                   |----  NLINK                               External             
                   |----  AUBOS                               External             
                   |----  MINLIS                                                   
   
 
3 MINTHR
         SUBROUTINE MINTHR (THRU,CTHR)
  ------------------------------------------------------------------------------
    CKEY MDST /INTERNAL
  ------------------------------------------------------------------------------
   Fill thrust bank dthr for mini-dst.
       Author: Agnieszka Jacholkowska 1-Oct-94
       Input  : QJTHRU output
       Output : DTHR bank
       Called by QUEVT - MINALGO
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   MINALGO                                                                         
        |---- MINTHR                                                               
                   |----  AUBOS                               External             
                   |----  NINT                                External             
                   |----  MINLIS                                                   
   
 
3 MINTMC
         SUBROUTINE MINTMC
  ------------------------------------------------------------------------------
    CKEY MDST /INTERNAL
  ------------------------------------------------------------------------------
   Fill track mc bank dtmc for mini-dst.
       Author: Stephen Haywood      21-Nov-90
       Input  : FKIN bank
       Output : DTMC bank
       Called by MINDST
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   MINBLM                                                                          
        |---- MINTMC                                                               
                   |----  NLINK                               External             
                   |----  AUBOS                               External             
                   |----  UCOPY                               External             
                   |----  MINLIS                                                   
   
 
3 MINTRA
         SUBROUTINE MINTRA(ID)
  ------------------------------------------------------------------------------
    CKEY MDST /INTERNAL
  ------------------------------------------------------------------------------
   Fill track bank dtra for mini-dst.
       Author: Stephen Haywood      22-Jan-1990
       Modif : J. Boucrot           09-Jan-2001
       Input  : FRFT,PYFR,YV0V,FRID,dE/dx banks
       Output : DTRA bank
       Called by MINDST
       Input argument : ID = FRFT bank number
       If the card FRF0 is present, the fit FRFT/0 without the VDET is
       used.
       Track quality is obtained from FRID. For old data, a call to
       UFITQL is made - this requires FRFT, FRTL and YV0V.
       Unlike the original version of this routine, FRFT is now used
       rather than PFRF because of changes to error matrix.
       Vdet hit information is obtained by a call to VDHITS and VDAMB.
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   MINBLN                                                                          
   MINBLO                                                                          
        |---- MINTRA                                                               
                   |----  NLINK                               External             
                   |----  ABRUEV                              External             
                   |----  GTSTUP                              External             
                   |----  NDROP                               External             
                   |----  NAMIND                              External             
                   |----  FPTOJ                               External             
                   |----  AUBOS                               External             
                   |----  ALFIEL                              External             
                   |----  SQRT                                External             
                   |----  NINT                                External             
                   |----  SIGN                                External             
                   |----  ABS                                 External             
                   |----  ATAN                                External             
                   |----  ALOG                                External             
                   |----  FLOAT                               External             
                   |----  FPKCM                               External             
                   |----  UFITQL                              External             
                   |----  MINFVB                                                   
                   |----  VDHITS                              External             
                   |----  VDAMB                               External             
                   |----  KBESTM                                                   
                   |----  VTRUH                               External             
                   |----  MINLIS                                                   
   
 
3 MINUPD
         SUBROUTINE MINUPD(BANK)
  ------------------------------------------------------------------------------
    CKEY MDST /USER
  ------------------------------------------------------------------------------
   Update style of mini-dst banks to ensure backward compatibility.
       Author: Stephen Haywood      10-Jan-91
       Modify: Stephen Haywood      17-Feb-93
       Input  : BANK  = bank name to be updated
                      = 'DROP' to drop all updated banks
       This routine is a 'dirty' routine to modify old banks written
       by old versions of MINDST to the new format.
       It decides what to do on the basis of MVER - the version number.
       New banks with number 100 are created.
       These are dropped after the banks have been used by MINFIL.
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   MINEGI                                                                          
   MINEIT                                                                          
   MINFIL                                                                          
   MINFRF                                                                          
   MINFRI                                                                          
   MINFRT                                                                          
   MINPEC                                                                          
   MINPYE                                                                          
   MINPYF                                                                          
   MINXTR                                                                          
   MINYV0                                                                          
        |---- MINUPD                                                               
                   |----  NDROP                               External             
                   |----  ABRUEV                              External             
                   |----  MINGTV                                                   
                   |----  NLINK                               External             
                   |----  MIN100                                                   
                   |----  UCOPY                               External             
                   |----  NAMIND                              External             
                   |----  FLOAT                               External             
                   |----  NINT                                External             
                   |----  MINHIT                                                   
                   |----  AMAX1                               External             
                   |----  CHISIN                              External             
   
 
3 MINVER
         SUBROUTINE MINVER
  ------------------------------------------------------------------------------
    CKEY MDST /INTERNAL
  ------------------------------------------------------------------------------
   Fill vertex bank dver for mini-dst.
       Author: Stephen Haywood      22-Jan-90
       Input  : PYER bank
       Output : DVER bank
       Called by MINDST
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   MINBLN                                                                          
   MINBLO                                                                          
        |---- MINVER                                                               
                   |----  NLINK                               External             
                   |----  AUBOS                               External             
                   |----  PROB                                External             
                   |----  NINT                                External             
                   |----  MINLIS                                                   
   
 
3 MINVMC
         SUBROUTINE MINVMC
  ------------------------------------------------------------------------------
    CKEY MDST /INTERNAL
  ------------------------------------------------------------------------------
   Fill vertex mc bank dvmc for mini-dst.
       Author: Stephen Haywood      21-Nov-90
       Input  : FVER bank
       Output : DVMC bank
       Called by MINDST
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   MINBLM                                                                          
        |---- MINVMC                                                               
                   |----  NLINK                               External             
                   |----  INTCHA                              External             
                   |----  AUBOS                               External             
                   |----  IUCOMP                              External             
                   |----  MINLIS                                                   
                   |----  BKFMT                               External             
   
 
3 MINVRS
         SUBROUTINE MINVRS
  ------------------------------------------------------------------------------
    CKEY MDST /INTERNAL
  ------------------------------------------------------------------------------
   Fill version information bank dvrs for mini-dst.
       Author: Stephen Haywood      01-Mar-93
       Input  : from MINVSN and YV0V bank
       Output : DVRS bank
       Called by MINDST
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   MINBLN                                                                          
   MINBLO                                                                          
        |---- MINVRS                                                               
                   |----  AUBOS                               External             
                   |----  MINVSN                                                   
                   |----  NAMIND                              External             
                   |----  MINLIS                                                   
   
 
3 MINVSN
         INTEGER FUNCTION MINVSN(DUMMY)
  ------------------------------------------------------------------------------
    CKEY MDST /INTERNAL
  ------------------------------------------------------------------------------
   Mini-dst version number (of current library).
       This can be overrode by use of MVSN card which allows a new
       version to be started without changing MINI code.
       Useful if other code has major modifications.
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   MINBLD                                                                          
   MINMUI                                                                          
   MINOUT                                                                          
   MINSUM                                                                          
   MINVRS                                                                          
   QWRUNR                                                                          
   QURHAH                                                                          
        |---- MINVSN                                                               
                   |----  NLINK                               External             
   
 
3 MINXTR
         SUBROUTINE MINXTR
  ------------------------------------------------------------------------------
    CKEY MDST /USER
  ------------------------------------------------------------------------------
   Fill xtrb bank from dtbp.
       Author: Stephen Haywood      18-Apr-91
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   MINFIL                                                                          
        |---- MINXTR                                                               
                   |----  NLINK                               External             
                   |----  MINUPD                                                   
                   |----  AUBOS                               External             
                   |----  BLIST                               External             
                   |----  INTCHA                              External             
   
 
3 MINYNK
         SUBROUTINE MINYNK
  ------------------------------------------------------------------------------
    CKEY MDST /INTERNAL
  ------------------------------------------------------------------------------
   Fill kink bank yknk for alpha.
       Author: Agnieszka Jacholkowska    30-Apr-97
       Input  : DKNK bank
       Output : YKNK bank
       Called by MINFIL
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   MINFIL                                                                          
        |---- MINYNK                                                               
                   |----  NLINK                               External             
                   |----  AUBOS                               External             
                   |----  FLOAT                               External             
                   |----  MINLIS                                                   
   
 
3 MINYV0
         SUBROUTINE MINYV0
  ------------------------------------------------------------------------------
    CKEY MDST /USER
  ------------------------------------------------------------------------------
   Fill yv0v bank from dtra.
       Author: Stephen Haywood      03-Apr-1990
       Modified J. Boucrot          09-Jan-2001 for new 'DYV0' bank
       V0 daughters are identified from DTRA and the YV0V bank is
       reconstructed by calling YMFMIN.
       This requires FRFT be rebuilt from DTRA.
       DVER is required to determine number of main vertices.
       DVRS is required to determine bank number for YV0V.
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   MINFIL                                                                          
        |---- MINYV0                                                               
                   |----  NLINK                               External             
                   |----  NSWAP                               External             
                   |----  MINUPD                                                   
                   |----  NAMIND                              External             
                   |----  JBIT                                External             
                   |----  AUBOS                               External             
                   |----  BLIST                               External             
                   |----  UCOPY                               External             
                   |----  YMFMIN                              External             
                   |----  SNGL                                External             
   
 
3 MQUEVNT
         SUBROUTINE MQUEVNT
  ------------------------------------------------------------------------------
    CKEY EVENT/INTERNAL
  ------------------------------------------------------------------------------
   -DST official production Event Processing
    in ALPHA 8-Jan-1999
    from QMEVNT
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   QMEVNT                                                                          
        |---- MQUEVNT                                                              
                   |----  SIGN                                External             
                   |----  SQRT                                External             
                   |----  ABS                                 External             
                   |----  NINT                                External             
                   |----  KMATIX                              External             
                   |----  ATG                                 External             
                   |----  KCLARM                              External             
                   |----  IAND                                External             
                   |----  KLOCK0                              External             
                   |----  IABS                                External             
                   |----  MINDST                                                   
                   |----  MINALGO                                                  
                   |----  MINHIS                                                   
                   |----  MINOUT                                                   
                   |----  MINMON                                                   
                   |----  AUBLIS                              External             
   
 
3 MQUINIT
          SUBROUTINE MQUINIT
  ------------------------------------------------------------------------------
    CKEY INIT/INTERNAL
  ------------------------------------------------------------------------------
   -DST official production initialisation
    in ALPHA 8-Jan-1999
    from QMINIT
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   QMINIT                                                                          
        |---- MQUINIT                                                              
                   |----  MINMON                                                   
                   |----  MINSUM                                                   
                   |----  NLINK                               External             
                   |----  HTITLE                              External             
   
 
3 MQUNEWR
         SUBROUTINE MQUNEWR
  ------------------------------------------------------------------------------
    CKEY RUN /INTERNAL
  ------------------------------------------------------------------------------
   -DST official production : new run
    in ALPHA 8-Jan-1999
    from QMINIT
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   QMNEWR                                                                          
        |---- MQUNEWR                                                              
                   |----  MINMON                                                   
                   |----  MINSUM                                                   
                   |----  PRRHAH                              External             
   
 
3 MQUSREC
         SUBROUTINE MQUSREC
  ------------------------------------------------------------------------------
    CKEY RUN /INTERNAL
  ------------------------------------------------------------------------------
   -DST official production : Store KSEC and RUNE banks
   A. Jacholkowska 7-Jan-1999
    in ALPHA 11-Jan-1999
    from QMSREC
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   QMSREC                                                                          
        |---- MQUSREC                                                              
                   |----  IW                                  External             
                   |----  NAMIND                              External             
                   |----  MINLIS                                                   
                   |----  MINOUT                                                   
   
 
3 MQUTERM
         SUBROUTINE MQUTERM
  ------------------------------------------------------------------------------
    CKEY TERM/INTERNAL
  ------------------------------------------------------------------------------
   -DST official production : Termination of job
    in ALPHA 8-Jan-1999
    from QMTERM
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   QMTERM                                                                          
        |---- MQUTERM                                                              
                   |----  ABUNIT                              External             
                   |----  BWRITE                              External             
                   |----  MINMON                                                   
                   |----  MINSUM                                                   
                   |----  HPRINT                              External             
                   |----  ACLOSE                              External             
   

2 NANO

  >>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>
    CKEY 
    -----------------------------------------------------------------------
       File     : NCDE.INPUT
       Author   :- Yves A. Maumary       20-FEB-1991  NANO Version 105
       Modified :- Yves A. Maumary       16-OCT-1991  NANO Version 110
       Modified :- Yves A. Maumary       11-AUG-1992  NANO Version 111
       Modified :- Yves A. Maumary        7-JAN-1993  Add MAXMCT;
                                                      changes: MC in NVEC
       Modified :- Yves A. Maumary        5-FEB-1993  Add V0 stuff
                                                      (G.Graefe)
       Modified :- Gerrit Graefe         21-FEB-1994  NANO Version 115
                                                      change V0 stuff
                                                      remove NDEC,NDUC
                                                      add gamma conversions
       Modified :- Gerrit Graefe         10-FEB-1995  NANO Version 116
                                                      Implement EFLOW bank
                                                      change lepton stuff
                                                      remove event shape
                                                        b - tags
                                                      add b-tag from QVSRCH
    
       Description
       ===========
       Contains COMDECKs for the Nano-DST.
       Used in NDSTPnnn ( Nano-DST Production program, run in ALPHA ) and
       in SANDYnnn ( Speedy Analysis on the Nano-Dst ).
    ======================================================================
    .***
    .*** VARIABLES STARTING WITH NX ARE LOGICALS
    .*** VARIABLES STARTING WITH NC ARE CHARACTER VARIABLES
    .***
    
    ?.Start of NPCDSH -----------------------------------------------------
    
    .LNNDSB: List of Names of NDSt Banks
    
    .NCLPOT: List of POT/DST/MINI banks on this nano-dst
    .NCLRUN: List of run banks on this nano-dst
    .NCLNDS: List of Nano-DSt banks on this nano-dst
    ?.Length of LISts, BOS name-indexes and positions in LNNDSB
    
    ?.Number of PARameters per HYpothesis, NumBeR of HYPothesis
    .PARMPH(I,J): PARaMeter I (used in NUPAHY subroutine) for Particle
    .             Hypothesis J
    
    
    .NXPAHY(IHYP): T if PArticle HYpothesis bit set for hyp. IHYP
    .   IHYP = 1 : electron hypothesis
    .          2 : muon hypothesis
    .          3 : pion hypothesis
    .          4 : kaon hypothesis
    .          5 : proton hypothesis
    ?.Card Names for particle Hypothesis bits
    ?.PArticle MASses of the hypothesis
    
    .Counters: NEPROC: Number of Events PROCessed
    .          NEWRIT: Number of Events WRITten to the Nano-DST
    .          NRWRIT: Number of Run records WRITten
    .          NTWRIT: Total records WRITten
    ?.Nano-DST output file unit: NUOUTP
    ?.Lost events output file unit: NULOST
    ?.Write counter for lost events: NEVTLO
    ?.Buffers for lost events : IRUNLO,IEVTLO
    
    ?.Number of Nano-DST Parameters (selection parameters)
    ?.IOFLAG: indicates which ndst banks will be written
    ?.        bit position correspond to position of name in string LNNDSB
    .MINTRK: MINimum number of charged TRacKs
    .PCUTMI: lower momentum CUT for charged tracks
    .PCUTMA: upper momentum CUT for charged tracks
    .THCCUT: Cosine THeta CUT for charged tracks
    .NITCUT: minimum number of ITC coordinates for charged tracks
    .NTPCUT: minimum number of TPC coordinates for charged tracks
    .BD0CUT: upper D0 CUT for charged tracks
    .BZ0CUT: upper Z0 CUT for charged tracks
    .PCUMIJ: lower momentum CUT for charged tracks before clustering
    .PCUMAJ: upper momentum CUT for charged tracks before clustering
    .THCCUJ: Cosine THeta CUT for charged tracks before clustering
    .NITCUJ: minimum number of ITC coordinates for charged tracks before
    .        clustering
    .NTPCUJ: minimum number of TPC coordinates for charged tracks before
    .        clustering
    .BD0CUJ: upper D0 CUT for charged tracks before clustering
    .BZ0CUJ: upper Z0 CUT for charged tracks before clustering
    .BMYCUT: mass cut for jet algorithm QJMMCL
    .ENEVIS: VISible ENErgy for jet algorithm QJMMCL
    .PHOCUT: lower energy CUT for PHOtons
    .ALIVER: Alephlib version
    .ECHMIN: MINimum CHarged Energy to accept the event
    .RECOOP: REConstructed Objects OPtion (available opt.: 'RE','CO','CH')
    .V0CHSI: minimum CHi square increase of SIngle track from V0 fitting back to
    .        the main vertex.
    .V0CHBO: minimum CHi square increase of BOth tracks from V0 fitting back to
    .        the main vertex.
    
    ?.NXWREV: indicates if the event should be written
    .NXBANK(I): T if bank is wanted
                (I is the position of the bank name in string LNNDSB)
    .NXONLY(I): if T => write only if bank is not empty
                (I is the position of the bank name in string LNNDSB)
    ?.NXNDST: T if the NDST bank should be written into the run record
    
    .NCPROD: Version of NDSTPROD
    .NCALPH: ALPHa version and correction file used for production
    .NCDATE: DATE of the production
    
    ?.NXWRLO: Flag for LOst events list output file
    ?.NXLUMO: Flag for XLUMOK rejection
    ?.NXHVBI: Flag for rejection if ITC or TPC voltage not OK
    ?.NXVDBI: Flag for XVDEOK rejection
    ?.NXECBI: Flag for rejection if ECAL voltage not OK
    
    ?.NXHVOK: Flag for ITC and TPC voltage OK
    ?.NXDEOK: Flag for TPC dE/dx voltage and calibration OK
    ?.NXVDOK: Flag for good VDET data
    ?.NXMUOK: Flag for QMUIDO (.FALSE. = failure)
    ?.NXEFOK: Flag for energy flow (Janot's ENFLW) (.FALSE. = failure)
    ?.NXLEPT: Flag for LEPTAG (T = OK)
    ?.NXQVSR: Flag for QVSRCH (F = OK / T = minor error)
    ?.NXQVSS: Flag for QVSRCH (F = OK / T = serious error)
    ?.NXSRCH: Flag for QVSRCH (F failed to run QVSRCH)
    ?.NXGIPT: T = event useful for QIPBTAG)
    ?.NXIPBT: Flag for QIPBTAG (T = OK)
    ?.NXGAMP: Flag for GAMPEX (T = OK)
    ?.NXPGAC: Flag for GAMPEX (T = GAMPECK/ F = GAMPEX)
    
    ?.NXQFVX: Flag for QFNDIP vertex (T=QFNDIP,F=JULIA)
    ?.NXQFFA: Flag for QFNDIP failed (T=failed,F=OK)
    
    .MCOPTI: options used for Monte-Carlo production
    .        bit  0 set if real data
    .        bit  1 = ISEL : gluons selection ( 1 = keep gluons )
    .        bit  2 = ISIN : flag for using the single particle mode
    .                             = 1 read the following flags
    .                             = 0 ignore the following flags
    .                        When you select a single particle, only that
    .                        final particle and the quark will be kept
    .                        in the NDMC bank, for those events of the
    .                        chosen flavor. For the flavors where the
    .                        flag is 0, all tracks are kept.
    .        bit  3 = IPI  : pion
    .        bit  4 = IKA  : kaon
    .        bit  5 = IMU  : muon
    .        bit  6 = IEL  : electron
    .        bit  7 = INI  : neutrino
    .        bit  8 = IGA  : gamma
    .        bit  9 = IPR  : proton
    .        bit 10 = INE  : neutron
    .        bit 11 = IUQ  : u quark
    .        bit 12 = IDQ  : d quark
    .        bit 13 = ISQ  : s quark
    .        bit 14 = ICQ  : c quark
    .        bit 15 = IBQ  : b quark
    .        bit 16 = ITQ  : t quark
    .PMINMC: minimum momentum for MC tracks in the fragmentation
    .        (-1. for real data)
    .LFLAVR: event flavor (7 = no FKIN bank)
    
    .NXYRMI: if T => perform V0 search with XRMIST package
    .NYRNPF: number of parameter for the fit (6,7,8 or 9)
    
    .REFMIN: minimum energy for object to be considered for energy flow
    .RMYCUT: mass cut for ENFLW jets (QJMMCL algorithm)
    .THRUST: Thrust
    
    .NXRQEI: if T => run QEIDO (if JULIA<254)
    ?.MAXimum number of ELectron or MUon Candidates, JETs, photons, TRacKs,
    ?.Monte Carlo Tracks, V0 Candidates
    
    ?.NCORSP: correction file used for production of current nanoDST input
    ?.        file
    
    .IFILL : Fill number
    .BEAMX : X,Y,Z values of beam crossing for this run , in [cm]
    .DBEAMX: Errors on BEAMX , in [cm]
    .NHADBX: Number of HADronic events used to compute BeamX , dbeamx
    ?.End of NPCDSH -------------------------------------------------------
    
    
    ?.Start of NCDESH -----------------------------------------------------
    
    .Mathematical and physical constants
    .QQPI   = pi
    .QQE    = e
    .QQ2PI  = 2 * pi
    .QQPIH  = pi / 2
    .QQRADP = 180 / pi
    .QQC    = speed of light [cm/s]
    .QQH    = Planck constant / ( 2 * pi ) [GeV/s]
    .QQHC   = QQH * QQC
    .QQIRP  = speed of light [cm/KGauss]
    
    .Logical statement functions (defined in NMACRO)
    .XSIG(I)   : T if relative error on momentum available for track I
    .XSIGOV(I) : T if relative error on momentum OVerflow for track I
    .XTEX(I)   : T if dE/dX information available for track I
    .XEID(I)   : T if Electron estimators available for track I
    .XUID(I)   : T if mUon estimators available for track I
    .XPART(I,J): T if particle hypothesis bit J TRUE for track I
    .            J = 1 : electron
    .            J = 2 : muon
    .            J = 3 : pion
    .            J = 4 : kaon
    .            J = 5 : proton
    .XEL(I)    : T if electron hypothesis bit TRUE for track I
    .XMU(I)    : T if muon hypothesis bit TRUE for track I
    .XPI(I)    : T if pion hypothesis bit TRUE for track I
    .XKA(I)    : T if kaon hypothesis bit TRUE for track I
    .XPR(I)    : T if proton hypothesis bit TRUE for track I
    .XFRF(I)   : T if CHI square per d. o. f. is available for track I
    .XC2OV(I)  : T if CHI square per d. o. f. OVerflow for track I
    .XMCNE(I)  : T if this MC "track" is a neutral particle
    .XMCGA(I)  : T if this MC "track" is a gamma
    .XMCCH(I)  : T if this MC "track" is a charged particle
    .XRIMOV(I) : T if measured ionisation OVerflow for track I
    .XRSIOV(I) : T if rel. error on the dE/dx OVerflow for track I
    .XV0SVA(I) : T if ambiguous secondary vertex (V0s only)
    .XV0KIA(I) : T if ambiguous with another hypothesis (V0s only)
    .XV0TRA(I) : T if V0 shares a track with another V0 (V0s only)
    .XK0(I)    : T if V0 fulfills kaon hypothesis (V0s only)
    .XLA(I)    : T if V0 fulfills lambda hypothesis (V0s only)
    .XAL(I)    : T if V0 fulfills antilambda hypothesis (V0s only)
    .XGA(I)    : T if V0 fulfills gamma hypothesis (V0s only)
    
    ?.MAXimum number of input FILes
    
    ?.MAXimum number of "tracks" (rows in NVEC)
    
    .Input/Output UNITS
    .KUCARD : CARD input = 7
    .KUPRNT : log file = 6
    .KUPTER : terminal = 76 or 0 (if batch)
    .KUSEVT : logical unit for the SEVT cards file = 18
    .KUHIST : HISTogram output = 19
    
    ?.POINTers
    ?.KOEVEH : Origin of EVEH bank
    ?.KCEVEH : number of words per row in EVEH
    ?.KOQVEC : Origin of QVEC bank
    ?.KCQVEC : number of words per row in QVEC
    ?.KONVEC : Origin of NVEC bank
    ?.KCNVEC : number of words per row in NVEC
    ?.KONDAR : Origin of NDAR bank
    ?.KCNDAR : number of words per row in NDAR
    ?.KONDBM : Origin of NDBM bank
    ?.KCNDBM : number of words per row in NDBM
    ?.KONDCL : Origin of NDCL bank
    ?.KCNDCL : number of words per row in NDCL
    ?.KONDDE : Origin of NDDE bank
    ?.KCNDDE : number of words per row in NDDE
    ?.KONDEJ : Origin of NDEJ bank
    ?.KCNDEJ : number of words per row in NDEJ
    ?.KONDGC : Origin of NDGC bank
    ?.KCNDGC : number of words per row in NDGC
    ?.KONDHE : Origin of NDHE bank
    ?.KCNDHE : number of words per row in NDHE
    ?.KONBIP : Origin of NBIP bank
    ?.KCNBIP : number of words per row in NBIP
    ?.KONDJT : Origin of NDJT bank
    ?.KCNDJT : number of words per row in NDJT
    ?.KONDLV : Origin of NDLV bank
    ?.KCNDLV : number of words per row in NDLV
    ?.KONDMS : Origin of NDMS bank
    ?.KCNDMS : number of words per row in NDMS
    ?.KONDOB : Origin of NDOB bank
    ?.KCNDOB : number of words per row in NDOB
    ?.KONDPH : Origin of NDPH bank
    ?.KCNDPH : number of words per row in NDPH
    ?.KONDTK : Origin of NDTK bank
    ?.KCNDTK : number of words per row in NDTK
    ?.KONDNT : Origin of NDNT bank
    ?.KCNDNT : number of words per row in NDNT
    ?.KONDV0 : Origin of NDV0 bank
    ?.KCNDV0 : number of words per row in NDV0
    ?.KONDCA : Origin of NDCA bank
    ?.KCNDCA : number of words per row in NDCA
    ?.KOPART : Origin of PART bank
    ?.KCPART : number of words per row in PART
    ?.KONEHE : Origin of NEHE bank
    ?.KCNEHE : number of words per row in NEHE
    
    .KFCHT : First CHarged Track
    .KLCHT : Last CHarged Track
    
    .KFACT : First Charged Track (including 'bad tracks' from V0s and gamma
    convs)
    .KLACT : Last Charged Track (including 'bad tracks' from V0s and gamma convs)
    .KFBCT : First 'Bad' Charged Track (from V0s and gamma convs)
    .KLBCT : Last 'Bad' Charged Track (from V0sand gamma convs)
    
    .The event is split into 2 hemispheres which axis is the thrust axis
    .KFPH1 : First Positive Track in Hemisphere 1
    .KLPH1 : Last Positive Track in Hemisphere 1
    .KFNH1 : First Negative Track in Hemisphere 1
    .KLNH1 : Last Negative Track in Hemisphere 1
    .KFPH2 : First Positive Track in Hemisphere 2
    .KLPH2 : Last Positive Track in Hemisphere 2
    .KFNH2 : First Negative Track in Hemisphere 2
    .KLNH2 : Last Negative Track in Hemisphere 2
    
    .KFJET : First JET
    .KLJET : Last JET
    
    .KFGAM : First GAMma
    .KLGAM : Last GAMma
    
    .KFGH1 : First GAMma in Hemisphere 1
    .KLGH1 : Last GAMma in Hemisphere 1
    .KFGH2 : First GAMma in Hemisphere 2
    .KLGH2 : Last GAMma in Hemisphere 2
    
    .KFMCT : First Monte-Carlo Track
    .KLMCT : Last Monte-Carlo Track
    .KFMUT : First Monte-Carlo Unstable Track
    .KLMUT : Last Monte-Carlo Unstable Track
    .KFMST : First Monte-Carlo Stable Track
    .KLMST : Last Monte-Carlo Stable Track
    
    .KFV0T : First V0 (bank NDV0)
    .KLV0T : Last V0 (bank NDV0)
    
    .KFGCO : First converted gamma (bank NDGC)
    .KLGCO : Last converted gamma (bank NDGC)
    
    .KFEFT : First EFLOW object (bank NDOB)
    .KLEFT : Last EFLOW object (bank NDOB)
    
    .KTHRU : Thrust axis
    
    .KQ    : Initial quark (direct daughter of the Z0)
    .KQBAR : Initial anti-quark (direct daughter of the Z0)
    .KFPAR : First final parton
    .KLPAR : Last final parton
    
    ?.VARIAbles :
    .KRUN  : RUN number
    .KEVT  : EVenT number
    .KNEVT : Number of EVenTs processed
    .KNCHT : Number of CHarged Tracks
    .KNACT : Number of Charged Tracks (including 'bad' tracks from V0s)
    .KNBCT : Number of 'Bad' Charged Tracks (from V0s)
    .KNPH1 : Number of Positive Tracks in Hemisphere 1
    .KNNH1 : Number of Negative Tracks in Hemisphere 1
    .KNPH2 : Number of Positive Tracks in Hemisphere 2
    .KNNH2 : Number of Negative Tracks in Hemisphere 2
    .KNJET : Number of JETs (in bank NDJT)
    .KNGAM : Number of GAMmas (in bank NDPH)
    .KNGH1 : Number of GAMmas in Hemisphere 1
    .KNGH2 : Number of GAMmas in Hemisphere 2
    .KNLEC : Number of LEpton Candidates (in bank NDCL)
    .KNMUT : Number of Monte-Carlo Unstable Tracks (in bank NDNT)
    .KNMST : Number of Monte-Carlo Stable Tracks (in bank NDMS)
    .KNMCT : Number of Monte-Carlo Tracks
    .KNV0T : Number of V0 candidates in NDV0
    .KNGCO : Number of converted gammas in NDGC
    .KNEFT : Number of EFLOW objects in NDOB
    .KNPART: Number of particles in PART
    .QTHRU : Value of thrust
    .QTTHE : Theta of thrust axis
    .QTPHI : Phi of thrust axis
    .KRUNR : RUN number from the run bank RUNH
    ?.KNREIN: number of records read in for the current input file
    ?.KNEFIL: number of events read in for the current input file
    
    .QELEP : LEP center of mass Energy [GeV/c**2]
    .QMFLD : Magnetic FieLD [kG]
    .KREVDS: Detector status word from REHV bank
    .QMCUT : Current mass cut value for the jets
    .QSMCUT: Mass cut value for the jets at beginning of event analysis
    .QSYCUT: Ycut value for the jets at beginning of event analysis
    
    ?.NCHIST: name of histogram output file
    
    ?.NXWRHI: T if histogram output file wanted
    ?.NXMASS: if T the tracks are given mass according to first
    ?.        particle hypothesis bit set
    .XLUMOK: T if event used to compute luminosity
    .XMCEV : T if Monte-Carlo event
    ?.NXNEWF: T for new file (triggers a call to NEWFIL
    ?.NXNEWR: T for a new run, when the run record has not yet been
    ?.        written out
    ?.NXOUTP: T if event output is wanted (a FILO card has been found)
    ?.NXCOPY: T if COPY job
    ?.NXJSPY: T if the job name should be changed (VAX only)
    ?.NXWOUT: T if the event should be written out
    ?.NXNOPH: T if histogram printing not wanted
    ?.NXEVOL: T if the jets have to be evolved before calling NUEVNT
    ?.XNSEQ:  T if NSEQ card present
    
    .KFLAV : event FLAVor
    .NJETB : jet bank to be used (default=0 => NDJT)
    ?.NFFREE: First FREE track in bank NVEC
    ?.NRONVE: Number of ROws in bank NVEC
    
    ?.ICARDS: contains run and event number of selected events for which
    ?.        SEVT cards are to be produced. 1=KRUN 2=KEVT
    ?.NSELEV: number of selected events
    ?.MAXSEV: maximum number of events selected for SEVT cards
    
    ?.NVERSP: version used for production of current nanoDST input file
    ?.NVERSS: version of SANDY running
    ?.NCORSS: SANDY correction file
    
    ?.SAVERS: SANDY version
    
    .QPI0DO (J.-P. Lees):
    .IQPI0           : return code  0-->OK, 1-->0, 2-->N pi0 > MXPI0
    .PIOMOM(4,MXPI0) : PI0 refitted 4 momentum
    .IPI0GAM(2,MXPI0): gam 1 & 2 number in the GAM section
    .CHIPI0(MXPI0)   : chi2 value after refit (-999. if no convergence)
    .ITYPI0(MXPI0)   : pi0 type, see below
    .Description of pi0 types:
    . TY=1: 2 photons in same PECO, with N=2 photons in the PECO
    . TY=2: 2 photons in same PECO, with N>2 photons in the PECO
    . TY=3: 2 photons in different PECO, with N=1 photons in each PECO
    . TY=4: 2 photons in different PECO, with N>1 photons in one PECO
    ?.End of NCDESH -------------------------------------------------------
    
    ?.NORDER:INTERNAL USE
    ?.On Nth row of NDTK, you have the ISTORE(N) row of common NCOMTK,
    ?.or the IALPHA(ISTORE(N)) ALPHA track
    ======================================================================
  <<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<
     GETJUV     Returns the julia version used for reconstruction
     GETNAV     Returns the nano version used for reconstruction
     MDIPBT     Impact parameter btag calculation for the mini (qipbtag, d.brown)
     MDWRIP     Creates the dbtg bank for the mini-dst from the output of qipbtag
     NADDX      De/dx analysis from the nano
     NADDXM     Nano-reading version of r. johnson's qdedxm subroutine
     NAIRFD     Fast pair-finder from the nano : look into bank ndgc
     NANDUM     Dummy routines for nano
     NANFIL     Steering of nano unpacking in alpha
     NGPUT      Nano unpacking : auxiliary to nrepar
     NREBYT     Author   :- gerrit graefe         10-may-1994
     NREEJE     Nano unpacking : create ejet bank from ndej bank
     NREEOB     Nano unpacking : create efol bank from ndob bank (and a pseudo ndtk
     NREFKI     Nano unpacking : create fkin,fver,fzfr banks from ndms,ndnt,ndlv
     NREFRF     Nano unpacking : create frft bank from ndtk bank
     NREFRT     Nano unpacking : create frtl bank from ndtk bank
     NREGOO     Nano unpacking : get nano-specific goodies for alpha
     NRELEP     Nano unpacking : create pdlt+pmlt bank from ndcl bank
     NREPAR     Author   :- gerrit graefe         10-may-1994
     NREPGP     Nano unpacking : create pgpc bank from ndph bank
     NREPTE     Nano unpacking : create ptex bank from ndde bank
     NREPYE     Nano unpacking : create pyer bank from ndhe or nehe bank
     NREYV0     Nano unpacking : create yv0v bank from ndv0 bank
     NVSRCH     Nano unpacking : auxiliary routine to nvsrch. gets primary and
     NVSTVA     Nano unpacking : auxiliary routine to qvstva. gets jet and vertex
     QNINFO     Print nanodst production parameters

3 GETJUV
         SUBROUTINE GETJUV(JUVER)
  ------------------------------------------------------------------------------
    CKEY NANO IN ALPHA /INTERNAL
  ------------------------------------------------------------------------------
   Returns the julia version used for reconstruction
   
      Author   :- Yves A. Maumary       17-JAN-1992
      Modified :- Yves A. Maumary       14-AUG-1992  Bug correction
   
      Inputs:
           - none
   
      Outputs:
           - JUVER /I    : JULIA version
   
      Libraries required: BOS77
   
      Description
      ===========
      Input bank : RHAH  ( Run Header Analysis History )
   
 
3 GETNAV
         SUBROUTINE GETNAV(NAVERS)
  ------------------------------------------------------------------------------
    CKEY NANO IN ALPHA /INTERNAL
  ------------------------------------------------------------------------------
   Returns the nano version used for reconstruction
   
      Author   :- Gerrit Graefe       27-FEB-1995
   
      Inputs:
           - none
   
      Outputs:
           - NVERS /I    : NANO version
   
      Libraries required: BOS77
   
      Description
      ===========
      Input bank : RHAH  ( Run Header Analysis History )
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   NREFRF                                                                          
   NREGOO                                                                          
   NREPGP                                                                          
   NREPYE                                                                          
   NVSRCH                                                                          
   NVSTVA                                                                          
        |---- GETNAV                                                               
                   |----  NAMIND                              External             
                   |----  CHAINT                              External             
   
 
3 MDIPBT
         SUBROUTINE MDIPBT
  ------------------------------------------------------------------------------
    CKEY NANO in ALPHA / INTERNAL
  ------------------------------------------------------------------------------
   Impact parameter btag calculation for the mini (qipbtag, d.brown)
   
      Author   :- Yves A. Maumary (for the NANO )    28-SEP-1992
      Modified :- Dave Brown + Gerrit Graefe
                  02-SEP-1994  fill variables in /NCOMIP/ for MINI/NANO
                  1998-1999 : remove BTAG_PAR, fix Y2K bug   J. Boucrot
                  Nov-99: use VDET setup directly            FLR
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   MINALGO                                                                         
        |---- MDIPBT                                                               
                   |----  IAND                                External             
                   |----  ISHFT                               External             
                   |----  SIGN                                External             
                   |----  SQRT                                External             
                   |----  ABS                                 External             
                   |----  NINT                                External             
                   |----  KMATIX                              External             
                   |----  ATG                                 External             
                   |----  KCLARM                              External             
                   |----  KLOCK0                              External             
                   |----  IABS                                External             
                   |----  ABRUEV                              External             
                   |----  GTSTUP                              External             
                   |----  QWMESS                                                   
                   |----  QIPBTAG                                                  
                   |----  QWMESE                                                   
                   |----  HF1                                 External             
   
 
3 MDWRIP
         SUBROUTINE MDWRIP(IRET)
  ------------------------------------------------------------------------------
    CKEY NANO in ALPHA / INTERNAL
  ------------------------------------------------------------------------------
   Creates the dbtg bank for the mini-dst from the output of qipbtag
   
      Author   :- Dave Brown               5-DEC-1993
      Modified :- Agnieszka Jacholkowska   6-OCT-1994
   
      Inputs:
           - none
   
      Outputs:
           - IRET   / I   Return flag: 1 = success
                                       0 = else
   
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   MINALGO                                                                         
        |---- MDWRIP                                                               
                   |----  SIGN                                External             
                   |----  SQRT                                External             
                   |----  ABS                                 External             
                   |----  NINT                                External             
                   |----  KMATIX                              External             
                   |----  ATG                                 External             
                   |----  KCLARM                              External             
                   |----  IAND                                External             
                   |----  KLOCK0                              External             
                   |----  IABS                                External             
                   |----  AUBOS                               External             
                   |----  QWMESE                                                   
                   |----  BKFMT                               External             
                   |----  MINLIS                                                   
   
 
3 NADDX
         SUBROUTINE NADDX(ITK,N,RMASS,QH,RI,NS,TL,RIEXP,SIGMA,IER)
  ------------------------------------------------------------------------------
    CKEY ALPHA DEDX FROM NANO /INTERNAL
  ------------------------------------------------------------------------------
   De/dx analysis from the nano
   
      Author   :- Yves A. Maumary       23-OCT-1992
      Modified version of R. Johnson's QDEDX routine
      Modified :- Gerrit Graefe         25-APR-1994 get dE/dx for ALPHA
                                                    if input comes from a
                                                    NanoDst
   
       Input:   ITK      /I       SANDY track number
                N        /I       Number of hypothesis to try
                RMASS(n) /R       Mass hypotheses
                QH(n)    /R       Charge hypotheses (sign doesn't matter)
       Output:  RI       /R       Measured ionization (1.O=minion, Q=1)
                NS       /I       Number of useful wire samples on track
                TL       /R       Useful length of the track (cm)
                RIEXP(n) /R       Expected ionization for the given
                                  mass hypothesis (1.0=minion, Q=1)
                SIGMA(n) /R       Sigma of dE/dx measurement error,
                                  including the momentum error.
                                  Note that one can calculate a
                                  chi-squared with 1 d.o.f. as:
                                  chi2 = ((RI-RIEXP)/SIGMA)**2
                IER      /I       Error return= 0 for success
                                  1= can't find track bank or not
                                     a reconstructed charged track
                                  2= can't find dE/dx bank
                                  3= track has no dE/dx information
                                  4= can't find calibration banks
                                     TC1X, TC2X, and/or TC3X
                                  5= cannot find RUNH or EVEH bank
                                     from which to get the run number
   
      Libraries required: ALEPHLIB
   
      Description
      ===========
      Get the TC3X calibration bank for the current run, apply it on the
      measured ionisation from QRIMES (TC3X is NOT applied at the nanoDST
      production step), and finally call TXDEDX for the expected
      ionisation and error for the various mass hypotheses.
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   NADDXM                                                                          
   NMTAIL                                                                          
   QDEDX                                                                           
        |---- NADDX                                                                
                   |----  SIGN                                External             
                   |----  SQRT                                External             
                   |----  ABS                                 External             
                   |----  NINT                                External             
                   |----  KMATIX                              External             
                   |----  ATG                                 External             
                   |----  KCLARM                              External             
                   |----  IAND                                External             
                   |----  KLOCK0                              External             
                   |----  IABS                                External             
                   |----  VZERO                               External             
                   |----  NAMIND                              External             
                   |----  ABRUEV                              External             
                   |----  GTSTUP                              External             
                   |----  ALGTDB                              External             
                   |----  JUNIDB                              External             
                   |----  ISHFT                               External             
                   |----  FLOAT                               External             
                   |----  QWMESE                                                   
                   |----  ALOG                                External             
                   |----  TXDEDX                              External             
   
 
3 NADDXM
         SUBROUTINE NADDXM(ITK,N,RMASS,QH,RI,NS,TL,RIEXP,SIGMA,IER)
  ------------------------------------------------------------------------------
    CKEY ALPHA DEDX FROM NANO /INTERNAL
  ------------------------------------------------------------------------------
   Nano-reading version of r. johnson's qdedxm subroutine
    On production, RI, RSIG, TL and NS from TPCSIM are stored.
   
      Author   :- R. Johnson   10-5-90
      Modified :- Yves A. Maumary       27-OCT-1992 For SANDY 111
      Modified :- Gerrit Graefe         26-APR-1994 For ALPHA with
                                                    NanoDst input
      Modified :- Gerrit Graefe         10-MAY-1994 Added Dave Caspers bug
                                                    fixes for early 92 MC
   
    Analyse dE/dx for Monte Carlo events by faking the ionization
    with a gaussian random number.  If called for real data, the
    result will be the same as if QDEDX were called.
   
   
       Input:   ITK      /I       ALPHA track number
                N        /I       Number of hypothesis to try
                RMASS(n) /R       Mass hypotheses
                QH(n)    /R       Charge hypotheses (sign doesn't matter)
       Output:  RI       /R       Measured ionization (1.O=minion, Q=1)
                NS       /I       Number of useful wire samples on track
                TL       /R       Useful length of the track (cm)
                RIEXP(n) /R       Expected ionization for the given
                                  mass hypothesis (1.0=minion, Q=1)
                SIGMA(n) /R       Sigma of dE/dx measurement error,
                                  including the momentum error.
                                  Note that one can calculate a
                                  chi-squared with 1 d.o.f. as:
                                  chi2 = ((RI-RIEXP)/SIGMA)**2
                IER      /I       Error return= 0 for success
                                  1= can't find track bank or not
                                     a reconstructed charged track
                                  3= track has no dE/dx information
                                  4= can't find calibration banks
                                     TC1X, TC2X, and/or TC3X, TC4X
                                  6= No MC truth
      Input to the entry point NMTAIL.  This entry may be called to
      -----                    ------   set the parameter TAIL, which
                                        otherwise defaults to 999. It
                                        only need be called once.
                TAIL     /R        If the dE/dx from TPCSIM is more than
                                   TAIL sigmas from the "true" mean dE/dx
                                   then the TPCSIM dE/dx will be kept.
                                   This is to allow one to retain some
                                   of the simulation of tails, which
                                   usually arise from track overlap.
                                   If TAIL is set less than 3.0, then
                                   the value 3.0 is used. Set to a large
                                   value if you don't want this feature.
   
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   QDEDXM                                                                          
   QMTAIL                                                                          
        |---- NADDXM                                                               
                   |----  SIGN                                External             
                   |----  SQRT                                External             
                   |----  ABS                                 External             
                   |----  NINT                                External             
                   |----  KMATIX                              External             
                   |----  ATG                                 External             
                   |----  KCLARM                              External             
                   |----  IAND                                External             
                   |----  KLOCK0                              External             
                   |----  IABS                                External             
                   |----  NADDX                                                    
                   |----  CHAINT                              External             
                   |----  QWMESE                                                   
                   |----  KBESTM                                                   
                   |----  QPMASS                                                   
                   |----  FLOAT                               External             
                   |----  INT                                 External             
                   |----  RDMIN                               External             
                   |----  RANNOR                              External             
                   |----  QDEDXK                                                   
                   |----  QKBLOK                                                   
   
 
3 NAIRFD
         SUBROUTINE NAIRFD(I1,I2,DXY,DZ0,DZ2,DTH,RMA,ZMA,XMA,NC1,
  ------------------------------------------------------------------------------
    CKEY NANO IN ALPHA /INTERNAL
  ------------------------------------------------------------------------------
        &                  DIN1,NC2,DIN2,P,IER)
   Fast pair-finder from the nano : look into bank ndgc
   
      Author   :- Gerrit Graefe         25-APR-1994
      Modified :- Gerrit Graefe         23-JUN-1994 removed old/new track
                                                    number assignment
   
    Inputs: I1 = Alpha track number (in CHT section)
            I2 = Another ALPHA track (in CHT section)
    Output: DXY = the distance(cm) in the xy plane at the closest approach
            DZ2 = the distance(cm) between the tracks in z at the xy point
            DZ0 = the distance(cm) between the tracks in z at the origin
            DTH = 0.0
            RMA = the rho value at the materializtion point
            ZMA = the z value at the materialization point
            XMA = the invariant mass of the tracks at the materializtion
                  point assuming they are both electrons
            NC1(2) = 0
            DIN1(2) = 0
            P(3) = Summed momentum of the two tracks at the materialization
                   point
            IER = 0 if all OK
                  1 if error in calculation
   
      Libraries required: ALPHA,BOS77
   
      Description
      ===========
   
      This subroutine looks in the NDGC bank if the both tracks given form a
      converted gamma. The routine is called inside ALPHA instead of PAIRFD
      if input comes from a NanoDst.
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   QPAIRF                                                                          
        |---- NAIRFD                                                               
                   |----  SIGN                                External             
                   |----  SQRT                                External             
                   |----  ABS                                 External             
                   |----  NINT                                External             
                   |----  KMATIX                              External             
                   |----  ATG                                 External             
                   |----  KCLARM                              External             
                   |----  IAND                                External             
                   |----  KLOCK0                              External             
                   |----  IABS                                External             
                   |----  NAMIND                              External             
                   |----  ISHFT                               External             
                   |----  FLOAT                               External             
   
 
3 NANDUM
         SUBROUTINE QNINIT
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Dummy routines for nano
   
   
 
3 NANFIL
         SUBROUTINE NANFIL
  ------------------------------------------------------------------------------
    CKEY NANO IN ALPHA /USER
  ------------------------------------------------------------------------------
   Steering of nano unpacking in alpha
    Called from QFILL
      Author   :- Gerrit Graefe         15-FEB-1994
   
      Inputs:
           - none
   
      Outputs:
           - IRET / I      DISABLED
                             return code  0=created all requested banks
                                          1=input is NOT a NANO-DST
                                          2=input is a NANO version < 112
                                          3=no space to book BOS banks
                                          4=found NONE
                                          5=unknown error
   
      Libraries required: BOS77
   
      Description
      ===========
   
      Steering routine for the recreation of DST banks from NANO-DST banks.
      Banks are not recreated if one of the corresponding NOxx cards from
      ALPHA is found.
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   QFILL                                                                           
        |---- NANFIL                                                               
                   |----  ALTELL                              External             
                   |----  NAMIND                              External             
                   |----  NREBYT                                                   
                   |----  QWMESE                                                   
                   |----  NBYTSW                                                   
                   |----  CHAINT                              External             
                   |----  BDROP                               External             
                   |----  NREPAR                                                   
                   |----  NREEOB                                                   
                   |----  NREFRF                                                   
                   |----  NREFRT                                                   
                   |----  NREPTE                                                   
                   |----  NREEJE                                                   
                   |----  NREPYE                                                   
                   |----  NREFKI                                                   
                   |----  NRELEP                                                   
                   |----  NREPGP                                                   
                   |----  NREGOO                                                   
                   |----  NREYV0                                                   
   
 
3 NGPUT
         SUBROUTINE NGPUT(RM,IE,RO)
  ------------------------------------------------------------------------------
    CKEY NANO IN ALPHA /INTERNAL
  ------------------------------------------------------------------------------
   Nano unpacking : auxiliary to nrepar
   
      Author   :- Gerrit Graefe         15-FEB-1994
   
      Inputs:
           - RM   / F    mantisse of a floating point number
                         has to be in the range -1.0.lt.RM.lt.1.0
             IE   / I    exponent of a floating point number
                         has to be in the range -37.le.IE.le.37
   
      Outputs:
           - RO   / F    RO=RM*(10.0**IE)
   
      Libraries required: NONE
   
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   NREPAR                                                                          
        |---- NGPUT                                                                
                   |----  ABS                                 External             
   
 
3 NREBYT
         SUBROUTINE NREBYT(IOSTR,ICSTR,IRET)
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Author   :- gerrit graefe         10-may-1994
   
      Inputs:
           - IOSTR   / I        original string from input file
             ICSTR   / I        correct string (as it should be)
   
      Outputs:
           - IRET / I        return code  0=found a conversion
                                          1=found no conversion
                                          2=found no swapping
                                          3=unknown error
   
      Libraries required: ALPHA,BOS77
   
      Description
      ===========
   
      This subroutine changes character strings from ASCII to EBCDIC or
      vice versa and repairs byte swapping. A call to the subroutine will
      find out, which way to handle character strings, a call to the entry
      NBYTSW will do the conversion according to the settings from NREBYT.
      WARNING:
        NREBYT has to be called before NBYTSW. Otherwise the results are
        unpredictable !
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   NANFIL                                                                          
        |---- NREBYT                                                               
                   |----  IAND                                External             
                   |----  ISHFT                               External             
                   |----  IOR                                 External             
   
 
3 NREEJE
         SUBROUTINE NREEJE(IRET)
  ------------------------------------------------------------------------------
    CKEY NANO IN ALPHA /INTERNAL
  ------------------------------------------------------------------------------
   Nano unpacking : create ejet bank from ndej bank
   
      Author   :- Gerrit Graefe         15-FEB-1994
   
      Inputs:
           - none
   
      Outputs:
           - IRET / I        return code  0=created EJET from NDEJ
                                          1=can't find NDEJ
                                          2=no space to book EJET
                                          3=unknown error
   
      Libraries required: ALPHA,BOS77
   
      Description
      ===========
   
      This subroutine creates the bank EJET from the NDEJ bank.
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   NANFIL                                                                          
        |---- NREEJE                                                               
                   |----  SIGN                                External             
                   |----  SQRT                                External             
                   |----  ABS                                 External             
                   |----  NINT                                External             
                   |----  KMATIX                              External             
                   |----  ATG                                 External             
                   |----  KCLARM                              External             
                   |----  IAND                                External             
                   |----  KLOCK0                              External             
                   |----  IABS                                External             
                   |----  NAMIND                              External             
                   |----  AUBOS                               External             
                   |----  QWMESE                                                   
                   |----  BKFMT                               External             
                   |----  FLOAT                               External             
                   |----  BLIST                               External             
   
 
3 NREEOB
         SUBROUTINE NREEOB(IRET)
  ------------------------------------------------------------------------------
    CKEY NANO IN ALPHA /INTERNAL
  ------------------------------------------------------------------------------
   Nano unpacking : create efol bank from ndob bank (and a pseudo ndtk
                     in case of MC events to have matching info)
   
      Author   :- Gerrit Graefe         11-FEB-1995
   
      Inputs:
           - none
   
      Outputs:
           - IRET / I        return code  0=created EFOL from NDOB
                                          1=can't find NDOB
                                          2=no space to book EFOL
                                          3=unknown error
   
      Libraries required: ALPHA,BOS77
   
      Description
      ===========
   
      This subroutine creates the EFOL bank from the NDOB bank. If the
      event is a MC event and no NDTK bank is given it will be created
      with momenta taken from NDOB and set to a non-zero value to avoid
      problems with divisions. The main purpose is to have easy access
      to the matching information between MC - reco and MC - truth tracks.
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   NANFIL                                                                          
        |---- NREEOB                                                               
                   |----  NAMIND                              External             
                   |----  AUBOS                               External             
                   |----  QWMESE                                                   
                   |----  BKFMT                               External             
                   |----  FLOAT                               External             
                   |----  IAND                                External             
                   |----  ISHFT                               External             
                   |----  BLIST                               External             
   
 
3 NREFKI
         SUBROUTINE NREFKI(IRET)
  ------------------------------------------------------------------------------
    CKEY NANO IN ALPHA /INTERNAL
  ------------------------------------------------------------------------------
   Nano unpacking : create fkin,fver,fzfr banks from ndms,ndnt,ndlv
   
      Author   :- Gerrit Graefe         16-FEB-1994
   
      Inputs:
           - none
   
      Outputs:
           - IRET / I        return code  0=created FKIN + FVER + FZFR +
                                            ITMA + IASL from NDMS + NDNT
                                          1=can't find NDMS or NDNT
                                          2=no space to book FKIN or FVER
                                            or FZFR or IASL or ITMA
                                          3=unknown error
   
      Libraries required: ALPHA,BOS77
   
      Description
      ===========
   
      This subroutine creates the banks FKIN, FZFR and FVER from the banks NDMS
      and NDNT. A problem is that not enough information is stored on the NANO-
      DST to get back the same order of particles as in the original FKIN, FZFR
      and FVER bank. Therefore a warning is printed at the first event.
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   NANFIL                                                                          
        |---- NREFKI                                                               
                   |----  SIGN                                External             
                   |----  SQRT                                External             
                   |----  ABS                                 External             
                   |----  NINT                                External             
                   |----  KMATIX                              External             
                   |----  ATG                                 External             
                   |----  KCLARM                              External             
                   |----  IAND                                External             
                   |----  KLOCK0                              External             
                   |----  IABS                                External             
                   |----  NAMIND                              External             
                   |----  AUBOS                               External             
                   |----  QWMESE                                                   
                   |----  BKFMT                               External             
                   |----  VZERO                               External             
                   |----  ISHFT                               External             
                   |----  FLOAT                               External             
                   |----  BTEST                                                    
                   |----  INT                                 External             
                   |----  INTCHA                              External             
                   |----  BLIST                               External             
   
 
3 NREFRF
         SUBROUTINE NREFRF(IRET)
  ------------------------------------------------------------------------------
    CKEY NANO IN ALPHA /INTERNAL
  ------------------------------------------------------------------------------
   Nano unpacking : create frft bank from ndtk bank
   
      Author   :- Gerrit Graefe         15-FEB-1994
      Modified :- Gerrit Graefe         27-FEB-1994 link to bank NEHE,
                                                    if Nano version >115
   
      Inputs:
           - none
   
      Outputs:
           - IRET / I        return code  0=created FRFT from NDTK
                                          1=can't find NDTK
                                          2=no space to book FRFT
                                          3=unknown error
   
      Libraries required: ALPHA,BOS77
   
      Description
      ===========
   
      This subroutine creates the bank FRFT from the NDTK bank. This is a
      dangerous thing because not all tracks are kept on the NANO DST and the
      remaining are reordered. So the pointers from other banks like YV0V have
      to reset and there is no easy way to get the original 'JULIA' number. The
      only way is to link to the NDTK bank and ask for the JULIA track number in
      this bank. There is a one-to-one relation between the row numbers in NDTK
      and FRFT made from NDTK.
      Also there is a problem with the track quality. Normally only good tracks
      are kept on the NANO DST but although those which are coming from a V0 or
      a gamma conversion candidate even if they are not 'good' ones. This was
      done for quality studies (dE/dx, # of hits in TPC/ITC etc.). Unfortunately
      there is no proper way to put some quality flag into FRFT. So this
      information is put into the error matrix which is zero by default. A huge
      value of QFRFEM(ITK,1,1) [99999.0] indicates that this is a 'bad' track
      according to the NANO DST definitions.
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   NANFIL                                                                          
        |---- NREFRF                                                               
                   |----  SIGN                                External             
                   |----  SQRT                                External             
                   |----  ABS                                 External             
                   |----  NINT                                External             
                   |----  KMATIX                              External             
                   |----  ATG                                 External             
                   |----  KCLARM                              External             
                   |----  IAND                                External             
                   |----  KLOCK0                              External             
                   |----  IABS                                External             
                   |----  NAMIND                              External             
                   |----  GETNAV                                                   
                   |----  AUBOS                               External             
                   |----  QWMESE                                                   
                   |----  BKFMT                               External             
                   |----  ALFIEL                              External             
                   |----  VZERO                               External             
                   |----  FLOAT                               External             
                   |----  ACOS                                External             
                   |----  SIN                                 External             
                   |----  TAN                                 External             
                   |----  ISHFT                               External             
                   |----  ATAN2                               External             
                   |----  BTEST                                                    
                   |----  BLIST                               External             
   
 
3 NREFRT
         SUBROUTINE NREFRT(IRET)
  ------------------------------------------------------------------------------
    CKEY NANO IN ALPHA /INTERNAL
  ------------------------------------------------------------------------------
   Nano unpacking : create frtl bank from ndtk bank
   
      Author   :- Gerrit Graefe         15-FEB-1994
   
      Inputs:
           - none
   
      Outputs:
           - IRET / I        return code  0=created FRTL from NDTK
                                          1=can't find NDTK
                                          2=no space to book FRTL
                                          3=unknown error
   
      Libraries required: ALPHA,BOS77
   
      Description
      ===========
   
      This subroutine creates the bank FRTL from the NDTK bank.
      Comments:
                 See NREFRF subroutine descriptions !!
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   NANFIL                                                                          
        |---- NREFRT                                                               
                   |----  SIGN                                External             
                   |----  SQRT                                External             
                   |----  ABS                                 External             
                   |----  NINT                                External             
                   |----  KMATIX                              External             
                   |----  ATG                                 External             
                   |----  KCLARM                              External             
                   |----  IAND                                External             
                   |----  KLOCK0                              External             
                   |----  IABS                                External             
                   |----  NAMIND                              External             
                   |----  AUBOS                               External             
                   |----  QWMESE                                                   
                   |----  BKFMT                               External             
                   |----  ISHFT                               External             
                   |----  BLIST                               External             
   
 
3 NREGOO
         SUBROUTINE NREGOO(IRET)
  ------------------------------------------------------------------------------
    CKEY NANO IN ALPHA /INTERNAL
  ------------------------------------------------------------------------------
   Nano unpacking : get nano-specific goodies for alpha
     -
   
      Author   :- Gerrit Graefe         23-MAR-1994
      Modified :- Gerrit Graefe         27-FEB-1995  Link to NDHE if
                                                     NAVERS>115
   
      Inputs:
           - none
   
      Outputs:
           - IRET / I        return code  0=filled QNCDE
                                          1=can't find NDHE
                                          2=can't find NDST
                                          3=unknown error
   
      Libraries required: ALPHA,BOS77
   
      Description
      ===========
   
      This subroutine gets all the goodies from the NanoDst and makes them
      accessible inside ALPHA. To use the names from SANDY for those  who used
      it before and to avoid problems with ALPHA conventions all variables are
      in a commonblock QNCDE.
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   NANFIL                                                                          
        |---- NREGOO                                                               
                   |----  SIGN                                External             
                   |----  SQRT                                External             
                   |----  ABS                                 External             
                   |----  NINT                                External             
                   |----  KMATIX                              External             
                   |----  ATG                                 External             
                   |----  KCLARM                              External             
                   |----  IAND                                External             
                   |----  KLOCK0                              External             
                   |----  IABS                                External             
                   |----  GETNAV                                                   
                   |----  NAMIND                              External             
                   |----  FLOAT                               External             
                   |----  BTEST                                                    
                   |----  CHAINT                              External             
   
 
3 NRELEP
         SUBROUTINE NRELEP(IRET)
  ------------------------------------------------------------------------------
    CKEY NANO IN ALPHA /INTERNAL
  ------------------------------------------------------------------------------
   Nano unpacking : create pdlt+pmlt bank from ndcl bank
   
      Author   :- Gerrit Graefe         10-FEB-1995
   
      Inputs:
           - none
   
      Outputs:
           - IRET / I        return code  0=created PDLT from NDCL
                                          1=can't find NDCL
                                          2=no space to book PDLT
                                          3=unknown error
   
      Libraries required: ALPHA,BOS77
   
      Description
      ===========
   
      This subroutine creates the banks PDLT (and PMLT in case of Monte Carlo
      from the NDCL bank.
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   NANFIL                                                                          
        |---- NRELEP                                                               
                   |----  SIGN                                External             
                   |----  SQRT                                External             
                   |----  ABS                                 External             
                   |----  NINT                                External             
                   |----  KMATIX                              External             
                   |----  ATG                                 External             
                   |----  KCLARM                              External             
                   |----  IAND                                External             
                   |----  KLOCK0                              External             
                   |----  IABS                                External             
                   |----  NAMIND                              External             
                   |----  QWMESE                                                   
                   |----  AUBOS                               External             
                   |----  BKFMT                               External             
                   |----  ISHFT                               External             
                   |----  FLOAT                               External             
                   |----  BLIST                               External             
   
 
3 NREPAR
         SUBROUTINE NREPAR(IRET)
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Author   :- gerrit graefe         10-may-1994
   
      Inputs:
           - none
   
      Outputs:
           - IRET / I        return code  0=created PART from NDAR
                                          1=can't find NDAR
                                          2=no space to book PART
                                          3=unknown error
   
      Libraries required: ALPHA,BOS77
   
      Description
      ===========
   
      This subroutine creates the bank PART from the NDAR bank.
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   NANFIL                                                                          
        |---- NREPAR                                                               
                   |----  SIGN                                External             
                   |----  SQRT                                External             
                   |----  ABS                                 External             
                   |----  NINT                                External             
                   |----  KMATIX                              External             
                   |----  ATG                                 External             
                   |----  KCLARM                              External             
                   |----  IAND                                External             
                   |----  KLOCK0                              External             
                   |----  IABS                                External             
                   |----  BLIST                               External             
                   |----  NDROP                               External             
                   |----  NAMIND                              External             
                   |----  AUBOS                               External             
                   |----  QWMESE                                                   
                   |----  BKFMT                               External             
                   |----  CHAR                                External             
                   |----  ISHFT                               External             
                   |----  FLOAT                               External             
                   |----  NGPUT                                                    
   
 
3 NREPGP
         SUBROUTINE NREPGP(IRET)
  ------------------------------------------------------------------------------
    CKEY NANO IN ALPHA /INTERNAL
  ------------------------------------------------------------------------------
   Nano unpacking : create pgpc bank from ndph bank
   
      Author   :- Gerrit Graefe         15-FEB-1994
      Modified :- Gerrit Graefe         27-FEB-1995  If photons were
                                                     taken from PGAC,
                                                     create PGAC
   
      Inputs:
           - none
   
      Outputs:
           - IRET / I        return code  0=created PGPC from NDPH
                                          1=can't find NDPH
                                          2=no space to book PGPC
                                          3=unknown error
   
      Libraries required: ALPHA,BOS77
   
      Description
      ===========
   
      This subroutine creates the bank PGPC from the NDPH bank. Only few
      numbers from PGPC are stored on NDPH so the recreated PGPC contains
      not much more than the momenta.
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   NANFIL                                                                          
        |---- NREPGP                                                               
                   |----  SIGN                                External             
                   |----  SQRT                                External             
                   |----  ABS                                 External             
                   |----  NINT                                External             
                   |----  KMATIX                              External             
                   |----  ATG                                 External             
                   |----  KCLARM                              External             
                   |----  IAND                                External             
                   |----  KLOCK0                              External             
                   |----  IABS                                External             
                   |----  NAMIND                              External             
                   |----  GETNAV                                                   
                   |----  QWMESE                                                   
                   |----  ISHFT                               External             
                   |----  AUBOS                               External             
                   |----  BKFMT                               External             
                   |----  BLIST                               External             
                   |----  FLOAT                               External             
                   |----  ACOS                                External             
                   |----  ATAN2                               External             
   
 
3 NREPTE
         SUBROUTINE NREPTE(IRET)
  ------------------------------------------------------------------------------
    CKEY NANO IN ALPHA /INTERNAL
  ------------------------------------------------------------------------------
   Nano unpacking : create ptex bank from ndde bank
   
      Author   :- Gerrit Graefe         15-FEB-1994
   
      Inputs:
           - none
   
      Outputs:
           - IRET / I        return code  0=created PTEX from NDDE
                                          1=can't find NDDE
                                          2=no space to book PTEX
                                          3=unknown error
   
      Libraries required: ALPHA,BOS77
   
      Description
      ===========
   
      This subroutine creates the bank PTEX from the NDDE bank.
      Comments:
                 See NREFRF subroutine descriptions !!
      Remind that there are some differences between the original PTEX
      bank and that one created here. Every track has just one entry, as
      no sector information is avaliable any more. Therefore the bank
      should never be accesed directly. Use QDEDX or QDEDXM instead
      to get a correct result.
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   NANFIL                                                                          
        |---- NREPTE                                                               
                   |----  SIGN                                External             
                   |----  SQRT                                External             
                   |----  ABS                                 External             
                   |----  NINT                                External             
                   |----  KMATIX                              External             
                   |----  ATG                                 External             
                   |----  KCLARM                              External             
                   |----  IAND                                External             
                   |----  KLOCK0                              External             
                   |----  IABS                                External             
                   |----  NAMIND                              External             
                   |----  AUBOS                               External             
                   |----  QWMESE                                                   
                   |----  BKFMT                               External             
                   |----  ISHFT                               External             
                   |----  BLIST                               External             
   
 
3 NREPYE
         SUBROUTINE NREPYE(IRET)
  ------------------------------------------------------------------------------
    CKEY NANO IN ALPHA /INTERNAL
  ------------------------------------------------------------------------------
   Nano unpacking : create pyer bank from ndhe or nehe bank
   
      Author   :- Gerrit Graefe         15-FEB-1994
      Modified :- Gerrit Graefe         27-FEB-1995  Link to NDHE if
                                                     NAVERS>115
   
      Inputs:
           - none
   
      Outputs:
           - IRET / I        return code  0=created PYER from NDHE
                                          1=can't find NDHE
                                          2=no space to book PYER
                                          3=unknown error
   
      Libraries required: ALPHA,BOS77
   
      Description
      ===========
   
      This subroutine creates the bank PYER from the NDHE bank. The only
      entry in this bank will be the main vertex stored in the NDHE bank.
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   NANFIL                                                                          
        |---- NREPYE                                                               
                   |----  SIGN                                External             
                   |----  SQRT                                External             
                   |----  ABS                                 External             
                   |----  NINT                                External             
                   |----  KMATIX                              External             
                   |----  ATG                                 External             
                   |----  KCLARM                              External             
                   |----  IAND                                External             
                   |----  KLOCK0                              External             
                   |----  IABS                                External             
                   |----  GETNAV                                                   
                   |----  NAMIND                              External             
                   |----  AUBOS                               External             
                   |----  QWMESE                                                   
                   |----  BKFMT                               External             
                   |----  FLOAT                               External             
                   |----  BLIST                               External             
   
 
3 NREYV0
         SUBROUTINE NREYV0(IRET)
  ------------------------------------------------------------------------------
    CKEY NANO IN ALPHA /INTERNAL
  ------------------------------------------------------------------------------
   Nano unpacking : create yv0v bank from ndv0 bank
   
      Author   :- Gerrit Graefe         15-FEB-1994
   
      Inputs:
           - none
   
      Outputs:
           - IRET / I        return code  0=created YV0V from NDV0
                                          1=can't find NDV0
                                          2=no space to book YV0V
                                          3=unknown error
   
      Libraries required: ALPHA,BOS77
   
      Description
      ===========
   
      This subroutine creates the bank YV0V from the NDV0 bank. As some
      quality cuts are made before filling the NDV0 bank while the NANO
      production some V0s avaliable on the DST or MINI are missing.
      Although no error matrices are available.
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   NANFIL                                                                          
        |---- NREYV0                                                               
                   |----  SIGN                                External             
                   |----  SQRT                                External             
                   |----  ABS                                 External             
                   |----  NINT                                External             
                   |----  KMATIX                              External             
                   |----  ATG                                 External             
                   |----  KCLARM                              External             
                   |----  IAND                                External             
                   |----  KLOCK0                              External             
                   |----  IABS                                External             
                   |----  NAMIND                              External             
                   |----  AUBOS                               External             
                   |----  QWMESE                                                   
                   |----  BKFMT                               External             
                   |----  ISHFT                               External             
                   |----  FLOAT                               External             
                   |----  SIN                                 External             
                   |----  COS                                 External             
                   |----  BLIST                               External             
   
 
3 NVSRCH
         SUBROUTINE NVSRCH(BPOS,BSIZ,PVTX,EPVTX,DJET,BTAG,SVTX,ESVTX,AVTX,
  ------------------------------------------------------------------------------
    CKEY NANO IN ALPHA /INTERNAL
  ------------------------------------------------------------------------------
        &  CAVTX,JERR)
   Nano unpacking : auxiliary routine to nvsrch. gets primary and
                     secondary vertex coordinates from bank NEHE
   
      Author   :- Gerrit Graefe         25-MAR-1995
   
      Inputs:
           - none            all input arguments ar dummy
   
   
      Outputs:
           - PVTX(3)         primary vertex in ALEPH coordinates
           - BTAG(2)         b-tagging variable (see description in QVSRCH)
           - AVTX(3,2)       secondary vertices in ALEPH coordinates
           - CAVTX(1,1,x)    the first components (CAVTX(1,1,1)andCAVTX(1,1,2))
                             contain the error on the decay length. NOTE
                             that this is different to input from MINI or
                             DST.
           - JERR            Error occured while running QVSRCH
                             JERR =  0  error code from QVSRCH .EQ.  0
                             JERR =  1  error code from QVSRCH .lt. 12
                             JERR = 12  error code from QVSRCH .ge. 12
   
      Libraries required: BOS77
   
      Description
      ===========
   
      This subroutine takes the precalculated information from the NEHE
      bank and returns it to the user. The calculation is done during the
      NanoDST production step, for that all input arguments are dummy.
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   QVSRCH                                                                          
        |---- NVSRCH                                                               
                   |----  GETNAV                                                   
                   |----  QWMESE                                                   
                   |----  NAMIND                              External             
                   |----  VZERO                               External             
                   |----  BTEST                                                    
                   |----  FLOAT                               External             
   
 
3 NVSTVA
         SUBROUTINE NVSTVA(ITK,JET,IVX)
  ------------------------------------------------------------------------------
    CKEY NANO IN ALPHA /INTERNAL
  ------------------------------------------------------------------------------
   Nano unpacking : auxiliary routine to qvstva. gets jet and vertex
                     assignment if input is a NanoDST
   
      Author   :- Gerrit Graefe         25-MAR-1995
   
      Inputs:
           - ITK  / I        ALPHA TRACK NUMBER
   
   
      Outputs:
           - JET  / I        JET=1 OR 2 ACCORDING TO JET DIRECTION
             IVX  / I        Vertex assignment from QVSRCH
                             1 FOR PRIMARY,
                             2 FOR SECONDARY (IN ABOVE JET)
                             0 FOR TRACK PASSING CUTS BUT NOT CLOSE
                                   TO EITHER VERTEX
                            -1 FOR TRACK FAILING CUTS
   
      Libraries required: ALPHA,BOS77
   
      Description
      ===========
   
      This subroutine is a dummy one that only gets the jet/vertex assignment
      of a track from the NDTK bank. The real work was done during the
      NanoDst production by QVSTVA. Therfore all input arguments except
      the track number to QVSTVA are dummy, if a NanoDST is the input.
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   QVSTVA                                                                          
   QVSTCHI2                                                                        
        |---- NVSTVA                                                               
                   |----  GETNAV                                                   
                   |----  QWMESE                                                   
                   |----  NAMIND                              External             
                   |----  IAND                                External             
                   |----  ISHFT                               External             
   
 
3 QNINFO
         SUBROUTINE QNINFO
  ------------------------------------------------------------------------------
    CKEY NANO IN ALPHA /USER
  ------------------------------------------------------------------------------
   Print nanodst production parameters
   
      Author   :- Yves A. Maumary       11-DEC-1991
      Modified :- Yves A. Maumary       29-JAN-1993  Exit if no NDST bank
                                                     read yet
      Modified :- Gerrit Graefe         13-APR-1994  implemented new banks
      Modified :- Gerrit Graefe         05-MAY-1994  put into ALPHA
      Modified :- Gerrit Graefe         27-FEB-1995  added new NDCL NDOB bank
   
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
              QNINFO                                                               
                   |----  SIGN                                External             
                   |----  SQRT                                External             
                   |----  ABS                                 External             
                   |----  NINT                                External             
                   |----  KMATIX                              External             
                   |----  ATG                                 External             
                   |----  KCLARM                              External             
                   |----  IAND                                External             
                   |----  KLOCK0                              External             
                   |----  IABS                                External             
                   |----  FORMAT                              External             
                   |----  PRRHAH                              External             
                   |----  INDEX                               External             
   

2 PACK

  >>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>
    CKEY 
      First entry of <ALFPACK> set of ALPHA internal routines
  <<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<
     ABOLDR     User supplied routine. called from abrsel before a new run starts.
     CALYEAR    Computes year-dependant calibration
     CORANEW    New corrections to photon energy
     CORAOL2    Old corrections to photon energy
     CORAOLD    Old corrections to photon energy
     CQPART     Return particle name cqpart for particle code n
     CQTPN      Return particle name cqtpn for track itk
     ECGATI     Fix gampek photon
     FIXGAEN    Fix gampek photon
     FIXPART    Fix the syntax of some antiparticles as given by kingal
     FIXPCRL    Restore lcal clusters in pcrl,pcob for pot-pot proc. julver < 262
     FIXPECO    Correct peco/deco corrected e for evts proc. w/ jul258/ale133
     FIXPRL     Computes corrected rl for all monte carlo
     FIXRTRL    Recalculate rt/rl
     HCALENSC   Xnano   .true. if input is a nanodst (in nano or epio format, depending
     KCANTI     Return ipc (if ianti = 0) or anti-particle code (if ianti .ne. 0)
     KCDIR      Get first particle ipc in class iclass.
     KCDIRA     Get first particle ipc or its antip. in class iclass.
     KCHT       Get alpha track number of original copy of a charged track.
     KD0FL      Tells which interaction point used to compute d0,z0
     KFPADR     Get row # in qfpa corresponding to particle ipc.
     KGLUND     Translate lund particle code lund into (new) aleph code kglund.
     KGTBLQ     Get the bom+qs0 beam position stored in blqp bank
     KLJTNO     Get number of objects in lepton jet ijet
     KMCCOD     Get internal particle code for external code iext.
     KPART      Kpart: get particle code kpart for particle name cnam
     KPARTX     Get particle code kpartx for name cinp. iflg = 0 if new particle.
     KPCOMP     Get particle code from qpar. input : particle name cinp
     KPDIR      Get first particle cpar in class iclass.
     KPDIRA     Get first particle cpar or its antip. in class iclass.
     KSCNEW     Get sequential class number for iclass. new class if not existing.
     KSCOLD     Get sequential class number for iclass. return 0 if not existing.
     KTLOR      Boost itk and its daughters into the rest frame of itkrst.
     KTLOR1     Boost itk into the rest frame of itkrst.
     KTLORX     Boost itk into the rest frame of itkrst.
     KVNEW      Create new momentum=0 track with particle name cnam
     KVSAVA     Save particle with name cnam or with antipart (cname)
     KVSAVC     Save particle with name cnam in class iclass.
     KVSAVE     Save particle with name cnam
     QADATI     Print alpha header
     QADAU      Mother - daughter relation between itkm and ntkd daughters itkd.
     QAINTA     Interactive job ?
     QAMOTH     Daughter - mother relation between itkm and ntkd daughters itkd.
     QANFILI    Examine the content of a fili card to extract tape + file #
     QAPNAM     Get particle codes from particle names; check part-antip relation;
     QAPTMP     Translate old fashioned particle table into the new one.
     QBOMEV     Calculate beam position from boms.
     QBOMRU     Get run-by-run bom constants from database.
     QBOOK1     Alpha version of hbook1
     QBOOK2     Alpha version of hbook2
     QBOOKN     Alpha shortversion of hbookn
     QBOOKR     Book ntuples with 2 more variables to store run/event numbers
     QBPROF     Alpha version of hbprof
     QCABSA     Recalculates rl for electron - auxiliary to fixrtrl
     QCAF4C     Correct rt for various data sets - auxiliary to fixrtrl
     QCORFIC    Auxiliary to hcalensc          a. sciaba   5-98
     QCPMOD     Modify particle according to pmod data card
     QCPNEW     Establish new particle according to pnew data card
     QCPRLN     Computes beta/alpha and rl for electron - auxiliary to fixprl
     QCPTETI    Computes  tetifl  ecal theta impact in ecal numbering
     QCPTRA     Set transformation table according to ptra data card
     QDATA      Quasi block data
     QDECA2     For the 2-body decay m --> m(i) + m(j), this function calculates the
     QDECAN     For the decay m(i) --> m(j)+...+m(n), this function calculates the
     QDOTPXS    Create tpxs bank of truncated means for pad de/dx
     QEDIRUPD   Set lepton tagging bits 27 and 28 for event directory
     QETHPH     From space coordinate calculate phi, teta ,ik in ecal numbering
     QEXTRA     Extrapolates tracks in ecal
     QFBITM     Fill bit masks for reconstructed particles
     QFCADD     Add 4-momenta of the composite calorimeter object nto.
     QFCALD     Fill qvec with calorimeter objects.
     QFCASC     Combine ecal and hcal if associated to each other
     QFCHGD     Fill qvec with reconstructed charged tracks from pot / dst
     QFCOBJ     Fill calorimeter objects
     QFCOEQ     Fill qvec for calorimeter objects
     QFCOER     Set up relations for calorimeter objects
     QFCOMP     Decide whether ecal object ntke and hcal object ntkh really form a
     QFCREL     Check the relations between ecal objects and hcal objects.
     QFD0Z0     Recompute d0 and z0 of alpha charged tracks
     QFECAL     Get energy, theta, phi from row npeco in ecal bank peco.
     QFECWD     Fill ecal wire energies from dst or pot
     QFECWM     Fill ecal wire energies from mdst
     QFEFLO     Fill eft section from efol bank.
     QFFRFT     Deal with frft banks and frxy data cards
     QFGAMP     Fill gat section from pgac bank ( or old pgpc or older egpc )
     QFGETBP    Chunk-by-chunk beam position and size
     QFHCAL     Get energy, theta, phi from row nphco in ecal bank phco.
     QFHEAD     Puts selected contents of banks eveh, dhea, kevh into variables
     QFILBP     Fill beam position from get_bp algorithm
     QFILL      Fill qvec and qvrt
     QFILMC     Fill p vector with mc-truth info
     QFILNV     Fill non-standard vertices from new tracking
     QFJETS     Fill ejet section from ejet bank.
     QFKINK     Fill parameters of kink vertices from new tracking
     QFKIREV    Xnano   .true. if input is a nanodst (in nano or epio format, depending
     QFLEPT     Fill lepton tags from pdlt/pmlt banks
     QFLJET     Fill ljet section from pljt bank ( jets built by qselep )
     QFMCBM     Fill bit masks
     QFMCMD     Fill mother - daughter relation for mc particles
     QFMCPA     Fill mc particles
     QFMCST     Fill stability code for mc particles
     QFMCVX     Fill mc vertices
     QFMTCH     Fill match infomation into qvec
     QFNDIN     Find intersection between a line and a plane
     QFNEOB     Fill neob section from pcqa bank.
     QFNINT     Fill parameters of nuclear interaction vertices from new tracking
     QFPMSC     Fill word for mult.scatt in frft from mini bank 'pmsc'
     QFPTPX     Rebuild the ptpx bank for pad de/dx if necessary
     QFREFIT    Refit tracks and overwrite the old fit results
     QFREV0     Fill alpha banks with reconstructed vertex, v0 information.
     QFYLV0     Fill alpha banks with "long v0s" from new tracking
     QFYNVH     Fill list of tracks from nuclear interaction vertices from new
     QGTPDDX    Get the pad de/dx from pots
     QHFN       Fill n-tuple with variable number of arguments
     QHFNR      Fill n-tuple with variable number of arguments + run, event #
     QHFR       Fill ntuples adding the run and event # as two last variables
     QLMINRP    Gives the lumi with miniramp for the current run
     QMAIN      Main program
     QMALPH     Initialise alpha
     QMBANK     Copy bank cnam (e.g. given by data cards) into array(length)
     QMCARD     Read and interpret cards
     QMCFRF     Read and interpret frxy data cards
     QMCHI2     Chi**2 from mass difference
     QMCLR      Clear alpha banks, commons, etc.
     QMDBAS     Read in short-term database
     QMDIFF     Mass difference
     QMEVNT     Event processing
     QMIHIS     Initialize histogram package
     QMININC    Data cards default initialisation for official mini making
     QMINIT     Initialize analysis job
     QMNAMI     Define name indices
     QMNEWR     Called for new run
     QMPART     Particle table initialization
     QMRDSB     Read next event.
     QMREAD     Calling routine for qmrdsb, qmterm
     QMSREC     Called for "unknown" record types (slow control, end-of-run)
     QMSTCLR    Stage clear all tapes/files from 'fili' cards if sclr card present
     QMSTGIN    Stage all tapes/files from 'fili' cards if stgi card present
     QMTERM     System termination
     QNVSTO     Stores a new vertex from new tracking
     QPCHAR     Particle mass
     QPLIFE     Particle life time
     QPMASS     Particle mass
     QPPMMA     Get from part the mass of particle with name cinp
     QPWIDT     Particle width
     QRKSEC     Xnano   .true. if input is a nanodst (in nano or epio format, depending
     QSBANK     Create alpha banks or increase their size
     QSTFLI     Set flag iflag in user space to ivalue (integer) for itk.
     QSTFLR     Set flag iflag in user space to value (real) for itk.
     QSUSTR     Reserve user space for tracks
     QSUSVX     Reserve user space for vertices
     QTCLAS     Lorentz transformation of all objects in iclass into frame itkrst.
     QTIMEZ     Time consumption monitoring.
     QTKIREV 
     QTRESC     Apply tpcorr to all charged tracks
     QUEFLO     User routine called before qfeflo
     QUEVNT     Process one event
     QUIBOS     Initialize bos
     QUIHIS     Initialize histogram package
     QUINIT     User initialisation
     QUKISTAT 
     QUNEWR     New run
     QUOPEN     Dummy open routine; called before qmcard
     QUPEC1     Create bank peco/1 if requested
     QUREFIT    User refit of tracks
     QURESC     User-interface for calling rescaling routines before the
     QURKSEC 
     QUSREC     Called for unknown record types
     QUTERM     User termination
     QUTHIS     Histogram output
     QV0CHK     Get the chi2 of a track with the constraint of the primary vertex
     QVADD2     Sum (4-vector(itkn) (n=1,2)) --> 4-vector(itksum)
     QVADD3     Sum (4-vector(itkn) (n=1,3)) --> 4-vector(itksum)
     QVADD4     Sum (4-vector(itkn) (n=1,3)) --> 4-vector(itksum)
     QVADDN     4-vector(itksum) + 4-vector(itk) --> 4-vector(itksum)
     QVCOPY     Copy track itkfro to itkto.
     QVCROS     4-vector(itk1) cross 4-vector(itk2) --> 4-vector(itkres)
     QVDROA     Drop tracks with name cnam in class icl. cnam = ' ' : all tracks.
     QVDROP     Drop tracks with name cnam in class iclass. cnam = ' ' : all tracks.
     QVGET3     3-vector(itk) --> array p
     QVGET4     4-vector(itk) --> array p
     QVGETS     Error matrix --> s
     QVSCAL     Momentum(itk) --> momentum(itk) * fact
     QVSET3     Array p --> 3-vector(itk)
     QVSET4     Array p --> 4-vector(itk)
     QVSETC     Achar   --> charge(itk)
     QVSETM     Amass --> mass(itk).
     QVSETS     Error matrix s --> itk
     QVSUB      4-vector(itksum) - 4-vector(itk1) --> 4-vector(itkres)
     QVZERO     Zero track itk.
     QWCLAS     Set bits for event directory classification word.
     QWERRC     Print messages for return codes from card reading routines
     QWEVNT     Print all tracks
     QWFILE     Print input / output files
     QWHEAD     Print event header
     QWHFUL     Print full event header
     QWITK      Print track itk
     QWIVX      Print vertex ivx
     QWMESE     Print message and run/event number.
     QWMESS     Print message.
     QWNEWTR    Print alpha new tracking banks in readable format
     QWPARS     Print particle table summary
     QWPART     Print row i in bank qpar
     QWRITE     Event output routine
     QWRPTPX    Transfer the tpxs banks to the ptpx banks
     QWRUNR     Run record output routine
     QWSEC      Print section nsec
     QWSUMM     Write out luminosity, hadronic event summary.
     QWSYNT     Print syntax error message
     QWTIME     Print time consumption
     QWTREE     Print tree of daughters for track itk
     VDFIXZ     Correct for cos theta dependent zshift of vdet hits

3 ABOLDR
         SUBROUTINE ABOLDR (IRUN)
  ------------------------------------------------------------------------------
    CKEY ABREAD READ BOS /INTERNAL
  ------------------------------------------------------------------------------
    AUTHOR :      H. Albrecht            Mar 90
   User supplied routine. called from abrsel before a new run starts.
     Exactly : when a run record with a new run number is encountered.
     IRUN refers to the old run. The old run records banks are still
     available; the new ones are not yet read in.
     Alpha version :
       IRUN < 0 : ABOLDR called from QMREAD
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   QMRDSB                                                                          
        |---- ABOLDR                                                               
                   |----  IABS                                External             
                   |----  QMNEWR                                                   
                   |----  QWMESE                                                   
   
 
3 CALYEAR
         SUBROUTINE CALYEAR(NRUN)
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   - Author: M.N Minard          940121
   Computes year-dependant calibration
       Called from ECGATI
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   ECGATI                                                                          
        |---- CALYEAR                                                              
                   |----  CAL92                                                    
   
 
3 CORANEW
         FUNCTION CORANEW(E,TH,PH,NRUN)
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   New corrections to photon energy
   - Author: M.N Minard          940121
     Called from FIXGAEN
   - INPUT : E       : Energy of cluster
   -          TH      : Cluster theta angle (rad)
   -          PH      : Cluster PHI angle (rad)
   -          NRUN    : Run number
   - Output: CORANEW : correction factor
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   CORAOL2                                                                         
   FIXGAEN                                                                         
        |---- CORANEW                                                              
                   |----  ABS                                 External             
                   |----  COS                                 External             
   
 
3 CORAOL2
         FUNCTION CORAOL2(EN,TH,PH,NRUN)
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Old corrections to photon energy
   - Author: M.N Minard          940908
             Deconvolute correction for alephlib >156
     Called from FIXGAEN
   - Input : EN      : Energy of cluster from 4 towers
   -          TH      : Cluster theta angle (rad)
   -          NRUN    : Run number
   - Output: CORAOLD : corrected energy
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   FIXGAEN                                                                         
        |---- CORAOL2                                                              
                   |----  ABS                                 External             
                   |----  COS                                 External             
                   |----  MIN                                 External             
                   |----  CORANEW                                                  
                   |----  DRTEQ3                              External             
   
 
3 CORAOLD
         FUNCTION CORAOLD(EN,TH,NRUN)
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Old corrections to photon energy
   - Author: M.N Minard          940121
     Called from FIXGAEN
   - Input : EN      : Energy of cluster from 4 towers
   -          TH      : Cluster theta angle (rad)
   -          NRUN    : Run number
   - Output: CORAOLD : corrected energy
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   FIXGAEN                                                                         
        |---- CORAOLD                                                              
                   |----  ABS                                 External             
                   |----  COS                                 External             
                   |----  MIN                                 External             
                   |----  DRTEQ3                              External             
   
 
3 CQPART
         FUNCTION CQPART (N)
  ------------------------------------------------------------------------------
    CKEY PART /USER
  ------------------------------------------------------------------------------
   Return particle name cqpart for particle code n
    from anywhere
                                                     H.Albrecht 18.10.88
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   CQTPN                                                                           
   QWPART                                                                          
        |---- CQPART                                                               
                   |----  CHAINT                              External             
   
 
3 CQTPN
         FUNCTION CQTPN (ITK)
  ------------------------------------------------------------------------------
    CKEY PART /USER
  ------------------------------------------------------------------------------
   Return particle name cqtpn for track itk
    from anywhere
                                                     H.Albrecht 18.10.88
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   QWITK                                                                           
   QWIVX                                                                           
   QWTREE                                                                          
   CHECKQ                                                                          
   IBRE                                                                            
   KMLEPT                                                                          
   TXKOD                                                                           
        |---- CQTPN                                                                
                   |----  CQPART                                                   
   
 
3 ECGATI
         SUBROUTINE ECGATI(NRUN)
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   - Author: M.N Minard          940121
   Fix gampek photon
       Called from FIXGAEN
   -    For all processing JULIA before ALEPHLIB 156
   -    find Gain correction either from ECMC or Bank file
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   FIXGAEN                                                                         
        |---- ECGATI                                                               
                   |----  NAMIND                              External             
                   |----  MINGTV                                                   
                   |----  CHAINT                              External             
                   |----  CALYEAR                                                  
   
 
3 FIXGAEN
         SUBROUTINE FIXGAEN
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   - Author: M.N Minard   940121   modified 970805
   Fix gampek photon
       Called from QFILL
   -    For all processing JULIA before ALEPHLIB 156
   -    uses Gain correction either from ECMC or Bank file
   -    for processing of minis before alephlib 156 , db 187
   -    uses correction routine to photon energy  CORAOLD/CORANEW
   -    The correction is done on the ALPHA GAT section
   
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   QFILL                                                                           
        |---- FIXGAEN                                                              
                   |----  SIGN                                External             
                   |----  SQRT                                External             
                   |----  ABS                                 External             
                   |----  NINT                                External             
                   |----  KMATIX                              External             
                   |----  ATG                                 External             
                   |----  KCLARM                              External             
                   |----  IAND                                External             
                   |----  KLOCK0                              External             
                   |----  IABS                                External             
                   |----  CHAINT                              External             
                   |----  NAMIND                              External             
                   |----  ALVERS                              External             
                   |----  ADBVER                              External             
                   |----  ECGATI                                                   
                   |----  ACOS                                External             
                   |----  COS                                 External             
                   |----  AINT                                External             
                   |----  CORANEW                                                  
                   |----  CORAOLD                                                  
                   |----  CORAOL2                                                  
   
 
3 FIXPART
         SUBROUTINE FIXPART
  ------------------------------------------------------------------------------
    CKEY PART /INTERNAL
  ------------------------------------------------------------------------------
   Fix the syntax of some antiparticles as given by kingal
    to make them understandable by ALPHA
    Called from QMNEWR
                                                     J.Boucrot  01.02.94
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   QMNEWR                                                                          
        |---- FIXPART                                                              
                   |----  KMCCOD                                                   
                   |----  ALSTIN                              External             
                   |----  ICFILA                              External             
                   |----  ALINST                              External             
   
 
3 FIXPCRL
         SUBROUTINE FIXPCRL
  ------------------------------------------------------------------------------
    CKEY  EVENT / INTERNAL
  ------------------------------------------------------------------------------
   Restore lcal clusters in pcrl,pcob for pot-pot proc. julver < 262
   
      Author   :- E. Lancon             10-JUN-1992
   
      Modifications.
          1. Patrick Janot -- 13 June 1992:
             o Update PCOB as well as PCRL (# of calobjects)
             o Update the 10th row of the LCAL PECOs (Relation PECO/PCOB)
             o Fill the 1st row of PCRL for the new lines (calobject
               number)
          2. E. Lancon 15-JUN-1992
             o order in PCRL
   
     Called from QMEVNT
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   QMEVNT                                                                          
        |---- FIXPCRL                                                              
                   |----  NAMIND                              External             
                   |----  AUBOS                               External             
   
 
3 FIXPECO
         SUBROUTINE FIXPECO
  ------------------------------------------------------------------------------
    CKEY  EVENT / INTERNAL
  ------------------------------------------------------------------------------
   Correct peco/deco corrected e for evts proc. w/ jul258/ale133
   
      Author   :- E. Lancon             30-MAR-1992
    Modified   :- S. Haywood             1-SEP-1992
      Description
      ===========
   
         Real Data (NOT Monte-Carlo) produced with Julia version 2.58 and
         Alephlib 133 have ECAL Pad energies too low. Due to a wrong clus
         correction applied to clusters in PECO, DECO banks.
         NOTE : Since DECO does not contain the cluster raw energy, it is
         impossible to make the true correction. To be consistent the clu
         correction is determined from the corrected energy for BOTH PECO
         DECO.
   
         The clustering correction should have been :
   
             corr =   1. + a / Sqrt(E_raw) , a = 0.091 for Barrel
                                                 0.102 for End-Caps
   
         Instead a was taken as 0.046 for the Barrel and 0.071 for the En
   
    Called from QMEVNT
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   QMEVNT                                                                          
        |---- FIXPECO                                                              
                   |----  NAMIND                              External             
                   |----  NLINK                               External             
                   |----  MINGTV                                                   
                   |----  CHAINT                              External             
                   |----  SQRT                                External             
                   |----  FLOAT                               External             
   
 
3 FIXPRL
         SUBROUTINE FIXPRL
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Computes corrected rl for all monte carlo
    activated by the data card UPRL in the users cards
    from QFILL
        For Monte-Carlo event :
                  - recalculate Rl Galeph version > 304 and < 400
                                   Database > 206 and < 400
                                   Author: P. Perret   31/01/97
                                    modified I. Debonis 24/07/01
                                    modified P. Azzurri 08/02/02
       Input  ITK   Track number
       Output RLnew new Rl electron estimator
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   QFILL                                                                           
        |---- FIXPRL                                                               
                   |----  SIGN                                External             
                   |----  SQRT                                External             
                   |----  ABS                                 External             
                   |----  NINT                                External             
                   |----  KMATIX                              External             
                   |----  ATG                                 External             
                   |----  KCLARM                              External             
                   |----  IAND                                External             
                   |----  KLOCK0                              External             
                   |----  IABS                                External             
                   |----  NAMIND                              External             
                   |----  IW                                  External             
                   |----  LROWS                               External             
                   |----  CHAINT                              External             
                   |----  ITABL                               External             
                   |----  QCPTETI                                                  
                   |----  KJQDET                              External             
   
 
3 FIXRTRL
         SUBROUTINE FIXRTRL
  ------------------------------------------------------------------------------
    CKEY  FILL / INTERNAL
  ------------------------------------------------------------------------------
   Recalculate rt/rl
    Execution activated by the data card RTRL in the users CARDS
    Called from QFILL
                                   Author: M.N Minard 10/11/93
   -    For Monte-Carlo event
           - Recalculate RL Julia Version 262-270
           - Recalculate RT Database <185 and Geom 92
   -    For Data event
           - Recalculate RT Julia Version 262-270, Db<185, 93 data
           - Recalculate RT(ec) Julia Version 262-270, Db<185 , 92 data
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   QFILL                                                                           
        |---- FIXRTRL                                                              
                   |----  SIGN                                External             
                   |----  SQRT                                External             
                   |----  ABS                                 External             
                   |----  NINT                                External             
                   |----  KMATIX                              External             
                   |----  ATG                                 External             
                   |----  KCLARM                              External             
                   |----  IAND                                External             
                   |----  KLOCK0                              External             
                   |----  IABS                                External             
                   |----  NAMIND                              External             
                   |----  MINGTV                                                   
                   |----  CHAINT                              External             
                   |----  COS                                 External             
                   |----  SIN                                 External             
                   |----  QEXTRA                                                   
                   |----  ATAN2                               External             
                   |----  ACOS                                External             
                   |----  QETHPH                                                   
                   |----  QCAF4C                                                   
                   |----  QCABSA                                                   
   
 
3 HCALENSC
         SUBROUTINE HCALENSC
  ------------------------------------------------------------------------------
    CKEY EVENT / INTERNAL
  ------------------------------------------------------------------------------
     Corrects the HCAL energy for 1996 and 1997 data
     in all the relevant banks (PHST, PHCO, HMAD)
                                   A.Sciaba`      5-98
     12-APR-1999: Corrects also for a bug in the calibration
                  software
   
   -------------------- /QCDE/ --- COMMONs, DIMENSIONs, etc. ------------
   
    of QCDESH ----------------------- Description in QDATA ---------
         PARAMETER (KCQDET=34, KCQFPA=8, KCQPAR=10, KCQVEC=73, KCQVRT=30,
        & KHE=1, KHMU=2, KHPI=3, KHK=4, KHP=5, KHPHOT=1, KHNHAD=2,
        & KMONTE=-2, KRECO=-1, KLOCKM=14, KSOVT=1, KSCHT=2, KSIST=3,
        & KSAST=4, KSEHT=5, KSV0T=6, KSDCT=7, KSEFT=8, KSNET=9, KSGAT=10,
        & KSJET=11, KSMCT=12, KSREV=13,
        & KSMCV=14, KUNDEF=-12344321, QQPI=3.141593, QQE=2.718282,
        & QQ2PI=QQPI*2., QQPIH=QQPI/2., QQRADP=180./QQPI, QQC=2.997925E10,
        & QQH=6.582173E-25, QQHC=QQH*QQC, QQIRP=.00029979)
         CHARACTER CQDATE*8, CQDWRK*80, CQFHIS*80, CQFOUT*80, CQFWRK*80,
        & CQHTIT*80, CQSEC*3, CQTIME*8, CQUNPK*30, CQVERS*6, CQRLST*800,
        & CQELST*800
         COMMON /QCDEC/ CQDATE, CQDWRK, CQFHIS, CQFOUT, CQFWRK, CQHTIT,
        & CQSEC(14), CQTIME, CQUNPK, CQVERS, CQRLST, CQELST
         COMMON /QCDE/ QELEP, QMFLD ,QMFLDC, QTIME, QTIMEI, QTIMEL,
        & QTIMES, QTIMET, QDHEEC, QDHEEL, QDHEPF, QDHETH, QDHEPH, QDHEEF,
        & QDHEET, QDHET1, QDHEP1, QDHET2, QDHEP2, QDHEE1, QDHEE2, QDHEE3,
        & QKEVRN, QKEVWT, QVXNOM, QVYNOM, QVZNOM, QVXNSG, QVYNSG, QVZNSG,
        & QINLUM, QRINLN, QRINLU, QDBOFS, QEECWI(36), QVXBOM, QVYBOM,
        & QSILUM, QRSLLU, QRSLBK, QRSLEW , QVTXBP(3), QVTEBP(3), QVTSBP(3)
         COMMON /QCDE/  KFOVT, KLOVT, KNOVT, KFCHT, KLCHT, KNCHT, KFIST,
        & KLIST, KNIST, KFAST, KLAST, KNAST, KFEHT, KLEHT, KNEHT, KFV0T,
        & KLV0T, KNV0T, KFDCT, KLDCT, KNDCT, KFEFT, KLEFT, KNEFT, KFNET,
        & KLNET, KNNET, KFGAT, KLGAT, KNGAT, KFJET, KLJET, KNJET, KFMCT,
        & KLMCT, KNMCT, KFREV, KLREV, KNREV, KFMCV, KLMCV, KNMCV, KLUST,
        & KLUSV, KFFRT, KLFRT, KFFRV, KLFRV, KNRET, KNCOT, KFFRD,
        & KLFJET,KLLJET,KLNJET
         COMMON /QCDE/ KBIT(32), KCLACO(KCQFPA), KCLAFR(KCQFPA), KCLARM
        & (KCQFPA), KDEBUG, KEVT, KEXP, KFFILL, KFEOUT, KJOPTN(2,2),
        & KLEOUT, KLROUT, KLOCK0(KLOCKM,2), KLOCK1(KLOCKM,2), KLOCK2(
        & KLOCKM,2), KMATIX(6,6), KMQFPA, KNEFIL, KNEOUT, KNEVT, KNPAST,
        & KNQDET, KNQFPA, KNQLIN, KNQMTX, KNQPAR, KNQPST, KNREIN, KNREOU,
        & KOQDET, KOQFPA, KOQLIN, KOQMTL, KOQMTS, KOQPAR, KOQPBT, KOQPLI,
        & KOQTRA, KOQVEC, KOQVRT, KQPAR, KQVEC, KQVRT, KQWRK, KQZER, KRUN,
        & KSTATU, KTDROP, KUCARD, KUCONS, KUHIST, KUINPU, KUOUTP, KUPRNT,
        & KUPTER, KDEBU1, KDEBU2, KNWRLM, KEFOPT, KUEDIN, KUEDOU, KURTOX,
        & KUCAR2, KNHDRN, KNBHAB, KSBHAB, KRSLLQ, KRSLNB
         COMMON /QCDE/ INDATA
         COMMON /QCDE/ KRINNE, KRINNF, KRINDC, KRINDQ, KRINNZ, KRINNB,
        & KRINBM, KRINFR, KRINLR, KRINLF
         COMMON /QCDE/ KEVERT, KEVEDA, KEVETI, KEVEMI(4), KEVETY, KEVEES,
        & KDHEFP, KDHENP, KDHENM, KKEVNT, KKEVNV, KKEVID, KDHENX, KDHENV,
        & KDHENJ, KREVDS, KXTET1, KXTET2, KXTEL2, KXTCGC, KXTCLL, KXTCBN,
        & KXTCCL, KXTCHV, KXTCEN, KCLASW, KERBOM, KBPSTA
         DIMENSION KLOCUS(3,14)
         EQUIVALENCE (KLOCUS(1,1),KFOVT), (KFOVT,KFRET), (KLIST,KLRET),
        & (KFIST,KFCOT), (KLAST,KLCOT)
         COMMON /QCDE/ XCOPYJ, XFLIAC, XHISTO, XLREV(2), XLREV2(2), XMCEV,
        & XMINI, XSYNTX, XWREVT, XWRRUN, XFILMC, XFILCH, XFILV0, XFILCO,
        & XFILEF, XFILPC, XFILGA, XFILJE,
        & XPRHIS, XFILL, XVITC, XVTPC, XVECAL, XVLCAL, XVTPCD,
        & XVSATR, XVHCAL, XHVTRG, XSREC, XWMINI, XIOKLU, XIOKSI, XFRF2,
        & XNSEQ, XVDOK, XFRF0, XFMUID, XFILEM, XWNANO, XROKSI, XGETBP,
        & XJTHRU
         LOGICAL XCOPYJ, XFLIAC, XHISTO, XLREV, XLREV2, XMCEV, XMINI,
        & XSYNTX, XWREVT, XWRRUN, XFILMC, XFILCH, XFILV0, XFILCO, XFILEF,
        & XFILPC, XPRHIS, XFILL, XVITC, XVTPC, XVECAL, XVLCAL, XVTPCD,
        & XVSATR, XVHCAL, XHVTRG, XSREC, XWMINI, XIOKLU, XFRF2, XFILJE,
        & XNSEQ, XFILGA, XVDOK, XFRF0, XFMUID, XFILEM, XWNANO, XIOKSI,
        & XROKSI, XGETBP, XJTHRU
   
   -------------------- /NANCOM/ --- NanoDst steering -------------------
   Xnano   .true. if input is a nanodst (in nano or epio format, depending
                      XNANOR)
   
         LOGICAL XNANO
         COMMON /NANCOM/XNANO
   
   
    bcs
         INTEGER LMHLEN, LMHCOL, LMHROW
         PARAMETER (LMHLEN=2, LMHCOL=1, LMHROW=2)
         COMMON /BCS/   IW(1000)
         INTEGER IW
         REAL RW(1000)
         EQUIVALENCE (RW(1),IW(1))
   
   
   ------------------ /QCNAMI/ --- name indices -------------------------
         COMMON /QCNAMI/ NAAFID,NAAJOB,NAASEV,NABCNT,NABHIT,NABOMB,
        1 NABOME,NABOMP,NABOMR,NABPTR,NADCAL,NADCRL,NADECO,NADEID,NADENF,
        2 NADEVT,NADEWI,NADFMC,NADFOT,NADGAM,NADHCO,NADHEA,NADHRL,NADJET,
        3 NADMID,NADMJT,NADMUO,NADNEU,NADPOB,NADRES,NADTBP,NADTMC,NADTRA,
        4 NADVER,NADVMC,NAECRQ,NAECTE,NAEGID,NAEGPC,NAEIDT,NAEJET,NAERRF,
        5 NAETDI,NAETKC,NAEVEH,NAEWHE,NAFICL,NAFKIN,NAFPOI,NAFPOL,NAFRFT,
        6 NAFRID,NAFRTL,NAFSTR,NAFTCL,NAFTCM,NAFTOC,NAFTTM,NAFVCL,NAFVER,
        7 NAFZFR,NAHCCV,NAHCTE,NAHINF,NAHMAD,NAHPDI,NAHROA,NAHSDA,NAHTUB,
        8 NAIASL,NAIPJT,NAIRJT,NAITCO,NAITMA,NAIXTR,NAIZBD,NAJBER,NAJEST,
        9 NAJSUM,NAKEVH,NAKINE,NAKJOB,NAKLIN,NAKPOL,NAKRUN,NALIDT,NALOLE,
        A NALUPA,NAMCAD,NAMHIT,NAMTHR,NAMUDG,NAMUEX,NAOSTS,NAPART,NAPASL,
        B NAPCHY,NAPCOB,NAPCOI,NAPCPA,NAPCQA,NAPCRL,NAPECO,NAPEHY,NAPEID,
        C NAPEMH,NAPEPT,NAPEST,NAPEWI,NAPFER,NAPFHR,NAPFRF,NAPFRT,NAPHCO,
        D NAPHER,NAPHHY,NAPHMH,NAPHST,NAPIDI,NAPITM,NAPLID,NAPLPD,NAPLSD,
        E NAPMSK,NAPNEU,NAPPDS,NAPPOB,NAPPRL,NAPRTM,NAPSCO,NAPSPO,NAPSTR,
        F NAPT2X,NAPTBC,NAPTCO,NAPTEX,NAPTMA,NAPTML,NAPTNC,NAPTST,NAPVCO,
        G NAPYER,NAPYFR,NAPYNE,NAQDET,NAQFPA,NAQLIN,NAQMTL,NAQMTS,NAQPAR,
        H NAQPBT,NAQPLI,NAQTRA,NAQVEC,NAQVRT,NAQWRK,NAQZER,NAREVH,NARHAH,
        I NARTLO,NARTLS,NARUNH,NARUNR,NASFTR,NATEXS,NATGMA,NATMTL,NATPCO,
        J NAVCOM,NAVCPL,NAVDCO,NAVDHT,NAVDXY,NAVDZT,NAVERT,NAVFHL,NAVFLG,
        K NAVFPH,NAVHLS,NAVPLH,NAX1AD,NAX1SC,NAX1TI,NAX2DF,NAX3EC,NAX3EW,
        L NAX3HC,NAX3IT,NAX3L2,NAX3LU,NAX3TM,NAX3TO,NAX3TP,NAX3X3,NAXTBN,
        M NAXTBP,NAXTCN,NAXTEB,NAXTOP,NAXTRB,NAYV0V,NAZPFR,NAEFOL,NAMUID,
        N NAPGID,NAPGPC,NAPGAC,NAPMSC,NAPTHR,NANBIP,NAPDLT,NAPMLT,NAPLJT
   
   
   ------------------ /QQQQJJ/ --- HAC parameters for ALPHA banks -------
         PARAMETER (JQVEQX= 1,JQVEQY= 2,JQVEQZ= 3,JQVEQE= 4,JQVEQM= 5,
        & JQVEQP= 6,JQVECH= 7,JQVETN= 8,JQVESC= 9,JQVEKS=10,JQVECL=11,
        & JQVEPA=12,JQVEQD=13,JQVENP=14,JQVESP=15,JQVEOV=16,JQVEEV=17,
        & JQVEND=18,JQVEDL=19,JQVENO=20,JQVEOL=21,JQVENM=22,JQVEML=23,
        & JQVEBM=24,JQVELK=38,JQVEDB=39,JQVEZB=40,JQVESD=41,JQVESZ=42,
        & JQVECB=43,JQVEEM=44,JQVECF=54,JQVEEW=55,JQVEUS=56)
         PARAMETER ( JQVRVX=1,JQVRVY=2,JQVRVZ=3,JQVRVN=4,JQVRTY=5,
        1   JQVRIP=6,JQVRND=7,JQVRDL=8,JQVRAY=9,JQVRAF=10,JQVREM=11,
        2   JQVRCF=17,JQVRET=18)
         PARAMETER ( JQDEAF= 1,JQDEAL= 2,JQDENT= 3,JQDEAT= 4,JQDELT= 8,
        &  JQDEAE= 9,JQDEAH=10,JQDEAM=11,JQDECF=12,JQDEEC=13,JQDEHC=14,
        &  JQDEET=15,JQDEFI=16,JQDENF=17,JQDEFL=18,JQDENE=19,JQDEEL=20,
        &  JQDENH=21,JQDEHL=22,JQDELH=23,JQDEEF=24,JQDEPC=25,JQDEEG=26,
        &  JQDEMU=27,JQDEDX=28,JQDEPG=29,JQDEPD=30,JQDEPM=31)
         PARAMETER ( JQPAGN=1, JQPANA=2, JQPACO=5, JQPAMA=6, JQPACH=7,
        & JQPALT=8,JQPAWI=9,JQPAAN=10)
   
   
         EXTERNAL CQPART, CQTPN, XCEQAN, XLUMOK, XPEQAN, XPEQOR, XPEQU,
        & XVDEOK, LLUMOK, SLUMOK
         CHARACTER * 12 CQPART, CQTPN
         LOGICAL XCAL, XCEQAN, XCEQOR, XCEQU, XECAL, XEID, XFRF, XHCAL,
        & XHMA, XLOCK, XLOCKN, XMC, XLUMOK, XMCA, XPEO, XPHO, XPEQAN,
        & XPEQOR, XPEQU, XSAME, XSIG, XTEX, XPEC, XPEP, XPHC, XYV0,
        & XFRIQF, XEFO, XPCQ, XEGP, XMUI, XVDEOK, XPGP, LLUMOK, SLUMOK,
        & XPGAC, XLEPTG, XLEPTH
   
    alcons
    define universal constants
         REAL PI, TWOPI, PIBY2, PIBY3, PIBY4, PIBY6, PIBY8, PIBY12
         REAL RADEG, DEGRA
         REAL CLGHT, ALDEDX
         PARAMETER (PI=3.141592653589)
         PARAMETER (RADEG=180./PI, DEGRA=PI/180.)
         PARAMETER (TWOPI = 2.*PI , PIBY2 = PI/2., PIBY4 = PI/4.)
         PARAMETER (PIBY6 = PI/6. , PIBY8 = PI/8.)
         PARAMETER (PIBY12= PI/12., PIBY3 = PI/3.)
         PARAMETER (CLGHT = 29.9792458, ALDEDX = 0.000307)
   
         ALDEDX  = constant used in the computation of DEDX in GeV
         CLGHT   = speed of light in cm/nsec
   
   
   
    efoljj
         INTEGER JEFOPX,JEFOPY,JEFOPZ,JEFOEW,JEFOWE,JEFOTY,JEFOLE,JEFOLT,
        +          JEFOLH,JEFOLC,JEFOLJ,LEFOLA
         PARAMETER(JEFOPX=1,JEFOPY=2,JEFOPZ=3,JEFOEW=4,JEFOWE=5,JEFOTY=6,
        +          JEFOLE=7,JEFOLT=8,JEFOLH=9,JEFOLC=10,JEFOLJ=11,
        +          LEFOLA=11)
   
   
    egpcjj
         INTEGER JEGPPX,JEGPPY,JEGPPZ,JEGPR1,JEGPR2,JEGPF4,JEGPDM,JEGPST,
        +          JEGPQU,JEGPPE,LEGPCA
         PARAMETER(JEGPPX=1,JEGPPY=2,JEGPPZ=3,JEGPR1=4,JEGPR2=5,JEGPF4=6,
        +          JEGPDM=7,JEGPST=8,JEGPQU=9,JEGPPE=10,LEGPCA=10)
   
   
    eidtjj
         INTEGER JEIDIF,JEIDR1,JEIDR2,JEIDR3,JEIDR4,JEIDR5,JEIDR6,JEIDR7,
        +          JEIDEC,JEIDIP,JEIDE1,JEIDE2,JEIDE3,JEIDFR,JEIDPE,LEIDTA
         PARAMETER(JEIDIF=1,JEIDR1=2,JEIDR2=3,JEIDR3=4,JEIDR4=5,JEIDR5=6,
        +          JEIDR6=7,JEIDR7=8,JEIDEC=9,JEIDIP=10,JEIDE1=11,
        +          JEIDE2=12,JEIDE3=13,JEIDFR=14,JEIDPE=15,LEIDTA=15)
   
   
    frftjj
         INTEGER JFRFIR,JFRFTL,JFRFP0,JFRFD0,JFRFZ0,JFRFAL,JFRFEM,JFRFC2,
        +          JFRFDF,JFRFNO,LFRFTA
         PARAMETER(JFRFIR=1,JFRFTL=2,JFRFP0=3,JFRFD0=4,JFRFZ0=5,JFRFAL=6,
        +          JFRFEM=7,JFRFC2=28,JFRFDF=29,JFRFNO=30,LFRFTA=30)
   
   
    fridjj
         INTEGER JFRIBP,JFRIDZ,JFRIBC,JFRIDC,JFRIPE,JFRIPM,JFRIPI,JFRIPK,
        +          JFRIPP,JFRINK,JFRIQF,LFRIDA
         PARAMETER(JFRIBP=1,JFRIDZ=2,JFRIBC=3,JFRIDC=4,JFRIPE=5,JFRIPM=6,
        +          JFRIPI=7,JFRIPK=8,JFRIPP=9,JFRINK=10,JFRIQF=11,
        +          LFRIDA=11)
   
   
    frtljj
         INTEGER JFRTIV,JFRTNV,JFRTII,JFRTNI,JFRTNE,JFRTIT,JFRTNT,JFRTNR,
        +          LFRTLA
         PARAMETER(JFRTIV=1,JFRTNV=2,JFRTII=3,JFRTNI=4,JFRTNE=5,JFRTIT=6,
        +          JFRTNT=7,JFRTNR=8,LFRTLA=8)
   
   
    hmadjj
         INTEGER JHMANF,JHMANE,JHMANL,JHMAMH,JHMAIG,JHMAED,JHMACS,JHMAND,
        +          JHMAIE,JHMAIT,JHMAIF,JHMATN,LHMADA
         PARAMETER(JHMANF=1,JHMANE=2,JHMANL=3,JHMAMH=4,JHMAIG=5,JHMAED=6,
        +          JHMACS=7,JHMAND=8,JHMAIE=9,JHMAIT=10,JHMAIF=11,
        +          JHMATN=12,LHMADA=12)
   
   
    mcadjj
         INTEGER JMCANH,JMCADH,JMCADC,JMCAAM,JMCAAC,JMCATN,LMCADA
         PARAMETER(JMCANH=1,JMCADH=3,JMCADC=5,JMCAAM=7,JMCAAC=8,JMCATN=9,
        +          LMCADA=9)
   
   
    muidjj
         INTEGER JMUIIF,JMUISR,JMUIDM,JMUIST,JMUITN,LMUIDA
         PARAMETER(JMUIIF=1,JMUISR=2,JMUIDM=3,JMUIST=4,JMUITN=5,LMUIDA=5)
   
   
    pcqajj
         INTEGER JPCQNA,JPCQPX,JPCQPY,JPCQPZ,JPCQEN,LPCQAA
         PARAMETER(JPCQNA=1,JPCQPX=2,JPCQPY=3,JPCQPZ=4,JPCQEN=5,LPCQAA=5)
   
   
    pdltjj
         INTEGER JPDLPA,JPDLJT,JPDLPI,JPDLPE,JPDLVP,JPDLFR,LPDLTA
         PARAMETER(JPDLPA=1,JPDLJT=2,JPDLPI=3,JPDLPE=4,JPDLVP=5,JPDLFR=6,
        +          LPDLTA=6)
   
   
    pecojj
         INTEGER JPECER,JPECE1,JPECE2,JPECTH,JPECPH,JPECEC,JPECKD,JPECCC,
        +          JPECRB,JPECPC,LPECOA
         PARAMETER(JPECER=1,JPECE1=2,JPECE2=3,JPECTH=4,JPECPH=5,JPECEC=6,
        +          JPECKD=7,JPECCC=8,JPECRB=9,JPECPC=10,LPECOA=10)
   
   
    peptjj
         INTEGER JPEPT1,JPEPP1,JPEPT3,JPEPP3,LPEPTA
         PARAMETER(JPEPT1=1,JPEPP1=2,JPEPT3=3,JPEPP3=4,LPEPTA=4)
   
   
    pgacjj
         INTEGER JPGAEC,JPGATC,JPGAPC,JPGAR1,JPGAR2,JPGAF4,JPGADM,JPGAST,
        +          JPGAQU,JPGAQ1,JPGAQ2,JPGAM1,JPGAM2,JPGAMA,JPGAER,JPGATR,
        +          JPGAPR,JPGAEF,JPGAGC,JPGAZS,JPGAPL,JPGAPH,JPGAPN,JPGAFA,
        +          JPGAPE,LPGACA
         PARAMETER(JPGAEC=1,JPGATC=2,JPGAPC=3,JPGAR1=4,JPGAR2=5,JPGAF4=6,
        +          JPGADM=7,JPGAST=8,JPGAQU=9,JPGAQ1=10,JPGAQ2=11,
        +          JPGAM1=12,JPGAM2=13,JPGAMA=14,JPGAER=15,JPGATR=16,
        +          JPGAPR=17,JPGAEF=18,JPGAGC=19,JPGAZS=20,JPGAPL=21,
        +          JPGAPH=22,JPGAPN=23,JPGAFA=24,JPGAPE=25,LPGACA=25)
   
   
    pgpcjj
         INTEGER JPGPEC,JPGPTC,JPGPPC,JPGPR1,JPGPR2,JPGPF4,JPGPDM,JPGPST,
        +          JPGPQU,JPGPQ1,JPGPQ2,JPGPM1,JPGPM2,JPGPMA,JPGPER,JPGPTR,
        +          JPGPPR,JPGPPE,LPGPCA
         PARAMETER(JPGPEC=1,JPGPTC=2,JPGPPC=3,JPGPR1=4,JPGPR2=5,JPGPF4=6,
        +          JPGPDM=7,JPGPST=8,JPGPQU=9,JPGPQ1=10,JPGPQ2=11,
        +          JPGPM1=12,JPGPM2=13,JPGPMA=14,JPGPER=15,JPGPTR=16,
        +          JPGPPR=17,JPGPPE=18,LPGPCA=18)
   
   
    phcojj
         INTEGER JPHCER,JPHCTH,JPHCPH,JPHCEC,JPHCKD,JPHCCC,JPHCRB,JPHCNF,
        +          JPHCPC,LPHCOA
         PARAMETER(JPHCER=1,JPHCTH=2,JPHCPH=3,JPHCEC=4,JPHCKD=5,JPHCCC=6,
        +          JPHCRB=7,JPHCNF=8,JPHCPC=9,LPHCOA=9)
   
   
    pmltjj
         INTEGER JPMLFL,JPMLPO,JPMLCH,JPMLSP,JPMLLE,JPMLME,JPMLKT,JPMLFR,
        +          LPMLTA
         PARAMETER(JPMLFL=1,JPMLPO=2,JPMLCH=3,JPMLSP=4,JPMLLE=5,JPMLME=6,
        +          JPMLKT=7,JPMLFR=8,LPMLTA=8)
   
   
    texsjj
         INTEGER JTEXSI,JTEXTM,JTEXTL,JTEXNS,JTEXAD,JTEXTN,JTEXSF,LTEXSA
         PARAMETER(JTEXSI=1,JTEXTM=2,JTEXTL=3,JTEXNS=4,JTEXAD=5,JTEXTN=6,
        +          JTEXSF=7,LTEXSA=7)
   
   
    yv0vjj
         INTEGER JYV0K1,JYV0K2,JYV0VX,JYV0VY,JYV0VZ,JYV0VM,JYV0PX,JYV0PY,
        +          JYV0PZ,JYV0PM,JYV0X1,JYV0X2,JYV0XM,JYV0C2,JYV0IC,JYV0P1,
        +          JYV0P2,JYV0EP,JYV0DM,JYV0S1,JYV0S2,LYV0VA
         PARAMETER(JYV0K1=1,JYV0K2=2,JYV0VX=3,JYV0VY=4,JYV0VZ=5,JYV0VM=6,
        +          JYV0PX=12,JYV0PY=13,JYV0PZ=14,JYV0PM=15,JYV0X1=21,
        +          JYV0X2=22,JYV0XM=23,JYV0C2=26,JYV0IC=27,JYV0P1=28,
        +          JYV0P2=31,JYV0EP=34,JYV0DM=55,JYV0S1=56,JYV0S2=57,
        +          LYV0VA=57)
   
   
   
   ALPHA Version 122 - HAC parameters include file created 12 April 1996
   
    afidjj
         INTEGER JAFIAR,JAFIAZ,JAFIMF,JAFIBE,LAFIDA
         PARAMETER(JAFIAR=1,JAFIAZ=2,JAFIMF=3,JAFIBE=4,LAFIDA=4)
   
   
    ajobjj
         INTEGER JAJOBM,JAJORM,JAJOGI,JAJOSO,JAJOSD,JAJOGC,JAJOJD,JAJOJT,
        +          JAJOGV,JAJOAV,JAJOFT,JAJOFS,JAJOFC,JAJODV,JAJODD,JAJOTV,
        +          JAJOCV,JAJOGN,LAJOBA
         PARAMETER(JAJOBM=1,JAJORM=2,JAJOGI=3,JAJOSO=4,JAJOSD=5,JAJOGC=6,
        +          JAJOJD=7,JAJOJT=8,JAJOGV=9,JAJOAV=10,JAJOFT=11,
        +          JAJOFS=12,JAJOFC=13,JAJODV=14,JAJODD=15,JAJOTV=16,
        +          JAJOCV=17,JAJOGN=18,LAJOBA=18)
   
   
    asevjj
         INTEGER JASERG,LASEVA
         PARAMETER(JASERG=1,LASEVA=3)
   
   
    bcntjj
         INTEGER JBCNBT,JBCNB1,JBCNB2,JBCNST,JBCND1,JBCND2,JBCNCT,LBCNTA
         PARAMETER(JBCNBT=1,JBCNB1=2,JBCNB2=3,JBCNST=4,JBCND1=8,JBCND2=9,
        +          JBCNCT=10,LBCNTA=10)
   
   
    bhitjj
         INTEGER JBHIDB,LBHITA
         PARAMETER(JBHIDB=1,LBHITA=1)
   
   
    bomajj
         INTEGER JBOMRU,JBOMXO,JBOMXS,JBOMYO,JBOMYS,JBOMFL,LBOMAA
         PARAMETER(JBOMRU=1,JBOMXO=2,JBOMXS=3,JBOMYO=4,JBOMYS=5,JBOMFL=6,
        +          LBOMAA=6)
   
   
    bombjj
         INTEGER JBOMXX,JBOMYY,JBOMEE,LBOMBA
         PARAMETER(JBOMXX=1,JBOMYY=2,JBOMEE=3,LBOMBA=3)
   
   
    bomejj
         INTEGER JBOMXI,JBOMXP,JBOMYI,JBOMYP,JBOMBU,JBOMIA,JBOMIB,JBOMR1,
        +          JBOMR2,JBOMR3,JBOMR4,JBOMER,LBOMEA
         PARAMETER(JBOMXI=1,JBOMXP=2,JBOMYI=3,JBOMYP=4,JBOMBU=5,JBOMIA=6,
        +          JBOMIB=7,JBOMR1=8,JBOMR2=9,JBOMR3=10,JBOMR4=11,
        +          JBOMER=12,LBOMEA=12)
   
   
    bompjj
         INTEGER JBOMXA,JBOMYA,JBOMSA,JBOMCA,JBOMXB,JBOMYB,JBOMSB,JBOMCB,
        +          JBOMBI,JBOMPU,LBOMPA
         PARAMETER(JBOMXA=1,JBOMYA=2,JBOMSA=3,JBOMCA=4,JBOMXB=5,JBOMYB=6,
        +          JBOMSB=7,JBOMCB=8,JBOMBI=9,JBOMPU=10,LBOMPA=10)
   
   
    bomrjj
         INTEGER JBOMMN,JBOMSI,JBOMPE,JBOMCL,LBOMRA
         PARAMETER(JBOMMN=1,JBOMSI=2,JBOMPE=3,JBOMCL=4,LBOMRA=4)
   
   
    bptrjj
         INTEGER JBPTAB,LBPTRA
         PARAMETER(JBPTAB=1,LBPTRA=1)
   
   
    dcrljj
         INTEGER JDCRDE,JDCRDH,JDCRDT,LDCRLA
         PARAMETER(JDCRDE=1,JDCRDH=2,JDCRDT=3,LDCRLA=3)
   
   
    decojj
         INTEGER JDECE0,JDECTH,JDECPH,JDECEF,JDECCC,LDECOA
         PARAMETER(JDECE0=1,JDECTH=2,JDECPH=3,JDECEF=4,JDECCC=6,LDECOA=6)
   
   
    deidjj
         INTEGER JDEIR2,JDEIR3,JDEIQF,JDEIDE,JDEIDT,LDEIDA
         PARAMETER(JDEIR2=1,JDEIR3=2,JDEIQF=3,JDEIDE=4,JDEIDT=5,LDEIDA=5)
   
   
    denfjj
         INTEGER JDENPX,JDENPY,JDENPZ,JDENE0,JDENWE,JDENTY,JDENPC,JDENDT,
        +          JDENDJ,LDENFA
         PARAMETER(JDENPX=1,JDENPY=2,JDENPZ=3,JDENE0=4,JDENWE=5,JDENTY=6,
        +          JDENPC=7,JDENDT=8,JDENDJ=9,LDENFA=9)
   
   
    devtjj
         INTEGER JDEVLE,JDEVWT,JDEVNX,JDEVNV,JDEVWR,JDEVWA,JDEVWB,JDEVPR,
        +          JDEVPA,JDEVPB,JDEVLA,JDEVLB,JDEVHR,JDEVHA,JDEVHB,LDEVTA
         PARAMETER(JDEVLE=1,JDEVWT=2,JDEVNX=3,JDEVNV=4,JDEVWR=5,JDEVWA=6,
        +          JDEVWB=7,JDEVPR=8,JDEVPA=9,JDEVPB=10,JDEVLA=11,
        +          JDEVLB=12,JDEVHR=13,JDEVHA=14,JDEVHB=15,LDEVTA=15)
   
   
    dewijj
         INTEGER JDEWMN,JDEWE0,JDEWEF,LDEWIA
         PARAMETER(JDEWMN=1,JDEWE0=2,JDEWEF=3,LDEWIA=4)
   
   
    dfmcjj
         INTEGER JDFMZF,LDFMCA
         PARAMETER(JDFMZF=1,LDFMCA=1)
   
   
    dfotjj
         INTEGER JDFOPX,JDFOPY,JDFOPZ,JDFOQF,JDFODE,LDFOTA
         PARAMETER(JDFOPX=1,JDFOPY=2,JDFOPZ=3,JDFOQF=4,JDFODE=5,LDFOTA=5)
   
   
    dgamjj
         INTEGER JDGANA,JDGAE1,JDGAE2,JDGAE3,JDGAE5,JDGAE6,JDGAE8,JDGAE0,
        +          JDGATH,JDGAPH,JDGADE,LDGAMA
         PARAMETER(JDGANA=1,JDGAE1=2,JDGAE2=3,JDGAE3=4,JDGAE5=5,JDGAE6=6,
        +          JDGAE8=7,JDGAE0=8,JDGATH=9,JDGAPH=10,JDGADE=11,
        +          LDGAMA=11)
   
   
    dhcojj
         INTEGER JDHCE0,JDHCTH,JDHCPH,JDHCBN,LDHCOA
         PARAMETER(JDHCE0=1,JDHCTH=2,JDHCPH=3,JDHCBN=4,LDHCOA=4)
   
   
    dheajj
         INTEGER JDHEFP,JDHENX,JDHENP,JDHENM,JDHENV,JDHENJ,JDHEEC,JDHEEL,
        +          JDHEPF,JDHETH,JDHEPH,JDHEEF,JDHEET,JDHET1,JDHEP1,JDHET2,
        +          JDHEP2,JDHEE1,JDHEE2,JDHEE3,JDHERS,JDHEWT,LDHEAA
         PARAMETER(JDHEFP=1,JDHENX=2,JDHENP=3,JDHENM=4,JDHENV=5,JDHENJ=6,
        +          JDHEEC=7,JDHEEL=8,JDHEPF=9,JDHETH=10,JDHEPH=11,
        +          JDHEEF=12,JDHEET=13,JDHET1=14,JDHEP1=15,JDHET2=16,
        +          JDHEP2=17,JDHEE1=18,JDHEE2=19,JDHEE3=20,JDHERS=21,
        +          JDHEWT=22,LDHEAA=22)
   
   
    dhrljj
         INTEGER JDHRDH,JDHRDP,LDHRLA
         PARAMETER(JDHRDH=1,JDHRDP=2,LDHRLA=2)
   
   
    djetjj
         INTEGER JDJEPX,JDJEPY,JDJEPZ,JDJEE0,LDJETA
         PARAMETER(JDJEPX=1,JDJEPY=2,JDJEPZ=3,JDJEE0=4,LDJETA=4)
   
   
    dmjtjj
         INTEGER JDMJNP,JDMJNM,JDMJP0,JDMJTH,JDMJPH,JDMJE0,LDMJTA
         PARAMETER(JDMJNP=1,JDMJNM=2,JDMJP0=3,JDMJTH=4,JDMJPH=5,JDMJE0=6,
        +          LDMJTA=6)
   
   
    dmuojj
         INTEGER JDMUHO,JDMUHE,JDMUSH,JDMUDT,LDMUOA
         PARAMETER(JDMUHO=1,JDMUHE=2,JDMUSH=3,JDMUDT=4,LDMUOA=4)
   
   
    dneujj
         INTEGER JDNENA,JDNEE0,JDNETH,JDNEPH,JDNER1,JDNER2,JDNEPC,JDNEDE,
        +          LDNEUA
         PARAMETER(JDNENA=1,JDNEE0=2,JDNETH=3,JDNEPH=4,JDNER1=5,JDNER2=6,
        +          JDNEPC=7,JDNEDE=8,LDNEUA=8)
   
   
    dpobjj
         INTEGER JDPOE0,LDPOBA
         PARAMETER(JDPOE0=1,LDPOBA=1)
   
   
    dresjj
         INTEGER JDRENA,JDREE0,JDRETH,JDREPH,JDREP0,JDREPS,JDREPC,LDRESA
         PARAMETER(JDRENA=1,JDREE0=2,JDRETH=3,JDREPH=4,JDREP0=5,JDREPS=6,
        +          JDREPC=7,LDRESA=7)
   
   
    dtbpjj
         INTEGER JDTBT1,JDTBT2,JDTBL2,LDTBPA
         PARAMETER(JDTBT1=1,JDTBT2=2,JDTBL2=3,LDTBPA=3)
   
   
    dtmcjj
         INTEGER JDTMPX,JDTMPY,JDTMPZ,JDTMMA,JDTMPA,JDTMOV,JDTMEV,JDTMHC,
        +          LDTMCA
         PARAMETER(JDTMPX=1,JDTMPY=2,JDTMPZ=3,JDTMMA=4,JDTMPA=5,JDTMOV=6,
        +          JDTMEV=7,JDTMHC=8,LDTMCA=8)
   
   
    dtrajj
         INTEGER JDTRCH,JDTRP0,JDTRTH,JDTRPH,JDTRD0,JDTRZ0,JDTRER,JDTRTF,
        +          JDTRHO,JDTRHM,JDTRVB,JDTRQF,JDTREA,JDTRVI,LDTRAA
         PARAMETER(JDTRCH=1,JDTRP0=2,JDTRTH=3,JDTRPH=4,JDTRD0=5,JDTRZ0=6,
        +          JDTRER=7,JDTRTF=12,JDTRHO=13,JDTRHM=14,JDTRVB=15,
        +          JDTRQF=16,JDTREA=17,JDTRVI=27,LDTRAA=27)
   
   
    dverjj
         INTEGER JDVEX0,JDVEY0,JDVEZ0,JDVEFP,JDVEMV,JDVEDT,LDVERA
         PARAMETER(JDVEX0=1,JDVEY0=2,JDVEZ0=3,JDVEFP=4,JDVEMV=5,JDVEDT=6,
        +          LDVERA=6)
   
   
    dvmcjj
         INTEGER JDVMVX,JDVMVY,JDVMVZ,JDVMIP,JDVMVN,JDVMVM,LDVMCA
         PARAMETER(JDVMVX=1,JDVMVY=2,JDVMVZ=3,JDVMIP=4,JDVMVN=5,JDVMVM=6,
        +          LDVMCA=6)
   
   
    ecrqjj
         INTEGER JECRMA,JECRCS,LECRQA
         PARAMETER(JECRMA=1,JECRCS=2,LECRQA=2)
   
   
    ectejj
         INTEGER JECTCA,JECTCE,LECTEA
         PARAMETER(JECTCA=1,JECTCE=2,LECTEA=2)
   
   
    egidjj
         INTEGER JEGIIF,JEGIE1,JEGIE2,JEGIE3,JEGIE4,JEGIE5,JEGIE6,JEGIE7,
        +          JEGIE8,JEGINA,JEGICE,JEGITH,JEGIPH,JEGIPE,LEGIDA
         PARAMETER(JEGIIF=1,JEGIE1=2,JEGIE2=3,JEGIE3=4,JEGIE4=5,JEGIE5=6,
        +          JEGIE6=7,JEGIE7=8,JEGIE8=9,JEGINA=10,JEGICE=11,
        +          JEGITH=12,JEGIPH=13,JEGIPE=14,LEGIDA=14)
   
   
    ejetjj
         INTEGER JEJEPX,JEJEPY,JEJEPZ,JEJEPE,LEJETA
         PARAMETER(JEJEPX=1,JEJEPY=2,JEJEPZ=3,JEJEPE=4,LEJETA=4)
   
   
    errfjj
         INTEGER JERREF,JERRRO,JERRAC,JERRC1,JERRC2,JERRC3,JERRE1,JERRE2,
        +          JERRE3,JERRF1,JERRF2,LERRFA
         PARAMETER(JERREF=1,JERRRO=2,JERRAC=3,JERRC1=4,JERRC2=5,JERRC3=6,
        +          JERRE1=7,JERRE2=8,JERRE3=9,JERRF1=10,JERRF2=11,
        +          LERRFA=11)
   
   
    etdijj
         INTEGER JETDTL,JETDS1,JETDS2,JETDS3,LETDIA
         PARAMETER(JETDTL=1,JETDS1=2,JETDS2=3,JETDS3=4,LETDIA=4)
   
   
    etkcjj
         INTEGER JETKTL,JETKS1,JETKS2,JETKS3,JETKKR,LETKCA
         PARAMETER(JETKTL=1,JETKS1=2,JETKS2=3,JETKS3=4,JETKKR=5,LETKCA=5)
   
   
    evehjj
         INTEGER JEVEEN,JEVERN,JEVERT,JEVEDA,JEVETI,JEVEEV,JEVEM1,JEVEM2,
        +          JEVEM3,JEVEM4,JEVETY,JEVEES,JEVETE,LEVEHA
         PARAMETER(JEVEEN=1,JEVERN=2,JEVERT=3,JEVEDA=4,JEVETI=5,JEVEEV=6,
        +          JEVEM1=7,JEVEM2=8,JEVEM3=9,JEVEM4=10,JEVETY=11,
        +          JEVEES=12,JEVETE=13,LEVEHA=13)
   
   
    ewhejj
         INTEGER JEWHSD,JEWHNU,LEWHEA
         PARAMETER(JEWHSD=1,JEWHNU=2,LEWHEA=2)
   
   
    fkinjj
         INTEGER JFKIPX,JFKIPY,JFKIPZ,JFKIMA,JFKIPA,JFKIOV,JFKIEV,JFKIHC,
        +          LFKINA
         PARAMETER(JFKIPX=1,JFKIPY=2,JFKIPZ=3,JFKIMA=4,JFKIPA=5,JFKIOV=6,
        +          JFKIEV=7,JFKIHC=8,LFKINA=8)
   
   
    fpoijj
         INTEGER JFPOIP,JFPOIS,LFPOIA
         PARAMETER(JFPOIP=1,JFPOIS=2,LFPOIA=2)
   
   
    fpoljj
         INTEGER JFPOKI,JFPOHX,JFPOHY,JFPOHZ,LFPOLA
         PARAMETER(JFPOKI=1,JFPOHX=2,JFPOHY=3,JFPOHZ=4,LFPOLA=4)
   
   
    fverjj
         INTEGER JFVEVX,JFVEVY,JFVEVZ,JFVETO,JFVEIP,JFVEIS,JFVENS,JFVEVN,
        +          JFVEVM,LFVERA
         PARAMETER(JFVEVX=1,JFVEVY=2,JFVEVZ=3,JFVETO=4,JFVEIP=5,JFVEIS=6,
        +          JFVENS=7,JFVEVN=8,JFVEVM=9,LFVERA=9)
   
   
    fzfrjj
         INTEGER JFZFZF,LFZFRA
         PARAMETER(JFZFZF=1,LFZFRA=1)
   
   
    hccvjj
         INTEGER JHCCCC,LHCCVA
         PARAMETER(JHCCCC=1,LHCCVA=1)
   
   
    hctejj
         INTEGER JHCTCA,JHCTCE,LHCTEA
         PARAMETER(JHCTCA=1,JHCTCE=2,LHCTEA=2)
   
   
    hinfjj
         INTEGER JHINEI,LHINFA
         PARAMETER(JHINEI=1,LHINFA=1)
   
   
    hpdijj
         INTEGER JHPDPA,JHPDED,LHPDIA
         PARAMETER(JHPDPA=1,JHPDED=2,LHPDIA=2)
   
   
    hroajj
         INTEGER JHRODX,JHROSG,JHROSF,JHROHI,LHROAA
         PARAMETER(JHRODX=1,JHROSG=2,JHROSF=3,JHROHI=4,LHROAA=4)
   
   
    htubjj
         INTEGER JHTUSN,JHTUMN,JHTULN,JHTULC,JHTUCW,JHTUPR,JHTUPP,LHTUBA
         PARAMETER(JHTUSN=1,JHTUMN=2,JHTULN=3,JHTULC=4,JHTUCW=5,JHTUPR=6,
        +          JHTUPP=7,LHTUBA=7)
   
   
    iasljj
         INTEGER JIASFK,JIASNH,JIASCS,LIASLA
         PARAMETER(JIASFK=1,JIASNH=2,JIASCS=3,LIASLA=3)
   
   
    ipjtjj
         INTEGER JIPJNH,JIPJNS,JIPJRN,LIPJTA
         PARAMETER(JIPJNH=1,JIPJNS=2,JIPJRN=3,LIPJTA=3)
   
   
    irjtjj
         INTEGER JIRJGN,JIRJNH,JIRJSH,LIRJTA
         PARAMETER(JIRJGN=1,JIRJNH=2,JIRJSH=3,LIRJTA=3)
   
   
    itmajj
         INTEGER JITMNA,JITMOF,JITMNC,LITMAA
         PARAMETER(JITMNA=1,JITMOF=2,JITMNC=3,LITMAA=3)
   
   
    ixtrjj
         INTEGER JIXTTI,LIXTRA
         PARAMETER(JIXTTI=1,LIXTRA=1)
   
   
    izdbjj
         INTEGER JIZDTI,LIZDBA
         PARAMETER(JIZDTI=1,LIZDBA=1)
   
   
    jberjj
         INTEGER JJBECO,LJBERA
         PARAMETER(JJBECO=1,LJBERA=1)
   
   
    jestjj
         INTEGER JJESET,JJESON,JJESNN,JJESOL,JJESCL,JJESPN,JJESBP,LJESTA
         PARAMETER(JJESET=1,JJESON=2,JJESNN=3,JJESOL=4,JJESCL=5,JJESPN=6,
        +          JJESBP=7,LJESTA=7)
   
   
    jsumjj
         INTEGER JJSUNT,JJSUNV,JJSUNZ,JJSUNL,JJSUNB,JJSUVT,JJSUVV,JJSUVZ,
        +          JJSUVL,JJSUVB,JJSUTT,JJSUTZ,JJSUTB,JJSULI,JJSUIZ,JJSULO,
        +          JJSULZ,JJSUXV,JJSUYV,JJSUZV,JJSUXS,JJSUYS,JJSUZS,JJSUKB,
        +          JJSUKW,JJSUTN,JJSUTS,JJSUTV,JJSUA0,JJSUA1,JJSUA2,JJSUA3,
        +          JJSUA4,JJSUA5,JJSUA6,JJSUA7,JJSUA8,JJSUA9,JJSUB0,JJSUB1,
        +          JJSUB2,JJSUB3,JJSUB4,JJSUB5,JJSUB6,JJSUB7,JJSUB8,JJSUB9,
        +          JJSUDA,JJSUTI,LJSUMA
         PARAMETER(JJSUNT=1,JJSUNV=2,JJSUNZ=3,JJSUNL=4,JJSUNB=5,JJSUVT=6,
        +          JJSUVV=7,JJSUVZ=8,JJSUVL=9,JJSUVB=10,JJSUTT=11,
        +          JJSUTZ=12,JJSUTB=13,JJSULI=14,JJSUIZ=15,JJSULO=16,
        +          JJSULZ=17,JJSUXV=18,JJSUYV=19,JJSUZV=20,JJSUXS=21,
        +          JJSUYS=22,JJSUZS=23,JJSUKB=24,JJSUKW=25,JJSUTN=26,
        +          JJSUTS=27,JJSUTV=28,JJSUA0=29,JJSUA1=30,JJSUA2=31,
        +          JJSUA3=32,JJSUA4=33,JJSUA5=34,JJSUA6=35,JJSUA7=36,
        +          JJSUA8=37,JJSUA9=38,JJSUB0=39,JJSUB1=40,JJSUB2=41,
        +          JJSUB3=42,JJSUB4=43,JJSUB5=44,JJSUB6=45,JJSUB7=46,
        +          JJSUB8=47,JJSUB9=48,JJSUDA=49,JJSUTI=50,LJSUMA=50)
   
   
    kevhjj
         INTEGER JKEVRN,JKEVNT,JKEVNV,JKEVPI,JKEVWT,JKEVSR,JKEVTR,LKEVHA
         PARAMETER(JKEVRN=1,JKEVNT=2,JKEVNV=3,JKEVPI=4,JKEVWT=5,JKEVSR=6,
        +          JKEVTR=7,LKEVHA=7)
   
   
    kinejj
         INTEGER JKINPX,JKINPY,JKINPZ,JKINMA,JKINPN,JKINVN,LKINEA
         PARAMETER(JKINPX=1,JKINPY=2,JKINPZ=3,JKINMA=4,JKINPN=5,JKINVN=6,
        +          LKINEA=6)
   
   
    kjobjj
         INTEGER JKJOJD,JKJOJT,JKJOAV,JKJODV,JKJODC,LKJOBA
         PARAMETER(JKJOJD=1,JKJOJT=2,JKJOAV=3,JKJODV=4,JKJODC=5,LKJOBA=5)
   
   
    kpoljj
         INTEGER JKPOKI,JKPOHX,JKPOHY,JKPOHZ,LKPOLA
         PARAMETER(JKPOKI=1,JKPOHX=2,JKPOHY=3,JKPOHZ=4,LKPOLA=4)
   
   
    lidtjj
         INTEGER JLIDIF,JLIDEC,JLIDTC,JLIDPC,JLIDE4,JLIDE1,JLIDE2,JLIDR1,
        +          JLIDR2,JLIDXX,JLIDYY,JLIDXY,JLIDDA,JLIDNT,JLIDLO,JLIDLS,
        +          JLIDST,LLIDTA
         PARAMETER(JLIDIF=1,JLIDEC=2,JLIDTC=3,JLIDPC=4,JLIDE4=5,JLIDE1=6,
        +          JLIDE2=7,JLIDR1=8,JLIDR2=9,JLIDXX=10,JLIDYY=11,
        +          JLIDXY=12,JLIDDA=13,JLIDNT=17,JLIDLO=18,JLIDLS=19,
        +          JLIDST=20,LLIDTA=20)
   
   
    lolejj
         INTEGER JLOLFB,JLOLSP,JLOLTO,JLOLMA,JLOLHV,JLOLER,LLOLEA
         PARAMETER(JLOLFB=1,JLOLSP=5,JLOLTO=6,JLOLMA=7,JLOLHV=11,JLOLER=12,
        +          LLOLEA=12)
   
   
    lupajj
         INTEGER JLUPGB,JLUPHV,JLUPT1,JLUPL2,JLUPTE,JLUPLO,JLUPAM,JLUPMD,
        +          JLUPEF,JLUPEC,JLUPEW,JLUPXC,JLUPYC,JLUPTC,JLUPPC,JLUPAX,
        +          JLUPAY,JLUPXX,JLUPYY,JLUPXY,JLUPXA,JLUPYA,JLUPXD,JLUPYD,
        +          JLUPAD,JLUPIT,JLUPCT,JLUPTT,JLUPPT,JLUPXT,JLUPYT,JLUPE1,
        +          JLUPE2,JLUPXL,JLUPYL,JLUPAI,JLUPES,JLUPXS,JLUPYS,JLUPAS,
        +          LLUPAA
         PARAMETER(JLUPGB=1,JLUPHV=2,JLUPT1=3,JLUPL2=4,JLUPTE=5,JLUPLO=6,
        +          JLUPAM=7,JLUPMD=8,JLUPEF=9,JLUPEC=10,JLUPEW=12,
        +          JLUPXC=14,JLUPYC=16,JLUPTC=18,JLUPPC=20,JLUPAX=22,
        +          JLUPAY=24,JLUPXX=26,JLUPYY=28,JLUPXY=30,JLUPXA=32,
        +          JLUPYA=34,JLUPXD=36,JLUPYD=38,JLUPAD=40,JLUPIT=42,
        +          JLUPCT=44,JLUPTT=46,JLUPPT=48,JLUPXT=50,JLUPYT=52,
        +          JLUPE1=54,JLUPE2=56,JLUPXL=58,JLUPYL=60,JLUPAI=62,
        +          JLUPES=64,JLUPXS=66,JLUPYS=68,JLUPAS=70,LLUPAA=71)
   
   
    mhitjj
         INTEGER JMHISC,JMHISN,JMHILN,JMHIXL,JMHIYL,JMHIRH,JMHITH,JMHIPH,
        +          LMHITA
         PARAMETER(JMHISC=1,JMHISN=2,JMHILN=3,JMHIXL=4,JMHIYL=5,JMHIRH=6,
        +          JMHITH=7,JMHIPH=8,LMHITA=8)
   
   
    mthrjj
         INTEGER JMTHHN,JMTHDD,JMTHTN,LMTHRA
         PARAMETER(JMTHHN=1,JMTHDD=2,JMTHTN=3,LMTHRA=3)
   
   
    mudgjj
         INTEGER JMUDEA,LMUDGA
         PARAMETER(JMUDEA=1,LMUDGA=1)
   
   
    muexjj
         INTEGER JMUEXE,JMUEPE,JMUEC0,JMUEC1,JMUEC2,LMUEXA
         PARAMETER(JMUEXE=1,JMUEPE=4,JMUEC0=7,JMUEC1=8,JMUEC2=9,LMUEXA=9)
   
   
    nbipjj
         INTEGER JNBITF,JNBITS,LNBIPA
         PARAMETER(JNBITF=1,JNBITS=2,LNBIPA=2)
   
   
    ostsjj
         INTEGER JOSTEI,JOSTOR,JOSTEL,JOSTTN,JOSTTM,JOSTET,LOSTSA
         PARAMETER(JOSTEI=1,JOSTOR=2,JOSTEL=3,JOSTTN=4,JOSTTM=5,JOSTET=6,
        +          LOSTSA=6)
   
   
    partjj
         INTEGER JPARGN,JPARNA,JPARCO,JPARMA,JPARCH,JPARLT,JPARMW,JPARAN,
        +          LPARTA
         PARAMETER(JPARGN=1,JPARNA=2,JPARCO=5,JPARMA=6,JPARCH=7,JPARLT=8,
        +          JPARMW=9,JPARAN=10,LPARTA=10)
   
   
    pasljj
         INTEGER JPASFK,JPASNH,LPASLA
         PARAMETER(JPASFK=1,JPASNH=2,LPASLA=2)
   
   
    pchyjj
         INTEGER JPCHBH,JPCHKT,JPCHPC,LPCHYA
         PARAMETER(JPCHBH=1,JPCHKT=2,JPCHPC=3,LPCHYA=3)
   
   
    pcobjj
         INTEGER LPCOBA
         PARAMETER(LPCOBA=0)
   
   
    pcoijj
         INTEGER JPCONP,JPCOPH,JPCOTF,JPCONH,JPCOPL,LPCOIA
         PARAMETER(JPCONP=1,JPCOPH=2,JPCOTF=3,JPCONH=4,JPCOPL=5,LPCOIA=5)
   
   
    pcpajj
         INTEGER JPCPNA,JPCPEN,JPCPTE,JPCPFI,JPCPR1,JPCPR2,JPCPPC,LPCPAA
         PARAMETER(JPCPNA=1,JPCPEN=2,JPCPTE=3,JPCPFI=4,JPCPR1=5,JPCPR2=6,
        +          JPCPPC=7,LPCPAA=7)
   
   
    pcrljj
         INTEGER JPCRPC,JPCRPE,JPCRPF,JPCRPH,JPCRPP,LPCRLA
         PARAMETER(JPCRPC=1,JPCRPE=2,JPCRPF=3,JPCRPH=4,JPCRPP=5,LPCRLA=5)
   
   
    pehyjj
         INTEGER JPEHBH,JPEHKT,JPEHPE,LPEHYA
         PARAMETER(JPEHBH=1,JPEHKT=2,JPEHPE=3,LPEHYA=3)
   
   
    peidjj
         INTEGER JPEIIF,JPEIR1,JPEIR2,JPEIR3,JPEIR4,JPEIR6,JPEIR7,JPEIEC,
        +          JPEIET,JPEIP1,JPEIP2,JPEIPF,LPEIDA
         PARAMETER(JPEIIF=1,JPEIR1=2,JPEIR2=3,JPEIR3=4,JPEIR4=5,JPEIR6=6,
        +          JPEIR7=7,JPEIEC=8,JPEIET=9,JPEIP1=10,JPEIP2=11,
        +          JPEIPF=12,LPEIDA=12)
   
   
    pemhjj
         INTEGER JPEMCO,JPEMTN,JPEMSE,LPEMHA
         PARAMETER(JPEMCO=1,JPEMTN=2,JPEMSE=3,LPEMHA=3)
   
   
    pestjj
         INTEGER JPESKS,JPESER,JPESED,JPESET,JPESPE,LPESTA
         PARAMETER(JPESKS=1,JPESER=2,JPESED=3,JPESET=4,JPESPE=5,LPESTA=5)
   
   
    pewijj
         INTEGER JPEWMN,JPEWPD,JPEWSS,JPEWTI,LPEWIA
         PARAMETER(JPEWMN=1,JPEWPD=2,JPEWSS=47,JPEWTI=55,LPEWIA=55)
   
   
    pferjj
         INTEGER JPFEPE,JPFEPF,LPFERA
         PARAMETER(JPFEPE=1,JPFEPF=2,LPFERA=2)
   
   
    pfhrjj
         INTEGER JPFHPF,JPFHPH,LPFHRA
         PARAMETER(JPFHPF=1,JPFHPH=2,LPFHRA=2)
   
   
    pfrfjj
         INTEGER JPFRIR,JPFRTL,JPFRP0,JPFRD0,JPFRZ0,JPFRAL,JPFREO,JPFREM,
        +          JPFRC2,JPFRNO,LPFRFA
         PARAMETER(JPFRIR=1,JPFRTL=2,JPFRP0=3,JPFRD0=4,JPFRZ0=5,JPFRAL=6,
        +          JPFREO=7,JPFREM=13,JPFRC2=28,JPFRNO=29,LPFRFA=29)
   
   
    pfrtjj
         INTEGER JPFRNV,JPFRNI,JPFRNE,JPFRNT,JPFRNR,LPFRTA
         PARAMETER(JPFRNV=1,JPFRNI=2,JPFRNE=3,JPFRNT=4,JPFRNR=5,LPFRTA=5)
   
   
    pgidjj
         INTEGER JPGIIF,JPGIDE,JPGICM,JPGIM1,JPGIM2,JPGIM3,JPGICE,JPGITH,
        +          JPGIPH,JPGIPE,LPGIDA
         PARAMETER(JPGIIF=1,JPGIDE=2,JPGICM=3,JPGIM1=4,JPGIM2=5,JPGIM3=6,
        +          JPGICE=7,JPGITH=8,JPGIPH=9,JPGIPE=10,LPGIDA=10)
   
   
    pherjj
         INTEGER JPHEPE,JPHEPH,LPHERA
         PARAMETER(JPHEPE=1,JPHEPH=2,LPHERA=2)
   
   
    phhyjj
         INTEGER JPHHBH,JPHHKT,JPHHPH,LPHHYA
         PARAMETER(JPHHBH=1,JPHHKT=2,JPHHPH=3,LPHHYA=3)
   
   
    phmhjj
         INTEGER JPHMCO,JPHMTN,LPHMHA
         PARAMETER(JPHMCO=1,JPHMTN=2,LPHMHA=2)
   
   
    phstjj
         INTEGER JPHSTI,JPHSPI,JPHSCE,JPHSPH,LPHSTA
         PARAMETER(JPHSTI=1,JPHSPI=2,JPHSCE=3,JPHSPH=4,LPHSTA=4)
   
   
    pidijj
         INTEGER JPIDPD,LPIDIA
         PARAMETER(JPIDPD=1,LPIDIA=1)
   
   
    pitmjj
         INTEGER JPITNA,LPITMA
         PARAMETER(JPITNA=1,LPITMA=1)
   
   
    plidjj
         INTEGER JPLIIF,JPLIEC,JPLITC,JPLIPC,JPLIE4,JPLIE1,JPLIE2,JPLIR1,
        +          JPLIR2,JPLIXX,JPLIYY,JPLIXY,JPLIDA,JPLINT,JPLIPE,JPLIPL,
        +          JPLIST,LPLIDA
         PARAMETER(JPLIIF=1,JPLIEC=2,JPLITC=3,JPLIPC=4,JPLIE4=5,JPLIE1=6,
        +          JPLIE2=7,JPLIR1=8,JPLIR2=9,JPLIXX=10,JPLIYY=11,
        +          JPLIXY=12,JPLIDA=13,JPLINT=17,JPLIPE=18,JPLIPL=19,
        +          JPLIST=20,LPLIDA=20)
   
   
    pljtjj
         INTEGER JPLJPX,JPLJPY,JPLJPZ,JPLJPE,JPLJNO,LPLJTA
         PARAMETER(JPLJPX=1,JPLJPY=2,JPLJPZ=3,JPLJPE=4,JPLJNO=5,LPLJTA=5)
   
   
    plpdjj
         INTEGER JPLPAD,JPLPEN,LPLPDA
         PARAMETER(JPLPAD=1,JPLPEN=2,LPLPDA=2)
   
   
    plsdjj
         INTEGER JPLSAD,JPLSE1,JPLSE2,JPLSE3,JPLSPE,LPLSDA
         PARAMETER(JPLSAD=1,JPLSE1=2,JPLSE2=3,JPLSE3=4,JPLSPE=5,LPLSDA=5)
   
   
    pmscjj
         INTEGER JPMSSA,LPMSCA
         PARAMETER(JPMSSA=1,LPMSCA=1)
   
   
    pmskjj
         INTEGER JPMSKT,JPMSEM,JPMSF1,JPMSF3,JPMST1,JPMSP1,JPMST3,JPMSP3,
        +          JPMSTH,JPMSPH,JPMSPF,LPMSKA
         PARAMETER(JPMSKT=1,JPMSEM=2,JPMSF1=3,JPMSF3=4,JPMST1=5,JPMSP1=6,
        +          JPMST3=7,JPMSP3=8,JPMSTH=9,JPMSPH=10,JPMSPF=11,
        +          LPMSKA=11)
   
   
    pneujj
         INTEGER JPNEPX,JPNEPY,JPNEPZ,JPNEPM,JPNEMS,JPNEEM,LPNEUA
         PARAMETER(JPNEPX=1,JPNEPY=2,JPNEPZ=3,JPNEPM=4,JPNEMS=10,JPNEEM=11,
        +          LPNEUA=11)
   
   
    ppdsjj
         INTEGER JPPDNL,JPPDFL,JPPDMD,JPPDPP,LPPDSA
         PARAMETER(JPPDNL=1,JPPDFL=2,JPPDMD=3,JPPDPP=4,LPPDSA=4)
   
   
    ppobjj
         INTEGER JPPODI,JPPODE,JPPOC1,JPPOC2,JPPOIP,JPPOFP,JPPOLP,JPPOMD,
        +          JPPOPD,LPPOBA
         PARAMETER(JPPODI=1,JPPODE=2,JPPOC1=3,JPPOC2=4,JPPOIP=5,JPPOFP=6,
        +          JPPOLP=7,JPPOMD=8,JPPOPD=9,LPPOBA=9)
   
   
    pprljj
         INTEGER JPPRPC,JPPRPE,JPPRPH,JPPRPP,LPPRLA
         PARAMETER(JPPRPC=1,JPPRPE=2,JPPRPH=3,JPPRPP=4,LPPRLA=4)
   
   
    prpwjj
         INTEGER JPRPPN,JPRPMR,JPRPMN,JPRPF1,JPRPF2,JPRPER,LPRPWA
         PARAMETER(JPRPPN=1,JPRPMR=2,JPRPMN=3,JPRPF1=4,JPRPF2=5,JPRPER=6,
        +          LPRPWA=6)
   
   
    prtmjj
         INTEGER JPRTMA,JPRTCT,LPRTMA
         PARAMETER(JPRTMA=1,JPRTCT=2,LPRTMA=2)
   
   
    pscojj
         INTEGER JPSCSI,JPSCLA,JPSCSC,JPSCTT,LPSCOA
         PARAMETER(JPSCSI=1,JPSCLA=2,JPSCSC=3,JPSCTT=4,LPSCOA=5)
   
   
    pspojj
         INTEGER JPSPTC,LPSPOA
         PARAMETER(JPSPTC=1,LPSPOA=9)
   
   
    pt2xjj
         INTEGER JPT2SL,JPT2TM,JPT2UL,JPT2NS,JPT2AD,JPT2T1,JPT2T2,LPT2XA
         PARAMETER(JPT2SL=1,JPT2TM=2,JPT2UL=3,JPT2NS=4,JPT2AD=5,JPT2T1=6,
        +          JPT2T2=7,LPT2XA=7)
   
   
    ptbcjj
         INTEGER JPTBSL,JPTBSR,JPTBPS,JPTBZV,JPTBNP,JPTBNB,LPTBCA
         PARAMETER(JPTBSL=1,JPTBSR=2,JPTBPS=3,JPTBZV=4,JPTBNP=5,JPTBNB=6,
        +          LPTBCA=6)
   
   
    ptcojj
         INTEGER JPTCSL,JPTCSR,JPTCPS,JPTCZV,JPTCSP,JPTCSZ,JPTCDR,LPTCOA
         PARAMETER(JPTCSL=1,JPTCSR=2,JPTCPS=3,JPTCZV=4,JPTCSP=5,JPTCSZ=6,
        +          JPTCDR=7,LPTCOA=7)
   
   
    ptexjj
         INTEGER JPTESL,JPTETM,JPTEUL,JPTENS,JPTEAD,JPTETN,JPTESF,LPTEXA
         PARAMETER(JPTESL=1,JPTETM=2,JPTEUL=3,JPTENS=4,JPTEAD=5,JPTETN=6,
        +          JPTESF=7,LPTEXA=7)
   
   
    pthrjj
         INTEGER JPTHTH,JPTHPX,JPTHPY,JPTHPZ,JPTHPE,LPTHRA
         PARAMETER(JPTHTH=1,JPTHPX=2,JPTHPY=3,JPTHPZ=4,JPTHPE=5,LPTHRA=5)
   
   
    ptmajj
         INTEGER JPTMNM,JPTMNA,LPTMAA
         PARAMETER(JPTMNM=1,JPTMNA=2,LPTMAA=2)
   
   
    ptmljj
         INTEGER JPTMMT,JPTMNH,LPTMLA
         PARAMETER(JPTMMT=1,JPTMNH=2,LPTMLA=2)
   
   
    ptncjj
         INTEGER JPTNSL,JPTNSR,JPTNRP,JPTNZV,JPTNSP,JPTNSZ,LPTNCA
         PARAMETER(JPTNSL=1,JPTNSR=2,JPTNRP=3,JPTNZV=4,JPTNSP=5,JPTNSZ=6,
        +          LPTNCA=6)
   
   
    ptstjj
         INTEGER JPTSSP,JPTSTW,JPTSTP,JPTSNT,JPTSTE,LPTSTA
         PARAMETER(JPTSSP=1,JPTSTW=2,JPTSTP=3,JPTSNT=4,JPTSTE=5,LPTSTA=5)
   
   
    pyerjj
         INTEGER JPYETY,JPYEVX,JPYEVY,JPYEVZ,JPYEVM,JPYEC2,JPYEDF,LPYERA
         PARAMETER(JPYETY=1,JPYEVX=2,JPYEVY=3,JPYEVZ=4,JPYEVM=5,JPYEC2=11,
        +          JPYEDF=12,LPYERA=12)
   
   
    pyfrjj
         INTEGER JPYFTN,JPYFVN,LPYFRA
         PARAMETER(JPYFTN=1,JPYFVN=2,LPYFRA=2)
   
   
    pynejj
         INTEGER JPYNTN,JPYNVN,LPYNEA
         PARAMETER(JPYNTN=1,JPYNVN=2,LPYNEA=2)
   
   
    revhjj
         INTEGER JREVDS,JREVFE,JREVNE,JREVSB,JREVTI,JREVRB,JREVEC,LREVHA
         PARAMETER(JREVDS=1,JREVFE=2,JREVNE=4,JREVSB=6,JREVTI=7,JREVRB=8,
        +          JREVEC=10,LREVHA=10)
   
   
    rhahjj
         INTEGER JRHAPN,JRHAPD,JRHAPH,JRHAPV,JRHAAV,JRHADV,JRHADD,JRHANI,
        +          JRHANO,JRHACV,JRHANU,LRHAHA
         PARAMETER(JRHAPN=1,JRHAPD=3,JRHAPH=4,JRHAPV=5,JRHAAV=6,JRHADV=7,
        +          JRHADD=8,JRHANI=9,JRHANO=10,JRHACV=11,JRHANU=12,
        +          LRHAHA=12)
   
   
    rtlojj
         INTEGER JRTLPA,JRTLET,JRTLTN,JRTLTM,JRTLT1,JRTLT2,JRTLT3,JRTLR1,
        +          JRTLR2,JRTLEL,JRTLCT,JRTLCH,LRTLOA
         PARAMETER(JRTLPA=1,JRTLET=2,JRTLTN=3,JRTLTM=4,JRTLT1=5,JRTLT2=6,
        +          JRTLT3=7,JRTLR1=8,JRTLR2=9,JRTLEL=10,JRTLCT=11,
        +          JRTLCH=12,LRTLOA=12)
   
   
    runhjj
         INTEGER JRUNEN,JRUNRN,JRUNRT,JRUNSD,JRUNST,JRUNTT,JRUNRC,LRUNHA
         PARAMETER(JRUNEN=1,JRUNRN=2,JRUNRT=3,JRUNSD=4,JRUNST=5,JRUNTT=6,
        +          JRUNRC=8,LRUNHA=9)
   
   
    sftrjj
         INTEGER JSFTNF,JSFTC2,JSFTQF,JSFTTH,JSFTPH,JSFTX0,JSFTY0,JSFTCM,
        +          JSFTLI,LSFTRA
         PARAMETER(JSFTNF=1,JSFTC2=2,JSFTQF=3,JSFTTH=4,JSFTPH=5,JSFTX0=6,
        +          JSFTY0=7,JSFTCM=8,JSFTLI=18,LSFTRA=18)
   
   
    tc2xjj
         INTEGER JTC2ID,JTC2VR,JTC2NR,JTC2SN,JTC2AP,JTC2RP,JTC2SL,LTC2XA
         PARAMETER(JTC2ID=1,JTC2VR=2,JTC2NR=4,JTC2SN=5,JTC2AP=41,JTC2RP=42,
        +          JTC2SL=46,LTC2XA=46)
   
   
    tc3xjj
         INTEGER JTC3ID,JTC3VR,JTC3NR,JTC3PR,LTC3XA
         PARAMETER(JTC3ID=1,JTC3VR=2,JTC3NR=4,JTC3PR=5,LTC3XA=11)
   
   
    tc4xjj
         INTEGER JTC4ID,JTC4VR,JTC4MN,JTC4MX,JTC4RP,JTC4IP,LTC4XA
         PARAMETER(JTC4ID=1,JTC4VR=2,JTC4MN=4,JTC4MX=5,JTC4RP=6,JTC4IP=13,
        +          LTC4XA=22)
   
   
    tgmajj
         INTEGER JTGMNM,JTGMOM,JTGMNC,JTGMNA,LTGMAA
         PARAMETER(JTGMNM=1,JTGMOM=2,JTGMNC=3,JTGMNA=4,LTGMAA=4)
   
   
    tmtljj
         INTEGER JTMTMT,JTMTNH,JTMTCS,LTMTLA
         PARAMETER(JTMTMT=1,JTMTNH=2,JTMTCS=3,LTMTLA=3)
   
   
    vcomjj
         INTEGER JVCOCM,LVCOMA
         PARAMETER(JVCOCM=1,LVCOMA=1)
   
   
    vcpljj
         INTEGER JVCPXB,JVCPNX,JVCPZB,JVCPNZ,JVCPC2,LVCPLA
         PARAMETER(JVCPXB=1,JVCPNX=2,JVCPZB=3,JVCPNZ=4,JVCPC2=5,LVCPLA=5)
   
   
    vdcojj
         INTEGER JVDCWI,JVDCR0,JVDCPH,JVDCZ0,JVDCSR,JVDCSZ,JVDCQF,JVDCTN,
        +          LVDCOA
         PARAMETER(JVDCWI=1,JVDCR0=2,JVDCPH=3,JVDCZ0=4,JVDCSR=5,JVDCSZ=6,
        +          JVDCQF=7,JVDCTN=8,LVDCOA=8)
   
   
    vdhtjj
         INTEGER JVDHTN,JVDHLN,JVDHPN,JVDHXE,JVDHYE,JVDHZE,JVDHXL,JVDHYL,
        +          JVDHZL,JVDHER,LVDHTA
         PARAMETER(JVDHTN=1,JVDHLN=2,JVDHPN=3,JVDHXE=4,JVDHYE=5,JVDHZE=6,
        +          JVDHXL=7,JVDHYL=8,JVDHZL=9,JVDHER=10,LVDHTA=10)
   
   
    vdxyjj
         INTEGER JVDXXC,JVDXYC,JVDXUC,JVDXSX,JVDXSY,JVDXSU,JVDXPH,JVDXQF,
        +          JVDXNA,JVDXIP,JVDXIW,JVDXIH,LVDXYA
         PARAMETER(JVDXXC=1,JVDXYC=2,JVDXUC=3,JVDXSX=4,JVDXSY=5,JVDXSU=6,
        +          JVDXPH=7,JVDXQF=8,JVDXNA=9,JVDXIP=10,JVDXIW=11,
        +          JVDXIH=12,LVDXYA=12)
   
   
    vdztjj
         INTEGER JVDZZC,JVDZWC,JVDZSZ,JVDZSW,JVDZPH,JVDZQF,JVDZNA,JVDZIP,
        +          JVDZIW,JVDZIH,LVDZTA
         PARAMETER(JVDZZC=1,JVDZWC=2,JVDZSZ=3,JVDZSW=4,JVDZPH=5,JVDZQF=6,
        +          JVDZNA=7,JVDZIP=8,JVDZIW=9,JVDZIH=10,LVDZTA=10)
   
   
    vertjj
         INTEGER JVERVX,JVERVY,JVERVZ,JVERTI,JVERIT,JVEROT,LVERTA
         PARAMETER(JVERVX=1,JVERVY=2,JVERVZ=3,JVERTI=4,JVERIT=5,JVEROT=6,
        +          LVERTA=6)
   
   
    vfhljj
         INTEGER JVFHHA,LVFHLA
         PARAMETER(JVFHHA=1,LVFHLA=1)
   
   
    vflgjj
         INTEGER JVFLFG,LVFLGA
         PARAMETER(JVFLFG=1,LVFLGA=1)
   
   
    vfphjj
         INTEGER JVFPPH,LVFPHA
         PARAMETER(JVFPPH=1,LVFPHA=1)
   
   
    vhlsjj
         INTEGER JVHLHC,LVHLSA
         PARAMETER(JVHLHC=1,LVHLSA=1)
   
   
    vplhjj
         INTEGER JVPLPC,LVPLHA
         PARAMETER(JVPLPC=1,LVPLHA=1)
   
   
    x1adjj
         INTEGER JX1AIT,JX1AAV,LX1ADA
         PARAMETER(JX1AIT=1,JX1AAV=2,LX1ADA=37)
   
   
    x1scjj
         INTEGER JX1SIT,JX1STS,JX1SSV,LX1SCA
         PARAMETER(JX1SIT=1,JX1STS=2,JX1SSV=3,LX1SCA=32)
   
   
    x2dfjj
         INTEGER JX2DDA,LX2DFA
         PARAMETER(JX2DDA=1,LX2DFA=1)
   
   
    x3ecjj
         INTEGER JX3EEL,JX3EEH,JX3ESL,JX3ESH,JX3ECL,JX3ELX,JX3ELY,JX3ELZ,
        +          JX3ECH,JX3EHX,JX3EHY,JX3EHZ,LX3ECA
         PARAMETER(JX3EEL=1,JX3EEH=2,JX3ESL=3,JX3ESH=6,JX3ECL=9,JX3ELX=12,
        +          JX3ELY=15,JX3ELZ=18,JX3ECH=21,JX3EHX=24,JX3EHY=27,
        +          JX3EHZ=30,LX3ECA=32)
   
   
    x3ewjj
         INTEGER JX3EES,JX3EEO,JX3EEE,JX3EEC,JX3EMP,JX3EFP,LX3EWA
         PARAMETER(JX3EES=1,JX3EEO=4,JX3EEE=5,JX3EEC=6,JX3EMP=7,JX3EFP=8,
        +          LX3EWA=8)
   
   
    x3hcjj
         INTEGER JX3HNT,JX3HTT,JX3HEC,JX3HET,JX3HEF,JX3HEB,JX3HTC,JX3HTF,
        +          JX3HTB,JX3HPC,JX3HPF,JX3HPB,JX3HFT,LX3HCA
         PARAMETER(JX3HNT=1,JX3HTT=2,JX3HEC=3,JX3HET=4,JX3HEF=5,JX3HEB=6,
        +          JX3HTC=7,JX3HTF=8,JX3HTB=9,JX3HPC=10,JX3HPF=11,
        +          JX3HPB=12,JX3HFT=13,LX3HCA=13)
   
   
    x3itjj
         INTEGER JX3IMN,JX3ITB,JX3IEL,JX3ICH,JX3IDF,JX3IRA,JX3IX0,JX3IY0,
        +          JX3ID0,JX3IRT,JX3IPT,JX3IAT,JX3IDP,LX3ITA
         PARAMETER(JX3IMN=1,JX3ITB=2,JX3IEL=3,JX3ICH=4,JX3IDF=5,JX3IRA=6,
        +          JX3IX0=7,JX3IY0=8,JX3ID0=9,JX3IRT=10,JX3IPT=11,
        +          JX3IAT=12,JX3IDP=13,LX3ITA=13)
   
   
    x3l2jj
         INTEGER JX3LZ0,JX3LTL,JX3LEV,JX3LCH,JX3LNF,LX3L2A
         PARAMETER(JX3LZ0=1,JX3LTL=2,JX3LEV=3,JX3LCH=6,JX3LNF=7,LX3L2A=7)
   
   
    x3lujj
         INTEGER JX3LMN,JX3LEC,JX3LTC,JX3LPC,JX3LCW,JX3LNT,JX3LEF,JX3LEM,
        +          JX3LEB,JX3LRE,LX3LUA
         PARAMETER(JX3LMN=1,JX3LEC=2,JX3LTC=3,JX3LPC=4,JX3LCW=5,JX3LNT=6,
        +          JX3LEF=7,JX3LEM=8,JX3LEB=9,JX3LRE=10,LX3LUA=10)
   
   
    x3tmjj
         INTEGER JX3TTS,JX3TTT,LX3TMA
         PARAMETER(JX3TTS=1,JX3TTT=2,LX3TMA=33)
   
   
    x3tojj
         INTEGER JX3TH1,JX3TH2,JX3TH3,JX3TH4,JX3TH5,JX3TH6,JX3TE1,JX3TE2,
        +          JX3TE3,JX3TE4,JX3TE5,JX3TE6,JX3TE7,JX3TE8,JX3TW1,JX3TW2,
        +          JX3TW3,JX3TW4,JX3TW5,JX3TW6,JX3TL1,JX3TL2,JX3TL3,JX3TL4,
        +          JX3TL5,JX3TL6,JX3TL7,JX3TL8,LX3TOA
         PARAMETER(JX3TH1=1,JX3TH2=4,JX3TH3=7,JX3TH4=10,JX3TH5=13,
        +          JX3TH6=16,JX3TE1=19,JX3TE2=22,JX3TE3=25,JX3TE4=28,
        +          JX3TE5=31,JX3TE6=34,JX3TE7=37,JX3TE8=40,JX3TW1=43,
        +          JX3TW2=46,JX3TW3=49,JX3TW4=52,JX3TW5=55,JX3TW6=58,
        +          JX3TL1=61,JX3TL2=63,JX3TL3=65,JX3TL4=67,JX3TL5=69,
        +          JX3TL6=71,JX3TL7=73,JX3TL8=75,LX3TOA=76)
   
   
    x3tpjj
         INTEGER JX3TTB,JX3TEL,JX3TNH,JX3TBL,JX3TIR,JX3TOR,JX3TPR,JX3TPI,
        +          JX3TTI,JX3TZI,JX3TPO,JX3TTO,JX3TZO,JX3TAT,LX3TPA
         PARAMETER(JX3TTB=1,JX3TEL=2,JX3TNH=3,JX3TBL=4,JX3TIR=5,JX3TOR=6,
        +          JX3TPR=7,JX3TPI=8,JX3TTI=9,JX3TZI=10,JX3TPO=11,
        +          JX3TTO=12,JX3TZO=13,JX3TAT=14,LX3TPA=14)
   
   
    x3x3jj
         INTEGER JX3XTR,JX3XST,JX3XFT,LX3X3A
         PARAMETER(JX3XTR=1,JX3XST=2,JX3XFT=3,LX3X3A=3)
   
   
    xtcnjj
         INTEGER JXTCTT,JXTCGC,JXTCLL,JXTCBN,JXTCCL,JXTCTR,LXTCNA
         PARAMETER(JXTCTT=1,JXTCGC=3,JXTCLL=4,JXTCBN=5,JXTCCL=6,JXTCTR=7,
        +          LXTCNA=16)
   
   
    xtebjj
         INTEGER JXTET1,JXTET2,JXTEL2,JXTEHT,JXTEHW,JXTELW,JXTEEW,JXTELT,
        +          JXTETE,JXTEIT,JXTETP,LXTEBA
         PARAMETER(JXTET1=1,JXTET2=2,JXTEL2=3,JXTEHT=4,JXTEHW=16,JXTELW=28,
        +          JXTEEW=40,JXTELT=52,JXTETE=56,JXTEIT=58,JXTETP=62,
        +          LXTEBA=65)
   
   
    xtbnjj
         INTEGER JXTBID,JXTBVR,JXTBTN,JXTBTB,JXTBBM,JXTBBN,JXTBAD,JXTBL1,
        +          JXTBL2,LXTBNA
         PARAMETER(JXTBID=1,JXTBVR=2,JXTBTN=4,JXTBTB=5,JXTBBM=6,JXTBBN=8,
        +          JXTBAD=18,JXTBL1=23,JXTBL2=24,LXTBNA=24)
   
   
    xtopjj
         INTEGER JXTOID,JXTOVR,JXTONA,JXTOTR,JXTOGS,JXTODS,JXTOTT,LXTOPA
         PARAMETER(JXTOID=1,JXTOVR=2,JXTONA=4,JXTOTR=6,JXTOGS=7,JXTODS=8,
        +          JXTOTT=16,LXTOPA=16)
   
   
    xtrbjj
         INTEGER JXTRRP,JXTRRN,LXTRBA
         PARAMETER(JXTRRP=1,JXTRRN=4,LXTRBA=4)
   
   
    zpfrjj
         INTEGER JZPFC1,JZPFC2,LZPFRA
         PARAMETER(JZPFC1=1,JZPFC2=2,LZPFRA=2)
   
   
         REAL OLDEN(500)
         INTEGER VERSION, DATABASE
         LOGICAL FIRST / .TRUE. /
         CHARACTER*4 PROG, CHAINT
         EXTERNAL QCORFIC
   
    bmacro
       set of intrinsic functions to handle BOS banks
   - # of words/row in bank with index ID
         LCOLS(ID) = IW(ID+1)
   - # of rows in bank with index ID
         LROWS(ID) = IW(ID+2)
   - index of next row in the bank with index ID
         KNEXT(ID) = ID + LMHLEN + IW(ID+1)*IW(ID+2)
   - index of row # NRBOS in the bank with index ID
         KROW(ID,NRBOS) = ID + LMHLEN + IW(ID+1)*(NRBOS-1)
   - # of free words in the bank with index ID
         LFRWRD(ID) = ID + IW(ID) - KNEXT(ID)
   - # of free rows in the bank with index ID
         LFRROW(ID) = LFRWRD(ID) / LCOLS(ID)
   - Lth integer element of the NRBOSth row of the bank with index ID
         ITABL(ID,NRBOS,L) = IW(ID+LMHLEN+(NRBOS-1)*IW(ID+1)+L)
   - Lth real element of the NRBOSth row of the bank with index ID
         RTABL(ID,NRBOS,L) = RW(ID+LMHLEN+(NRBOS-1)*IW(ID+1)+L)
   
       Runs only on POTs and DSTs (data)
         IF (XMINI.OR.XMCEV) RETURN
       Make the correction only if the JULIA version of the
       last reprocessing is 306 or older (for the "online
       bug") or if the database version is 246 or older (for
       the "offline" bug)
         JRHAH = IW(NAMIND('RHAH'))
         IF (JRHAH.GT.0) THEN
            DO I = 1, LROWS(JRHAH)
               PROG = CHAINT(ITABL(JRHAH,I,1))
               IF (PROG.EQ.'JULI') THEN
                  ICTRL = 0
                  VERSION = ITABL(JRHAH,I,5)
                  DATABASE = ITABL(JRHAH,I,7)
                  IF (VERSION.LT.307) THEN
                     ICTRL = 1
                  ELSEIF (DATABASE.LT.247) THEN
                     ICTRL = 2
                  ELSE
                     RETURN
                  ENDIF
               ENDIF
            ENDDO
         ELSE
            CALL QWMESS('++++++ Bank RHAH not found: '
        &        'as default, the correction for the HCAL '
        &        'online bug is NOT applied')
         ENDIF
    10   IF (FIRST) THEN
            IND = MDARD(IW,KUCONS,'H1EC',2)
            IND = MDARD(IW,KUCONS,'H2EC',2)
            IND = MDARD(IW,KUCONS,'H3EC',2)
            IND = MDARD(IW,KUCONS,'H4EC',2)
            FIRST = .FALSE.
         ENDIF
         CALL VZERO(OLDEN,100)
   - PHST
         JPHST = NLINK('PHST',0)
         IF (JPHST.NE.0) THEN
            NCOLS = IW(JPHST+1)
            DO I = 1, LROWS(JPHST)
               ITH = ITABL(JPHST,I,1)
               IPH = ITABL(JPHST,I,2)
               ENE = RTABL(JPHST,I,3)
               RW(JPHST+2+(I-1)*NCOLS+3) = QCORFIC(ENE,ITH,IPH,ICTRL)
            ENDDO
         ENDIF
   - PHCO
         JPHCO = NLINK('PHCO',0)
         IF(JPHCO.NE.0) THEN
            NCOLS = IW(JPHCO+1)
            IF (LROWS(JPHCO).GT.500) THEN
               WRITE(IW(6),*)'+++++ TOO MANY HCAL CLUSTERS!'
               RETURN
            ENDIF
            DO I = 1, LROWS(JPHCO)
               OLDEN(I) = RTABL(JPHCO,I,4)
               ENER = 0.
               ENEC = 0.
               DO J = 1, LROWS(JPHST)
                  IF (ITABL(JPHST,J,4).EQ.I) THEN
                     ITH = ITABL(JPHST,J,1)
                     IPH = ITABL(JPHST,J,2)
                     ENE = RTABL(JPHST,J,3)
                     ENER = ENER + ENE / COFLIG(ITH,IPH)
                     ENEC = ENEC + ENE
                  ENDIF
               ENDDO
               RW(JPHCO+2+(I-1)*NCOLS+1) = ENER
               RW(JPHCO+2+(I-1)*NCOLS+4) = ENEC
            ENDDO
         ENDIF
   - HMAD
         JHMAD = NLINK('HMAD',0)
         IF (JHMAD.NE.0) THEN
            NCOLS = IW(JHMAD+1)
            DO I = 1, LROWS(JHMAD)
               ENE = RTABL(JHMAD,I,6)
               DO J = 1, LROWS(JPHCO)
                  IF ((ABS(ENE-OLDEN(J))).LE.1.E-4)
        &           RW(JHMAD+2+(I-1)*NCOLS+6) = RTABL(JPHCO,J,4)
               ENDDO
            ENDDO
         ENDIF
         RETURN
         END
         REAL FUNCTION COFLIG(IBTH0,IBPH0)
   
   -------------------- /QCDE/ --- COMMONs, DIMENSIONs, etc. ------------
   
    of QCDESH ----------------------- Description in QDATA ---------
         PARAMETER (KCQDET=34, KCQFPA=8, KCQPAR=10, KCQVEC=73, KCQVRT=30,
        & KHE=1, KHMU=2, KHPI=3, KHK=4, KHP=5, KHPHOT=1, KHNHAD=2,
        & KMONTE=-2, KRECO=-1, KLOCKM=14, KSOVT=1, KSCHT=2, KSIST=3,
        & KSAST=4, KSEHT=5, KSV0T=6, KSDCT=7, KSEFT=8, KSNET=9, KSGAT=10,
        & KSJET=11, KSMCT=12, KSREV=13,
        & KSMCV=14, KUNDEF=-12344321, QQPI=3.141593, QQE=2.718282,
        & QQ2PI=QQPI*2., QQPIH=QQPI/2., QQRADP=180./QQPI, QQC=2.997925E10,
        & QQH=6.582173E-25, QQHC=QQH*QQC, QQIRP=.00029979)
         CHARACTER CQDATE*8, CQDWRK*80, CQFHIS*80, CQFOUT*80, CQFWRK*80,
        & CQHTIT*80, CQSEC*3, CQTIME*8, CQUNPK*30, CQVERS*6, CQRLST*800,
        & CQELST*800
         COMMON /QCDEC/ CQDATE, CQDWRK, CQFHIS, CQFOUT, CQFWRK, CQHTIT,
        & CQSEC(14), CQTIME, CQUNPK, CQVERS, CQRLST, CQELST
         COMMON /QCDE/ QELEP, QMFLD ,QMFLDC, QTIME, QTIMEI, QTIMEL,
        & QTIMES, QTIMET, QDHEEC, QDHEEL, QDHEPF, QDHETH, QDHEPH, QDHEEF,
        & QDHEET, QDHET1, QDHEP1, QDHET2, QDHEP2, QDHEE1, QDHEE2, QDHEE3,
        & QKEVRN, QKEVWT, QVXNOM, QVYNOM, QVZNOM, QVXNSG, QVYNSG, QVZNSG,
        & QINLUM, QRINLN, QRINLU, QDBOFS, QEECWI(36), QVXBOM, QVYBOM,
        & QSILUM, QRSLLU, QRSLBK, QRSLEW , QVTXBP(3), QVTEBP(3), QVTSBP(3)
         COMMON /QCDE/  KFOVT, KLOVT, KNOVT, KFCHT, KLCHT, KNCHT, KFIST,
        & KLIST, KNIST, KFAST, KLAST, KNAST, KFEHT, KLEHT, KNEHT, KFV0T,
        & KLV0T, KNV0T, KFDCT, KLDCT, KNDCT, KFEFT, KLEFT, KNEFT, KFNET,
        & KLNET, KNNET, KFGAT, KLGAT, KNGAT, KFJET, KLJET, KNJET, KFMCT,
        & KLMCT, KNMCT, KFREV, KLREV, KNREV, KFMCV, KLMCV, KNMCV, KLUST,
        & KLUSV, KFFRT, KLFRT, KFFRV, KLFRV, KNRET, KNCOT, KFFRD,
        & KLFJET,KLLJET,KLNJET
         COMMON /QCDE/ KBIT(32), KCLACO(KCQFPA), KCLAFR(KCQFPA), KCLARM
        & (KCQFPA), KDEBUG, KEVT, KEXP, KFFILL, KFEOUT, KJOPTN(2,2),
        & KLEOUT, KLROUT, KLOCK0(KLOCKM,2), KLOCK1(KLOCKM,2), KLOCK2(
        & KLOCKM,2), KMATIX(6,6), KMQFPA, KNEFIL, KNEOUT, KNEVT, KNPAST,
        & KNQDET, KNQFPA, KNQLIN, KNQMTX, KNQPAR, KNQPST, KNREIN, KNREOU,
        & KOQDET, KOQFPA, KOQLIN, KOQMTL, KOQMTS, KOQPAR, KOQPBT, KOQPLI,
        & KOQTRA, KOQVEC, KOQVRT, KQPAR, KQVEC, KQVRT, KQWRK, KQZER, KRUN,
        & KSTATU, KTDROP, KUCARD, KUCONS, KUHIST, KUINPU, KUOUTP, KUPRNT,
        & KUPTER, KDEBU1, KDEBU2, KNWRLM, KEFOPT, KUEDIN, KUEDOU, KURTOX,
        & KUCAR2, KNHDRN, KNBHAB, KSBHAB, KRSLLQ, KRSLNB
         COMMON /QCDE/ INDATA
         COMMON /QCDE/ KRINNE, KRINNF, KRINDC, KRINDQ, KRINNZ, KRINNB,
        & KRINBM, KRINFR, KRINLR, KRINLF
         COMMON /QCDE/ KEVERT, KEVEDA, KEVETI, KEVEMI(4), KEVETY, KEVEES,
        & KDHEFP, KDHENP, KDHENM, KKEVNT, KKEVNV, KKEVID, KDHENX, KDHENV,
        & KDHENJ, KREVDS, KXTET1, KXTET2, KXTEL2, KXTCGC, KXTCLL, KXTCBN,
        & KXTCCL, KXTCHV, KXTCEN, KCLASW, KERBOM, KBPSTA
         DIMENSION KLOCUS(3,14)
         EQUIVALENCE (KLOCUS(1,1),KFOVT), (KFOVT,KFRET), (KLIST,KLRET),
        & (KFIST,KFCOT), (KLAST,KLCOT)
         COMMON /QCDE/ XCOPYJ, XFLIAC, XHISTO, XLREV(2), XLREV2(2), XMCEV,
        & XMINI, XSYNTX, XWREVT, XWRRUN, XFILMC, XFILCH, XFILV0, XFILCO,
        & XFILEF, XFILPC, XFILGA, XFILJE,
        & XPRHIS, XFILL, XVITC, XVTPC, XVECAL, XVLCAL, XVTPCD,
        & XVSATR, XVHCAL, XHVTRG, XSREC, XWMINI, XIOKLU, XIOKSI, XFRF2,
        & XNSEQ, XVDOK, XFRF0, XFMUID, XFILEM, XWNANO, XROKSI, XGETBP,
        & XJTHRU
         LOGICAL XCOPYJ, XFLIAC, XHISTO, XLREV, XLREV2, XMCEV, XMINI,
        & XSYNTX, XWREVT, XWRRUN, XFILMC, XFILCH, XFILV0, XFILCO, XFILEF,
        & XFILPC, XPRHIS, XFILL, XVITC, XVTPC, XVECAL, XVLCAL, XVTPCD,
        & XVSATR, XVHCAL, XHVTRG, XSREC, XWMINI, XIOKLU, XFRF2, XFILJE,
        & XNSEQ, XFILGA, XVDOK, XFRF0, XFMUID, XFILEM, XWNANO, XIOKSI,
        & XROKSI, XGETBP, XJTHRU
   
   -------------------- /NANCOM/ --- NanoDst steering -------------------
    XNANO   .TRUE. if input is a NanoDst (in NANO or EPIO format, depending
                      XNANOR)
   
         LOGICAL XNANO
         COMMON /NANCOM/XNANO
   
   
    bcs
         INTEGER LMHLEN, LMHCOL, LMHROW
         PARAMETER (LMHLEN=2, LMHCOL=1, LMHROW=2)
         COMMON /BCS/   IW(1000)
         INTEGER IW
         REAL RW(1000)
         EQUIVALENCE (RW(1),IW(1))
   
   
   ------------------ /QCNAMI/ --- name indices -------------------------
         COMMON /QCNAMI/ NAAFID,NAAJOB,NAASEV,NABCNT,NABHIT,NABOMB,
        1 NABOME,NABOMP,NABOMR,NABPTR,NADCAL,NADCRL,NADECO,NADEID,NADENF,
        2 NADEVT,NADEWI,NADFMC,NADFOT,NADGAM,NADHCO,NADHEA,NADHRL,NADJET,
        3 NADMID,NADMJT,NADMUO,NADNEU,NADPOB,NADRES,NADTBP,NADTMC,NADTRA,
        4 NADVER,NADVMC,NAECRQ,NAECTE,NAEGID,NAEGPC,NAEIDT,NAEJET,NAERRF,
        5 NAETDI,NAETKC,NAEVEH,NAEWHE,NAFICL,NAFKIN,NAFPOI,NAFPOL,NAFRFT,
        6 NAFRID,NAFRTL,NAFSTR,NAFTCL,NAFTCM,NAFTOC,NAFTTM,NAFVCL,NAFVER,
        7 NAFZFR,NAHCCV,NAHCTE,NAHINF,NAHMAD,NAHPDI,NAHROA,NAHSDA,NAHTUB,
        8 NAIASL,NAIPJT,NAIRJT,NAITCO,NAITMA,NAIXTR,NAIZBD,NAJBER,NAJEST,
        9 NAJSUM,NAKEVH,NAKINE,NAKJOB,NAKLIN,NAKPOL,NAKRUN,NALIDT,NALOLE,
        A NALUPA,NAMCAD,NAMHIT,NAMTHR,NAMUDG,NAMUEX,NAOSTS,NAPART,NAPASL,
        B NAPCHY,NAPCOB,NAPCOI,NAPCPA,NAPCQA,NAPCRL,NAPECO,NAPEHY,NAPEID,
        C NAPEMH,NAPEPT,NAPEST,NAPEWI,NAPFER,NAPFHR,NAPFRF,NAPFRT,NAPHCO,
        D NAPHER,NAPHHY,NAPHMH,NAPHST,NAPIDI,NAPITM,NAPLID,NAPLPD,NAPLSD,
        E NAPMSK,NAPNEU,NAPPDS,NAPPOB,NAPPRL,NAPRTM,NAPSCO,NAPSPO,NAPSTR,
        F NAPT2X,NAPTBC,NAPTCO,NAPTEX,NAPTMA,NAPTML,NAPTNC,NAPTST,NAPVCO,
        G NAPYER,NAPYFR,NAPYNE,NAQDET,NAQFPA,NAQLIN,NAQMTL,NAQMTS,NAQPAR,
        H NAQPBT,NAQPLI,NAQTRA,NAQVEC,NAQVRT,NAQWRK,NAQZER,NAREVH,NARHAH,
        I NARTLO,NARTLS,NARUNH,NARUNR,NASFTR,NATEXS,NATGMA,NATMTL,NATPCO,
        J NAVCOM,NAVCPL,NAVDCO,NAVDHT,NAVDXY,NAVDZT,NAVERT,NAVFHL,NAVFLG,
        K NAVFPH,NAVHLS,NAVPLH,NAX1AD,NAX1SC,NAX1TI,NAX2DF,NAX3EC,NAX3EW,
        L NAX3HC,NAX3IT,NAX3L2,NAX3LU,NAX3TM,NAX3TO,NAX3TP,NAX3X3,NAXTBN,
        M NAXTBP,NAXTCN,NAXTEB,NAXTOP,NAXTRB,NAYV0V,NAZPFR,NAEFOL,NAMUID,
        N NAPGID,NAPGPC,NAPGAC,NAPMSC,NAPTHR,NANBIP,NAPDLT,NAPMLT,NAPLJT
   
   
   ------------------ /QQQQJJ/ --- HAC parameters for ALPHA banks -------
         PARAMETER (JQVEQX= 1,JQVEQY= 2,JQVEQZ= 3,JQVEQE= 4,JQVEQM= 5,
        & JQVEQP= 6,JQVECH= 7,JQVETN= 8,JQVESC= 9,JQVEKS=10,JQVECL=11,
        & JQVEPA=12,JQVEQD=13,JQVENP=14,JQVESP=15,JQVEOV=16,JQVEEV=17,
        & JQVEND=18,JQVEDL=19,JQVENO=20,JQVEOL=21,JQVENM=22,JQVEML=23,
        & JQVEBM=24,JQVELK=38,JQVEDB=39,JQVEZB=40,JQVESD=41,JQVESZ=42,
        & JQVECB=43,JQVEEM=44,JQVECF=54,JQVEEW=55,JQVEUS=56)
         PARAMETER ( JQVRVX=1,JQVRVY=2,JQVRVZ=3,JQVRVN=4,JQVRTY=5,
        1   JQVRIP=6,JQVRND=7,JQVRDL=8,JQVRAY=9,JQVRAF=10,JQVREM=11,
        2   JQVRCF=17,JQVRET=18)
         PARAMETER ( JQDEAF= 1,JQDEAL= 2,JQDENT= 3,JQDEAT= 4,JQDELT= 8,
        &  JQDEAE= 9,JQDEAH=10,JQDEAM=11,JQDECF=12,JQDEEC=13,JQDEHC=14,
        &  JQDEET=15,JQDEFI=16,JQDENF=17,JQDEFL=18,JQDENE=19,JQDEEL=20,
        &  JQDENH=21,JQDEHL=22,JQDELH=23,JQDEEF=24,JQDEPC=25,JQDEEG=26,
        &  JQDEMU=27,JQDEDX=28,JQDEPG=29,JQDEPD=30,JQDEPM=31)
         PARAMETER ( JQPAGN=1, JQPANA=2, JQPACO=5, JQPAMA=6, JQPACH=7,
        & JQPALT=8,JQPAWI=9,JQPAAN=10)
   
   
         EXTERNAL CQPART, CQTPN, XCEQAN, XLUMOK, XPEQAN, XPEQOR, XPEQU,
        & XVDEOK, LLUMOK, SLUMOK
         CHARACTER * 12 CQPART, CQTPN
         LOGICAL XCAL, XCEQAN, XCEQOR, XCEQU, XECAL, XEID, XFRF, XHCAL,
        & XHMA, XLOCK, XLOCKN, XMC, XLUMOK, XMCA, XPEO, XPHO, XPEQAN,
        & XPEQOR, XPEQU, XSAME, XSIG, XTEX, XPEC, XPEP, XPHC, XYV0,
        & XFRIQF, XEFO, XPCQ, XEGP, XMUI, XVDEOK, XPGP, LLUMOK, SLUMOK,
        & XPGAC, XLEPTG, XLEPTH
   
    alcons
    define universal constants
         REAL PI, TWOPI, PIBY2, PIBY3, PIBY4, PIBY6, PIBY8, PIBY12
         REAL RADEG, DEGRA
         REAL CLGHT, ALDEDX
         PARAMETER (PI=3.141592653589)
         PARAMETER (RADEG=180./PI, DEGRA=PI/180.)
         PARAMETER (TWOPI = 2.*PI , PIBY2 = PI/2., PIBY4 = PI/4.)
         PARAMETER (PIBY6 = PI/6. , PIBY8 = PI/8.)
         PARAMETER (PIBY12= PI/12., PIBY3 = PI/3.)
         PARAMETER (CLGHT = 29.9792458, ALDEDX = 0.000307)
   
         ALDEDX  = constant used in the computation of DEDX in GeV
         CLGHT   = speed of light in cm/nsec
   
   
   
    efoljj
         INTEGER JEFOPX,JEFOPY,JEFOPZ,JEFOEW,JEFOWE,JEFOTY,JEFOLE,JEFOLT,
        +          JEFOLH,JEFOLC,JEFOLJ,LEFOLA
         PARAMETER(JEFOPX=1,JEFOPY=2,JEFOPZ=3,JEFOEW=4,JEFOWE=5,JEFOTY=6,
        +          JEFOLE=7,JEFOLT=8,JEFOLH=9,JEFOLC=10,JEFOLJ=11,
        +          LEFOLA=11)
   
   
    egpcjj
         INTEGER JEGPPX,JEGPPY,JEGPPZ,JEGPR1,JEGPR2,JEGPF4,JEGPDM,JEGPST,
        +          JEGPQU,JEGPPE,LEGPCA
         PARAMETER(JEGPPX=1,JEGPPY=2,JEGPPZ=3,JEGPR1=4,JEGPR2=5,JEGPF4=6,
        +          JEGPDM=7,JEGPST=8,JEGPQU=9,JEGPPE=10,LEGPCA=10)
   
   
    eidtjj
         INTEGER JEIDIF,JEIDR1,JEIDR2,JEIDR3,JEIDR4,JEIDR5,JEIDR6,JEIDR7,
        +          JEIDEC,JEIDIP,JEIDE1,JEIDE2,JEIDE3,JEIDFR,JEIDPE,LEIDTA
         PARAMETER(JEIDIF=1,JEIDR1=2,JEIDR2=3,JEIDR3=4,JEIDR4=5,JEIDR5=6,
        +          JEIDR6=7,JEIDR7=8,JEIDEC=9,JEIDIP=10,JEIDE1=11,
        +          JEIDE2=12,JEIDE3=13,JEIDFR=14,JEIDPE=15,LEIDTA=15)
   
   
    frftjj
         INTEGER JFRFIR,JFRFTL,JFRFP0,JFRFD0,JFRFZ0,JFRFAL,JFRFEM,JFRFC2,
        +          JFRFDF,JFRFNO,LFRFTA
         PARAMETER(JFRFIR=1,JFRFTL=2,JFRFP0=3,JFRFD0=4,JFRFZ0=5,JFRFAL=6,
        +          JFRFEM=7,JFRFC2=28,JFRFDF=29,JFRFNO=30,LFRFTA=30)
   
   
    fridjj
         INTEGER JFRIBP,JFRIDZ,JFRIBC,JFRIDC,JFRIPE,JFRIPM,JFRIPI,JFRIPK,
        +          JFRIPP,JFRINK,JFRIQF,LFRIDA
         PARAMETER(JFRIBP=1,JFRIDZ=2,JFRIBC=3,JFRIDC=4,JFRIPE=5,JFRIPM=6,
        +          JFRIPI=7,JFRIPK=8,JFRIPP=9,JFRINK=10,JFRIQF=11,
        +          LFRIDA=11)
   
   
    frtljj
         INTEGER JFRTIV,JFRTNV,JFRTII,JFRTNI,JFRTNE,JFRTIT,JFRTNT,JFRTNR,
        +          LFRTLA
         PARAMETER(JFRTIV=1,JFRTNV=2,JFRTII=3,JFRTNI=4,JFRTNE=5,JFRTIT=6,
        +          JFRTNT=7,JFRTNR=8,LFRTLA=8)
   
   
    hmadjj
         INTEGER JHMANF,JHMANE,JHMANL,JHMAMH,JHMAIG,JHMAED,JHMACS,JHMAND,
        +          JHMAIE,JHMAIT,JHMAIF,JHMATN,LHMADA
         PARAMETER(JHMANF=1,JHMANE=2,JHMANL=3,JHMAMH=4,JHMAIG=5,JHMAED=6,
        +          JHMACS=7,JHMAND=8,JHMAIE=9,JHMAIT=10,JHMAIF=11,
        +          JHMATN=12,LHMADA=12)
   
   
    mcadjj
         INTEGER JMCANH,JMCADH,JMCADC,JMCAAM,JMCAAC,JMCATN,LMCADA
         PARAMETER(JMCANH=1,JMCADH=3,JMCADC=5,JMCAAM=7,JMCAAC=8,JMCATN=9,
        +          LMCADA=9)
   
   
    muidjj
         INTEGER JMUIIF,JMUISR,JMUIDM,JMUIST,JMUITN,LMUIDA
         PARAMETER(JMUIIF=1,JMUISR=2,JMUIDM=3,JMUIST=4,JMUITN=5,LMUIDA=5)
   
   
    pcqajj
         INTEGER JPCQNA,JPCQPX,JPCQPY,JPCQPZ,JPCQEN,LPCQAA
         PARAMETER(JPCQNA=1,JPCQPX=2,JPCQPY=3,JPCQPZ=4,JPCQEN=5,LPCQAA=5)
   
   
    pdltjj
         INTEGER JPDLPA,JPDLJT,JPDLPI,JPDLPE,JPDLVP,JPDLFR,LPDLTA
         PARAMETER(JPDLPA=1,JPDLJT=2,JPDLPI=3,JPDLPE=4,JPDLVP=5,JPDLFR=6,
        +          LPDLTA=6)
   
   
    pecojj
         INTEGER JPECER,JPECE1,JPECE2,JPECTH,JPECPH,JPECEC,JPECKD,JPECCC,
        +          JPECRB,JPECPC,LPECOA
         PARAMETER(JPECER=1,JPECE1=2,JPECE2=3,JPECTH=4,JPECPH=5,JPECEC=6,
        +          JPECKD=7,JPECCC=8,JPECRB=9,JPECPC=10,LPECOA=10)
   
   
    peptjj
         INTEGER JPEPT1,JPEPP1,JPEPT3,JPEPP3,LPEPTA
         PARAMETER(JPEPT1=1,JPEPP1=2,JPEPT3=3,JPEPP3=4,LPEPTA=4)
   
   
    pgacjj
         INTEGER JPGAEC,JPGATC,JPGAPC,JPGAR1,JPGAR2,JPGAF4,JPGADM,JPGAST,
        +          JPGAQU,JPGAQ1,JPGAQ2,JPGAM1,JPGAM2,JPGAMA,JPGAER,JPGATR,
        +          JPGAPR,JPGAEF,JPGAGC,JPGAZS,JPGAPL,JPGAPH,JPGAPN,JPGAFA,
        +          JPGAPE,LPGACA
         PARAMETER(JPGAEC=1,JPGATC=2,JPGAPC=3,JPGAR1=4,JPGAR2=5,JPGAF4=6,
        +          JPGADM=7,JPGAST=8,JPGAQU=9,JPGAQ1=10,JPGAQ2=11,
        +          JPGAM1=12,JPGAM2=13,JPGAMA=14,JPGAER=15,JPGATR=16,
        +          JPGAPR=17,JPGAEF=18,JPGAGC=19,JPGAZS=20,JPGAPL=21,
        +          JPGAPH=22,JPGAPN=23,JPGAFA=24,JPGAPE=25,LPGACA=25)
   
   
    pgpcjj
         INTEGER JPGPEC,JPGPTC,JPGPPC,JPGPR1,JPGPR2,JPGPF4,JPGPDM,JPGPST,
        +          JPGPQU,JPGPQ1,JPGPQ2,JPGPM1,JPGPM2,JPGPMA,JPGPER,JPGPTR,
        +          JPGPPR,JPGPPE,LPGPCA
         PARAMETER(JPGPEC=1,JPGPTC=2,JPGPPC=3,JPGPR1=4,JPGPR2=5,JPGPF4=6,
        +          JPGPDM=7,JPGPST=8,JPGPQU=9,JPGPQ1=10,JPGPQ2=11,
        +          JPGPM1=12,JPGPM2=13,JPGPMA=14,JPGPER=15,JPGPTR=16,
        +          JPGPPR=17,JPGPPE=18,LPGPCA=18)
   
   
    phcojj
         INTEGER JPHCER,JPHCTH,JPHCPH,JPHCEC,JPHCKD,JPHCCC,JPHCRB,JPHCNF,
        +          JPHCPC,LPHCOA
         PARAMETER(JPHCER=1,JPHCTH=2,JPHCPH=3,JPHCEC=4,JPHCKD=5,JPHCCC=6,
        +          JPHCRB=7,JPHCNF=8,JPHCPC=9,LPHCOA=9)
   
   
    pmltjj
         INTEGER JPMLFL,JPMLPO,JPMLCH,JPMLSP,JPMLLE,JPMLME,JPMLKT,JPMLFR,
        +          LPMLTA
         PARAMETER(JPMLFL=1,JPMLPO=2,JPMLCH=3,JPMLSP=4,JPMLLE=5,JPMLME=6,
        +          JPMLKT=7,JPMLFR=8,LPMLTA=8)
   
   
    texsjj
         INTEGER JTEXSI,JTEXTM,JTEXTL,JTEXNS,JTEXAD,JTEXTN,JTEXSF,LTEXSA
         PARAMETER(JTEXSI=1,JTEXTM=2,JTEXTL=3,JTEXNS=4,JTEXAD=5,JTEXTN=6,
        +          JTEXSF=7,LTEXSA=7)
   
   
    yv0vjj
         INTEGER JYV0K1,JYV0K2,JYV0VX,JYV0VY,JYV0VZ,JYV0VM,JYV0PX,JYV0PY,
        +          JYV0PZ,JYV0PM,JYV0X1,JYV0X2,JYV0XM,JYV0C2,JYV0IC,JYV0P1,
        +          JYV0P2,JYV0EP,JYV0DM,JYV0S1,JYV0S2,LYV0VA
         PARAMETER(JYV0K1=1,JYV0K2=2,JYV0VX=3,JYV0VY=4,JYV0VZ=5,JYV0VM=6,
        +          JYV0PX=12,JYV0PY=13,JYV0PZ=14,JYV0PM=15,JYV0X1=21,
        +          JYV0X2=22,JYV0XM=23,JYV0C2=26,JYV0IC=27,JYV0P1=28,
        +          JYV0P2=31,JYV0EP=34,JYV0DM=55,JYV0S1=56,JYV0S2=57,
        +          LYV0VA=57)
   
   
   
   -------------------- /QMACRO/ --- statement functions ----------------
   
    bmacro
       set of intrinsic functions to handle BOS banks
   - # of words/row in bank with index ID
         LCOLS(ID) = IW(ID+1)
   - # of rows in bank with index ID
         LROWS(ID) = IW(ID+2)
   - index of next row in the bank with index ID
         KNEXT(ID) = ID + LMHLEN + IW(ID+1)*IW(ID+2)
   - index of row # NRBOS in the bank with index ID
         KROW(ID,NRBOS) = ID + LMHLEN + IW(ID+1)*(NRBOS-1)
   - # of free words in the bank with index ID
         LFRWRD(ID) = ID + IW(ID) - KNEXT(ID)
   - # of free rows in the bank with index ID
         LFRROW(ID) = LFRWRD(ID) / LCOLS(ID)
   - Lth integer element of the NRBOSth row of the bank with index ID
         ITABL(ID,NRBOS,L) = IW(ID+LMHLEN+(NRBOS-1)*IW(ID+1)+L)
   - Lth real element of the NRBOSth row of the bank with index ID
         RTABL(ID,NRBOS,L) = RW(ID+LMHLEN+(NRBOS-1)*IW(ID+1)+L)
   
   -------------------- /QCFUNC/ --- statement functions for ALPHA banks
         KJQDET(KI)=IW(KOQVEC+KI*KCQVEC+JQVEQD)
         QSQT(QF)=SIGN(SQRT(ABS(QF)),QF)
         QP(KI)=RW(KOQVEC+KI*KCQVEC+JQVEQP)
         QX(KI)=RW(KOQVEC+KI*KCQVEC+JQVEQX)
         QY(KI)=RW(KOQVEC+KI*KCQVEC+JQVEQY)
         QZ(KI)=RW(KOQVEC+KI*KCQVEC+JQVEQZ)
         QE(KI)=RW(KOQVEC+KI*KCQVEC+JQVEQE)
         QM(KI)=RW(KOQVEC+KI*KCQVEC+JQVEQM)
         QCH(KI)=RW(KOQVEC+KI*KCQVEC+JQVECH)
         KCH(KI)=NINT (QCH(KI))
         QCT(KI)=QZ(KI)/QP(KI)
         QDB(KI)=RW(KOQVEC+KI*KCQVEC+JQVEDB)
         QZB(KI)=RW(KOQVEC+KI*KCQVEC+JQVEZB)
         QDBS2(KI)=RW(KOQVEC+KI*KCQVEC+JQVESD)
         QZBS2(KI)=RW(KOQVEC+KI*KCQVEC+JQVESZ)
         QBC2(KI)=RW(KOQVEC+KI*KCQVEC+JQVECB)
         QSIG(KI,KI1,KI2)=RW(KOQVEC+KI*KCQVEC+KMATIX(KI1,KI2)+JQVEEM)
         XSIG(KI)=RW(KOQVEC+KI*KCQVEC+JQVEEM).GE.0.
         QSMAT(KI,KI1)=RW(KOQVEC+KI*KCQVEC+KI1+JQVEEM)
         QSIGX(KI)=QSQT(QSMAT(KI,0))
         QSIGY(KI)=QSQT(QSMAT(KI,2))
         QSIGZ(KI)=QSQT(QSMAT(KI,5))
         QSIGEE(KI)=RW(KOQVEC+KI*KCQVEC+JQVEEM+9)
         QSIGE(KI)=QSQT(QSIGEE(KI))
         QSIGPP(KI)=(QX(KI)**2*QSMAT(KI,0)+QY(KI)**2*QSMAT(KI,2)+
        & QZ(KI)**2*QSMAT(KI,5)+2.*(QX(KI)*(QY(KI)*QSMAT(KI,1)+
        & QZ(KI)*QSMAT(KI,3))+QY(KI)*QZ(KI)*QSMAT(KI,4)))/QP(KI)**2
         QSIGP(KI)=QSQT(QSIGPP(KI))
         QSIGMM(KI)=QM(KI)*(QE(KI)**2*QSMAT(KI,9)+QX(KI)**2*QSMAT(KI,0)+
        & QY(KI)**2*QSMAT(KI,2)+QZ(KI)**2*QSMAT(KI,5)+2.*(QX(KI)*(QY(KI)
        & QSMAT(KI,1)+QZ(KI)*QSMAT(KI,3))+QY(KI)*QZ(KI)*QSMAT(KI,4)-
        & QE(KI)*(QX(KI)*QSMAT(KI,6)+QY(KI)*QSMAT(KI,7)+
        & QZ(KI)*QSMAT(KI,8))))/AMAX1(QM(KI)**3,1.E-16)
         QSIGM(KI)=QSQT(QSIGMM(KI))
         QMCHIF(KI)=RW(KOQVEC+KI*KCQVEC+JQVECF)
         QPH(KI)=ATG(QY(KI),QX(KI))
         QPT(KI)=SQRT(QX(KI)**2+QY(KI)**2)
         KTN(KI)=IW(KOQVEC+KI*KCQVEC+JQVETN)
         KMC(KI)=KCLARM(IW(KOQVEC+KI*KCQVEC+JQVECL))
         KBMASK(KI,KI1)=IW(KOQVEC+KI*KCQVEC+KI1+JQVEBM-1)
         KCALFL(KI)=IW(KJQDET(KI)+JQDECF)
         KCHGD(KI,KI1)=IW(KOQLIN+KI1+IW(KJQDET(KI)+JQDEFL))
         KCLASS(KI)=KCLACO(IW(KOQVEC+KI*KCQVEC+JQVECL))
         KDAU(KI,KI1)=IW(KOQLIN+KI1+IW(KOQVEC+KI*KCQVEC+JQVEDL))
         KECAL(KI,KI1)=IW(KOQLIN+KI1+IW(KJQDET(KI)+JQDEEL))
         KENDV(KI)=IW(KOQVEC+KI*KCQVEC+JQVEEV)
         KFOLLO(KI)=IW(KOQVEC+KI*KCQVEC+JQVENP)
         KHCAL(KI,KI1)=IW(KOQLIN+KI1+IW(KJQDET(KI)+JQDEHL))
         KLUNDS(KI)=IW(KOQVEC+KI*KCQVEC+JQVEKS)
         KNCHGD(KI)=IW(KJQDET(KI)+JQDENF)
         KNECAL(KI)=IW(KJQDET(KI)+JQDENE)
         KNHCAL(KI)=IW(KJQDET(KI)+JQDENH)
         KNMOTH(KI)=IW(KOQVEC+KI*KCQVEC+JQVENO)
         KMOTH(KI,KI1)=IW(KOQLIN+KI1+IW(KOQVEC+KI*KCQVEC+JQVEOL))
         KMTCH(KI,KI1)=IW(KOQMTL+KI1+IW(KOQVEC+KI*KCQVEC+JQVEML))
         KNDAU(KI)=IW(KOQVEC+KI*KCQVEC+JQVEND)
         KNMTCH(KI)=IW(KOQVEC+KI*KCQVEC+JQVENM)
         KORIV(KI)=IW(KOQVEC+KI*KCQVEC+JQVEOV)
         KSAME(KI)=IW(KOQVEC+KI*KCQVEC+JQVESP)
         KSMTCH(KI,KI1)=IW(KOQMTS+KI1+IW(KOQVEC+KI*KCQVEC+JQVEML))
         KSTABC(KI)=IW(KOQVEC+KI*KCQVEC+JQVESC)
         KTPCOD(KI)=IW(KOQVEC+KI*KCQVEC+JQVEPA)
         XLOCKN(KI,KI1)=IAND(KBMASK(KI,KI1),KLOCK0(KI1,KMC(KI))).NE.0
         XLOCK(KI)=IW(KOQVEC+KI*KCQVEC+JQVELK).NE.0.OR.XLOCKN(KI,1).OR.
        & XLOCKN(KI,2).OR.XLOCKN(KI,3).OR.XLOCKN(KI,4).OR.
        & XLOCKN(KI,5).OR.XLOCKN(KI,6).OR.XLOCKN(KI,7).OR.
        & XLOCKN(KI,8).OR.XLOCKN(KI,9).OR.XLOCKN(KI,10).OR.
        & XLOCKN(KI,11).OR.XLOCKN(KI,12).OR.XLOCKN(KI,13).OR.
        & XLOCKN(KI,14)
         XMC(KI)=KCLARM(IW(KOQVEC+KI*KCQVEC+JQVECL)).NE.1
         QRDFL(KI,KI1)=RW(KOQVEC+KI*KCQVEC+JQVEUS+KI1-1)
         KRDFL(KI,KI1)=IW(KOQVEC+KI*KCQVEC+JQVEUS+KI1-1)
         XCAL(KI)=IW(KJQDET(KI)+JQDECF).NE.0
         XECAL(KI)=IABS(IW(KJQDET(KI)+JQDECF)).EQ.1
         XHCAL(KI)=IABS(IW(KJQDET(KI)+JQDECF)).EQ.2
         QVX(KI)=RW(KOQVRT+KI*KCQVRT+JQVRVX)
         QVY(KI)=RW(KOQVRT+KI*KCQVRT+JQVRVY)
         QVZ(KI)=RW(KOQVRT+KI*KCQVRT+JQVRVZ)
         KVN(KI)=IW(KOQVRT+KI*KCQVRT+JQVRVN)
         KVTYPE(KI)=IW(KOQVRT+KI*KCQVRT+JQVRTY)
         KVINCP(KI)=IW(KOQVRT+KI*KCQVRT+JQVRIP)
         KVNDAU(KI)=IW(KOQVRT+KI*KCQVRT+JQVRND)
         KVYV0V(KI)=IW(KOQVRT+KI*KCQVRT+JQVRAY)
         KVFVER(KI)=IW(KOQVRT+KI*KCQVRT+JQVRAF)
         KVDAU(KI,KI1)=IW(KOQLIN+KI1+IW(KOQVRT+KI*KCQVRT+JQVRDL))
         QVEM(KI,KI1,KI2)=RW(KOQVRT+KI*KCQVRT+KMATIX(KI1,KI2)+JQVREM)
         QVCHIF(KI)=RW(KOQVRT+KI*KCQVRT+JQVRCF)
         QVDIF2(KI1,KI2)=SQRT((QVX(KI1)-QVX(KI2))**2+(QVY(KI1)-
        &QVY(KI2))**2)
         QVDIF3(KI1,KI2)=SQRT((QVX(KI1)-QVX(KI2))**2+(QVY(KI1)-
        &QVY(KI2))**2+ (QVZ(KI1)-QVZ(KI2))**2)
         QMSQ2(KI1,KI2)=(QE(KI1)+QE(KI2))**2-(QX(KI1)+QX(KI2))**2-
        & (QY(KI1)+QY(KI2))**2-(QZ(KI1)+QZ(KI2))**2
         QMSQ3(KI1,KI2,KI3)=(QE(KI1)+QE(KI2)+QE(KI3))**2-
        & (QX(KI1)+QX(KI2)+QX(KI3))**2-(QY(KI1)+QY(KI2)+QY(KI3))**2-
        & (QZ(KI1)+QZ(KI2)+QZ(KI3))**2
         QMSQ4(KI1,KI2,KI3,KI4)=(QE(KI1)+QE(KI2)+QE(KI3)+QE(KI4))**2-
        & (QX(KI1)+QX(KI2)+QX(KI3)+QX(KI4))**2-(QY(KI1)+QY(KI2)+
        & QY(KI3)+QY(KI4))**2-(QZ(KI1)+QZ(KI2)+QZ(KI3)+QZ(KI4))**2
         QM2(KI1,KI2)=QSQT(QMSQ2(KI1,KI2))
         QM3(KI1,KI2,KI3)=QSQT(QMSQ3(KI1,KI2,KI3))
         QM4(KI1,KI2,KI3,KI4)=QSQT(QMSQ4(KI1,KI2,KI3,KI4))
         QDMSQ(KI1,KI2)=(QE(KI1)-QE(KI2))**2-(QX(KI1)-QX(KI2))**2-
        & (QY(KI1)-QY(KI2))**2-(QZ(KI1)-QZ(KI2))**2
         QBETA(KI)=QP(KI)/QE(KI)
         QGAMMA(KI)=1./SQRT((1.-QBETA(KI))*(1.+QBETA(KI)))
         QDOT3(KI1,KI2)=QX(KI1)*QX(KI2)+QY(KI1)*QY(KI2)+QZ(KI1)*QZ(KI2)
         QDOT4(KI1,KI2)=QE(KI1)*QE(KI2)-QDOT3(KI1,KI2)
         QCOSA(KI1,KI2)=QDOT3(KI1,KI2)/(QP(KI1)*QP(KI2))
         QPPAR(KI1,KI2)=QDOT3(KI1,KI2)/QP(KI2)
         QPPER(KI1,KI2)=SQRT((QY(KI1)*QZ(KI2)-QZ(KI1)*QY(KI2))**2+
        & (QZ(KI1)*QX(KI2)-QX(KI1)*QZ(KI2))**2+
        & (QX(KI1)*QY(KI2)-QY(KI1)*QX(KI2))**2)/QP(KI2)
         XSAME(KI1,KI2)=IAND(KBMASK(KI1,1),KBMASK(KI2,1)).NE.0.OR.
        & IAND(KBMASK(KI1,2),KBMASK(KI2,2)).NE.0.OR.
        & IAND(KBMASK(KI1,3),KBMASK(KI2,3)).NE.0.OR.
        & IAND(KBMASK(KI1,4),KBMASK(KI2,4)).NE.0.OR.
        & IAND(KBMASK(KI1,5),KBMASK(KI2,5)).NE.0.OR.
        & IAND(KBMASK(KI1,6),KBMASK(KI2,6)).NE.0.OR.
        & IAND(KBMASK(KI1,7),KBMASK(KI2,7)).NE.0.OR.
        & IAND(KBMASK(KI1,8),KBMASK(KI2,8)).NE.0.OR.
        & IAND(KBMASK(KI1,9),KBMASK(KI2,9)).NE.0.OR.
        & IAND(KBMASK(KI1,10),KBMASK(KI2,10)).NE.0.OR.
        & IAND(KBMASK(KI1,11),KBMASK(KI2,11)).NE.0.OR.
        & IAND(KBMASK(KI1,12),KBMASK(KI2,12)).NE.0.OR.
        & IAND(KBMASK(KI1,13),KBMASK(KI2,13)).NE.0.OR.
        & IAND(KBMASK(KI1,14),KBMASK(KI2,14)).NE.0
         QCMASS(KI)=RW(KOQPAR+KI*KCQPAR+JQPAMA)
         QCCHAR(KI)=RW(KOQPAR+KI*KCQPAR+JQPACH)
         QCLIFE(KI)=RW(KOQPAR+KI*KCQPAR+JQPALT)
         QCWIDT(KI)=RW(KOQPAR+KI*KCQPAR+JQPAWI)
         XCEQOR(KI,KI1)=KTPCOD(KI).EQ.KI1.OR.
        & KTPCOD(KI).EQ.IW(KOQPAR+KI1*KCQPAR+JQPAAN)
         XCEQU(KI,KI1)=KTPCOD(KI).EQ.KI1
      QCFDET
         XFRF(KI)=IW(KJQDET(KI)+JQDEAF).NE.KQZER
         QFRFIR(KI)=RW(IW(KJQDET(KI)+JQDEAF)+JFRFIR)
         QFRFTL(KI)=RW(IW(KJQDET(KI)+JQDEAF)+JFRFTL)
         QFRFP0(KI)=RW(IW(KJQDET(KI)+JQDEAF)+JFRFP0)
         QFRFD0(KI)=RW(IW(KJQDET(KI)+JQDEAF)+JFRFD0)
         QFRFZ0(KI)=RW(IW(KJQDET(KI)+JQDEAF)+JFRFZ0)
         QFRFAL(KI)=RW(IW(KJQDET(KI)+JQDEAF)+JFRFAL)
         QFRFEM(KI,KI1,KI2)=RW(IW(KJQDET(KI)+JQDEAF)+
        & KMATIX(KI1,KI2)+JFRFEM)
         QFRFC2(KI)=RW(IW(KJQDET(KI)+JQDEAF)+JFRFC2)
         KFRFDF(KI)=IW(IW(KJQDET(KI)+JQDEAF)+JFRFDF)
         KFRFNO(KI)=IW(IW(KJQDET(KI)+JQDEAF)+JFRFNO)
         KFRTNV(KI)=IW(IW(KJQDET(KI)+JQDEAL)+JFRTNV)
         KFRTNI(KI)=IW(IW(KJQDET(KI)+JQDEAL)+JFRTNI)
         KFRTNE(KI)=IW(IW(KJQDET(KI)+JQDEAL)+JFRTNE)
         KFRTNT(KI)=IW(IW(KJQDET(KI)+JQDEAL)+JFRTNT)
         KFRTNR(KI)=IW(IW(KJQDET(KI)+JQDEAL)+JFRTNR)
         KFRIBP(KI)=IW(IW(KJQDET(KI)+JQDEFI)+JFRIBP)
         KFRIDZ(KI)=IW(IW(KJQDET(KI)+JQDEFI)+JFRIDZ)
         KFRIBC(KI)=IW(IW(KJQDET(KI)+JQDEFI)+JFRIBC)
         KFRIDC(KI)=IW(IW(KJQDET(KI)+JQDEFI)+JFRIDC)
         QFRIPE(KI)=RW(IW(KJQDET(KI)+JQDEFI)+JFRIPE)
         QFRIPM(KI)=RW(IW(KJQDET(KI)+JQDEFI)+JFRIPM)
         QFRIPI(KI)=RW(IW(KJQDET(KI)+JQDEFI)+JFRIPI)
         QFRIPK(KI)=RW(IW(KJQDET(KI)+JQDEFI)+JFRIPK)
         QFRIPP(KI)=RW(IW(KJQDET(KI)+JQDEFI)+JFRIPP)
         QFRINK(KI)=RW(IW(KJQDET(KI)+JQDEFI)+JFRINK)
         KFRIQF(KI)=IW(IW(KJQDET(KI)+JQDEFI)+JFRIQF)
         XFRIQF(KI)=KFRIQF(KI).EQ.1.OR.KFRIQF(KI).EQ.3
         KNTEX(KI)=IW(KJQDET(KI)+JQDENT)
         XTEX(KI)=IW(KJQDET(KI)+JQDENT).NE.0
         KTEXSI(KI,KI1)=IW(IW(KJQDET(KI)+KI1+JQDENT)+JTEXSI)
         QTEXTM(KI,KI1)=RW(IW(KJQDET(KI)+KI1+JQDENT)+JTEXTM)
         QTEXTL(KI,KI1)=RW(IW(KJQDET(KI)+KI1+JQDENT)+JTEXTL)
         KTEXNS(KI,KI1)=IW(IW(KJQDET(KI)+KI1+JQDENT)+JTEXNS)
         QTEXAD(KI,KI1)=RW(IW(KJQDET(KI)+KI1+JQDENT)+JTEXAD)
         XEID(KI)=IW(KJQDET(KI)+JQDEAE).NE.KQZER
         KEIDIF(KI)=IW(IW(KJQDET(KI)+JQDEAE)+JEIDIF)
         QEIDRI(KI,KI1)=RW(IW(KJQDET(KI)+JQDEAE)+KI1+JEIDR1-1)
         QEIDEC(KI)=RW(IW(KJQDET(KI)+JQDEAE)+JEIDEC)
         KEIDIP(KI)=IW(IW(KJQDET(KI)+JQDEAE)+JEIDIP)
         QEIDEI(KI,KI1)=RW(IW(KJQDET(KI)+JQDEAE)+KI1+JEIDE1-1)
         XHMA(KI)=IW(KJQDET(KI)+JQDEAH).NE.KQZER
         KHMANF(KI)=IW(IW(KJQDET(KI)+JQDEAH)+JHMANF)
         KHMANE(KI)=IW(IW(KJQDET(KI)+JQDEAH)+JHMANE)
         KHMANL(KI)=IW(IW(KJQDET(KI)+JQDEAH)+JHMANL)
         KHMAMH(KI)=IW(IW(KJQDET(KI)+JQDEAH)+JHMAMH)
         KHMAIG(KI)=IW(IW(KJQDET(KI)+JQDEAH)+JHMAIG)
         QHMAED(KI)=RW(IW(KJQDET(KI)+JQDEAH)+JHMAED)
         QHMACS(KI)=RW(IW(KJQDET(KI)+JQDEAH)+JHMACS)
         KHMAND(KI)=IW(IW(KJQDET(KI)+JQDEAH)+JHMAND)
         KHMAIE(KI)=IW(IW(KJQDET(KI)+JQDEAH)+JHMAIE)
         KHMAIT(KI)=IW(IW(KJQDET(KI)+JQDEAH)+JHMAIT)
         KHMAIF(KI)=IW(IW(KJQDET(KI)+JQDEAH)+JHMAIF)
         XMCA(KI)=IW(KJQDET(KI)+JQDEAM).NE.KQZER
         KMCANH(KI,KI1)=IW(IW(KJQDET(KI)+JQDEAM)+KI1+JMCANH-1)
         QMCADH(KI,KI1)=RW(IW(KJQDET(KI)+JQDEAM)+KI1+JMCADH-1)
         QMCADC(KI,KI1)=RW(IW(KJQDET(KI)+JQDEAM)+KI1+JMCADC-1)
         QMCAAM(KI)=RW(IW(KJQDET(KI)+JQDEAM)+JMCAAM)
         QMCAAC(KI)=RW(IW(KJQDET(KI)+JQDEAM)+JMCAAC)
         XMUI(KI)=IW(KJQDET(KI)+JQDEMU).NE.KQZER
         KMUIIF(KI)=IW(IW(KJQDET(KI)+JQDEMU)+JMUIIF)
         QMUISR(KI)=RW(IW(KJQDET(KI)+JQDEMU)+JMUISR)
         QMUIDM(KI)=RW(IW(KJQDET(KI)+JQDEMU)+JMUIDM)
         KMUIST(KI)=IW(IW(KJQDET(KI)+JQDEMU)+JMUIST)
         KMUITN(KI)=IW(IW(KJQDET(KI)+JQDEMU)+JMUITN)
         XPEC(KI)=IW(KJQDET(KI)+JQDEEC).NE.KQZER
         QPECER(KI)=RW(IW(KJQDET(KI)+JQDEEC)+JPECER)
         QPECE1(KI)=RW(IW(KJQDET(KI)+JQDEEC)+JPECE1)
         QPECE2(KI)=RW(IW(KJQDET(KI)+JQDEEC)+JPECE2)
         QPECTH(KI)=RW(IW(KJQDET(KI)+JQDEEC)+JPECTH)
         QPECPH(KI)=RW(IW(KJQDET(KI)+JQDEEC)+JPECPH)
         QPECEC(KI)=RW(IW(KJQDET(KI)+JQDEEC)+JPECEC)
         KPECKD(KI)=IW(IW(KJQDET(KI)+JQDEEC)+JPECKD)
         KPECCC(KI)=IW(IW(KJQDET(KI)+JQDEEC)+JPECCC)
         KPECRB(KI)=IW(IW(KJQDET(KI)+JQDEEC)+JPECRB)
         KPECPC(KI)=IW(IW(KJQDET(KI)+JQDEEC)+JPECPC)
         XPEP(KI)=IW(KJQDET(KI)+JQDEET).NE.KQZER
         QPEPT1(KI)=RW(IW(KJQDET(KI)+JQDEET)+JPEPT1)
         QPEPP1(KI)=RW(IW(KJQDET(KI)+JQDEET)+JPEPP1)
         QPEPT3(KI)=RW(IW(KJQDET(KI)+JQDEET)+JPEPT3)
         QPEPP3(KI)=RW(IW(KJQDET(KI)+JQDEET)+JPEPP3)
         XPHC(KI)=IW(KJQDET(KI)+JQDEHC).NE.KQZER
         QPHCER(KI)=RW(IW(KJQDET(KI)+JQDEHC)+JPHCER)
         QPHCTH(KI)=RW(IW(KJQDET(KI)+JQDEHC)+JPHCTH)
         QPHCPH(KI)=RW(IW(KJQDET(KI)+JQDEHC)+JPHCPH)
         QPHCEC(KI)=RW(IW(KJQDET(KI)+JQDEHC)+JPHCEC)
         KPHCKD(KI)=IW(IW(KJQDET(KI)+JQDEHC)+JPHCKD)
         KPHCCC(KI)=IW(IW(KJQDET(KI)+JQDEHC)+JPHCCC)
         KPHCRB(KI)=IW(IW(KJQDET(KI)+JQDEHC)+JPHCRB)
         KPHCPC(KI)=IW(IW(KJQDET(KI)+JQDEHC)+JPHCPC)
         XEFO(KI)=IW(KJQDET(KI)+JQDEEF).NE.KQZER
         QEFOWE(KI)=RW(IW(KJQDET(KI)+JQDEEF)+JEFOWE)
         KEFOTY(KI)=IW(IW(KJQDET(KI)+JQDEEF)+JEFOTY)
         KEFOLE(KI)=IW(IW(KJQDET(KI)+JQDEEF)+JEFOLE)
         KEFOLT(KI)=IW(IW(KJQDET(KI)+JQDEEF)+JEFOLT)
         KEFOLH(KI)=IW(IW(KJQDET(KI)+JQDEEF)+JEFOLH)
         KEFOLC(KI)=IW(IW(KJQDET(KI)+JQDEEF)+JEFOLC)
         KEFOLJ(KI)=IW(IW(KJQDET(KI)+JQDEEF)+JEFOLJ)
         XPCQ(KI)=IW(KJQDET(KI)+JQDEPC).NE.KQZER
         KPCQNA(KI)=IW(IW(KJQDET(KI)+JQDEPC)+JPCQNA)
         XEGP(KI)=IW(KJQDET(KI)+JQDEEG).NE.KQZER
         QEGPR1(KI)=RW(IW(KJQDET(KI)+JQDEEG)+JEGPR1)
         QEGPR2(KI)=RW(IW(KJQDET(KI)+JQDEEG)+JEGPR2)
         QEGPF4(KI)=RW(IW(KJQDET(KI)+JQDEEG)+JEGPF4)
         QEGPDM(KI)=RW(IW(KJQDET(KI)+JQDEEG)+JEGPDM)
         KEGPST(KI)=IW(IW(KJQDET(KI)+JQDEEG)+JEGPST)
         KEGPQU(KI)=IW(IW(KJQDET(KI)+JQDEEG)+JEGPQU)
         KEGPPE(KI)=IW(IW(KJQDET(KI)+JQDEEG)+JEGPPE)
         XPGP(KI)=IW(KJQDET(KI)+JQDEPG).NE.KQZER.AND.IW(NAPGPC).GT.0
         QPGPR1(KI)=RW(IW(KJQDET(KI)+JQDEPG)+JPGPR1)
         QPGPR2(KI)=RW(IW(KJQDET(KI)+JQDEPG)+JPGPR2)
         QPGPF4(KI)=RW(IW(KJQDET(KI)+JQDEPG)+JPGPF4)
         QPGPDM(KI)=RW(IW(KJQDET(KI)+JQDEPG)+JPGPDM)
         QPGPST(KI)=RW(IW(KJQDET(KI)+JQDEPG)+JPGPST)
         QPGPQ1(KI)=RW(IW(KJQDET(KI)+JQDEPG)+JPGPQ1)
         QPGPQ2(KI)=RW(IW(KJQDET(KI)+JQDEPG)+JPGPQ2)
         QPGPM1(KI)=RW(IW(KJQDET(KI)+JQDEPG)+JPGPM1)
         QPGPM2(KI)=RW(IW(KJQDET(KI)+JQDEPG)+JPGPM2)
         QPGPMA(KI)=RW(IW(KJQDET(KI)+JQDEPG)+JPGPMA)
         QPGPER(KI)=RW(IW(KJQDET(KI)+JQDEPG)+JPGPER)
         QPGPTR(KI)=RW(IW(KJQDET(KI)+JQDEPG)+JPGPTR)
         QPGPPR(KI)=RW(IW(KJQDET(KI)+JQDEPG)+JPGPPR)
         KPGPQU(KI)=IW(IW(KJQDET(KI)+JQDEPG)+JPGPQU)
         KPGPPE(KI)=IW(IW(KJQDET(KI)+JQDEPG)+JPGPPE)
         XPGAC(KI)=IW(KJQDET(KI)+JQDEPG).NE.KQZER.AND.IW(NAPGAC).GT.0
         KPGAST(KI)=IW(IW(KJQDET(KI)+JQDEPG)+JPGAST)
         QPGAEF(KI)=RW(IW(KJQDET(KI)+JQDEPG)+JPGAEF)
         QPGAGC(KI)=RW(IW(KJQDET(KI)+JQDEPG)+JPGAGC)
         QPGAZS(KI)=RW(IW(KJQDET(KI)+JQDEPG)+JPGAZS)
         QPGAPL(KI)=RW(IW(KJQDET(KI)+JQDEPG)+JPGAPL)
         QPGAPH(KI)=RW(IW(KJQDET(KI)+JQDEPG)+JPGAPH)
         KPGAPN(KI)=IW(IW(KJQDET(KI)+JQDEPG)+JPGAPN)
         KPGAFA(KI)=IW(IW(KJQDET(KI)+JQDEPG)+JPGAFA)
         KPGAPE(KI)=IW(IW(KJQDET(KI)+JQDEPG)+JPGAPE)
         XYV0(KI)=KVYV0V(KENDV(KI)).NE.0
         KYV0K1(KI)=IW(KVYV0V(KENDV(KI))+JYV0K1)
         KYV0K2(KI)=IW(KVYV0V(KENDV(KI))+JYV0K2)
         QYV0VX(KI)=RW(KVYV0V(KENDV(KI))+JYV0VX)
         QYV0VY(KI)=RW(KVYV0V(KENDV(KI))+JYV0VY)
         QYV0VZ(KI)=RW(KVYV0V(KENDV(KI))+JYV0VZ)
         QYV0X1(KI)=RW(KVYV0V(KENDV(KI))+JYV0X1)
         QYV0X2(KI)=RW(KVYV0V(KENDV(KI))+JYV0X2)
         QYV0C2(KI)=RW(KVYV0V(KENDV(KI))+JYV0C2)
         KYV0IC(KI)=IW(KVYV0V(KENDV(KI))+JYV0IC)
         QYV0DM(KI)=RW(KVYV0V(KENDV(KI))+JYV0DM)
         QYV0S1(KI)=RW(KVYV0V(KENDV(KI))+JYV0S1)
         QYV0S2(KI)=RW(KVYV0V(KENDV(KI))+JYV0S2)
         XLEPTG(KI)=IW(KJQDET(KI)+JQDEPD).NE.KQZER
         KLEPPA(KI)=IW(IW(KJQDET(KI)+JQDEPD)+JPDLPA)
         KLEPJT(KI)=IW(IW(KJQDET(KI)+JQDEPD)+JPDLJT)+KLFJET-1
         QLEPPI(KI)=RW(IW(KJQDET(KI)+JQDEPD)+JPDLPI)
         QLEPPE(KI)=RW(IW(KJQDET(KI)+JQDEPD)+JPDLPE)
         KLEPVP(KI)=IW(IW(KJQDET(KI)+JQDEPD)+JPDLVP)
         XLEPTH(KI)=IW(KJQDET(KI)+JQDEPM).NE.KQZER
         KLEPFL(KI)=IW(IW(KJQDET(KI)+JQDEPM)+JPMLFL)
         KLEPPO(KI)=IW(IW(KJQDET(KI)+JQDEPM)+JPMLPO)
         KLEPCH(KI)=IW(IW(KJQDET(KI)+JQDEPM)+JPMLCH)
         KLEPSP(KI)=IW(IW(KJQDET(KI)+JQDEPM)+JPMLSP)
         KLEPLE(KI)=IW(IW(KJQDET(KI)+JQDEPM)+JPMLLE)
         KLEPME(KI)=IW(IW(KJQDET(KI)+JQDEPM)+JPMLME)
         KLEPKT(KI)=IW(IW(KJQDET(KI)+JQDEPM)+JPMLKT)
   
         COFLIG = 1.
         CALL HCSIMM(IBTH0,IBPH0,IBTH,IBPH,IRGN)
         IBANK1 = IW(NAMIND('H1EC'))
         IBANK2 = IW(NAMIND('H2EC'))
         IBANK3 = IW(NAMIND('H3EC'))
         IBANK4 = IW(NAMIND('H4EC'))
         IF(IRGN.EQ.2) IBTH = IBTH-4
         IF(IRGN.EQ.3) IBTH = IBTH-10
         IF(IRGN.EQ.4) IBTH = IBTH-17
         IF(IRGN.EQ.1) IBANK = IBANK1
         IF(IRGN.EQ.2) IBANK = IBANK2
         IF(IRGN.EQ.3) IBANK = IBANK3
         IF(IRGN.EQ.4) IBANK = IBANK4
         IF (IBANK.LE.0) THEN
            WRITE(IW(6),*)'++++ BANKS H1EC, H2EC, H3EC, H4EC MISSING!'
         ENDIF
         COFLIG = RTABL(IBANK,IBTH,IBPH)
         RETURN
         END
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   QFILL                                                                           
        |---- HCALENSC                                                             
                   |----  NAMIND                              External             
                   |----  CHAINT                              External             
                   |----  QWMESS                                                   
                   |----  MDARD                               External             
                   |----  VZERO                               External             
                   |----  NLINK                               External             
                   |----  QCORFIC                                                  
                   |----  COFLIG                                                   
   
 
3 KCANTI
         FUNCTION KCANTI (IPC,IANTI)
  ------------------------------------------------------------------------------
    CKEY PART /USER
  ------------------------------------------------------------------------------
   Return ipc (if ianti = 0) or anti-particle code (if ianti .ne. 0)
                                                     H.Albrecht 27.11.88
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   QWPART                                                                          
   XPEQAN                                                                          
   XPEQOR                                                                          
        |---- KCANTI.                                                              
   
 
3 KCDIR
         FUNCTION KCDIR (IPC,ICLASS)
  ------------------------------------------------------------------------------
    CKEY PART /USER
  ------------------------------------------------------------------------------
   Get first particle ipc in class iclass.
                                                     H.Albrecht 27.11.88
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
              KCDIR .                                                              
   
 
3 KCDIRA
         FUNCTION KCDIRA (IPC,ICLASS,IANTI)
  ------------------------------------------------------------------------------
    CKEY PART /USER
  ------------------------------------------------------------------------------
   Get first particle ipc or its antip. in class iclass.
                                                     H.Albrecht 27.11.88
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
              KCDIRA.                                                              
   
 
3 KCHT
         INTEGER FUNCTION KCHT(ITK)
  ------------------------------------------------------------------------------
    CKEY TRACK /USER
  ------------------------------------------------------------------------------
   Get alpha track number of original copy of a charged track.
                                                     E. Blucher 24.1.92
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   CREFOL                                                                          
   V0SUM                                                                           
   QBMTAG                                                                          
   QDEDX                                                                           
   QDEDXM                                                                          
   QMTAIL                                                                          
   QPADX                                                                           
   QPAIRF                                                                          
        |---- KCHT                                                                 
                   |----  SIGN                                External             
                   |----  SQRT                                External             
                   |----  ABS                                 External             
                   |----  NINT                                External             
                   |----  KMATIX                              External             
                   |----  ATG                                 External             
                   |----  KCLARM                              External             
                   |----  IAND                                External             
                   |----  KLOCK0                              External             
                   |----  IABS                                External             
   
 
3 KD0FL
         INTEGER FUNCTION KD0FL(DUMMY)
  ------------------------------------------------------------------------------
    CKEY  FILL CHARGED / USER
  ------------------------------------------------------------------------------
   Tells which interaction point used to compute d0,z0
                                             J.Boucrot  03.02.98
     KD0FL = 1 if QFNDIP event primary vertex used
     KD0FL = 2 if event-chunk beam position used
     To get any of the above values, the data card 'D0NW' must be
     present in the user's data cards
     KD0FL = 3 if LEP 1 run-by-run average beam position used
     KD0FL = 0 if none of the above values available
                in that case a beam position x=y=z=0. was used
   
   
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
              KD0FL .                                                              
   
 
3 KFPADR
         FUNCTION KFPADR (IPC)
  ------------------------------------------------------------------------------
    CKEY PART /USER
  ------------------------------------------------------------------------------
   Get row # in qfpa corresponding to particle ipc.
                                                     H.Albrecht 27.11.88
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   MDSTRD                                                                          
   KTLORX                                                                          
   KVSAVA                                                                          
   KVSAVC                                                                          
   KVSAVE                                                                          
   QFBITM                                                                          
   QSBITM                                                                          
   QFCALD                                                                          
   QFCASC                                                                          
   QFCHGD                                                                          
   QFCOBJ                                                                          
   QFCREL                                                                          
   QFEFLO                                                                          
   QFGAMP                                                                          
   QFJETS                                                                          
   QFLJET                                                                          
   QFMCPA                                                                          
   QFNEOB                                                                          
   KIDSAV                                                                          
   KVFITA                                                                          
   KVFITC                                                                          
   KVFITM                                                                          
   KVFITN                                                                          
   KVFITV                                                                          
   KVFTMC                                                                          
   QJSAVE                                                                          
        |---- KFPADR.                                                              
   
 
3 KGLUND
         FUNCTION KGLUND (LUND)
  ------------------------------------------------------------------------------
    CKEY PART MC /INTERNAL
  ------------------------------------------------------------------------------
   Translate lund particle code lund into (new) aleph code kglund.
                                                     H.Albrecht 04.12.88
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   QAPTMP                                                                          
        |---- KGLUND                                                               
                   |----  NAMIND                              External             
                   |----  IABS                                External             
   
 
3 KGTBLQ
         INTEGER FUNCTION KGTBLQ(IRUN,IEVT,MINICHUNK,BLQPOS,BLQERR,IGAIN)
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
       Olivier Schneider, CERN-PPE/ALE, Aug 22, 1996
   Get the bom+qs0 beam position stored in blqp bank
       for run IRUN and event IEVT.
   
       Input:   IRUN = run number
       ------   IEVT = event number or 0 (see note below)
   
       Output:  MINICHUNK = mini-chunk number in run (= row number in BLQP bank)
       -------  BLQPOS(1) = x coordinate of beam position (cm)
                BLQPOS(2) = y coordinate of beam position (cm)
                BLQERR(1) = statistical error on BLQPOS(1)
                BLQERR(2) = statistical error on BLQPOS(2)
                IGAIN(1)  = gain flag side A
                IGAIN(2)  = gain flag side B
   
       Function value: error code with the following meaning:
       ---------------   0 means OK
                         1 means "unaligned" data is returned
                         2 means "unaligned" data without QS0 correction
                        -1 means bad input arguments
                        -2 means missing BLQP bank for run IRUN
                        -3 means no available data for event IEVT in BLQP bank
                        -4 means bad data for event IEVT in BLQP bank
   
       Notes: 1) A function value strictly below 0 indicates a fatal error;
       ------    in that case, and if the function value is not -4,
                 MINICHUNK is set to 0, the components of BLQPOS and IGAIN
                 are set to 0, and those of BLQERR to -1.
              2) A function value strictly above 0 indicates that only
                 "raw" data could be returned, i.e. data in the BOM system
                 of coordinates (rather than in the ALEPH system of coordinates);
                 this data might not include the QS0 corrections; in this case
                 the components of BLQERR are returnbed as -1.
              3) The statistical errors returned in BLQERR include only the
                 statistical uncertainties from the BOM alignment with
                 respect to ALEPH, as determined with VDET tracks; these
                 errors don't include the statistical and systematic
                 uncertainties attached to the BOM data itself.
              4) In the special case where IEVT=0 on input, BLQPOS and BLQERR
                 are filled with the fitted offset between the BOM coordinates
                 and the ALEPH (VDET) coordinates, the components of IGAIN are
                 filled with 0 and MINICHUNK is returned as 1 (because the
                 alignment constants are stored as the first mini-chunk !).
              5) The gain flags are bit coded words with the following meaning:
                   bits 0-1: gain for QS0 BPM e+
                   bits 2-3: gain for QS4 BPM e+
                   bits 4-5: gain for QS0 BPM e-
                   bits 6-7: gain for QS4 BPM e-
                 where each of the 4 gains has the following meaning:
                             gain = 0: -10 dB or info not available
                             gain = 1:   0 dB (low  gain physics setting)
                             gain = 2:  10 dB (high gain physics setting)
                             gain = 3:  20 dB or more
                 For example:
                   IGAIN(I)=  0  ---> gain information not available
                   IGAIN(I)= 85  ---> all 4 gains are 0 dB
                   IGAIN(I)= 90  ---> e-  gains are 0 dB and e+  gains are 10 dB
                   IGAIN(I)=102  ---> QS4 gains are 0 dB and QS0 gains are 10 dB
                   IGAIN(I)=153  ---> QS0 gains are 0 dB and QS4 gains are 10 dB
                   IGAIN(I)=165  ---> e+  gains are 0 dB and e-  gains are 10 dB
                   IGAIN(I)=170  ---> all 4 gains are 10 dB
                 Only 0 dB (low gain) and 10 dB (high gain) are supposed to be
                 used during physics; with the "new gain setting strategy" in
                 effect since 1996, the gains are set independently for each
                 beam polarity in each of the 4 BPM's ("Beam Position Monitors");
                 the change of gain (from 0 dB to 10 dB) should normally occur
                 only once per BPM in the course of a fill, for bunch currents
                 around 220 microAmps.
   
   
 
3 KLJTNO
         FUNCTION KLJTNO(IJET)
  ------------------------------------------------------------------------------
    CKEY FILL JETS LEPTONS / USER
  ------------------------------------------------------------------------------
   Get number of objects in lepton jet ijet
                                                     J.Boucrot  15.11.94
    Called from user
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
              KLJTNO.                                                              
   
 
3 KMCCOD
         FUNCTION KMCCOD (IEXT)
  ------------------------------------------------------------------------------
    CKEY PART /INTERNAL
  ------------------------------------------------------------------------------
   Get internal particle code for external code iext.
    Called from QFIMCD
                                                     H.Albrecht 03.11.88
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   FIXPART                                                                         
   QFMCPA                                                                          
        |---- KMCCOD                                                               
                   |----  CHAINT                              External             
                   |----  KPARTX                                                   
                   |----  IAND                                External             
                   |----  IOR                                 External             
                   |----  KPCOMP                                                   
                   |----  MAX                                 External             
                   |----  QWMESS                                                   
                   |----  QWMESE                                                   
                   |----  KMCCODFORMAT                        External             
   
 
3 KPART
         FUNCTION KPART (CINP)
  ------------------------------------------------------------------------------
    CKEY PART /INTERNAL
  ------------------------------------------------------------------------------
   Kpart: get particle code kpart for particle name cnam
    ENTRY KPANTI : Get particle code KPART for antiparticle of CNAM
                                                     H.Albrecht 27.11.88
    Completely rewritten to avoid ASSIGN statements  J.Boucrot  21.09.93
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   KPDIR                                                                           
   KPDIRA                                                                          
   KVSAVA                                                                          
   KVSAVC                                                                          
   KVSAVE                                                                          
   QMCHI2                                                                          
   QPCHAR                                                                          
   QPLIFE                                                                          
   QPMASS                                                                          
   QPWIDT                                                                          
   QVDROA                                                                          
   KIDSAV                                                                          
   KVFITA                                                                          
   KVFITC                                                                          
   KVFITM                                                                          
   KVFITN                                                                          
   KVFITV                                                                          
   KVFTMC                                                                          
   QJOPTM                                                                          
   QJOPTR                                                                          
   QJSAVE                                                                          
        |---- KPART                                                                
                   |----  KPCOMP                                                   
                   |----  IOR                                 External             
   
 
3 KPARTX
         FUNCTION KPARTX (CINP,IFLG)
  ------------------------------------------------------------------------------
    CKEY PART /INTERNAL
  ------------------------------------------------------------------------------
   Get particle code kpartx for name cinp. iflg = 0 if new particle.
                                                     H.Albrecht 27.11.88
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   KMCCOD                                                                          
   QAPNAM                                                                          
        |---- KPARTX                                                               
                   |----  KPCOMP                                                   
   
 
3 KPCOMP
         FUNCTION KPCOMP (CINP)
  ------------------------------------------------------------------------------
    CKEY PART /INTERNAL
  ------------------------------------------------------------------------------
   Get particle code from qpar. input : particle name cinp
                                                     H.Albrecht 27.11.88
      Add KPCHEK entry to just test                  T.Burnett  16.16.90
    Completely rewritten to use LOCTAB and 'QPSP'    J.Boucrot  21.09.93
   
   
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   MDSTRD                                                                          
   KMCCOD                                                                          
   KPART                                                                           
   KPANTI                                                                          
   KPARTX                                                                          
   QFBITM                                                                          
   QSBITM                                                                          
   QFCALD                                                                          
   QFCASC                                                                          
   QFCHGD                                                                          
   QFCOBJ                                                                          
   QFCREL                                                                          
   QFEFLO                                                                          
   QFGAMP                                                                          
   QFJETS                                                                          
   QFLJET                                                                          
   QFNEOB                                                                          
   QMASV0                                                                          
        |---- KPCOMP                                                               
                   |----  SPACES                              External             
                   |----  CLTOU                               External             
                   |----  INTCHA                              External             
                   |----  LNBLNK                              External             
                   |----  MAX0                                External             
                   |----  MIN0                                External             
                   |----  QSBANK                                                   
                   |----  QPPMMA                                                   
                   |----  QWMESS                                                   
                   |----  SORTIQ                              External             
   
 
3 KPDIR
         FUNCTION KPDIR (CPAR,ICLASS)
  ------------------------------------------------------------------------------
    CKEY PART CLASS /USER
  ------------------------------------------------------------------------------
   Get first particle cpar in class iclass.
                                                     H.Albrecht 27.11.88
                                      Modified:      E.Blucher   26.2.90
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   DLOCKS                                                                          
   ENFWLIST                                                                        
   GAMIXED                                                                         
   MINALGO                                                                         
   JETCLU                                                                          
   QIPBTAG                                                                         
   TRSEL                                                                           
   QSELEP                                                                          
   QVSJET                                                                          
   KNMCCH                                                                          
   KNMCEC                                                                          
   KNMCHC                                                                          
   QBMTAG                                                                          
   QCALE14                                                                         
        |---- KPDIR                                                                
                   |----  KPART                                                    
   
 
3 KPDIRA
         FUNCTION KPDIRA (CPAR,ICLASS,IANTI)
  ------------------------------------------------------------------------------
    CKEY PART /USER
  ------------------------------------------------------------------------------
   Get first particle cpar or its antip. in class iclass.
                                                     H.Albrecht 27.11.88
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
              KPDIRA                                                               
                   |----  KPART                                                    
   
 
3 KSCNEW
         FUNCTION KSCNEW (ICLASS)
  ------------------------------------------------------------------------------
    CKEY CLASS /INTERNAL
  ------------------------------------------------------------------------------
   Get sequential class number for iclass. new class if not existing.
                                                     H.Albrecht 27.11.88
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   KTLOR                                                                           
   KTLOR1                                                                          
   KVSAVC                                                                          
   QTCLAS                                                                          
        |---- KSCNEW                                                               
                   |----  MAX                                 External             
                   |----  QMTERM                                                   
   
 
3 KSCOLD
         FUNCTION KSCOLD (ICLASS)
  ------------------------------------------------------------------------------
    CKEY CLASS /INTERNAL
  ------------------------------------------------------------------------------
   Get sequential class number for iclass. return 0 if not existing.
                                                     H.Albrecht 27.11.88
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   QVDROP                                                                          
   QJEIG                                                                           
   QJSAVE                                                                          
   QJSET0                                                                          
   QJTENS                                                                          
        |---- KSCOLD.                                                              
   
 
3 KTLOR
         FUNCTION KTLOR (ITK,ITKRST)
  ------------------------------------------------------------------------------
    CKEY KINEMATICS /USER
  ------------------------------------------------------------------------------
   Boost itk and its daughters into the rest frame of itkrst.
                                                      H.Albrecht  2.1.89
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
              KTLOR                                                                
                   |----  KSCNEW                                                   
                   |----  KTLORX                                                   
                   |----  QADAU                                                    
                   |----  QAMOTH                                                   
                   |----  QWMESE                                                   
   
 
3 KTLOR1
         FUNCTION KTLOR1 (ITK,ITKRST)
  ------------------------------------------------------------------------------
    CKEY KINEMATICS /USER
  ------------------------------------------------------------------------------
   Boost itk into the rest frame of itkrst.
                                                      H.Albrecht  2.1.89
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
              KTLOR1                                                               
                   |----  KSCNEW                                                   
                   |----  KTLORX                                                   
   
 
3 KTLORX
         FUNCTION KTLORX (ITK,ICL,IFL,ITKRST)
  ------------------------------------------------------------------------------
    CKEY KINEMATICS /INTERNAL
  ------------------------------------------------------------------------------
   Boost itk into the rest frame of itkrst.
                                                      H.Albrecht  2.1.89
    I.Tomalin 9.5.97 : Allows boost of tracks with zero attributes.
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   KTLOR                                                                           
   KTLOR1                                                                          
   QTCLAS                                                                          
        |---- KTLORX                                                               
                   |----  QSBANK                                                   
                   |----  QMTERM                                                   
                   |----  KFPADR                                                   
                   |----  QWMESE                                                   
                   |----  QVZERO                                                   
   
 
3 KVNEW
         FUNCTION KVNEW (DUMMY)
  ------------------------------------------------------------------------------
    CKEY PART /USER
  ------------------------------------------------------------------------------
   Create new momentum=0 track with particle name cnam
                                                      H.Albrecht  2.1.89
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   BUILDAL                                                                         
   MDSTRD                                                                          
   JULMATCH                                                                        
   QBMTAG                                                                          
        |---- KVNEW                                                                
                   |----  QSBANK                                                   
   
 
3 KVSAVA
         FUNCTION KVSAVA (ITK,CNAM,IANTI)
  ------------------------------------------------------------------------------
    CKEY PART /USER
  ------------------------------------------------------------------------------
   Save particle with name cnam or with antipart (cname)
                                                      H.Albrecht  2.1.89
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
              KVSAVA                                                               
                   |----  QSBANK                                                   
                   |----  KPART                                                    
                   |----  KFPADR                                                   
                   |----  QAMOTH                                                   
                   |----  QWMESE                                                   
   
 
3 KVSAVC
         FUNCTION KVSAVC (ITK,CNAM,ICLASS)
  ------------------------------------------------------------------------------
    CKEY PART CLASS /USER
  ------------------------------------------------------------------------------
   Save particle with name cnam in class iclass.
                                                      H.Albrecht  2.1.89
     Modified to set bit mask.                        E.Blucher  26.7.90
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   BUILDAL                                                                         
   MDSTRD                                                                          
        |---- KVSAVC                                                               
                   |----  KSCNEW                                                   
                   |----  QSBANK                                                   
                   |----  KPART                                                    
                   |----  KFPADR                                                   
                   |----  QAMOTH                                                   
                   |----  QSBITM                                                   
   
 
3 KVSAVE
         FUNCTION KVSAVE (ITK,CNAM)
  ------------------------------------------------------------------------------
    CKEY PART /USER
  ------------------------------------------------------------------------------
   Save particle with name cnam
                                                      H.Albrecht  2.1.89
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   BUILDAL                                                                         
   QIPBTAG                                                                         
   QBMTAG                                                                          
        |---- KVSAVE                                                               
                   |----  QSBANK                                                   
                   |----  KPART                                                    
                   |----  KFPADR                                                   
                   |----  QAMOTH                                                   
                   |----  QWMESE                                                   
   
 
3 QADATI
         SUBROUTINE QADATI
  ------------------------------------------------------------------------------
    CKEY INIT /INTERNAL
  ------------------------------------------------------------------------------
   Print alpha header
    called from QMINIT
                                                     H.Albrecht 06.11.88
                                                     E. Blucher 08.04.89
                                  Modified:          E. Blucher 02.09.92
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   QMINIT                                                                          
        |---- QADATI                                                               
                   |----  ALMACH                              External             
                   |----  ALVERS                              External             
                   |----  EXIT                                External             
                   |----  TIMEST                              External             
                   |----  TIMEL                               External             
                   |----  TIMEX                               External             
                   |----  DATIMH                              External             
                   |----  QWMESS                                                   
   
 
3 QADAU
         SUBROUTINE QADAU (ITKM,NTKD,ITKD)
  ------------------------------------------------------------------------------
    CKEY QLIN /INTERNAL
  ------------------------------------------------------------------------------
   Mother - daughter relation between itkm and ntkd daughters itkd.
    This is trivial if it is a one - to many relation which never will
    be changed (e.g. : MC "truth"). The complication :
    Many - to many relation which can be modified at any time.
    For saving space in bank QLIN (track numbers pointing from mothers
    to daughters and vice versa), space is reserved essentially in
    multiples of 8.
                                                      H.Albrecht  2.1.89
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   KTLOR                                                                           
   QFCASC                                                                          
   QNVSTO                                                                          
   QVADDN                                                                          
   QVCROS                                                                          
   KVFITC                                                                          
   KVFITN                                                                          
   KVFITV                                                                          
   KVFTMC                                                                          
   QJSAVE                                                                          
        |---- QADAU .                                                              
   
 
3 QAINTA
         SUBROUTINE QAINTA
  ------------------------------------------------------------------------------
    CKEY PACK /INTERNAL
  ------------------------------------------------------------------------------
   Interactive job ?
    appropriate CERNLIB routine INTRAC does not exist on IBM (?).
    terminal output unit.
                                                     H.Albrecht 10.11.88
                                     CRAY flag added E.Blucher  09.09.89
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   QMINIT                                                                          
        |---- QAINTA                                                               
                   |----  INTRAC                              External             
   
 
3 QAMOTH
         SUBROUTINE QAMOTH (ITKM,NTKD,ITKD)
  ------------------------------------------------------------------------------
    CKEY QLIN /INTERNAL
  ------------------------------------------------------------------------------
   Daughter - mother relation between itkm and ntkd daughters itkd.
    This is trivial if it is a one - to many relation which never will
    be changed (e.g. : MC "truth"). The complication :
    Many - to many relation which can be modified at any time.
    For saving space in bank QLIN (track numbers pointing from mothers
    to daughters and vice versa), space is reserved essentially in
    multiples of 8.
                                                      H.Albrecht  2.1.89
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   KTLOR                                                                           
   KVSAVA                                                                          
   KVSAVC                                                                          
   KVSAVE                                                                          
   QFCASC                                                                          
   QFREV0                                                                          
   QFYLV0                                                                          
   QNVSTO                                                                          
   KIDSAV                                                                          
   KVFITA                                                                          
   KVFITM                                                                          
        |---- QAMOTH.                                                              
   
 
3 QANFILI
         SUBROUTINE QANFILI(CARD,TAPE,FILE)
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Examine the content of a fili card to extract tape + file #
    J. Boucrot        14-Mar-2000
    Input argument :
      CARD = FILI CARD
    Output arguments :
      TAPE = tape name e.g. R01234 , blank if any error
      FILE = file number (< 1000 ) , blank if any error
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   QFKIREV                                                                         
   QMSTCLR                                                                         
   QMSTGIN                                                                         
        |---- QANFILI                                                              
                   |----  LNBLNK                              External             
                   |----  CLTOU                               External             
                   |----  INDEX                               External             
                   |----  ICFNBL                              External             
                   |----  BKINCA                              External             
   
 
3 QAPNAM
         SUBROUTINE QAPNAM (CPAR,CANT,IFLG, IPAR,IANT)
  ------------------------------------------------------------------------------
    CKEY PART /INTERNAL
  ------------------------------------------------------------------------------
   Get particle codes from particle names; check part-antip relation;
    check whether particles do exist already
    IFLG = 0 : particles should not yet exist
    IFLG = 1 : particles should already exist
    IFLG = -1 : don't care
    from QCPxxx
                                                     H.Albrecht 15.01.89
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   QCPMOD                                                                          
   QCPNEW                                                                          
   QCPTRA                                                                          
        |---- QAPNAM                                                               
                   |----  KPARTX                                                   
                   |----  LENOCC                              External             
   
 
3 QAPTMP
         SUBROUTINE QAPTMP
  ------------------------------------------------------------------------------
    CKEY PART /INTERNAL
  ------------------------------------------------------------------------------
   Translate old fashioned particle table into the new one.
    create a new PART bank and a translation table QTMP.
    delete this routine if old tables do not exist any more.
    called from QMNEWR
                                                     H.Albrecht 12.01.89
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
              QAPTMP                                                               
                   |----  NBANK                               External             
                   |----  KGLUND                                                   
                   |----  NDROP                               External             
                   |----  BSWAP                               External             
   
 
3 QBOMEV
         SUBROUTINE QBOMEV
  ------------------------------------------------------------------------------
    CKEY BOM /INTERNAL
  ------------------------------------------------------------------------------
   Calculate beam position from boms.
                                                     R. Forty   02.02.92
    Called from QFHEAD
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   QFHEAD                                                                          
        |---- QBOMEV.                                                              
   
 
3 QBOMRU
         SUBROUTINE QBOMRU
  ------------------------------------------------------------------------------
    CKEY BOM /INTERNAL
  ------------------------------------------------------------------------------
   Get run-by-run bom constants from database.
                                                     R. Forty   02.02.92
    Called from QMNEWR
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   QMNEWR                                                                          
        |---- QBOMRU                                                               
                   |----  ALGTRO                              External             
                   |----  IABS                                External             
   
 
3 QBOOK1
         SUBROUTINE QBOOK1 (ID,CHTITL,NX,XMI,XMA,VMX)
  ------------------------------------------------------------------------------
    CKEY HIST /USER
  ------------------------------------------------------------------------------
   Alpha version of hbook1
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
              QBOOK1                                                               
                   |----  HBOOK1                              External             
                   |----  HEXIST                              External             
   
 
3 QBOOK2
         SUBROUTINE QBOOK2 (ID,CHTITL,NX,XMI,XMA,NY,YMI,YMA,VMX)
  ------------------------------------------------------------------------------
    CKEY HIST /USER
  ------------------------------------------------------------------------------
   Alpha version of hbook2
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
              QBOOK2.                                                              
   
 
3 QBOOKN
         SUBROUTINE QBOOKN (ID,CHTITL,NVAR,CTAG)
  ------------------------------------------------------------------------------
    CKEY HIST /USER
  ------------------------------------------------------------------------------
   Alpha shortversion of hbookn
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
              QBOOKN.                                                              
   
 
3 QBOOKR
         SUBROUTINE QBOOKR(ID,NAME,NVAR,USNAM)
  ------------------------------------------------------------------------------
    CKEY HIST /USER
  ------------------------------------------------------------------------------
   Book ntuples with 2 more variables to store run/event numbers
   Authors  V. Journe - J. Boucrot       10-Nov-1988
    from USER
     HBOOKN                                    from HBOOK4 Lib
    Input arguments :
      ID  =  Ntuple identifier ( must be # 0 )
     NAME =  Ntuple name ( up to 80 characters )
     NVAR =  Number of variables per element of the Ntuple
    USNAM =  array of user-defined names of the NVAR variables
             ( 8 characters maximum , as prescribed by HBOOK4 )
    is prepared the facility to store the event and run number
     automatically as the two last variables of Ntuple # ID .
    benefit from this facility , the filling of the Ntuple
     must be be done by the routine QHFR .
   ATION : Do not define Ntuples with more than 80 variables
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
              QBOOKR                                                               
                   |----  WBANK                               External             
                   |----  INTCHA                              External             
                   |----  HBOOKN                              External             
                   |----  QMTERM                                                   
   
 
3 QBPROF
         SUBROUTINE QBPROF(ID,CHTITL,NX,XMI,XMA,YMI,YMA,CHOPT)
  ------------------------------------------------------------------------------
    CKEY HIST /USER
  ------------------------------------------------------------------------------
   Alpha version of hbprof
    Author : I. Tomalin    27-Jul-1993
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
              QBPROF                                                               
                   |----  HBPROF                              External             
                   |----  HEXIST                              External             
   
 
3 QCABSA
         SUBROUTINE QCABSA(RL,PMOM,ISIDE,IDEL,RLN)
  ------------------------------------------------------------------------------
    CKEY  FILL / INTERNAL
  ------------------------------------------------------------------------------
   Recalculates rl for electron - auxiliary to fixrtrl
    Called from FIXRTRL
                                   Author: M.N Minard 10/11/93
       Input : RL   Estimator stored in preceeding processing
               PMOM Track momentum
               ISIDE = 1 Barrel , 2 Endcap , 3 Overlap
               IDEL  Correction level (1 Monte_carlo 92)
       Output : New estimator
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   FIXRTRL                                                                         
        |---- QCABSA                                                               
                   |----  ALOG                                External             
   
 
3 QCAF4C
         SUBROUTINE QCAF4C(PMOM,TETIFL,XCOS,IDEL,ISIDE,RTO,RTN)
  ------------------------------------------------------------------------------
    CKEY  FILL / INTERNAL
  ------------------------------------------------------------------------------
   Correct rt for various data sets - auxiliary to fixrtrl
    Called from FIXRTRL
                                      Author M.N Minard 10/11/93
       Input  PMOM    Track momentum
              TETIFL  ECAL theta impact in ECAL numbering
              XCOS    Track Z cosine director
              IDEL    Correction range according DB and Julia version
              ISIDE   =1 Barrel , 2 Endcap , 3 Overlap
              RTO     Previous RT value
       Output RTN     New RT value
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   FIXRTRL                                                                         
        |---- QCAF4C                                                               
                   |----  NINT                                External             
                   |----  SQRT                                External             
   
 
3 QCORFIC
         REAL FUNCTION QCORFIC(ENE,ITH,IPH,ICTRL)
  ------------------------------------------------------------------------------
    CKEY EVENT / INTERNAL
  ------------------------------------------------------------------------------
   Auxiliary to hcalensc          a. sciaba   5-98
       Correction to the HCAL tower energy due to
       errors in the calibration of 1996-98 data
               Revised             12-APR-1999
       Input:
       ENE      R      tower energy
       ITH      I      theta index
       IPH      I      phi index
       ICTRL    I      correction mode:
                       = 1 if running on old reprocessing (JULIA
                           version 306 or less)
                       = 2 if running on last reprocessing
                           database version 246 or less)
   
   -------------------- /QCDE/ --- COMMONs, DIMENSIONs, etc. ------------
   
    of QCDESH ----------------------- Description in QDATA ---------
         PARAMETER (KCQDET=34, KCQFPA=8, KCQPAR=10, KCQVEC=73, KCQVRT=30,
        & KHE=1, KHMU=2, KHPI=3, KHK=4, KHP=5, KHPHOT=1, KHNHAD=2,
        & KMONTE=-2, KRECO=-1, KLOCKM=14, KSOVT=1, KSCHT=2, KSIST=3,
        & KSAST=4, KSEHT=5, KSV0T=6, KSDCT=7, KSEFT=8, KSNET=9, KSGAT=10,
        & KSJET=11, KSMCT=12, KSREV=13,
        & KSMCV=14, KUNDEF=-12344321, QQPI=3.141593, QQE=2.718282,
        & QQ2PI=QQPI*2., QQPIH=QQPI/2., QQRADP=180./QQPI, QQC=2.997925E10,
        & QQH=6.582173E-25, QQHC=QQH*QQC, QQIRP=.00029979)
         CHARACTER CQDATE*8, CQDWRK*80, CQFHIS*80, CQFOUT*80, CQFWRK*80,
        & CQHTIT*80, CQSEC*3, CQTIME*8, CQUNPK*30, CQVERS*6, CQRLST*800,
        & CQELST*800
         COMMON /QCDEC/ CQDATE, CQDWRK, CQFHIS, CQFOUT, CQFWRK, CQHTIT,
        & CQSEC(14), CQTIME, CQUNPK, CQVERS, CQRLST, CQELST
         COMMON /QCDE/ QELEP, QMFLD ,QMFLDC, QTIME, QTIMEI, QTIMEL,
        & QTIMES, QTIMET, QDHEEC, QDHEEL, QDHEPF, QDHETH, QDHEPH, QDHEEF,
        & QDHEET, QDHET1, QDHEP1, QDHET2, QDHEP2, QDHEE1, QDHEE2, QDHEE3,
        & QKEVRN, QKEVWT, QVXNOM, QVYNOM, QVZNOM, QVXNSG, QVYNSG, QVZNSG,
        & QINLUM, QRINLN, QRINLU, QDBOFS, QEECWI(36), QVXBOM, QVYBOM,
        & QSILUM, QRSLLU, QRSLBK, QRSLEW , QVTXBP(3), QVTEBP(3), QVTSBP(3)
         COMMON /QCDE/  KFOVT, KLOVT, KNOVT, KFCHT, KLCHT, KNCHT, KFIST,
        & KLIST, KNIST, KFAST, KLAST, KNAST, KFEHT, KLEHT, KNEHT, KFV0T,
        & KLV0T, KNV0T, KFDCT, KLDCT, KNDCT, KFEFT, KLEFT, KNEFT, KFNET,
        & KLNET, KNNET, KFGAT, KLGAT, KNGAT, KFJET, KLJET, KNJET, KFMCT,
        & KLMCT, KNMCT, KFREV, KLREV, KNREV, KFMCV, KLMCV, KNMCV, KLUST,
        & KLUSV, KFFRT, KLFRT, KFFRV, KLFRV, KNRET, KNCOT, KFFRD,
        & KLFJET,KLLJET,KLNJET
         COMMON /QCDE/ KBIT(32), KCLACO(KCQFPA), KCLAFR(KCQFPA), KCLARM
        & (KCQFPA), KDEBUG, KEVT, KEXP, KFFILL, KFEOUT, KJOPTN(2,2),
        & KLEOUT, KLROUT, KLOCK0(KLOCKM,2), KLOCK1(KLOCKM,2), KLOCK2(
        & KLOCKM,2), KMATIX(6,6), KMQFPA, KNEFIL, KNEOUT, KNEVT, KNPAST,
        & KNQDET, KNQFPA, KNQLIN, KNQMTX, KNQPAR, KNQPST, KNREIN, KNREOU,
        & KOQDET, KOQFPA, KOQLIN, KOQMTL, KOQMTS, KOQPAR, KOQPBT, KOQPLI,
        & KOQTRA, KOQVEC, KOQVRT, KQPAR, KQVEC, KQVRT, KQWRK, KQZER, KRUN,
        & KSTATU, KTDROP, KUCARD, KUCONS, KUHIST, KUINPU, KUOUTP, KUPRNT,
        & KUPTER, KDEBU1, KDEBU2, KNWRLM, KEFOPT, KUEDIN, KUEDOU, KURTOX,
        & KUCAR2, KNHDRN, KNBHAB, KSBHAB, KRSLLQ, KRSLNB
         COMMON /QCDE/ INDATA
         COMMON /QCDE/ KRINNE, KRINNF, KRINDC, KRINDQ, KRINNZ, KRINNB,
        & KRINBM, KRINFR, KRINLR, KRINLF
         COMMON /QCDE/ KEVERT, KEVEDA, KEVETI, KEVEMI(4), KEVETY, KEVEES,
        & KDHEFP, KDHENP, KDHENM, KKEVNT, KKEVNV, KKEVID, KDHENX, KDHENV,
        & KDHENJ, KREVDS, KXTET1, KXTET2, KXTEL2, KXTCGC, KXTCLL, KXTCBN,
        & KXTCCL, KXTCHV, KXTCEN, KCLASW, KERBOM, KBPSTA
         DIMENSION KLOCUS(3,14)
         EQUIVALENCE (KLOCUS(1,1),KFOVT), (KFOVT,KFRET), (KLIST,KLRET),
        & (KFIST,KFCOT), (KLAST,KLCOT)
         COMMON /QCDE/ XCOPYJ, XFLIAC, XHISTO, XLREV(2), XLREV2(2), XMCEV,
        & XMINI, XSYNTX, XWREVT, XWRRUN, XFILMC, XFILCH, XFILV0, XFILCO,
        & XFILEF, XFILPC, XFILGA, XFILJE,
        & XPRHIS, XFILL, XVITC, XVTPC, XVECAL, XVLCAL, XVTPCD,
        & XVSATR, XVHCAL, XHVTRG, XSREC, XWMINI, XIOKLU, XIOKSI, XFRF2,
        & XNSEQ, XVDOK, XFRF0, XFMUID, XFILEM, XWNANO, XROKSI, XGETBP,
        & XJTHRU
         LOGICAL XCOPYJ, XFLIAC, XHISTO, XLREV, XLREV2, XMCEV, XMINI,
        & XSYNTX, XWREVT, XWRRUN, XFILMC, XFILCH, XFILV0, XFILCO, XFILEF,
        & XFILPC, XPRHIS, XFILL, XVITC, XVTPC, XVECAL, XVLCAL, XVTPCD,
        & XVSATR, XVHCAL, XHVTRG, XSREC, XWMINI, XIOKLU, XFRF2, XFILJE,
        & XNSEQ, XFILGA, XVDOK, XFRF0, XFMUID, XFILEM, XWNANO, XIOKSI,
        & XROKSI, XGETBP, XJTHRU
   
   -------------------- /NANCOM/ --- NanoDst steering -------------------
    XNANO   .TRUE. if input is a NanoDst (in NANO or EPIO format, depending
                      XNANOR)
   
         LOGICAL XNANO
         COMMON /NANCOM/XNANO
   
   
    bcs
         INTEGER LMHLEN, LMHCOL, LMHROW
         PARAMETER (LMHLEN=2, LMHCOL=1, LMHROW=2)
         COMMON /BCS/   IW(1000)
         INTEGER IW
         REAL RW(1000)
         EQUIVALENCE (RW(1),IW(1))
   
   
   ------------------ /QCNAMI/ --- name indices -------------------------
         COMMON /QCNAMI/ NAAFID,NAAJOB,NAASEV,NABCNT,NABHIT,NABOMB,
        1 NABOME,NABOMP,NABOMR,NABPTR,NADCAL,NADCRL,NADECO,NADEID,NADENF,
        2 NADEVT,NADEWI,NADFMC,NADFOT,NADGAM,NADHCO,NADHEA,NADHRL,NADJET,
        3 NADMID,NADMJT,NADMUO,NADNEU,NADPOB,NADRES,NADTBP,NADTMC,NADTRA,
        4 NADVER,NADVMC,NAECRQ,NAECTE,NAEGID,NAEGPC,NAEIDT,NAEJET,NAERRF,
        5 NAETDI,NAETKC,NAEVEH,NAEWHE,NAFICL,NAFKIN,NAFPOI,NAFPOL,NAFRFT,
        6 NAFRID,NAFRTL,NAFSTR,NAFTCL,NAFTCM,NAFTOC,NAFTTM,NAFVCL,NAFVER,
        7 NAFZFR,NAHCCV,NAHCTE,NAHINF,NAHMAD,NAHPDI,NAHROA,NAHSDA,NAHTUB,
        8 NAIASL,NAIPJT,NAIRJT,NAITCO,NAITMA,NAIXTR,NAIZBD,NAJBER,NAJEST,
        9 NAJSUM,NAKEVH,NAKINE,NAKJOB,NAKLIN,NAKPOL,NAKRUN,NALIDT,NALOLE,
        A NALUPA,NAMCAD,NAMHIT,NAMTHR,NAMUDG,NAMUEX,NAOSTS,NAPART,NAPASL,
        B NAPCHY,NAPCOB,NAPCOI,NAPCPA,NAPCQA,NAPCRL,NAPECO,NAPEHY,NAPEID,
        C NAPEMH,NAPEPT,NAPEST,NAPEWI,NAPFER,NAPFHR,NAPFRF,NAPFRT,NAPHCO,
        D NAPHER,NAPHHY,NAPHMH,NAPHST,NAPIDI,NAPITM,NAPLID,NAPLPD,NAPLSD,
        E NAPMSK,NAPNEU,NAPPDS,NAPPOB,NAPPRL,NAPRTM,NAPSCO,NAPSPO,NAPSTR,
        F NAPT2X,NAPTBC,NAPTCO,NAPTEX,NAPTMA,NAPTML,NAPTNC,NAPTST,NAPVCO,
        G NAPYER,NAPYFR,NAPYNE,NAQDET,NAQFPA,NAQLIN,NAQMTL,NAQMTS,NAQPAR,
        H NAQPBT,NAQPLI,NAQTRA,NAQVEC,NAQVRT,NAQWRK,NAQZER,NAREVH,NARHAH,
        I NARTLO,NARTLS,NARUNH,NARUNR,NASFTR,NATEXS,NATGMA,NATMTL,NATPCO,
        J NAVCOM,NAVCPL,NAVDCO,NAVDHT,NAVDXY,NAVDZT,NAVERT,NAVFHL,NAVFLG,
        K NAVFPH,NAVHLS,NAVPLH,NAX1AD,NAX1SC,NAX1TI,NAX2DF,NAX3EC,NAX3EW,
        L NAX3HC,NAX3IT,NAX3L2,NAX3LU,NAX3TM,NAX3TO,NAX3TP,NAX3X3,NAXTBN,
        M NAXTBP,NAXTCN,NAXTEB,NAXTOP,NAXTRB,NAYV0V,NAZPFR,NAEFOL,NAMUID,
        N NAPGID,NAPGPC,NAPGAC,NAPMSC,NAPTHR,NANBIP,NAPDLT,NAPMLT,NAPLJT
   
   
   ------------------ /QQQQJJ/ --- HAC parameters for ALPHA banks -------
         PARAMETER (JQVEQX= 1,JQVEQY= 2,JQVEQZ= 3,JQVEQE= 4,JQVEQM= 5,
        & JQVEQP= 6,JQVECH= 7,JQVETN= 8,JQVESC= 9,JQVEKS=10,JQVECL=11,
        & JQVEPA=12,JQVEQD=13,JQVENP=14,JQVESP=15,JQVEOV=16,JQVEEV=17,
        & JQVEND=18,JQVEDL=19,JQVENO=20,JQVEOL=21,JQVENM=22,JQVEML=23,
        & JQVEBM=24,JQVELK=38,JQVEDB=39,JQVEZB=40,JQVESD=41,JQVESZ=42,
        & JQVECB=43,JQVEEM=44,JQVECF=54,JQVEEW=55,JQVEUS=56)
         PARAMETER ( JQVRVX=1,JQVRVY=2,JQVRVZ=3,JQVRVN=4,JQVRTY=5,
        1   JQVRIP=6,JQVRND=7,JQVRDL=8,JQVRAY=9,JQVRAF=10,JQVREM=11,
        2   JQVRCF=17,JQVRET=18)
         PARAMETER ( JQDEAF= 1,JQDEAL= 2,JQDENT= 3,JQDEAT= 4,JQDELT= 8,
        &  JQDEAE= 9,JQDEAH=10,JQDEAM=11,JQDECF=12,JQDEEC=13,JQDEHC=14,
        &  JQDEET=15,JQDEFI=16,JQDENF=17,JQDEFL=18,JQDENE=19,JQDEEL=20,
        &  JQDENH=21,JQDEHL=22,JQDELH=23,JQDEEF=24,JQDEPC=25,JQDEEG=26,
        &  JQDEMU=27,JQDEDX=28,JQDEPG=29,JQDEPD=30,JQDEPM=31)
         PARAMETER ( JQPAGN=1, JQPANA=2, JQPACO=5, JQPAMA=6, JQPACH=7,
        & JQPALT=8,JQPAWI=9,JQPAAN=10)
   
   
         EXTERNAL CQPART, CQTPN, XCEQAN, XLUMOK, XPEQAN, XPEQOR, XPEQU,
        & XVDEOK, LLUMOK, SLUMOK
         CHARACTER * 12 CQPART, CQTPN
         LOGICAL XCAL, XCEQAN, XCEQOR, XCEQU, XECAL, XEID, XFRF, XHCAL,
        & XHMA, XLOCK, XLOCKN, XMC, XLUMOK, XMCA, XPEO, XPHO, XPEQAN,
        & XPEQOR, XPEQU, XSAME, XSIG, XTEX, XPEC, XPEP, XPHC, XYV0,
        & XFRIQF, XEFO, XPCQ, XEGP, XMUI, XVDEOK, XPGP, LLUMOK, SLUMOK,
        & XPGAC, XLEPTG, XLEPTH
   
    alcons
    define universal constants
         REAL PI, TWOPI, PIBY2, PIBY3, PIBY4, PIBY6, PIBY8, PIBY12
         REAL RADEG, DEGRA
         REAL CLGHT, ALDEDX
         PARAMETER (PI=3.141592653589)
         PARAMETER (RADEG=180./PI, DEGRA=PI/180.)
         PARAMETER (TWOPI = 2.*PI , PIBY2 = PI/2., PIBY4 = PI/4.)
         PARAMETER (PIBY6 = PI/6. , PIBY8 = PI/8.)
         PARAMETER (PIBY12= PI/12., PIBY3 = PI/3.)
         PARAMETER (CLGHT = 29.9792458, ALDEDX = 0.000307)
   
         ALDEDX  = constant used in the computation of DEDX in GeV
         CLGHT   = speed of light in cm/nsec
   
   
   
    efoljj
         INTEGER JEFOPX,JEFOPY,JEFOPZ,JEFOEW,JEFOWE,JEFOTY,JEFOLE,JEFOLT,
        +          JEFOLH,JEFOLC,JEFOLJ,LEFOLA
         PARAMETER(JEFOPX=1,JEFOPY=2,JEFOPZ=3,JEFOEW=4,JEFOWE=5,JEFOTY=6,
        +          JEFOLE=7,JEFOLT=8,JEFOLH=9,JEFOLC=10,JEFOLJ=11,
        +          LEFOLA=11)
   
   
    egpcjj
         INTEGER JEGPPX,JEGPPY,JEGPPZ,JEGPR1,JEGPR2,JEGPF4,JEGPDM,JEGPST,
        +          JEGPQU,JEGPPE,LEGPCA
         PARAMETER(JEGPPX=1,JEGPPY=2,JEGPPZ=3,JEGPR1=4,JEGPR2=5,JEGPF4=6,
        +          JEGPDM=7,JEGPST=8,JEGPQU=9,JEGPPE=10,LEGPCA=10)
   
   
    eidtjj
         INTEGER JEIDIF,JEIDR1,JEIDR2,JEIDR3,JEIDR4,JEIDR5,JEIDR6,JEIDR7,
        +          JEIDEC,JEIDIP,JEIDE1,JEIDE2,JEIDE3,JEIDFR,JEIDPE,LEIDTA
         PARAMETER(JEIDIF=1,JEIDR1=2,JEIDR2=3,JEIDR3=4,JEIDR4=5,JEIDR5=6,
        +          JEIDR6=7,JEIDR7=8,JEIDEC=9,JEIDIP=10,JEIDE1=11,
        +          JEIDE2=12,JEIDE3=13,JEIDFR=14,JEIDPE=15,LEIDTA=15)
   
   
    frftjj
         INTEGER JFRFIR,JFRFTL,JFRFP0,JFRFD0,JFRFZ0,JFRFAL,JFRFEM,JFRFC2,
        +          JFRFDF,JFRFNO,LFRFTA
         PARAMETER(JFRFIR=1,JFRFTL=2,JFRFP0=3,JFRFD0=4,JFRFZ0=5,JFRFAL=6,
        +          JFRFEM=7,JFRFC2=28,JFRFDF=29,JFRFNO=30,LFRFTA=30)
   
   
    fridjj
         INTEGER JFRIBP,JFRIDZ,JFRIBC,JFRIDC,JFRIPE,JFRIPM,JFRIPI,JFRIPK,
        +          JFRIPP,JFRINK,JFRIQF,LFRIDA
         PARAMETER(JFRIBP=1,JFRIDZ=2,JFRIBC=3,JFRIDC=4,JFRIPE=5,JFRIPM=6,
        +          JFRIPI=7,JFRIPK=8,JFRIPP=9,JFRINK=10,JFRIQF=11,
        +          LFRIDA=11)
   
   
    frtljj
         INTEGER JFRTIV,JFRTNV,JFRTII,JFRTNI,JFRTNE,JFRTIT,JFRTNT,JFRTNR,
        +          LFRTLA
         PARAMETER(JFRTIV=1,JFRTNV=2,JFRTII=3,JFRTNI=4,JFRTNE=5,JFRTIT=6,
        +          JFRTNT=7,JFRTNR=8,LFRTLA=8)
   
   
    hmadjj
         INTEGER JHMANF,JHMANE,JHMANL,JHMAMH,JHMAIG,JHMAED,JHMACS,JHMAND,
        +          JHMAIE,JHMAIT,JHMAIF,JHMATN,LHMADA
         PARAMETER(JHMANF=1,JHMANE=2,JHMANL=3,JHMAMH=4,JHMAIG=5,JHMAED=6,
        +          JHMACS=7,JHMAND=8,JHMAIE=9,JHMAIT=10,JHMAIF=11,
        +          JHMATN=12,LHMADA=12)
   
   
    mcadjj
         INTEGER JMCANH,JMCADH,JMCADC,JMCAAM,JMCAAC,JMCATN,LMCADA
         PARAMETER(JMCANH=1,JMCADH=3,JMCADC=5,JMCAAM=7,JMCAAC=8,JMCATN=9,
        +          LMCADA=9)
   
   
    muidjj
         INTEGER JMUIIF,JMUISR,JMUIDM,JMUIST,JMUITN,LMUIDA
         PARAMETER(JMUIIF=1,JMUISR=2,JMUIDM=3,JMUIST=4,JMUITN=5,LMUIDA=5)
   
   
    pcqajj
         INTEGER JPCQNA,JPCQPX,JPCQPY,JPCQPZ,JPCQEN,LPCQAA
         PARAMETER(JPCQNA=1,JPCQPX=2,JPCQPY=3,JPCQPZ=4,JPCQEN=5,LPCQAA=5)
   
   
    pdltjj
         INTEGER JPDLPA,JPDLJT,JPDLPI,JPDLPE,JPDLVP,JPDLFR,LPDLTA
         PARAMETER(JPDLPA=1,JPDLJT=2,JPDLPI=3,JPDLPE=4,JPDLVP=5,JPDLFR=6,
        +          LPDLTA=6)
   
   
    pecojj
         INTEGER JPECER,JPECE1,JPECE2,JPECTH,JPECPH,JPECEC,JPECKD,JPECCC,
        +          JPECRB,JPECPC,LPECOA
         PARAMETER(JPECER=1,JPECE1=2,JPECE2=3,JPECTH=4,JPECPH=5,JPECEC=6,
        +          JPECKD=7,JPECCC=8,JPECRB=9,JPECPC=10,LPECOA=10)
   
   
    peptjj
         INTEGER JPEPT1,JPEPP1,JPEPT3,JPEPP3,LPEPTA
         PARAMETER(JPEPT1=1,JPEPP1=2,JPEPT3=3,JPEPP3=4,LPEPTA=4)
   
   
    pgacjj
         INTEGER JPGAEC,JPGATC,JPGAPC,JPGAR1,JPGAR2,JPGAF4,JPGADM,JPGAST,
        +          JPGAQU,JPGAQ1,JPGAQ2,JPGAM1,JPGAM2,JPGAMA,JPGAER,JPGATR,
        +          JPGAPR,JPGAEF,JPGAGC,JPGAZS,JPGAPL,JPGAPH,JPGAPN,JPGAFA,
        +          JPGAPE,LPGACA
         PARAMETER(JPGAEC=1,JPGATC=2,JPGAPC=3,JPGAR1=4,JPGAR2=5,JPGAF4=6,
        +          JPGADM=7,JPGAST=8,JPGAQU=9,JPGAQ1=10,JPGAQ2=11,
        +          JPGAM1=12,JPGAM2=13,JPGAMA=14,JPGAER=15,JPGATR=16,
        +          JPGAPR=17,JPGAEF=18,JPGAGC=19,JPGAZS=20,JPGAPL=21,
        +          JPGAPH=22,JPGAPN=23,JPGAFA=24,JPGAPE=25,LPGACA=25)
   
   
    pgpcjj
         INTEGER JPGPEC,JPGPTC,JPGPPC,JPGPR1,JPGPR2,JPGPF4,JPGPDM,JPGPST,
        +          JPGPQU,JPGPQ1,JPGPQ2,JPGPM1,JPGPM2,JPGPMA,JPGPER,JPGPTR,
        +          JPGPPR,JPGPPE,LPGPCA
         PARAMETER(JPGPEC=1,JPGPTC=2,JPGPPC=3,JPGPR1=4,JPGPR2=5,JPGPF4=6,
        +          JPGPDM=7,JPGPST=8,JPGPQU=9,JPGPQ1=10,JPGPQ2=11,
        +          JPGPM1=12,JPGPM2=13,JPGPMA=14,JPGPER=15,JPGPTR=16,
        +          JPGPPR=17,JPGPPE=18,LPGPCA=18)
   
   
    phcojj
         INTEGER JPHCER,JPHCTH,JPHCPH,JPHCEC,JPHCKD,JPHCCC,JPHCRB,JPHCNF,
        +          JPHCPC,LPHCOA
         PARAMETER(JPHCER=1,JPHCTH=2,JPHCPH=3,JPHCEC=4,JPHCKD=5,JPHCCC=6,
        +          JPHCRB=7,JPHCNF=8,JPHCPC=9,LPHCOA=9)
   
   
    pmltjj
         INTEGER JPMLFL,JPMLPO,JPMLCH,JPMLSP,JPMLLE,JPMLME,JPMLKT,JPMLFR,
        +          LPMLTA
         PARAMETER(JPMLFL=1,JPMLPO=2,JPMLCH=3,JPMLSP=4,JPMLLE=5,JPMLME=6,
        +          JPMLKT=7,JPMLFR=8,LPMLTA=8)
   
   
    texsjj
         INTEGER JTEXSI,JTEXTM,JTEXTL,JTEXNS,JTEXAD,JTEXTN,JTEXSF,LTEXSA
         PARAMETER(JTEXSI=1,JTEXTM=2,JTEXTL=3,JTEXNS=4,JTEXAD=5,JTEXTN=6,
        +          JTEXSF=7,LTEXSA=7)
   
   
    yv0vjj
         INTEGER JYV0K1,JYV0K2,JYV0VX,JYV0VY,JYV0VZ,JYV0VM,JYV0PX,JYV0PY,
        +          JYV0PZ,JYV0PM,JYV0X1,JYV0X2,JYV0XM,JYV0C2,JYV0IC,JYV0P1,
        +          JYV0P2,JYV0EP,JYV0DM,JYV0S1,JYV0S2,LYV0VA
         PARAMETER(JYV0K1=1,JYV0K2=2,JYV0VX=3,JYV0VY=4,JYV0VZ=5,JYV0VM=6,
        +          JYV0PX=12,JYV0PY=13,JYV0PZ=14,JYV0PM=15,JYV0X1=21,
        +          JYV0X2=22,JYV0XM=23,JYV0C2=26,JYV0IC=27,JYV0P1=28,
        +          JYV0P2=31,JYV0EP=34,JYV0DM=55,JYV0S1=56,JYV0S2=57,
        +          LYV0VA=57)
   
   
         REAL FIC(36), IM96O(36), IM96N(36), IM97O(36), IM97N(36),
        &     IM98O(36), IM98N(36)
         REAL GC96N(2), GC97N(2), GC98N(2)
         REAL IMO(3,36), IMN(3,36), GCN(3,2)
         INTEGER INEVT / -1 /
         LOGICAL FIRST / .TRUE. /
         DATA FIC / 0.599, 0.477, 0.466, 0.460, 0.518, 0.472,
        &           0.508, 0.547, 0.536, 0.500, 0.527, 0.623,
        &           0.624, 0.692, 0.773, 0.753, 0.706, 0.722,
        &           0.819, 0.741, 0.778, 0.799, 0.653, 0.699,
        &           0.625, 0.621, 0.591, 0.566, 0.631, 0.667,
        &           0.674, 0.676, 0.751, 0.660, 0.698, 0.645 /
         DATA IM96O / 1., 1., 1., 1., 1., 1.,
        &             1., 1., 1., 1., 1., 1.,
        &             1., 1., 1., 1., 1., 1.,
        &             1., 1., 1., 1., 1., 1.,
        &             1., 1., 1., 1., 1., 1.,
        &             1., 1., 1., 1., 1., 1. /
         DATA IM96N / 1.014, 1.040, 1.010, 1.001, 0.978, 1.001,
        &             0.998, 0.986, 0.976, 0.963, 0.939, 0.990,
        &             1.021, 1.034, 1.018, 0.984, 0.957, 1.031,
        &             1.001, 1.020, 1.035, 0.984, 0.968, 1.049,
        &             0.959, 0.987, 0.963, 0.927, 0.987, 1.060,
        &             1.003, 1.009, 1.129, 0.982, 1.057, 0.938 /
         DATA IM97O / 0.956, 0.993, 1.008, 1.028, 0.979, 0.972,
        &             0.906, 1.089, 1.105, 0.929, 0.954, 0.908,
        &             0.929, 0.987, 1.033, 1.062, 0.969, 0.931,
        &             0.994, 1.091, 1.067, 1.005, 1.038, 1.067,
        &             0.892, 0.912, 0.936, 0.976, 0.981, 1.071,
        &             0.967, 1.044, 1.191, 1.041, 0.987, 1.002 /
         DATA IM97N / 0.961, 1.050, 0.992, 1.002, 1.065, 0.964,
        &             1.029, 1.016, 1.027, 0.996, 0.986, 0.968,
        &             0.972, 0.988, 0.957, 0.968, 0.993, 1.014,
        &             0.954, 1.003, 1.051, 1.008, 0.988, 1.050,
        &             0.971, 0.997, 0.952, 0.980, 0.977, 1.023,
        &             0.939, 1.073, 1.119, 0.979, 1.014, 0.972 /
         DATA IM98O / 36*1. /
         DATA IM98N / 36*1. /
         DATA GC96N / 0.663, 0.487 /
         DATA GC97N / 0.682, 0.515 /
         DATA GC98N / 0.661, 0.485 /
         SAVE
   
   -------------------- /QMACRO/ --- statement functions ----------------
   
    bmacro
       set of intrinsic functions to handle BOS banks
   - # of words/row in bank with index ID
         LCOLS(ID) = IW(ID+1)
   - # of rows in bank with index ID
         LROWS(ID) = IW(ID+2)
   - index of next row in the bank with index ID
         KNEXT(ID) = ID + LMHLEN + IW(ID+1)*IW(ID+2)
   - index of row # NRBOS in the bank with index ID
         KROW(ID,NRBOS) = ID + LMHLEN + IW(ID+1)*(NRBOS-1)
   - # of free words in the bank with index ID
         LFRWRD(ID) = ID + IW(ID) - KNEXT(ID)
   - # of free rows in the bank with index ID
         LFRROW(ID) = LFRWRD(ID) / LCOLS(ID)
   - Lth integer element of the NRBOSth row of the bank with index ID
         ITABL(ID,NRBOS,L) = IW(ID+LMHLEN+(NRBOS-1)*IW(ID+1)+L)
   - Lth real element of the NRBOSth row of the bank with index ID
         RTABL(ID,NRBOS,L) = RW(ID+LMHLEN+(NRBOS-1)*IW(ID+1)+L)
   
   -------------------- /QCFUNC/ --- statement functions for ALPHA banks
         KJQDET(KI)=IW(KOQVEC+KI*KCQVEC+JQVEQD)
         QSQT(QF)=SIGN(SQRT(ABS(QF)),QF)
         QP(KI)=RW(KOQVEC+KI*KCQVEC+JQVEQP)
         QX(KI)=RW(KOQVEC+KI*KCQVEC+JQVEQX)
         QY(KI)=RW(KOQVEC+KI*KCQVEC+JQVEQY)
         QZ(KI)=RW(KOQVEC+KI*KCQVEC+JQVEQZ)
         QE(KI)=RW(KOQVEC+KI*KCQVEC+JQVEQE)
         QM(KI)=RW(KOQVEC+KI*KCQVEC+JQVEQM)
         QCH(KI)=RW(KOQVEC+KI*KCQVEC+JQVECH)
         KCH(KI)=NINT (QCH(KI))
         QCT(KI)=QZ(KI)/QP(KI)
         QDB(KI)=RW(KOQVEC+KI*KCQVEC+JQVEDB)
         QZB(KI)=RW(KOQVEC+KI*KCQVEC+JQVEZB)
         QDBS2(KI)=RW(KOQVEC+KI*KCQVEC+JQVESD)
         QZBS2(KI)=RW(KOQVEC+KI*KCQVEC+JQVESZ)
         QBC2(KI)=RW(KOQVEC+KI*KCQVEC+JQVECB)
         QSIG(KI,KI1,KI2)=RW(KOQVEC+KI*KCQVEC+KMATIX(KI1,KI2)+JQVEEM)
         XSIG(KI)=RW(KOQVEC+KI*KCQVEC+JQVEEM).GE.0.
         QSMAT(KI,KI1)=RW(KOQVEC+KI*KCQVEC+KI1+JQVEEM)
         QSIGX(KI)=QSQT(QSMAT(KI,0))
         QSIGY(KI)=QSQT(QSMAT(KI,2))
         QSIGZ(KI)=QSQT(QSMAT(KI,5))
         QSIGEE(KI)=RW(KOQVEC+KI*KCQVEC+JQVEEM+9)
         QSIGE(KI)=QSQT(QSIGEE(KI))
         QSIGPP(KI)=(QX(KI)**2*QSMAT(KI,0)+QY(KI)**2*QSMAT(KI,2)+
        & QZ(KI)**2*QSMAT(KI,5)+2.*(QX(KI)*(QY(KI)*QSMAT(KI,1)+
        & QZ(KI)*QSMAT(KI,3))+QY(KI)*QZ(KI)*QSMAT(KI,4)))/QP(KI)**2
         QSIGP(KI)=QSQT(QSIGPP(KI))
         QSIGMM(KI)=QM(KI)*(QE(KI)**2*QSMAT(KI,9)+QX(KI)**2*QSMAT(KI,0)+
        & QY(KI)**2*QSMAT(KI,2)+QZ(KI)**2*QSMAT(KI,5)+2.*(QX(KI)*(QY(KI)
        & QSMAT(KI,1)+QZ(KI)*QSMAT(KI,3))+QY(KI)*QZ(KI)*QSMAT(KI,4)-
        & QE(KI)*(QX(KI)*QSMAT(KI,6)+QY(KI)*QSMAT(KI,7)+
        & QZ(KI)*QSMAT(KI,8))))/AMAX1(QM(KI)**3,1.E-16)
         QSIGM(KI)=QSQT(QSIGMM(KI))
         QMCHIF(KI)=RW(KOQVEC+KI*KCQVEC+JQVECF)
         QPH(KI)=ATG(QY(KI),QX(KI))
         QPT(KI)=SQRT(QX(KI)**2+QY(KI)**2)
         KTN(KI)=IW(KOQVEC+KI*KCQVEC+JQVETN)
         KMC(KI)=KCLARM(IW(KOQVEC+KI*KCQVEC+JQVECL))
         KBMASK(KI,KI1)=IW(KOQVEC+KI*KCQVEC+KI1+JQVEBM-1)
         KCALFL(KI)=IW(KJQDET(KI)+JQDECF)
         KCHGD(KI,KI1)=IW(KOQLIN+KI1+IW(KJQDET(KI)+JQDEFL))
         KCLASS(KI)=KCLACO(IW(KOQVEC+KI*KCQVEC+JQVECL))
         KDAU(KI,KI1)=IW(KOQLIN+KI1+IW(KOQVEC+KI*KCQVEC+JQVEDL))
         KECAL(KI,KI1)=IW(KOQLIN+KI1+IW(KJQDET(KI)+JQDEEL))
         KENDV(KI)=IW(KOQVEC+KI*KCQVEC+JQVEEV)
         KFOLLO(KI)=IW(KOQVEC+KI*KCQVEC+JQVENP)
         KHCAL(KI,KI1)=IW(KOQLIN+KI1+IW(KJQDET(KI)+JQDEHL))
         KLUNDS(KI)=IW(KOQVEC+KI*KCQVEC+JQVEKS)
         KNCHGD(KI)=IW(KJQDET(KI)+JQDENF)
         KNECAL(KI)=IW(KJQDET(KI)+JQDENE)
         KNHCAL(KI)=IW(KJQDET(KI)+JQDENH)
         KNMOTH(KI)=IW(KOQVEC+KI*KCQVEC+JQVENO)
         KMOTH(KI,KI1)=IW(KOQLIN+KI1+IW(KOQVEC+KI*KCQVEC+JQVEOL))
         KMTCH(KI,KI1)=IW(KOQMTL+KI1+IW(KOQVEC+KI*KCQVEC+JQVEML))
         KNDAU(KI)=IW(KOQVEC+KI*KCQVEC+JQVEND)
         KNMTCH(KI)=IW(KOQVEC+KI*KCQVEC+JQVENM)
         KORIV(KI)=IW(KOQVEC+KI*KCQVEC+JQVEOV)
         KSAME(KI)=IW(KOQVEC+KI*KCQVEC+JQVESP)
         KSMTCH(KI,KI1)=IW(KOQMTS+KI1+IW(KOQVEC+KI*KCQVEC+JQVEML))
         KSTABC(KI)=IW(KOQVEC+KI*KCQVEC+JQVESC)
         KTPCOD(KI)=IW(KOQVEC+KI*KCQVEC+JQVEPA)
         XLOCKN(KI,KI1)=IAND(KBMASK(KI,KI1),KLOCK0(KI1,KMC(KI))).NE.0
         XLOCK(KI)=IW(KOQVEC+KI*KCQVEC+JQVELK).NE.0.OR.XLOCKN(KI,1).OR.
        & XLOCKN(KI,2).OR.XLOCKN(KI,3).OR.XLOCKN(KI,4).OR.
        & XLOCKN(KI,5).OR.XLOCKN(KI,6).OR.XLOCKN(KI,7).OR.
        & XLOCKN(KI,8).OR.XLOCKN(KI,9).OR.XLOCKN(KI,10).OR.
        & XLOCKN(KI,11).OR.XLOCKN(KI,12).OR.XLOCKN(KI,13).OR.
        & XLOCKN(KI,14)
         XMC(KI)=KCLARM(IW(KOQVEC+KI*KCQVEC+JQVECL)).NE.1
         QRDFL(KI,KI1)=RW(KOQVEC+KI*KCQVEC+JQVEUS+KI1-1)
         KRDFL(KI,KI1)=IW(KOQVEC+KI*KCQVEC+JQVEUS+KI1-1)
         XCAL(KI)=IW(KJQDET(KI)+JQDECF).NE.0
         XECAL(KI)=IABS(IW(KJQDET(KI)+JQDECF)).EQ.1
         XHCAL(KI)=IABS(IW(KJQDET(KI)+JQDECF)).EQ.2
         QVX(KI)=RW(KOQVRT+KI*KCQVRT+JQVRVX)
         QVY(KI)=RW(KOQVRT+KI*KCQVRT+JQVRVY)
         QVZ(KI)=RW(KOQVRT+KI*KCQVRT+JQVRVZ)
         KVN(KI)=IW(KOQVRT+KI*KCQVRT+JQVRVN)
         KVTYPE(KI)=IW(KOQVRT+KI*KCQVRT+JQVRTY)
         KVINCP(KI)=IW(KOQVRT+KI*KCQVRT+JQVRIP)
         KVNDAU(KI)=IW(KOQVRT+KI*KCQVRT+JQVRND)
         KVYV0V(KI)=IW(KOQVRT+KI*KCQVRT+JQVRAY)
         KVFVER(KI)=IW(KOQVRT+KI*KCQVRT+JQVRAF)
         KVDAU(KI,KI1)=IW(KOQLIN+KI1+IW(KOQVRT+KI*KCQVRT+JQVRDL))
         QVEM(KI,KI1,KI2)=RW(KOQVRT+KI*KCQVRT+KMATIX(KI1,KI2)+JQVREM)
         QVCHIF(KI)=RW(KOQVRT+KI*KCQVRT+JQVRCF)
         QVDIF2(KI1,KI2)=SQRT((QVX(KI1)-QVX(KI2))**2+(QVY(KI1)-
        &QVY(KI2))**2)
         QVDIF3(KI1,KI2)=SQRT((QVX(KI1)-QVX(KI2))**2+(QVY(KI1)-
        &QVY(KI2))**2+ (QVZ(KI1)-QVZ(KI2))**2)
         QMSQ2(KI1,KI2)=(QE(KI1)+QE(KI2))**2-(QX(KI1)+QX(KI2))**2-
        & (QY(KI1)+QY(KI2))**2-(QZ(KI1)+QZ(KI2))**2
         QMSQ3(KI1,KI2,KI3)=(QE(KI1)+QE(KI2)+QE(KI3))**2-
        & (QX(KI1)+QX(KI2)+QX(KI3))**2-(QY(KI1)+QY(KI2)+QY(KI3))**2-
        & (QZ(KI1)+QZ(KI2)+QZ(KI3))**2
         QMSQ4(KI1,KI2,KI3,KI4)=(QE(KI1)+QE(KI2)+QE(KI3)+QE(KI4))**2-
        & (QX(KI1)+QX(KI2)+QX(KI3)+QX(KI4))**2-(QY(KI1)+QY(KI2)+
        & QY(KI3)+QY(KI4))**2-(QZ(KI1)+QZ(KI2)+QZ(KI3)+QZ(KI4))**2
         QM2(KI1,KI2)=QSQT(QMSQ2(KI1,KI2))
         QM3(KI1,KI2,KI3)=QSQT(QMSQ3(KI1,KI2,KI3))
         QM4(KI1,KI2,KI3,KI4)=QSQT(QMSQ4(KI1,KI2,KI3,KI4))
         QDMSQ(KI1,KI2)=(QE(KI1)-QE(KI2))**2-(QX(KI1)-QX(KI2))**2-
        & (QY(KI1)-QY(KI2))**2-(QZ(KI1)-QZ(KI2))**2
         QBETA(KI)=QP(KI)/QE(KI)
         QGAMMA(KI)=1./SQRT((1.-QBETA(KI))*(1.+QBETA(KI)))
         QDOT3(KI1,KI2)=QX(KI1)*QX(KI2)+QY(KI1)*QY(KI2)+QZ(KI1)*QZ(KI2)
         QDOT4(KI1,KI2)=QE(KI1)*QE(KI2)-QDOT3(KI1,KI2)
         QCOSA(KI1,KI2)=QDOT3(KI1,KI2)/(QP(KI1)*QP(KI2))
         QPPAR(KI1,KI2)=QDOT3(KI1,KI2)/QP(KI2)
         QPPER(KI1,KI2)=SQRT((QY(KI1)*QZ(KI2)-QZ(KI1)*QY(KI2))**2+
        & (QZ(KI1)*QX(KI2)-QX(KI1)*QZ(KI2))**2+
        & (QX(KI1)*QY(KI2)-QY(KI1)*QX(KI2))**2)/QP(KI2)
         XSAME(KI1,KI2)=IAND(KBMASK(KI1,1),KBMASK(KI2,1)).NE.0.OR.
        & IAND(KBMASK(KI1,2),KBMASK(KI2,2)).NE.0.OR.
        & IAND(KBMASK(KI1,3),KBMASK(KI2,3)).NE.0.OR.
        & IAND(KBMASK(KI1,4),KBMASK(KI2,4)).NE.0.OR.
        & IAND(KBMASK(KI1,5),KBMASK(KI2,5)).NE.0.OR.
        & IAND(KBMASK(KI1,6),KBMASK(KI2,6)).NE.0.OR.
        & IAND(KBMASK(KI1,7),KBMASK(KI2,7)).NE.0.OR.
        & IAND(KBMASK(KI1,8),KBMASK(KI2,8)).NE.0.OR.
        & IAND(KBMASK(KI1,9),KBMASK(KI2,9)).NE.0.OR.
        & IAND(KBMASK(KI1,10),KBMASK(KI2,10)).NE.0.OR.
        & IAND(KBMASK(KI1,11),KBMASK(KI2,11)).NE.0.OR.
        & IAND(KBMASK(KI1,12),KBMASK(KI2,12)).NE.0.OR.
        & IAND(KBMASK(KI1,13),KBMASK(KI2,13)).NE.0.OR.
        & IAND(KBMASK(KI1,14),KBMASK(KI2,14)).NE.0
         QCMASS(KI)=RW(KOQPAR+KI*KCQPAR+JQPAMA)
         QCCHAR(KI)=RW(KOQPAR+KI*KCQPAR+JQPACH)
         QCLIFE(KI)=RW(KOQPAR+KI*KCQPAR+JQPALT)
         QCWIDT(KI)=RW(KOQPAR+KI*KCQPAR+JQPAWI)
         XCEQOR(KI,KI1)=KTPCOD(KI).EQ.KI1.OR.
        & KTPCOD(KI).EQ.IW(KOQPAR+KI1*KCQPAR+JQPAAN)
         XCEQU(KI,KI1)=KTPCOD(KI).EQ.KI1
      QCFDET
         XFRF(KI)=IW(KJQDET(KI)+JQDEAF).NE.KQZER
         QFRFIR(KI)=RW(IW(KJQDET(KI)+JQDEAF)+JFRFIR)
         QFRFTL(KI)=RW(IW(KJQDET(KI)+JQDEAF)+JFRFTL)
         QFRFP0(KI)=RW(IW(KJQDET(KI)+JQDEAF)+JFRFP0)
         QFRFD0(KI)=RW(IW(KJQDET(KI)+JQDEAF)+JFRFD0)
         QFRFZ0(KI)=RW(IW(KJQDET(KI)+JQDEAF)+JFRFZ0)
         QFRFAL(KI)=RW(IW(KJQDET(KI)+JQDEAF)+JFRFAL)
         QFRFEM(KI,KI1,KI2)=RW(IW(KJQDET(KI)+JQDEAF)+
        & KMATIX(KI1,KI2)+JFRFEM)
         QFRFC2(KI)=RW(IW(KJQDET(KI)+JQDEAF)+JFRFC2)
         KFRFDF(KI)=IW(IW(KJQDET(KI)+JQDEAF)+JFRFDF)
         KFRFNO(KI)=IW(IW(KJQDET(KI)+JQDEAF)+JFRFNO)
         KFRTNV(KI)=IW(IW(KJQDET(KI)+JQDEAL)+JFRTNV)
         KFRTNI(KI)=IW(IW(KJQDET(KI)+JQDEAL)+JFRTNI)
         KFRTNE(KI)=IW(IW(KJQDET(KI)+JQDEAL)+JFRTNE)
         KFRTNT(KI)=IW(IW(KJQDET(KI)+JQDEAL)+JFRTNT)
         KFRTNR(KI)=IW(IW(KJQDET(KI)+JQDEAL)+JFRTNR)
         KFRIBP(KI)=IW(IW(KJQDET(KI)+JQDEFI)+JFRIBP)
         KFRIDZ(KI)=IW(IW(KJQDET(KI)+JQDEFI)+JFRIDZ)
         KFRIBC(KI)=IW(IW(KJQDET(KI)+JQDEFI)+JFRIBC)
         KFRIDC(KI)=IW(IW(KJQDET(KI)+JQDEFI)+JFRIDC)
         QFRIPE(KI)=RW(IW(KJQDET(KI)+JQDEFI)+JFRIPE)
         QFRIPM(KI)=RW(IW(KJQDET(KI)+JQDEFI)+JFRIPM)
         QFRIPI(KI)=RW(IW(KJQDET(KI)+JQDEFI)+JFRIPI)
         QFRIPK(KI)=RW(IW(KJQDET(KI)+JQDEFI)+JFRIPK)
         QFRIPP(KI)=RW(IW(KJQDET(KI)+JQDEFI)+JFRIPP)
         QFRINK(KI)=RW(IW(KJQDET(KI)+JQDEFI)+JFRINK)
         KFRIQF(KI)=IW(IW(KJQDET(KI)+JQDEFI)+JFRIQF)
         XFRIQF(KI)=KFRIQF(KI).EQ.1.OR.KFRIQF(KI).EQ.3
         KNTEX(KI)=IW(KJQDET(KI)+JQDENT)
         XTEX(KI)=IW(KJQDET(KI)+JQDENT).NE.0
         KTEXSI(KI,KI1)=IW(IW(KJQDET(KI)+KI1+JQDENT)+JTEXSI)
         QTEXTM(KI,KI1)=RW(IW(KJQDET(KI)+KI1+JQDENT)+JTEXTM)
         QTEXTL(KI,KI1)=RW(IW(KJQDET(KI)+KI1+JQDENT)+JTEXTL)
         KTEXNS(KI,KI1)=IW(IW(KJQDET(KI)+KI1+JQDENT)+JTEXNS)
         QTEXAD(KI,KI1)=RW(IW(KJQDET(KI)+KI1+JQDENT)+JTEXAD)
         XEID(KI)=IW(KJQDET(KI)+JQDEAE).NE.KQZER
         KEIDIF(KI)=IW(IW(KJQDET(KI)+JQDEAE)+JEIDIF)
         QEIDRI(KI,KI1)=RW(IW(KJQDET(KI)+JQDEAE)+KI1+JEIDR1-1)
         QEIDEC(KI)=RW(IW(KJQDET(KI)+JQDEAE)+JEIDEC)
         KEIDIP(KI)=IW(IW(KJQDET(KI)+JQDEAE)+JEIDIP)
         QEIDEI(KI,KI1)=RW(IW(KJQDET(KI)+JQDEAE)+KI1+JEIDE1-1)
         XHMA(KI)=IW(KJQDET(KI)+JQDEAH).NE.KQZER
         KHMANF(KI)=IW(IW(KJQDET(KI)+JQDEAH)+JHMANF)
         KHMANE(KI)=IW(IW(KJQDET(KI)+JQDEAH)+JHMANE)
         KHMANL(KI)=IW(IW(KJQDET(KI)+JQDEAH)+JHMANL)
         KHMAMH(KI)=IW(IW(KJQDET(KI)+JQDEAH)+JHMAMH)
         KHMAIG(KI)=IW(IW(KJQDET(KI)+JQDEAH)+JHMAIG)
         QHMAED(KI)=RW(IW(KJQDET(KI)+JQDEAH)+JHMAED)
         QHMACS(KI)=RW(IW(KJQDET(KI)+JQDEAH)+JHMACS)
         KHMAND(KI)=IW(IW(KJQDET(KI)+JQDEAH)+JHMAND)
         KHMAIE(KI)=IW(IW(KJQDET(KI)+JQDEAH)+JHMAIE)
         KHMAIT(KI)=IW(IW(KJQDET(KI)+JQDEAH)+JHMAIT)
         KHMAIF(KI)=IW(IW(KJQDET(KI)+JQDEAH)+JHMAIF)
         XMCA(KI)=IW(KJQDET(KI)+JQDEAM).NE.KQZER
         KMCANH(KI,KI1)=IW(IW(KJQDET(KI)+JQDEAM)+KI1+JMCANH-1)
         QMCADH(KI,KI1)=RW(IW(KJQDET(KI)+JQDEAM)+KI1+JMCADH-1)
         QMCADC(KI,KI1)=RW(IW(KJQDET(KI)+JQDEAM)+KI1+JMCADC-1)
         QMCAAM(KI)=RW(IW(KJQDET(KI)+JQDEAM)+JMCAAM)
         QMCAAC(KI)=RW(IW(KJQDET(KI)+JQDEAM)+JMCAAC)
         XMUI(KI)=IW(KJQDET(KI)+JQDEMU).NE.KQZER
         KMUIIF(KI)=IW(IW(KJQDET(KI)+JQDEMU)+JMUIIF)
         QMUISR(KI)=RW(IW(KJQDET(KI)+JQDEMU)+JMUISR)
         QMUIDM(KI)=RW(IW(KJQDET(KI)+JQDEMU)+JMUIDM)
         KMUIST(KI)=IW(IW(KJQDET(KI)+JQDEMU)+JMUIST)
         KMUITN(KI)=IW(IW(KJQDET(KI)+JQDEMU)+JMUITN)
         XPEC(KI)=IW(KJQDET(KI)+JQDEEC).NE.KQZER
         QPECER(KI)=RW(IW(KJQDET(KI)+JQDEEC)+JPECER)
         QPECE1(KI)=RW(IW(KJQDET(KI)+JQDEEC)+JPECE1)
         QPECE2(KI)=RW(IW(KJQDET(KI)+JQDEEC)+JPECE2)
         QPECTH(KI)=RW(IW(KJQDET(KI)+JQDEEC)+JPECTH)
         QPECPH(KI)=RW(IW(KJQDET(KI)+JQDEEC)+JPECPH)
         QPECEC(KI)=RW(IW(KJQDET(KI)+JQDEEC)+JPECEC)
         KPECKD(KI)=IW(IW(KJQDET(KI)+JQDEEC)+JPECKD)
         KPECCC(KI)=IW(IW(KJQDET(KI)+JQDEEC)+JPECCC)
         KPECRB(KI)=IW(IW(KJQDET(KI)+JQDEEC)+JPECRB)
         KPECPC(KI)=IW(IW(KJQDET(KI)+JQDEEC)+JPECPC)
         XPEP(KI)=IW(KJQDET(KI)+JQDEET).NE.KQZER
         QPEPT1(KI)=RW(IW(KJQDET(KI)+JQDEET)+JPEPT1)
         QPEPP1(KI)=RW(IW(KJQDET(KI)+JQDEET)+JPEPP1)
         QPEPT3(KI)=RW(IW(KJQDET(KI)+JQDEET)+JPEPT3)
         QPEPP3(KI)=RW(IW(KJQDET(KI)+JQDEET)+JPEPP3)
         XPHC(KI)=IW(KJQDET(KI)+JQDEHC).NE.KQZER
         QPHCER(KI)=RW(IW(KJQDET(KI)+JQDEHC)+JPHCER)
         QPHCTH(KI)=RW(IW(KJQDET(KI)+JQDEHC)+JPHCTH)
         QPHCPH(KI)=RW(IW(KJQDET(KI)+JQDEHC)+JPHCPH)
         QPHCEC(KI)=RW(IW(KJQDET(KI)+JQDEHC)+JPHCEC)
         KPHCKD(KI)=IW(IW(KJQDET(KI)+JQDEHC)+JPHCKD)
         KPHCCC(KI)=IW(IW(KJQDET(KI)+JQDEHC)+JPHCCC)
         KPHCRB(KI)=IW(IW(KJQDET(KI)+JQDEHC)+JPHCRB)
         KPHCPC(KI)=IW(IW(KJQDET(KI)+JQDEHC)+JPHCPC)
         XEFO(KI)=IW(KJQDET(KI)+JQDEEF).NE.KQZER
         QEFOWE(KI)=RW(IW(KJQDET(KI)+JQDEEF)+JEFOWE)
         KEFOTY(KI)=IW(IW(KJQDET(KI)+JQDEEF)+JEFOTY)
         KEFOLE(KI)=IW(IW(KJQDET(KI)+JQDEEF)+JEFOLE)
         KEFOLT(KI)=IW(IW(KJQDET(KI)+JQDEEF)+JEFOLT)
         KEFOLH(KI)=IW(IW(KJQDET(KI)+JQDEEF)+JEFOLH)
         KEFOLC(KI)=IW(IW(KJQDET(KI)+JQDEEF)+JEFOLC)
         KEFOLJ(KI)=IW(IW(KJQDET(KI)+JQDEEF)+JEFOLJ)
         XPCQ(KI)=IW(KJQDET(KI)+JQDEPC).NE.KQZER
         KPCQNA(KI)=IW(IW(KJQDET(KI)+JQDEPC)+JPCQNA)
         XEGP(KI)=IW(KJQDET(KI)+JQDEEG).NE.KQZER
         QEGPR1(KI)=RW(IW(KJQDET(KI)+JQDEEG)+JEGPR1)
         QEGPR2(KI)=RW(IW(KJQDET(KI)+JQDEEG)+JEGPR2)
         QEGPF4(KI)=RW(IW(KJQDET(KI)+JQDEEG)+JEGPF4)
         QEGPDM(KI)=RW(IW(KJQDET(KI)+JQDEEG)+JEGPDM)
         KEGPST(KI)=IW(IW(KJQDET(KI)+JQDEEG)+JEGPST)
         KEGPQU(KI)=IW(IW(KJQDET(KI)+JQDEEG)+JEGPQU)
         KEGPPE(KI)=IW(IW(KJQDET(KI)+JQDEEG)+JEGPPE)
         XPGP(KI)=IW(KJQDET(KI)+JQDEPG).NE.KQZER.AND.IW(NAPGPC).GT.0
         QPGPR1(KI)=RW(IW(KJQDET(KI)+JQDEPG)+JPGPR1)
         QPGPR2(KI)=RW(IW(KJQDET(KI)+JQDEPG)+JPGPR2)
         QPGPF4(KI)=RW(IW(KJQDET(KI)+JQDEPG)+JPGPF4)
         QPGPDM(KI)=RW(IW(KJQDET(KI)+JQDEPG)+JPGPDM)
         QPGPST(KI)=RW(IW(KJQDET(KI)+JQDEPG)+JPGPST)
         QPGPQ1(KI)=RW(IW(KJQDET(KI)+JQDEPG)+JPGPQ1)
         QPGPQ2(KI)=RW(IW(KJQDET(KI)+JQDEPG)+JPGPQ2)
         QPGPM1(KI)=RW(IW(KJQDET(KI)+JQDEPG)+JPGPM1)
         QPGPM2(KI)=RW(IW(KJQDET(KI)+JQDEPG)+JPGPM2)
         QPGPMA(KI)=RW(IW(KJQDET(KI)+JQDEPG)+JPGPMA)
         QPGPER(KI)=RW(IW(KJQDET(KI)+JQDEPG)+JPGPER)
         QPGPTR(KI)=RW(IW(KJQDET(KI)+JQDEPG)+JPGPTR)
         QPGPPR(KI)=RW(IW(KJQDET(KI)+JQDEPG)+JPGPPR)
         KPGPQU(KI)=IW(IW(KJQDET(KI)+JQDEPG)+JPGPQU)
         KPGPPE(KI)=IW(IW(KJQDET(KI)+JQDEPG)+JPGPPE)
         XPGAC(KI)=IW(KJQDET(KI)+JQDEPG).NE.KQZER.AND.IW(NAPGAC).GT.0
         KPGAST(KI)=IW(IW(KJQDET(KI)+JQDEPG)+JPGAST)
         QPGAEF(KI)=RW(IW(KJQDET(KI)+JQDEPG)+JPGAEF)
         QPGAGC(KI)=RW(IW(KJQDET(KI)+JQDEPG)+JPGAGC)
         QPGAZS(KI)=RW(IW(KJQDET(KI)+JQDEPG)+JPGAZS)
         QPGAPL(KI)=RW(IW(KJQDET(KI)+JQDEPG)+JPGAPL)
         QPGAPH(KI)=RW(IW(KJQDET(KI)+JQDEPG)+JPGAPH)
         KPGAPN(KI)=IW(IW(KJQDET(KI)+JQDEPG)+JPGAPN)
         KPGAFA(KI)=IW(IW(KJQDET(KI)+JQDEPG)+JPGAFA)
         KPGAPE(KI)=IW(IW(KJQDET(KI)+JQDEPG)+JPGAPE)
         XYV0(KI)=KVYV0V(KENDV(KI)).NE.0
         KYV0K1(KI)=IW(KVYV0V(KENDV(KI))+JYV0K1)
         KYV0K2(KI)=IW(KVYV0V(KENDV(KI))+JYV0K2)
         QYV0VX(KI)=RW(KVYV0V(KENDV(KI))+JYV0VX)
         QYV0VY(KI)=RW(KVYV0V(KENDV(KI))+JYV0VY)
         QYV0VZ(KI)=RW(KVYV0V(KENDV(KI))+JYV0VZ)
         QYV0X1(KI)=RW(KVYV0V(KENDV(KI))+JYV0X1)
         QYV0X2(KI)=RW(KVYV0V(KENDV(KI))+JYV0X2)
         QYV0C2(KI)=RW(KVYV0V(KENDV(KI))+JYV0C2)
         KYV0IC(KI)=IW(KVYV0V(KENDV(KI))+JYV0IC)
         QYV0DM(KI)=RW(KVYV0V(KENDV(KI))+JYV0DM)
         QYV0S1(KI)=RW(KVYV0V(KENDV(KI))+JYV0S1)
         QYV0S2(KI)=RW(KVYV0V(KENDV(KI))+JYV0S2)
         XLEPTG(KI)=IW(KJQDET(KI)+JQDEPD).NE.KQZER
         KLEPPA(KI)=IW(IW(KJQDET(KI)+JQDEPD)+JPDLPA)
         KLEPJT(KI)=IW(IW(KJQDET(KI)+JQDEPD)+JPDLJT)+KLFJET-1
         QLEPPI(KI)=RW(IW(KJQDET(KI)+JQDEPD)+JPDLPI)
         QLEPPE(KI)=RW(IW(KJQDET(KI)+JQDEPD)+JPDLPE)
         KLEPVP(KI)=IW(IW(KJQDET(KI)+JQDEPD)+JPDLVP)
         XLEPTH(KI)=IW(KJQDET(KI)+JQDEPM).NE.KQZER
         KLEPFL(KI)=IW(IW(KJQDET(KI)+JQDEPM)+JPMLFL)
         KLEPPO(KI)=IW(IW(KJQDET(KI)+JQDEPM)+JPMLPO)
         KLEPCH(KI)=IW(IW(KJQDET(KI)+JQDEPM)+JPMLCH)
         KLEPSP(KI)=IW(IW(KJQDET(KI)+JQDEPM)+JPMLSP)
         KLEPLE(KI)=IW(IW(KJQDET(KI)+JQDEPM)+JPMLLE)
         KLEPME(KI)=IW(IW(KJQDET(KI)+JQDEPM)+JPMLME)
         KLEPKT(KI)=IW(IW(KJQDET(KI)+JQDEPM)+JPMLKT)
   
       To do once per job
         IF (FIRST) THEN
            IF (ICTRL.EQ.1) THEN
               WRITE(KUPRNT,*)
        &           '++++++ HCALCORRECTION ENABLED ++++++'
            ELSEIF (ICTRL.EQ.2) THEN
               WRITE(KUPRNT,*)
        &           '++++++ HCAL OFFLINE BUG CORRECTION ENABLED ++++++'
            ELSE
               WRITE(IW(6),*)'++++++ QCORFIC: DO NOT KNOW HOW TO CORRECT'
            ENDIF
       Filling some matrices
            DO I = 1, 36
               IMO(1,I) = IM96O(I)
               IMO(2,I) = IM97O(I)
               IMO(3,I) = IM98O(I)
               IMN(1,I) = IM96N(I)
               IMN(2,I) = IM97N(I)
               IMN(3,I) = IM98N(I)
            ENDDO
            DO I = 1, 2
               GCN(1,I) = GC96N(I)
               GCN(2,I) = GC97N(I)
               GCN(3,I) = GC98N(I)
            ENDDO
            IND = MDARD(IW,KUCONS,'HNGR',0)
            FIRST = .FALSE.
         ENDIF
         QCORFIC = ENE
       To do once per event
         IF (KNEVT.NE.INEVT) THEN
       Let's begin with the correction of the online bug...
            IBUG = 0
            IF (ICTRL.EQ.1) THEN
               IF (KRUN.GE.41298.AND.KRUN.LE.45289) IBUG = 1
       Loads online calibration constant
               JHCCV = IW(NAMIND('HCCV'))
               IF (JHCCV.LE.0.AND.IBUG.EQ.1) THEN
                  CALL QWMESS('++++ HCCV is missing: HCAL online '
        &              'bug cannot be corrected!!')
                  RETURN
               ENDIF
            ENDIF
       Recalibrate only 1996, 1997 and 1998 data!
            IF (KRUN.GE.41000.AND.KRUN.LT.43000) THEN
               IYEAR = 1
            ELSEIF (KRUN.GE.43000.AND.KRUN.LT.45000) THEN
               IYEAR = 2
            ELSEIF (KRUN.GE.45000.AND.KRUN.LT.48000) THEN
               IYEAR = 3
            ELSE
               IYEAR = 0
            ENDIF
            JHT0C = IW(NAMIND('HT0C'))
            JHSTD = IW(NAMIND('HSTD'))
            IF ((JHT0C.LE.0.OR.JHSTD.LE.0).AND.IYEAR.GT.0) THEN
               CALL QWMESE('+++++ HT0C or HSTD banks missing: '
        &           'HCAL cannot be recalibrated!!')
               RETURN
            ENDIF
            INEVT = KNEVT
         ENDIF
       Determines the module number (1-24 barrel, 25-36 endcaps)
         JHNGR = IW(NAMIND('HNGR'))
         IF (JHNGR.LE.0) THEN
            CALL QWMESE('+++++ HNGR bank missing: '
        &        'HCAL cannot be recalibrated!!')
            RETURN
         ENDIF
         IHNGR = ITABL(JHNGR,ITH,IPH)
         IHBA = MOD(IHNGR,1000)
         IHEC = IHNGR/1000
         IF (IHBA .GT. 0) THEN
            ISUB = 1
            IMD = (IPH-1)/4 + 1
         ELSE
            ISUB = 2
            IMD = (IHEC-1)/10 + 1 + 24
         ENDIF
       Rescales the tower energy to the right value
         IF (IBUG.EQ.1) THEN
            TUB = FLOAT(IW(JHCCV+3))
            CAL = 10000.*FIC(IMD)/TUB
            WRG = FLOAT(INT(CAL))
            QCORFIC = ENE * CAL / WRG
         ENDIF
       Now we have to remove the old calibration and to put in
       the new one...
         IF (IYEAR.GT.0) THEN
            CORR = 1.
            GCO = RTABL(JHT0C,1,2*ISUB)
            GCTO = RTABL(JHSTD,1,ISUB)
            IF (ICTRL.EQ.1) THEN
               CORR = GCO * GCTO * IMO(IYEAR,IMD) /
        &           ( GCN(IYEAR,ISUB) * IMN(IYEAR,IMD) )
            ELSEIF (ICTRL.EQ.2) THEN
               CORR = GCO / GCN(IYEAR,ISUB)
            ENDIF
            QCORFIC = QCORFIC * CORR
         ENDIF
         RETURN
         END
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   HCALENSC                                                                        
        |---- QCORFIC                                                              
                   |----  SIGN                                External             
                   |----  SQRT                                External             
                   |----  ABS                                 External             
                   |----  NINT                                External             
                   |----  KMATIX                              External             
                   |----  ATG                                 External             
                   |----  KCLARM                              External             
                   |----  IAND                                External             
                   |----  KLOCK0                              External             
                   |----  IABS                                External             
                   |----  IM98O                               External             
                   |----  IM98N                               External             
                   |----  MDARD                               External             
                   |----  NAMIND                              External             
                   |----  QWMESS                                                   
                   |----  QWMESE                                                   
                   |----  MOD                                 External             
                   |----  FLOAT                               External             
                   |----  INT                                 External             
   
 
3 QCPMOD
         SUBROUTINE QCPMOD (CPAR,CANT,AMA,ACH,ALI,AWI)
  ------------------------------------------------------------------------------
    CKEY PART /INTERNAL
  ------------------------------------------------------------------------------
   Modify particle according to pmod data card
    from QMPART
                                                     H.Albrecht 15.01.89
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   QMPART                                                                          
        |---- QCPMOD                                                               
                   |----  QAPNAM                                                   
                   |----  IOR                                 External             
   
 
3 QCPNEW
         SUBROUTINE QCPNEW (CPAR,CANT,AMA,ACH,ALI,AWI)
  ------------------------------------------------------------------------------
    CKEY PART /INTERNAL
  ------------------------------------------------------------------------------
   Establish new particle according to pnew data card
    from QMPART
                                                     H.Albrecht 15.01.89
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   QMPART                                                                          
        |---- QCPNEW                                                               
                   |----  QAPNAM                                                   
                   |----  IOR                                 External             
   
 
3 QCPRLN
         SUBROUTINE QCPRLN(RL,TETIFL,PMOM,RLnew)
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Computes beta/alpha and rl for electron - auxiliary to fixprl
    Called from FIXPRL
                                   Author: P. Perret  31/01/97
       Input  : RL       Estimator stored in preceeding processing
                TETIFL   ECAL theta impact in ECAL numbering
                PMOM     Track momentum
       Output : RLnew    new estimator
   
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
              QCPRLN                                                               
                   |----  FUNRL2                                                   
   
 
3 QCPTETI
         SUBROUTINE QCPTETI(IFCHT,TETIFL,IECL)
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Computes  tetifl  ecal theta impact in ecal numbering
       Input  IFCHT   Track number
       Output TETIFL  ECAL theta impact in ECAL numbering
              IECL
   
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   FIXPRL                                                                          
        |---- QCPTETI                                                              
                   |----  SIGN                                External             
                   |----  SQRT                                External             
                   |----  ABS                                 External             
                   |----  NINT                                External             
                   |----  KMATIX                              External             
                   |----  ATG                                 External             
                   |----  KCLARM                              External             
                   |----  IAND                                External             
                   |----  KLOCK0                              External             
                   |----  IABS                                External             
                   |----  COS                                 External             
                   |----  SIN                                 External             
                   |----  QEXTRA                                                   
                   |----  ATAN2                               External             
                   |----  ACOS                                External             
                   |----  QETHPH                                                   
   
 
3 QCPTRA
         SUBROUTINE QCPTRA (CPAR,CANT, IEXT,IAXT)
  ------------------------------------------------------------------------------
    CKEY PART /INTERNAL
  ------------------------------------------------------------------------------
   Set transformation table according to ptra data card
    from QMPART
                                                     H.Albrecht 15.01.89
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   QMPART                                                                          
        |---- QCPTRA                                                               
                   |----  LENOCC                              External             
                   |----  QAPNAM                                                   
                   |----  IOR                                 External             
   
 
3 QDATA
         SUBROUTINE QDATA
  ------------------------------------------------------------------------------
    CKEY INIT /INTERNAL
  ------------------------------------------------------------------------------
   Quasi block data
    long as this routine is not too long, avoid a real BLOCK DATA.
    from : QMINIT
                                                     H.Albrecht 22.09.88
                                                     E. Blucher 10.05.89
                                                     G. Graefe  29.04.94
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   QMINIT                                                                          
        |---- QDATA                                                                
                   |----  NINT                                External             
                   |----  FLOAT                               External             
                   |----  BKCARI                              External             
                   |----  SBIT1                               External             
   
 
3 QDECA2
         FUNCTION QDECA2 (I,J)
  ------------------------------------------------------------------------------
    CKEY KINEMATICS /USER
  ------------------------------------------------------------------------------
     Author   : E. Blucher      7-OCT-1988
     Modification:  L. Bellantoni 8-Jan-1994
     Purpose:
     ===========
   For the 2-body decay m --> m(i) + m(j), this function calculates the
    angle between the M momentum vector and the m(I) momentum
    vector in the M rest frame.
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
              QDECA2                                                               
                   |----  SIGN                                External             
                   |----  SQRT                                External             
                   |----  ABS                                 External             
                   |----  NINT                                External             
                   |----  KMATIX                              External             
                   |----  ATG                                 External             
                   |----  KCLARM                              External             
                   |----  IAND                                External             
                   |----  KLOCK0                              External             
                   |----  IABS                                External             
                   |----  DBLE                                External             
                   |----  DSQRT                               External             
   
 
3 QDECAN
         FUNCTION QDECAN (I,J)
  ------------------------------------------------------------------------------
    CKEY KINEMATICS /USER
  ------------------------------------------------------------------------------
     Author   : E. Blucher      27-JAN-1989
     Purpose:
     ===========
   For the decay m(i) --> m(j)+...+m(n), this function calculates the
    angle between the M(I) momentum vector and the m(J) momentum
    vector in the M(I) rest frame.
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   QBMTAG                                                                          
        |---- QDECAN                                                               
                   |----  SIGN                                External             
                   |----  SQRT                                External             
                   |----  ABS                                 External             
                   |----  NINT                                External             
                   |----  KMATIX                              External             
                   |----  ATG                                 External             
                   |----  KCLARM                              External             
                   |----  IAND                                External             
                   |----  KLOCK0                              External             
                   |----  IABS                                External             
                   |----  QWMESE                                                   
   
 
3 QDOTPXS
         SUBROUTINE QDOTPXS
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Create tpxs bank of truncated means for pad de/dx
   
            Author: F. Palla 14-Nov-1998
            Called from QFPTPX
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   QFPTPX                                                                          
        |---- QDOTPXS                                                              
                   |----  NAMIND                              External             
                   |----  BDROP                               External             
                   |----  NLINK                               External             
                   |----  AUBOS                               External             
                   |----  BLIST                               External             
                   |----  LOG10                               External             
                   |----  SORTZV                              External             
                   |----  VZERO                               External             
                   |----  NCLST                               External             
                   |----  SLLST                               External             
                   |----  FLOAT                               External             
                   |----  AUBPRS                              External             
   
 
3 QEDIRUPD
         SUBROUTINE QEDIRUPD
  ------------------------------------------------------------------------------
    CKEY FILL LEPTONS/INTERNAL
  ------------------------------------------------------------------------------
   Set lepton tagging bits 27 and 28 for event directory
    Author M-N Minard   28-Nov-1994
       Bit 27 = Electron selection (Rt>-3, -3<Rl<3))
       Bit 28 = Muon selection ( QMUIDO flag 13 or 14 )
    Called from QFLEPT
   
 
3 QETHPH
         SUBROUTINE QETHPH ( XPHI , XTET , SK ,EPHI , ETET  )
  ------------------------------------------------------------------------------
    CKEY  FILL / INTERNAL
  ------------------------------------------------------------------------------
   From space coordinate calculate phi, teta ,ik in ecal numbering
    Called from FIXRTRL
                                      Author M.N Minard 10/11/93
        Input    XPHI   Phi angle in radian
                 XTET   Theta angle in radian
                 SK     Stack number for extrapolation
        Output   ETET   Theta in ECAL numbering
                 EPHI   Phi in ECAL numbering
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   FIXRTRL                                                                         
   QCPTETI                                                                         
        |---- QETHPH                                                               
                   |----  COS                                 External             
                   |----  SIN                                 External             
                   |----  EMPACT                              External             
                   |----  EFNDSC                              External             
                   |----  EFNDMD                              External             
                   |----  EFNDCL                              External             
                   |----  EFNDLG                              External             
                   |----  EFNDST                              External             
                   |----  ESRPT                               External             
                   |----  ATAN2                               External             
                   |----  SQRT                                External             
                   |----  DBLE                                External             
   
 
3 QEXTRA
         SUBROUTINE QEXTRA(PIN,ICH,XTRAP,IFIRS)
  ------------------------------------------------------------------------------
    CKEY  FILL / INTERNAL
  ------------------------------------------------------------------------------
   Extrapolates tracks in ecal
    Called from FIXRTRL
        Author  : M.N. Minard                 10/11/93
    : PIN  (7)       = x.y.z.px,py,pz,p of track to extrapolate
           ICH            = Track charge
    XTRAP(3,3)     = x,y,z coordinates of extrapolated point
                            in each stack
           IFIRS          = 1 if track extrapolate S1 , 2 in S2
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   FIXRTRL                                                                         
   QCPTETI                                                                         
        |---- QEXTRA                                                               
                   |----  VZERO                               External             
                   |----  UCOPY                               External             
                   |----  AUHCYL                              External             
                   |----  EFNDSC                              External             
                   |----  EFNDMD                              External             
                   |----  EPLMST                              External             
                   |----  QFNDIN                                                   
   
 
3 QFBITM
         SUBROUTINE QFBITM
  ------------------------------------------------------------------------------
    CKEY FILL MASKS /INTERNAL
  ------------------------------------------------------------------------------
   Fill bit masks for reconstructed particles
                                                      H.Albrecht 27.11.88
                                                      E.Blucher  25.07.90
                                       Modified       E.Blucher  03.02.93
    called from QFILL to set bit masks for all reconstructed objects.
    Entry pointQSBITM added to set bit mask for
    single tracks -- called from KVSAVC.
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   QFILL                                                                           
        |---- QFBITM                                                               
                   |----  SIGN                                External             
                   |----  SQRT                                External             
                   |----  ABS                                 External             
                   |----  NINT                                External             
                   |----  KMATIX                              External             
                   |----  ATG                                 External             
                   |----  KCLARM                              External             
                   |----  IAND                                External             
                   |----  KLOCK0                              External             
                   |----  IABS                                External             
                   |----  KPCOMP                                                   
                   |----  KFPADR                                                   
                   |----  QWMESE                                                   
   
 
3 QFCADD
         SUBROUTINE QFCADD (NTO, NFROM)
  ------------------------------------------------------------------------------
    CKEY FILL CAL /INTERNAL
  ------------------------------------------------------------------------------
   Add 4-momenta of the composite calorimeter object nto.
    Called once for each contributing ECAL/HCAL object NFROM.
    called from QFCASC
                                                      H.Albrecht 27.2.89
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   QFCASC                                                                          
        |---- QFCADD                                                               
                   |----  SIGN                                External             
                   |----  SQRT                                External             
                   |----  ABS                                 External             
                   |----  NINT                                External             
                   |----  KMATIX                              External             
                   |----  ATG                                 External             
                   |----  KCLARM                              External             
                   |----  IAND                                External             
                   |----  KLOCK0                              External             
                   |----  IABS                                External             
                   |----  FLOAT                               External             
   
 
3 QFCALD
         SUBROUTINE QFCALD
  ------------------------------------------------------------------------------
    CKEY FILL CAL /INTERNAL
  ------------------------------------------------------------------------------
   Fill qvec with calorimeter objects.
   
    called from QFILL
                                                      H.Albrecht 27.2.89
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   QFILL                                                                           
        |---- QFCALD                                                               
                   |----  KPCOMP                                                   
                   |----  KFPADR                                                   
                   |----  QFCOBJ                                                   
                   |----  QFCREL                                                   
                   |----  QFCASC                                                   
   
 
3 QFCASC
         SUBROUTINE QFCASC
  ------------------------------------------------------------------------------
    CKEY FILL CAL /INTERNAL
  ------------------------------------------------------------------------------
   Combine ecal and hcal if associated to each other
    called from QFCALD
                                                      H.Albrecht 27.2.89
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   QFCALD                                                                          
        |---- QFCASC                                                               
                   |----  KPCOMP                                                   
                   |----  KFPADR                                                   
                   |----  IABS                                External             
                   |----  QFCADD                                                   
                   |----  QADAU                                                    
                   |----  QAMOTH                                                   
   
 
3 QFCHGD
         SUBROUTINE QFCHGD
  ------------------------------------------------------------------------------
    CKEY  FILL CHARGED /INTERNAL
  ------------------------------------------------------------------------------
   Fill qvec with reconstructed charged tracks from pot / dst
    from QFILL
                                                     H.Albrecht 20.09.88
                               Modified:             E.Blucher  19.04.90
                 Modified for FRFT NR=2:             E.Blucher  04.04.91
                      Modified for MUID:             E.Blucher  18.08.92
                 Suppress call to QFPMSC             J.Boucrot  09.01.01
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   QFILL                                                                           
        |---- QFCHGD                                                               
                   |----  QWMESE                                                   
                   |----  KPCOMP                                                   
                   |----  KFPADR                                                   
                   |----  QSBANK                                                   
                   |----  COS                                 External             
                   |----  SIN                                 External             
                   |----  SQRT                                External             
                   |----  ABS                                 External             
   
 
3 QFCOBJ
         SUBROUTINE QFCOBJ
  ------------------------------------------------------------------------------
    CKEY FILL CAL /INTERNAL
  ------------------------------------------------------------------------------
   Fill calorimeter objects
    called from QFCALD
                                                      H.Albrecht 27.2.89
                                                      E. Blucher 04.4.89
    Rewritten to avoid ASSIGN statements              J. Boucrot 24.9.93
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   QFCALD                                                                          
        |---- QFCOBJ                                                               
                   |----  KPCOMP                                                   
                   |----  KFPADR                                                   
                   |----  NLINK                               External             
                   |----  QSBANK                                                   
                   |----  QFECAL                                                   
                   |----  QFCOEQ                                                   
                   |----  QFHCAL                                                   
                   |----  QFCOER                                                   
   
 
3 QFCOEQ
         SUBROUTINE QFCOEQ(EN,TH,PH,SIGEN,SIGPH,SIGTH,NTK1,ICALFL)
  ------------------------------------------------------------------------------
    CKEY FILL CAL /INTERNAL
  ------------------------------------------------------------------------------
   Fill qvec for calorimeter objects
    auxiliary to  QFCOBJ
                                                      J.Boucrot  23.9.93
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   QFCOBJ                                                                          
        |---- QFCOEQ                                                               
                   |----  COS                                 External             
                   |----  SIN                                 External             
   
 
3 QFCOER
         SUBROUTINE QFCOER(NTK1,NTK2,IREL1,IREL2)
  ------------------------------------------------------------------------------
    CKEY FILL CAL /INTERNAL
  ------------------------------------------------------------------------------
   Set up relations for calorimeter objects
    auxiliary to  QFCOBJ
                                                      J.Boucrot  23.9.93
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   QFCOBJ                                                                          
        |---- QFCOER.                                                              
   
 
3 QFCOMP
         SUBROUTINE QFCOMP (NTKE, NTKH, FLAG)
  ------------------------------------------------------------------------------
    CKEY FILL CAL /INTERNAL
  ------------------------------------------------------------------------------
   Decide whether ecal object ntke and hcal object ntkh really form a
    composite object. Called once for each ECAL object which is
    associated to an HCAL object.
    Output : Set FLAG to .FALSE. and the relation between ECAL and HCAL
    will be ignored.
   
    from QFCREL
                                                      H.Albrecht 27.2.89
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   QFCREL                                                                          
        |---- QFCOMP                                                               
                   |----  SIGN                                External             
                   |----  SQRT                                External             
                   |----  ABS                                 External             
                   |----  NINT                                External             
                   |----  KMATIX                              External             
                   |----  ATG                                 External             
                   |----  KCLARM                              External             
                   |----  IAND                                External             
                   |----  KLOCK0                              External             
                   |----  IABS                                External             
   
 
3 QFCREL
         SUBROUTINE QFCREL
  ------------------------------------------------------------------------------
    CKEY FILL CAL /INTERNAL
  ------------------------------------------------------------------------------
   Check the relations between ecal objects and hcal objects.
    from QFCASC
                                                      H.Albrecht 27.2.89
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   QFCALD                                                                          
        |---- QFCREL                                                               
                   |----  KPCOMP                                                   
                   |----  KFPADR                                                   
                   |----  IABS                                External             
                   |----  QFCOMP                                                   
                   |----  QWMESE                                                   
                   |----  QVCOPY                                                   
   
 
3 QFD0Z0
         SUBROUTINE QFD0Z0
  ------------------------------------------------------------------------------
    CKEY  FILL CHARGED / INTERNAL
  ------------------------------------------------------------------------------
   Recompute d0 and z0 of alpha charged tracks
                                                  J.Boucrot  03.02.98
      modified for new getlep/getbp               J.Boucrot  28.09.98
    from QFILL
    the d0 and z0 of all charged tracks using the event
    vertex
    execution of this routine is under the control of the data card
   0NW
    common /IDZVRT/ the flag ID0Z0FL is set to the following value:
    ID0Z0FL = 1 if d0,z0 from the QFNDIP event primary vertex
    ID0Z0FL = 2 if d0,z0 from the event-chunk beam position
    ID0Z0FL = 3 if d0,z0 from the LEP 1 run-by-run average
    ID0Z0FL = 0 if none of the above values available
    This value can be accessed through the user-function KD0FL(dummy)
   
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   QFILL                                                                           
        |---- QFD0Z0                                                               
                   |----  SIGN                                External             
                   |----  SQRT                                External             
                   |----  ABS                                 External             
                   |----  NINT                                External             
                   |----  KMATIX                              External             
                   |----  ATG                                 External             
                   |----  KCLARM                              External             
                   |----  IAND                                External             
                   |----  KLOCK0                              External             
                   |----  IABS                                External             
                   |----  NAMIND                              External             
                   |----  COS                                 External             
                   |----  SIN                                 External             
   
 
3 QFECAL
         SUBROUTINE QFECAL (NPECO, EN, TH, PH, SIGEN, SIGTH, SIGPH)
  ------------------------------------------------------------------------------
    CKEY FILL CAL /INTERNAL
  ------------------------------------------------------------------------------
   Get energy, theta, phi from row npeco in ecal bank peco.
    SIGEN etc : error**2
    from QFCOBJ
                                                     H.Albrecht 03.03.89
                                                     E.Blucher  04.04.89
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   QFCOBJ                                                                          
        |---- QFECAL                                                               
                   |----  QMBANK                                                   
                   |----  NLINK                               External             
   
 
3 QFECWD
         SUBROUTINE QFECWD
  ------------------------------------------------------------------------------
    CKEY FILL ECAL /INTERNAL
  ------------------------------------------------------------------------------
   Fill ecal wire energies from dst or pot
   
      Author   :- E. Blucher     27-AUG-1990
      Description
      ===========
    Fills QEECWI(IMOD) from PEWI bank.
      ===> called from QFILL
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   QFILL                                                                           
        |---- QFECWD                                                               
                   |----  NLINK                               External             
                   |----  FLOAT                               External             
   
 
3 QFECWM
         SUBROUTINE QFECWM
  ------------------------------------------------------------------------------
    CKEY FILL ECAL /INTERNAL
  ------------------------------------------------------------------------------
   Fill ecal wire energies from mdst
   
      Author   :- E. Blucher     27-AUG-1990
      Description
      ===========
    Fills QEECWI(IMOD) from DEWI bank.
      ===> called from QFILL
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   QFILL                                                                           
        |---- QFECWM                                                               
                   |----  FLOAT                               External             
   
 
3 QFEFLO
         SUBROUTINE QFEFLO
  ------------------------------------------------------------------------------
    CKEY FILL EFLOW /INTERNAL
  ------------------------------------------------------------------------------
   Fill eft section from efol bank.
   
      Author   :- E. Blucher     15-Jul-1991
     Modified  :- E. Blucher     02-Feb-1992
     Modified  :- E. Blucher     02-Sep-1992
     Modified  :- J. Boucrot     12-Oct-1993
        kfeft = first EFLW track
        kleft = last EFLW track
        kneft = number of EFLW tracks
        Objects from EFOL stored as 'EFLW'
   
     Called from QFILL
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   QFILL                                                                           
        |---- QFEFLO                                                               
                   |----  SIGN                                External             
                   |----  SQRT                                External             
                   |----  ABS                                 External             
                   |----  NINT                                External             
                   |----  KMATIX                              External             
                   |----  ATG                                 External             
                   |----  KCLARM                              External             
                   |----  IAND                                External             
                   |----  KLOCK0                              External             
                   |----  IABS                                External             
                   |----  KPCOMP                                                   
                   |----  KFPADR                                                   
                   |----  NLINK                               External             
                   |----  NAMIND                              External             
                   |----  CHAINT                              External             
                   |----  NDROP                               External             
                   |----  ENFJET                                                   
                   |----  QSBANK                                                   
                   |----  QEFRTR                                                   
                   |----  QVCOPY                                                   
                   |----  QSBITM                                                   
   
 
3 QFFRFT
         SUBROUTINE QFFRFT
  ------------------------------------------------------------------------------
    CKEY FILL /INTERNAL
  ------------------------------------------------------------------------------
   Deal with frft banks and frxy data cards
    called from QFILL
                                                      J.Boucrot  23.02.98
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   QFILL                                                                           
        |---- QFFRFT                                                               
                   |----  MINPFR                                                   
                   |----  ABRUEV                              External             
                   |----  GTSTUP                              External             
                   |----  NDROP                               External             
                   |----  NAMIND                              External             
                   |----  NSWAP                               External             
   
 
3 QFGAMP
         SUBROUTINE QFGAMP
  ------------------------------------------------------------------------------
    CKEY FILL PCPA EFLOW /INTERNAL
  ------------------------------------------------------------------------------
   Fill gat section from pgac bank ( or old pgpc or older egpc )
   
      Author   :- E. Blucher     02-Feb-1992
      Modified J. Boucrot  02-Apr-1993  for new GAMPEX 'PGPC' bank
      Modified J. Boucrot  28-Oct-1994  for new GAMPEX 'PGAC' bank
      Modified J. Boucrot  12-Dec-2001  to allow MINI 205 for REPG
        kfgat = first GAMPEC  track
        klgat = last GAMPEC track
        kngat = number of GAMPEC tracks
        Objects from EGPC or PGPC bank stored as 'GAMP'
   
    Called from QFILL
   
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   QFILL                                                                           
        |---- QFGAMP                                                               
                   |----  SIGN                                External             
                   |----  SQRT                                External             
                   |----  ABS                                 External             
                   |----  NINT                                External             
                   |----  KMATIX                              External             
                   |----  ATG                                 External             
                   |----  KCLARM                              External             
                   |----  IAND                                External             
                   |----  KLOCK0                              External             
                   |----  IABS                                External             
                   |----  KPCOMP                                                   
                   |----  KFPADR                                                   
                   |----  MINGTV                                                   
                   |----  NAMIND                              External             
                   |----  BKFMT                               External             
                   |----  BDROP                               External             
                   |----  GAPGPC                              External             
                   |----  BLIST                               External             
                   |----  GAPGID                              External             
                   |----  GAPGAC                              External             
                   |----  QSBANK                                                   
                   |----  SIN                                 External             
                   |----  COS                                 External             
                   |----  QSBITM                                                   
   
 
3 QFGETBP
         SUBROUTINE QFGET_BP (IRUN, IEVT, ICHUNK, VTX, VTX_ERR, VTX_SIZE)
  ------------------------------------------------------------------------------
    CKEY FILL BEAMSPOT / INTERNAL
  ------------------------------------------------------------------------------
   Chunk-by-chunk beam position and size
   - Interface to the ALEPHLIB routines getlep/getbp  J. Boucrot 24-9-98
   - Modified A. Ealet 12-6-99  to smear beam error uncertainties
              in MCarlo datasets using datacard SIBE
   - Input:
     IRUN         / I  Run number
     IEVT         / I  Event number
   - Input and output:
     ICHUNK       / I  Previous chunk number; set this to 0 for the
                         first call.  It is updated by the subroutine,
                         and the subsequent call to QFGET_BP should be
                         made with the returned value.  If ICHUNK is
                         returned -1, no BP information exists for this
                         run/event.
   - Output:
     VTX(3)       / R  (x,y,z) position of luminous region centroid (cm)
                         Notice: VTX(3) is always set equal to zero.
     VTX_ERR(3)   / R  Estimated uncertainties on VTX (cm)
                         Notice: VTX_ERR(3) is always set equal to 1.
     VTX_SIZE(3)  / R  (x,y,z) rms size of luminous region (cm),
                         averaged over the year/run period
     Real data:
     The beam position x and y and their uncertainties returned in VTX
     and VTX_ERR are taken from the ALPB bank in the run record, or
     from the beam.position file if JULIA version < 275.03.  The sizes
     of the luminous region returned in VTX_SIZE are taken from the
     ALRP database bank and are average values for the year (or run
     period).
     Monte Carlo:
     The beam position x and y returned in VTX are generated so as to
     simulate the desired beam size distribution.  The primary vertex
     position of the event is extracted from truth information and an
     offset is added according to the size of the luminous region.
     The smearing corresponding to the average chunk-by-chunk beam
     position uncertainty (VTX_ERR) is included.  The "desired" beam
     size distribution is by default taken from measurements of the
     actual LEP conditions for the geometry year of the Monte Carlo
     file.  This default may be changed by means of data cards as
     explained below.  The horizontal size of the luminous region,
     sigma_x, is thrown at random from the measured distribution, which
     is parametrized as the sum of two Gaussians (not a delta function).
     The uncertainties in x and y returned in VTX_ERR, as well as the
     three sizes returned in VTX_SIZE, are taken from the ALRP database
     bank and are average values for the year.
     Customizing the luminous region size for Monte Carlo:
     As mentioned above, the default behavior is to use the luminous
     region size parameters for the geometry year of the Monte Carlo
     file.  The BPER card allows the user to override the default.  The
     parameters from the year(s) specified on this card are then used;
     each event is assigned at random to a particular year.  The years
     (in the LEP 1 era) are weighted according to the numbers of qqbar
     events in the MAYB/PERF runs in the VD run selection.  Different
     weights may be specified by means of the BPWT card.  (This card is
     mandatory for specifying the relative weights of LEP 2 periods,
     if two or more periods are selected with BPER.)  Finally, arbitrary
     beam sizes may be simulated by means of the BSIZ card.
     The BPER, BPWT, and BSIZ cards have no effect when real data is
     analyzed.
     Syntax:
     BPER [per1 [per2 [per3...]]]
       where per1,per2,per3... are run periods as specified in the
       first column of ADBR.  Years may be given as "1992" or "92"
       or "9200".  Other run periods have the form "YYMM", such as
       "9510".  A list of valid run periods is printed (and
       execution terminates) if the BPER card is given with invalid
       or no run periods.
     BPWT [iwt1 [iwt2 [iwt3...]]]
       where iwt1,iwt2,iwt3... are *integer* weights for the periods
       listed on the BPER card.  An error results if there is no
       accompanying BPER or if it has a different number of tokens.
       The weights may have an arbitrary normalization.
     BSIZ sigma_x sigma_y [sigma_z]
       where sigma_x and sigma_y are floating point numbers giving the
       desired sizes of the luminous region in cm.  The BSIZ card
       overrides all values in ALRP.  The value of sigma_z, if given,
       is returned in VTX_SIZE(3) but has no other effect.  If sigma_z
       is not given, the value 1 is returned in VTX_SIZE(3).
       Notes: the beam position uncertainty is set to zero if BSIZ is
       given.  BPER/BPWT cards are ignored if BSIZ is given.
     Examples:
     1. To simulate 1993 and 1994 beam size conditions:
        BPER 1993 1994
     2. To simulate 1993 and 1994 with equal weights:
        BPER 1993 1994
        BPWT   50   50
     3. To simulate a luminous region size of 120 x 7 microns:
        BSIZ 0.0120 0.0007
   
 
3 QFHCAL
         SUBROUTINE QFHCAL (NPHCO, EN, TH, PH, SIGEN, SIGTH, SIGPH)
  ------------------------------------------------------------------------------
    CKEY FILL CAL /INTERNAL
  ------------------------------------------------------------------------------
   Get energy, theta, phi from row nphco in ecal bank phco.
    SIGEN etc : error**2
    from QFCOBJ
                                                     H.Albrecht 03.03.89
                                                     E.Blucher  04.04.89
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   QFCOBJ                                                                          
        |---- QFHCAL                                                               
                   |----  QMBANK                                                   
   
 
3 QFHEAD
         SUBROUTINE QFHEAD
  ------------------------------------------------------------------------------
    CKEY FILL HEADER /INTERNAL
  ------------------------------------------------------------------------------
   Puts selected contents of banks eveh, dhea, kevh into variables
      in COMMON blocks
   
     Author   : E. Blucher      5-OCT-1988
     Modified : E.Blucher      18-APR-1991
        -- All ALPHA variables reset to zero if banks not available.
           ALTRIG used to fill trigger words.
   
     Called from QFILL
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   QFILL                                                                           
   QWHEAD                                                                          
   QWHFUL                                                                          
        |---- QFHEAD                                                               
                   |----  BTEST                                                    
                   |----  ALTRIG                              External             
                   |----  XLUMOK                              External             
                   |----  QBOMEV                                                   
   
 
3 QFILBP
         SUBROUTINE QFILBP
  ------------------------------------------------------------------------------
    CKEY FILL BEAMPOS/INTERNAL
  ------------------------------------------------------------------------------
   Fill beam position from get_bp algorithm
    then find the interaction point from QFNDIP algorithm
    called from QFILL
                                                   J.Boucrot   14.06.93
     Modified to call QFNDIP                       J.Boucrot   06.10.93
     Modified to call KGTBLQ                       O.Schneider 12.11.96
     Change QFGET_BP defaults to crazy values    S.Wasserbaech 03.06.98
     Split the execution in two                    J.Boucrot   24.09.98
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   QFILL                                                                           
        |---- QFILBP                                                               
                   |----  SIGN                                External             
                   |----  SQRT                                External             
                   |----  ABS                                 External             
                   |----  NINT                                External             
                   |----  KMATIX                              External             
                   |----  ATG                                 External             
                   |----  KCLARM                              External             
                   |----  IAND                                External             
                   |----  KLOCK0                              External             
                   |----  IABS                                External             
                   |----  NAMIND                              External             
                   |----  QFGET_BP                                                 
                   |----  KGTBLQ                                                   
                   |----  QWMESE                                                   
                   |----  QFNDIP                                                   
   
 
3 QFILL
         SUBROUTINE QFILL
  ------------------------------------------------------------------------------
    CKEY FILL /INTERNAL
  ------------------------------------------------------------------------------
   Fill qvec and qvrt
    from QMEVNT
                                                      H.Albrecht 20.09.88
                                                      E.Blucher  01.02.92
                                                      G.Graefe   22.04.94
                                                      P.Perret   11.02.97
                                                      J.Boucrot  23.02.98
                                                      F.Ligabue  16.07.98
                                                      J.Boucrot  10.05.99
                                                      J.Boucrot  12.01.01
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   QMEVNT                                                                          
        |---- QFILL                                                                
                   |----  MINFIL                                                   
                   |----  NANFIL                                                   
                   |----  PCPATQ                              External             
                   |----  HCALENSC                                                 
                   |----  QURESC                                                   
                   |----  QFFRFT                                                   
                   |----  QMCLR                                                    
                   |----  QFILBP                                                   
                   |----  QFHEAD                                                   
                   |----  QFCHGD                                                   
                   |----  BDROP                               External             
                   |----  NAMIND                              External             
                   |----  QFCALD                                                   
                   |----  QFECWM                                                   
                   |----  NLINK                               External             
                   |----  QFECWD                                                   
                   |----  QFBITM                                                   
                   |----  QFREV0                                                   
                   |----  QFILNV                                                   
                   |----  QTRESC                                                   
                   |----  QFGAMP                                                   
                   |----  FIXGAEN                                                  
                   |----  QFDE14                                                   
                   |----  MINGTV                                                   
                   |----  NDROP                               External             
                   |----  QUEFLO                                                   
                   |----  QFEFLO                                                   
                   |----  QFNEOB                                                   
                   |----  QFJETS                                                   
                   |----  QFILMC                                                   
                   |----  QFLEPT                                                   
                   |----  QFD0Z0                                                   
                   |----  FIXRTRL                                                  
                   |----  FIXPRL                                                   
                   |----  QLEVNT                                                   
                   |----  QFPTPX                                                   
                   |----  QFKIREV                                                  
   
 
3 QFILMC
         SUBROUTINE QFILMC
  ------------------------------------------------------------------------------
    CKEY FILL MC /INTERNAL
  ------------------------------------------------------------------------------
   Fill p vector with mc-truth info
                                                      J.Hilgart 21.09.88
                                                     H.Albrecht 18.10.88
    from QFILL
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   QFILL                                                                           
        |---- QFILMC                                                               
                   |----  FYIRUN                              External             
                   |----  FYKINE                              External             
                   |----  QMTERM                                                   
                   |----  QFMCVX                                                   
                   |----  QFMCPA                                                   
                   |----  QFMCMD                                                   
                   |----  QFMCBM                                                   
                   |----  QFMCST                                                   
                   |----  QFMTCH                                                   
   
 
3 QFILNV
         SUBROUTINE QFILNV
  ------------------------------------------------------------------------------
    CKEY FILL MC /INTERNAL
  ------------------------------------------------------------------------------
   Fill non-standard vertices from new tracking
                                                      J.Boucrot 21.04.97
    from QFILL
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   QFILL                                                                           
        |---- QFILNV                                                               
                   |----  QFYLV0                                                   
                   |----  QFKINK                                                   
                   |----  QFNINT                                                   
   
 
3 QFJETS
         SUBROUTINE QFJETS
  ------------------------------------------------------------------------------
    CKEY FILL JETS EFLOW /INTERNAL
  ------------------------------------------------------------------------------
   Fill ejet section from ejet bank.
   
      Author   :- E. Blucher     14-JUL-1992
        KFJET = first jet
        KLJET = last jet
        KNJET = number of jets
        Objects from EJET stored as 'EJET'
   
     Called from QFILL
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   QFILL                                                                           
        |---- QFJETS                                                               
                   |----  SIGN                                External             
                   |----  SQRT                                External             
                   |----  ABS                                 External             
                   |----  NINT                                External             
                   |----  KMATIX                              External             
                   |----  ATG                                 External             
                   |----  KCLARM                              External             
                   |----  IAND                                External             
                   |----  KLOCK0                              External             
                   |----  IABS                                External             
                   |----  KPCOMP                                                   
                   |----  KFPADR                                                   
                   |----  NLINK                               External             
                   |----  QSBANK                                                   
   
 
3 QFKINK
         SUBROUTINE QFKINK
  ------------------------------------------------------------------------------
    CKEY FILL VERTEX   /INTERNAL
  ------------------------------------------------------------------------------
   Fill parameters of kink vertices from new tracking
     - bank YKNK
   
      Author   :  J. Boucrot                    21-Apr-1997
      Calls QNVSTO
      Output :
           - new vertex in QVRT is created.
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   QFILNV                                                                          
        |---- QFKINK                                                               
                   |----  SIGN                                External             
                   |----  SQRT                                External             
                   |----  ABS                                 External             
                   |----  NINT                                External             
                   |----  KMATIX                              External             
                   |----  ATG                                 External             
                   |----  KCLARM                              External             
                   |----  IAND                                External             
                   |----  KLOCK0                              External             
                   |----  IABS                                External             
                   |----  NAMIND                              External             
                   |----  VZERO                               External             
                   |----  QNVSTO                                                   
   
 
3 QFKIREV
         subroutine qfkirev
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
    fills common  /kinruev / for kinrun statistics
    called from QFILL
         save
   
   -------------------- /QCDE/ --- COMMONs, DIMENSIONs, etc. ------------
   
    of QCDESH ----------------------- Description in QDATA ---------
         PARAMETER (KCQDET=34, KCQFPA=8, KCQPAR=10, KCQVEC=73, KCQVRT=30,
        & KHE=1, KHMU=2, KHPI=3, KHK=4, KHP=5, KHPHOT=1, KHNHAD=2,
        & KMONTE=-2, KRECO=-1, KLOCKM=14, KSOVT=1, KSCHT=2, KSIST=3,
        & KSAST=4, KSEHT=5, KSV0T=6, KSDCT=7, KSEFT=8, KSNET=9, KSGAT=10,
        & KSJET=11, KSMCT=12, KSREV=13,
        & KSMCV=14, KUNDEF=-12344321, QQPI=3.141593, QQE=2.718282,
        & QQ2PI=QQPI*2., QQPIH=QQPI/2., QQRADP=180./QQPI, QQC=2.997925E10,
        & QQH=6.582173E-25, QQHC=QQH*QQC, QQIRP=.00029979)
         CHARACTER CQDATE*8, CQDWRK*80, CQFHIS*80, CQFOUT*80, CQFWRK*80,
        & CQHTIT*80, CQSEC*3, CQTIME*8, CQUNPK*30, CQVERS*6, CQRLST*800,
        & CQELST*800
         COMMON /QCDEC/ CQDATE, CQDWRK, CQFHIS, CQFOUT, CQFWRK, CQHTIT,
        & CQSEC(14), CQTIME, CQUNPK, CQVERS, CQRLST, CQELST
         COMMON /QCDE/ QELEP, QMFLD ,QMFLDC, QTIME, QTIMEI, QTIMEL,
        & QTIMES, QTIMET, QDHEEC, QDHEEL, QDHEPF, QDHETH, QDHEPH, QDHEEF,
        & QDHEET, QDHET1, QDHEP1, QDHET2, QDHEP2, QDHEE1, QDHEE2, QDHEE3,
        & QKEVRN, QKEVWT, QVXNOM, QVYNOM, QVZNOM, QVXNSG, QVYNSG, QVZNSG,
        & QINLUM, QRINLN, QRINLU, QDBOFS, QEECWI(36), QVXBOM, QVYBOM,
        & QSILUM, QRSLLU, QRSLBK, QRSLEW , QVTXBP(3), QVTEBP(3), QVTSBP(3)
         COMMON /QCDE/  KFOVT, KLOVT, KNOVT, KFCHT, KLCHT, KNCHT, KFIST,
        & KLIST, KNIST, KFAST, KLAST, KNAST, KFEHT, KLEHT, KNEHT, KFV0T,
        & KLV0T, KNV0T, KFDCT, KLDCT, KNDCT, KFEFT, KLEFT, KNEFT, KFNET,
        & KLNET, KNNET, KFGAT, KLGAT, KNGAT, KFJET, KLJET, KNJET, KFMCT,
        & KLMCT, KNMCT, KFREV, KLREV, KNREV, KFMCV, KLMCV, KNMCV, KLUST,
        & KLUSV, KFFRT, KLFRT, KFFRV, KLFRV, KNRET, KNCOT, KFFRD,
        & KLFJET,KLLJET,KLNJET
         COMMON /QCDE/ KBIT(32), KCLACO(KCQFPA), KCLAFR(KCQFPA), KCLARM
        & (KCQFPA), KDEBUG, KEVT, KEXP, KFFILL, KFEOUT, KJOPTN(2,2),
        & KLEOUT, KLROUT, KLOCK0(KLOCKM,2), KLOCK1(KLOCKM,2), KLOCK2(
        & KLOCKM,2), KMATIX(6,6), KMQFPA, KNEFIL, KNEOUT, KNEVT, KNPAST,
        & KNQDET, KNQFPA, KNQLIN, KNQMTX, KNQPAR, KNQPST, KNREIN, KNREOU,
        & KOQDET, KOQFPA, KOQLIN, KOQMTL, KOQMTS, KOQPAR, KOQPBT, KOQPLI,
        & KOQTRA, KOQVEC, KOQVRT, KQPAR, KQVEC, KQVRT, KQWRK, KQZER, KRUN,
        & KSTATU, KTDROP, KUCARD, KUCONS, KUHIST, KUINPU, KUOUTP, KUPRNT,
        & KUPTER, KDEBU1, KDEBU2, KNWRLM, KEFOPT, KUEDIN, KUEDOU, KURTOX,
        & KUCAR2, KNHDRN, KNBHAB, KSBHAB, KRSLLQ, KRSLNB
         COMMON /QCDE/ INDATA
         COMMON /QCDE/ KRINNE, KRINNF, KRINDC, KRINDQ, KRINNZ, KRINNB,
        & KRINBM, KRINFR, KRINLR, KRINLF
         COMMON /QCDE/ KEVERT, KEVEDA, KEVETI, KEVEMI(4), KEVETY, KEVEES,
        & KDHEFP, KDHENP, KDHENM, KKEVNT, KKEVNV, KKEVID, KDHENX, KDHENV,
        & KDHENJ, KREVDS, KXTET1, KXTET2, KXTEL2, KXTCGC, KXTCLL, KXTCBN,
        & KXTCCL, KXTCHV, KXTCEN, KCLASW, KERBOM, KBPSTA
         DIMENSION KLOCUS(3,14)
         EQUIVALENCE (KLOCUS(1,1),KFOVT), (KFOVT,KFRET), (KLIST,KLRET),
        & (KFIST,KFCOT), (KLAST,KLCOT)
         COMMON /QCDE/ XCOPYJ, XFLIAC, XHISTO, XLREV(2), XLREV2(2), XMCEV,
        & XMINI, XSYNTX, XWREVT, XWRRUN, XFILMC, XFILCH, XFILV0, XFILCO,
        & XFILEF, XFILPC, XFILGA, XFILJE,
        & XPRHIS, XFILL, XVITC, XVTPC, XVECAL, XVLCAL, XVTPCD,
        & XVSATR, XVHCAL, XHVTRG, XSREC, XWMINI, XIOKLU, XIOKSI, XFRF2,
        & XNSEQ, XVDOK, XFRF0, XFMUID, XFILEM, XWNANO, XROKSI, XGETBP,
        & XJTHRU
         LOGICAL XCOPYJ, XFLIAC, XHISTO, XLREV, XLREV2, XMCEV, XMINI,
        & XSYNTX, XWREVT, XWRRUN, XFILMC, XFILCH, XFILV0, XFILCO, XFILEF,
        & XFILPC, XPRHIS, XFILL, XVITC, XVTPC, XVECAL, XVLCAL, XVTPCD,
        & XVSATR, XVHCAL, XHVTRG, XSREC, XWMINI, XIOKLU, XFRF2, XFILJE,
        & XNSEQ, XFILGA, XVDOK, XFRF0, XFMUID, XFILEM, XWNANO, XIOKSI,
        & XROKSI, XGETBP, XJTHRU
   
   -------------------- /NANCOM/ --- NanoDst steering -------------------
   Xnano   .true. if input is a nanodst (in nano or epio format, depending
                      XNANOR)
   
         LOGICAL XNANO
         COMMON /NANCOM/XNANO
   
   
    bcs
         INTEGER LMHLEN, LMHCOL, LMHROW
         PARAMETER (LMHLEN=2, LMHCOL=1, LMHROW=2)
         COMMON /BCS/   IW(1000)
         INTEGER IW
         REAL RW(1000)
         EQUIVALENCE (RW(1),IW(1))
   
   
   ------------------ /QCNAMI/ --- name indices -------------------------
         COMMON /QCNAMI/ NAAFID,NAAJOB,NAASEV,NABCNT,NABHIT,NABOMB,
        1 NABOME,NABOMP,NABOMR,NABPTR,NADCAL,NADCRL,NADECO,NADEID,NADENF,
        2 NADEVT,NADEWI,NADFMC,NADFOT,NADGAM,NADHCO,NADHEA,NADHRL,NADJET,
        3 NADMID,NADMJT,NADMUO,NADNEU,NADPOB,NADRES,NADTBP,NADTMC,NADTRA,
        4 NADVER,NADVMC,NAECRQ,NAECTE,NAEGID,NAEGPC,NAEIDT,NAEJET,NAERRF,
        5 NAETDI,NAETKC,NAEVEH,NAEWHE,NAFICL,NAFKIN,NAFPOI,NAFPOL,NAFRFT,
        6 NAFRID,NAFRTL,NAFSTR,NAFTCL,NAFTCM,NAFTOC,NAFTTM,NAFVCL,NAFVER,
        7 NAFZFR,NAHCCV,NAHCTE,NAHINF,NAHMAD,NAHPDI,NAHROA,NAHSDA,NAHTUB,
        8 NAIASL,NAIPJT,NAIRJT,NAITCO,NAITMA,NAIXTR,NAIZBD,NAJBER,NAJEST,
        9 NAJSUM,NAKEVH,NAKINE,NAKJOB,NAKLIN,NAKPOL,NAKRUN,NALIDT,NALOLE,
        A NALUPA,NAMCAD,NAMHIT,NAMTHR,NAMUDG,NAMUEX,NAOSTS,NAPART,NAPASL,
        B NAPCHY,NAPCOB,NAPCOI,NAPCPA,NAPCQA,NAPCRL,NAPECO,NAPEHY,NAPEID,
        C NAPEMH,NAPEPT,NAPEST,NAPEWI,NAPFER,NAPFHR,NAPFRF,NAPFRT,NAPHCO,
        D NAPHER,NAPHHY,NAPHMH,NAPHST,NAPIDI,NAPITM,NAPLID,NAPLPD,NAPLSD,
        E NAPMSK,NAPNEU,NAPPDS,NAPPOB,NAPPRL,NAPRTM,NAPSCO,NAPSPO,NAPSTR,
        F NAPT2X,NAPTBC,NAPTCO,NAPTEX,NAPTMA,NAPTML,NAPTNC,NAPTST,NAPVCO,
        G NAPYER,NAPYFR,NAPYNE,NAQDET,NAQFPA,NAQLIN,NAQMTL,NAQMTS,NAQPAR,
        H NAQPBT,NAQPLI,NAQTRA,NAQVEC,NAQVRT,NAQWRK,NAQZER,NAREVH,NARHAH,
        I NARTLO,NARTLS,NARUNH,NARUNR,NASFTR,NATEXS,NATGMA,NATMTL,NATPCO,
        J NAVCOM,NAVCPL,NAVDCO,NAVDHT,NAVDXY,NAVDZT,NAVERT,NAVFHL,NAVFLG,
        K NAVFPH,NAVHLS,NAVPLH,NAX1AD,NAX1SC,NAX1TI,NAX2DF,NAX3EC,NAX3EW,
        L NAX3HC,NAX3IT,NAX3L2,NAX3LU,NAX3TM,NAX3TO,NAX3TP,NAX3X3,NAXTBN,
        M NAXTBP,NAXTCN,NAXTEB,NAXTOP,NAXTRB,NAYV0V,NAZPFR,NAEFOL,NAMUID,
        N NAPGID,NAPGPC,NAPGAC,NAPMSC,NAPTHR,NANBIP,NAPDLT,NAPMLT,NAPLJT
   
   
   ------------------ /QQQQJJ/ --- HAC parameters for ALPHA banks -------
         PARAMETER (JQVEQX= 1,JQVEQY= 2,JQVEQZ= 3,JQVEQE= 4,JQVEQM= 5,
        & JQVEQP= 6,JQVECH= 7,JQVETN= 8,JQVESC= 9,JQVEKS=10,JQVECL=11,
        & JQVEPA=12,JQVEQD=13,JQVENP=14,JQVESP=15,JQVEOV=16,JQVEEV=17,
        & JQVEND=18,JQVEDL=19,JQVENO=20,JQVEOL=21,JQVENM=22,JQVEML=23,
        & JQVEBM=24,JQVELK=38,JQVEDB=39,JQVEZB=40,JQVESD=41,JQVESZ=42,
        & JQVECB=43,JQVEEM=44,JQVECF=54,JQVEEW=55,JQVEUS=56)
         PARAMETER ( JQVRVX=1,JQVRVY=2,JQVRVZ=3,JQVRVN=4,JQVRTY=5,
        1   JQVRIP=6,JQVRND=7,JQVRDL=8,JQVRAY=9,JQVRAF=10,JQVREM=11,
        2   JQVRCF=17,JQVRET=18)
         PARAMETER ( JQDEAF= 1,JQDEAL= 2,JQDENT= 3,JQDEAT= 4,JQDELT= 8,
        &  JQDEAE= 9,JQDEAH=10,JQDEAM=11,JQDECF=12,JQDEEC=13,JQDEHC=14,
        &  JQDEET=15,JQDEFI=16,JQDENF=17,JQDEFL=18,JQDENE=19,JQDEEL=20,
        &  JQDENH=21,JQDEHL=22,JQDELH=23,JQDEEF=24,JQDEPC=25,JQDEEG=26,
        &  JQDEMU=27,JQDEDX=28,JQDEPG=29,JQDEPD=30,JQDEPM=31)
         PARAMETER ( JQPAGN=1, JQPANA=2, JQPACO=5, JQPAMA=6, JQPACH=7,
        & JQPALT=8,JQPAWI=9,JQPAAN=10)
   
   
         EXTERNAL CQPART, CQTPN, XCEQAN, XLUMOK, XPEQAN, XPEQOR, XPEQU,
        & XVDEOK, LLUMOK, SLUMOK
         CHARACTER * 12 CQPART, CQTPN
         LOGICAL XCAL, XCEQAN, XCEQOR, XCEQU, XECAL, XEID, XFRF, XHCAL,
        & XHMA, XLOCK, XLOCKN, XMC, XLUMOK, XMCA, XPEO, XPHO, XPEQAN,
        & XPEQOR, XPEQU, XSAME, XSIG, XTEX, XPEC, XPEP, XPHC, XYV0,
        & XFRIQF, XEFO, XPCQ, XEGP, XMUI, XVDEOK, XPGP, LLUMOK, SLUMOK,
        & XPGAC, XLEPTG, XLEPTH
   
    alcons
    define universal constants
         REAL PI, TWOPI, PIBY2, PIBY3, PIBY4, PIBY6, PIBY8, PIBY12
         REAL RADEG, DEGRA
         REAL CLGHT, ALDEDX
         PARAMETER (PI=3.141592653589)
         PARAMETER (RADEG=180./PI, DEGRA=PI/180.)
         PARAMETER (TWOPI = 2.*PI , PIBY2 = PI/2., PIBY4 = PI/4.)
         PARAMETER (PIBY6 = PI/6. , PIBY8 = PI/8.)
         PARAMETER (PIBY12= PI/12., PIBY3 = PI/3.)
         PARAMETER (CLGHT = 29.9792458, ALDEDX = 0.000307)
   
         ALDEDX  = constant used in the computation of DEDX in GeV
         CLGHT   = speed of light in cm/nsec
   
   
   
    efoljj
         INTEGER JEFOPX,JEFOPY,JEFOPZ,JEFOEW,JEFOWE,JEFOTY,JEFOLE,JEFOLT,
        +          JEFOLH,JEFOLC,JEFOLJ,LEFOLA
         PARAMETER(JEFOPX=1,JEFOPY=2,JEFOPZ=3,JEFOEW=4,JEFOWE=5,JEFOTY=6,
        +          JEFOLE=7,JEFOLT=8,JEFOLH=9,JEFOLC=10,JEFOLJ=11,
        +          LEFOLA=11)
   
   
    egpcjj
         INTEGER JEGPPX,JEGPPY,JEGPPZ,JEGPR1,JEGPR2,JEGPF4,JEGPDM,JEGPST,
        +          JEGPQU,JEGPPE,LEGPCA
         PARAMETER(JEGPPX=1,JEGPPY=2,JEGPPZ=3,JEGPR1=4,JEGPR2=5,JEGPF4=6,
        +          JEGPDM=7,JEGPST=8,JEGPQU=9,JEGPPE=10,LEGPCA=10)
   
   
    eidtjj
         INTEGER JEIDIF,JEIDR1,JEIDR2,JEIDR3,JEIDR4,JEIDR5,JEIDR6,JEIDR7,
        +          JEIDEC,JEIDIP,JEIDE1,JEIDE2,JEIDE3,JEIDFR,JEIDPE,LEIDTA
         PARAMETER(JEIDIF=1,JEIDR1=2,JEIDR2=3,JEIDR3=4,JEIDR4=5,JEIDR5=6,
        +          JEIDR6=7,JEIDR7=8,JEIDEC=9,JEIDIP=10,JEIDE1=11,
        +          JEIDE2=12,JEIDE3=13,JEIDFR=14,JEIDPE=15,LEIDTA=15)
   
   
    frftjj
         INTEGER JFRFIR,JFRFTL,JFRFP0,JFRFD0,JFRFZ0,JFRFAL,JFRFEM,JFRFC2,
        +          JFRFDF,JFRFNO,LFRFTA
         PARAMETER(JFRFIR=1,JFRFTL=2,JFRFP0=3,JFRFD0=4,JFRFZ0=5,JFRFAL=6,
        +          JFRFEM=7,JFRFC2=28,JFRFDF=29,JFRFNO=30,LFRFTA=30)
   
   
    fridjj
         INTEGER JFRIBP,JFRIDZ,JFRIBC,JFRIDC,JFRIPE,JFRIPM,JFRIPI,JFRIPK,
        +          JFRIPP,JFRINK,JFRIQF,LFRIDA
         PARAMETER(JFRIBP=1,JFRIDZ=2,JFRIBC=3,JFRIDC=4,JFRIPE=5,JFRIPM=6,
        +          JFRIPI=7,JFRIPK=8,JFRIPP=9,JFRINK=10,JFRIQF=11,
        +          LFRIDA=11)
   
   
    frtljj
         INTEGER JFRTIV,JFRTNV,JFRTII,JFRTNI,JFRTNE,JFRTIT,JFRTNT,JFRTNR,
        +          LFRTLA
         PARAMETER(JFRTIV=1,JFRTNV=2,JFRTII=3,JFRTNI=4,JFRTNE=5,JFRTIT=6,
        +          JFRTNT=7,JFRTNR=8,LFRTLA=8)
   
   
    hmadjj
         INTEGER JHMANF,JHMANE,JHMANL,JHMAMH,JHMAIG,JHMAED,JHMACS,JHMAND,
        +          JHMAIE,JHMAIT,JHMAIF,JHMATN,LHMADA
         PARAMETER(JHMANF=1,JHMANE=2,JHMANL=3,JHMAMH=4,JHMAIG=5,JHMAED=6,
        +          JHMACS=7,JHMAND=8,JHMAIE=9,JHMAIT=10,JHMAIF=11,
        +          JHMATN=12,LHMADA=12)
   
   
    mcadjj
         INTEGER JMCANH,JMCADH,JMCADC,JMCAAM,JMCAAC,JMCATN,LMCADA
         PARAMETER(JMCANH=1,JMCADH=3,JMCADC=5,JMCAAM=7,JMCAAC=8,JMCATN=9,
        +          LMCADA=9)
   
   
    muidjj
         INTEGER JMUIIF,JMUISR,JMUIDM,JMUIST,JMUITN,LMUIDA
         PARAMETER(JMUIIF=1,JMUISR=2,JMUIDM=3,JMUIST=4,JMUITN=5,LMUIDA=5)
   
   
    pcqajj
         INTEGER JPCQNA,JPCQPX,JPCQPY,JPCQPZ,JPCQEN,LPCQAA
         PARAMETER(JPCQNA=1,JPCQPX=2,JPCQPY=3,JPCQPZ=4,JPCQEN=5,LPCQAA=5)
   
   
    pdltjj
         INTEGER JPDLPA,JPDLJT,JPDLPI,JPDLPE,JPDLVP,JPDLFR,LPDLTA
         PARAMETER(JPDLPA=1,JPDLJT=2,JPDLPI=3,JPDLPE=4,JPDLVP=5,JPDLFR=6,
        +          LPDLTA=6)
   
   
    pecojj
         INTEGER JPECER,JPECE1,JPECE2,JPECTH,JPECPH,JPECEC,JPECKD,JPECCC,
        +          JPECRB,JPECPC,LPECOA
         PARAMETER(JPECER=1,JPECE1=2,JPECE2=3,JPECTH=4,JPECPH=5,JPECEC=6,
        +          JPECKD=7,JPECCC=8,JPECRB=9,JPECPC=10,LPECOA=10)
   
   
    peptjj
         INTEGER JPEPT1,JPEPP1,JPEPT3,JPEPP3,LPEPTA
         PARAMETER(JPEPT1=1,JPEPP1=2,JPEPT3=3,JPEPP3=4,LPEPTA=4)
   
   
    pgacjj
         INTEGER JPGAEC,JPGATC,JPGAPC,JPGAR1,JPGAR2,JPGAF4,JPGADM,JPGAST,
        +          JPGAQU,JPGAQ1,JPGAQ2,JPGAM1,JPGAM2,JPGAMA,JPGAER,JPGATR,
        +          JPGAPR,JPGAEF,JPGAGC,JPGAZS,JPGAPL,JPGAPH,JPGAPN,JPGAFA,
        +          JPGAPE,LPGACA
         PARAMETER(JPGAEC=1,JPGATC=2,JPGAPC=3,JPGAR1=4,JPGAR2=5,JPGAF4=6,
        +          JPGADM=7,JPGAST=8,JPGAQU=9,JPGAQ1=10,JPGAQ2=11,
        +          JPGAM1=12,JPGAM2=13,JPGAMA=14,JPGAER=15,JPGATR=16,
        +          JPGAPR=17,JPGAEF=18,JPGAGC=19,JPGAZS=20,JPGAPL=21,
        +          JPGAPH=22,JPGAPN=23,JPGAFA=24,JPGAPE=25,LPGACA=25)
   
   
    pgpcjj
         INTEGER JPGPEC,JPGPTC,JPGPPC,JPGPR1,JPGPR2,JPGPF4,JPGPDM,JPGPST,
        +          JPGPQU,JPGPQ1,JPGPQ2,JPGPM1,JPGPM2,JPGPMA,JPGPER,JPGPTR,
        +          JPGPPR,JPGPPE,LPGPCA
         PARAMETER(JPGPEC=1,JPGPTC=2,JPGPPC=3,JPGPR1=4,JPGPR2=5,JPGPF4=6,
        +          JPGPDM=7,JPGPST=8,JPGPQU=9,JPGPQ1=10,JPGPQ2=11,
        +          JPGPM1=12,JPGPM2=13,JPGPMA=14,JPGPER=15,JPGPTR=16,
        +          JPGPPR=17,JPGPPE=18,LPGPCA=18)
   
   
    phcojj
         INTEGER JPHCER,JPHCTH,JPHCPH,JPHCEC,JPHCKD,JPHCCC,JPHCRB,JPHCNF,
        +          JPHCPC,LPHCOA
         PARAMETER(JPHCER=1,JPHCTH=2,JPHCPH=3,JPHCEC=4,JPHCKD=5,JPHCCC=6,
        +          JPHCRB=7,JPHCNF=8,JPHCPC=9,LPHCOA=9)
   
   
    pmltjj
         INTEGER JPMLFL,JPMLPO,JPMLCH,JPMLSP,JPMLLE,JPMLME,JPMLKT,JPMLFR,
        +          LPMLTA
         PARAMETER(JPMLFL=1,JPMLPO=2,JPMLCH=3,JPMLSP=4,JPMLLE=5,JPMLME=6,
        +          JPMLKT=7,JPMLFR=8,LPMLTA=8)
   
   
    texsjj
         INTEGER JTEXSI,JTEXTM,JTEXTL,JTEXNS,JTEXAD,JTEXTN,JTEXSF,LTEXSA
         PARAMETER(JTEXSI=1,JTEXTM=2,JTEXTL=3,JTEXNS=4,JTEXAD=5,JTEXTN=6,
        +          JTEXSF=7,LTEXSA=7)
   
   
    yv0vjj
         INTEGER JYV0K1,JYV0K2,JYV0VX,JYV0VY,JYV0VZ,JYV0VM,JYV0PX,JYV0PY,
        +          JYV0PZ,JYV0PM,JYV0X1,JYV0X2,JYV0XM,JYV0C2,JYV0IC,JYV0P1,
        +          JYV0P2,JYV0EP,JYV0DM,JYV0S1,JYV0S2,LYV0VA
         PARAMETER(JYV0K1=1,JYV0K2=2,JYV0VX=3,JYV0VY=4,JYV0VZ=5,JYV0VM=6,
        +          JYV0PX=12,JYV0PY=13,JYV0PZ=14,JYV0PM=15,JYV0X1=21,
        +          JYV0X2=22,JYV0XM=23,JYV0C2=26,JYV0IC=27,JYV0P1=28,
        +          JYV0P2=31,JYV0EP=34,JYV0DM=55,JYV0S1=56,JYV0S2=57,
        +          LYV0VA=57)
   
   
   
    evehjj
         INTEGER JEVEEN,JEVERN,JEVERT,JEVEDA,JEVETI,JEVEEV,JEVEM1,JEVEM2,
        +          JEVEM3,JEVEM4,JEVETY,JEVEES,JEVETE,LEVEHA
         PARAMETER(JEVEEN=1,JEVERN=2,JEVERT=3,JEVEDA=4,JEVETI=5,JEVEEV=6,
        +          JEVEM1=7,JEVEM2=8,JEVEM3=9,JEVEM4=10,JEVETY=11,
        +          JEVEES=12,JEVETE=13,LEVEHA=13)
   
   
         parameter ( nrumx = 5000 )
         character*12 filrlis
         common / kinruev / nrukin,lrukin(nrumx),litrmi(nrumx),
        +                   ifailmx,litrmx(nrumx)
         common / ckinruv / filrlis(nrumx)
   
   
         CHARACTER*16 TAPPAR
         PARAMETER (TAPPAR='TAPECARTSMCF8MM ')
         PARAMETER (MINPUT=1,MOUTPT=4)
         COMMON /ALRCOM/ DIRECT
        &               ,NRFILI(MINPUT),IRFILI,IFTHRU
        &               ,NRFILO(MOUTPT),IRFILO,IFWITH
        &               ,NRFILM,IRFILM
         LOGICAL DIRECT
         COMMON /ALRCHA/ NAFILI(MINPUT),NAFILO(MOUTPT)
        &               ,DKMODR(4),DKMODW(5),GMODEN
         CHARACTER*1 DKMODR,DKMODW
         CHARACTER*4 NAFILI, NAFILO
         CHARACTER*10 GMODEN
   
         DIRECT          is TRUE if current input file openned in direct
                         access
                         after closure
         NRFILI          bank number of FILI card
         IRFILI          Return code from ACDARG for FILI
         IFTHRU          .NE.0 if THRU parameter present on FILI card
         NRFILO          bank number of FILO/POT/DST/MDST  card
         IRFILO          return code from ACDARG for FILO/POT/DST/...
         IFWITH          .NE.0 if WITH parameter present on FILO/POT/...card
         NRFILM          bank number of FILM card
         IRFILM          return code from ACDARG for FILM
         DKMODR          filemode buffer in read access
         DKMODW          filemode buffer in write access
         NAFILI          name of FILI card
         NAFILO          name of FILO/POT/DST/MDST card
         GMODEN          filemode for Edir files with options "THRU" and "WITH"
   
   
         character filic*12,filio*12,cartf*80,tape*6,filex*5
         data filio / '????????????' /
         data ipass,irunol / 0 , 0 /
    call : initialize common;
         if (ipass.eq.0) then
            ipass=1
            nrukin=0
            ifailmx=0
            filic=' '
            call vzero(lrukin,nrumx)
            do i=1,nrumx
               litrmi(i)=999999999
               litrmx(i)=-1
               filrlis(i)=' '
            enddo
         endif
    execute for real data :
         if (krun.gt.2000) go to 999
    processing:
    cartridge read ?:
         jfili=nlink('FILI',NRFILI)
         if (jfili.le.0) go to 999
         ndafi=iw(jfili)
         if (ndafi.le.0) go to 999
         call alstin(iw(jfili+1),ndafi,cartf)
         call qanfili(cartf,tape,filex)
         ltap=lnblnk(tape)
         lfil=lnblnk(filex)
         if (ltap.eq.0.or.lfil.eq.0) go to 999
         filic=tape(1:ltap)
         if (filic.ne.filio) then
            nrukin=nrukin+1
            if (nrukin.gt.nrumx) then
               ifailmx=1
               nrukin=nrumx
               go to 999
            endif
            irunol=krun
            lrukin(nrukin)=krun
            filrlis(nrukin)=filic
            filio=filic
         endif
    #:
         jeveh=iw(namind('EVEH'))
         if (jeveh.le.0) go to 999
         itrig=iw(jeveh+jeveev)
         litrmi(nrukin)=min0(litrmi(nrukin),itrig)
         litrmx(nrukin)=max0(litrmx(nrukin),itrig)
    999  return
         END
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   QFILL                                                                           
   QRKSEC                                                                          
        |---- QFKIREV                                                              
                   |----  VZERO                               External             
                   |----  NLINK                               External             
                   |----  IW                                  External             
                   |----  ALSTIN                              External             
                   |----  QANFILI                                                  
                   |----  LNBLNK                              External             
                   |----  NAMIND                              External             
                   |----  MIN0                                External             
                   |----  MAX0                                External             
   
 
3 QFLEPT
         SUBROUTINE QFLEPT
  ------------------------------------------------------------------------------
    CKEY FILL LEPTONS /INTERNAL
  ------------------------------------------------------------------------------
   Fill lepton tags from pdlt/pmlt banks
   
      Author   :- J. Boucrot     10-Nov-1994
   
     Called from QFILL or from QLEVNT
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   QFILL                                                                           
   QLEVNT                                                                          
        |---- QFLEPT                                                               
                   |----  SIGN                                External             
                   |----  SQRT                                External             
                   |----  ABS                                 External             
                   |----  NINT                                External             
                   |----  KMATIX                              External             
                   |----  ATG                                 External             
                   |----  KCLARM                              External             
                   |----  IAND                                External             
                   |----  KLOCK0                              External             
                   |----  IABS                                External             
                   |----  NAMIND                              External             
                   |----  QFLJET                                                   
                   |----  QEDIRUPD                                                 
   
 
3 QFLJET
         SUBROUTINE QFLJET
  ------------------------------------------------------------------------------
    CKEY FILL JETS LEPTONS /INTERNAL
  ------------------------------------------------------------------------------
   Fill ljet section from pljt bank ( jets built by qselep )
   
      Author   :- J. Boucrot     10-Nov-1994
        KLFJET = first jet
        KLLJET = last jet
        KLNJET = number of jets
        Objects from PLJT stored as 'LJET'
   
     Called from QFLEPT
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   QFLEPT                                                                          
        |---- QFLJET                                                               
                   |----  SIGN                                External             
                   |----  SQRT                                External             
                   |----  ABS                                 External             
                   |----  NINT                                External             
                   |----  KMATIX                              External             
                   |----  ATG                                 External             
                   |----  KCLARM                              External             
                   |----  IAND                                External             
                   |----  KLOCK0                              External             
                   |----  IABS                                External             
                   |----  KPCOMP                                                   
                   |----  KFPADR                                                   
                   |----  NAMIND                              External             
                   |----  QSBANK                                                   
   
 
3 QFMCBM
         SUBROUTINE QFMCBM
  ------------------------------------------------------------------------------
    CKEY FILL MASKS MC /INTERNAL
  ------------------------------------------------------------------------------
   Fill bit masks
    from QFILMC
                                                      H.Albrecht 27.11.88
                                   Modified           E.Blucher  02.02.93
                                   Add ENTRY QSMCTM   D.Casper   09.01.97
                                   to set single particles (QUFSIM)
                     protection added for mothers     S.Thompson 24.02.99
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   QFILMC                                                                          
        |---- QFMCBM                                                               
                   |----  IW                                  External             
                   |----  IOR                                 External             
                   |----  QWMESS                                                   
   
 
3 QFMCMD
         SUBROUTINE QFMCMD
  ------------------------------------------------------------------------------
    CKEY FILL MC /INTERNAL
  ------------------------------------------------------------------------------
   Fill mother - daughter relation for mc particles
                                                     H.Albrecht 18.10.88
    from QFILL
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   QFILMC                                                                          
        |---- QFMCMD                                                               
                   |----  QSBANK                                                   
   
 
3 QFMCPA
         SUBROUTINE QFMCPA
  ------------------------------------------------------------------------------
    CKEY FILL MC /INTERNAL
  ------------------------------------------------------------------------------
   Fill mc particles
                                                     H.Albrecht 18.10.88
                                           Modified: E.Lancon   12.07.89
                                           Modified: J.Boucrot  26.08.97
                                           Modified: J.Boucrot  16.10.00
    from QFILMC
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   QFILMC                                                                          
        |---- QFMCPA                                                               
                   |----  QSBANK                                                   
                   |----  VMOD                                External             
                   |----  ABS                                 External             
                   |----  MOD                                 External             
                   |----  KMCCOD                                                   
                   |----  KFPADR                                                   
                   |----  TNRHPA                              External             
   
 
3 QFMCST
         SUBROUTINE QFMCST
  ------------------------------------------------------------------------------
    CKEY FILL MC /INTERNAL
  ------------------------------------------------------------------------------
   Fill stability code for mc particles
                                                     H.Albrecht 18.10.88
    from QFILMC
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   QFILMC                                                                          
        |---- QFMCST                                                               
                   |----  ABS                                 External             
                   |----  QWMESE                                                   
   
 
3 QFMCVX
         SUBROUTINE QFMCVX
  ------------------------------------------------------------------------------
    CKEY FILL MC VERTEX/INTERNAL
  ------------------------------------------------------------------------------
   Fill mc vertices
                                                     H.Albrecht 18.10.88
    from QFILMC
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   QFILMC                                                                          
        |---- QFMCVX                                                               
                   |----  QSBANK                                                   
   
 
3 QFMTCH
   
  ------------------------------------------------------------------------------
    CKEY FILL MC MATCH/INTERNAL
  ------------------------------------------------------------------------------
         SUBROUTINE QFMTCH
     Author   : D. CINABRO, H. ALBRECHT   5-OCT-1988
     Description
     ===========
   Fill match infomation into qvec
   05/05/88 Rewritten 14/10/88 to add ITC Altered 26/04/89 to use
   A and IASL
    the TGMA,TMTL,IPJT, and IRJT; or the ITMA and IASL banks to relat
    track to FKIN tracks.
   A and IPJT1 are parallel with the first tracks in FRFT.  First use
   A and TMTL to get the MC track number and the number of associated
    in the TPC.  Then use IPJT1 and IRJT1 to add extra hits and possi
    from the ITC.  Store the hits and tracks in IHIT and IPART.  No
    FPOI is necessary as IPJT points to KINE tracks, so the tranlatio
    FKIN is done via FPOI.  Store in QVEC and point in QMTL/QMTS.  For
   2 it is the same but simpler as extra tracks from another detector
    not have to be considered.
    use of ITMA and IASL is exactly as ITJT2 as the information from
    ITC and TPC are combined in these banks.  FPOI is not necessary
    this case as the banks point to FKIN.  These banks are used
    and the others are used if ITMA and IASL are not
   
    more than 20 MC tracks are associated to one MC particle then
    will be an overflow.  An error message is printed and we go
    the next track.
    Called from QFILMC
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   QFILMC                                                                          
        |---- QFMTCH                                                               
                   |----  NLINK                               External             
                   |----  QWMESE                                                   
                   |----  IABS                                External             
                   |----  QSBANK                                                   
   
 
3 QFNDIN
         SUBROUTINE QFNDIN(EVECE,PLAN,IERR)
  ------------------------------------------------------------------------------
    CKEY  FILL / INTERNAL
  ------------------------------------------------------------------------------
   Find intersection between a line and a plane
    Called from QEXTRA
        Authors : M.N. Minard                 11/11/93
    : EVECE(6)       = x,y,z,u,v,w (point coordinates and
                            direction cosines)
           PLAN (4)       = coefficients of plane equation
    EVECE(3)       = x,y,z of intersection point
           IERR           = 1 no solution
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   QEXTRA                                                                          
        |---- QFNDIN                                                               
                   |----  ABS                                 External             
   
 
3 QFNEOB
         SUBROUTINE QFNEOB
  ------------------------------------------------------------------------------
    CKEY FILL PCPA EFLOW /INTERNAL
  ------------------------------------------------------------------------------
   Fill neob section from pcqa bank.
   
      Author   :- E. Blucher     29-NOV-1990
    Modified   :- J. Carr        10-May-1991
    Modified   :- E. Blucher     02-Feb-1992
        kfnet = first neutral track
        klnet = last neutral track
        knnet = number of neutral tracks
        Objects from PCQA stored as 'NEOB'
    Called from QFILL
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   QFILL                                                                           
        |---- QFNEOB                                                               
                   |----  SIGN                                External             
                   |----  SQRT                                External             
                   |----  ABS                                 External             
                   |----  NINT                                External             
                   |----  KMATIX                              External             
                   |----  ATG                                 External             
                   |----  KCLARM                              External             
                   |----  IAND                                External             
                   |----  KLOCK0                              External             
                   |----  IABS                                External             
                   |----  KPCOMP                                                   
                   |----  KFPADR                                                   
                   |----  QSBANK                                                   
                   |----  QSBITM                                                   
   
 
3 QFNINT
         SUBROUTINE QFNINT
  ------------------------------------------------------------------------------
    CKEY FILL VERTEX   /INTERNAL
  ------------------------------------------------------------------------------
   Fill parameters of nuclear interaction vertices from new tracking
     - banks YNLI and YNVH.
   
      Author   :- J. Boucrot                    21-Apr-1997
   
      Calls QFYNVH,QVNSTO
      Output :
           - new vertex in QVRT is created.
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   QFILNV                                                                          
        |---- QFNINT                                                               
                   |----  SIGN                                External             
                   |----  SQRT                                External             
                   |----  ABS                                 External             
                   |----  NINT                                External             
                   |----  KMATIX                              External             
                   |----  ATG                                 External             
                   |----  KCLARM                              External             
                   |----  IAND                                External             
                   |----  KLOCK0                              External             
                   |----  IABS                                External             
                   |----  NAMIND                              External             
                   |----  VZERO                               External             
                   |----  QFYNVH                                                   
                   |----  QNVSTO                                                   
   
 
3 QFPMSC
         SUBROUTINE QFPMSC
  ------------------------------------------------------------------------------
    CKEY FILL CHARGED / INTERNAL
  ------------------------------------------------------------------------------
   Fill word for mult.scatt in frft from mini bank 'pmsc'
                                                      J.Boucrot 28.10.94
    Called from QFCHGD
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
              QFPMSC                                                               
                   |----  QWMESE                                                   
   
 
3 QFPTPX
         SUBROUTINE QFPTPX
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   - Author: J. Boucrot   981207
   Rebuild the ptpx bank for pad de/dx if necessary
       Called from QFILL, not executed if data card NOPX is present
   -    Runs on POTs or DSTs only (needs full TPC coordinates)
   
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   QFILL                                                                           
        |---- QFPTPX                                                               
                   |----  SIGN                                External             
                   |----  SQRT                                External             
                   |----  ABS                                 External             
                   |----  NINT                                External             
                   |----  KMATIX                              External             
                   |----  ATG                                 External             
                   |----  KCLARM                              External             
                   |----  IAND                                External             
                   |----  KLOCK0                              External             
                   |----  IABS                                External             
                   |----  NAMIND                              External             
                   |----  MINDTYP                                                  
                   |----  CHAINT                              External             
                   |----  CLTOU                               External             
                   |----  INDEX                               External             
                   |----  QWMESS                                                   
                   |----  QWMESE                                                   
                   |----  QGTPDDX                                                  
                   |----  QDOTPXS                                                  
                   |----  QWRPTPX                                                  
   
 
3 QFREFIT
         SUBROUTINE QFREFIT
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Refit tracks and overwrite the old fit results
    Author  :  R. Johnson   6-10-89
    Modified:  W. Wiedenmann 6-4-92
    Modified:  W. Wiedenmann 5-2-93
    Modified:  W. Wiedenmann 17-6-93
    Banks needed:  coordinate banks TPCO, ITCO (and ICCO), and VDCO
                   are needed (for the detectors which you fit).
                   These generally are not present on the POT but
                   must be filled by unpacking routines which
                   access the POT banks and do what calculations
                   are necessary to fill the coordinate banks.
                   For TPC and ITC coordinates, you must add the
                   options TP and IT to the UNPK data card.  See
                   the ALPHA manual for more information on this
                   card.  In addition, the track bank FRFT and the
                   pointer banks FRTL, FTCL, FICL, FVCL are needed,
                   which requires the FT option (present by default)
                   in the UNPK card.
    NOTE:   if anything goes wrong in the fit, such as a non-positive-
            definite error matrix, then the old fit is retained and
            NFIT is not incremented.
    .NOT.1
         Integer Ufttra
   
    itcojj
         INTEGER JITCWN,JITCRA,JITCP1,JITCP2,JITCZH,JITCSR,JITCSZ,JITCDT,
        +          LITCOA
         PARAMETER(JITCWN=1,JITCRA=2,JITCP1=3,JITCP2=4,JITCZH=5,JITCSR=6,
        +          JITCSZ=7,JITCDT=8,LITCOA=8)
   
   
    vdcojj
         INTEGER JVDCWI,JVDCR0,JVDCPH,JVDCZ0,JVDCSR,JVDCSZ,JVDCQF,JVDCTN,
        +          LVDCOA
         PARAMETER(JVDCWI=1,JVDCR0=2,JVDCPH=3,JVDCZ0=4,JVDCSR=5,JVDCSZ=6,
        +          JVDCQF=7,JVDCTN=8,LVDCOA=8)
   
   
    tpcojj
         INTEGER JTPCIN,JTPCRV,JTPCPH,JTPCZV,JTPCSR,JTPCSZ,JTPCOF,JTPCTN,
        +          JTPCCN,JTPCIT,JTPCRR,JTPCRZ,LTPCOA
         PARAMETER(JTPCIN=1,JTPCRV=2,JTPCPH=3,JTPCZV=4,JTPCSR=5,JTPCSZ=6,
        +          JTPCOF=7,JTPCTN=8,JTPCCN=9,JTPCIT=10,JTPCRR=11,
        +          JTPCRZ=12,LTPCOA=12)
   
   
   -------------------- /QCDE/ --- COMMONs, DIMENSIONs, etc. ------------
   
    of QCDESH ----------------------- Description in QDATA ---------
         PARAMETER (KCQDET=34, KCQFPA=8, KCQPAR=10, KCQVEC=73, KCQVRT=30,
        & KHE=1, KHMU=2, KHPI=3, KHK=4, KHP=5, KHPHOT=1, KHNHAD=2,
        & KMONTE=-2, KRECO=-1, KLOCKM=14, KSOVT=1, KSCHT=2, KSIST=3,
        & KSAST=4, KSEHT=5, KSV0T=6, KSDCT=7, KSEFT=8, KSNET=9, KSGAT=10,
        & KSJET=11, KSMCT=12, KSREV=13,
        & KSMCV=14, KUNDEF=-12344321, QQPI=3.141593, QQE=2.718282,
        & QQ2PI=QQPI*2., QQPIH=QQPI/2., QQRADP=180./QQPI, QQC=2.997925E10,
        & QQH=6.582173E-25, QQHC=QQH*QQC, QQIRP=.00029979)
         CHARACTER CQDATE*8, CQDWRK*80, CQFHIS*80, CQFOUT*80, CQFWRK*80,
        & CQHTIT*80, CQSEC*3, CQTIME*8, CQUNPK*30, CQVERS*6, CQRLST*800,
        & CQELST*800
         COMMON /QCDEC/ CQDATE, CQDWRK, CQFHIS, CQFOUT, CQFWRK, CQHTIT,
        & CQSEC(14), CQTIME, CQUNPK, CQVERS, CQRLST, CQELST
         COMMON /QCDE/ QELEP, QMFLD ,QMFLDC, QTIME, QTIMEI, QTIMEL,
        & QTIMES, QTIMET, QDHEEC, QDHEEL, QDHEPF, QDHETH, QDHEPH, QDHEEF,
        & QDHEET, QDHET1, QDHEP1, QDHET2, QDHEP2, QDHEE1, QDHEE2, QDHEE3,
        & QKEVRN, QKEVWT, QVXNOM, QVYNOM, QVZNOM, QVXNSG, QVYNSG, QVZNSG,
        & QINLUM, QRINLN, QRINLU, QDBOFS, QEECWI(36), QVXBOM, QVYBOM,
        & QSILUM, QRSLLU, QRSLBK, QRSLEW , QVTXBP(3), QVTEBP(3), QVTSBP(3)
         COMMON /QCDE/  KFOVT, KLOVT, KNOVT, KFCHT, KLCHT, KNCHT, KFIST,
        & KLIST, KNIST, KFAST, KLAST, KNAST, KFEHT, KLEHT, KNEHT, KFV0T,
        & KLV0T, KNV0T, KFDCT, KLDCT, KNDCT, KFEFT, KLEFT, KNEFT, KFNET,
        & KLNET, KNNET, KFGAT, KLGAT, KNGAT, KFJET, KLJET, KNJET, KFMCT,
        & KLMCT, KNMCT, KFREV, KLREV, KNREV, KFMCV, KLMCV, KNMCV, KLUST,
        & KLUSV, KFFRT, KLFRT, KFFRV, KLFRV, KNRET, KNCOT, KFFRD,
        & KLFJET,KLLJET,KLNJET
         COMMON /QCDE/ KBIT(32), KCLACO(KCQFPA), KCLAFR(KCQFPA), KCLARM
        & (KCQFPA), KDEBUG, KEVT, KEXP, KFFILL, KFEOUT, KJOPTN(2,2),
        & KLEOUT, KLROUT, KLOCK0(KLOCKM,2), KLOCK1(KLOCKM,2), KLOCK2(
        & KLOCKM,2), KMATIX(6,6), KMQFPA, KNEFIL, KNEOUT, KNEVT, KNPAST,
        & KNQDET, KNQFPA, KNQLIN, KNQMTX, KNQPAR, KNQPST, KNREIN, KNREOU,
        & KOQDET, KOQFPA, KOQLIN, KOQMTL, KOQMTS, KOQPAR, KOQPBT, KOQPLI,
        & KOQTRA, KOQVEC, KOQVRT, KQPAR, KQVEC, KQVRT, KQWRK, KQZER, KRUN,
        & KSTATU, KTDROP, KUCARD, KUCONS, KUHIST, KUINPU, KUOUTP, KUPRNT,
        & KUPTER, KDEBU1, KDEBU2, KNWRLM, KEFOPT, KUEDIN, KUEDOU, KURTOX,
        & KUCAR2, KNHDRN, KNBHAB, KSBHAB, KRSLLQ, KRSLNB
         COMMON /QCDE/ INDATA
         COMMON /QCDE/ KRINNE, KRINNF, KRINDC, KRINDQ, KRINNZ, KRINNB,
        & KRINBM, KRINFR, KRINLR, KRINLF
         COMMON /QCDE/ KEVERT, KEVEDA, KEVETI, KEVEMI(4), KEVETY, KEVEES,
        & KDHEFP, KDHENP, KDHENM, KKEVNT, KKEVNV, KKEVID, KDHENX, KDHENV,
        & KDHENJ, KREVDS, KXTET1, KXTET2, KXTEL2, KXTCGC, KXTCLL, KXTCBN,
        & KXTCCL, KXTCHV, KXTCEN, KCLASW, KERBOM, KBPSTA
         DIMENSION KLOCUS(3,14)
         EQUIVALENCE (KLOCUS(1,1),KFOVT), (KFOVT,KFRET), (KLIST,KLRET),
        & (KFIST,KFCOT), (KLAST,KLCOT)
         COMMON /QCDE/ XCOPYJ, XFLIAC, XHISTO, XLREV(2), XLREV2(2), XMCEV,
        & XMINI, XSYNTX, XWREVT, XWRRUN, XFILMC, XFILCH, XFILV0, XFILCO,
        & XFILEF, XFILPC, XFILGA, XFILJE,
        & XPRHIS, XFILL, XVITC, XVTPC, XVECAL, XVLCAL, XVTPCD,
        & XVSATR, XVHCAL, XHVTRG, XSREC, XWMINI, XIOKLU, XIOKSI, XFRF2,
        & XNSEQ, XVDOK, XFRF0, XFMUID, XFILEM, XWNANO, XROKSI, XGETBP,
        & XJTHRU
         LOGICAL XCOPYJ, XFLIAC, XHISTO, XLREV, XLREV2, XMCEV, XMINI,
        & XSYNTX, XWREVT, XWRRUN, XFILMC, XFILCH, XFILV0, XFILCO, XFILEF,
        & XFILPC, XPRHIS, XFILL, XVITC, XVTPC, XVECAL, XVLCAL, XVTPCD,
        & XVSATR, XVHCAL, XHVTRG, XSREC, XWMINI, XIOKLU, XFRF2, XFILJE,
        & XNSEQ, XFILGA, XVDOK, XFRF0, XFMUID, XFILEM, XWNANO, XIOKSI,
        & XROKSI, XGETBP, XJTHRU
   
   -------------------- /NANCOM/ --- NanoDst steering -------------------
    XNANO   .TRUE. if input is a NanoDst (in NANO or EPIO format, depending
                      XNANOR)
   
         LOGICAL XNANO
         COMMON /NANCOM/XNANO
   
   
    bcs
         INTEGER LMHLEN, LMHCOL, LMHROW
         PARAMETER (LMHLEN=2, LMHCOL=1, LMHROW=2)
         COMMON /BCS/   IW(1000)
         INTEGER IW
         REAL RW(1000)
         EQUIVALENCE (RW(1),IW(1))
   
   
   ------------------ /QCNAMI/ --- name indices -------------------------
         COMMON /QCNAMI/ NAAFID,NAAJOB,NAASEV,NABCNT,NABHIT,NABOMB,
        1 NABOME,NABOMP,NABOMR,NABPTR,NADCAL,NADCRL,NADECO,NADEID,NADENF,
        2 NADEVT,NADEWI,NADFMC,NADFOT,NADGAM,NADHCO,NADHEA,NADHRL,NADJET,
        3 NADMID,NADMJT,NADMUO,NADNEU,NADPOB,NADRES,NADTBP,NADTMC,NADTRA,
        4 NADVER,NADVMC,NAECRQ,NAECTE,NAEGID,NAEGPC,NAEIDT,NAEJET,NAERRF,
        5 NAETDI,NAETKC,NAEVEH,NAEWHE,NAFICL,NAFKIN,NAFPOI,NAFPOL,NAFRFT,
        6 NAFRID,NAFRTL,NAFSTR,NAFTCL,NAFTCM,NAFTOC,NAFTTM,NAFVCL,NAFVER,
        7 NAFZFR,NAHCCV,NAHCTE,NAHINF,NAHMAD,NAHPDI,NAHROA,NAHSDA,NAHTUB,
        8 NAIASL,NAIPJT,NAIRJT,NAITCO,NAITMA,NAIXTR,NAIZBD,NAJBER,NAJEST,
        9 NAJSUM,NAKEVH,NAKINE,NAKJOB,NAKLIN,NAKPOL,NAKRUN,NALIDT,NALOLE,
        A NALUPA,NAMCAD,NAMHIT,NAMTHR,NAMUDG,NAMUEX,NAOSTS,NAPART,NAPASL,
        B NAPCHY,NAPCOB,NAPCOI,NAPCPA,NAPCQA,NAPCRL,NAPECO,NAPEHY,NAPEID,
        C NAPEMH,NAPEPT,NAPEST,NAPEWI,NAPFER,NAPFHR,NAPFRF,NAPFRT,NAPHCO,
        D NAPHER,NAPHHY,NAPHMH,NAPHST,NAPIDI,NAPITM,NAPLID,NAPLPD,NAPLSD,
        E NAPMSK,NAPNEU,NAPPDS,NAPPOB,NAPPRL,NAPRTM,NAPSCO,NAPSPO,NAPSTR,
        F NAPT2X,NAPTBC,NAPTCO,NAPTEX,NAPTMA,NAPTML,NAPTNC,NAPTST,NAPVCO,
        G NAPYER,NAPYFR,NAPYNE,NAQDET,NAQFPA,NAQLIN,NAQMTL,NAQMTS,NAQPAR,
        H NAQPBT,NAQPLI,NAQTRA,NAQVEC,NAQVRT,NAQWRK,NAQZER,NAREVH,NARHAH,
        I NARTLO,NARTLS,NARUNH,NARUNR,NASFTR,NATEXS,NATGMA,NATMTL,NATPCO,
        J NAVCOM,NAVCPL,NAVDCO,NAVDHT,NAVDXY,NAVDZT,NAVERT,NAVFHL,NAVFLG,
        K NAVFPH,NAVHLS,NAVPLH,NAX1AD,NAX1SC,NAX1TI,NAX2DF,NAX3EC,NAX3EW,
        L NAX3HC,NAX3IT,NAX3L2,NAX3LU,NAX3TM,NAX3TO,NAX3TP,NAX3X3,NAXTBN,
        M NAXTBP,NAXTCN,NAXTEB,NAXTOP,NAXTRB,NAYV0V,NAZPFR,NAEFOL,NAMUID,
        N NAPGID,NAPGPC,NAPGAC,NAPMSC,NAPTHR,NANBIP,NAPDLT,NAPMLT,NAPLJT
   
   
   ------------------ /QQQQJJ/ --- HAC parameters for ALPHA banks -------
         PARAMETER (JQVEQX= 1,JQVEQY= 2,JQVEQZ= 3,JQVEQE= 4,JQVEQM= 5,
        & JQVEQP= 6,JQVECH= 7,JQVETN= 8,JQVESC= 9,JQVEKS=10,JQVECL=11,
        & JQVEPA=12,JQVEQD=13,JQVENP=14,JQVESP=15,JQVEOV=16,JQVEEV=17,
        & JQVEND=18,JQVEDL=19,JQVENO=20,JQVEOL=21,JQVENM=22,JQVEML=23,
        & JQVEBM=24,JQVELK=38,JQVEDB=39,JQVEZB=40,JQVESD=41,JQVESZ=42,
        & JQVECB=43,JQVEEM=44,JQVECF=54,JQVEEW=55,JQVEUS=56)
         PARAMETER ( JQVRVX=1,JQVRVY=2,JQVRVZ=3,JQVRVN=4,JQVRTY=5,
        1   JQVRIP=6,JQVRND=7,JQVRDL=8,JQVRAY=9,JQVRAF=10,JQVREM=11,
        2   JQVRCF=17,JQVRET=18)
         PARAMETER ( JQDEAF= 1,JQDEAL= 2,JQDENT= 3,JQDEAT= 4,JQDELT= 8,
        &  JQDEAE= 9,JQDEAH=10,JQDEAM=11,JQDECF=12,JQDEEC=13,JQDEHC=14,
        &  JQDEET=15,JQDEFI=16,JQDENF=17,JQDEFL=18,JQDENE=19,JQDEEL=20,
        &  JQDENH=21,JQDEHL=22,JQDELH=23,JQDEEF=24,JQDEPC=25,JQDEEG=26,
        &  JQDEMU=27,JQDEDX=28,JQDEPG=29,JQDEPD=30,JQDEPM=31)
         PARAMETER ( JQPAGN=1, JQPANA=2, JQPACO=5, JQPAMA=6, JQPACH=7,
        & JQPALT=8,JQPAWI=9,JQPAAN=10)
   
   
         EXTERNAL CQPART, CQTPN, XCEQAN, XLUMOK, XPEQAN, XPEQOR, XPEQU,
        & XVDEOK, LLUMOK, SLUMOK
         CHARACTER * 12 CQPART, CQTPN
         LOGICAL XCAL, XCEQAN, XCEQOR, XCEQU, XECAL, XEID, XFRF, XHCAL,
        & XHMA, XLOCK, XLOCKN, XMC, XLUMOK, XMCA, XPEO, XPHO, XPEQAN,
        & XPEQOR, XPEQU, XSAME, XSIG, XTEX, XPEC, XPEP, XPHC, XYV0,
        & XFRIQF, XEFO, XPCQ, XEGP, XMUI, XVDEOK, XPGP, LLUMOK, SLUMOK,
        & XPGAC, XLEPTG, XLEPTH
   
    alcons
    define universal constants
         REAL PI, TWOPI, PIBY2, PIBY3, PIBY4, PIBY6, PIBY8, PIBY12
         REAL RADEG, DEGRA
         REAL CLGHT, ALDEDX
         PARAMETER (PI=3.141592653589)
         PARAMETER (RADEG=180./PI, DEGRA=PI/180.)
         PARAMETER (TWOPI = 2.*PI , PIBY2 = PI/2., PIBY4 = PI/4.)
         PARAMETER (PIBY6 = PI/6. , PIBY8 = PI/8.)
         PARAMETER (PIBY12= PI/12., PIBY3 = PI/3.)
         PARAMETER (CLGHT = 29.9792458, ALDEDX = 0.000307)
   
         ALDEDX  = constant used in the computation of DEDX in GeV
         CLGHT   = speed of light in cm/nsec
   
   
   
    efoljj
         INTEGER JEFOPX,JEFOPY,JEFOPZ,JEFOEW,JEFOWE,JEFOTY,JEFOLE,JEFOLT,
        +          JEFOLH,JEFOLC,JEFOLJ,LEFOLA
         PARAMETER(JEFOPX=1,JEFOPY=2,JEFOPZ=3,JEFOEW=4,JEFOWE=5,JEFOTY=6,
        +          JEFOLE=7,JEFOLT=8,JEFOLH=9,JEFOLC=10,JEFOLJ=11,
        +          LEFOLA=11)
   
   
    egpcjj
         INTEGER JEGPPX,JEGPPY,JEGPPZ,JEGPR1,JEGPR2,JEGPF4,JEGPDM,JEGPST,
        +          JEGPQU,JEGPPE,LEGPCA
         PARAMETER(JEGPPX=1,JEGPPY=2,JEGPPZ=3,JEGPR1=4,JEGPR2=5,JEGPF4=6,
        +          JEGPDM=7,JEGPST=8,JEGPQU=9,JEGPPE=10,LEGPCA=10)
   
   
    eidtjj
         INTEGER JEIDIF,JEIDR1,JEIDR2,JEIDR3,JEIDR4,JEIDR5,JEIDR6,JEIDR7,
        +          JEIDEC,JEIDIP,JEIDE1,JEIDE2,JEIDE3,JEIDFR,JEIDPE,LEIDTA
         PARAMETER(JEIDIF=1,JEIDR1=2,JEIDR2=3,JEIDR3=4,JEIDR4=5,JEIDR5=6,
        +          JEIDR6=7,JEIDR7=8,JEIDEC=9,JEIDIP=10,JEIDE1=11,
        +          JEIDE2=12,JEIDE3=13,JEIDFR=14,JEIDPE=15,LEIDTA=15)
   
   
    frftjj
         INTEGER JFRFIR,JFRFTL,JFRFP0,JFRFD0,JFRFZ0,JFRFAL,JFRFEM,JFRFC2,
        +          JFRFDF,JFRFNO,LFRFTA
         PARAMETER(JFRFIR=1,JFRFTL=2,JFRFP0=3,JFRFD0=4,JFRFZ0=5,JFRFAL=6,
        +          JFRFEM=7,JFRFC2=28,JFRFDF=29,JFRFNO=30,LFRFTA=30)
   
   
    fridjj
         INTEGER JFRIBP,JFRIDZ,JFRIBC,JFRIDC,JFRIPE,JFRIPM,JFRIPI,JFRIPK,
        +          JFRIPP,JFRINK,JFRIQF,LFRIDA
         PARAMETER(JFRIBP=1,JFRIDZ=2,JFRIBC=3,JFRIDC=4,JFRIPE=5,JFRIPM=6,
        +          JFRIPI=7,JFRIPK=8,JFRIPP=9,JFRINK=10,JFRIQF=11,
        +          LFRIDA=11)
   
   
    frtljj
         INTEGER JFRTIV,JFRTNV,JFRTII,JFRTNI,JFRTNE,JFRTIT,JFRTNT,JFRTNR,
        +          LFRTLA
         PARAMETER(JFRTIV=1,JFRTNV=2,JFRTII=3,JFRTNI=4,JFRTNE=5,JFRTIT=6,
        +          JFRTNT=7,JFRTNR=8,LFRTLA=8)
   
   
    hmadjj
         INTEGER JHMANF,JHMANE,JHMANL,JHMAMH,JHMAIG,JHMAED,JHMACS,JHMAND,
        +          JHMAIE,JHMAIT,JHMAIF,JHMATN,LHMADA
         PARAMETER(JHMANF=1,JHMANE=2,JHMANL=3,JHMAMH=4,JHMAIG=5,JHMAED=6,
        +          JHMACS=7,JHMAND=8,JHMAIE=9,JHMAIT=10,JHMAIF=11,
        +          JHMATN=12,LHMADA=12)
   
   
    mcadjj
         INTEGER JMCANH,JMCADH,JMCADC,JMCAAM,JMCAAC,JMCATN,LMCADA
         PARAMETER(JMCANH=1,JMCADH=3,JMCADC=5,JMCAAM=7,JMCAAC=8,JMCATN=9,
        +          LMCADA=9)
   
   
    muidjj
         INTEGER JMUIIF,JMUISR,JMUIDM,JMUIST,JMUITN,LMUIDA
         PARAMETER(JMUIIF=1,JMUISR=2,JMUIDM=3,JMUIST=4,JMUITN=5,LMUIDA=5)
   
   
    pcqajj
         INTEGER JPCQNA,JPCQPX,JPCQPY,JPCQPZ,JPCQEN,LPCQAA
         PARAMETER(JPCQNA=1,JPCQPX=2,JPCQPY=3,JPCQPZ=4,JPCQEN=5,LPCQAA=5)
   
   
    pdltjj
         INTEGER JPDLPA,JPDLJT,JPDLPI,JPDLPE,JPDLVP,JPDLFR,LPDLTA
         PARAMETER(JPDLPA=1,JPDLJT=2,JPDLPI=3,JPDLPE=4,JPDLVP=5,JPDLFR=6,
        +          LPDLTA=6)
   
   
    pecojj
         INTEGER JPECER,JPECE1,JPECE2,JPECTH,JPECPH,JPECEC,JPECKD,JPECCC,
        +          JPECRB,JPECPC,LPECOA
         PARAMETER(JPECER=1,JPECE1=2,JPECE2=3,JPECTH=4,JPECPH=5,JPECEC=6,
        +          JPECKD=7,JPECCC=8,JPECRB=9,JPECPC=10,LPECOA=10)
   
   
    peptjj
         INTEGER JPEPT1,JPEPP1,JPEPT3,JPEPP3,LPEPTA
         PARAMETER(JPEPT1=1,JPEPP1=2,JPEPT3=3,JPEPP3=4,LPEPTA=4)
   
   
    pgacjj
         INTEGER JPGAEC,JPGATC,JPGAPC,JPGAR1,JPGAR2,JPGAF4,JPGADM,JPGAST,
        +          JPGAQU,JPGAQ1,JPGAQ2,JPGAM1,JPGAM2,JPGAMA,JPGAER,JPGATR,
        +          JPGAPR,JPGAEF,JPGAGC,JPGAZS,JPGAPL,JPGAPH,JPGAPN,JPGAFA,
        +          JPGAPE,LPGACA
         PARAMETER(JPGAEC=1,JPGATC=2,JPGAPC=3,JPGAR1=4,JPGAR2=5,JPGAF4=6,
        +          JPGADM=7,JPGAST=8,JPGAQU=9,JPGAQ1=10,JPGAQ2=11,
        +          JPGAM1=12,JPGAM2=13,JPGAMA=14,JPGAER=15,JPGATR=16,
        +          JPGAPR=17,JPGAEF=18,JPGAGC=19,JPGAZS=20,JPGAPL=21,
        +          JPGAPH=22,JPGAPN=23,JPGAFA=24,JPGAPE=25,LPGACA=25)
   
   
    pgpcjj
         INTEGER JPGPEC,JPGPTC,JPGPPC,JPGPR1,JPGPR2,JPGPF4,JPGPDM,JPGPST,
        +          JPGPQU,JPGPQ1,JPGPQ2,JPGPM1,JPGPM2,JPGPMA,JPGPER,JPGPTR,
        +          JPGPPR,JPGPPE,LPGPCA
         PARAMETER(JPGPEC=1,JPGPTC=2,JPGPPC=3,JPGPR1=4,JPGPR2=5,JPGPF4=6,
        +          JPGPDM=7,JPGPST=8,JPGPQU=9,JPGPQ1=10,JPGPQ2=11,
        +          JPGPM1=12,JPGPM2=13,JPGPMA=14,JPGPER=15,JPGPTR=16,
        +          JPGPPR=17,JPGPPE=18,LPGPCA=18)
   
   
    phcojj
         INTEGER JPHCER,JPHCTH,JPHCPH,JPHCEC,JPHCKD,JPHCCC,JPHCRB,JPHCNF,
        +          JPHCPC,LPHCOA
         PARAMETER(JPHCER=1,JPHCTH=2,JPHCPH=3,JPHCEC=4,JPHCKD=5,JPHCCC=6,
        +          JPHCRB=7,JPHCNF=8,JPHCPC=9,LPHCOA=9)
   
   
    pmltjj
         INTEGER JPMLFL,JPMLPO,JPMLCH,JPMLSP,JPMLLE,JPMLME,JPMLKT,JPMLFR,
        +          LPMLTA
         PARAMETER(JPMLFL=1,JPMLPO=2,JPMLCH=3,JPMLSP=4,JPMLLE=5,JPMLME=6,
        +          JPMLKT=7,JPMLFR=8,LPMLTA=8)
   
   
    texsjj
         INTEGER JTEXSI,JTEXTM,JTEXTL,JTEXNS,JTEXAD,JTEXTN,JTEXSF,LTEXSA
         PARAMETER(JTEXSI=1,JTEXTM=2,JTEXTL=3,JTEXNS=4,JTEXAD=5,JTEXTN=6,
        +          JTEXSF=7,LTEXSA=7)
   
   
    yv0vjj
         INTEGER JYV0K1,JYV0K2,JYV0VX,JYV0VY,JYV0VZ,JYV0VM,JYV0PX,JYV0PY,
        +          JYV0PZ,JYV0PM,JYV0X1,JYV0X2,JYV0XM,JYV0C2,JYV0IC,JYV0P1,
        +          JYV0P2,JYV0EP,JYV0DM,JYV0S1,JYV0S2,LYV0VA
         PARAMETER(JYV0K1=1,JYV0K2=2,JYV0VX=3,JYV0VY=4,JYV0VZ=5,JYV0VM=6,
        +          JYV0PX=12,JYV0PY=13,JYV0PZ=14,JYV0PM=15,JYV0X1=21,
        +          JYV0X2=22,JYV0XM=23,JYV0C2=26,JYV0IC=27,JYV0P1=28,
        +          JYV0P2=31,JYV0EP=34,JYV0DM=55,JYV0S1=56,JYV0S2=57,
        +          LYV0VA=57)
   
   
         INTEGER NMATCH(2)
   ++----- Common for steering of QREFIT
         PARAMETER (RINOU=95.)
         COMMON/QFITCO/IFLTPC
         DIMENSION HP(7),COV(28),EE0(28),PN(3),CHIAC(32)
         LOGICAL FIRST
         DATA FIRST/.TRUE./
         LOGICAL FLOCK
         PARAMETER(NHMAXT=21)
         INTEGER ICTPC(NHMAXT)
   
   -------------------- /QMACRO/ --- statement functions ----------------
   
    bmacro
       set of intrinsic functions to handle BOS banks
   - # of words/row in bank with index ID
         LCOLS(ID) = IW(ID+1)
   - # of rows in bank with index ID
         LROWS(ID) = IW(ID+2)
   - index of next row in the bank with index ID
         KNEXT(ID) = ID + LMHLEN + IW(ID+1)*IW(ID+2)
   - index of row # NRBOS in the bank with index ID
         KROW(ID,NRBOS) = ID + LMHLEN + IW(ID+1)*(NRBOS-1)
   - # of free words in the bank with index ID
         LFRWRD(ID) = ID + IW(ID) - KNEXT(ID)
   - # of free rows in the bank with index ID
         LFRROW(ID) = LFRWRD(ID) / LCOLS(ID)
   - Lth integer element of the NRBOSth row of the bank with index ID
         ITABL(ID,NRBOS,L) = IW(ID+LMHLEN+(NRBOS-1)*IW(ID+1)+L)
   - Lth real element of the NRBOSth row of the bank with index ID
         RTABL(ID,NRBOS,L) = RW(ID+LMHLEN+(NRBOS-1)*IW(ID+1)+L)
   
   -------------------- /QCFUNC/ --- statement functions for ALPHA banks
         KJQDET(KI)=IW(KOQVEC+KI*KCQVEC+JQVEQD)
         QSQT(QF)=SIGN(SQRT(ABS(QF)),QF)
         QP(KI)=RW(KOQVEC+KI*KCQVEC+JQVEQP)
         QX(KI)=RW(KOQVEC+KI*KCQVEC+JQVEQX)
         QY(KI)=RW(KOQVEC+KI*KCQVEC+JQVEQY)
         QZ(KI)=RW(KOQVEC+KI*KCQVEC+JQVEQZ)
         QE(KI)=RW(KOQVEC+KI*KCQVEC+JQVEQE)
         QM(KI)=RW(KOQVEC+KI*KCQVEC+JQVEQM)
         QCH(KI)=RW(KOQVEC+KI*KCQVEC+JQVECH)
         KCH(KI)=NINT (QCH(KI))
         QCT(KI)=QZ(KI)/QP(KI)
         QDB(KI)=RW(KOQVEC+KI*KCQVEC+JQVEDB)
         QZB(KI)=RW(KOQVEC+KI*KCQVEC+JQVEZB)
         QDBS2(KI)=RW(KOQVEC+KI*KCQVEC+JQVESD)
         QZBS2(KI)=RW(KOQVEC+KI*KCQVEC+JQVESZ)
         QBC2(KI)=RW(KOQVEC+KI*KCQVEC+JQVECB)
         QSIG(KI,KI1,KI2)=RW(KOQVEC+KI*KCQVEC+KMATIX(KI1,KI2)+JQVEEM)
         XSIG(KI)=RW(KOQVEC+KI*KCQVEC+JQVEEM).GE.0.
         QSMAT(KI,KI1)=RW(KOQVEC+KI*KCQVEC+KI1+JQVEEM)
         QSIGX(KI)=QSQT(QSMAT(KI,0))
         QSIGY(KI)=QSQT(QSMAT(KI,2))
         QSIGZ(KI)=QSQT(QSMAT(KI,5))
         QSIGEE(KI)=RW(KOQVEC+KI*KCQVEC+JQVEEM+9)
         QSIGE(KI)=QSQT(QSIGEE(KI))
         QSIGPP(KI)=(QX(KI)**2*QSMAT(KI,0)+QY(KI)**2*QSMAT(KI,2)+
        & QZ(KI)**2*QSMAT(KI,5)+2.*(QX(KI)*(QY(KI)*QSMAT(KI,1)+
        & QZ(KI)*QSMAT(KI,3))+QY(KI)*QZ(KI)*QSMAT(KI,4)))/QP(KI)**2
         QSIGP(KI)=QSQT(QSIGPP(KI))
         QSIGMM(KI)=QM(KI)*(QE(KI)**2*QSMAT(KI,9)+QX(KI)**2*QSMAT(KI,0)+
        & QY(KI)**2*QSMAT(KI,2)+QZ(KI)**2*QSMAT(KI,5)+2.*(QX(KI)*(QY(KI)
        & QSMAT(KI,1)+QZ(KI)*QSMAT(KI,3))+QY(KI)*QZ(KI)*QSMAT(KI,4)-
        & QE(KI)*(QX(KI)*QSMAT(KI,6)+QY(KI)*QSMAT(KI,7)+
        & QZ(KI)*QSMAT(KI,8))))/AMAX1(QM(KI)**3,1.E-16)
         QSIGM(KI)=QSQT(QSIGMM(KI))
         QMCHIF(KI)=RW(KOQVEC+KI*KCQVEC+JQVECF)
         QPH(KI)=ATG(QY(KI),QX(KI))
         QPT(KI)=SQRT(QX(KI)**2+QY(KI)**2)
         KTN(KI)=IW(KOQVEC+KI*KCQVEC+JQVETN)
         KMC(KI)=KCLARM(IW(KOQVEC+KI*KCQVEC+JQVECL))
         KBMASK(KI,KI1)=IW(KOQVEC+KI*KCQVEC+KI1+JQVEBM-1)
         KCALFL(KI)=IW(KJQDET(KI)+JQDECF)
         KCHGD(KI,KI1)=IW(KOQLIN+KI1+IW(KJQDET(KI)+JQDEFL))
         KCLASS(KI)=KCLACO(IW(KOQVEC+KI*KCQVEC+JQVECL))
         KDAU(KI,KI1)=IW(KOQLIN+KI1+IW(KOQVEC+KI*KCQVEC+JQVEDL))
         KECAL(KI,KI1)=IW(KOQLIN+KI1+IW(KJQDET(KI)+JQDEEL))
         KENDV(KI)=IW(KOQVEC+KI*KCQVEC+JQVEEV)
         KFOLLO(KI)=IW(KOQVEC+KI*KCQVEC+JQVENP)
         KHCAL(KI,KI1)=IW(KOQLIN+KI1+IW(KJQDET(KI)+JQDEHL))
         KLUNDS(KI)=IW(KOQVEC+KI*KCQVEC+JQVEKS)
         KNCHGD(KI)=IW(KJQDET(KI)+JQDENF)
         KNECAL(KI)=IW(KJQDET(KI)+JQDENE)
         KNHCAL(KI)=IW(KJQDET(KI)+JQDENH)
         KNMOTH(KI)=IW(KOQVEC+KI*KCQVEC+JQVENO)
         KMOTH(KI,KI1)=IW(KOQLIN+KI1+IW(KOQVEC+KI*KCQVEC+JQVEOL))
         KMTCH(KI,KI1)=IW(KOQMTL+KI1+IW(KOQVEC+KI*KCQVEC+JQVEML))
         KNDAU(KI)=IW(KOQVEC+KI*KCQVEC+JQVEND)
         KNMTCH(KI)=IW(KOQVEC+KI*KCQVEC+JQVENM)
         KORIV(KI)=IW(KOQVEC+KI*KCQVEC+JQVEOV)
         KSAME(KI)=IW(KOQVEC+KI*KCQVEC+JQVESP)
         KSMTCH(KI,KI1)=IW(KOQMTS+KI1+IW(KOQVEC+KI*KCQVEC+JQVEML))
         KSTABC(KI)=IW(KOQVEC+KI*KCQVEC+JQVESC)
         KTPCOD(KI)=IW(KOQVEC+KI*KCQVEC+JQVEPA)
         XLOCKN(KI,KI1)=IAND(KBMASK(KI,KI1),KLOCK0(KI1,KMC(KI))).NE.0
         XLOCK(KI)=IW(KOQVEC+KI*KCQVEC+JQVELK).NE.0.OR.XLOCKN(KI,1).OR.
        & XLOCKN(KI,2).OR.XLOCKN(KI,3).OR.XLOCKN(KI,4).OR.
        & XLOCKN(KI,5).OR.XLOCKN(KI,6).OR.XLOCKN(KI,7).OR.
        & XLOCKN(KI,8).OR.XLOCKN(KI,9).OR.XLOCKN(KI,10).OR.
        & XLOCKN(KI,11).OR.XLOCKN(KI,12).OR.XLOCKN(KI,13).OR.
        & XLOCKN(KI,14)
         XMC(KI)=KCLARM(IW(KOQVEC+KI*KCQVEC+JQVECL)).NE.1
         QRDFL(KI,KI1)=RW(KOQVEC+KI*KCQVEC+JQVEUS+KI1-1)
         KRDFL(KI,KI1)=IW(KOQVEC+KI*KCQVEC+JQVEUS+KI1-1)
         XCAL(KI)=IW(KJQDET(KI)+JQDECF).NE.0
         XECAL(KI)=IABS(IW(KJQDET(KI)+JQDECF)).EQ.1
         XHCAL(KI)=IABS(IW(KJQDET(KI)+JQDECF)).EQ.2
         QVX(KI)=RW(KOQVRT+KI*KCQVRT+JQVRVX)
         QVY(KI)=RW(KOQVRT+KI*KCQVRT+JQVRVY)
         QVZ(KI)=RW(KOQVRT+KI*KCQVRT+JQVRVZ)
         KVN(KI)=IW(KOQVRT+KI*KCQVRT+JQVRVN)
         KVTYPE(KI)=IW(KOQVRT+KI*KCQVRT+JQVRTY)
         KVINCP(KI)=IW(KOQVRT+KI*KCQVRT+JQVRIP)
         KVNDAU(KI)=IW(KOQVRT+KI*KCQVRT+JQVRND)
         KVYV0V(KI)=IW(KOQVRT+KI*KCQVRT+JQVRAY)
         KVFVER(KI)=IW(KOQVRT+KI*KCQVRT+JQVRAF)
         KVDAU(KI,KI1)=IW(KOQLIN+KI1+IW(KOQVRT+KI*KCQVRT+JQVRDL))
         QVEM(KI,KI1,KI2)=RW(KOQVRT+KI*KCQVRT+KMATIX(KI1,KI2)+JQVREM)
         QVCHIF(KI)=RW(KOQVRT+KI*KCQVRT+JQVRCF)
         QVDIF2(KI1,KI2)=SQRT((QVX(KI1)-QVX(KI2))**2+(QVY(KI1)-
        &QVY(KI2))**2)
         QVDIF3(KI1,KI2)=SQRT((QVX(KI1)-QVX(KI2))**2+(QVY(KI1)-
        &QVY(KI2))**2+ (QVZ(KI1)-QVZ(KI2))**2)
         QMSQ2(KI1,KI2)=(QE(KI1)+QE(KI2))**2-(QX(KI1)+QX(KI2))**2-
        & (QY(KI1)+QY(KI2))**2-(QZ(KI1)+QZ(KI2))**2
         QMSQ3(KI1,KI2,KI3)=(QE(KI1)+QE(KI2)+QE(KI3))**2-
        & (QX(KI1)+QX(KI2)+QX(KI3))**2-(QY(KI1)+QY(KI2)+QY(KI3))**2-
        & (QZ(KI1)+QZ(KI2)+QZ(KI3))**2
         QMSQ4(KI1,KI2,KI3,KI4)=(QE(KI1)+QE(KI2)+QE(KI3)+QE(KI4))**2-
        & (QX(KI1)+QX(KI2)+QX(KI3)+QX(KI4))**2-(QY(KI1)+QY(KI2)+
        & QY(KI3)+QY(KI4))**2-(QZ(KI1)+QZ(KI2)+QZ(KI3)+QZ(KI4))**2
         QM2(KI1,KI2)=QSQT(QMSQ2(KI1,KI2))
         QM3(KI1,KI2,KI3)=QSQT(QMSQ3(KI1,KI2,KI3))
         QM4(KI1,KI2,KI3,KI4)=QSQT(QMSQ4(KI1,KI2,KI3,KI4))
         QDMSQ(KI1,KI2)=(QE(KI1)-QE(KI2))**2-(QX(KI1)-QX(KI2))**2-
        & (QY(KI1)-QY(KI2))**2-(QZ(KI1)-QZ(KI2))**2
         QBETA(KI)=QP(KI)/QE(KI)
         QGAMMA(KI)=1./SQRT((1.-QBETA(KI))*(1.+QBETA(KI)))
         QDOT3(KI1,KI2)=QX(KI1)*QX(KI2)+QY(KI1)*QY(KI2)+QZ(KI1)*QZ(KI2)
         QDOT4(KI1,KI2)=QE(KI1)*QE(KI2)-QDOT3(KI1,KI2)
         QCOSA(KI1,KI2)=QDOT3(KI1,KI2)/(QP(KI1)*QP(KI2))
         QPPAR(KI1,KI2)=QDOT3(KI1,KI2)/QP(KI2)
         QPPER(KI1,KI2)=SQRT((QY(KI1)*QZ(KI2)-QZ(KI1)*QY(KI2))**2+
        & (QZ(KI1)*QX(KI2)-QX(KI1)*QZ(KI2))**2+
        & (QX(KI1)*QY(KI2)-QY(KI1)*QX(KI2))**2)/QP(KI2)
         XSAME(KI1,KI2)=IAND(KBMASK(KI1,1),KBMASK(KI2,1)).NE.0.OR.
        & IAND(KBMASK(KI1,2),KBMASK(KI2,2)).NE.0.OR.
        & IAND(KBMASK(KI1,3),KBMASK(KI2,3)).NE.0.OR.
        & IAND(KBMASK(KI1,4),KBMASK(KI2,4)).NE.0.OR.
        & IAND(KBMASK(KI1,5),KBMASK(KI2,5)).NE.0.OR.
        & IAND(KBMASK(KI1,6),KBMASK(KI2,6)).NE.0.OR.
        & IAND(KBMASK(KI1,7),KBMASK(KI2,7)).NE.0.OR.
        & IAND(KBMASK(KI1,8),KBMASK(KI2,8)).NE.0.OR.
        & IAND(KBMASK(KI1,9),KBMASK(KI2,9)).NE.0.OR.
        & IAND(KBMASK(KI1,10),KBMASK(KI2,10)).NE.0.OR.
        & IAND(KBMASK(KI1,11),KBMASK(KI2,11)).NE.0.OR.
        & IAND(KBMASK(KI1,12),KBMASK(KI2,12)).NE.0.OR.
        & IAND(KBMASK(KI1,13),KBMASK(KI2,13)).NE.0.OR.
        & IAND(KBMASK(KI1,14),KBMASK(KI2,14)).NE.0
         QCMASS(KI)=RW(KOQPAR+KI*KCQPAR+JQPAMA)
         QCCHAR(KI)=RW(KOQPAR+KI*KCQPAR+JQPACH)
         QCLIFE(KI)=RW(KOQPAR+KI*KCQPAR+JQPALT)
         QCWIDT(KI)=RW(KOQPAR+KI*KCQPAR+JQPAWI)
         XCEQOR(KI,KI1)=KTPCOD(KI).EQ.KI1.OR.
        & KTPCOD(KI).EQ.IW(KOQPAR+KI1*KCQPAR+JQPAAN)
         XCEQU(KI,KI1)=KTPCOD(KI).EQ.KI1
      QCFDET
         XFRF(KI)=IW(KJQDET(KI)+JQDEAF).NE.KQZER
         QFRFIR(KI)=RW(IW(KJQDET(KI)+JQDEAF)+JFRFIR)
         QFRFTL(KI)=RW(IW(KJQDET(KI)+JQDEAF)+JFRFTL)
         QFRFP0(KI)=RW(IW(KJQDET(KI)+JQDEAF)+JFRFP0)
         QFRFD0(KI)=RW(IW(KJQDET(KI)+JQDEAF)+JFRFD0)
         QFRFZ0(KI)=RW(IW(KJQDET(KI)+JQDEAF)+JFRFZ0)
         QFRFAL(KI)=RW(IW(KJQDET(KI)+JQDEAF)+JFRFAL)
         QFRFEM(KI,KI1,KI2)=RW(IW(KJQDET(KI)+JQDEAF)+
        & KMATIX(KI1,KI2)+JFRFEM)
         QFRFC2(KI)=RW(IW(KJQDET(KI)+JQDEAF)+JFRFC2)
         KFRFDF(KI)=IW(IW(KJQDET(KI)+JQDEAF)+JFRFDF)
         KFRFNO(KI)=IW(IW(KJQDET(KI)+JQDEAF)+JFRFNO)
         KFRTNV(KI)=IW(IW(KJQDET(KI)+JQDEAL)+JFRTNV)
         KFRTNI(KI)=IW(IW(KJQDET(KI)+JQDEAL)+JFRTNI)
         KFRTNE(KI)=IW(IW(KJQDET(KI)+JQDEAL)+JFRTNE)
         KFRTNT(KI)=IW(IW(KJQDET(KI)+JQDEAL)+JFRTNT)
         KFRTNR(KI)=IW(IW(KJQDET(KI)+JQDEAL)+JFRTNR)
         KFRIBP(KI)=IW(IW(KJQDET(KI)+JQDEFI)+JFRIBP)
         KFRIDZ(KI)=IW(IW(KJQDET(KI)+JQDEFI)+JFRIDZ)
         KFRIBC(KI)=IW(IW(KJQDET(KI)+JQDEFI)+JFRIBC)
         KFRIDC(KI)=IW(IW(KJQDET(KI)+JQDEFI)+JFRIDC)
         QFRIPE(KI)=RW(IW(KJQDET(KI)+JQDEFI)+JFRIPE)
         QFRIPM(KI)=RW(IW(KJQDET(KI)+JQDEFI)+JFRIPM)
         QFRIPI(KI)=RW(IW(KJQDET(KI)+JQDEFI)+JFRIPI)
         QFRIPK(KI)=RW(IW(KJQDET(KI)+JQDEFI)+JFRIPK)
         QFRIPP(KI)=RW(IW(KJQDET(KI)+JQDEFI)+JFRIPP)
         QFRINK(KI)=RW(IW(KJQDET(KI)+JQDEFI)+JFRINK)
         KFRIQF(KI)=IW(IW(KJQDET(KI)+JQDEFI)+JFRIQF)
         XFRIQF(KI)=KFRIQF(KI).EQ.1.OR.KFRIQF(KI).EQ.3
         KNTEX(KI)=IW(KJQDET(KI)+JQDENT)
         XTEX(KI)=IW(KJQDET(KI)+JQDENT).NE.0
         KTEXSI(KI,KI1)=IW(IW(KJQDET(KI)+KI1+JQDENT)+JTEXSI)
         QTEXTM(KI,KI1)=RW(IW(KJQDET(KI)+KI1+JQDENT)+JTEXTM)
         QTEXTL(KI,KI1)=RW(IW(KJQDET(KI)+KI1+JQDENT)+JTEXTL)
         KTEXNS(KI,KI1)=IW(IW(KJQDET(KI)+KI1+JQDENT)+JTEXNS)
         QTEXAD(KI,KI1)=RW(IW(KJQDET(KI)+KI1+JQDENT)+JTEXAD)
         XEID(KI)=IW(KJQDET(KI)+JQDEAE).NE.KQZER
         KEIDIF(KI)=IW(IW(KJQDET(KI)+JQDEAE)+JEIDIF)
         QEIDRI(KI,KI1)=RW(IW(KJQDET(KI)+JQDEAE)+KI1+JEIDR1-1)
         QEIDEC(KI)=RW(IW(KJQDET(KI)+JQDEAE)+JEIDEC)
         KEIDIP(KI)=IW(IW(KJQDET(KI)+JQDEAE)+JEIDIP)
         QEIDEI(KI,KI1)=RW(IW(KJQDET(KI)+JQDEAE)+KI1+JEIDE1-1)
         XHMA(KI)=IW(KJQDET(KI)+JQDEAH).NE.KQZER
         KHMANF(KI)=IW(IW(KJQDET(KI)+JQDEAH)+JHMANF)
         KHMANE(KI)=IW(IW(KJQDET(KI)+JQDEAH)+JHMANE)
         KHMANL(KI)=IW(IW(KJQDET(KI)+JQDEAH)+JHMANL)
         KHMAMH(KI)=IW(IW(KJQDET(KI)+JQDEAH)+JHMAMH)
         KHMAIG(KI)=IW(IW(KJQDET(KI)+JQDEAH)+JHMAIG)
         QHMAED(KI)=RW(IW(KJQDET(KI)+JQDEAH)+JHMAED)
         QHMACS(KI)=RW(IW(KJQDET(KI)+JQDEAH)+JHMACS)
         KHMAND(KI)=IW(IW(KJQDET(KI)+JQDEAH)+JHMAND)
         KHMAIE(KI)=IW(IW(KJQDET(KI)+JQDEAH)+JHMAIE)
         KHMAIT(KI)=IW(IW(KJQDET(KI)+JQDEAH)+JHMAIT)
         KHMAIF(KI)=IW(IW(KJQDET(KI)+JQDEAH)+JHMAIF)
         XMCA(KI)=IW(KJQDET(KI)+JQDEAM).NE.KQZER
         KMCANH(KI,KI1)=IW(IW(KJQDET(KI)+JQDEAM)+KI1+JMCANH-1)
         QMCADH(KI,KI1)=RW(IW(KJQDET(KI)+JQDEAM)+KI1+JMCADH-1)
         QMCADC(KI,KI1)=RW(IW(KJQDET(KI)+JQDEAM)+KI1+JMCADC-1)
         QMCAAM(KI)=RW(IW(KJQDET(KI)+JQDEAM)+JMCAAM)
         QMCAAC(KI)=RW(IW(KJQDET(KI)+JQDEAM)+JMCAAC)
         XMUI(KI)=IW(KJQDET(KI)+JQDEMU).NE.KQZER
         KMUIIF(KI)=IW(IW(KJQDET(KI)+JQDEMU)+JMUIIF)
         QMUISR(KI)=RW(IW(KJQDET(KI)+JQDEMU)+JMUISR)
         QMUIDM(KI)=RW(IW(KJQDET(KI)+JQDEMU)+JMUIDM)
         KMUIST(KI)=IW(IW(KJQDET(KI)+JQDEMU)+JMUIST)
         KMUITN(KI)=IW(IW(KJQDET(KI)+JQDEMU)+JMUITN)
         XPEC(KI)=IW(KJQDET(KI)+JQDEEC).NE.KQZER
         QPECER(KI)=RW(IW(KJQDET(KI)+JQDEEC)+JPECER)
         QPECE1(KI)=RW(IW(KJQDET(KI)+JQDEEC)+JPECE1)
         QPECE2(KI)=RW(IW(KJQDET(KI)+JQDEEC)+JPECE2)
         QPECTH(KI)=RW(IW(KJQDET(KI)+JQDEEC)+JPECTH)
         QPECPH(KI)=RW(IW(KJQDET(KI)+JQDEEC)+JPECPH)
         QPECEC(KI)=RW(IW(KJQDET(KI)+JQDEEC)+JPECEC)
         KPECKD(KI)=IW(IW(KJQDET(KI)+JQDEEC)+JPECKD)
         KPECCC(KI)=IW(IW(KJQDET(KI)+JQDEEC)+JPECCC)
         KPECRB(KI)=IW(IW(KJQDET(KI)+JQDEEC)+JPECRB)
         KPECPC(KI)=IW(IW(KJQDET(KI)+JQDEEC)+JPECPC)
         XPEP(KI)=IW(KJQDET(KI)+JQDEET).NE.KQZER
         QPEPT1(KI)=RW(IW(KJQDET(KI)+JQDEET)+JPEPT1)
         QPEPP1(KI)=RW(IW(KJQDET(KI)+JQDEET)+JPEPP1)
         QPEPT3(KI)=RW(IW(KJQDET(KI)+JQDEET)+JPEPT3)
         QPEPP3(KI)=RW(IW(KJQDET(KI)+JQDEET)+JPEPP3)
         XPHC(KI)=IW(KJQDET(KI)+JQDEHC).NE.KQZER
         QPHCER(KI)=RW(IW(KJQDET(KI)+JQDEHC)+JPHCER)
         QPHCTH(KI)=RW(IW(KJQDET(KI)+JQDEHC)+JPHCTH)
         QPHCPH(KI)=RW(IW(KJQDET(KI)+JQDEHC)+JPHCPH)
         QPHCEC(KI)=RW(IW(KJQDET(KI)+JQDEHC)+JPHCEC)
         KPHCKD(KI)=IW(IW(KJQDET(KI)+JQDEHC)+JPHCKD)
         KPHCCC(KI)=IW(IW(KJQDET(KI)+JQDEHC)+JPHCCC)
         KPHCRB(KI)=IW(IW(KJQDET(KI)+JQDEHC)+JPHCRB)
         KPHCPC(KI)=IW(IW(KJQDET(KI)+JQDEHC)+JPHCPC)
         XEFO(KI)=IW(KJQDET(KI)+JQDEEF).NE.KQZER
         QEFOWE(KI)=RW(IW(KJQDET(KI)+JQDEEF)+JEFOWE)
         KEFOTY(KI)=IW(IW(KJQDET(KI)+JQDEEF)+JEFOTY)
         KEFOLE(KI)=IW(IW(KJQDET(KI)+JQDEEF)+JEFOLE)
         KEFOLT(KI)=IW(IW(KJQDET(KI)+JQDEEF)+JEFOLT)
         KEFOLH(KI)=IW(IW(KJQDET(KI)+JQDEEF)+JEFOLH)
         KEFOLC(KI)=IW(IW(KJQDET(KI)+JQDEEF)+JEFOLC)
         KEFOLJ(KI)=IW(IW(KJQDET(KI)+JQDEEF)+JEFOLJ)
         XPCQ(KI)=IW(KJQDET(KI)+JQDEPC).NE.KQZER
         KPCQNA(KI)=IW(IW(KJQDET(KI)+JQDEPC)+JPCQNA)
         XEGP(KI)=IW(KJQDET(KI)+JQDEEG).NE.KQZER
         QEGPR1(KI)=RW(IW(KJQDET(KI)+JQDEEG)+JEGPR1)
         QEGPR2(KI)=RW(IW(KJQDET(KI)+JQDEEG)+JEGPR2)
         QEGPF4(KI)=RW(IW(KJQDET(KI)+JQDEEG)+JEGPF4)
         QEGPDM(KI)=RW(IW(KJQDET(KI)+JQDEEG)+JEGPDM)
         KEGPST(KI)=IW(IW(KJQDET(KI)+JQDEEG)+JEGPST)
         KEGPQU(KI)=IW(IW(KJQDET(KI)+JQDEEG)+JEGPQU)
         KEGPPE(KI)=IW(IW(KJQDET(KI)+JQDEEG)+JEGPPE)
         XPGP(KI)=IW(KJQDET(KI)+JQDEPG).NE.KQZER.AND.IW(NAPGPC).GT.0
         QPGPR1(KI)=RW(IW(KJQDET(KI)+JQDEPG)+JPGPR1)
         QPGPR2(KI)=RW(IW(KJQDET(KI)+JQDEPG)+JPGPR2)
         QPGPF4(KI)=RW(IW(KJQDET(KI)+JQDEPG)+JPGPF4)
         QPGPDM(KI)=RW(IW(KJQDET(KI)+JQDEPG)+JPGPDM)
         QPGPST(KI)=RW(IW(KJQDET(KI)+JQDEPG)+JPGPST)
         QPGPQ1(KI)=RW(IW(KJQDET(KI)+JQDEPG)+JPGPQ1)
         QPGPQ2(KI)=RW(IW(KJQDET(KI)+JQDEPG)+JPGPQ2)
         QPGPM1(KI)=RW(IW(KJQDET(KI)+JQDEPG)+JPGPM1)
         QPGPM2(KI)=RW(IW(KJQDET(KI)+JQDEPG)+JPGPM2)
         QPGPMA(KI)=RW(IW(KJQDET(KI)+JQDEPG)+JPGPMA)
         QPGPER(KI)=RW(IW(KJQDET(KI)+JQDEPG)+JPGPER)
         QPGPTR(KI)=RW(IW(KJQDET(KI)+JQDEPG)+JPGPTR)
         QPGPPR(KI)=RW(IW(KJQDET(KI)+JQDEPG)+JPGPPR)
         KPGPQU(KI)=IW(IW(KJQDET(KI)+JQDEPG)+JPGPQU)
         KPGPPE(KI)=IW(IW(KJQDET(KI)+JQDEPG)+JPGPPE)
         XPGAC(KI)=IW(KJQDET(KI)+JQDEPG).NE.KQZER.AND.IW(NAPGAC).GT.0
         KPGAST(KI)=IW(IW(KJQDET(KI)+JQDEPG)+JPGAST)
         QPGAEF(KI)=RW(IW(KJQDET(KI)+JQDEPG)+JPGAEF)
         QPGAGC(KI)=RW(IW(KJQDET(KI)+JQDEPG)+JPGAGC)
         QPGAZS(KI)=RW(IW(KJQDET(KI)+JQDEPG)+JPGAZS)
         QPGAPL(KI)=RW(IW(KJQDET(KI)+JQDEPG)+JPGAPL)
         QPGAPH(KI)=RW(IW(KJQDET(KI)+JQDEPG)+JPGAPH)
         KPGAPN(KI)=IW(IW(KJQDET(KI)+JQDEPG)+JPGAPN)
         KPGAFA(KI)=IW(IW(KJQDET(KI)+JQDEPG)+JPGAFA)
         KPGAPE(KI)=IW(IW(KJQDET(KI)+JQDEPG)+JPGAPE)
         XYV0(KI)=KVYV0V(KENDV(KI)).NE.0
         KYV0K1(KI)=IW(KVYV0V(KENDV(KI))+JYV0K1)
         KYV0K2(KI)=IW(KVYV0V(KENDV(KI))+JYV0K2)
         QYV0VX(KI)=RW(KVYV0V(KENDV(KI))+JYV0VX)
         QYV0VY(KI)=RW(KVYV0V(KENDV(KI))+JYV0VY)
         QYV0VZ(KI)=RW(KVYV0V(KENDV(KI))+JYV0VZ)
         QYV0X1(KI)=RW(KVYV0V(KENDV(KI))+JYV0X1)
         QYV0X2(KI)=RW(KVYV0V(KENDV(KI))+JYV0X2)
         QYV0C2(KI)=RW(KVYV0V(KENDV(KI))+JYV0C2)
         KYV0IC(KI)=IW(KVYV0V(KENDV(KI))+JYV0IC)
         QYV0DM(KI)=RW(KVYV0V(KENDV(KI))+JYV0DM)
         QYV0S1(KI)=RW(KVYV0V(KENDV(KI))+JYV0S1)
         QYV0S2(KI)=RW(KVYV0V(KENDV(KI))+JYV0S2)
         XLEPTG(KI)=IW(KJQDET(KI)+JQDEPD).NE.KQZER
         KLEPPA(KI)=IW(IW(KJQDET(KI)+JQDEPD)+JPDLPA)
         KLEPJT(KI)=IW(IW(KJQDET(KI)+JQDEPD)+JPDLJT)+KLFJET-1
         QLEPPI(KI)=RW(IW(KJQDET(KI)+JQDEPD)+JPDLPI)
         QLEPPE(KI)=RW(IW(KJQDET(KI)+JQDEPD)+JPDLPE)
         KLEPVP(KI)=IW(IW(KJQDET(KI)+JQDEPD)+JPDLVP)
         XLEPTH(KI)=IW(KJQDET(KI)+JQDEPM).NE.KQZER
         KLEPFL(KI)=IW(IW(KJQDET(KI)+JQDEPM)+JPMLFL)
         KLEPPO(KI)=IW(IW(KJQDET(KI)+JQDEPM)+JPMLPO)
         KLEPCH(KI)=IW(IW(KJQDET(KI)+JQDEPM)+JPMLCH)
         KLEPSP(KI)=IW(IW(KJQDET(KI)+JQDEPM)+JPMLSP)
         KLEPLE(KI)=IW(IW(KJQDET(KI)+JQDEPM)+JPMLLE)
         KLEPME(KI)=IW(IW(KJQDET(KI)+JQDEPM)+JPMLME)
         KLEPKT(KI)=IW(IW(KJQDET(KI)+JQDEPM)+JPMLKT)
   
         NFIT=0
         IF (FIRST) THEN
           FIRST=.FALSE.
           NFRTL=NAMIND('FRTL')
           NFTCL=NAMIND('FTCL')
           NFICL=NAMIND('FICL')
           NITCO=NAMIND('ITCO')
           NICCO=NAMIND('ICCO')
           NTPCO=NAMIND('TPCO')
           NFVCL=NAMIND('FVCL')
           NVDCO=NAMIND('VDCO')
         ENDIF
         KFRTL=IW(NFRTL)
         KFRFT=NLINK('FRFT',0)
   ++
   ++--- Set the lock flag: if METHOD < 0 only tracks which are not
   ++    locked will be refitted
   ++
   
         IF (KFRFT.EQ.0 .OR. KFRTL.EQ.0) THEN
          CALL QWMESE('QREFIT: FRFT and FRTL are not present.')
           RETURN
         ENDIF
         KITCO=IW(NICCO)
         KFICL=IW(NFICL)
         KFTCL=IW(NFTCL)
         NTK=LROWS(KFRFT)
         DO 500 JTK=1,NTK
           IOITC=ITABL(KFRTL,JTK,JFRTII)
           IOTPC=ITABL(KFRTL,JTK,JFRTIT)
           IOVDT=ITABL(KFRTL,JTK,JFRTIV)
           NTPC=ITABL(KFRTL,JTK,JFRTNT)
           NITC=ITABL(KFRTL,JTK,JFRTNI)
           NVDET=0
           NDOF=2*(NTPC+NVDET+NITC) -5
           IF (NDOF.LT.1) GO TO 500
   ++         This is the KALMAN filter fitting routine with the
   ++         improved VDET material description. The CHI2 returned
   ++         is very large (10**30) if the fit fails.
             IERR=0
             IOPT=9
             NMULT=0
             ierfit = UFTTRA(JTK,QMFLD,RW(KROW(KFRFT,JTK)+JFRFIR),
        &                RW(KROW(KFRFT,JTK)+JFRFC2),
        &                NTPC,NITC,NVDET,
        &                IW(KFTCL+LMHLEN+IOTPC+1),
        &                IW(KFICL+LMHLEN+IOITC+1),
        &                IW(KFVCL+LMHLEN+IOVDT+1),
        &                HP,COV,CHI2,NDOF)
             IF (CHI2.GT.1.0E10) GO TO 500
             IF (HP(1).EQ.0.) GO TO 500
             IF (COV(1).LE.0.) GO TO 500
             IF (COV(3).LE.0.) GO TO 500
             IF (COV(6).LE.0.) GO TO 500
             IF (COV(10).LE.0.) GO TO 500
             IF (COV(15).LE.0.) GO TO 500
             IF (COV(21).LT.0.) GO TO 500
    against very straight tracks.
             IF (ABS(HP(1)).LT.1.0E-7) HP(1) = SIGN(1.0E-7,HP(1))
   ++     Overwrite the unpacked track bank
             DO 60 I=1,6
               RW(KROW(KFRFT,JTK)+JFRFIR-1+I)=HP(I)
      60     CONTINUE
             DO 70 I=1,21
               RW(KROW(KFRFT,JTK)+JFRFEM-1+I)=COV(I)
      70     CONTINUE
             RW(KROW(KFRFT,JTK)+JFRFC2)=CHI2
             IW(KROW(KFRFT,JTK)+JFRFDF)=NDOF
             IW(KROW(KFRFT,JTK)+JFRFNO)=NMULT*100+IOPT*10+IERR
             NFIT=NFIT+1
     500 CONTINUE
   ++   Redo Vdet if needed
         IF(IW(NAMIND('FRF0')) .eq. 0)THEN
            CALL VTRKEX(QMFLD,IERR)
            CALL VTRFIT(1,QMFLD,IERR,IGARB,NMATCH)
         ENDIF
         RETURN
         END
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   QUREFIT                                                                         
        |---- QFREFIT                                                              
                   |----  SIGN                                External             
                   |----  SQRT                                External             
                   |----  ABS                                 External             
                   |----  NINT                                External             
                   |----  KMATIX                              External             
                   |----  ATG                                 External             
                   |----  KCLARM                              External             
                   |----  IAND                                External             
                   |----  KLOCK0                              External             
                   |----  IABS                                External             
                   |----  NAMIND                              External             
                   |----  NLINK                               External             
                   |----  VTRKEX                              External             
                   |----  VTRFIT                              External             
   
 
3 QFREV0
         SUBROUTINE QFREV0
  ------------------------------------------------------------------------------
    CKEY FILL VERTEX /INTERNAL
  ------------------------------------------------------------------------------
   Fill alpha banks with reconstructed vertex, v0 information.
     Author   : E. Blucher                22-APR-1989
     Modified : E. Blucher, R. Jacobsen   30-JAN-1992
     Modified : J. Boucrot                05-May-1993
     Description
     ===========
    QVRT filled with (1) main vertex from PYER and (2) V0's from
    YV0V.
    QVEC V0 section filled from YV0V.
    QVEC DC section filled with daughters from V0's after calling
       UHELIX to calculate track momenta at point of closest approach
       to the secondary vertex.
       30-1-92:
       If V0 daughter momenta are stored in YV0V, these momenta are
       used and UHELIX is not called.
     ---->  called from QFILL
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   QFILL                                                                           
        |---- QFREV0                                                               
                   |----  SIGN                                External             
                   |----  SQRT                                External             
                   |----  ABS                                 External             
                   |----  NINT                                External             
                   |----  KMATIX                              External             
                   |----  ATG                                 External             
                   |----  KCLARM                              External             
                   |----  IAND                                External             
                   |----  KLOCK0                              External             
                   |----  IABS                                External             
                   |----  NAMIND                              External             
                   |----  NLINK                               External             
                   |----  YMFV0V                              External             
                   |----  BLIST                               External             
                   |----  ABGTCL                              External             
                   |----  BTEST                                                    
                   |----  QSBANK                                                   
                   |----  QVCOPY                                                   
                   |----  UHELIX                              External             
                   |----  QAMOTH                                                   
   
 
3 QFYLV0
         SUBROUTINE QFYLV0
  ------------------------------------------------------------------------------
    CKEY FILL VERTEX /INTERNAL
  ------------------------------------------------------------------------------
   Fill alpha banks with "long v0s" from new tracking
     Author   : J. Boucrot   23-Apr-1997  mod 15-Oct-1997
     Description
     ===========
    QVRT filled with "Long V0" vertices from YLV0 bank
    QVEC "Long V0 tracks" filled from YLV0
     ---->  called from QFILNV
   
   
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   QFILNV                                                                          
        |---- QFYLV0                                                               
                   |----  SIGN                                External             
                   |----  SQRT                                External             
                   |----  ABS                                 External             
                   |----  NINT                                External             
                   |----  KMATIX                              External             
                   |----  ATG                                 External             
                   |----  KCLARM                              External             
                   |----  IAND                                External             
                   |----  KLOCK0                              External             
                   |----  IABS                                External             
                   |----  NAMIND                              External             
                   |----  QSBANK                                                   
                   |----  QAMOTH                                                   
   
 
3 QFYNVH
         SUBROUTINE QFYNVH(IVRTX,INTRA,NOUTR,LISOU)
  ------------------------------------------------------------------------------
    CKEY FILL VERTEX   /INTERNAL
  ------------------------------------------------------------------------------
   Fill list of tracks from nuclear interaction vertices from new
     - tracking bank YNVH.
   
      Author   :  J. Boucrot                    21-Apr-1997
   
       Input  :
             IVRTX = Vertex number
      Outputs :
             INTRA = ALPHA number of incoming track, if any
             NOUTR = Number of outgoing tracks
             LISOU = List of ALPHA numbers of outgoing tracks
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   QFNINT                                                                          
        |---- QFYNVH                                                               
                   |----  SIGN                                External             
                   |----  SQRT                                External             
                   |----  ABS                                 External             
                   |----  NINT                                External             
                   |----  KMATIX                              External             
                   |----  ATG                                 External             
                   |----  KCLARM                              External             
                   |----  IAND                                External             
                   |----  KLOCK0                              External             
                   |----  IABS                                External             
                   |----  NAMIND                              External             
   
 
3 QGTPDDX
         SUBROUTINE QGTPDDX(IRUN,IEVT,IER)
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Get the pad de/dx from pots
   
        Author: F. Palla 14-Nov-1998
                Called from QFPTPX
   
        Input: IRUN  /I Run number
               IEVT  /I Event number
   
        Output: IER  /I Error return = nonzero if something went wrong
   
   
   
   
   
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   QFPTPX                                                                          
        |---- QGTPDDX                                                              
                   |----  GTSTUP                              External             
                   |----  ALGTDB                              External             
                   |----  JUNIDB                              External             
                   |----  NAMIND                              External             
                   |----  NLINK                               External             
                   |----  BDROP                               External             
                   |----  AUBOS                               External             
                   |----  ABS                                 External             
                   |----  COS                                 External             
                   |----  ATAN                                External             
                   |----  MOD                                 External             
                   |----  ITPTYP                              External             
                   |----  TPPROW                              External             
                   |----  SIN                                 External             
                   |----  INT                                 External             
                   |----  TWIRLE                              External             
                   |----  EXP                                 External             
                   |----  TFILPA                              External             
                   |----  ATAN2                               External             
                   |----  TPDWID                              External             
                   |----  TPDHGT                              External             
                   |----  ASIN                                External             
                   |----  TPDSEP                              External             
                   |----  AMOD                                External             
                   |----  BLIST                               External             
                   |----  AUBPRS                              External             
   
 
3 QHFN
         SUBROUTINE QHFN(ID,A1 ,A2 ,A3 ,A4 ,A5 ,A6 ,A7 ,A8 ,A9 ,A10,
  ------------------------------------------------------------------------------
    CKEY HIST /USER
  ------------------------------------------------------------------------------
        1                   A11,A12,A13,A14,A15,A16,A17,A18,A19,A20,
        2                   A21,A22,A23,A24,A25,A26,A27,A28,A29,A30,
        3                   A31,A32,A33,A34,A35,A36,A37,A38,A39,A40,
        4                   A41,A42,A43,A44,A45,A46,A47,A48,A49,A50,
        2                   A51,A52,A53,A54,A55,A56,A57,A58,A59,A60,
        3                   A61,A62,A63,A64,A65,A66,A67,A68,A69,A70,
        4                   A71,A72,A73,A74,A75,A76,A77,A78,A79,A80)
   Fill n-tuple with variable number of arguments
     Input:          ID           N-tuple  identifier
                     A1,...,A80   elements of N-tuple
     Calls           HGIVEN  from HBOOK
     Author:     D.Schlatter    1.89
     Modified:   F.Ranjard      3.93
                 use HGIVEN instead of NOARG on all machines
     Modified:   J.Boucrot     11.94
                 extend to 80 arguments
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
              QHFN                                                                 
                   |----  HGIVEN                              External             
                   |----  QWMESS                                                   
                   |----  A80PV                               External             
                   |----  A79PV                               External             
                   |----  A78PV                               External             
                   |----  A77PV                               External             
                   |----  A76PV                               External             
                   |----  A75PV                               External             
                   |----  A74PV                               External             
                   |----  A73PV                               External             
                   |----  A72PV                               External             
                   |----  A70PV                               External             
                   |----  A69PV                               External             
                   |----  A68PV                               External             
                   |----  A67PV                               External             
                   |----  A66PV                               External             
                   |----  A65PV                               External             
                   |----  A64PV                               External             
                   |----  A63PV                               External             
                   |----  A62PV                               External             
                   |----  A60PV                               External             
                   |----  A59PV                               External             
                   |----  A58PV                               External             
                   |----  A57PV                               External             
                   |----  A56PV                               External             
                   |----  A55PV                               External             
                   |----  A54PV                               External             
                   |----  A53PV                               External             
                   |----  A52PV                               External             
                   |----  A50PV                               External             
                   |----  A49PV                               External             
                   |----  A48PV                               External             
                   |----  A47PV                               External             
                   |----  A46PV                               External             
                   |----  A45PV                               External             
                   |----  A44PV                               External             
                   |----  A43PV                               External             
                   |----  A42PV                               External             
                   |----  A40PV                               External             
                   |----  A39PV                               External             
                   |----  A38PV                               External             
                   |----  A37PV                               External             
                   |----  A36PV                               External             
                   |----  A35PV                               External             
                   |----  A34PV                               External             
                   |----  A33PV                               External             
                   |----  A32PV                               External             
                   |----  A30PV                               External             
                   |----  A29PV                               External             
                   |----  A28PV                               External             
                   |----  A27PV                               External             
                   |----  A26PV                               External             
                   |----  A25PV                               External             
                   |----  A24PV                               External             
                   |----  A23PV                               External             
                   |----  A22PV                               External             
                   |----  A20PV                               External             
                   |----  A19PV                               External             
                   |----  A18PV                               External             
                   |----  A17PV                               External             
                   |----  A16PV                               External             
                   |----  A15PV                               External             
                   |----  A14PV                               External             
                   |----  A13PV                               External             
                   |----  A12PV                               External             
                   |----  A10PV                               External             
                   |----  A9PV                                External             
                   |----  A8PV                                External             
                   |----  A7PV                                External             
                   |----  A6PV                                External             
                   |----  A5PV                                External             
                   |----  A4PV                                External             
                   |----  A3PV                                External             
                   |----  A2PV                                External             
                   |----  HFIND                               External             
                   |----  HFN                                 External             
   
 
3 QHFNR
         SUBROUTINE QHFNR(ID,A1 ,A2 ,A3 ,A4 ,A5 ,A6 ,A7 ,A8 ,A9 ,A10,
  ------------------------------------------------------------------------------
    CKEY HIST /USER
  ------------------------------------------------------------------------------
        1                    A11,A12,A13,A14,A15,A16,A17,A18,A19,A20,
        2                    A21,A22,A23,A24,A25,A26,A27,A28,A29,A30,
        3                    A31,A32,A33,A34,A35,A36,A37,A38,A39,A40,
        4                    A41,A42,A43,A44,A45,A46,A47,A48,A49,A50,
        2                    A51,A52,A53,A54,A55,A56,A57,A58,A59,A60,
        3                    A61,A62,A63,A64,A65,A66,A67,A68,A69,A70,
        4                    A71,A72,A73,A74,A75,A76,A77,A78,A79,A80)
   Fill n-tuple with variable number of arguments + run, event #
     Input:          ID           N-tuple  identifier
                     A1,...,A80   elements of N-tuple
     Calls           HGIVEN  from HBOOK
     Author:     D.Schlatter    1.89
     Modified:   F.Ranjard      3.93
                 use HGIVEN instead of NOARG on all machines
     Modified:   J.Boucrot     11.94
                 extend to 80 arguments
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
              QHFNR                                                                
                   |----  HGIVEN                              External             
                   |----  QWMESS                                                   
                   |----  A80PV                               External             
                   |----  A79PV                               External             
                   |----  A78PV                               External             
                   |----  A77PV                               External             
                   |----  A76PV                               External             
                   |----  A75PV                               External             
                   |----  A74PV                               External             
                   |----  A73PV                               External             
                   |----  A72PV                               External             
                   |----  A70PV                               External             
                   |----  A69PV                               External             
                   |----  A68PV                               External             
                   |----  A67PV                               External             
                   |----  A66PV                               External             
                   |----  A65PV                               External             
                   |----  A64PV                               External             
                   |----  A63PV                               External             
                   |----  A62PV                               External             
                   |----  A60PV                               External             
                   |----  A59PV                               External             
                   |----  A58PV                               External             
                   |----  A57PV                               External             
                   |----  A56PV                               External             
                   |----  A55PV                               External             
                   |----  A54PV                               External             
                   |----  A53PV                               External             
                   |----  A52PV                               External             
                   |----  A50PV                               External             
                   |----  A49PV                               External             
                   |----  A48PV                               External             
                   |----  A47PV                               External             
                   |----  A46PV                               External             
                   |----  A45PV                               External             
                   |----  A44PV                               External             
                   |----  A43PV                               External             
                   |----  A42PV                               External             
                   |----  A40PV                               External             
                   |----  A39PV                               External             
                   |----  A38PV                               External             
                   |----  A37PV                               External             
                   |----  A36PV                               External             
                   |----  A35PV                               External             
                   |----  A34PV                               External             
                   |----  A33PV                               External             
                   |----  A32PV                               External             
                   |----  A30PV                               External             
                   |----  A29PV                               External             
                   |----  A28PV                               External             
                   |----  A27PV                               External             
                   |----  A26PV                               External             
                   |----  A25PV                               External             
                   |----  A24PV                               External             
                   |----  A23PV                               External             
                   |----  A22PV                               External             
                   |----  A20PV                               External             
                   |----  A19PV                               External             
                   |----  A18PV                               External             
                   |----  A17PV                               External             
                   |----  A16PV                               External             
                   |----  A15PV                               External             
                   |----  A14PV                               External             
                   |----  A13PV                               External             
                   |----  A12PV                               External             
                   |----  A10PV                               External             
                   |----  A9PV                                External             
                   |----  A8PV                                External             
                   |----  A7PV                                External             
                   |----  A6PV                                External             
                   |----  A5PV                                External             
                   |----  A4PV                                External             
                   |----  A3PV                                External             
                   |----  A2PV                                External             
                   |----  HFIND                               External             
                   |----  QHFR                                                     
   
 
3 QHFR
          SUBROUTINE QHFR(ID,X)
  ------------------------------------------------------------------------------
    CKEY HIST /USER
  ------------------------------------------------------------------------------
   Fill ntuples adding the run and event # as two last variables
   Authors  V. Journe - J. Boucrot       10-Nov-1988
    from USER
     HFN                                    from HBOOK4 Lib
    Input arguments :
    ID  =  Ntuple identifier ( must be # 0 )
     X  =  1-Dim array containing the NVAR values for this filling
     To benefit from this facility , the booking of the Ntuple
    have been done by the routine QBOOKR (from ALPHA package ).
   ATION : Do not define Ntuples with more than 80 variables
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   QHFNR                                                                           
        |---- QHFR                                                                 
                   |----  UCOPY                               External             
                   |----  FLOAT                               External             
                   |----  HFN                                 External             
   
 
3 QLMINRP
         SUBROUTINE QLMINRP(XLUMRMP,NBHAMR)
  ------------------------------------------------------------------------------
    CKEY RUN /INTERNAL
  ------------------------------------------------------------------------------
   Gives the lumi with miniramp for the current run
    from QMNEWR
    XLUMRMP = Lumi with Mini-Ramp
                   = -1. if not relevant
           NBHAMR  = Number of Bhabhas
                                                J.Boucrot  07.06.2000
   
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   QMNEWR                                                                          
        |---- QLMINRP                                                              
                   |----  SIGN                                External             
                   |----  SQRT                                External             
                   |----  ABS                                 External             
                   |----  NINT                                External             
                   |----  KMATIX                              External             
                   |----  ATG                                 External             
                   |----  KCLARM                              External             
                   |----  IAND                                External             
                   |----  KLOCK0                              External             
                   |----  IABS                                External             
                   |----  NAMIND                              External             
   
 
3 QMAIN
         PROGRAM QMAIN
  ------------------------------------------------------------------------------
    CKEY PACK /INTERNAL
  ------------------------------------------------------------------------------
   Main program
                                                      H.Albrecht 20.09.88
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
              QMAIN                                                                
                   |----  QMINIT                                                   
                   |----  QMREAD                                                   
                   |----  ABRUEV                              External             
                   |----  QMEVNT                                                   
   
 
3 QMALPH
         SUBROUTINE QMALPH
  ------------------------------------------------------------------------------
    CKEY INIT /INTERNAL
  ------------------------------------------------------------------------------
   Initialise alpha
    called from QMINIT
                                                     H.Albrecht 20.09.88
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   QMINIT                                                                          
        |---- QMALPH                                                               
                   |----  QSBANK                                                   
                   |----  NBANK                               External             
                   |----  AUBOS                               External             
                   |----  BKINCA                              External             
   
 
3 QMBANK
         SUBROUTINE QMBANK (CNAM, CTEXT, ARRAY, LENGTH)
  ------------------------------------------------------------------------------
    CKEY CARD /INTERNAL
  ------------------------------------------------------------------------------
   Copy bank cnam (e.g. given by data cards) into array(length)
    Bank CNAM is assumed to exist only once. QMBANK should be called
    only once for a given bank as the bank is dropped afterwards.
    If bank CNAM does not exist, the content of ARRAY is unchanged.
    Called from anywhere.
                                        Modified: E. Blucher, 27.04.89
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   QFECAL                                                                          
   QFHCAL                                                                          
        |---- QMBANK                                                               
                   |----  NAMIND                              External             
                   |----  MIN0                                External             
                   |----  NDROP                               External             
                   |----  QWMESS                                                   
   
 
3 QMCARD
         SUBROUTINE QMCARD
  ------------------------------------------------------------------------------
    CKEY INIT CARDS /INTERNAL
  ------------------------------------------------------------------------------
   Read and interpret cards
    from QMINIT
                                                     H.Albrecht 06.11.88
                                           Mod       E. Blucher 02.02.92
                                           Mod       F. Ranjard 01.07.92
                                           Mod       G. Graefe  10.02.95
                                           Mod       T.Oest     26.07.95
                                           Mod       J.Boucrot  23.10.98
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   QMINIT                                                                          
        |---- QMCARD                                                               
                   |----  GETENV                              External             
                   |----  QPVMCD                                                   
                   |----  MRESET                              External             
                   |----  BREADC                              External             
                   |----  NAMIND                              External             
                   |----  QWMESS                                                   
                   |----  ACDARG                              External             
                   |----  QWERRC                                                   
                   |----  AOPEN                               External             
                   |----  QWSYNT                                                   
                   |----  QMININC                                                  
                   |----  QMTERM                                                   
                   |----  ACARD1                              External             
                   |----  FLOAT                               External             
                   |----  AFILOU                              External             
                   |----  ACARD2                              External             
                   |----  NLINK                               External             
                   |----  AINQUI                              External             
                   |----  AUBOS                               External             
                   |----  QMCFRF                                                   
                   |----  BLIST                               External             
                   |----  BDROP                               External             
   
 
3 QMCFRF
         SUBROUTINE QMCFRF
  ------------------------------------------------------------------------------
    CKEY INIT CARDS /INTERNAL
  ------------------------------------------------------------------------------
   Read and interpret frxy data cards
    from QMCARD
                                                     J.Boucrot  23.02.98
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   QMCARD                                                                          
        |---- QMCFRF                                                               
                   |----  ACARD1                              External             
                   |----  QMTERM                                                   
   
 
3 QMCHI2
         FUNCTION QMCHI2 (ITK, CPAR)
  ------------------------------------------------------------------------------
    CKEY PART /USER
  ------------------------------------------------------------------------------
   Chi**2 from mass difference
                                                     H.Albrecht 11.01.90
     Bug fixed                                       J.Boucrot  01.11.94
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   KVFITA                                                                          
   KVFITM                                                                          
        |---- QMCHI2                                                               
                   |----  SIGN                                External             
                   |----  SQRT                                External             
                   |----  ABS                                 External             
                   |----  NINT                                External             
                   |----  KMATIX                              External             
                   |----  ATG                                 External             
                   |----  KCLARM                              External             
                   |----  IAND                                External             
                   |----  KLOCK0                              External             
                   |----  IABS                                External             
                   |----  KPART                                                    
   
 
3 QMCLR
         SUBROUTINE QMCLR
  ------------------------------------------------------------------------------
    CKEY INIT /INTERNAL
  ------------------------------------------------------------------------------
   Clear alpha banks, commons, etc.
    called from : QMREAD
    calls : none
                                                     H.Albrecht 20.09.88
                                        Modified:    E.Blucher  31.01.92
                                        Modified:    J.Boucrot  08.10.93
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   QFILL                                                                           
   QMNEWR                                                                          
   QMRDSB                                                                          
        |---- QMCLR .                                                              
   
 
3 QMDBAS
         SUBROUTINE QMDBAS
  ------------------------------------------------------------------------------
    CKEY PART /INTERNAL
  ------------------------------------------------------------------------------
   Read in short-term database
    called from QMINIT
                                                     E.Blucher  03.04.90
    1991/93 old beam positions now read by getbp     J. Boucrot 24.09.98
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   QMINIT                                                                          
        |---- QMDBAS                                                               
                   |----  BKFMT                               External             
                   |----  AOPEN                               External             
                   |----  MRESET                              External             
                   |----  BREADC                              External             
                   |----  QWMESS                                                   
   
 
3 QMDIFF
         FUNCTION QMDIFF (ITK, CPAR)
  ------------------------------------------------------------------------------
    CKEY PART /USER
  ------------------------------------------------------------------------------
   Mass difference
                                                     H.Albrecht 11.01.90
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
              QMDIFF.                                                              
   
 
3 QMEVNT
         SUBROUTINE QMEVNT(IRUN,IEVT)
  ------------------------------------------------------------------------------
    CKEY EVENT /INTERNAL
  ------------------------------------------------------------------------------
   Event processing
    called from QMAIN
                                                     H.Albrecht 20.09.88
                                                     J.Boucrot  10.01.99
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   QMAIN                                                                           
        |---- QMEVNT                                                               
                   |----  QUREFIT                                                  
                   |----  FIXPECO                                                  
                   |----  FIXPCRL                                                  
                   |----  QWRITE                                                   
                   |----  NAMIND                              External             
                   |----  QFILL                                                    
                   |----  MQUEVNT                                                  
                   |----  QUEVNT                                                   
   
 
3 QMIHIS
         SUBROUTINE QMIHIS
  ------------------------------------------------------------------------------
    CKEY INIT HIST /INTERNAL
  ------------------------------------------------------------------------------
   Initialize histogram package
    from QUIHIS
                                                     H.Albrecht 20.09.88
                     Options NREC and RECL added     O.Schneider 1.06.94
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
              QMIHIS                                                               
                   |----  ACARD1                              External             
                   |----  ACARD2                              External             
                   |----  HTITLE                              External             
                   |----  ACDARG                              External             
                   |----  QWMESS                                                   
                   |----  CUTOL                               External             
                   |----  QWERRC                                                   
                   |----  INDEX                               External             
                   |----  ADSPOS                              External             
                   |----  ACARD3                              External             
                   |----  QWSYNT                                                   
                   |----  MIN0                                External             
                   |----  MAX0                                External             
                   |----  AINQUI                              External             
                   |----  SYSTEM                              External             
                   |----  LNBLNK                              External             
                   |----  HROPEN                              External             
                   |----  HRIN                                External             
                   |----  HINDEX                              External             
   
 
3 QMININC
         SUBROUTINE QMININC(IER)
  ------------------------------------------------------------------------------
    CKEY INIT CARDS /INTERNAL
  ------------------------------------------------------------------------------
   Data cards default initialisation for official mini making
    Called from QMCARD
       Author: J. Boucrot       23-Sep-98
    argument :
    IER = 0 if all OK
        = 1 if no room to book banks
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   QMCARD                                                                          
        |---- QMININC                                                              
                   |----  NAMIND                              External             
                   |----  BDROP                               External             
                   |----  QWMESS                                                   
                   |----  AUBOS                               External             
                   |----  BKFMT                               External             
                   |----  INTCHA                              External             
   
 
3 QMINIT
         SUBROUTINE QMINIT
  ------------------------------------------------------------------------------
    CKEY INIT /INTERNAL
  ------------------------------------------------------------------------------
   Initialize analysis job
    called from QMAIN
                                                     H.Albrecht 20.09.88
                                             Modified E.Blucher 03.09.89
                                             Modified G.Graefe  02.10.95
                                             Modified T.Oest    26.07.95
    Y2K mods and call to qmstgin             Modified J.Boucrot 14.01.00
    call to adbchk added                     Modified J.Boucrot 21.06.01
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   QMAIN                                                                           
        |---- QMINIT                                                               
                   |----  QDATA                                                    
                   |----  QPVMIS                                                   
                   |----  QAINTA                                                   
                   |----  QADATI                                                   
                   |----  QUIBOS                                                   
                   |----  QUOPEN                                                   
                   |----  ALFMT                               External             
                   |----  QMNAMI                                                   
                   |----  QMCARD                                                   
                   |----  QMALPH                                                   
                   |----  QMDBAS                                                   
                   |----  QWMESS                                                   
                   |----  JUNIDB                              External             
                   |----  AOPDBS                              External             
                   |----  ADBSWP                              External             
                   |----  MDARD                               External             
                   |----  NLINK                               External             
                   |----  NAMIND                              External             
                   |----  QMTERM                                                   
                   |----  LNBLNK                              External             
                   |----  ADBVER                              External             
                   |----  ADBCHK                              External             
                   |----  QMPART                                                   
                   |----  QPVMIM                                                   
                   |----  QMSTGIN                                                  
                   |----  QUIHIS                                                   
                   |----  MINFMT                                                   
                   |----  QNINIT                                                   
                   |----  YTIJOB                              External             
                   |----  EBINIT                              External             
                   |----  MQUINIT                                                  
                   |----  QUINIT                                                   
                   |----  TIMEX                               External             
   
 
3 QMNAMI
         SUBROUTINE QMNAMI
  ------------------------------------------------------------------------------
    CKEY INIT /INTERNAL
  ------------------------------------------------------------------------------
   Define name indices
    called from QMINIT
                                                   D. Schlatter 26.06.88
                                                     H.Albrecht 20.09.88
                                                        M.Talby 15.02.89
                                                      E.Blucher 10.04.89
                                                      E.Blucher 01.08.90
                                                      E.Blucher 05.05.91
                                                      E.Blucher 31.01.92
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   QMINIT                                                                          
        |---- QMNAMI                                                               
                   |----  NAMIND                              External             
   
 
3 QMNEWR
         SUBROUTINE QMNEWR (IROLD,IRNEW)
  ------------------------------------------------------------------------------
    CKEY RUN /INTERNAL
  ------------------------------------------------------------------------------
   Called for new run
    called from QMREAD,QMTERM
                                            Author: H.Albrecht 20.09.88
                                          Modified: E.Blucher  03.08.90
                                          Modified: J.Boucrot  03.05.93
                                          Modified: G.Graefe   10.02.95
                                          Modified: S.Wasserb. 10.05.95
                                          Modified: J.Boucrot. 24.09.98
                                          Modified: J.Boucrot. 08.06.00
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   ABOLDR                                                                          
   QMRDSB                                                                          
   QMTERM                                                                          
        |---- QMNEWR                                                               
                   |----  QMCLR                                                    
                   |----  PRRHAH                              External             
                   |----  QRKSEC                                                   
                   |----  MDARD                               External             
                   |----  INTCHA                              External             
                   |----  IAND                                External             
                   |----  FIXPART                                                  
                   |----  GETLEP                              External             
                   |----  BDROP                               External             
                   |----  GETLUM                              External             
                   |----  GETSLU                              External             
                   |----  QLMINRP                                                  
                   |----  NAMIND                              External             
                   |----  QBOMRU                                                   
                   |----  ALFIEL                              External             
                   |----  CHAINT                              External             
                   |----  INDEX                               External             
                   |----  QMUNEW                                                   
                   |----  YTOIRU                              External             
                   |----  QLINIT                                                   
                   |----  BLIST                               External             
                   |----  VRDDAF                              External             
                   |----  VGRDAL                              External             
                   |----  QNNEWR                                                   
                   |----  MQUNEWR                                                  
                   |----  QUNEWR                                                   
   
 
3 QMPART
         SUBROUTINE QMPART
  ------------------------------------------------------------------------------
    CKEY PART /INTERNAL
  ------------------------------------------------------------------------------
   Particle table initialization
    called from QMINIT
                                                     H.Albrecht 06.11.88
                                                     E.Blucher  10.05.89
    Mod. I.Tomalin 16/5/96
     Create QPSP bank before PMOD card unpacked.
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   QMINIT                                                                          
        |---- QMPART                                                               
                   |----  MDARD                               External             
                   |----  BSWAP                               External             
                   |----  QSBANK                                                   
                   |----  NLINK                               External             
                   |----  ALSTIN                              External             
                   |----  CLTOU                               External             
                   |----  INTCHA                              External             
                   |----  ALINST                              External             
                   |----  SORTIQ                              External             
                   |----  ACARD1                              External             
                   |----  MIN                                 External             
                   |----  CHAINT                              External             
                   |----  QCPNEW                                                   
                   |----  QCPMOD                                                   
                   |----  QCPTRA                                                   
                   |----  QWSYNT                                                   
   
 
3 QMRDSB
         SUBROUTINE QMRDSB(IEND)
  ------------------------------------------------------------------------------
    CKEY EVENT /INTERNAL
  ------------------------------------------------------------------------------
   Read next event.
    called from QMREAD
                                          Author:    H.Albrecht 20.09.88
                                          Modified:  E.Blucher  01.06.89
                                          Modified:  M.Talby    17.07.89
                                          Modified:  E.Blucher  27.07.90
                                          Modified:  G.Graefe   13.07.94
                                          Modified:  T.Oest     26.07.95
                                          Modified:  I.Tomalin  14.05.97
                                          Modified:  J.Boucrot  21.06.01
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   QMREAD                                                                          
        |---- QMRDSB                                                               
                   |----  ABRSEL                              External             
                   |----  ABGTCL                              External             
                   |----  ALVSN                               External             
                   |----  QMTERM                                                   
                   |----  QMCLR                                                    
                   |----  IGTLEN                              External             
                   |----  CHKCLAS                             External             
                   |----  ABGTRCL                             External             
                   |----  ABRUEV                              External             
                   |----  ALEVNUM                             External             
                   |----  QWMESE                                                   
                   |----  ABOLDR                                                   
                   |----  QMNEWR                                                   
                   |----  QPVMES                                                   
                   |----  QWRUNR                                                   
                   |----  QMSREC                                                   
                   |----  ABSEVT                              External             
                   |----  QWRITE                                                   
                   |----  ABCLAS                              External             
                   |----  QPVMGT                                                   
   
 
3 QMREAD
         SUBROUTINE QMREAD
  ------------------------------------------------------------------------------
    CKEY EVENT /INTERNAL
  ------------------------------------------------------------------------------
   Calling routine for qmrdsb, qmterm
   
      Author   :- E. Blucher     27-JUL-1990
      Description
      ===========
    Calls QMRDSB and QMTERM.  Added for compatability with
    interactive ALPHA.
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   QMAIN                                                                           
        |---- QMREAD                                                               
                   |----  QMRDSB                                                   
                   |----  QMTERM                                                   
   
 
3 QMSREC
         SUBROUTINE QMSREC
  ------------------------------------------------------------------------------
    CKEY RUN /INTERNAL
  ------------------------------------------------------------------------------
   Called for "unknown" record types (slow control, end-of-run)
    from QMREAD
                                           Author: E.Blucher  10.09.89
    Modified for MINI end-of-run records           J.Boucrot  10.01.99
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   QMRDSB                                                                          
        |---- QMSREC                                                               
                   |----  MQUSREC                                                  
                   |----  QUSREC                                                   
   
 
3 QMSTCLR
         SUBROUTINE QMSTCLR
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Stage clear all tapes/files from 'fili' cards if sclr card present
    J. Boucrot        14-Feb-2000
    Called from QMTERM
    Calls ALSTIN,BKINCA                          from ALEPHLIB
    Input bank needed :  'FILI'  ( from BOS data cards )
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   QMTERM                                                                          
        |---- QMSTCLR                                                              
                   |----  NAMIND                              External             
                   |----  ALSTIN                              External             
                   |----  QANFILI                                                  
                   |----  BKINCA                              External             
                   |----  LNBLNK                              External             
                   |----  SYSTEM                              External             
                   |----  AOPEN                               External             
                   |----  IW                                  External             
   
 
3 QMSTGIN
         SUBROUTINE QMSTGIN
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Stage all tapes/files from 'fili' cards if stgi card present
    J. Boucrot        14-Mar-2000
    Called from QMINIT
    Calls ALSTIN,BKINCA                          from ALEPHLIB
    Input bank needed :  'FILI'  ( from BOS data cards )
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   QMINIT                                                                          
        |---- QMSTGIN                                                              
                   |----  NAMIND                              External             
                   |----  ALSTIN                              External             
                   |----  QANFILI                                                  
                   |----  BKINCA                              External             
                   |----  IW                                  External             
                   |----  MIN0                                External             
                   |----  IFLMI                               External             
                   |----  MAX0                                External             
                   |----  IFLMX                               External             
                   |----  LNBLNK                              External             
                   |----  SYSTEM                              External             
   
 
3 QMTERM
         SUBROUTINE QMTERM (TEXT)
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   ALPHA TERM /INTERNAL
   System termination
    from anywhere
    : QUTERM (user routine)
    : QUTHIS (histogram output)
                                                     H.Albrecht 20.09.88
                                     Modified:       E.Blucher  17.04.90
                                     Modified:       G.Graefe   10.02.95
                            Modified for PVM on SAGA T. Oest    26.07.95
                            Add call to QMSTCLR      J.Boucrot  14.02.00
                            Add call to QTKIREV      J.Boucrot   5.02.01
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   KSCNEW                                                                          
   KTLORX                                                                          
   QBOOKR                                                                          
   QFILMC                                                                          
   QMCARD                                                                          
   QMCFRF                                                                          
   QMINIT                                                                          
   QMRDSB                                                                          
   QMREAD                                                                          
   QUEVNT                                                                          
   QUREFIT                                                                         
   QVADD2                                                                          
   QVADDN                                                                          
   QVCROS                                                                          
   QVSUB                                                                           
   QWSYNT                                                                          
   GTIPBK                                                                          
   QSMEAR                                                                          
   QVSWBK                                                                          
   KVFITC                                                                          
   KVFITN                                                                          
   KVFITV                                                                          
   KVFTMC                                                                          
   QDEDXK                                                                          
   QJOPTM                                                                          
   QJOPTR                                                                          
   QJSET0                                                                          
   QJSET1                                                                          
   QKBLOK                                                                          
        |---- QMTERM                                                               
                   |----  QWMESS                                                   
                   |----  QPVMEN                                                   
                   |----  TIMEX                               External             
                   |----  QMNEWR                                                   
                   |----  MQUTERM                                                  
                   |----  QUTERM                                                   
                   |----  QWPARS                                                   
                   |----  QMSTCLR                                                  
                   |----  QNTERM                                                   
                   |----  QUTHIS                                                   
                   |----  BOSTA                               External             
                   |----  ABWEND                              External             
                   |----  QLTERM                                                   
                   |----  QWFILE                                                   
                   |----  QWSUMM                                                   
                   |----  QTIMEZ                                                   
                   |----  QWTIME                                                   
                   |----  QTKIREV                                                  
                   |----  QPVMTE                                                   
                   |----  ACLOSE                              External             
                   |----  QPVMEX                                                   
   
 
3 QNVSTO
         SUBROUTINE QNVSTO(IFLAG,IVV,INTR,NOUT,IOUTT,XYZ,CHI2,IVOU)
  ------------------------------------------------------------------------------
    CKEY FILL VERTEX   /INTERNAL
  ------------------------------------------------------------------------------
   Stores a new vertex from new tracking
      Author   :  J. Boucrot                    21-Apr-1997
      Called from QFNINT or QFKINK
    Input arguments:
     IFLAG  = vertex category ( 4 for Nucl Int, 5 for Kinks)
        IVV = Row number of the vertex in the original bank
       INTR = ALPHA track number of incoming track, if any
       NOUT = number of outgoing tracks
      IOUTT = list of ALPHA numbers for the outgoing tracks
        XYZ = vertex coordinates
       CHI2 = chisquare of vertex fit
      Output :
           - new vertex IVOU in QVRT is created.
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   QFKINK                                                                          
   QFNINT                                                                          
        |---- QNVSTO                                                               
                   |----  SIGN                                External             
                   |----  SQRT                                External             
                   |----  ABS                                 External             
                   |----  NINT                                External             
                   |----  KMATIX                              External             
                   |----  ATG                                 External             
                   |----  KCLARM                              External             
                   |----  IAND                                External             
                   |----  KLOCK0                              External             
                   |----  IABS                                External             
                   |----  QSBANK                                                   
                   |----  QAMOTH                                                   
                   |----  QADAU                                                    
   
 
3 QPCHAR
         FUNCTION QPCHAR (CPAR)
  ------------------------------------------------------------------------------
    CKEY PART /USER
  ------------------------------------------------------------------------------
   Particle mass
                                                     H.Albrecht 27.11.88
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
              QPCHAR                                                               
                   |----  KPART                                                    
   
 
3 QPLIFE
         FUNCTION QPLIFE (CPAR)
  ------------------------------------------------------------------------------
    CKEY PART /USER
  ------------------------------------------------------------------------------
   Particle life time
                                                     H.Albrecht 27.11.88
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
              QPLIFE                                                               
                   |----  KPART                                                    
   
 
3 QPMASS
         FUNCTION QPMASS (CPAR)
  ------------------------------------------------------------------------------
    CKEY PART /USER
  ------------------------------------------------------------------------------
   Particle mass
                                                     H.Albrecht 27.11.88
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   NADDXM                                                                          
   NMTAIL                                                                          
   QSELEP                                                                          
   QBMTAG                                                                          
   QDEDXM                                                                          
   QMTAIL                                                                          
        |---- QPMASS                                                               
                   |----  KPART                                                    
   
 
3 QPPMMA
         FUNCTION QPPMMA (CINP)
  ------------------------------------------------------------------------------
    CKEY PART /INTERNAL
  ------------------------------------------------------------------------------
   Get from part the mass of particle with name cinp
    Called from KPCOMP
                                                   J.Boucrot  11.04.96
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   KPCOMP                                                                          
   KPCHEK                                                                          
        |---- QPPMMA                                                               
                   |----  CLTOU                               External             
                   |----  ALSTIN                              External             
   
 
3 QPWIDT
         FUNCTION QPWIDT (CPAR)
  ------------------------------------------------------------------------------
    CKEY PART /USER
  ------------------------------------------------------------------------------
   Particle width
                                                     H.Albrecht 27.11.88
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
              QPWIDT                                                               
                   |----  KPART                                                    
   
 
3 QRKSEC
         SUBROUTINE QRKSEC
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
    the generated cross-section from bank RKSE
    the ru presently analyzed,
    for the whole dataset
    are transmitted into the common /XKSECS/
   Author J. Boucrot 26-10-2000
    J. Boucrot 31-01-2002 fix for same Ranmar seeds
    B. Bloch   24-09-2002 fix for banks on the ADBSCONS DAF
    J. Boucrot 11-10-2002 replace Kingal code 5030 by 5300
   
   -------------------- /QCDE/ --- COMMONs, DIMENSIONs, etc. ------------
   
    of QCDESH ----------------------- Description in QDATA ---------
         PARAMETER (KCQDET=34, KCQFPA=8, KCQPAR=10, KCQVEC=73, KCQVRT=30,
        & KHE=1, KHMU=2, KHPI=3, KHK=4, KHP=5, KHPHOT=1, KHNHAD=2,
        & KMONTE=-2, KRECO=-1, KLOCKM=14, KSOVT=1, KSCHT=2, KSIST=3,
        & KSAST=4, KSEHT=5, KSV0T=6, KSDCT=7, KSEFT=8, KSNET=9, KSGAT=10,
        & KSJET=11, KSMCT=12, KSREV=13,
        & KSMCV=14, KUNDEF=-12344321, QQPI=3.141593, QQE=2.718282,
        & QQ2PI=QQPI*2., QQPIH=QQPI/2., QQRADP=180./QQPI, QQC=2.997925E10,
        & QQH=6.582173E-25, QQHC=QQH*QQC, QQIRP=.00029979)
         CHARACTER CQDATE*8, CQDWRK*80, CQFHIS*80, CQFOUT*80, CQFWRK*80,
        & CQHTIT*80, CQSEC*3, CQTIME*8, CQUNPK*30, CQVERS*6, CQRLST*800,
        & CQELST*800
         COMMON /QCDEC/ CQDATE, CQDWRK, CQFHIS, CQFOUT, CQFWRK, CQHTIT,
        & CQSEC(14), CQTIME, CQUNPK, CQVERS, CQRLST, CQELST
         COMMON /QCDE/ QELEP, QMFLD ,QMFLDC, QTIME, QTIMEI, QTIMEL,
        & QTIMES, QTIMET, QDHEEC, QDHEEL, QDHEPF, QDHETH, QDHEPH, QDHEEF,
        & QDHEET, QDHET1, QDHEP1, QDHET2, QDHEP2, QDHEE1, QDHEE2, QDHEE3,
        & QKEVRN, QKEVWT, QVXNOM, QVYNOM, QVZNOM, QVXNSG, QVYNSG, QVZNSG,
        & QINLUM, QRINLN, QRINLU, QDBOFS, QEECWI(36), QVXBOM, QVYBOM,
        & QSILUM, QRSLLU, QRSLBK, QRSLEW , QVTXBP(3), QVTEBP(3), QVTSBP(3)
         COMMON /QCDE/  KFOVT, KLOVT, KNOVT, KFCHT, KLCHT, KNCHT, KFIST,
        & KLIST, KNIST, KFAST, KLAST, KNAST, KFEHT, KLEHT, KNEHT, KFV0T,
        & KLV0T, KNV0T, KFDCT, KLDCT, KNDCT, KFEFT, KLEFT, KNEFT, KFNET,
        & KLNET, KNNET, KFGAT, KLGAT, KNGAT, KFJET, KLJET, KNJET, KFMCT,
        & KLMCT, KNMCT, KFREV, KLREV, KNREV, KFMCV, KLMCV, KNMCV, KLUST,
        & KLUSV, KFFRT, KLFRT, KFFRV, KLFRV, KNRET, KNCOT, KFFRD,
        & KLFJET,KLLJET,KLNJET
         COMMON /QCDE/ KBIT(32), KCLACO(KCQFPA), KCLAFR(KCQFPA), KCLARM
        & (KCQFPA), KDEBUG, KEVT, KEXP, KFFILL, KFEOUT, KJOPTN(2,2),
        & KLEOUT, KLROUT, KLOCK0(KLOCKM,2), KLOCK1(KLOCKM,2), KLOCK2(
        & KLOCKM,2), KMATIX(6,6), KMQFPA, KNEFIL, KNEOUT, KNEVT, KNPAST,
        & KNQDET, KNQFPA, KNQLIN, KNQMTX, KNQPAR, KNQPST, KNREIN, KNREOU,
        & KOQDET, KOQFPA, KOQLIN, KOQMTL, KOQMTS, KOQPAR, KOQPBT, KOQPLI,
        & KOQTRA, KOQVEC, KOQVRT, KQPAR, KQVEC, KQVRT, KQWRK, KQZER, KRUN,
        & KSTATU, KTDROP, KUCARD, KUCONS, KUHIST, KUINPU, KUOUTP, KUPRNT,
        & KUPTER, KDEBU1, KDEBU2, KNWRLM, KEFOPT, KUEDIN, KUEDOU, KURTOX,
        & KUCAR2, KNHDRN, KNBHAB, KSBHAB, KRSLLQ, KRSLNB
         COMMON /QCDE/ INDATA
         COMMON /QCDE/ KRINNE, KRINNF, KRINDC, KRINDQ, KRINNZ, KRINNB,
        & KRINBM, KRINFR, KRINLR, KRINLF
         COMMON /QCDE/ KEVERT, KEVEDA, KEVETI, KEVEMI(4), KEVETY, KEVEES,
        & KDHEFP, KDHENP, KDHENM, KKEVNT, KKEVNV, KKEVID, KDHENX, KDHENV,
        & KDHENJ, KREVDS, KXTET1, KXTET2, KXTEL2, KXTCGC, KXTCLL, KXTCBN,
        & KXTCCL, KXTCHV, KXTCEN, KCLASW, KERBOM, KBPSTA
         DIMENSION KLOCUS(3,14)
         EQUIVALENCE (KLOCUS(1,1),KFOVT), (KFOVT,KFRET), (KLIST,KLRET),
        & (KFIST,KFCOT), (KLAST,KLCOT)
         COMMON /QCDE/ XCOPYJ, XFLIAC, XHISTO, XLREV(2), XLREV2(2), XMCEV,
        & XMINI, XSYNTX, XWREVT, XWRRUN, XFILMC, XFILCH, XFILV0, XFILCO,
        & XFILEF, XFILPC, XFILGA, XFILJE,
        & XPRHIS, XFILL, XVITC, XVTPC, XVECAL, XVLCAL, XVTPCD,
        & XVSATR, XVHCAL, XHVTRG, XSREC, XWMINI, XIOKLU, XIOKSI, XFRF2,
        & XNSEQ, XVDOK, XFRF0, XFMUID, XFILEM, XWNANO, XROKSI, XGETBP,
        & XJTHRU
         LOGICAL XCOPYJ, XFLIAC, XHISTO, XLREV, XLREV2, XMCEV, XMINI,
        & XSYNTX, XWREVT, XWRRUN, XFILMC, XFILCH, XFILV0, XFILCO, XFILEF,
        & XFILPC, XPRHIS, XFILL, XVITC, XVTPC, XVECAL, XVLCAL, XVTPCD,
        & XVSATR, XVHCAL, XHVTRG, XSREC, XWMINI, XIOKLU, XFRF2, XFILJE,
        & XNSEQ, XFILGA, XVDOK, XFRF0, XFMUID, XFILEM, XWNANO, XIOKSI,
        & XROKSI, XGETBP, XJTHRU
   
   -------------------- /NANCOM/ --- NanoDst steering -------------------
   Xnano   .true. if input is a nanodst (in nano or epio format, depending
                      XNANOR)
   
         LOGICAL XNANO
         COMMON /NANCOM/XNANO
   
   
    bcs
         INTEGER LMHLEN, LMHCOL, LMHROW
         PARAMETER (LMHLEN=2, LMHCOL=1, LMHROW=2)
         COMMON /BCS/   IW(1000)
         INTEGER IW
         REAL RW(1000)
         EQUIVALENCE (RW(1),IW(1))
   
   
   ------------------ /QCNAMI/ --- name indices -------------------------
         COMMON /QCNAMI/ NAAFID,NAAJOB,NAASEV,NABCNT,NABHIT,NABOMB,
        1 NABOME,NABOMP,NABOMR,NABPTR,NADCAL,NADCRL,NADECO,NADEID,NADENF,
        2 NADEVT,NADEWI,NADFMC,NADFOT,NADGAM,NADHCO,NADHEA,NADHRL,NADJET,
        3 NADMID,NADMJT,NADMUO,NADNEU,NADPOB,NADRES,NADTBP,NADTMC,NADTRA,
        4 NADVER,NADVMC,NAECRQ,NAECTE,NAEGID,NAEGPC,NAEIDT,NAEJET,NAERRF,
        5 NAETDI,NAETKC,NAEVEH,NAEWHE,NAFICL,NAFKIN,NAFPOI,NAFPOL,NAFRFT,
        6 NAFRID,NAFRTL,NAFSTR,NAFTCL,NAFTCM,NAFTOC,NAFTTM,NAFVCL,NAFVER,
        7 NAFZFR,NAHCCV,NAHCTE,NAHINF,NAHMAD,NAHPDI,NAHROA,NAHSDA,NAHTUB,
        8 NAIASL,NAIPJT,NAIRJT,NAITCO,NAITMA,NAIXTR,NAIZBD,NAJBER,NAJEST,
        9 NAJSUM,NAKEVH,NAKINE,NAKJOB,NAKLIN,NAKPOL,NAKRUN,NALIDT,NALOLE,
        A NALUPA,NAMCAD,NAMHIT,NAMTHR,NAMUDG,NAMUEX,NAOSTS,NAPART,NAPASL,
        B NAPCHY,NAPCOB,NAPCOI,NAPCPA,NAPCQA,NAPCRL,NAPECO,NAPEHY,NAPEID,
        C NAPEMH,NAPEPT,NAPEST,NAPEWI,NAPFER,NAPFHR,NAPFRF,NAPFRT,NAPHCO,
        D NAPHER,NAPHHY,NAPHMH,NAPHST,NAPIDI,NAPITM,NAPLID,NAPLPD,NAPLSD,
        E NAPMSK,NAPNEU,NAPPDS,NAPPOB,NAPPRL,NAPRTM,NAPSCO,NAPSPO,NAPSTR,
        F NAPT2X,NAPTBC,NAPTCO,NAPTEX,NAPTMA,NAPTML,NAPTNC,NAPTST,NAPVCO,
        G NAPYER,NAPYFR,NAPYNE,NAQDET,NAQFPA,NAQLIN,NAQMTL,NAQMTS,NAQPAR,
        H NAQPBT,NAQPLI,NAQTRA,NAQVEC,NAQVRT,NAQWRK,NAQZER,NAREVH,NARHAH,
        I NARTLO,NARTLS,NARUNH,NARUNR,NASFTR,NATEXS,NATGMA,NATMTL,NATPCO,
        J NAVCOM,NAVCPL,NAVDCO,NAVDHT,NAVDXY,NAVDZT,NAVERT,NAVFHL,NAVFLG,
        K NAVFPH,NAVHLS,NAVPLH,NAX1AD,NAX1SC,NAX1TI,NAX2DF,NAX3EC,NAX3EW,
        L NAX3HC,NAX3IT,NAX3L2,NAX3LU,NAX3TM,NAX3TO,NAX3TP,NAX3X3,NAXTBN,
        M NAXTBP,NAXTCN,NAXTEB,NAXTOP,NAXTRB,NAYV0V,NAZPFR,NAEFOL,NAMUID,
        N NAPGID,NAPGPC,NAPGAC,NAPMSC,NAPTHR,NANBIP,NAPDLT,NAPMLT,NAPLJT
   
   
   ------------------ /QQQQJJ/ --- HAC parameters for ALPHA banks -------
         PARAMETER (JQVEQX= 1,JQVEQY= 2,JQVEQZ= 3,JQVEQE= 4,JQVEQM= 5,
        & JQVEQP= 6,JQVECH= 7,JQVETN= 8,JQVESC= 9,JQVEKS=10,JQVECL=11,
        & JQVEPA=12,JQVEQD=13,JQVENP=14,JQVESP=15,JQVEOV=16,JQVEEV=17,
        & JQVEND=18,JQVEDL=19,JQVENO=20,JQVEOL=21,JQVENM=22,JQVEML=23,
        & JQVEBM=24,JQVELK=38,JQVEDB=39,JQVEZB=40,JQVESD=41,JQVESZ=42,
        & JQVECB=43,JQVEEM=44,JQVECF=54,JQVEEW=55,JQVEUS=56)
         PARAMETER ( JQVRVX=1,JQVRVY=2,JQVRVZ=3,JQVRVN=4,JQVRTY=5,
        1   JQVRIP=6,JQVRND=7,JQVRDL=8,JQVRAY=9,JQVRAF=10,JQVREM=11,
        2   JQVRCF=17,JQVRET=18)
         PARAMETER ( JQDEAF= 1,JQDEAL= 2,JQDENT= 3,JQDEAT= 4,JQDELT= 8,
        &  JQDEAE= 9,JQDEAH=10,JQDEAM=11,JQDECF=12,JQDEEC=13,JQDEHC=14,
        &  JQDEET=15,JQDEFI=16,JQDENF=17,JQDEFL=18,JQDENE=19,JQDEEL=20,
        &  JQDENH=21,JQDEHL=22,JQDELH=23,JQDEEF=24,JQDEPC=25,JQDEEG=26,
        &  JQDEMU=27,JQDEDX=28,JQDEPG=29,JQDEPD=30,JQDEPM=31)
         PARAMETER ( JQPAGN=1, JQPANA=2, JQPACO=5, JQPAMA=6, JQPACH=7,
        & JQPALT=8,JQPAWI=9,JQPAAN=10)
   
   
         EXTERNAL CQPART, CQTPN, XCEQAN, XLUMOK, XPEQAN, XPEQOR, XPEQU,
        & XVDEOK, LLUMOK, SLUMOK
         CHARACTER * 12 CQPART, CQTPN
         LOGICAL XCAL, XCEQAN, XCEQOR, XCEQU, XECAL, XEID, XFRF, XHCAL,
        & XHMA, XLOCK, XLOCKN, XMC, XLUMOK, XMCA, XPEO, XPHO, XPEQAN,
        & XPEQOR, XPEQU, XSAME, XSIG, XTEX, XPEC, XPEP, XPHC, XYV0,
        & XFRIQF, XEFO, XPCQ, XEGP, XMUI, XVDEOK, XPGP, LLUMOK, SLUMOK,
        & XPGAC, XLEPTG, XLEPTH
   
    alcons
    define universal constants
         REAL PI, TWOPI, PIBY2, PIBY3, PIBY4, PIBY6, PIBY8, PIBY12
         REAL RADEG, DEGRA
         REAL CLGHT, ALDEDX
         PARAMETER (PI=3.141592653589)
         PARAMETER (RADEG=180./PI, DEGRA=PI/180.)
         PARAMETER (TWOPI = 2.*PI , PIBY2 = PI/2., PIBY4 = PI/4.)
         PARAMETER (PIBY6 = PI/6. , PIBY8 = PI/8.)
         PARAMETER (PIBY12= PI/12., PIBY3 = PI/3.)
         PARAMETER (CLGHT = 29.9792458, ALDEDX = 0.000307)
   
         ALDEDX  = constant used in the computation of DEDX in GeV
         CLGHT   = speed of light in cm/nsec
   
   
   
    efoljj
         INTEGER JEFOPX,JEFOPY,JEFOPZ,JEFOEW,JEFOWE,JEFOTY,JEFOLE,JEFOLT,
        +          JEFOLH,JEFOLC,JEFOLJ,LEFOLA
         PARAMETER(JEFOPX=1,JEFOPY=2,JEFOPZ=3,JEFOEW=4,JEFOWE=5,JEFOTY=6,
        +          JEFOLE=7,JEFOLT=8,JEFOLH=9,JEFOLC=10,JEFOLJ=11,
        +          LEFOLA=11)
   
   
    egpcjj
         INTEGER JEGPPX,JEGPPY,JEGPPZ,JEGPR1,JEGPR2,JEGPF4,JEGPDM,JEGPST,
        +          JEGPQU,JEGPPE,LEGPCA
         PARAMETER(JEGPPX=1,JEGPPY=2,JEGPPZ=3,JEGPR1=4,JEGPR2=5,JEGPF4=6,
        +          JEGPDM=7,JEGPST=8,JEGPQU=9,JEGPPE=10,LEGPCA=10)
   
   
    eidtjj
         INTEGER JEIDIF,JEIDR1,JEIDR2,JEIDR3,JEIDR4,JEIDR5,JEIDR6,JEIDR7,
        +          JEIDEC,JEIDIP,JEIDE1,JEIDE2,JEIDE3,JEIDFR,JEIDPE,LEIDTA
         PARAMETER(JEIDIF=1,JEIDR1=2,JEIDR2=3,JEIDR3=4,JEIDR4=5,JEIDR5=6,
        +          JEIDR6=7,JEIDR7=8,JEIDEC=9,JEIDIP=10,JEIDE1=11,
        +          JEIDE2=12,JEIDE3=13,JEIDFR=14,JEIDPE=15,LEIDTA=15)
   
   
    frftjj
         INTEGER JFRFIR,JFRFTL,JFRFP0,JFRFD0,JFRFZ0,JFRFAL,JFRFEM,JFRFC2,
        +          JFRFDF,JFRFNO,LFRFTA
         PARAMETER(JFRFIR=1,JFRFTL=2,JFRFP0=3,JFRFD0=4,JFRFZ0=5,JFRFAL=6,
        +          JFRFEM=7,JFRFC2=28,JFRFDF=29,JFRFNO=30,LFRFTA=30)
   
   
    fridjj
         INTEGER JFRIBP,JFRIDZ,JFRIBC,JFRIDC,JFRIPE,JFRIPM,JFRIPI,JFRIPK,
        +          JFRIPP,JFRINK,JFRIQF,LFRIDA
         PARAMETER(JFRIBP=1,JFRIDZ=2,JFRIBC=3,JFRIDC=4,JFRIPE=5,JFRIPM=6,
        +          JFRIPI=7,JFRIPK=8,JFRIPP=9,JFRINK=10,JFRIQF=11,
        +          LFRIDA=11)
   
   
    frtljj
         INTEGER JFRTIV,JFRTNV,JFRTII,JFRTNI,JFRTNE,JFRTIT,JFRTNT,JFRTNR,
        +          LFRTLA
         PARAMETER(JFRTIV=1,JFRTNV=2,JFRTII=3,JFRTNI=4,JFRTNE=5,JFRTIT=6,
        +          JFRTNT=7,JFRTNR=8,LFRTLA=8)
   
   
    hmadjj
         INTEGER JHMANF,JHMANE,JHMANL,JHMAMH,JHMAIG,JHMAED,JHMACS,JHMAND,
        +          JHMAIE,JHMAIT,JHMAIF,JHMATN,LHMADA
         PARAMETER(JHMANF=1,JHMANE=2,JHMANL=3,JHMAMH=4,JHMAIG=5,JHMAED=6,
        +          JHMACS=7,JHMAND=8,JHMAIE=9,JHMAIT=10,JHMAIF=11,
        +          JHMATN=12,LHMADA=12)
   
   
    mcadjj
         INTEGER JMCANH,JMCADH,JMCADC,JMCAAM,JMCAAC,JMCATN,LMCADA
         PARAMETER(JMCANH=1,JMCADH=3,JMCADC=5,JMCAAM=7,JMCAAC=8,JMCATN=9,
        +          LMCADA=9)
   
   
    muidjj
         INTEGER JMUIIF,JMUISR,JMUIDM,JMUIST,JMUITN,LMUIDA
         PARAMETER(JMUIIF=1,JMUISR=2,JMUIDM=3,JMUIST=4,JMUITN=5,LMUIDA=5)
   
   
    pcqajj
         INTEGER JPCQNA,JPCQPX,JPCQPY,JPCQPZ,JPCQEN,LPCQAA
         PARAMETER(JPCQNA=1,JPCQPX=2,JPCQPY=3,JPCQPZ=4,JPCQEN=5,LPCQAA=5)
   
   
    pdltjj
         INTEGER JPDLPA,JPDLJT,JPDLPI,JPDLPE,JPDLVP,JPDLFR,LPDLTA
         PARAMETER(JPDLPA=1,JPDLJT=2,JPDLPI=3,JPDLPE=4,JPDLVP=5,JPDLFR=6,
        +          LPDLTA=6)
   
   
    pecojj
         INTEGER JPECER,JPECE1,JPECE2,JPECTH,JPECPH,JPECEC,JPECKD,JPECCC,
        +          JPECRB,JPECPC,LPECOA
         PARAMETER(JPECER=1,JPECE1=2,JPECE2=3,JPECTH=4,JPECPH=5,JPECEC=6,
        +          JPECKD=7,JPECCC=8,JPECRB=9,JPECPC=10,LPECOA=10)
   
   
    peptjj
         INTEGER JPEPT1,JPEPP1,JPEPT3,JPEPP3,LPEPTA
         PARAMETER(JPEPT1=1,JPEPP1=2,JPEPT3=3,JPEPP3=4,LPEPTA=4)
   
   
    pgacjj
         INTEGER JPGAEC,JPGATC,JPGAPC,JPGAR1,JPGAR2,JPGAF4,JPGADM,JPGAST,
        +          JPGAQU,JPGAQ1,JPGAQ2,JPGAM1,JPGAM2,JPGAMA,JPGAER,JPGATR,
        +          JPGAPR,JPGAEF,JPGAGC,JPGAZS,JPGAPL,JPGAPH,JPGAPN,JPGAFA,
        +          JPGAPE,LPGACA
         PARAMETER(JPGAEC=1,JPGATC=2,JPGAPC=3,JPGAR1=4,JPGAR2=5,JPGAF4=6,
        +          JPGADM=7,JPGAST=8,JPGAQU=9,JPGAQ1=10,JPGAQ2=11,
        +          JPGAM1=12,JPGAM2=13,JPGAMA=14,JPGAER=15,JPGATR=16,
        +          JPGAPR=17,JPGAEF=18,JPGAGC=19,JPGAZS=20,JPGAPL=21,
        +          JPGAPH=22,JPGAPN=23,JPGAFA=24,JPGAPE=25,LPGACA=25)
   
   
    pgpcjj
         INTEGER JPGPEC,JPGPTC,JPGPPC,JPGPR1,JPGPR2,JPGPF4,JPGPDM,JPGPST,
        +          JPGPQU,JPGPQ1,JPGPQ2,JPGPM1,JPGPM2,JPGPMA,JPGPER,JPGPTR,
        +          JPGPPR,JPGPPE,LPGPCA
         PARAMETER(JPGPEC=1,JPGPTC=2,JPGPPC=3,JPGPR1=4,JPGPR2=5,JPGPF4=6,
        +          JPGPDM=7,JPGPST=8,JPGPQU=9,JPGPQ1=10,JPGPQ2=11,
        +          JPGPM1=12,JPGPM2=13,JPGPMA=14,JPGPER=15,JPGPTR=16,
        +          JPGPPR=17,JPGPPE=18,LPGPCA=18)
   
   
    phcojj
         INTEGER JPHCER,JPHCTH,JPHCPH,JPHCEC,JPHCKD,JPHCCC,JPHCRB,JPHCNF,
        +          JPHCPC,LPHCOA
         PARAMETER(JPHCER=1,JPHCTH=2,JPHCPH=3,JPHCEC=4,JPHCKD=5,JPHCCC=6,
        +          JPHCRB=7,JPHCNF=8,JPHCPC=9,LPHCOA=9)
   
   
    pmltjj
         INTEGER JPMLFL,JPMLPO,JPMLCH,JPMLSP,JPMLLE,JPMLME,JPMLKT,JPMLFR,
        +          LPMLTA
         PARAMETER(JPMLFL=1,JPMLPO=2,JPMLCH=3,JPMLSP=4,JPMLLE=5,JPMLME=6,
        +          JPMLKT=7,JPMLFR=8,LPMLTA=8)
   
   
    texsjj
         INTEGER JTEXSI,JTEXTM,JTEXTL,JTEXNS,JTEXAD,JTEXTN,JTEXSF,LTEXSA
         PARAMETER(JTEXSI=1,JTEXTM=2,JTEXTL=3,JTEXNS=4,JTEXAD=5,JTEXTN=6,
        +          JTEXSF=7,LTEXSA=7)
   
   
    yv0vjj
         INTEGER JYV0K1,JYV0K2,JYV0VX,JYV0VY,JYV0VZ,JYV0VM,JYV0PX,JYV0PY,
        +          JYV0PZ,JYV0PM,JYV0X1,JYV0X2,JYV0XM,JYV0C2,JYV0IC,JYV0P1,
        +          JYV0P2,JYV0EP,JYV0DM,JYV0S1,JYV0S2,LYV0VA
         PARAMETER(JYV0K1=1,JYV0K2=2,JYV0VX=3,JYV0VY=4,JYV0VZ=5,JYV0VM=6,
        +          JYV0PX=12,JYV0PY=13,JYV0PZ=14,JYV0PM=15,JYV0X1=21,
        +          JYV0X2=22,JYV0XM=23,JYV0C2=26,JYV0IC=27,JYV0P1=28,
        +          JYV0P2=31,JYV0EP=34,JYV0DM=55,JYV0S1=56,JYV0S2=57,
        +          LYV0VA=57)
   
   
   
    krunjj
         INTEGER JKRUGI,JKRUNO,JKRURT,JKRUFS,JKRUSS,LKRUNA
         PARAMETER(JKRUGI=1,JKRUNO=2,JKRURT=3,JKRUFS=15,JKRUSS=16,
        +          LKRUNA=16)
   
   
    rksejj
         INTEGER JRKSVS,JRKSRN,JRKSYG,JRKSND,JRKSLE,JRKSR1,JRKSR2,JRKSKV,
        +          JRKSJV,JRKSGV,JRKSMV,JRKSDV,JRKSNE,JRKSLT,JRKSKX,JRKSKE,
        +          JRKSPX,JRKSPE,JRKSKW,LRKSEA
         PARAMETER(JRKSVS=1,JRKSRN=4,JRKSYG=5,JRKSND=6,JRKSLE=7,JRKSR1=8,
        +          JRKSR2=9,JRKSKV=10,JRKSJV=11,JRKSGV=12,JRKSMV=13,
        +          JRKSDV=14,JRKSNE=15,JRKSLT=16,JRKSKX=17,JRKSKE=18,
        +          JRKSPX=19,JRKSPE=20,JRKSKW=21,LRKSEA=35)
   
   
    asimjj
         INTEGER JASIYM,LASIMA
         PARAMETER(JASIYM=1,LASIMA=1)
   
   
         parameter ( nrumx = 5000 )
         character*12 filrlis
         common / kinruev / nrukin,lrukin(nrumx),litrmi(nrumx),
        +                   ifailmx,litrmx(nrumx)
         common / ckinruv / filrlis(nrumx)
   
   
    rhahjj
         INTEGER JRHAPN,JRHAPD,JRHAPH,JRHAPV,JRHAAV,JRHADV,JRHADD,JRHANI,
        +          JRHANO,JRHACV,JRHANU,LRHAHA
         PARAMETER(JRHAPN=1,JRHAPD=3,JRHAPH=4,JRHAPV=5,JRHAAV=6,JRHADV=7,
        +          JRHADD=8,JRHANI=9,JRHANO=10,JRHACV=11,JRHANU=12,
        +          LRHAHA=12)
   
         save
         external chaint
         parameter ( nrumm = 2000, ikrco = 10000, irma = 100000)
         parameter ( kinor = 5030 , kinok = 5300)
         common / XKSECS / xsecru,xseceru,nevpro,xsecpr,xsecepr
         character chaint*4,prog*4,title*48,zkey*60,ckey*60,tcp*12,tap*12
         data irun / -1 /
   
    bmacro
       set of intrinsic functions to handle BOS banks
   - # of words/row in bank with index ID
         LCOLS(ID) = IW(ID+1)
   - # of rows in bank with index ID
         LROWS(ID) = IW(ID+2)
   - index of next row in the bank with index ID
         KNEXT(ID) = ID + LMHLEN + IW(ID+1)*IW(ID+2)
   - index of row # NRBOS in the bank with index ID
         KROW(ID,NRBOS) = ID + LMHLEN + IW(ID+1)*(NRBOS-1)
   - # of free words in the bank with index ID
         LFRWRD(ID) = ID + IW(ID) - KNEXT(ID)
   - # of free rows in the bank with index ID
         LFRROW(ID) = LFRWRD(ID) / LCOLS(ID)
   - Lth integer element of the NRBOSth row of the bank with index ID
         ITABL(ID,NRBOS,L) = IW(ID+LMHLEN+(NRBOS-1)*IW(ID+1)+L)
   - Lth real element of the NRBOSth row of the bank with index ID
         RTABL(ID,NRBOS,L) = RW(ID+LMHLEN+(NRBOS-1)*IW(ID+1)+L)
   
         call qfkirev
         IF (KRUN.GT.NRUMM) GO TO 999
         XSEC=-1.
         XSECE=0.
         NEVPR=0
         kinco=0
         XSECP=0.
         XSECPE=0.
         XSECR=0.
         XSECRE=0.
         NEVTP=0
         NSETS=0
         TITLE=' '
         ZKEY=' '
         CKEY=' '
         IF (KRUN.NE.IRUN) THEN
            XSECRU=-1.
            XSECERU=-1.
            NEVPRO=0
            XSECPR=-1.
            XSECEPR=-1.
         ENDIF
    run number, first/last ranmar seed of dataset:
         IKRU=IW(NAMIND('KRUN'))
         IF (IKRU.GT.0) THEN
            KKRU=KROW(IKRU,1)
            KOD=IW(KKRU+JKRUGI)
            KINCO=MOD(KOD,IKRCO)
    historical reasons, Kingal code 5030 must be
    by Kingal code 5300 for RKSE banks:
            if (kinco.eq.kinor) kinco=kinok
            IRAN1=IW(KKRU+JKRUFS)
            IRAN2=IW(KKRU+JKRUSS)
            CALL ALSTIN(IW(KKRU+JKRURT),JKRUFS-JKRURT,TITLE)
         endif
    name:
         tcp=' '
         lcp=0
         if (nrukin.gt.0) then
            tcp=filrlis(nrukin)
            call cltou(tcp)
            lcp=lnblnk(tcp)
         endif
   AL code found: look for 'RKSE' bank:
         if (kinco.EQ.0) GO TO 999
         JRKSE=NLINK('RKSE',KINCO)
   -------------- banks may be on ADBSCONS.DAF
         if (JRKSE.EQ.0) then
    load from dbase if not in dbas.bank
            LDBAS = JUNIDB(0)
            JBRKSE = NDANR (LDBAS,'RKSE','EQ',kinco)
            if(JBRKSE.ne.0) ind = mdard(iw,ldbas,'RKSE',kinco)
            JRKSE=NLINK('RKSE',KINCO)
         endif
         IF (JRKSE.EQ.0) GO TO 999
    year of GALEPH geometry:
         IKAP=IW(NAMIND('ASIM'))
         IF (IKAP.NE.0) THEN
   /version of GALEPH Geometry in ASIM :
    previously yyvv, may become yyyyvv
            IDASI=ITABL(IKAP,1,JASIYM)
            IF (IDASI.GT.IRMA) THEN
               IYEOG=IDASI/100
            ELSE
               IYY=IDASI/100
               IF (IYY.GT.10) THEN
                  IYEOG=1900+IYY
               ELSE
                  IYEOG=2000+IYY
               ENDIF
            ENDIF
         ENDIF
    the LEP centre-of-mass energy in MeV:
         IELEP=NINT(1000.*ALELEP(KRUN))
    nature of data, Galeph/Julia/MINI versions:
         igver=0
         ijver=0
         imver=0
         JRHAH=IW(NAMIND('RHAH'))
         DO 100 IRHAH=1,LROWS(JRHAH)
            KRHAH=KROW(JRHAH,IRHAH)
            INDAT=IW(KRHAH+JRHANO)
            PROG=CHAINT(IW(KRHAH+JRHAPN))
            IF (PROG(1:1).EQ.'G') IGVER=IW(KRHAH+JRHAPV)
            IF (PROG(1:1).EQ.'J') IJVER=IW(KRHAH+JRHAPV)
            IF (PROG(1:1).EQ.'M') IMVER=IW(KRHAH+JRHAPV)
    100  CONTINUE
   'RKSE' bank exists: look for the dataset
         DO 200 IRKSE=1,LROWS(JRKSE)
            KRKSE=KROW(JRKSE,IRKSE)
    the tape name:
            call alstin(iw(krkse+jrksvs),3,tap)
            call cltou(tap)
            ltap=lnblnk(tap)
            if (lcp.gt.0) then
               if (ltap.ne.lcp) go to 200
               if (tap(1:ltap).ne.tcp(1:lcp)) go to 200
            endif
            IF (IYEOG.NE.IW(KRKSE+JRKSYG)) GO TO 200
            IF (INDAT.NE.IW(KRKSE+JRKSND)) GO TO 200
            IF (IELEP.NE.IW(KRKSE+JRKSLE)) GO TO 200
            IF (IGVER.NE.IW(KRKSE+JRKSGV)) GO TO 200
            IF (XMINI.AND.IMVER.NE.IW(KRKSE+JRKSMV)) GO TO 200
            IF (IRAN1.NE.IW(KRKSE+JRKSR1)) GO TO 200
            IF (IRAN2.NE.IW(KRKSE+JRKSR2)) GO TO 200
            IF (KRUN.NE.IW(KRKSE+JRKSRN)) GO TO 200
            IF (IW(KRKSE+JRKSLT).NE.0) GO TO 200
    found: give Xsec, Xsece, ZKEY,
    the prod. cross section and error, and flag this row:
            XSEC=RW(KRKSE+JRKSKX)
            XSECE=RW(KRKSE+JRKSKE)
            NEVPR=IW(KRKSE+JRKSNE)
            CALL ALSTIN(IW(KRKSE+JRKSKW),LRKSEA-JRKSKW+1,ZKEY)
            xsecp=rw(krkse+jrkspx)
            xsecpe=rw(krkse+jrkspe)
            IW(KRKSE+JRKSLT)=1
            go to 250
    200  CONTINUE
    the total number of events from all runs of the production:
    the corresponding cross-section and error:
    250  xsecr=0.
         xsecre=0.
         CKEY=' '
         DO 300 IRKSE=1,LROWS(JRKSE)
            KRKSE=KROW(JRKSE,IRKSE)
            IF (IYEOG.NE.IW(KRKSE+JRKSYG)) GO TO 300
            IF (INDAT.NE.IW(KRKSE+JRKSND)) GO TO 300
            IF (IELEP.NE.IW(KRKSE+JRKSLE)) GO TO 300
            IF (IGVER.NE.IW(KRKSE+JRKSGV)) GO TO 300
            IF (XMINI.AND.IMVER.NE.IW(KRKSE+JRKSMV)) GO TO 300
            CALL  ALSTIN(IW(KRKSE+JRKSKW),LRKSEA-JRKSKW+1,CKEY)
            IF (CKEY(1:LNBLNK(CKEY)).NE.ZKEY(1:LNBLNK(ZKEY))) GO TO 300
    X-section and Nevents for all runs of this prod:
            NSETS=NSETS+1
            NEVTP=NEVTP+IW(KRKSE+JRKSNE)
            XSECR=XSECR+RW(KRKSE+JRKSKX)
            XSECRE=XSECRE+RW(KRKSE+JRKSKE)
    300  CONTINUE
    printout the results and store them at the beginning of a new run:
    500  CONTINUE
         if (krun.ne.irun) then
            irun=krun
            ltit=lnblnk(title)
            XSECRU=-1.
            XSECERU=-1.
            NEVPRO=0
            XSECPR=-1.
            XSECEPR=-1.
            if (xsec.gt.0.) then
               xsecru=xsec
               xseceru=xsece
               nevpro=nevtp
               fset=float(nsets)
               xsect=0.
               xsecte=0.
               if (nsets.gt.0) then
                  xsect=xsecr/fset
                  xsecte=xsecre/(fset*sqrt(fset))
               endif
    if one uses the prod cross section from 'RKSE' or the one
    the average of runs:
               if (xsecp.gt.0.) then
                  xsecpr=xsecp
                  xsecepr=xsecpe
                  iprov=1
               else
                  xsecpr=xsect
                  xsecepr=xsecte
                  iprov=2
               endif
               write (iw(6),1234) krun,title(1:ltit),xsecru,xseceru,
        +                         nevpr,nsets,nevpro,xsecpr,xsecepr
    1234       format (/1x,100(1H*)/5x,'==> New run :',i5,
        +          2x,'** Title of production =',2x,(A)/
        +          5x,'==> Cross-section for this run =',
        +          f10.5,' +/- ',f10.5,' picobarns',/5x,
        +          '==> Number of events in this run =',I6/
        +          5x,'--> This is part of a production of ',i5,
        +          ' runs with Nevents =',i8/
        +          5x,'==> Cross-section for the whole production =',
        +          f10.5,' +/- ',f10.5,' picobarns',/
        +          1x,100(1H*)/)
            endif
         endif
   
    999  continue
         RETURN
         END
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   QMNEWR                                                                          
        |---- QRKSEC                                                               
                   |----  QFKIREV                                                  
                   |----  NAMIND                              External             
                   |----  MOD                                 External             
                   |----  ALSTIN                              External             
                   |----  CLTOU                               External             
                   |----  LNBLNK                              External             
                   |----  NLINK                               External             
                   |----  JUNIDB                              External             
                   |----  NDANR                               External             
                   |----  MDARD                               External             
                   |----  NINT                                External             
                   |----  ALELEP                              External             
                   |----  CHAINT                              External             
                   |----  IW                                  External             
                   |----  RW                                  External             
                   |----  FLOAT                               External             
                   |----  SQRT                                External             
   
 
3 QSBANK
         SUBROUTINE QSBANK (CBANK,N)
  ------------------------------------------------------------------------------
    CKEY BANKS /INTERNAL
  ------------------------------------------------------------------------------
   Create alpha banks or increase their size
    from anywhere
                                                     H.Albrecht 03.11.88
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   KPCOMP                                                                          
   KPCHEK                                                                          
   KTLORX                                                                          
   KVNEW                                                                           
   KVSAVA                                                                          
   KVSAVC                                                                          
   KVSAVE                                                                          
   QFCHGD                                                                          
   QFCOBJ                                                                          
   QFEFLO                                                                          
   QFGAMP                                                                          
   QFJETS                                                                          
   QFLJET                                                                          
   QFMCMD                                                                          
   QFMCPA                                                                          
   QFMCVX                                                                          
   QFMTCH                                                                          
   QFNEOB                                                                          
   QFREV0                                                                          
   QFYLV0                                                                          
   QMALPH                                                                          
   QMPART                                                                          
   QNVSTO                                                                          
   QSUSTR                                                                          
   QSUSVX                                                                          
   QVADD2                                                                          
   QVADD3                                                                          
   QVADD4                                                                          
   KIDSAV                                                                          
   KVFITA                                                                          
   KVFITC                                                                          
   KVFITM                                                                          
   KVFITN                                                                          
   KVFITV                                                                          
   KVFTMC                                                                          
   QJSAVE                                                                          
        |---- QSBANK                                                               
                   |----  NBANK                               External             
                   |----  BKFMT                               External             
                   |----  NAMIND                              External             
   
 
3 QSTFLI
         SUBROUTINE QSTFLI(ITK,IFLAG,IVALUE)
  ------------------------------------------------------------------------------
    CKEY FLAG /USER
  ------------------------------------------------------------------------------
     Author   : E. Blucher      7-APR-1989
     Description
     ===========
   Set flag iflag in user space to ivalue (integer) for itk.
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   QSELEP                                                                          
        |---- QSTFLI                                                               
                   |----  QWMESE                                                   
   
 
3 QSTFLR
         SUBROUTINE QSTFLR(ITK,IFLAG,VALUE)
  ------------------------------------------------------------------------------
    CKEY FLAG /USER
  ------------------------------------------------------------------------------
     Author   : E. Blucher      7-APR-1989
     Description
     ===========
   Set flag iflag in user space to value (real) for itk.
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
              QSTFLR                                                               
                   |----  QWMESE                                                   
   
 
3 QSUSTR
         SUBROUTINE QSUSTR (N)
  ------------------------------------------------------------------------------
    CKEY USER TRACKS /USER
  ------------------------------------------------------------------------------
   Reserve user space for tracks
                                                     H.Albrecht 20.09.88
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
              QSUSTR                                                               
                   |----  QSBANK                                                   
   
 
3 QSUSVX
         SUBROUTINE QSUSVX (N)
  ------------------------------------------------------------------------------
    CKEY VERTEX USER /USER
  ------------------------------------------------------------------------------
   Reserve user space for vertices
                                                     H.Albrecht 20.09.88
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
              QSUSVX                                                               
                   |----  QSBANK                                                   
   
 
3 QTCLAS
         SUBROUTINE QTCLAS (ICLASS,ITKRST)
  ------------------------------------------------------------------------------
    CKEY KINEMATICS /USER
  ------------------------------------------------------------------------------
   Lorentz transformation of all objects in iclass into frame itkrst.
                                                      H.Albrecht 22.2.89
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
              QTCLAS                                                               
                   |----  KSCNEW                                                   
                   |----  QJSET0                                                   
                   |----  KTLORX                                                   
                   |----  KTBIT                               External             
   
 
3 QTIMEZ
         SUBROUTINE QTIMEZ
  ------------------------------------------------------------------------------
    CKEY TIME /USER
  ------------------------------------------------------------------------------
   Time consumption monitoring.
                                            Authors: H. Albrecht 16.1.90
    Called from QMTERM
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   QMTERM                                                                          
        |---- QTIMEZ                                                               
                   |----  TIMED                               External             
   
 
3 QTKIREV
         subroutine qtkirev
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
    end-of-job stats
    from QMTERM
   
    bcs
         INTEGER LMHLEN, LMHCOL, LMHROW
         PARAMETER (LMHLEN=2, LMHCOL=1, LMHROW=2)
         COMMON /BCS/   IW(1000)
         INTEGER IW
         REAL RW(1000)
         EQUIVALENCE (RW(1),IW(1))
   
   
         parameter ( nrumx = 5000 )
         character*12 filrlis
         common / kinruev / nrukin,lrukin(nrumx),litrmi(nrumx),
        +                   ifailmx,litrmx(nrumx)
         common / ckinruv / filrlis(nrumx)
   
         if (nrukin.le.0) go to 999
         write (iw(6),1234) nrukin
    1234 format (/' == QTKIREV : Summary of KINGAL events generated -'/,
        +        15X,'Total number of FILI cards read =',i6/)
    printout:
         do k=1,nrukin
            ntrg=litrmx(k)-litrmi(k)+1
            if (ntrg.le.0) ntrg=0
            write (iw(6),1235) filrlis(k),lrukin(k),ntrg
   1235     format (5x,'** Tape read:',2x,a12,' Run:',I5,
        +           2x,'Number of Kingal triggers =',i8)
         enddo
    999  return
         END
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   QMTERM                                                                          
        |---- QTKIREV                                                              
                   |----  IW                                  External             
                   |----  LITRMX                              External             
   
 
3 QTRESC
         SUBROUTINE QTRESC
  ------------------------------------------------------------------------------
    CKEY FILL /INTERNAL
  ------------------------------------------------------------------------------
   Apply tpcorr to all charged tracks
    called from QFILL
                                                      F.Ligabue  16.07.98
    modified I. Tomalin  19.10.98
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   QFILL                                                                           
        |---- QTRESC                                                               
                   |----  SIGN                                External             
                   |----  SQRT                                External             
                   |----  ABS                                 External             
                   |----  NINT                                External             
                   |----  KMATIX                              External             
                   |----  ATG                                 External             
                   |----  KCLARM                              External             
                   |----  IAND                                External             
                   |----  KLOCK0                              External             
                   |----  IABS                                External             
                   |----  NLINK                               External             
                   |----  MAX                                 External             
                   |----  QPCORR                                                   
   
 
3 QUEFLO
         SUBROUTINE QUEFLO
  ------------------------------------------------------------------------------
    CKEY PACK FILL EFLOW /USER
  ------------------------------------------------------------------------------
   User routine called before qfeflo
    to call the energy flow when ALEPH_JULIA flag is ON
   - P.Janot
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   QFILL                                                                           
        |---- QUEFLO                                                               
                   |----  NLINK                               External             
                   |----  GAPGPC                              External             
                   |----  BLIST                               External             
                   |----  GAPGAC                              External             
                   |----  CREFLW                                                   
   
 
3 QUEVNT
         SUBROUTINE QUEVNT (QT,KT,QV,KV)
  ------------------------------------------------------------------------------
    CKEY EVENT /USER
  ------------------------------------------------------------------------------
   Process one event
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   QMEVNT                                                                          
        |---- QUEVNT                                                               
                   |----  SIGN                                External             
                   |----  SQRT                                External             
                   |----  ABS                                 External             
                   |----  NINT                                External             
                   |----  KMATIX                              External             
                   |----  ATG                                 External             
                   |----  KCLARM                              External             
                   |----  IAND                                External             
                   |----  KLOCK0                              External             
                   |----  IABS                                External             
                   |----  QWMESS                                                   
                   |----  QWEVNT                                                   
                   |----  QMTERM                                                   
   
 
3 QUIBOS
         SUBROUTINE QUIBOS(LOUT,LINTE)
  ------------------------------------------------------------------------------
    CKEY BANKS INIT /USER
  ------------------------------------------------------------------------------
   Initialize bos
    from QMINIT
                                                     H.Albrecht 20.09.88
                                         modified    J.Boucrot  03.05.93
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   QMINIT                                                                          
        |---- QUIBOS                                                               
                   |----  BNAMES                              External             
                   |----  BOS                                 External             
                   |----  FORMAT                              External             
   
 
3 QUIHIS
         SUBROUTINE QUIHIS
  ------------------------------------------------------------------------------
    CKEY HIST INIT /USER
  ------------------------------------------------------------------------------
   Initialize histogram package
    from QMINIT
                                                     H.Albrecht 20.09.88
                                         modified    J.Boucrot  03.05.93
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   QMINIT                                                                          
        |---- QUIHIS                                                               
                   |----  HLIMIT                              External             
                   |----  QMIHISFORMAT                        External             
   
 
3 QUINIT
         SUBROUTINE QUINIT
  ------------------------------------------------------------------------------
    CKEY INIT /USER
  ------------------------------------------------------------------------------
   User initialisation
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   QMINIT                                                                          
        |---- QUINIT                                                               
                   |----  QWMESS                                                   
   
 
3 QUKISTAT
         subroutine qukistat(nfili,tfilis,lirun,nktrg,ifail)
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
    user access to  KINGAL statistics on generated triggers
    at the end of job
    be called in QUTERM - Meaningful for MCarlos only !
    arguments:
    nfili     = number of FILI CARDS read during the job
    tfilis(i) = list of tapes_files read during the job, e.g. R01234_125
                i = 1 , nfili
                must be declared character*12 tfilis(100) in the
                calling subroutine
    lirun(i)  = list of runs read during the job (Integer lirun(100))
    nktrg(i)  = number of generated KINGAL trigger for dataset read on
                tfilis(i)   - To be declared as Integer nktrg(100)
    ifail     = 1 if more than 100 FILI cards read on input
         save
   
         parameter ( nrumx = 5000 )
         character*12 filrlis
         common / kinruev / nrukin,lrukin(nrumx),litrmi(nrumx),
        +                   ifailmx,litrmx(nrumx)
         common / ckinruv / filrlis(nrumx)
   
         character*(*) tfilis(*)
         integer lirun(*),nktrg(*)
         ifail=ifailmx
         nfili=nrukin
    to the content of krsktrg:
         do i=1,nrukin
            tfilis(i)=filrlis(i)
            lirun(i)=lrukin(i)
            nktrg(i)=litrmx(i)-litrmi(i)+1
         enddo
    999  return
         END
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
              QUKISTAT                                                             
                   |----  LITRMX                              External             
   
 
3 QUNEWR
         SUBROUTINE QUNEWR (IROLD,IRNEW)
  ------------------------------------------------------------------------------
    CKEY RUN /USER
  ------------------------------------------------------------------------------
   New run
    from QMNEWR
                                                     H.Albrecht 20.09.88
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   QMNEWR                                                                          
        |---- QUNEWR                                                               
                   |----  SIGN                                External             
                   |----  SQRT                                External             
                   |----  ABS                                 External             
                   |----  NINT                                External             
                   |----  KMATIX                              External             
                   |----  ATG                                 External             
                   |----  KCLARM                              External             
                   |----  IAND                                External             
                   |----  KLOCK0                              External             
                   |----  IABS                                External             
   
 
3 QUOPEN
         SUBROUTINE QUOPEN
  ------------------------------------------------------------------------------
    CKEY INIT /USER
  ------------------------------------------------------------------------------
   Dummy open routine; called before qmcard
    from QMINIT
                                                     E.Blucher 10.09.89
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   QMINIT                                                                          
        |---- QUOPEN.                                                              
   
 
3 QUPEC1
         SUBROUTINE QUPEC1
  ------------------------------------------------------------------------------
    CKEY FILL EFLOW /USER
  ------------------------------------------------------------------------------
   Create bank peco/1 if requested
    Janot -- 9 June 1993
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
              QUPEC1                                                               
                   |----  NLINK                               External             
                   |----  GAPECO                              External             
                   |----  BLIST                               External             
   
 
3 QUREFIT
         SUBROUTINE QUREFIT
  ------------------------------------------------------------------------------
    CKEY INIT /USER
  ------------------------------------------------------------------------------
   User refit of tracks
    from QMEVNT before QFILL
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   QMEVNT                                                                          
        |---- QUREFIT                                                              
                   |----  SIGN                                External             
                   |----  SQRT                                External             
                   |----  ABS                                 External             
                   |----  NINT                                External             
                   |----  KMATIX                              External             
                   |----  ATG                                 External             
                   |----  KCLARM                              External             
                   |----  IAND                                External             
                   |----  KLOCK0                              External             
                   |----  IABS                                External             
                   |----  NAMIND                              External             
                   |----  QMTERM                                                   
                   |----  ALSTIN                              External             
                   |----  VDFIXZ                                                   
                   |----  VTRKEX                              External             
                   |----  QFREFIT                                                  
   
 
3 QURESC
         SUBROUTINE QURESC
  ------------------------------------------------------------------------------
    CKEY FILL /USER
  ------------------------------------------------------------------------------
   User-interface for calling rescaling routines before the
     Energy-Flow
     called from QFILL
                                   F.Ligabue      07-97
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   QFILL                                                                           
        |---- QURESC.                                                              
   
 
3 QURKSEC
         SUBROUTINE QURKSEC(XSEC,XSECE,NEVPR,XPROD,XPRODE)
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
    access to the MCarlo cross-sections generated for the
    presently read
    arguments:
    xsec   = cross section (in pb) generated for the present run
           = -1. if not found
    xsece  = error on xsecru (in pb) , =-1. if not found
    nevpr  = total number of events for the whole prouction
           = 0 if not found
    xprod  = cross section (in pb) for the whole production
          = -1. if not found
    xprode = error on xsecpr (in pb), =-1. if not found
   Author J. Boucrot 26-10-2000
         common / XKSECS / xsecru,xseceru,nevpro,xsecpr,xsecepr
         xsec=xsecru
         xsece=xseceru
         nevpr=nevpro
         xprod=xsecpr
         xprode=xsecepr
         return
         end
 
3 QUSREC
         SUBROUTINE QUSREC
  ------------------------------------------------------------------------------
    CKEY EVENT SLOW /USER
  ------------------------------------------------------------------------------
   Called for unknown record types
    from QMSREC
                                                     E.Blucher 10.09.89
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   QMSREC                                                                          
        |---- QUSREC.                                                              
   
 
3 QUTERM
         SUBROUTINE QUTERM
  ------------------------------------------------------------------------------
    CKEY TERM /USER
  ------------------------------------------------------------------------------
   User termination
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   QMTERM                                                                          
        |---- QUTERM                                                               
                   |----  SIGN                                External             
                   |----  SQRT                                External             
                   |----  ABS                                 External             
                   |----  NINT                                External             
                   |----  KMATIX                              External             
                   |----  ATG                                 External             
                   |----  KCLARM                              External             
                   |----  IAND                                External             
                   |----  KLOCK0                              External             
                   |----  IABS                                External             
                   |----  QWMESS                                                   
   
 
3 QUTHIS
         SUBROUTINE QUTHIS
  ------------------------------------------------------------------------------
    CKEY TERM HIST /USER
  ------------------------------------------------------------------------------
   Histogram output
    from QMTERM
                                                     H.Albrecht 20.09.88
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   QMTERM                                                                          
        |---- QUTHIS                                                               
                   |----  HISTDO                              External             
                   |----  QWMESS                                                   
                   |----  HROUT                               External             
                   |----  HREND                               External             
   
 
3 QV0CHK
         SUBROUTINE QV0CHK(JTRAK,CHI2,IER)
  ------------------------------------------------------------------------------
    CKEY PART/USER
  ------------------------------------------------------------------------------
   Get the chi2 of a track with the constraint of the primary vertex
    ALPHA interface to the Alephlib YCHIV2 routine
   Author J. Boucrot       29-Sep-1993
    from USER
     YCHIV2                                 from ALEPHLIB
    Input argument :
    JTRAK  =  JULIA (FRFT) track number ( belonging to a V0 candidate )
    Outputs :
    CHI2 = chi**2 of track JTRAK with main vertex constraint
           set to -999999. if IER = 1
    IER  = 0 if all OK
         = 1 if no CHI2 calculation possible
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
              QV0CHK                                                               
                   |----  SIGN                                External             
                   |----  SQRT                                External             
                   |----  ABS                                 External             
                   |----  NINT                                External             
                   |----  KMATIX                              External             
                   |----  ATG                                 External             
                   |----  KCLARM                              External             
                   |----  IAND                                External             
                   |----  KLOCK0                              External             
                   |----  IABS                                External             
                   |----  VZERO                               External             
                   |----  YCHIV2                              External             
   
 
3 QVADD2
         SUBROUTINE QVADD2 (ITKSUM,ITK1,ITK2)
  ------------------------------------------------------------------------------
    CKEY VECTOR KINEMATICS /USER
  ------------------------------------------------------------------------------
   Sum (4-vector(itkn) (n=1,2)) --> 4-vector(itksum)
                                                      H.Albrecht  2.1.89
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
              QVADD2                                                               
                   |----  QMTERM                                                   
                   |----  QSBANK                                                   
                   |----  QWMESE                                                   
   
 
3 QVADD3
         SUBROUTINE QVADD3 (ITKSUM,ITK1,ITK2,ITK3)
  ------------------------------------------------------------------------------
    CKEY VECTOR KINEMATICS /USER
  ------------------------------------------------------------------------------
   Sum (4-vector(itkn) (n=1,3)) --> 4-vector(itksum)
                                                      H.Albrecht  2.1.89
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
              QVADD3                                                               
                   |----  QSBANK                                                   
                   |----  QWMESE                                                   
   
 
3 QVADD4
         SUBROUTINE QVADD4 (ITKSUM,ITK1,ITK2,ITK3,ITK4)
  ------------------------------------------------------------------------------
    CKEY VECTOR KINEMATICS /USER
  ------------------------------------------------------------------------------
   Sum (4-vector(itkn) (n=1,3)) --> 4-vector(itksum)
                                                      H.Albrecht  2.1.89
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
              QVADD4                                                               
                   |----  QSBANK                                                   
                   |----  QWMESE                                                   
   
 
3 QVADDN
         SUBROUTINE QVADDN (ITKSUM,ITK)
  ------------------------------------------------------------------------------
    CKEY VECTOR KINEMATICS /USER
  ------------------------------------------------------------------------------
   4-vector(itksum) + 4-vector(itk) --> 4-vector(itksum)
                                                      H.Albrecht  2.1.89
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   MDSTRD                                                                          
   JULMATCH                                                                        
   QBMTAG                                                                          
        |---- QVADDN                                                               
                   |----  QMTERM                                                   
                   |----  QADAU                                                    
                   |----  QWMESE                                                   
   
 
3 QVCOPY
         SUBROUTINE QVCOPY (ITKTO,ITKFRO)
  ------------------------------------------------------------------------------
    CKEY VECTOR KINEMATICS COPY/USER
  ------------------------------------------------------------------------------
   Copy track itkfro to itkto.
                                                      H.Albrecht  2.1.89
                                   Modified:          E.Blucher   2.9.92
    I. Tomalin 9.5.97: So that two copies to same track don't mess up.
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   QFCREL                                                                          
   QFEFLO                                                                          
   QFREV0                                                                          
        |---- QVCOPY                                                               
                   |----  QWMESE                                                   
   
 
3 QVCROS
         SUBROUTINE QVCROS (ITKRES,ITK1,ITK2)
  ------------------------------------------------------------------------------
    CKEY VECTOR KINEMATICS /USER
  ------------------------------------------------------------------------------
   4-vector(itk1) cross 4-vector(itk2) --> 4-vector(itkres)
                                                      H.Albrecht  2.1.89
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
              QVCROS                                                               
                   |----  QMTERM                                                   
                   |----  QADAU                                                    
                   |----  QWMESE                                                   
   
 
3 QVDROA
         SUBROUTINE QVDROA (CNAM,ICL)
  ------------------------------------------------------------------------------
    CKEY CLASS TRACKS /INTERNAL
  ------------------------------------------------------------------------------
   Drop tracks with name cnam in class icl. cnam = ' ' : all tracks.
                                                      H.Albrecht  2.1.89
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   QVDROP                                                                          
   QJSAVE                                                                          
        |---- QVDROA                                                               
                   |----  KPART                                                    
   
 
3 QVDROP
         SUBROUTINE QVDROP (CNAM,ICLASS)
  ------------------------------------------------------------------------------
    CKEY CLASS TRACKS /USER
  ------------------------------------------------------------------------------
   Drop tracks with name cnam in class iclass. cnam = ' ' : all tracks.
                                                      H.Albrecht  2.1.89
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   JETCLU                                                                          
   QBMTAG                                                                          
        |---- QVDROP                                                               
                   |----  KSCOLD                                                   
                   |----  QWMESE                                                   
                   |----  QVDROA                                                   
   
 
3 QVGET3
         SUBROUTINE QVGET3 (P,ITK)
  ------------------------------------------------------------------------------
    CKEY VECTOR COPY /USER
  ------------------------------------------------------------------------------
   3-vector(itk) --> array p
                                                      H.Albrecht  2.1.89
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   TPARSET                                                                         
   QYFIT                                                                           
   QYFITC                                                                          
   QYFITV                                                                          
   QYFTMC                                                                          
        |---- QVGET3.                                                              
   
 
3 QVGET4
         SUBROUTINE QVGET4 (P,ITK)
  ------------------------------------------------------------------------------
    CKEY VECTOR COPY /USER
  ------------------------------------------------------------------------------
   4-vector(itk) --> array p
                                                      H.Albrecht  2.1.89
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
              QVGET4.                                                              
   
 
3 QVGETS
         SUBROUTINE QVGETS (S,ITK)
  ------------------------------------------------------------------------------
    CKEY ERROR COPY /USER
  ------------------------------------------------------------------------------
   Error matrix --> s
                                                      H.Albrecht  2.1.89
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   TPARSET                                                                         
   QYFIT                                                                           
   QYFITC                                                                          
   QYFITV                                                                          
   QYFTMC                                                                          
        |---- QVGETS.                                                              
   
 
3 QVSCAL
         SUBROUTINE QVSCAL (ITK,FACT)
  ------------------------------------------------------------------------------
    CKEY VECTOR KINEMATICS/USER
  ------------------------------------------------------------------------------
   Momentum(itk) --> momentum(itk) * fact
                                                      H.Albrecht  2.1.89
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   CREFLW                                                                          
   PRESEL                                                                          
   PRESELFW                                                                        
   QIPBTAG                                                                         
   QPCORR                                                                          
        |---- QVSCAL                                                               
                   |----  ABS                                 External             
                   |----  SQRT                                External             
   
 
3 QVSET3
         SUBROUTINE QVSET3 (ITK,P)
  ------------------------------------------------------------------------------
    CKEY VECTOR COPY /USER
  ------------------------------------------------------------------------------
   Array p --> 3-vector(itk)
                                                      H.Albrecht  2.1.89
                                         Modified:    E. Blucher  8.3.90
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
              QVSET3                                                               
                   |----  SQRT                                External             
                   |----  QWMESE                                                   
   
 
3 QVSET4
         SUBROUTINE QVSET4 (ITK,P)
  ------------------------------------------------------------------------------
    CKEY VECTOR COPY /USER
  ------------------------------------------------------------------------------
   Array p --> 4-vector(itk)
                                                      H.Albrecht  2.1.89
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   BUILDAL                                                                         
   MDSTRD                                                                          
        |---- QVSET4                                                               
                   |----  SQRT                                External             
                   |----  QWMESE                                                   
   
 
3 QVSETC
         SUBROUTINE QVSETC (ITK,ACHAR)
  ------------------------------------------------------------------------------
    CKEY VECTOR KINEMATICS /USER
  ------------------------------------------------------------------------------
   Achar   --> charge(itk)
                                                      J.Boucrot 26.10.93
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
              QVSETC                                                               
                   |----  QWMESE                                                   
   
 
3 QVSETM
         SUBROUTINE QVSETM (ITK,AMASS)
  ------------------------------------------------------------------------------
    CKEY MASS KINEMATICS /USER
  ------------------------------------------------------------------------------
   Amass --> mass(itk).
                                                      H.Albrecht  2.1.89
    Modified to get the correct error matrix          P.Heusse   28.4.95
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   QBMTAG                                                                          
   QMASV0                                                                          
        |---- QVSETM                                                               
                   |----  SQRT                                External             
   
 
3 QVSETS
         SUBROUTINE QVSETS (ITK,S)
  ------------------------------------------------------------------------------
    CKEY ERROR COPY /USER
  ------------------------------------------------------------------------------
   Error matrix s --> itk
                                                      H.Albrecht  2.1.89
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
              QVSETS.                                                              
   
 
3 QVSUB
         SUBROUTINE QVSUB (ITKRES,ITKSUM,ITK2)
  ------------------------------------------------------------------------------
    CKEY VECTOR KINEMATICS /USER
  ------------------------------------------------------------------------------
   4-vector(itksum) - 4-vector(itk1) --> 4-vector(itkres)
                                                      H.Albrecht  2.1.89
                                       Modified:      E. Blucher  2.2.92
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
              QVSUB                                                                
                   |----  SQRT                                External             
                   |----  QMTERM                                                   
                   |----  QWMESE                                                   
   
 
3 QVZERO
         SUBROUTINE QVZERO (ITK)
  ------------------------------------------------------------------------------
    CKEY VECTOR TRACKS ZERO /USER
  ------------------------------------------------------------------------------
   Zero track itk.
                                                     H.Albrecht   2.1.89
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   KTLORX                                                                          
   JULMATCH                                                                        
   QBMTAG                                                                          
        |---- QVZERO                                                               
                   |----  QWMESE                                                   
   
 
3 QWCLAS
         SUBROUTINE QWCLAS(IC)
  ------------------------------------------------------------------------------
    CKEY WRITE EDIR /USER
  ------------------------------------------------------------------------------
   Set bits for event directory classification word.
                                            Authors: E. Blucher 16.09.89
                                                     M. Talby
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
              QWCLAS                                                               
                   |----  ABCLAS                              External             
                   |----  QWRITE                                                   
   
 
3 QWERRC
         SUBROUTINE QWERRC (IER, CSUBR, CTYPE)
  ------------------------------------------------------------------------------
    CKEY ERROR CARDS /INTERNAL
  ------------------------------------------------------------------------------
   Print messages for return codes from card reading routines
    from user QMCARD,QUIHIS
                                                     H.Albrecht 20.09.88
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   QMCARD                                                                          
   QMIHIS                                                                          
        |---- QWERRC                                                               
                   |----  LENOCC                              External             
                   |----  QWMESS                                                   
                   |----  QWSYNT                                                   
   
 
3 QWEVNT
         SUBROUTINE QWEVNT
  ------------------------------------------------------------------------------
    CKEY WRITE EVENTS /USER
  ------------------------------------------------------------------------------
   Print all tracks
    from user routines
                                                     H.Albrecht 20.09.88
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   QUEVNT                                                                          
        |---- QWEVNT                                                               
                   |----  SIGN                                External             
                   |----  SQRT                                External             
                   |----  ABS                                 External             
                   |----  NINT                                External             
                   |----  KMATIX                              External             
                   |----  ATG                                 External             
                   |----  KCLARM                              External             
                   |----  IAND                                External             
                   |----  KLOCK0                              External             
                   |----  IABS                                External             
                   |----  QWHEAD                                                   
                   |----  QWSEC                                                    
                   |----  QWNEWTR                                                  
                   |----  QWTREE                                                   
   
 
3 QWFILE
         SUBROUTINE QWFILE
  ------------------------------------------------------------------------------
    CKEY WRITE FILE /USER
  ------------------------------------------------------------------------------
   Print input / output files
    from user routines
                                                     H.Albrecht 06.11.88
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   QMTERM                                                                          
        |---- QWFILE.                                                              
   
 
3 QWHEAD
         SUBROUTINE QWHEAD (COPT,CTXT)
  ------------------------------------------------------------------------------
    CKEY HEADER /USER
  ------------------------------------------------------------------------------
   Print event header
    from user routines
                                                     H.Albrecht 20.09.88
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   QWEVNT                                                                          
        |---- QWHEAD                                                               
                   |----  QFHEAD                                                   
                   |----  INDEX                               External             
                   |----  QWMESS                                                   
                   |----  KUPTERFORMAT                        External             
                   |----  FORMAT                              External             
   
 
3 QWHFUL
         SUBROUTINE QWHFUL (COPT,CTXT)
  ------------------------------------------------------------------------------
    CKEY HEADER /USER
  ------------------------------------------------------------------------------
   Print full event header
    from user routines
                                                     H.Albrecht 20.09.88
                                          Modified:  E.Lancon   19.07.89
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
              QWHFUL                                                               
                   |----  QFHEAD                                                   
                   |----  INDEX                               External             
                   |----  QWMESS                                                   
   
 
3 QWITK
         SUBROUTINE QWITK (ITK,CFL)
  ------------------------------------------------------------------------------
    CKEY WRITE TRACKS /USER
  ------------------------------------------------------------------------------
   Print track itk
    from user routines
                                                     H.Albrecht 20.09.88
                                      Modified:      E.Blucher  02.02.92
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   QWSEC                                                                           
        |---- QWITK                                                                
                   |----  SIGN                                External             
                   |----  SQRT                                External             
                   |----  ABS                                 External             
                   |----  NINT                                External             
                   |----  KMATIX                              External             
                   |----  ATG                                 External             
                   |----  KCLARM                              External             
                   |----  IAND                                External             
                   |----  KLOCK0                              External             
                   |----  IABS                                External             
                   |----  INDEX                               External             
                   |----  CQTPN                                                    
                   |----  ORMAT                               External             
   
 
3 QWIVX
         SUBROUTINE QWIVX (IVX,CFL)
  ------------------------------------------------------------------------------
    CKEY WRITE VERTEX /USER
  ------------------------------------------------------------------------------
   Print vertex ivx
    from user routines
                                                     H.Albrecht 20.09.88
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   QWSEC                                                                           
        |---- QWIVX                                                                
                   |----  SIGN                                External             
                   |----  SQRT                                External             
                   |----  ABS                                 External             
                   |----  NINT                                External             
                   |----  KMATIX                              External             
                   |----  ATG                                 External             
                   |----  KCLARM                              External             
                   |----  IAND                                External             
                   |----  KLOCK0                              External             
                   |----  IABS                                External             
                   |----  INDEX                               External             
                   |----  CQTPN                                                    
                   |----  ORMAT                               External             
   
 
3 QWMESE
         SUBROUTINE QWMESE (TEXT)
  ------------------------------------------------------------------------------
    CKEY WRITE /USER
  ------------------------------------------------------------------------------
   Print message and run/event number.
    from : anywhere
                                                     H.Albrecht 20.09.88
                                           Modified: E. Blucher 31.08.89
   
 
3 QWMESS
         SUBROUTINE QWMESS (TEXT)
  ------------------------------------------------------------------------------
    CKEY WRITE /USER
  ------------------------------------------------------------------------------
   Print message.
    from : anywhere
                                                     H.Albrecht 20.09.88
                                           Modified: E. Blucher 31.08.89
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   MDIPBT                                                                          
   HCALENSC                                                                        
   KMCCOD                                                                          
   KPCOMP                                                                          
   KPCHEK                                                                          
   QADATI                                                                          
   QCORFIC                                                                         
   QFMCBM                                                                          
   QSMCTM                                                                          
   QFPTPX                                                                          
   QHFN                                                                            
   QHFNR                                                                           
   QMBANK                                                                          
   QMCARD                                                                          
   QMDBAS                                                                          
   QMIHIS                                                                          
   QMININC                                                                         
   QMINIT                                                                          
   QMTERM                                                                          
   QUEVNT                                                                          
   QUINIT                                                                          
   QUTERM                                                                          
   QUTHIS                                                                          
   QWERRC                                                                          
   QWHEAD                                                                          
   QWHFUL                                                                          
   QWPARS                                                                          
   QWPART                                                                          
   QWRITE                                                                          
   QWRUNR                                                                          
   QURHAH                                                                          
   QWSYNT                                                                          
   QWTREE                                                                          
   KVFITC                                                                          
   KVFITN                                                                          
   KVFITV                                                                          
   KVFTMC                                                                          
   QLITK                                                                           
   QMASV0                                                                          
        |---- QWMESS                                                               
                   |----  LEN                                 External             
   
 
3 QWNEWTR
         SUBROUTINE QWNEWTR
  ------------------------------------------------------------------------------
    CKEY WRITE EVENT / USER
  ------------------------------------------------------------------------------
   Print alpha new tracking banks in readable format
        J. Boucrot  14-Apr-1997    revised 15-Oct 1997
   
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   QWEVNT                                                                          
        |---- QWNEWTR                                                              
                   |----  SIGN                                External             
                   |----  SQRT                                External             
                   |----  ABS                                 External             
                   |----  NINT                                External             
                   |----  KMATIX                              External             
                   |----  ATG                                 External             
                   |----  KCLARM                              External             
                   |----  IAND                                External             
                   |----  KLOCK0                              External             
                   |----  IABS                                External             
                   |----  IW                                  External             
                   |----  KVTYPE                              External             
                   |----  FORMAT                              External             
                   |----  KVINCP                              External             
                   |----  KVNDAU                              External             
                   |----  VZERO                               External             
                   |----  KVDAU                               External             
                   |----  QVKINK                                                   
                   |----  QKINKV                                                   
                   |----  IIFORMAT                            External             
                   |----  QKINKT                                                   
                   |----  LISKINK                             External             
                   |----  QNUCL                                                    
                   |----  QLV0V                                                    
                   |----  QLV0T                                                    
                   |----  IENDVFORMAT                         External             
                   |----  KNDAU                               External             
                   |----  KDAU                                External             
                   |----  KMOTH                               External             
   
 
3 QWPARS
         SUBROUTINE QWPARS
  ------------------------------------------------------------------------------
    CKEY WRITE PART /USER
  ------------------------------------------------------------------------------
   Print particle table summary
                                                     H.Albrecht 27.11.88
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   QMTERM                                                                          
        |---- QWPARS                                                               
                   |----  SIGN                                External             
                   |----  SQRT                                External             
                   |----  ABS                                 External             
                   |----  NINT                                External             
                   |----  KMATIX                              External             
                   |----  ATG                                 External             
                   |----  KCLARM                              External             
                   |----  IAND                                External             
                   |----  KLOCK0                              External             
                   |----  IABS                                External             
                   |----  QWMESS                                                   
                   |----  CHAINT                              External             
                   |----  QWPART                                                   
   
 
3 QWPART
         SUBROUTINE QWPART (IPC,COPT)
  ------------------------------------------------------------------------------
    CKEY WRITE PART /USER
  ------------------------------------------------------------------------------
   Print row i in bank qpar
                                                     H.Albrecht 27.11.88
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   QWPARS                                                                          
        |---- QWPART                                                               
                   |----  SIGN                                External             
                   |----  SQRT                                External             
                   |----  ABS                                 External             
                   |----  NINT                                External             
                   |----  KMATIX                              External             
                   |----  ATG                                 External             
                   |----  KCLARM                              External             
                   |----  IAND                                External             
                   |----  KLOCK0                              External             
                   |----  IABS                                External             
                   |----  INDEX                               External             
                   |----  QWMESS                                                   
                   |----  CQPART                                                   
                   |----  KCANTI                                                   
   
 
3 QWRITE
         SUBROUTINE QWRITE
  ------------------------------------------------------------------------------
    CKEY WRITE EVENT /USER
  ------------------------------------------------------------------------------
   Event output routine
                                           Authors: H.Albrecht 08.11.88
                                          Modified: E. Blucher 11.05.89
                            Modified for Event Dir. E. Blucher 16.09.89
                               Modified for NanoDST G. Graefe  10.02.95
                            Modified for PVM on SAGA  T. Oest  26.07.95
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   QMEVNT                                                                          
   QMRDSB                                                                          
   QWCLAS                                                                          
        |---- QWRITE                                                               
                   |----  QPVMWR                                                   
                   |----  MINDST                                                   
                   |----  QNEVNT                                                   
                   |----  QWRUNR                                                   
                   |----  BLIST                               External             
                   |----  ABWSEL                              External             
                   |----  QWMESS                                                   
                   |----  QWMESE                                                   
   
 
3 QWRPTPX
         SUBROUTINE QWRPTPX(ier)
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Transfer the tpxs banks to the ptpx banks
   
       Author:   F. Palla 14-Nov-1998
                 Called from QFPTPX
   
       Output:   IER       /I    Error return=0 if operation successful
   
   
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   QFPTPX                                                                          
        |---- QWRPTPX                                                              
                   |----  NAMIND                              External             
                   |----  BDROP                               External             
                   |----  AUBOS                               External             
                   |----  INT                                 External             
                   |----  BLIST                               External             
   
 
3 QWRUNR
         SUBROUTINE QWRUNR
  ------------------------------------------------------------------------------
    CKEY WRITE EVENT /USER
  ------------------------------------------------------------------------------
   Run record output routine
                                           Author : H.Albrecht 06.12.89
                                         Modified : E.Blucher  04.04.90
                                         Modified : J.Boucrot  05.02.91
                                         Modified : E.Blucher  04.09.92
                                         Modified : S.Wasserba 30.10.95
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   QMRDSB                                                                          
   QWRITE                                                                          
        |---- QWRUNR                                                               
                   |----  ALDTYP                              External             
                   |----  BKINCA                              External             
                   |----  INDEX                               External             
                   |----  MINVSN                                                   
                   |----  MINGTV                                                   
                   |----  BKRHAW                              External             
                   |----  QWMESS                                                   
                   |----  BLIST                               External             
                   |----  PRRHAH                              External             
                   |----  ABWSEL                              External             
                   |----  ABCLAS                              External             
   
 
3 QWSEC
         SUBROUTINE QWSEC (NSEC,CFL)
  ------------------------------------------------------------------------------
    CKEY WRITE /INTERNAL
  ------------------------------------------------------------------------------
   Print section nsec
    from user routines
                                                     H.Albrecht 20.09.88
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   QWEVNT                                                                          
   KMLEPT                                                                          
        |---- QWSEC                                                                
                   |----  SIGN                                External             
                   |----  SQRT                                External             
                   |----  ABS                                 External             
                   |----  NINT                                External             
                   |----  KMATIX                              External             
                   |----  ATG                                 External             
                   |----  KCLARM                              External             
                   |----  IAND                                External             
                   |----  KLOCK0                              External             
                   |----  IABS                                External             
                   |----  QWMESE                                                   
                   |----  QWITK                                                    
                   |----  QWIVX                                                    
   
 
3 QWSUMM
         SUBROUTINE QWSUMM
  ------------------------------------------------------------------------------
    CKEY ALPHA WRITE SUMMARY /USER
  ------------------------------------------------------------------------------
   Write out luminosity, hadronic event summary.
   
      Author   :- E. Blucher      7-JUN-1990
                  Modified for Sical Lumi :  J. Boucrot - 3  May 1993
                  Modified for Mini Ramps :  J. Boucrot - 7 June 2000
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   QMTERM                                                                          
        |---- QWSUMM                                                               
                   |----  SQRT                                External             
                   |----  FLOAT                               External             
   
 
3 QWSYNT
         SUBROUTINE QWSYNT (CHAR)
  ------------------------------------------------------------------------------
    CKEY CARDS SYNTAX ERROR /INTERNAL
  ------------------------------------------------------------------------------
   Print syntax error message
    from program initialisation routines
                                                     H.Albrecht 13.11.88
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   QMCARD                                                                          
   QMIHIS                                                                          
   QMPART                                                                          
   QWERRC                                                                          
        |---- QWSYNT                                                               
                   |----  QWMESS                                                   
                   |----  QMTERM                                                   
   
 
3 QWTIME
         SUBROUTINE QWTIME
  ------------------------------------------------------------------------------
    CKEY WRITE TIME /USER
  ------------------------------------------------------------------------------
   Print time consumption
                                                     H.Albrecht 06.11.88
                            Modified for PVM on SAGA  T. Oest  26.07.95
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   QMTERM                                                                          
        |---- QWTIME                                                               
                   |----  TIMEL                               External             
                   |----  TIMEX                               External             
                   |----  QPVMTI                                                   
   
 
3 QWTREE
         SUBROUTINE QWTREE (ITK,CFL)
  ------------------------------------------------------------------------------
    CKEY WRITE TREE /USER
  ------------------------------------------------------------------------------
   Print tree of daughters for track itk
    from user routines
                                                     H.Albrecht 20.10.88
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   QWEVNT                                                                          
        |---- QWTREE                                                               
                   |----  SIGN                                External             
                   |----  SQRT                                External             
                   |----  ABS                                 External             
                   |----  NINT                                External             
                   |----  KMATIX                              External             
                   |----  ATG                                 External             
                   |----  KCLARM                              External             
                   |----  IAND                                External             
                   |----  KLOCK0                              External             
                   |----  IABS                                External             
                   |----  INDEX                               External             
                   |----  CQTPN                                                    
                   |----  QWMESS                                                   
   
 
3 VDFIXZ
          SUBROUTINE VDFIXZ
  ------------------------------------------------------------------------------
    CKEY V_DECK VDET
  ------------------------------------------------------------------------------
   Correct for cos theta dependent zshift of vdet hits
   
   -  Author         Alain Bonissent 10 July 2000
   
   
   
   
   
   
   
   
   
   
   
   
   
   
   
   
   
   
   
   
   
   
   
   
   
   
   
   
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   QUREFIT                                                                         
        |---- VDFIXZ                                                               
                   |----  VDYEAR                              External             
                   |----  NAMIND                              External             
                   |----  JUNIDB                              External             
                   |----  MDARD                               External             
                   |----  VADEWA                              External             
                   |----  VFWAFF                              External             
                   |----  VJWFFW                              External             
                   |----  VVUWXY                              External             
                   |----  SQRT                                External             
                   |----  SIGN                                External             
                   |----  RERROR                              External             
   

2 QFN

  >>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>
    CKEY 
      First entry of <QFNBTAG> set of ALPHA QFNDIP + QIPBTAG routines
       Please read the Aleph Note 92-47 ( March 1992 ) from D. Brown
       before using the QFNDIP package
       and  read the Aleph Note 92-124 ( August 1992 ) from D. Brown and M. Frank
       before using the QIPBTAG package
    
       Important modifications on 20-April 1999 for ALPHA 124.05 
       --> Please read alpha.news
    
  <<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<
     BTAGEV     Probability for a jet to come from a b-quark
     BTAGFIT    Fit the negative dmin/sig spectrum to determine the track resolution,
     BTAGINIT   Define cuts and histos for qipbtag
     BTAGPARNEW1 Define cuts for qipbtag
     BTAGPARNEW2 Define cuts for qipbtag
     BTAGPAROLD Define cuts for qipbtag
     BTAGTR     Calculate the probability of the track to come from ip
     BTVDHITS   Simple subroutine to count the number of vdet hits by layer and view.
     CHIV0      Compute the chisquared for a v0 candidate, given an initial
     CODSEL     Selects john carrs modifications depending on year and cards
     DMIN2D     Finds the point of closest approach between a track and the ip in 2 d
     DMIN3D     Finds the point of closest approach between a track and the ip in 3 d
     DMINERR    Calculate the error on the impact parameter
     FINDDMIN   Find the minimum distance between a track and the ip,
     FINDIP     A standalone routine to find the interaction point, given the beamspot,
     FITDMIN    Fit the dmin/sig spectrum to the standard function
     GTIPBK     Read in the given bank into array(ndim,*).
     IPTRK      Entry point for calculating the effect of removing a single track
     JETCLU     Jet clustering for qfndip and qipbtag
     JETERR     Error on jet angular resolution
     MAKE2D     Convert a 3-d track into a 2-d
     MYSMEAR 
     QBEAMX     Metachunk size of luminous region (x direction)
     QFNDIP     Find the event interaction point in alpha
     QFNDV0     Find v0s for the qipbtag package
     QIPBTAG    User routine for the b-tagging by the impact parameter method
     QIPBTCPU   Determine cpu time usage for qipbtag subroutines
     QSMEAR     Smear results of qipbtag to correct impact parameter resolution
     SMCOPY     Make copy of qipbtag track information. auxiliary to qsmear.
     TCROSS     Finds the point of closest approach between a track helix and a line
     TMOVE      Re-define the track parameters relative to a new point in space.
     TPARSET    Pack  alpha track parameters into the arrays needed by qipbtag
     TROT       Rotate the track error matrix from the phi-theta coordinate
     TRSEL      Select tracks for impact parameter physics, and pack them into a loca
     TRSEL2     Final track selection, based on the final impact parameter.
     V0DKPT     Crude topological vertex, to seed other calculations
     V0KINE     Compute some kinematic information for a pair of v0 candidate tracks
     V0TPAR     Calculate the track parameters for a v0 candidate.

3 BTAGEV
         SUBROUTINE BTAGEV (NTRACK,NJET,JJET,JHEMI,PTRACK,NEGPROB,
  ------------------------------------------------------------------------------
    CKEY   QIPBTAG / INTERNAL
  ------------------------------------------------------------------------------
        >                   PROBJET,PROBHEMI,PROBEVT)
   Probability for a jet to come from a b-quark
    Called from QIPBTAG
    SUBROUTINE BTAGEV
    =================
       PURPOSE :
               calculate the probability of a jet to have the origine
               in a B-Quark from the probabilities of the tracks
       INPUT :
               NTRACK               Number of good tracks
               NJET                 Number of good jets
               PTRACK(1:ntrack)     array with track-probabilities
               JJET(1:ntrack)       Assignment of tracks to jets
               JHEMI(1:ntrack)      Assignment of tracks to hemispheres
               NEGPROB              Flag whether to use negative tracks
       OUTPUT :
               PROBJET(1:njet)      probability for each jet
               PROBHEMI(1:2)        probability for hemispheres
               PROBEVT              probability for event
       CALLS   : VZERO
                                        D. Brown,  M.Frank 13/1/92
            revisions
               D. BROWN 19-1-92       Add JJET,JHEMI,PWIND,PCUT  as arguments
                        11-2-92       Protect factorials
               M. FRANK 23-3-92       Protect exponentials
               D. Brown 14-10-92      Protect agains underflows
               D. Rousseau 7-5-93     Implement negative track probabilities
               I. Tomalin  17-1-96    Protect against PROBEVT = 0 etc.
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   QIPBTAG                                                                         
   QSMEAR                                                                          
        |---- BTAGEV                                                               
                   |----  LOG                                 External             
                   |----  FLOAT                               External             
                   |----  VZERO                               External             
                   |----  MIN                                 External             
                   |----  EXP                                 External             
                   |----  MAX                                 External             
   
 
3 BTAGFIT
         SUBROUTINE BTAG_FIT(FILE)
  ------------------------------------------------------------------------------
    CKEY   QIPBTAG / USER
  ------------------------------------------------------------------------------
   Fit the negative dmin/sig spectrum to determine the track resolution,
    pack the parameters into the appropriate banks, and write them out.
    May be called by the user at the end of his job
    Author  Dave Brown  29-1-93
       Input;  FILE   File name of the card file to be created.  If
                      this is blank or equal to "NONE", the card file
                      will appear on unit 32
   
 
3 BTAGINIT
         SUBROUTINE BTAG_INIT
  ------------------------------------------------------------------------------
    CKEY   QIPBTAG / INTERNAL
  ------------------------------------------------------------------------------
   Define cuts and histos for qipbtag
    Called from QIPBTAG
    read the cuts used for the B-tagging and then store them
    All cards are now optional.
    Author  Dave Brown  29-1-93
    MODIFIED:
    ---------
    03/05/95  Stephan Schael, L_SCUT CHANGED FROM 2.0/3.0 TO 1.3/1.3
    07/11/95  Stephan Schael, data card to read in NUMJET
    Modified  Manoj Thulasidas  Dec. 8, 1997
        Read in the calibration from QIPC - database bank
    Modified Ian Tomalin 8-3-99: Old btagpar96 code greatly streamlined
                                 and included directly here.
    Modified P-F Giraud 17-8-99: New numbering convention
                                 for CALB histograms
   
 
3 BTAGPARNEW1
         SUBROUTINE BTAGPAR_NEW1
  ------------------------------------------------------------------------------
    CKEY   QIPBTAG / INTERNAL
  ------------------------------------------------------------------------------
   Define cuts for qipbtag
    Called from BTAG_INIT
    read the cuts used for the B-tagging and then store them
    (new version of code, with track selection cuts for old VDET).
    Author  Dave Brown  29-1-93
    MODIFIED:
    ---------
    03/05/95  Stephan Schael, L_SCUT CHANGED FROM 2.0/3.0 TO 1.3/1.3
    07/11/95  Stephan Schael, data card to read in NUMJET
    Modified  Manoj Thulasidas  Dec. 8, 1997
        Read in the calibration from QIPC - database bank
    Modified Ian Tomalin 8-3-99: Some code moved to BTAG_INIT
    Modified P.-F. Giraud 17-8-99: Added option to gtipbk
   
   
 
3 BTAGPARNEW2
         SUBROUTINE BTAGPAR_NEW2
  ------------------------------------------------------------------------------
    CKEY   QIPBTAG / INTERNAL
  ------------------------------------------------------------------------------
   Define cuts for qipbtag
    Called from BTAG_INIT
    read the cuts used for the B-tagging and then store them
    (new version of code, with track selection cuts for new VDET).
    Author  Dave Brown  29-1-93
    MODIFIED:
    ---------
    03/05/95  Stephan Schael, L_SCUT CHANGED FROM 2.0/3.0 TO 1.3/1.3
    07/11/95  Stephan Schael, data card to read in NUMJET
    Modified  Manoj Thulasidas  Dec. 8, 1997
        Read in the calibration from QIPC - database bank
    Modified Ian Tomalin 8-3-99: Some code moved to BTAG_INIT
    Modified P.-F. Giraud 17-8-99: Added option to gtipbk
   
   
 
3 BTAGPAROLD
         SUBROUTINE BTAGPAR_OLD
  ------------------------------------------------------------------------------
    CKEY   QIPBTAG / INTERNAL
  ------------------------------------------------------------------------------
   Define cuts for qipbtag
    Called from BTAG_INIT
    read the cuts used for the B-tagging and then store them
    (old version of code).
    Author  Dave Brown  29-1-93
    MODIFIED:
    ---------
    03/05/95  Stephan Schael, L_SCUT CHANGED FROM 2.0/3.0 TO 1.3/1.3
    07/11/95  Stephan Schael, data card to read in NUMJET
    Modified Ian Tomalin 8-3-99: Some code moved to BTAG_INIT
   
   
 
3 BTAGTR
         SUBROUTINE BTAGTR(FITP,NTRACK,DMIN,S_DMIN,TFLAG,PROBTRK)
  ------------------------------------------------------------------------------
    CKEY   QIPBTAG / INTERNAL
  ------------------------------------------------------------------------------
   Calculate the probability of the track to come from ip
    Called from QIPBTAG
    Author  Dave Brown  29-1-93
    SUBROUTINE BTAGTR
    ==================
    INPUT :
            FITP      #koeffizents of track fit polynomial...
            NTRACK == # OF TRACKS PASSED FOR ANALYSIS
            DMIN(i)                                           i=1,ntrack
            --  distance of track from the primary vertex
            S_DMIN(i)                                         i=1,ntrack
            --  error on this distance
            TFLAG(i)                                         i=1,ntrack
            --  flag for this track
   
            PROBTRK(i)
            --  probability of a track
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   QIPBTAG                                                                         
   QSMEAR                                                                          
        |---- BTAGTR                                                               
                   |----  IAND                                External             
                   |----  ISHFT                               External             
                   |----  EXP                                 External             
                   |----  MIN                                 External             
                   |----  ABS                                 External             
   
 
3 BTVDHITS
         SUBROUTINE BTVDHITS(HITPAT)
  ------------------------------------------------------------------------------
    CKEY   QIPBTAG / INTERNAL
  ------------------------------------------------------------------------------
   Simple subroutine to count the number of vdet hits by layer and view.
    Called from TRSEL or QFNDV0
    Input: none
            calls VDHITS if POT or DST as input file .
            else take information from bank DTRA
    Output: HITPAT, an integer array numbered by FRFT track number,
            of which only the first 8 bits are used, as described below
            bits:          meaning
            0-1            number of inner layer U hits on track (0,1,or2)
            2-3            number of outer layer U hits on track     "
            4-5            number of inner layer W hits on track     "
            6-7            number of outer layer W hits on track     "
            This array must have size at least as large as the number of
            entries in FRFT; NO CHECK CAN BE MADE HERE, if this isn't
            the case, the code will bomb.
    created : 24-4-92 M.Frank : READ DTRA bank on mini-dst !
    Modified  21-10-93 D. Brown, look at mini version to
                                            decide which word to use
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   QFNDV0                                                                          
   QIPBTAG                                                                         
        |---- BTVDHITS                                                             
                   |----  SIGN                                External             
                   |----  SQRT                                External             
                   |----  ABS                                 External             
                   |----  NINT                                External             
                   |----  KMATIX                              External             
                   |----  ATG                                 External             
                   |----  KCLARM                              External             
                   |----  IAND                                External             
                   |----  KLOCK0                              External             
                   |----  IABS                                External             
                   |----  NAMIND                              External             
                   |----  MINGTV                                                   
                   |----  VDHITS                              External             
   
 
3 CHIV0
         SUBROUTINE CHIV0(IFRFT,IROW,MOM,D,M2,SM2,
  ------------------------------------------------------------------------------
    CKEY   QIPBTAG / INTERNAL
  ------------------------------------------------------------------------------
        &  CHISQ,POINT,DERR,V0MOM,TMOM,IERROR)
   Compute the chisquared for a v0 candidate, given an initial
    estimate of the decay point.
    Author                                                D. Brown 6-9-93
    Called from QFNDV0
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   QFNDV0                                                                          
        |---- CHIV0                                                                
                   |----  TMOVE                                                    
                   |----  V0KINE                                                   
                   |----  RSINV                               External             
                   |----  MAX                                 External             
                   |----  SQRT                                External             
   
 
3 CODSEL
         SUBROUTINE CODSEL(NEWCOD)
  ------------------------------------------------------------------------------
    CKEY   QIPBTAG / INTERNAL
  ------------------------------------------------------------------------------
   Selects john carrs modifications depending on year and cards
    Manoj Thulasidas 13-2-97
    Mod. Ian Tomalin 10/3/99 - New code used by default.
    Called from QIPBTAG and TRSEL
    OUTPUT:
           NEWCOD     : logical, true if new code is called for
   
   
   
   
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   BTAG_INIT                                                                       
   FIT_DMIN                                                                        
   QIPBTAG                                                                         
   TRSEL                                                                           
        |---- CODSEL                                                               
                   |----  VDYEAR                              External             
                   |----  GETJUV                                                   
                   |----  NAMIND                              External             
   
 
3 DMIN2D
         SUBROUTINE DMIN2D(IFLAG,TPAR,IP,J1,JDIST,DMIN,SDIST,PERP)
  ------------------------------------------------------------------------------
    CKEY   QIPBTAG / INTERNAL
  ------------------------------------------------------------------------------
   Finds the point of closest approach between a track and the ip in 2 d
    Author   Dave Brown 10-12-93
    INPUTS
       IFLAG  :  1 (2) means r-phi (r-z) view
       TPAR  :  Standard 5-parameter track description
       IP    :  Interaction point
       J1   :  Unit vector in the associated jet direction
    OUTPUTS
       JDIST :  Distance between IP and closest approach between the
                track and the jet along jet direction
       DMIN  :  Distance between track and IP at closest approach
       SDIST :  Distance along track at closest approach to the IP
       PERP  :  Direction between track and IP at closest approach
    Called from FINDDMIN or MAKE2D
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   FINDDMIN                                                                        
   MAKE2D                                                                          
        |---- DMIN2D                                                               
                   |----  SQRT                                External             
                   |----  COS                                 External             
                   |----  SIN                                 External             
                   |----  SIGN                                External             
   
 
3 DMIN3D
         SUBROUTINE DMIN3D(TPAR,IP,J1,JDIST,DMIN,LDIST,SDIST,PERP,JPERP)
  ------------------------------------------------------------------------------
    CKEY   QIPBTAG / INTERNAL
  ------------------------------------------------------------------------------
   Finds the point of closest approach between a track and the ip in 3 d
    Author                                            Dave Brown, 13-4-92
    INPUTS
       TPAR  :  Standard 5-parameter track description
       IP    :  Interaction point
       J1   :  Unit vector in the associated jet direction
    OUTPUTS
       JDIST :  Distance between IP and closest approach between the
                track and the jet along jet direction
       DMIN  :  Distance between track and IP at closest approach
       LDIST :  Distance between track and jet at closest approach
       SDIST :  Distance along track at closest approach to the IP
       PERP  :  Direction between track and IP at closest approach
       JPERP :  Direction between track and jet at closest approach
    Called from FINDDMIN
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   FINDDMIN                                                                        
        |---- DMIN3D                                                               
                   |----  SQRT                                External             
                   |----  COS                                 External             
                   |----  SIN                                 External             
                   |----  MAX                                 External             
                   |----  SIGN                                External             
   
 
3 DMINERR
         SUBROUTINE DMINERR(TPAR,TERR,PERP,JPERP,JETSIG2,JDIST,
  ------------------------------------------------------------------------------
    CKEY   QIPBTAG / INTERNAL
  ------------------------------------------------------------------------------
        &     SDIST,SIG2_IP,S_DMIN,S_LDIST,PHIP)
   Calculate the error on the impact parameter
     Author  Dave Brown, 11-12-93
    INPUTS
          TPAR    :  Standard 5 track parameters
          TERR    :  Track parameter errors in 4X4 form
          T1      :  Unit vector in track direction
          PERP    :  Unit vector in the impact parameter direction
          JPERP   :  Unit vector in the track-jet closest approach direction
          JETSIG2 :  Angular error on jet direction
          JDIST   :  Distance along jet of track-jet closest approach
          SDIST   :  Distance along track of track-IP closest approach
          SIG2_IP :  Primary vertex error matrix
    OUTPUTS
          S_DMIN  :  Error on impact parameter
          S_LDIST :  Error on track-jet approach distance
          PHIP    :  Angle of impact parameter at jet closest approach
    Called from FINDDMIN or MAKE2D
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   FINDDMIN                                                                        
   MAKE2D                                                                          
        |---- DMINERR                                                              
                   |----  SQRT                                External             
                   |----  COS                                 External             
                   |----  SIN                                 External             
                   |----  ATAN2                               External             
                   |----  MAX                                 External             
   
 
3 FINDDMIN
         SUBROUTINE FINDDMIN(NTRACK,FRF2TRK,TPAR,TERR,NJET,JETS,JJET,TFLAG,
  ------------------------------------------------------------------------------
    CKEY   QIPBTAG / INTERNAL
  ------------------------------------------------------------------------------
        &     NDAU,TRKDAU,DMIN,S_DMIN,PHIP,JDIST,LDIST,S_LDIST,PERP)
   Find the minimum distance between a track and the ip,
     with its error,sign and direction, plus related information.
    Called from QIPBTAG
    Author                                               Dave Brown 8-12-91
    Inputs;
            NTRACK       Number of tracks
            FRF2TRK      FRFT number of track
            TPAR         Track parameters
            TERR         linear track matrix
            NJET         Number of jets
            JETS         Jet momentum vector
            JJET         Jet-track association pointer
            TFLAG        Track flag
            NDAU         # of 'daughter' tracks (=1 for normal tracks)
            TRKDAU       Track #s of daughter tracks
    Outputs;
            DMIN         Distance of closest approach to IP
            S_DMIN       Error on distance of closest approach to IP
            PHIP         Angle of closest approach to jet in track frame
            JDIST        Distance along jet axis from IP at closest approach
            LDIST        Distance of closest approach to jet axis
            S_LDIST      Error on distance of closest approach to jet axis
            PERP         Unit vector in direction of closest approach vector
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   QIPBTAG                                                                         
        |---- FINDDMIN                                                             
                   |----  IAND                                External             
                   |----  ISHFT                               External             
                   |----  SQRT                                External             
                   |----  JETERR                                                   
                   |----  IPTRK                                                    
                   |----  DMIN3D                                                   
                   |----  DMIN2D                                                   
                   |----  DMINERR                                                  
   
 
3 FINDIP
         SUBROUTINE FINDIP(BP,SIG2_BP,NJET,JETS,NTRACK,TPAR,TERR,IGOOD,
  ------------------------------------------------------------------------------
    CKEY   QFNDIP  / INTERNAL
  ------------------------------------------------------------------------------
        & IP,IP_ERR,CHI2_DOF,NUSED)
   A standalone routine to find the interaction point, given the beamspot,
    the jet axes, and the tracks.  See ALEPH note 92-47 for a description.
    Called from  QFNDIP
    Updated 15-9-93 Dave Brown, jet error parameterized, vector calculation
    simplified, chisquared calculation simplified, some cuts retuned.
    Modified: 15-10-97 (Nikos Konstantinidis)
    Added card DWIN to control the use of the longitudinal component of
    tracks. Usage of card:
    DWIN USE_LONG WINDOW
    If USE_LONG=1, use tracks with: Distance(track-jet) < WINDOW
    If USE_LONG=2, use tracks with: ABS(Distance(track-jet)) < WINDOW
    If DWIN is absent or USE_LONG=1 and WINDOW=0.0, the user gets
    the standard QFNDIP results.
    Recommended for LEP2:
    DWIN  1  0.035
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   QFNDIP                                                                          
        |---- FINDIP                                                               
                   |----  IAND                                External             
                   |----  ISHFT                               External             
                   |----  NAMIND                              External             
                   |----  SQRT                                External             
                   |----  JETERR                                                   
                   |----  SIGN                                External             
                   |----  COS                                 External             
                   |----  SIN                                 External             
                   |----  ACOS                                External             
                   |----  MIN                                 External             
                   |----  TROT                                                     
                   |----  RSINV                               External             
                   |----  ABS                                 External             
                   |----  MAX                                 External             
   
 
3 FITDMIN
         SUBROUTINE FIT_DMIN(ITYPE,NUMVIEW,OUTPAR,OUTERR,CHISQ,NOENT)
  ------------------------------------------------------------------------------
    CKEY   QIPBTAG / INTERNAL
  ------------------------------------------------------------------------------
   Fit the dmin/sig spectrum to the standard function
    Called from BTAG_FIT
    Author  Dave Brown  29-1-93
    Modified Ian Tomalin 7-7-95: Limits changed for simple fit to
                                 prevent crashing.
    Modified Ian Tomalin 8-3-99: Old fit_dmin96 code greatly streamlined
                                 and included directly here.
    Modified P-F Giraud 17-8-99: New histogram numbering convention.
   
 
3 GTIPBK
         SUBROUTINE GTIPBK(NDIM,ARRAY,BANK,OLDBNK,NOPT)
  ------------------------------------------------------------------------------
    CKEY   QIPBTAG / INTERNAL
  ------------------------------------------------------------------------------
   Read in the given bank into array(ndim,*).
    Issue warnings if the obselete OLDBNK is given as cards
    eg:  Read in calibration from the database bank QIPC, issue warnings if
    obselete cards FITP are given or information is missing.
    Author  Manoj Thulasidas  Dec. 8, 1997
    Modified 17-08-99 P-F Giraud : able to read smearing parameters
    NOPT = 0 for QIPBTAG calibration
         = 1 for smearing/deletion cards, QIPBTAG1
         = 2 for smearing/deletion cards, QIPBTAG2
       Output:  FITP  10x6 calibration constants
   
 
3 IPTRK
         SUBROUTINE IPTRK(NTRK,JTRK,IP,IP_ERR,NUSED)
  ------------------------------------------------------------------------------
    CKEY   QIPBTAG / INTERNAL
  ------------------------------------------------------------------------------
   Entry point for calculating the effect of removing a single track
    from an existing vertex.  This relies on a valid vertex to have already
    been found.  Dave Brown, 29-1-93
    Called from FINDDMIN or MAKE2D
    INPUTS:
       NTRK     =  # of tracks to exclude
       JTRK     =  FRFT track number of tracks to exclude from vertex
                   (=ALPHA track number - KFCHT + 1).
    Outputs:
        IP      =  New primary vertex position.  If the given track wasn't
                   used in the vertex fit, this will be the same as the
                   original.
      IP_ERR    =  Error matrix of above vertex.
      NUSED     =  Number of tracks used in the 2 different directions.
                   Compared with the NUSED returned by QFNDIP, this allows
                   you to know in which degrees of freedom the given
                   track participated for the original vertex fit.
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   FINDDMIN                                                                        
   MAKE2D                                                                          
        |---- IPTRK                                                                
                   |----  IAND                                External             
                   |----  ISHFT                               External             
                   |----  RSINV                               External             
   
 
3 JETCLU
         SUBROUTINE JETCLU(CNAM,PCUT,NJET,JETS,TRKJ )
  ------------------------------------------------------------------------------
    CKEY   QFNDIP  QIPBTAG / INTERNAL
  ------------------------------------------------------------------------------
   Jet clustering for qfndip and qipbtag
    New version of jet clustering routine;  Use standard (ENFLW) energy
    flow, jet algorithm (QJMMCL, E=ELEP), ycut (.01).  This will
    use DJET banks if they exist, otherwise raw ENFLW objects.  Note that
    a cut is used to define the jets so that THE LIST OF JETS IS NOT
    COMPLETE.  The jets returned are useful (high momentum) jets for
    many applicateions.
    Called from QFNDIP or QIPBTAG
                                                 Dave Brown, 29,1,93
    Modified 15-9-93 Dave Brown, ycut=0.01, jet vector not normalized.
       INPUT:
          CNAM     :   Name of output ALPHA jet objects
          PCUT     :   Minimal Jet momentum
       OUTPUT:
          NJET     :   Number of jets found
                        (momentum ordered, P>cut)
          JETS     :   3-Momentum of the jets   i=1,njet
          TRKJ     :   ALPHA track # of jet with number i
      CALLS :
        CALL SORTZV
        CALL QJOPTR
        CALL QJMMCL
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   QFNDIP                                                                          
   QIPBTAG                                                                         
        |---- JETCLU                                                               
                   |----  SIGN                                External             
                   |----  SQRT                                External             
                   |----  ABS                                 External             
                   |----  NINT                                External             
                   |----  KMATIX                              External             
                   |----  ATG                                 External             
                   |----  KCLARM                              External             
                   |----  IAND                                External             
                   |----  KLOCK0                              External             
                   |----  IABS                                External             
                   |----  QVDROP                                                   
                   |----  QJOPTR                                                   
                   |----  QJMMCL                                                   
                   |----  KPDIR                                                    
                   |----  SORTZV                              External             
   
 
3 JETERR
         SUBROUTINE JETERR(NJET,JETS,JET_SIG2)
  ------------------------------------------------------------------------------
    CKEY   QFNDIP  QIPBTAG / INTERNAL
  ------------------------------------------------------------------------------
   Error on jet angular resolution
    Give the error on the jet angular resolution (relative
    to the b meson in Zbb events) as a function of their
    momentum.  Dave Brown, 15-10-93
    Called from FINDIP or FINDDMIN
    INPUTS; NJET, JETS   :  # and jet momentum vectors
    OUTPUTS; JET_SIG2    :  Array of squares of jet angular resolution (radians)
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   BTAG_INIT                                                                       
   FINDDMIN                                                                        
   FINDIP                                                                          
   MAKE2D                                                                          
        |---- JETERR                                                               
                   |----  MIN                                 External             
                   |----  SQRT                                External             
   
 
3 MAKE2D
         SUBROUTINE MAKE2D(IFRFT,TPAR,TERR,TFLAG,JETS,PHIP,PERP,
  ------------------------------------------------------------------------------
    CKEY   QIPBTAG / INTERNAL
  ------------------------------------------------------------------------------
        &     JDIST,DMIN,S_DMIN)
   Convert a 3-d track into a 2-d
     Author  Dave Brown, 11-12-93
     Called from TRSEL2
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   TRSEL2                                                                          
        |---- MAKE2D                                                               
                   |----  IAND                                External             
                   |----  ISHFT                               External             
                   |----  IPTRK                                                    
                   |----  SQRT                                External             
                   |----  JETERR                                                   
                   |----  ABS                                 External             
                   |----  DMIN2D                                                   
                   |----  DMINERR                                                  
   
 
3 MYSMEAR
         SUBROUTINE MYSMEAR(QSMPAR,PROB,ISBIN,IVIEW,DMIN,S_DMIN)
  ------------------------------------------------------------------------------
    CKEY QIPBTAG / INTERNAL
  ------------------------------------------------------------------------------
   Auxiliary to QSMEAR (QIPBTAG package)
    Generate a smearing value for the impact parameter significance,
    based on a delta function plus exponential fit comparing the
    negative impact parameter spectrum between data and MC.
    Uses random number generator.
    Author:   Dave Brown, 24-3-92
    Modified: Ian Tomalin 27-4-95
    Modified: P-F Giraud 17-8-99
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   QSMEAR                                                                          
        |---- MYSMEAR                                                              
                   |----  SIGN                                External             
                   |----  SQRT                                External             
                   |----  ABS                                 External             
                   |----  NINT                                External             
                   |----  KMATIX                              External             
                   |----  ATG                                 External             
                   |----  KCLARM                              External             
                   |----  IAND                                External             
                   |----  KLOCK0                              External             
                   |----  IABS                                External             
                   |----  LOG                                 External             
                   |----  MAX                                 External             
   
 
3 QBEAMX
         SUBROUTINE QBEAMX (IRUN, IEVT, IRET, SIGX)
  ------------------------------------------------------------------------------
    CKEY BEAMSPOT / USER
  ------------------------------------------------------------------------------
   Metachunk size of luminous region (x direction)
   - Steve Wasserbaech, 12 September 1995
     Modified J. Boucrot 8 October 1998 for ALPHA 123
      (read the beam.position file if necessary)
     The Alpha array QVTSBP (filled by Qfget_bp) provides an average
     horizontal beam size sigma_x for each year. QBEAMX is designed
     to provide run/event-dependent sigma_x values for the real data
     and to provide corresponding information for Monte Carlo.
     For real data:
     The measured value of SIGX is taken from the WIDE bank.  A bias
     correction (from VBWP) is applied.
     For Monte Carlo:
     The value of sigma_x thrown in Qfget_bp is recovered by means of
     the entry QFMCSX.  NEVE, the number of events in the "metachunk,"
     is thrown according to the distribution in the real data, as found
     in the WIDN bank.  The value of sigma_x is smeared according to
     the resolution (as a function of NEVE, with parameters in VBWP)
     and the result is returned in SIGX.
   - Input:
     IRUN  / I  Run number
     IEVT  / I  Event number
   - Output:
     IRET  / I  Return code
                 =0  OK
                 =1  Error reading ALRP or VBWP from database
                 =2  GET_BP information not available
                       for this event (XGETBP = .FALSE.)
                 =3  BSIZ in use or 1989/1990 MC file
                 =4  Setup not found in ALRP
                 =5  Invalid LEP era number in ALRP
                 =6  WIDN bank not found
                 =7  WIDE bank not found
                 =8  No WIDE information for this event
     SIGX  / R  sigma_x of luminous region (cm)
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
              QBEAMX                                                               
                   |----  SIGN                                External             
                   |----  SQRT                                External             
                   |----  ABS                                 External             
                   |----  NINT                                External             
                   |----  KMATIX                              External             
                   |----  ATG                                 External             
                   |----  KCLARM                              External             
                   |----  IAND                                External             
                   |----  KLOCK0                              External             
                   |----  IABS                                External             
                   |----  ISHFT                               External             
                   |----  NAMIND                              External             
                   |----  BDROP                               External             
                   |----  AOPEN                               External             
                   |----  MRESET                              External             
                   |----  BREADC                              External             
                   |----  ACLOSE                              External             
                   |----  JUNIDB                              External             
                   |----  MDARD                               External             
                   |----  QFMCSX                                                   
                   |----  NLINK                               External             
                   |----  MOD                                 External             
                   |----  RMARIN                              External             
                   |----  RANMAR                              External             
                   |----  RNORML                              External             
                   |----  QVTSBP                              External             
                   |----  FLOAT                               External             
                   |----  AMAX1                               External             
                   |----  GTSTUP                              External             
                   |----  MAX                                 External             
                   |----  MIN                                 External             
   
 
3 QFNDIP
         SUBROUTINE QFNDIP(BP,SIG2_BP,NJET,JETS,
  ------------------------------------------------------------------------------
    CKEY   QFNDIP  / USER
  ------------------------------------------------------------------------------
        & IP,IP_ERR,CHI2_DOF,NUSED)
   Find the event interaction point in alpha
    Called from QFILBP , or directly by the user
      An ALPHA routine to find the interaction point, given the beamspot,
    the jet axes, and the tracks.  See ALEPH note 92-47 for a description.
    This is version 2.0, incorporating some new features from what's
    described in the aleph note.  The changes are all BACKWARDS COMPATIBLE,
    so you don't have to change your code if you don't want to.  The
    chief benifits are to have automatic beamspot and jet finding, and
    an entry point which allows a fast re-calculation of the vertex and
    it's error matrix excluding a single, given track.
       Dave Brown, 29-1-93
    Updated 15-9-93 Dave Brown, use ycut=0.01 and parameterize the jet
    angular error as a function of jet momentum.
    Inputs;
       BP(3),SIG2_BP(3)  :  Beam spot position and elipsoid.  The elipsoid
                            should be the convolution of both the size
                            of the luminous region with the position
                            measurement error.  Z isn't really used, but
                            formally it has to be there.
                            IF YOU ENTER SIG2_BP(1)<0.0, THIS CODE WILL
                            FIND THE BEAMSPOT FOR YOU WITH GET_BP, and
                            RETURN IT AS OUTPUT.  If the GET_BP call fails,
                            NUSED will be returned as 0,0
       NJET,JETS         :  Number of jets and unit vectors of their momentum
                            direction.
                            IF YOU ENTER NJET<=0, THIS CODE WILL FIND THE
                            JETS FOR YOU using an optimized algorithm and
                            whatever EFLW objects you have specified in
                            your alpha cards (EFLJ means to cluster up the
                            existing DJET jets, EFLW means to start with
                            raw energy flow objects.  EFLJ is recommended,
                            as being faster.).  IF the jetfinding fails,
                            NUSED will be returned as 0,0.
                            The found jets will be returned with NJET and
                            JETS, and the ALPHA 'tracks' can be accessed
                            as objects "QIPBJETS"
    Outputs;
       IP,IP_ERR,CHI2_DOF   The found vertex, its correlation matrix, and the
                            CHI2/DOF of the "fit".
       NUSED                The number of tracks used in the "fit", separated
                            along the "transverse" and "longitudinal"
                            directions.  Also used as an error flag (0,0).
   
 
3 QFNDV0
         SUBROUTINE QFNDV0(IP,IPERR,
  ------------------------------------------------------------------------------
    CKEY   QIPBTAG / INTERNAL
  ------------------------------------------------------------------------------
        & NFND,V0TYPE,V0PAIR,V0PAT,V0DK,V0DERR,V0PROB,V0PAR,V0ERR)
   Find v0s for the qipbtag package
    Called from QIPBTAG
    Author                                            Dave Brown, 13-4-92
    mod : replace QDEDXM -> QDEDX                  Stefan Schael, 23-7-95
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   QIPBTAG                                                                         
        |---- QFNDV0                                                               
                   |----  IAND                                External             
                   |----  ISHFT                               External             
                   |----  SIGN                                External             
                   |----  SQRT                                External             
                   |----  ABS                                 External             
                   |----  NINT                                External             
                   |----  KMATIX                              External             
                   |----  ATG                                 External             
                   |----  KCLARM                              External             
                   |----  KLOCK0                              External             
                   |----  IABS                                External             
                   |----  NAMIND                              External             
                   |----  BTVDHITS                                                 
                   |----  QDEDX                                                    
                   |----  V0DKPT                                                   
                   |----  PROB                                External             
                   |----  MAX                                 External             
                   |----  CHIV0                                                    
                   |----  V0TPAR                                                   
   
 
3 QIPBTAG
         SUBROUTINE QIPBTAG (IRET,NTRACK,NJET,TRKJET,FRF2TRK,
  ------------------------------------------------------------------------------
    CKEY   QIPBTAG / USER
  ------------------------------------------------------------------------------
        &                   PROBTRK,PROBJET,PROBHEMI,PROBEVT)
   User routine for the b-tagging by the impact parameter method
    SUBROUTINE QIPBTAG
    =================
    Called by the user
    Calls : BTAG_PAR,JETCLU,QFNDIP,QFNDV0,TRSEL,FINDDMIN,TRSEL2,
            BTAGTR,BTAGEV
       INPUT:
          none
       OUTPUT:
          iret :          >0   if event not useful for analysis
                          <0   if error during analysis
                          = 0  else = O.K.
          list of iret:
                 iret=    0   good event , analysis performed
                          1   Number of jets less than 2
                          2   Jets outside solid angle cuts
                         -2   No beam spot information
                        3,4   No tracks for btag analysis found
                         -3   error in interaction point finding
                         -4   Error in finding thrust axis
          ntrack          = # of tracks used to calculate PROBJET/HEMI/EV
          njet :          # of jet found
          TRKJET          = ALPHA track number of jets (ordered by energy
          FRF2TRK         = FRFT,2 row number of tracks used for analysis
          probtrk(ntrack) array(ntrack) with probabilities of each track
                                 with indices as in FRF2TRK
          probjet(njet)   array(njet) with probabilities of each jet
                                 with indices as in TRKJET
          probhemi(2)     array(2)    with probabilities of hemisphere
                                hemisphere(1) is defined by the leading j
          probevt         probability of the event
       -- The parameters for this routine are given
          by the BOS cards 'JETF','FITP','TRA2','VCUT'
       -- The tracks are selected
       -- V0s are made and used (new 10-9-93) DNB
       -- The calculation of of the track probabilities is performed
       -- The calculation of of the event probabilities is performed
                                    D BROWN,  M FRANK   13/01/92
    MODIFIED:
    ---------
    03/05/95  STEFAN SCHAEL, New QIPBTCPU timing routine
    13/02/97  Manoj Thulasidas.
              Include John Carr's modifications
                  - if running on the new VDET
              OR  - if NQIP card is present
              Do not include John Carr's modifications
                  - if running on the old VDET
              OR  - if OQIP card is present
    17/08/99  P-F Giraud
              CALB histogram numbering convention
              Theta/p dependent deletion histograms added
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   MDIPBT                                                                          
        |---- QIPBTAG                                                              
                   |----  IAND                                External             
                   |----  ISHFT                               External             
                   |----  SIGN                                External             
                   |----  SQRT                                External             
                   |----  ABS                                 External             
                   |----  NINT                                External             
                   |----  KMATIX                              External             
                   |----  ATG                                 External             
                   |----  KCLARM                              External             
                   |----  KLOCK0                              External             
                   |----  IABS                                External             
                   |----  TIMED                               External             
                   |----  CODSEL                                                   
                   |----  BTAG_INIT                                                
                   |----  MAX                                 External             
                   |----  KPDIR                                                    
                   |----  KVSAVE                                                   
                   |----  QIPBTCPU                                                 
                   |----  JETCLU                                                   
                   |----  SORTZV                              External             
                   |----  KTN                                 External             
                   |----  FRF2TRK                             External             
                   |----  XSAME                               External             
                   |----  TRKJET                              External             
                   |----  QJOPTR                                                   
                   |----  QJTHRU                                                   
                   |----  NAMIND                              External             
                   |----  QVSCAL                                                   
                   |----  QVTXBP                              External             
                   |----  QVTEBP                              External             
                   |----  QVTSBP                              External             
                   |----  UCOPY                               External             
                   |----  QFNDIP                                                   
                   |----  QFNDV0                                                   
                   |----  BTVDHITS                                                 
                   |----  VTRKEX                              External             
                   |----  TRSEL                                                    
                   |----  FINDDMIN                                                 
                   |----  TRSEL2                                                   
                   |----  BTAGTR                                                   
                   |----  BTAGEV                                                   
                   |----  MOD                                 External             
                   |----  HFILL                               External             
                   |----  HPAK                                External             
                   |----  FLOAT                               External             
   
 
3 QIPBTCPU
         SUBROUTINE QIPBTCPU(CHSUB,IFLAG)
  ------------------------------------------------------------------------------
    CKEY   QIPBTAG / INTERNAL
  ------------------------------------------------------------------------------
   Determine cpu time usage for qipbtag subroutines
    Called from QIPBTAG
       Author  S.Schael      09-May-1995
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   QIPBTAG                                                                         
        |---- QIPBTCPU                                                             
                   |----  VZERO                               External             
                   |----  NAMIND                              External             
                   |----  LENOCC                              External             
                   |----  TIMED                               External             
                   |----  VSUM                                External             
   
 
3 QSMEAR
         SUBROUTINE QSMEAR(FIRST,QIPVER,SMBIN,RTBIN,
  ------------------------------------------------------------------------------
    CKEY QIPBTAG / USER
  ------------------------------------------------------------------------------
        >     NTRACK,NJET,FRF2TRK,PROBEVT,PROBHEMI,PROBJET,PROBTRK)
   Smear results of qipbtag to correct impact parameter resolution
    in Monte Carlo. User-callable.
    Also delete extra tracks.
    (N.B. The QIPBTAG are reset to the unsmeared/undeleted ones
     at the beginning, so the results don't depend on whether
     SMEAR has been called already in the same event).
   
      Author: Dave Brown, 24-3-92
      Modified: L. Moneta, I.Tomalin 27/4/95.
      Modified: A. Bazarko 1/1/96.
      Modified: I. Tomalin 29/2/96 Smearing randomly signed.
      Modified: I. Tomalin 24/5/96 Allow for binning in theta and p.
      Modified: I. Tomalin  9/1/96 Allow correction to be 100%
                                   correlated between tracks in hemi.
      Modified: P-F Giraud 17/8/99 Reads the parameters form the database
   
      Input:
           LOGICAL FIRST   = Is this the first call to QSMEAR since
                             calling QIPBTAG (or QIPBTAG2) ?
            CHAR*1 QIPVER  = '1' if being used after call to QIPBTAG.
                           = '2' if being used after call to QIPBTAG2.
            CHAR*1 SMBIN   = '0' no smearing correction at all.
                           = 'N' no binning in theta/p for smearing.
                           = 'T' binning in theta for smearing.
                           = 'P' binning in p for smearing.
                           = 'B' binning in both theta/p for smearing.
            CHAR*1 RTBIN   = '0' no track deletion at all.
                           = 'N' no binning in theta/p for deletion.
                           = 'T' binning in theta for deletion.
                           = 'P' binning in p for deletion.
                           = 'B' binning in both theta/p for deletion.
              Plus same arguments of call to QIPBTAG.
      Output: Same arguments overwritten with smeared values
              The -ve tag quantities in /BTAGRAW/ are also smeared.
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
              QSMEAR                                                               
                   |----  IAND                                External             
                   |----  ISHFT                               External             
                   |----  SIGN                                External             
                   |----  SQRT                                External             
                   |----  ABS                                 External             
                   |----  NINT                                External             
                   |----  KMATIX                              External             
                   |----  ATG                                 External             
                   |----  KCLARM                              External             
                   |----  KLOCK0                              External             
                   |----  IABS                                External             
                   |----  QMTERM                                                   
                   |----  MAX                                 External             
                   |----  SMCOPY                                                   
                   |----  INT                                 External             
                   |----  RMARIN                              External             
                   |----  RANMAR                              External             
                   |----  EVEPROB                             External             
                   |----  FORMAT                              External             
                   |----  GTIPBK                                                   
                   |----  MYSMEAR                                                  
                   |----  BTAGTR                                                   
                   |----  BTAGEV                                                   
   
 
3 SMCOPY
         SUBROUTINE SMCOPY(USETRK,
  ------------------------------------------------------------------------------
    CKEY QIPBTAG / INTERNAL
  ------------------------------------------------------------------------------
        +    NTRACK  ,JJET  ,JHEMI  ,FRF2TRK  ,TFLAG  ,DMIN  ,S_DMIN  ,
        +    PHIP  ,JDIST  ,LDIST  ,S_LDIST  ,TPAR  ,TERR  ,PERP  ,
        +    NTRACK_B,JJET_B,JHEMI_B,FRF2TRK_B,TFLAG_B,DMIN_B,S_DMIN_B,
        +    PHIP_B,JDIST_B,LDIST_B,S_LDIST_B,TPAR_B,TERR_B,PERP_B)
   Make copy of qipbtag track information. auxiliary to qsmear.
     Author: Ian Tomalin 30-5-96
   
       INPUT:
         LOGICAL USETRK: .TRUE. if track is to be copied.
            +    List of QIPBTAG track arrays.
       OUTPUT:
                 List of QIPBTAG track arrays.
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   QSMEAR                                                                          
        |---- SMCOPY.                                                              
   
 
3 TCROSS
         SUBROUTINE TCROSS(TPAR,TFLAG,IP,JET,JDIST,SDIST,LDIST,
  ------------------------------------------------------------------------------
    CKEY   QIPBTAG / INTERNAL
  ------------------------------------------------------------------------------
        &  T0,T1,PERP,IFLAG)
   Finds the point of closest approach between a track helix and a line
    in 3-space.  It returns the arc distance
    along the track, relative to the nominal track 'origin',
    and the perpendicular distance between the
    track and the line at the closest approach.
    Author                                            Dave Brown, 13-4-92
    Called from FINDDMIN
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
              TCROSS                                                               
                   |----  SQRT                                External             
                   |----  COS                                 External             
                   |----  SIN                                 External             
                   |----  HFILL                               External             
                   |----  FLOAT                               External             
                   |----  MAX                                 External             
   
 
3 TMOVE
         SUBROUTINE TMOVE(D,TPAR,TERR,TARC,TRKPT,T1,AMAT)
  ------------------------------------------------------------------------------
    CKEY   QIPBTAG / INTERNAL
  ------------------------------------------------------------------------------
   Re-define the track parameters relative to a new point in space.
    This also finds the momentum vector at that point, and diagonalizes
    the error D0,Z0 part of the matrix at that point.
    Called from CHIV0
    Author                                             Dave Brown 4-9-93
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   CHIV0                                                                           
        |---- TMOVE                                                                
                   |----  COS                                 External             
                   |----  SIN                                 External             
                   |----  SQRT                                External             
   
 
3 TPARSET
         SUBROUTINE TPARSET(IALTRK,HAXIS,NJET,TRKJET,
  ------------------------------------------------------------------------------
    CKEY QIPBTAG / INTERNAL
  ------------------------------------------------------------------------------
        &     NDAU,TRKDAU,TPAR,TERR,KJET,KHEMI)
   Pack  alpha track parameters into the arrays needed by qipbtag
      If the track is a 'mother' track,
      it is also searched back to its FRFT origins.
    Author Dave Brown, 12-4-94
    Input arguments :
       IALTRK       :  Alpha track number
       HAXIS        :  Hemisphere definition axis
       NJET         :  # of reconstructed jets
       TRKJET       :  ALPHA track number of jets
    Output arguments :
       NDAU         :  # of 'daughter' tracks (1 for FRFT track)
       TRKDAU       :  FRFT track number of 'daughters'
       TPAR         :  5 track parameters.  In case of a neutral track, the
                       1st element is the momentum
       TERR         :  Lower 4 parameter error matrix (full)
       KJET         :  Associated jet number
       KHEMI        :  Associated hemisphere number
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   TRSEL                                                                           
        |---- TPARSET                                                              
                   |----  SIGN                                External             
                   |----  SQRT                                External             
                   |----  ABS                                 External             
                   |----  NINT                                External             
                   |----  KMATIX                              External             
                   |----  ATG                                 External             
                   |----  KCLARM                              External             
                   |----  IAND                                External             
                   |----  KLOCK0                              External             
                   |----  IABS                                External             
                   |----  QVGET3                                                   
                   |----  QVGETS                                                   
                   |----  YTPAR                               External             
   
 
3 TROT
         SUBROUTINE TROT(TERR2,T1,J1,NU,HAT,ERR2)
  ------------------------------------------------------------------------------
    CKEY   QFNDIP  / INTERNAL
  ------------------------------------------------------------------------------
   Rotate the track error matrix from the phi-theta coordinate
    system to the E,M system.  E and M are
    defined relative to the jet axis.  This also returns the unit vectors in
    the various directions. Dave Brown, 9-8-93
    Called from FINDIP
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   FINDIP                                                                          
        |---- TROT                                                                 
                   |----  SQRT                                External             
                   |----  MAX                                 External             
                   |----  SIN                                 External             
   
 
3 TRSEL
         SUBROUTINE TRSEL(IP,NJET,TRKJET,NV0,V0PAIR,V0PAR,V0ERR,V0PAT,
  ------------------------------------------------------------------------------
    CKEY   QIPBTAG / INTERNAL
  ------------------------------------------------------------------------------
        &  HAXIS,NDAU,TRKDAU,NTRACK,TPAR,TERR,TFLAG,VDHITP,FRF2TRK,
        &     JJET,JHEMI)
   Select tracks for impact parameter physics, and pack them into a loca
    Dave Brown 5-7-91
    Modified:
    ---------
    03/05/95   STEFAN SCHAEL, WORK CORRECTLY WITH USER SELECTED TRACKS
    04/09/96   John Carr redefine track type
              ITYPE = 1  2 VDET space point hits
                    = 2  1 VDET space point hit , expect only 1
                    = 3  V0
                    = 4  1 VDET space point hit , expect 2
                    = 5  Lots of ITC hits, no VDET at all,expect 0
                    = 6  Lots of ITC hits, no VDET at all,expect some
                    = 7  1 single r-phi or z hit, expect 1
                    = 8  1 single r-phi or z hit, expect 2
                    = 9  2 single view VDET hits
    Called from QIPBTAG
    INPUT :
            IP(3)     :   IP position
            NJET      :   # OF JETS PASSED FOR ANALYSIS
            TRKJET    :   track # after sorting the jets      i=1,ntrack
            NV0       :   # of found V0s
            V0PAIR    :   Track #s of V0s, to be ignored in the analysis
            V0PAR     :   Track parameters of reconstructed V0s
            V0ERR     :   Error matrix of reconstructed V0 parameters
            V0PAT     :   VDET Hit pattern on V0 track
            HAXIS     :   Hemisphere definition axis
            VDHITP    : Track vdet hit pattern
    OUTPUT:
            FRF2TRK   : row # OF FRFT bank for track i        i=1,ntrack
            TFLAG     : Track type flag
            NTRACK    : # of tracks used for analysis
            JJET(*)   : # of assigned Jet                     i=1,ntrack
            JHEMI(*)  : # of assigned hemisphere              i=1,ntrack
            TPAR(5,*) : Track parameter
            TERR(4,4,*): Track fit errors parameter
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   QIPBTAG                                                                         
        |---- TRSEL                                                                
                   |----  IAND                                External             
                   |----  ISHFT                               External             
                   |----  SIGN                                External             
                   |----  SQRT                                External             
                   |----  ABS                                 External             
                   |----  NINT                                External             
                   |----  KMATIX                              External             
                   |----  ATG                                 External             
                   |----  KCLARM                              External             
                   |----  KLOCK0                              External             
                   |----  IABS                                External             
                   |----  CODSEL                                                   
                   |----  VZERO                               External             
                   |----  KPDIR                                                    
                   |----  TPARSET                                                  
                   |----  IOR                                 External             
                   |----  HF1                                 External             
                   |----  FLOAT                               External             
                   |----  COS                                 External             
                   |----  SIN                                 External             
                   |----  NLINK                               External             
   
 
3 TRSEL2
         SUBROUTINE TRSEL2(NTRACK,TPAR,TERR,JJET,JHEMI,FRF2TRK,
  ------------------------------------------------------------------------------
    CKEY   QIPBTAG / INTERNAL
  ------------------------------------------------------------------------------
        &  TFLAG,DMIN,S_DMIN,PHIP,JDIST,LDIST,S_LDIST,PERP,JETS)
   Final track selection, based on the final impact parameter.
    Called from QIPBTAG
    Dave Brown 5-7-91
    Inputs;
       NTRACK         Number of tracks (gets revised in this routine)
       TPAR           FRFT type track parameters
       TERR           track errors
       JJET           Association of tracks to jets
       JHEMI          Association of tracks to hemispheres
       FRF2TRK        FRFT track numbers
       TFLAG          Track flag
       DMIN           3-d impact parameter
       S_DMIN         Error on 3-d impact parameter
       PHIP           Direction of 3-d impact parameter in special frame
       JDIST        Distance along jet axis from IP at closest approach
       LDIST        Distance of closest approach to jet axis
       S_LDIST      Error on distance of closest approach to jet axis
       PERP         Unit vector in direction of closest approach vector
       JETS         Jet momentum vector
    Cuts from BTPAR
       MXDMIN         Maximum impact parameter
       MXSDMIN        Maximum impact parameter error
       LCUT           Cut on distance from track to jet axis
       LSIGCUT        Cut on significance of distance track to jet axis
       SCUT           Cut on distance along jet axis of closest approach
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   QIPBTAG                                                                         
        |---- TRSEL2                                                               
                   |----  IAND                                External             
                   |----  ISHFT                               External             
                   |----  HF1                                 External             
                   |----  ABS                                 External             
                   |----  MAKE2D                                                   
   
 
3 V0DKPT
         SUBROUTINE V0DKPT(IFRFT,IROW,NAMB,DK,VCOS)
  ------------------------------------------------------------------------------
    CKEY   QIPBTAG / INTERNAL
  ------------------------------------------------------------------------------
   Crude topological vertex, to seed other calculations
    Called from QFNDV0
    Author                                                D. Brown 6-9-93
    Modifs for Linux to avoid precision problems       S. Jezequel 9-11-00
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   QFNDV0                                                                          
        |---- V0DKPT                                                               
                   |----  COS                                 External             
                   |----  DBLE                                External             
                   |----  SIN                                 External             
                   |----  SQRT                                External             
                   |----  ABS                                 External             
                   |----  MOD                                 External             
                   |----  SIGN                                External             
                   |----  ATAN2                               External             
                   |----  REAL                                External             
   
 
3 V0KINE
         SUBROUTINE V0KINE(M2,SM2,P,T1,RADIUS,TERR,
  ------------------------------------------------------------------------------
    CKEY   QIPBTAG / INTERNAL
  ------------------------------------------------------------------------------
        &    DELTA,BVEC,OMAT,KERR2)
   Compute some kinematic information for a pair of v0 candidate tracks
    Author                                                D. Brown 6-9-93
    Called from CHIV0
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   CHIV0                                                                           
        |---- V0KINE                                                               
                   |----  SQRT                                External             
                   |----  MAX                                 External             
                   |----  MOD                                 External             
   
 
3 V0TPAR
         SUBROUTINE V0TPAR(D,DERR,TMOM,RADIUS,TERR,V0PAR,V0ERR)
  ------------------------------------------------------------------------------
    CKEY   QIPBTAG / INTERNAL
  ------------------------------------------------------------------------------
   Calculate the track parameters for a v0 candidate.
    Called from QFNDV0
    Author                                                D. Brown 9-9-93
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   QFNDV0                                                                          
        |---- V0TPAR                                                               
                   |----  SQRT                                External             
                   |----  ATAN2                               External             
   

2 QLEP

  >>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>
    CKEY 
      First entry of <QLEPTAG> set of ALPHA routines
    =====================================================================
            QTRUTH   D. Abbaneo, F. Ligabue    24/2/93 ( FINLEP )
                     modified for ALPHA under the name QTRUTH  27/07/94
    
    Abstract:  A routine for the determination of the truth for Monte Carlo
               tracks (candidate leptons), as to the physical process the
               track originated from, with particular regard to
               semileptonic decays of heavy-flavoured hadrons, and to the
               processes which may fake them.
    
    Description:
    
             This package is the improved version of a piece of code
             originally written by Dave Cinabro within the QMUIDO
             package, for the determination of the origin of candidate
             Monte Carlo muons. With respect to the original code, this
             routine contains a number of improvements, it also deals with
             electrons and  contemplates a much wider spectrum of possible
             "physical" as well as "background" processes.
             Originally, the package is meant to be used mainly by people
             dealing with semileptonic decays of Heavy Flavours;
             nevertheless, the routine may be used by a wider population,
             namely by anyone wishing to know, whether or not a Monte Carlo
             reconstructed track is actually a lepton, and which kind of
             process it comes from, in case the answer is positive.
    
    Usage:
             QTRUTH can be called within any ALPHA job.
             It is aimed to be used with Monte Carlo q-qbar events, but it
             also works with Z -> tau+ tau- events; if it is called for
             data tracks it gives a dummy answer.
             Given the ALPHA code of a reconstructed (Monte Carlo) track,
             the routine QTRUTH returns
             1) the LUND code of the primary quark flavour
                (it answers 0 if the event is not a MC Z -> qqbar one)
    
             2) a return code which specifies whether the input track is
                actually a lepton or a hadron; in the former case the lepton
                is classified according to a mumber of possible sources of
                prompt and non-prompt leptons (A lepton is here an electron
                or a muon).
                The following sources are considered:
    
                *  lepton from primary b decay (b -> lepton)
                   The routine separates the two cases  b -> c  and  b -> u
    
                *  lepton from secondary b decays:
                         b -> tau   -> lepton
                         b -> c     -> lepton
                         b -> c-bar -> lepton
                         b -> c     -> tau    -> lepton
                   (this last channel also contains  b -> cbar -> tau -> l
                    which is very rare)
    
                *  lepton from primary c decay (c -> lepton)
    
                *  lepton from secondary c decays:
                         c -> tau -> lepton
    
                *  lepton from tau decay (tau -> lepton) in
                   Z -> tau+ tau-  events
    
                *  non-prompt lepton from one of the following decay
                   channels:
    
                         K     -> lepton
                         pion  -> lepton
                         gamma -> e+ e-
                         J/psi -> lepton
                         Psi'  -> lepton
    
                   N.B. the track is DEFINED to come from a decay if the
                        decay vertex lies within the outer wall of the
                        TPC. If the vertex lies within the calorimeter,
                        the track is flagged as a hadron.
    
                   * (misidentified) hadrons
    
                   * electrons from muon decays
    
       We have also studied the case of heavy quarks coming from a hard gluon
       radiated before fragmentation. In case the lepton comes from such a
       "non-primary" heavy quark, we have given the return code a negative
       sign
    
     Calling sequence: see the routine's header .
    =====================================================================
  <<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<
     BADTRK     Auxiliary to qselep
     BTOU       Finds b -> u decays in qtruth
     CHECKQ     Determines the production process in qtruth
     GEN        Determines the production process and decaying b in qtruth
     IBFUNC     Determines the identity of decaying b in qtruth
     IBRE       Handles bremsstrahlung in qtruth
     ISP        Auxiliary to qtruth
     JMBEST     Gives best true track candidate
     QLCOMP     Compares present qselep parameters to plsc ones
     QLEVNT     Steering of heavy flavour lepton selection
     QLINIT     Initialization of qselep package
     QLIUPD     For mini10 processing correct for missinng plsc bank
     QLTERM     Qselep summary
     QSELEP     Lepton selection for heavy flavour (qselep algorithm)
     QTFUNC     Auxiliary functions in qtruth
     QTRUTH     User routine to get the history of mcarlo reconstructed track

3 BADTRK
         LOGICAL FUNCTION BADTRK(ITK, COSTH, NTPC, D0, Z0)
  ------------------------------------------------------------------------------
    CKEY QSELEP/INTERNAL
  ------------------------------------------------------------------------------
   Auxiliary to qselep
    Function to do initial test of whether a track is good or bad.
    Author                           I. Ten Have 27-Jul-1994
    BAD  returns .TRUE.
    GOOD returns .FALSE.
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   QSELEP                                                                          
        |---- BADTRK                                                               
                   |----  SIGN                                External             
                   |----  SQRT                                External             
                   |----  ABS                                 External             
                   |----  NINT                                External             
                   |----  KMATIX                              External             
                   |----  ATG                                 External             
                   |----  KCLARM                              External             
                   |----  IAND                                External             
                   |----  KLOCK0                              External             
                   |----  IABS                                External             
   
 
3 BTOU
         LOGICAL FUNCTION BTOU(IND)
  ------------------------------------------------------------------------------
    CKEY  QTRUTH/INTERNAL
  ------------------------------------------------------------------------------
   
   Finds b -> u decays in qtruth
    Authors  D. Abbaneo , F. Ligabue 27/07/94  from FINLEP / UPHY
    Called from GEN in QTRUTH package
    True if b->u decay.                                         .
      IND    / I   Alpha index of the true track which is       .
                   daughter of the b particle                   .
   
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   GEN                                                                             
        |---- BTOU                                                                 
                   |----  SIGN                                External             
                   |----  SQRT                                External             
                   |----  ABS                                 External             
                   |----  NINT                                External             
                   |----  KMATIX                              External             
                   |----  ATG                                 External             
                   |----  KCLARM                              External             
                   |----  IAND                                External             
                   |----  KLOCK0                              External             
                   |----  IABS                                External             
                   |----  CCBMES                                                   
                   |----  FCHAD                                                    
                   |----  FBHAD                                                    
                   |----  FBQUA                                                    
                   |----  FCQUA                                                    
                   |----  FBBAR                                                    
                   |----  FCBAR                                                    
   
 
3 CHECKQ
         SUBROUTINE CHECKQ(MTRA,IPROC,ISTOG,IPOP)
  ------------------------------------------------------------------------------
    CKEY  QTRUTH/INTERNAL
  ------------------------------------------------------------------------------
   
   Determines the production process in qtruth
    Authors  D. Abbaneo , F. Ligabue 27/07/94  from FINLEP / UPHY
    Called from QTRUTH
                                                                .
    Input                                                       .
      MTRA   / I   Alpha index of the MC track which is the     .
                   daughter of the string or of the last        .
                   H.F. hadron                                  .
                                                                .
      IPROC  / I   Production process                           .
                    1    b -> c X                               .
                    2    b -> u X                               .
                    3    b -> cbar c ; cbar -> X                .
                    4    b -> cbar u ; cbar -> X                .
                    5    b -> c -> X                            .
                    6    c -> X                                 .
                    7    fragmentation or uds                   .
                                                                .
      ISTOG  / I   Flavour of the event                         .
                   1=d, 2=u, 3=s, 4=c, 5=b                      .
                                                                .
    Output                                                      .
      IPOP   / I   Flavour of the quark from gluon splitting    .
                   4 or 5 if the chain is originating from a    .
                          c or a b quark respectively, which    .
                          are coming from gluon splitting       .
                   0      otherwise                             .
                                                                .
   
   
   
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   QTRUTH                                                                          
        |---- CHECKQ                                                               
                   |----  SIGN                                External             
                   |----  SQRT                                External             
                   |----  ABS                                 External             
                   |----  NINT                                External             
                   |----  KMATIX                              External             
                   |----  ATG                                 External             
                   |----  KCLARM                              External             
                   |----  IAND                                External             
                   |----  KLOCK0                              External             
                   |----  IABS                                External             
                   |----  FHVFL                                                    
                   |----  ENDCH                                                    
                   |----  CQTPN                                                    
                   |----  FQQUA                                                    
                   |----  FHQUA                                                    
   
 
3 GEN
         SUBROUTINE GEN(MTRA,IPROC,IBMES)
  ------------------------------------------------------------------------------
    CKEY  QTRUTH/INTERNAL
  ------------------------------------------------------------------------------
   
   Determines the production process and decaying b in qtruth
    Authors  D. Abbaneo , F. Ligabue 27/07/94  from FINLEP / UPHY
    Called from QTRUTH
                                                                .
    Input                                                       .
      MTRA   / I   Alpha index of the MC track which is the     .
                   daughter of the string or of the last        .
                   H.F. hadron                                  .
                                                                .
    Output                                                      .
      IPROC  / I   Production process                           .
                    1    b -> c X                               .
                    2    b -> u X                               .
                    3    b -> cbar c ; cbar -> X                .
                    4    b -> cbar u ; cbar -> X                .
                    5    b -> c -> X                            .
                    6    c -> X                                 .
                    7    fragmentation or uds                   .
                                                                .
      IBMES  / I   Identity of the decaying b particle (if any) .
                   -2   "oscillated" Bs                         .
                   -1   "oscillated" Bd                         .
                    0   b baryon or non b particle              .
                    1   Bd                                      .
                    2   Bs                                      .
                    3   B+                                      .
                                                                .
   
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   QTRUTH                                                                          
        |---- GEN                                                                  
                   |----  SIGN                                External             
                   |----  SQRT                                External             
                   |----  ABS                                 External             
                   |----  NINT                                External             
                   |----  KMATIX                              External             
                   |----  ATG                                 External             
                   |----  KCLARM                              External             
                   |----  IAND                                External             
                   |----  KLOCK0                              External             
                   |----  IABS                                External             
                   |----  FHVFL                                                    
                   |----  FBHAD                                                    
                   |----  BTOU                                                     
                   |----  IBFUNC                                                   
                   |----  ENDCH                                                    
   
 
3 IBFUNC
         INTEGER FUNCTION IBFUNC(IND)
  ------------------------------------------------------------------------------
    CKEY  QTRUTH/INTERNAL
  ------------------------------------------------------------------------------
   
   Determines the identity of decaying b in qtruth
    Authors  D. Abbaneo , F. Ligabue 27/07/94  from FINLEP / UPHY
    Called from GEN in QTRUTH package
    Gives the identity of the decaying b particle               .
                   -2   "oscillated" Bs                         .
                   -1   "oscillated" Bd                         .
                    0   b baryon or non b particle              .
                    1   Bd                                      .
                    2   Bs                                      .
                    3   B+                                      .
   
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   GEN                                                                             
        |---- IBFUNC                                                               
                   |----  SIGN                                External             
                   |----  SQRT                                External             
                   |----  ABS                                 External             
                   |----  NINT                                External             
                   |----  KMATIX                              External             
                   |----  ATG                                 External             
                   |----  KCLARM                              External             
                   |----  IAND                                External             
                   |----  KLOCK0                              External             
                   |----  IABS                                External             
                   |----  XPEQOR                                                   
                   |----  FBHAD                                                    
                   |----  FBQUA                                                    
                   |----  FBBAR                                                    
   
 
3 IBRE
         INTEGER FUNCTION IBRE(MCT)
  ------------------------------------------------------------------------------
    CKEY  QTRUTH/INTERNAL
  ------------------------------------------------------------------------------
   
   Handles bremsstrahlung in qtruth
    Authors  D. Abbaneo , F. Ligabue 27/07/94  from FINLEP / UPHY
    Called from QTRUTH
    Handles bremsstrahlung. Gives the index of the track before      .
    bremsstrahlung. It returns 0 if this track (or some intermediate .
    one) has no mother.                                              .
   
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   QTRUTH                                                                          
        |---- IBRE                                                                 
                   |----  SIGN                                External             
                   |----  SQRT                                External             
                   |----  ABS                                 External             
                   |----  NINT                                External             
                   |----  KMATIX                              External             
                   |----  ATG                                 External             
                   |----  KCLARM                              External             
                   |----  IAND                                External             
                   |----  KLOCK0                              External             
                   |----  IABS                                External             
                   |----  CQTPN                                                    
   
 
3 ISP
         SUBROUTINE ISP(MCT,MTRA,ISPLIT)
  ------------------------------------------------------------------------------
    CKEY  QTRUTH/INTERNAL
  ------------------------------------------------------------------------------
   
   Auxiliary to qtruth
    Authors  D. Abbaneo , F. Ligabue 27/07/94  from FINLEP / UPHY
    Modified for ISR and FSR 13/10/94
    Called from QTRUTH
                                                                .
    Input                                                       .
      MCT    / I   Alpha index of the true track                .
                                                                .
    Output                                                      .
      MTRA   / I   Alpha index of the track mother which is     .
                   produced by the string or by the last H.F.   .
                   hadron (may be equal to MCT)                 .
                                                                .
      ISPLIT / I   End of the decay chain                       .
                    0   lepton from H.F. hadron                 .
                    1   K -> l                                  .
                    2   pi -> l                                 .
                    3   gamma -> l                              .
                    4   J/psi -> l                              .
                    5   psi' -> l                               .
                    6   pi0 -> l                                .
                    7   other -> l                              .
                    8   K                                       .
                    9   pi                                      .
                   10   other                                   .
                                                                .
   
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   QTRUTH                                                                          
        |---- ISP                                                                  
                   |----  SIGN                                External             
                   |----  SQRT                                External             
                   |----  ABS                                 External             
                   |----  NINT                                External             
                   |----  KMATIX                              External             
                   |----  ATG                                 External             
                   |----  KCLARM                              External             
                   |----  IAND                                External             
                   |----  KLOCK0                              External             
                   |----  IABS                                External             
                   |----  FHVFL                                                    
                   |----  ENDCH                                                    
                   |----  XPEQOR                                                   
                   |----  KMOTH                               External             
   
 
3 JMBEST
         INTEGER FUNCTION JMBEST(ITK)
  ------------------------------------------------------------------------------
    CKEY  QTRUTH/INTERNAL
  ------------------------------------------------------------------------------
   
   Gives best true track candidate
    Authors  D. Abbaneo , F. Ligabue 27/07/94  from FINLEP / UPHY
    Modified 26-Aug-1996 D.Abbaneo ( protections added )         .
    Called from QTRUTH                                           .
    Gives the best true track candidate associated to the       .
    reconstructed track ITK                                     .
   
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   QSELEP                                                                          
   QTRUTH                                                                          
        |---- JMBEST                                                               
                   |----  SIGN                                External             
                   |----  SQRT                                External             
                   |----  ABS                                 External             
                   |----  NINT                                External             
                   |----  KMATIX                              External             
                   |----  ATG                                 External             
                   |----  KCLARM                              External             
                   |----  IAND                                External             
                   |----  KLOCK0                              External             
                   |----  IABS                                External             
                   |----  KCH                                 External             
                   |----  KMTCH                               External             
   
 
3 QLCOMP
         SUBROUTINE QLCOMP
  ------------------------------------------------------------------------------
    CKEY QSELEP/INIT
  ------------------------------------------------------------------------------
   Compares present qselep parameters to plsc ones
    Author                           M.N Minard  28-Dec-1994
    Called from QLINIT
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   QLINIT                                                                          
        |---- QLCOMP                                                               
                   |----  SIGN                                External             
                   |----  SQRT                                External             
                   |----  ABS                                 External             
                   |----  NINT                                External             
                   |----  KMATIX                              External             
                   |----  ATG                                 External             
                   |----  KCLARM                              External             
                   |----  IAND                                External             
                   |----  KLOCK0                              External             
                   |----  IABS                                External             
                   |----  VZERO                               External             
                   |----  NAMIND                              External             
                   |----  NLINK                               External             
                   |----  FORMAT                              External             
   
 
3 QLEVNT
  ------------------------------------------------------------------------------
    CKEY  QSELEP/USER
  ------------------------------------------------------------------------------
         SUBROUTINE QLEVNT
   Steering of heavy flavour lepton selection
    from QFILL
                                                     M.N Minard 08.11.94
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   QFILL                                                                           
        |---- QLEVNT                                                               
                   |----  SIGN                                External             
                   |----  SQRT                                External             
                   |----  ABS                                 External             
                   |----  NINT                                External             
                   |----  KMATIX                              External             
                   |----  ATG                                 External             
                   |----  KCLARM                              External             
                   |----  IAND                                External             
                   |----  KLOCK0                              External             
                   |----  IABS                                External             
                   |----  NAMIND                              External             
                   |----  BLIST                               External             
                   |----  QSELEP                                                   
                   |----  QFLEPT                                                   
   
 
3 QLINIT
         SUBROUTINE QLINIT
  ------------------------------------------------------------------------------
    CKEY QSELEP/INIT
  ------------------------------------------------------------------------------
   Initialization of qselep package
    Author ( for original LEPTAG )    Mark Parsons  01-Jun-1992
    Adapted from LEPTAG to QSELEP       I. Ten Have 27-Jul-1994
    Called from QMNEWR
    This routine is called for the first event only.  It initialises
    variables and counters for run statistics and error counts.
    It reads in user supplied bos cards defining the lepton cuts to
    be applied.
    Create selection condition bank PLSC to be put on run header
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   QMNEWR                                                                          
        |---- QLINIT                                                               
                   |----  SIGN                                External             
                   |----  SQRT                                External             
                   |----  ABS                                 External             
                   |----  NINT                                External             
                   |----  KMATIX                              External             
                   |----  ATG                                 External             
                   |----  KCLARM                              External             
                   |----  IAND                                External             
                   |----  KLOCK0                              External             
                   |----  IABS                                External             
                   |----  NAMIND                              External             
                   |----  QLIUPD                                                   
                   |----  VZERO                               External             
                   |----  NLINK                               External             
                   |----  BKFMT                               External             
                   |----  AUBOS                               External             
                   |----  BLIST                               External             
                   |----  QLCOMP                                                   
   
 
3 QLIUPD
         SUBROUTINE QLIUPD
  ------------------------------------------------------------------------------
    CKEY QSELEP/INIT
  ------------------------------------------------------------------------------
   For mini10 processing correct for missinng plsc bank
    Author                           M.N Minard  28-Dec-1994
    Called from QLINIT
    This routine is called for the first event only.  It creates the
    PLSC bank which should have been created at MINI level.
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   QLINIT                                                                          
        |---- QLIUPD                                                               
                   |----  SIGN                                External             
                   |----  SQRT                                External             
                   |----  ABS                                 External             
                   |----  NINT                                External             
                   |----  KMATIX                              External             
                   |----  ATG                                 External             
                   |----  KCLARM                              External             
                   |----  IAND                                External             
                   |----  KLOCK0                              External             
                   |----  IABS                                External             
                   |----  CHAINT                              External             
                   |----  NAMIND                              External             
                   |----  NDROP                               External             
                   |----  BKFMT                               External             
                   |----  AUBOS                               External             
                   |----  BLIST                               External             
   
 
3 QLTERM
         SUBROUTINE QLTERM
  ------------------------------------------------------------------------------
    CKEY QSELEP/INTERNAL
  ------------------------------------------------------------------------------
   Qselep summary
    Author ( for original LEPTAG )    Mark Parsons  01-Jun-1992
    Adapted from LEPTAG to QSELEP       I. Ten Have 27-Jul-1994
    Called from QMTERM
    This routine gives the final run  statistics and an overview
    of occurrance of the various errors.
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   QMTERM                                                                          
        |---- QLTERM                                                               
                   |----  NAMIND                              External             
   
 
3 QSELEP
         SUBROUTINE QSELEP(SLOUT,XBANK,ICLEP,IERR)
  ------------------------------------------------------------------------------
    CKEY QSELEP/INTERNAL
  ------------------------------------------------------------------------------
   Lepton selection for heavy flavour (qselep algorithm)
       QSELEP from LEPTAG written by Mark Parsons , 1st version in June 1992
                  extracted from LEPTAG by   I.Ten Have            July 1994
                   &             HEVLEP from P.Perret
       Adapted to ALPHA by M-N Minard                            10-Nov-1994
    Modified by Gary Taylor 23/10/96 --> put in ALPHA 122.22 26/02/97
    - to take into account muon selection as specified in LSMC cards
    - to allow to modify the dedx cut in lepton id if available as
      specified in LSEC card
    subroutine implements the lepton selection definition given in
   Aleph-note ALEPH 92-101 "Lepton and jet definitions for the lepton paper"
   (D. Abbaneo et al). It finds all high momentum e+,e-,mu+, and mu- particles
    an event and calculates their inclusive and exclusive Pt. It creates
    PDLT for Lepton id and PLJT for recording the jet used in that
   
    carlo truth available is calculated and stored in PMLT bank
   
   -------
             INTEGER SLOUT    = Unit number on which debug and QSELEP error
                                information is to be written.
             LOGICAL XBANK    = Controls whether the PDLT bank will be
                                produced and filled
   
   --------
             INTEGER ICLEP    = The number of leptons found in the event
             INTEGER IERR     = Error return code from the lepton finder
       IERR = 0     ! No error occurred
       IERR < 0     ! An error occurred while processing the event.
       IERR = -1    ! Too few good tracks.
       IERR = -2    ! LEP energy too low or too high.
       IERR = -3    ! Less than 10% of LEP energy visible.
       IERR = -4    ! While trying to find the charge of a lepton
                    ! ALPHA returned the "incorrect" charge.
       IERR = -5    ! The BOS space booked for leptons and the number
                    ! of leptons written out differ.
       IERR = -6    ! BOS was unable to book the space requested.
       IERR = -7    ! There were less than 2 jets in this event.
       IERR = -8    ! Lepton to jet search failed.
       IERR = -9    ! Lepton Pt calculation failed.
       IERR = -10   ! Event has bad HV or DAQ status.
       IERR = -11   ! Event has either no tracks or no energy flow objects.
       IERR = -12   ! Unable to calculate the year corresponding to this run.
       IERR = -13   ! QTRUTH returned an undocumented value.
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   QLEVNT                                                                          
        |---- QSELEP                                                               
                   |----  SIGN                                External             
                   |----  SQRT                                External             
                   |----  ABS                                 External             
                   |----  NINT                                External             
                   |----  KMATIX                              External             
                   |----  ATG                                 External             
                   |----  KCLARM                              External             
                   |----  IAND                                External             
                   |----  KLOCK0                              External             
                   |----  IABS                                External             
                   |----  NAMIND                              External             
                   |----  GTYEAR                              External             
                   |----  BKFMT                               External             
                   |----  NDROP                               External             
                   |----  QLZER                                                    
                   |----  QLUTRK                                                   
                   |----  QSTFLI                                                   
                   |----  BADTRK                                                   
                   |----  QJOPTR                                                   
                   |----  QJMMCL                                                   
                   |----  QLTRK                                                    
                   |----  CHTSIM                                                   
                   |----  QDEDXM                                                   
                   |----  QPMASS                                                   
                   |----  QDEDX                                                    
                   |----  QPAIRF                                                   
                   |----  QMUIDO                                                   
                   |----  FLOAT                               External             
                   |----  KPDIR                                                    
                   |----  AUBOS                               External             
                   |----  F                                   External             
                   |----  VZERO                               External             
                   |----  INT                                 External             
                   |----  QTRUTH                                                   
                   |----  JMBEST                                                   
                   |----  IF                                  External             
                   |----  AUBPRS                              External             
                   |----  BLIST                               External             
   
 
3 QTFUNC
  ------------------------------------------------------------------------------
    CKEY  QTRUTH/INTERNAL
  ------------------------------------------------------------------------------
   
   Auxiliary functions in qtruth
    Authors  D. Abbaneo , F. Ligabue 27/07/94  from FINLEP / UPHY
    Called from everywhere in QTRUTH package
   
 
3 QTRUTH
         SUBROUTINE QTRUTH(ITK,IFLA,IPOP,ICHAIN,ISPLIT,LEPID,IBMES)
  ------------------------------------------------------------------------------
    CKEY  QTRUTH / USER
  ------------------------------------------------------------------------------
   
   User routine to get the history of mcarlo reconstructed track
    Authors  D.Abbaneo , F. Ligabue 27/07/94  from FINLEP / UPHY
                                                                .
     This routine gives information about the "history" of      .
     the reconstructed track ITK. It works on Monte Carlo       .
     hadronic events generated with LUND. The information       .
     provided is aimed to the classification of candidate       .
     leptons for heavy flavour tagging, but may be useful       .
     also in many other cases.                                  .
                                                                .
                                                                .
    Input                                                       .
      ITK    / I   Alpha index of the reconstructed track       .
                                                                .
    Output                                                      .
      IFLA   / I   Flavour of the event                         .
                   1=d, 2=u, 3=s, 4=c, 5=b                      .
                                                                .
      IPOP   / I   Flavour of the quark from gluon splitting    .
                   4 or 5 if the chain is originating from a    .
                          c or a b quark respectively, which    .
                          are coming from gluon splitting       .
                   0      otherwise                             .
                                                                .
      ICHAIN / I   H.F. process originating the decay chain     .
                   -2    b -> cbar u ; cbar -> X                .
                   -1    b -> u X                               .
                    1    b -> c X                               .
                    2    b -> cbar c ; cbar -> X                .
                    3    b -> c -> X                            .
                    4    c -> X                                 .
                    5    fragmentation or uds                   .
                                                                .
      ISPLIT / I   End of the decay chain                       .
                    0   lepton from H.F. hadron                 .
                    1   K -> l                                  .
                    2   pi -> l                                 .
                    3   gamma -> l                              .
                    4   J/psi -> l                              .
                    5   psi' -> l                               .
                    6   pi0 -> l                                .
                    7   other -> l                              .
                    8   K                                       .
                    9   pi                                      .
                   10   other                                   .
                                                                .
      LEPID  / I   Track identity                               .
                   -1   unidentified                            .
                    0   non lepton                              .
                    1   mu                                      .
                    2   tau -> mu                               .
                    3   electron                                .
                    4   tau -> e                                .
                                                                .
      IBMES  / I   Identity of the decaying b particle (if any) .
                   -2   "oscillated" Bs                         .
                   -1   "oscillated" Bd                         .
                    0   b baryon or non b particle              .
                    1   Bd                                      .
                    2   Bs                                      .
                    3   B+                                      .
                                                                .
   
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   QSELEP                                                                          
        |---- QTRUTH                                                               
                   |----  SIGN                                External             
                   |----  SQRT                                External             
                   |----  ABS                                 External             
                   |----  NINT                                External             
                   |----  KMATIX                              External             
                   |----  ATG                                 External             
                   |----  KCLARM                              External             
                   |----  IAND                                External             
                   |----  KLOCK0                              External             
                   |----  IABS                                External             
                   |----  NAMIND                              External             
                   |----  NLINK                               External             
                   |----  JMBEST                                                   
                   |----  XPEQOR                                                   
                   |----  IBRE                                                     
                   |----  ISP                                                      
                   |----  GEN                                                      
                   |----  CHECKQ                                                   
                   |----  MOD                                 External             
   

2 QPI0

  >>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>
    CKEY 
      First entry of <QPI0PK> set of ALPHA QPI0DO routines
    =====================================================================
                                                                        +
     QPI0DO user guide:                                                 +
     ------------------                                                 +
     To build pi0's using QPI0DO, just add in your main program         +
     a CALL QPI0DO, and the COMMON GAMPI0 will be filled. its           +
     content is described below.                                        +
     Beware that the mass cut used to find pi0 candidates from gampec   +
     photons is quite wide: this mass window is +/- 2*sigma around the  +
     mean gampec reconstructed pi0 mass and is parametrised in routine  +
     PI0LIM(E,AMEAN,SIGM).  For some specific analysis, a tighter cut   +
     might be needed, in that case one has to come back to the original +
     GAMPEC photons and check their invariant mass                      +
    c control histos 9001 to 9005 (mass gamma gamma 1--> all types       +
    c  9001+TY for pair type TY (see below) can optionnaly be filled     +
     if QPI0BK is called                                                +
     DESCRIPTION OF COMMON GAMPI0:                                      +
    ------------------------------                                      +
     IQPI0           : return code  0-->OK, 1-->0, 2-->N pi0>MXPI0      +
     PIOMOM(4,MXPI0) : PI0 refitted 4 momentum                          +
     IPI0GAM(2,MXPI0): gam 1 & 2 number in the GAT section              +
     CHIPI0(MXPI0)   : chi2 value after refit (-999. if no convergence  +
     ITYPI0(MXPI0)   : pi0 type, see below                              +
     Description of pi0 types:                                          +
    --------------------------                                          +
      TY=1: 2 photons in same PECO, with N=2 photons in the PECO        +
      TY=2: 2 photons in same PECO, with N>2 photons in the PECO        +
      TY=3: 2 photons in different PECO, with N=1 photons in each PECO  +
      TY=4: 2 photons in different PECO, with N>1 photons in one PECO   +
    =====================================================================
  <<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<
     CHISCOM    Auxiliary to kinefit
     DECOS      Auxiliary to kinefit
     DERIV      Auxiliary to kinefit
     HESSE      Auxiliary to kinefit
     KINEFIT    Kinematic fitting of the pi0 mass
     NEWTONIT   Auxiliary to kinefit
     PI0DEB     Debug printout of all pi0s found by qpi0do
     PI0LIM     Defines the mass cut used to find pi0 candidates
     QPI0BK     Book some control histograms filled by qpi0do
     QPI0DO     Build pi0 candidates from gampex photons taken in the gat section +
     XXP0F1     Subroutine to constraint the p0 mass.

3 CHISCOM
         SUBROUTINE CHISCOM(E,EM1,EM2,C,DE1,DE2,DELTACOS,CHI2)
  ------------------------------------------------------------------------------
    CKEY QPI0DO / INTERNAL
  ------------------------------------------------------------------------------
   Auxiliary to kinefit
      Author   :- Marcello Maggi        27-Jan-1992
   
 
3 DECOS
         SUBROUTINE DECOS(TETA1,PHI1,TETA2,PHI2,A1,A2,SIGMACOS)
  ------------------------------------------------------------------------------
    CKEY QPI0DO / INTERNAL
  ------------------------------------------------------------------------------
   Auxiliary to kinefit
      Author   :- Marcello Maggi        27-Jan-1992
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   KINEFIT                                                                         
        |---- DECOS                                                                
                   |----  DSIN                                External             
                   |----  DCOS                                External             
   
 
3 DERIV
         SUBROUTINE DERIV(E,EM1,EM2,C,DE1,DE2,DELTACOS,GED)
  ------------------------------------------------------------------------------
    CKEY QPI0DO / INTERNAL
  ------------------------------------------------------------------------------
   Auxiliary to kinefit
      Author   :- Marcello Maggi        27-Jan-1992
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   KINEFIT                                                                         
        |---- DERIV .                                                              
   
 
3 HESSE
         SUBROUTINE HESSE(E,C,DE1,DE2,DELTACOS,SHES,IFAIL)
  ------------------------------------------------------------------------------
    CKEY QPI0DO / INTERNAL
  ------------------------------------------------------------------------------
   Auxiliary to kinefit
      Author   :- Marcello Maggi        27-Jan-1992
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   KINEFIT                                                                         
        |---- HESSE                                                                
                   |----  DINV                                External             
   
 
3 KINEFIT
         SUBROUTINE KINEFIT(PGAM1,PGAM2,PPI0,CHISQ,PROBP0,IFAIL)
  ------------------------------------------------------------------------------
    CKEY QPI0DO / INTERNAL
  ------------------------------------------------------------------------------
   Kinematic fitting of the pi0 mass
      Author   :- Marcello Maggi        27-Jan-1992
      Called from QPI0DO
      Inputs:
           - PGAM1         : 4 momentum of first photon
           - PGAM2         : 4 momentum of second photon
      Outputs:
           - PROBP0  /R    : probability to form a pi0
           - IFAIL   /I    : return code (0 means OK!)
           - PPI0    /R    : Refitted pi0 momentum
      Description
      ===========
    This set of routines perform a kinematical fit to the pi0 mass.
    The chisquare is defined as:
      ((E1measured-E1fitted)/Sigma1Eresolution))**2 +
      ((E2measured-E2fitted)/Sigma2Eresolution))**2 +
      ( ((cos(angle between photon)-(1-pimass**2/2/E1fitted/e2fitted))/
                                      SigmacoshtetaResolution) **2
     and it is minimized by a Newtonian iterative procedure, getting
     E1fitted and E2fitted as the result of the fit.
     The resolutions are taken from the nominal resolution of ECAL and
     depend on the Energy fitted.
     The Probability is then computed for 1 d.o.f.
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   QPI0DO                                                                          
        |---- KINEFIT                                                              
                   |----  DBLE                                External             
                   |----  ACOS                                External             
                   |----  ATAN2                               External             
                   |----  VDOTN                               External             
                   |----  DSQRT                               External             
                   |----  DECOS                                                    
                   |----  CHISCOM                                                  
                   |----  HESSE                                                    
                   |----  DERIV                                                    
                   |----  NEWTONIT                                                 
                   |----  DABS                                External             
                   |----  SNGL                                External             
                   |----  VSCALE                              External             
                   |----  VADD                                External             
                   |----  VDOT                                External             
                   |----  SQRT                                External             
                   |----  PROB                                External             
   
 
3 NEWTONIT
         SUBROUTINE NEWTONIT(EFIT,GED,SHES,EFIN)
  ------------------------------------------------------------------------------
    CKEY QPI0DO / INTERNAL
  ------------------------------------------------------------------------------
   Auxiliary to kinefit
      Author   :- Marcello Maggi        27-Jan-1992
   
 
3 PI0DEB
         SUBROUTINE PI0DEB
  ------------------------------------------------------------------------------
    CKEY QPI0DO / USER
  ------------------------------------------------------------------------------
   Debug printout of all pi0s found by qpi0do
      Author   :  J-P Lees              15-Oct-1992
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
              PI0DEB                                                               
                   |----  SIGN                                External             
                   |----  SQRT                                External             
                   |----  ABS                                 External             
                   |----  NINT                                External             
                   |----  KMATIX                              External             
                   |----  ATG                                 External             
                   |----  KCLARM                              External             
                   |----  IAND                                External             
                   |----  KLOCK0                              External             
                   |----  IABS                                External             
                   |----  IPI0GAM                             External             
                   |----  CHIPI0                              External             
   
 
3 PI0LIM
         SUBROUTINE PI0LIM(E,AMEAN,SIGM)
  ------------------------------------------------------------------------------
    CKEY  QPI0DO / INTERNAL
  ------------------------------------------------------------------------------
   Defines the mass cut used to find pi0 candidates
    Called from QPI0DO
    : E gamma-gamma energy
    AMEAN mean reconstructed pi0 mass from gampec
           SIGM  reconstructed pi0 mass width from gampec
    photon pair energy E compute mass limits for defining
   0 candidate taking into account GAMPEC mass shift and resolution
   Author J-P Lees  15 - Oct - 1992
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   QPI0DO                                                                          
        |---- PI0LIM.                                                              
   
 
3 QPI0BK
         SUBROUTINE QPI0BK
  ------------------------------------------------------------------------------
    CKEY QPI0DO / USER
  ------------------------------------------------------------------------------
   Book some control histograms filled by qpi0do
      Author   :  J-P Lees              15-Oct-1992
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
              QPI0BK                                                               
                   |----  HBOOK2                              External             
   
 
3 QPI0DO
         SUBROUTINE QPI0DO
  ------------------------------------------------------------------------------
    CKEY  QPI0DO / USER
  ------------------------------------------------------------------------------
   Build pi0 candidates from gampex photons taken in the gat section +
    alpha, and refit their Energy/momentum applying pi0 mass        +
    2*w1*w2(1-cos(theta12))=m(pi0)                          +
    neglect the error on the angles of the 2 photons and find,      +
    a Lagrange multipliers approximate solution, the refitted     +
    w1, w2 minimizing chi2=((E1-w1)/S1)**2+((E2-w2)/S2)**2    +
    w1, w2 the refitted energies                                  +
        E1, E2 the measured energies                                  +
        S1, S2 the error on these energies                            +
    of this computation are stored in common GAMPI0            +
                                                                      +
   Author J-P Lees  15 - Oct - 1992                                   +
    for ALPHA J-P Lees  25 - Apr - 1994                       +
                                                                      +
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
              QPI0DO                                                               
                   |----  SIGN                                External             
                   |----  SQRT                                External             
                   |----  ABS                                 External             
                   |----  NINT                                External             
                   |----  KMATIX                              External             
                   |----  ATG                                 External             
                   |----  KCLARM                              External             
                   |----  IAND                                External             
                   |----  KLOCK0                              External             
                   |----  IABS                                External             
                   |----  VZERO                               External             
                   |----  PI0LIM                                                   
                   |----  HF2                                 External             
                   |----  XXP0F1                                                   
                   |----  KINEFIT                                                  
                   |----  VADD                                External             
                   |----  UCOPY                               External             
   
 
3 XXP0F1
         SUBROUTINE XXP0F1(IRET, PGAM1,PGAM2,P0FIT,XMFIT,CHI2)
  ------------------------------------------------------------------------------
    CKEY  QPI0DO / INTERNAL
  ------------------------------------------------------------------------------
   Subroutine to constraint the p0 mass.
    Called from QPI0DO
        Uses a Lagrange multipliers technique
    Author    G.Batignani 10 / Apr /1992
                          10 / Apr /1992      Modified error
    Modified  J.P.Lees    20 / May /1992      Modified arguments
              S. Jezequel 12 / Nov /2000      precision pbs on Linux
    Input  arguments :
              PGAM1         first photon 4 momentum
              PGAM2        second photon 4 momentum
        Remarks:   1.   the 4-momentum of IPI0 must be the sum of
                        the two 4-momenta of IG1 and IG2, in order
                        to have a significant fit.
                   2.   the invariant mass of IPI0 should lie in the
                        range 50 - 250 Mev.   If not, the energy of
                        the pi0  is redefined badly.
    Output arguments :
               IRET     return code :  -1 and -2 : the fit is failed and
                                       P0FIT and XMFIT are set to 0,
                                      from 1 to 5 : the fit has converged
                                      and the Pi0 new mass is within 0.2
                                      MeV around the nominal Pi0 mass and
                                     the fit has converged in IRET iter.,
                                      6  : the fit has not converged in
                                      less than 5 iteration and the
                                      fitted values are the ones calculat
                                      at the 5-th iteration.
               P0FIT(I)  fitted 4-momentum of Pi0 ( p,E) : it MUST be
                         dimensioned 4 in the calling routine.
               XMFIT     inveriant mass after the fit
        Remarks : - so far the fit has always converged in 1,2 or 3
                   iterations, so the invariant mass is the nominal pi0
                   mass (  within 0.2 MeV ).   However, it is better
                   to check IRET > 0.
                  - (repeated) : call this routine only if the pi0
                   invariant mass ( of IPI0 ) is in the range 50-200 MeV.
                  - in first approximation this routine redefines the
                    pi0 energy (and not the direction) and improves the
                    energy resolution from (roughly) 26%/sqrt(E) to
                    6%  (constant with energy).
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   QPI0DO                                                                          
        |---- XXP0F1                                                               
                   |----  DBLE                                External             
                   |----  SQRT                                External             
                   |----  ABS                                 External             
                   |----  REAL                                External             
   

2 QVS

  >>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>
    CKEY 
      First entry of <QVSRPK> set of ALPHA QVSRCH routines
       Please read the Aleph Note 92 - 173 ( December 1992 ) from T. Mattison
       before using this package .
    
  <<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<
     QVSAVX     Converts secondary vertex and errors from internal coordinates
     QVSGTK     Applies track cuts including alpha lock function
     QVSGTK0    Track cuts for coarse z vertex
     QVSGTK1    Track cuts for more precise z vertex
     QVSGTK2    Track cuts for track-vertex-association
     QVSGTL0    Returns list of good alpha tracks for coarse z vertex
     QVSGTL1    Returns list of good alpha tracks for qvspvx primary vertex
     QVSIMP     Returns normalized signed impact parameters
     QVSJET     Finds 2 jet directions in preparation for qvstvx
     QVSMIS     Calculates vertex miss distance
     QVSPVX     Finds primary vertex and 2 jet directions in preparation for qvstvx
     QVSRCH     Finds primary/secondary vertex , errors , and b-tag variables
     QVSTKJ     Returns which jet a track is closer to
     QVSTKP     Returns polynomial describing track itk in vertex-jet coord. system
     QVSTKV     Returns 3-vectors for position, direction, curvature, error
     QVSTKW     Returns track weight matrix in aleph system
     QVSTVA     Track-jet-vertex association
     QVSVTX     Finds secondary vertices, errors, and b-tag variables, for 2 jets
     QVSWBK     Creates bos work bank - internal to qvsrch
     QVSXZB     Finds track impact with beam plane
     QVSZ0B     Returns zb = z at distance of closest approach to beam axis
     YVSCM2     Finds consistent peak in 2 sampled 2-d likelihood functions
     YVSLF1     Adds track to 1-dimension log-likelihood distribution vlf
     YVSLF2     Adds track (point) to 2-dimension log-likelihood distribution vlf.
     YVSLFL     Adds line (track) to 2-dimension log-likelihood distribution vlf.
     YVSML1     Finds maximum of 1-dimensional likelhood function
     YVSML2     Finds maximum of 2-dimensional likelhood function
     YVSPAR     Finds paraboloid parameters for 2-d sampled distribution
     YVSPR2     Fits combined paraboloid to 2 2-d functions
     YVSPRM     Finds maximum and error at peak of 6-parameter paraboloid
     YVSPVE     Finds projected primary vertex errors in rotated system
     YVSRMI     Inverse-rotates covariance or weight matrix
     YVSRMJ     Rotates covariance or weight matrix
     YVSROM     Makes forward rotation matrix
     YVSRTI     Inverse-rotates vector xyz from djet direction
     YVSRTJ     Rotates vector xyz into djet direction
     YVSTKE     Finds track error**2 in jet coordinate system
     YVSTP0     Finds path-length that steps track vector to z=0
     YVSTRI     Inverse-tranforms point in xyzr system to xyz system
     YVSTRJ     Tranforms point in xyz system to xyzr system
     YVSVJE     Puts vertex and jet angle resolution into likelihood function
     YVSWIM     Swims track description vectors to path-length s
     YVSXZB     Finds x-z of primary vertex
     YVSXZJ     Finds x,z,and t of secondary vertex
     YVSZVC     Finds coarse z vertex by sampled likelihood fit

3 QVSAVX
         SUBROUTINE QVSAVX(PVTX,DJET,SVTX,ESVTX,AVTX,CAVTX)
  ------------------------------------------------------------------------------
    CKEY  QVSRCH / INTERNAL
  ------------------------------------------------------------------------------
   Converts secondary vertex and errors from internal coordinates
    to ALEPH coordinates
    Called from QVSRCH
    Author : T. MATTISON  U.A.BARCELONA/SLAC  1 DECEMBER 1992
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   QVSRCH                                                                          
        |---- QVSAVX                                                               
                   |----  YVSTRI                                                   
                   |----  UZERO                               External             
                   |----  YVSRMI                                                   
   
 
3 QVSGTK
         LOGICAL FUNCTION QVSGTK(ITK,VTX,
  ------------------------------------------------------------------------------
    CKEY  QVSRCH / INTERNAL
  ------------------------------------------------------------------------------
        >  MNTP,CTMX,D0MX,Z0MX,RVMX,PMIN,CPDMX)
   Applies track cuts including alpha lock function
       QVSGTK IS A FUNCTION NOT A SUBROUTINE
    Author : T. MATTISON  U.A.BARCELONA/SLAC  1 DECEMBER 1992
    Input Arguments :
    *  ITK IS ALPHA TRACK NUMBER
    *  VTX() IS PRIMARY VERTEX COORDINATES FOR CUTS
    *  MNTP IS MINIMUM TPC HITS
    *  CTMX IS MAXIMUM COS(THETA)
    *  D0MX IS MAXIMUM D0 VALUE
    *  Z0MX IS MAXIMUM Z0 VALUE
          BOTH D0 AND Z0 ARE CORRECTED FROM ALEPH COORDINATES
          TO COORDINATES CENTERED ON VTX()
    *  RVMX IS MAXIMUM 3-D DISTANCE FROM TRACK TO VTX
          IF CUT IS LESS THAN 3 TIMES Z0 ERROR TRANSVERSE TO TRACK,
          THE CUT IS APPLIED TO THE 2D RADIAL (D0) DISTANCE TO VTX
    *  PMIN IS MINIMUM TOTAL MOMENTUM
    *  CPDMX IS MAXIMUM CHISQUARE/DOF
    Output Arguments :
       RETURNS QVSGTK=.TRUE. OR .FALSE.
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   QVSGTK0                                                                         
   QVSGTK1                                                                         
   QVSGTK2                                                                         
        |---- QVSGTK                                                               
                   |----  SIGN                                External             
                   |----  SQRT                                External             
                   |----  ABS                                 External             
                   |----  NINT                                External             
                   |----  KMATIX                              External             
                   |----  ATG                                 External             
                   |----  KCLARM                              External             
                   |----  IAND                                External             
                   |----  KLOCK0                              External             
                   |----  IABS                                External             
                   |----  QVSMIS                                                   
                   |----  MAX                                 External             
   
 
3 QVSGTK0
         LOGICAL FUNCTION QVSGTK0(ITK,VTX)
  ------------------------------------------------------------------------------
    CKEY  QVSRCH / INTERNAL
  ------------------------------------------------------------------------------
   Track cuts for coarse z vertex
       QVSGTK0 IS A FUNCTION NOT A SUBROUTINE
    Author : T. MATTISON  U.A.BARCELONA/SLAC  1 DECEMBER 1992
    Input Arguments :
    *  ITK IS ALPHA TRACK NUMBER
    *  VTX() IS PRIMARY VERTEX COORDINATES FOR CUTS
    Output Arguments :
    *  RETURNS QVSGTK0=.TRUE. OR .FALSE.
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   QVSGTL0                                                                         
        |---- QVSGTK0                                                              
                   |----  QVSGTK                                                   
   
 
3 QVSGTK1
         LOGICAL FUNCTION QVSGTK1(ITK,VTX)
  ------------------------------------------------------------------------------
    CKEY  QVSRCH / INTERNAL
  ------------------------------------------------------------------------------
   Track cuts for more precise z vertex
       QVSGTK1 IS A FUNCTION NOT A SUBROUTINE
    Author : T. MATTISON  U.A.BARCELONA/SLAC  1 DECEMBER 1992
    Input Arguments :
       ITK IS ALPHA TRACK NUMBER
       VTX() IS PRIMARY VERTEX COORDINATES FOR CUTS
    Output Arguments :
       RETURNS QVSGTK1=.TRUE. OR .FALSE.
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   QVSGTL1                                                                         
        |---- QVSGTK1                                                              
                   |----  QVSGTK                                                   
   
 
3 QVSGTK2
         LOGICAL FUNCTION QVSGTK2(ITK,VTX,DKL)
  ------------------------------------------------------------------------------
    CKEY  QVSRCH / INTERNAL
  ------------------------------------------------------------------------------
   Track cuts for track-vertex-association
       QVSGTK2 IS A FUNCTION NOT A SUBROUTINE
    Author : T. MATTISON  U.A.BARCELONA/SLAC  1 DECEMBER 1992
    Input Arguments :
       ITK IS ALPHA TRACK NUMBER
       VTX() IS PRIMARY VERTEX COORDINATES FOR CUTS
       DKL IS DECAY DISTANCE (USED TO LOOSEN IMPACT PARAMETER CUTS)
    Output Arguments :
       RETURNS QVSGTK2=.TRUE. OR .FALSE.
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   QVSTVA                                                                          
   QVSTCHI2                                                                        
        |---- QVSGTK2                                                              
                   |----  QVSGTK                                                   
                   |----  QVSMIS                                                   
                   |----  MAX                                 External             
                   |----  ABS                                 External             
   
 
3 QVSGTL0
         SUBROUTINE QVSGTL0(VTX,MGTK,NGTK,JGTK)
  ------------------------------------------------------------------------------
    CKEY  QVSRCH / INTERNAL
  ------------------------------------------------------------------------------
   Returns list of good alpha tracks for coarse z vertex
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   QVSPVX                                                                          
        |---- QVSGTL0                                                              
                   |----  SIGN                                External             
                   |----  SQRT                                External             
                   |----  ABS                                 External             
                   |----  NINT                                External             
                   |----  KMATIX                              External             
                   |----  ATG                                 External             
                   |----  KCLARM                              External             
                   |----  IAND                                External             
                   |----  KLOCK0                              External             
                   |----  IABS                                External             
                   |----  QVSGTK0                                                  
                   |----  MIN                                 External             
   
 
3 QVSGTL1
         SUBROUTINE QVSGTL1(VTX,MGTK,NGTK,JGTK)
  ------------------------------------------------------------------------------
    CKEY  QVSRCH / INTERNAL
  ------------------------------------------------------------------------------
   Returns list of good alpha tracks for qvspvx primary vertex
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   QVSPVX                                                                          
   QVSVTX                                                                          
        |---- QVSGTL1                                                              
                   |----  SIGN                                External             
                   |----  SQRT                                External             
                   |----  ABS                                 External             
                   |----  NINT                                External             
                   |----  KMATIX                              External             
                   |----  ATG                                 External             
                   |----  KCLARM                              External             
                   |----  IAND                                External             
                   |----  KLOCK0                              External             
                   |----  IABS                                External             
                   |----  QVSGTK1                                                  
                   |----  MIN                                 External             
   
 
3 QVSIMP
         SUBROUTINE QVSIMP(ITK,PVTX,DJET,SVTX,EPVTX,ESVTX,
  ------------------------------------------------------------------------------
    CKEY  QVSRCH / INTERNAL
  ------------------------------------------------------------------------------
        >   DXP,DZP,DTP,DXS,DZS,DTS)
   Returns normalized signed impact parameters
       relative to primary, secondary vertices, in x,z,t
       X IS BASICALLY D0, Z IS BASICALLY Z0, T IS ALONG JET DIRECITON
    Author : T. MATTISON  U.A.BARCELONA/SLAC  1 DECEMBER 1992
       MODIFIED BY T. MATTISON  8 DEC 1992
       PROTECT AGAINST NONSENSE ERRORS AND ZERO SLOPES
    Input Arguments :
    *  ITK IS ALPHA TRACK NUMBER
    *  PVTX() IS PRIMARY VERTEX IN ALEPH COORDINATES
    *  DJET() IS NORMALIZED JET DIRECTION IN ALEPH COORDINATES
    *  SVTX() IS SECONDARY VERTEX IN TRANSLATED-ROTATED COORDINATES
          ORIGIN AT PVTX, 3D AXIS IN DJET DIRECTION
    *  EPVTX() IS ERROR IN PRIMARY VERTEX
    *  ESVTX() IS ERROR IN SECONDARY VERTEX
          ZERO ERROR IS OK (AND WORKS FAIRLY WELL)
    Output Arguments :
    *  DXP IS X NORMALIZED SIGNED IMPACT RELATIVE TO PRIMARY
    *  DZP IS Z NORMALIZED SIGNED IMPACT RELATIVE TO PRIMARY
    *  DTP IS COMBINATION OF X AND Z SIGNED IMPACT PARAMETERS AT PRIMARY,
          AND ERRORS AND SLOPES CORRESPONDING TO
          NORMALIZED DISTANCE ALONG JET DIRECTION
    *  DXS IS X NORMALIZED SIGNED IMPACT RELATIVE TO SECONDARY
    *  DZS IS Z NORMALIZED SIGNED IMPACT RELATIVE TO SECONDARY
    *  DTS IS LIKE DTP BUT RELATIVE TO SECONDARY
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   QVSTVA                                                                          
   QVSTCHI2                                                                        
        |---- QVSIMP                                                               
                   |----  QVSTKP                                                   
                   |----  YVSPVE                                                   
                   |----  SQRT                                External             
                   |----  SIGN                                External             
   
 
3 QVSJET
         SUBROUTINE QVSJET(DJET,NJETS)
  ------------------------------------------------------------------------------
    CKEY  QVSRCH / INTERNAL
  ------------------------------------------------------------------------------
   Finds 2 jet directions in preparation for qvstvx
    Called from QVSRCH
    Author : T. MATTISON  U.A.BARCELONA/SLAC  1 DECEMBER 1992
    Input Arguments :
    IF ALPHA CARDS CONTAIN 'NQVJ', SETS NJET=2 AND RETURNS
       ELSE IF 'EFLJ' CARD, STARTS WITH PRE-CLUSTERED JETS
       ELSE IF 'EFLW' CARD, USES JANOT ENERGY FLOW OBJECTS
       ELSE USES CHARGED TRACKS AND PCPA CALORIMETER OBJECTS
       UNLESS THERE IS A 'NOPC' CARD
    Output Arguments :
    *  DJET(3,2) IS NORMALIZED 3-VECTORS OF JET DIRECTIONS
         JET 1 IS HIGHEST ENERGY JET
         JET 2 IS ONE WITH LARGEST MASS RELATIVE TO FIRST JET
         ALPHA JETS WITH NAME 'QVSJETS' ARE CREATED
    *  NJETS IS TOTAL NUMBER OF JETS FOUND
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   QVSRCH                                                                          
        |---- QVSJET                                                               
                   |----  SIGN                                External             
                   |----  SQRT                                External             
                   |----  ABS                                 External             
                   |----  NINT                                External             
                   |----  KMATIX                              External             
                   |----  ATG                                 External             
                   |----  KCLARM                              External             
                   |----  IAND                                External             
                   |----  KLOCK0                              External             
                   |----  IABS                                External             
                   |----  NAMIND                              External             
                   |----  QJOPTR                                                   
                   |----  QJMMCL                                                   
                   |----  KPDIR                                                    
   
 
3 QVSMIS
         SUBROUTINE QVSMIS(ITK,VTX,D0V,Z0V,R3D)
  ------------------------------------------------------------------------------
    CKEY  QVSRCH / INTERNAL
  ------------------------------------------------------------------------------
   Calculates vertex miss distance
    Author : T. MATTISON  U.A.BARCELONA/SLAC  1 DECEMBER 1992
    Input Arguments :
    *  ITK IS ALPHA TRACK NUMBER
    *  VTX() IS VERTEX COORDINATES
    Output Arguments :
    *  D0V IS D0 WITH RESPECT TO VERTEX
    *  Z0V IS Z0 WITH RESPECT TO VERTEX
    *  R3D IS 3D MISS DISTANCE
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   QVSGTK                                                                          
   QVSGTK2                                                                         
        |---- QVSMIS                                                               
                   |----  SIGN                                External             
                   |----  SQRT                                External             
                   |----  ABS                                 External             
                   |----  NINT                                External             
                   |----  KMATIX                              External             
                   |----  ATG                                 External             
                   |----  KCLARM                              External             
                   |----  IAND                                External             
                   |----  KLOCK0                              External             
                   |----  IABS                                External             
                   |----  SIN                                 External             
                   |----  COS                                 External             
   
 
3 QVSPVX
         SUBROUTINE QVSPVX(BPOS,BSIZ,TSMR,PVTX,EPVTX,IERR)
  ------------------------------------------------------------------------------
    CKEY  QVSRCH / INTERNAL
  ------------------------------------------------------------------------------
   Finds primary vertex and 2 jet directions in preparation for qvstvx
    Called from QVSRCH
    Author : T. MATTISON  U.A.BARCELONA/SLAC  1 DECEMBER 1992
    Input Arguments :
    *  BPOS() IS BEAM POSITION
         BPOS(2) MUST BE AN ACCURATE BEAM Y COORDINATE,
         I.E., QVYNOM OR OUTPUT FROM GETBP
         BPOS(1),BPOS(3) ARE ONLY USED FOR X AND Z TRACK CUTS
    *  BSIZ() IS SIZE OF LUMINOUS REGION (1 SIGMA)
    *  TSMR IS ADDITIONAL SMEARING FOR TRACKS
         .0100 CM (100 MICRONS) MAKES ERRORS FAIRLY HONEST ON B EVENTS
         .0000 CM GIVES BETTER RESOLUTION IN UDS EVENTS
    Output Arguments :
    *  PVTX() IS PRIMARY VERTEX IN ALEPH XYZ COORDINATES
    *  EPVTX() IS ERROR (NOT VARIANCE) IN PVTX
         MAY BE NEGATIVE, INDICATING A PROBLEM, NOT NECESSARILY SEVERE,
         IN FINDING THE PRIMARY VERTEX
    *  EPVTX(2) IS COPY OF BSIZ(2)
    *  IERR IS ERROR FLAG WORD
         0 FOR OK
         1 FOR QUESTIONABLE PRIMARY VERTEX
         2 FOR NOT ENOUGH TRACKS FOR PRIMARY VERTEX
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   QVSRCH                                                                          
        |---- QVSPVX                                                               
                   |----  QVSGTL0                                                  
                   |----  QVSWBK                                                   
                   |----  YVSZVC                                                   
                   |----  QVSGTL1                                                  
                   |----  MAX                                 External             
                   |----  YVSXZB                                                   
                   |----  WDROP                               External             
   
 
3 QVSRCH
         SUBROUTINE QVSRCH(BPOS,BSIZ,PVTX,EPVTX,DJET,
  ------------------------------------------------------------------------------
    CKEY  QVSRCH / USER
  ------------------------------------------------------------------------------
        > BTAG,SVTX,ESVTX,AVTX,CAVTX,JERR)
   Finds primary/secondary vertex , errors , and b-tag variables
    Author : T. MATTISON  U.A.BARCELONA/SLAC  1 DECEMBER 1992
    Modified : G.Graefe                       25-MAR-1995 adapted to NanoDst
    Input Arguments :
     * BPOS() IS BEAM POSITION
        BPOS(2) MUST BE AN ACCURATE BEAM Y COORDINATE,
          I.E., QVYNOM OR OUTPUT FROM GET_BP)
        BPOS(1),BPOS(3) ARE USED FOR X AND Z TRACK CUTS
          AND AS ADDITIONAL CONSTRAINTS ON PRIMARY VERTEX
     * BSIZ() IS SIZE OF LUMINOUS REGION (1 SIGMA)
         FIXED VALUES OF .0200, .0020, 2.0 WILL WORK OK
         ANY NEGATIVE ELEMENT OF BSIZ WILL SUPPRESS INTERNAL PRIMARY FINDIG
         IN WHICH CASE PVTX() AND EPVTX() BECOME INPUT VARIABLES
         ALPHA 'NQVJ' CARD WILL SUPPRESS INTERNAL JET FINDING,
         IN WHICH CASE DJET BECOMES AN INPUT VARIABLE
    Output Arguments :
     * PVTX() IS PRIMARY VERTEX IN ALEPH XYZ COORDINATES
     * EPVTX() IS ERROR (NOT VARIANCE) IN PVTX
     * DJET(3,2) IS TWO NORMALIZED XYZ DIRECTION VECTORS FOR TWO JETS
     * BTAG(2) IS THE B-TAGGING VARIABLE FOR THE TWO HEMISPHERES
         IT IS BASICALLY THE HALF THE CHI-SQUARE DIFFERENCE BETWEEN THE
         HYPOTHESIS THAT ALL TRACKS IN THE HEMISPHERE COME FROM PRIMARY,
         OR THAT SOME TRACKS COME FROM THE SECONDARY AND SOME FROM PRIMARY
         A CUT AT 10, OR AT 20 ON THE SUM, IS REASONABLE
     * SVTX(3,2) IS TWO SECONDARY VERTICES IN COORDINATE SYSTEMS
         THAT ARE USED INTERNALLY, (ONE SYSTEM PER JET)
         ORIGINS ARE AT PVTX(), AND ARE ORIENTED BY DJET(,)
         THE THIRD COORDINATE IS THE DECAY LENGTH IN THE JET DIRECTION
         THE FIRST COORDINATE IS R-PHI-LIKE, THE SECOND IS Z-LIKE
     * ESVTX(3,2) IS THE ERRORS ON SVTX() IN THE INTERNAL ROTATED SYSTEM
         WHERE GEOMETRICAL CORRELATIONS ARE SMALL AND IGNORED
         MAY BE NEGATIVE, INDICATING A PROBLEM, NOT NECESSARILY SEVERE,
         IN FINDING THE VERTEX
     * AVTX(3,2) IS THE TWO SECONDARY VERTICES IN ALEPH XYZ COORDINATES
     * CAVTX(3,3,2) IS TWO COVARIANCE MATRICES FOR AVTX()
     * JERR IS ERROR FLAG :
          0 FOR OK
         +1 FOR SECONDARY VERTEX 1 ERRORS QUESTIONABLE
         +2 FOR SECONDARY VERTEX 2 ERRORS QUESTIONABLE
         +3 FOR QUESTIONABLE ERRORS ON BOTH SECONDARY VERTICES
         +4 FOR NO GOOD TRACKS IN JET 1
         +8 FOR NO GOOD TRACKS IN JET 2
        +12 FOR NO GOOD TRACKS IN EITHER JET
        +16 FOR QUESTIONABLE PRIMARY VERTEX
        +32 FOR NOT ENOUGH TRACKS FOR PRIMARY VERTEX
        +64 FOR NO JETS FOUND
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
              QVSRCH                                                               
                   |----  NVSRCH                                                   
                   |----  QVSPVX                                                   
                   |----  QVSJET                                                   
                   |----  QVSVTX                                                   
                   |----  QVSAVX                                                   
   
 
3 QVSTKJ
         SUBROUTINE QVSTKJ(ITK,DJET,JET)
  ------------------------------------------------------------------------------
    CKEY  QVSRCH / INTERNAL
  ------------------------------------------------------------------------------
   Returns which jet a track is closer to
    Author : T. MATTISON  U.A.BARCELONA/SLAC  1 DECEMBER 1992
    Input Arguments :
       ITK IS ALPHA TRACK NUMBER
       DJET(3,2) IS TWO NORMALIZED JET DIRECTION VECTORS
    Output Arguments :
       JET=1 OR 2
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   QVSTVA                                                                          
   QVSTCHI2                                                                        
   YVSXZJ                                                                          
        |---- QVSTKJ                                                               
                   |----  SIGN                                External             
                   |----  SQRT                                External             
                   |----  ABS                                 External             
                   |----  NINT                                External             
                   |----  KMATIX                              External             
                   |----  ATG                                 External             
                   |----  KCLARM                              External             
                   |----  IAND                                External             
                   |----  KLOCK0                              External             
                   |----  IABS                                External             
   
 
3 QVSTKP
         SUBROUTINE QVSTKP(ITK,PVTX,DJET,
  ------------------------------------------------------------------------------
    CKEY  QVSRCH / INTERNAL
  ------------------------------------------------------------------------------
        > XP,DXDT,D2XDT2,ZP,DZDT,D2ZDT2,VXP,VZP,VXZ)
   Returns polynomial describing track itk in vertex-jet coord. system
    Author : T. MATTISON  U.A.BARCELONA/SLAC  1 DECEMBER 1992
    Input Arguments :
    *  ITK IS ALPHA TRACK INDEX
    *  PVTX() IS XYZ OF POINT (PRIMARY VERTEX) IN ALEPH SYSTEM
    *  DJET() IS NORMALIZED JET DIRECTION VECTOR
    Output Arguments :
    *  XP IS THE R-PHI-LIKE COORDINATE IN THE TRANSLATED, ROTATED SYSTEM
          WHERE THE TRACK INTECEPTS THE PLANE THROUGH PVTX()
          WITH NORMAL VECTOR DJET
    *  DXDT IS THE SLOPE OF THE TRACK IN THE ROTATED X DIRECTION
          (I.E., RELATIVE TO THE DJET DIRECTION)
    *  D2XDT2 IS THE 2D DERIVATIVE (CURVATURE) OF THE TRACK
          X(T) = XP + DXDT*T + .5*D2XDT2*T*T
    *  ZP,DZDT ARE THE ANALOGS OF XP,DXDT FOR Z-LIKE COORDINATE
    *  D2ZDT2 IS THE Z CURVATURE (NONZERO IF DJET(3) IS NONZERO)
           Z(T) = ZP + DZDT*T + .5*D2ZDT2*T*T
    *  VXP,VZP ARE THE VARIANCES (NOT ERRORS!) ON XP,ZP
    *  VXZ IS THE COVARIANCE
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   QVSIMP                                                                          
   QVSXZB                                                                          
   YVSXZJ                                                                          
        |---- QVSTKP                                                               
                   |----  QVSTKV                                                   
                   |----  QVSTKW                                                   
                   |----  YVSTRJ                                                   
                   |----  YVSRTJ                                                   
                   |----  YVSRMJ                                                   
                   |----  ABS                                 External             
                   |----  YVSTP0                                                   
                   |----  YVSWIM                                                   
                   |----  YVSTKE                                                   
   
 
3 QVSTKV
         SUBROUTINE QVSTKV(ITK,XYZA,DIRA,CRVA)
  ------------------------------------------------------------------------------
    CKEY  QVSRCH / INTERNAL
  ------------------------------------------------------------------------------
   Returns 3-vectors for position, direction, curvature, error
       IN ALEPH COORDINATE SYSTEM FOR ALPHA TRACK ITK
    Author : T. MATTISON  U.A.BARCELONA/SLAC  1 DECEMBER 1992
    Input Arguments :
       ITK IS ALPHA TRACK INDEX
    Output Arguments :
    *  XYZA() IS COORDINATES OF CLOSEST APPROACH TO ALEPH Z AXIS
    *  DIRA() IS NORMALIZED DIRECTION VECTOR AT THAT POINT
    *  CRVA() IS ORTHOGONAL DIRECTION FOR CURVATURE
          POSITION VS DISTANCE S IS THEN (FOR SMALL CRVA AND SMALL S)
          XYZ() = XYZA() + DIRA()*S + .5*CRVA()*S*S
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   QVSTKP                                                                          
        |---- QVSTKV                                                               
                   |----  SIGN                                External             
                   |----  SQRT                                External             
                   |----  ABS                                 External             
                   |----  NINT                                External             
                   |----  KMATIX                              External             
                   |----  ATG                                 External             
                   |----  KCLARM                              External             
                   |----  IAND                                External             
                   |----  KLOCK0                              External             
                   |----  IABS                                External             
                   |----  SIN                                 External             
                   |----  COS                                 External             
   
 
3 QVSTKW
         SUBROUTINE QVSTKW(ITK,DIRA,WTMA)
  ------------------------------------------------------------------------------
    CKEY  QVSRCH / INTERNAL
  ------------------------------------------------------------------------------
   Returns track weight matrix in aleph system
    Author : T. MATTISON  U.A.BARCELONA/SLAC  1 DECEMBER 1992
    Input Arguments :
    *  ITK IS ALPHA TRACK INDEX
    *  DIRA() IS NORMALIZED TRACK DIRECTION IN ALEPH SYSTEM
        CAN BE OBTAINED BY QVSTKV
    Output Argument :
    *  WTMA(,) IS WEIGHT MATRIX IN ALEPH SYSTEM
       THE CHI SQUARE DISTANCE
       FROM POINT Y() ON THE TRACK TO POINT X() ANYWHERE ELSE IS
       FOUND BY SUMMING OVER I,J = 1,3
       (X(I)-Y(I)) * WTMA(I,J) * (X(J)-Y(J))
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   QVSTKP                                                                          
        |---- QVSTKW                                                               
                   |----  SIGN                                External             
                   |----  SQRT                                External             
                   |----  ABS                                 External             
                   |----  NINT                                External             
                   |----  KMATIX                              External             
                   |----  ATG                                 External             
                   |----  KCLARM                              External             
                   |----  IAND                                External             
                   |----  KLOCK0                              External             
                   |----  IABS                                External             
                   |----  UZERO                               External             
                   |----  CORFORMAT                           External             
                   |----  RSINV                               External             
                   |----  YVSRMI                                                   
   
 
3 QVSTVA
         SUBROUTINE QVSTVA(ITK,PVTX,DJET,SVTX,JET,IVX)
  ------------------------------------------------------------------------------
    CKEY  QVSRCH / INTERNAL
  ------------------------------------------------------------------------------
   Track-jet-vertex association
    Author : T. MATTISON  U.A.BARCELONA/SLAC  1 DECEMBER 1992
    Modified : I.TOMALIN  24/3/94 to also output DCHI2.
    Modified : G.Graefe   25-MAR-1995 adapted to NanoDst
    Input Arguments :
     * ITK IS ALPHA TRACK NUMBER
     * PVTX() IS PRIMARY VERTEX IN ALEPH COORDINATES
     * DJET(,) IS TWO NORMALIZED JET DIRECTIONS IN ALEPH COORDINATES
     * SVTX(,) IS TWO SECONDARY VERTICES IN TRANSLATED-ROTATED COORDINATES
         ORIGIN AT PVTX, 3D AXIS IN DJET DIRECTIONS
    Output Arguments :
     * JET=1 OR 2 ACCORDING TO JET DIRECTION
     * IVX=1 FOR PRIMARY,
     * IVX=2 FOR SECONDARY (IN ABOVE JET)
     * IVX=0 FOR TRACK PASSING CUTS BUT NOT CLOSE TO EITHER VERTEX
     * IVX=-1 FOR TRACK FAILING CUTS
    Entry point : QVSTCHI2 (DCHI2)
     * DCHI2 IS CHI**2 FOR TRACK TO COME FROM PRIMARY VERTEX MINUS
                CHI**2 TO COME FROM SECONDARY.
   
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   QBMTAG                                                                          
        |---- QVSTVA                                                               
                   |----  NVSTVA                                                   
                   |----  QVSTKJ                                                   
                   |----  ABS                                 External             
                   |----  QVSGTK2                                                  
                   |----  QVSIMP                                                   
                   |----  MIN                                 External             
   
 
3 QVSVTX
         SUBROUTINE QVSVTX(PVTX,EPVTX,DJET,BTAG,SVTX,ESVTX,IERR)
  ------------------------------------------------------------------------------
    CKEY  QVSRCH / INTERNAL
  ------------------------------------------------------------------------------
   Finds secondary vertices, errors, and b-tag variables, for 2 jets
    Called from QVSRCH
    Author : T. MATTISON  U.A.BARCELONA/SLAC  1 DECEMBER 1992
    Input Arguments :
    *  PVTX() IS PRIMARY VERTEX IN ALEPH XYZ COORDINATES
    *  EPVTX() IS ERROR (NOT VARIANCE) IN PVTX
    *  DJET(3,2) IS TWO NORMALIZED XYZ DIRECTION VECTORS FOR TWO JETS
    Output Arguments :
    *  BTAG(2) IS THE B-TAGGING VARIABLE FOR THE TWO HEMISPHERES
          IT IS BASICALLY THE HALF THE CHI-SQUARE DIFFERENCE BETWEEN THE
          HYPOTHESIS THAT ALL TRACKS IN THE HEMISPHERE COME FROM PRIMARY
          OR THAT SOME TRACKS COME FROM THE SECONDARY AND SOME FROM
          PRIMARY A CUT AT 10, OR AT 20 ON THE SUM, IS REASONABLE
    *  SVTX(3,2) IS TWO SECONDARY VERTICES IN COORDINATE SYSTEMS
          THAT ARE USED INTERNALLY, (ONE SYSTEM PER JET)
          ORIGINS ARE AT PVTX(), AND ARE ORIENTED BY DJET(,)
          THE THIRD COORDINATE IS THE DECAY LENGTH IN THE JET DIRECTION
          THE FIRST COORDINATE IS R-PHI-LIKE, THE SECOND IS Z-LIKE
    *  ESVTX(3,2) IS THE ERRORS ON SVTX() IN THE INTERNAL ROTATED SYSTEM
          WHERE GEOMETRICAL CORRELATIONS ARE SMALL AND IGNORED
          MAY BE NEGATIVE, INDICATING A PROBLEM, NOT NECESSARILY SEVERE,
          IN FINDING THE VERTEX
    *  IERR IS ERROR FLAG
         0 FOR OK
         1 FOR SECONDARY VERTEX 1 ERRORS QUESTIONABLE
         2 FOR SECONDARY VERTEX 2 ERRORS QUESTIONABLE
         3 FOR QUESTIONABLE ERRORS ON BOTH SECONDARY VERTICES
         4 FOR NO GOOD TRACKS IN JET 1
         8 FOR NO GOOD TRACKS IN JET 2
        12 FOR NO GOOD TRACKS AT ALL
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   QVSRCH                                                                          
        |---- QVSVTX                                                               
                   |----  QVSGTL1                                                  
                   |----  QVSWBK                                                   
                   |----  YVSXZJ                                                   
                   |----  WDROP                               External             
   
 
3 QVSWBK
         SUBROUTINE QVSWBK(LEN,LBL)
  ------------------------------------------------------------------------------
    CKEY  QVSRCH / INTERNAL
  ------------------------------------------------------------------------------
   Creates bos work bank - internal to qvsrch
    Author : T. MATTISON  U.A.BARCELONA/SLAC  1 DECEMBER 1992
    Input Arguments :
    *  LEN IS NUMBER OF WORDS NEEDED
    *  LBL IS STRING USED AS BANK LABEL
    *  IND SHOULD BE IN LABELLED COMMON AND ZEROED AT START OF JOB
    Output Arguments :
    *  IPTR IN /YVSWRK/ IS POINTER TO WORK BANK
    *  RW(IPTR+1) IS WORK ARRAY
       USER SHOULD CALL WDROP(IW,IPTR) WHEN DONE
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   QVSPVX                                                                          
   QVSVTX                                                                          
        |---- QVSWBK                                                               
                   |----  WBANK                               External             
                   |----  INTCHA                              External             
                   |----  BOSBK                               External             
                   |----  QMTERM                                                   
   
 
3 QVSXZB
         SUBROUTINE QVSXZB(ITK,TSMR,YB,XB,VXB,ZB,VZB)
  ------------------------------------------------------------------------------
    CKEY  QVSRCH / INTERNAL
  ------------------------------------------------------------------------------
   Finds track impact with beam plane
    Author : T. MATTISON  U.A.BARCELONA/SLAC  1 DECEMBER 1992
    Input Arguments :
    *  ITK IS ALPHA TRACK INDEX
    *  TSMR IS ADDITIONAL TRACK SMEARING
    *  YB IS Y COORDINATE OF BEAM PLANE
    Output Arguments :
    *  XB,ZB ARE TRACK IMPACTS ON HORIZONTAL PLANE OF BEAM
    *  VXB,VZB ARE VARIANCES IN XB, ZB
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   YVSXZB                                                                          
        |---- QVSXZB                                                               
                   |----  SIGN                                External             
                   |----  SQRT                                External             
                   |----  ABS                                 External             
                   |----  NINT                                External             
                   |----  KMATIX                              External             
                   |----  ATG                                 External             
                   |----  KCLARM                              External             
                   |----  IAND                                External             
                   |----  KLOCK0                              External             
                   |----  IABS                                External             
                   |----  QVSTKP                                                   
   
 
3 QVSZ0B
         SUBROUTINE QVSZ0B(ITK,PVXY,ZB,VZB)
  ------------------------------------------------------------------------------
    CKEY  QVSRCH / INTERNAL
  ------------------------------------------------------------------------------
   Returns zb = z at distance of closest approach to beam axis
       and VZB=variance (sigma-squared)
       given ALPHA track index ITK, and beam axis PVXY(),
    Author : T. MATTISON  U.A.BARCELONA/SLAC  1 DECEMBER 1992
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   YVSZVC                                                                          
        |---- QVSZ0B                                                               
                   |----  SIGN                                External             
                   |----  SQRT                                External             
                   |----  ABS                                 External             
                   |----  NINT                                External             
                   |----  KMATIX                              External             
                   |----  ATG                                 External             
                   |----  KCLARM                              External             
                   |----  IAND                                External             
                   |----  KLOCK0                              External             
                   |----  IABS                                External             
                   |----  SIN                                 External             
                   |----  COS                                 External             
   
 
3 YVSCM2
         SUBROUTINE YVSCM2(F1,F2,NU1,NV,NU2,MU1,MV,MU2)
  ------------------------------------------------------------------------------
    CKEY  QVSRCH / INTERNAL
  ------------------------------------------------------------------------------
   Finds consistent peak in 2 sampled 2-d likelihood functions
       STAYS AWAY FROM EDGES IN ALL VARIABLES
    Author : T. MATTISON  U.A.BARCELONA/SLAC  1 DECEMBER 1992
    Input Arguments :
    *  F1 IS FIRST FUNCTION, STORED AS IF DIMENSIONED F1(NU1,NV)
    *  F2 IS SECOND, STORED AS F2(NU2,NV)
    *  NU1,NV,NU2 ARE DIMENSIONS OF ARRAYS
    Output Arguments :
    *  MU1,MV,MU2 DESCRIBE LOCATION OF MAXIMUM OF SUM OF 2 FUNCTIONS:
          F1(MU1,MV)+F2(MU2,MV)
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   YVSXZJ                                                                          
        |---- YVSCM2.                                                              
   
 
3 YVSLF1
         SUBROUTINE YVSLF1(NB,UL,UH,U,EU,EUMX,VLF)
  ------------------------------------------------------------------------------
    CKEY  QVSRCH / INTERNAL
  ------------------------------------------------------------------------------
   Adds track to 1-dimension log-likelihood distribution vlf
    Author : T. MATTISON  U.A.BARCELONA/SLAC  1 DECEMBER 1992
    Input Arguments :
    *  NB,UL,UH ARE NUMBER OF BINS, LOW AND HIGH LIMITS
    *  U,EU ARE VALUE AND SIGMA
    *  EUMX IS HOW MANY SIGMAS THE DISTRIBUTION REMAINS GAUSSIAN
    *  VLF(NB) IS ARRAY CONTAINING LOG-LIKELIHOOD FUNCTION
    Output Argument :
       ALTERS VLF()
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   YVSZVC                                                                          
        |---- YVSLF1                                                               
                   |----  MAX                                 External             
   
 
3 YVSLF2
         SUBROUTINE YVSLF2(NBU,UL,UH,U,EU,NBV,VL,VH,V,EV,SGMX,VLF)
  ------------------------------------------------------------------------------
    CKEY  QVSRCH / INTERNAL
  ------------------------------------------------------------------------------
   Adds track (point) to 2-dimension log-likelihood distribution vlf.
       SPECIALIZED FOR PRIMARY VERTEX IN A PLANE
    Author : T. MATTISON  U.A.BARCELONA/SLAC  1 DECEMBER 1992
    Input Arguments :
    *  NBU,UL,UH ARE NUMBER OF BINS, LOW AND HIGH LIMITS
         FOR FIRST VARIABLE
    *  NBV,VL,VH ARE SAME FOR SECOND VARIABLE
    *  U,EU ARE VALUE AND SIGMA OF BEAM IMPACT POINT
    *  V,EV ARE SAME IN SECOND VARIABLE
    *  SGMX IS HOW MANY SIGMAS THE DISTRIBUTION REMAINS GAUSSIAN
    *  VLF(NBU*NBV+NBU+NBV) IS ARRAY CONTAINING LOG-LIKELIHOOD FUNCTION
          AND SOME SCRATCH SPACE AT THE END
    Output Arguments :
    *  ALTERS VLF()
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   YVSXZB                                                                          
        |---- YVSLF2                                                               
                   |----  MAX                                 External             
   
 
3 YVSLFL
         SUBROUTINE YVSLFL(NBU,UL,UH,U,EU,EUMX,NBV,VL,VH,DUDV,D2UDV2,
  ------------------------------------------------------------------------------
    CKEY  QVSRCH / INTERNAL
  ------------------------------------------------------------------------------
        > VLF)
   Adds line (track) to 2-dimension log-likelihood distribution vlf.
    Author : T. MATTISON  U.A.BARCELONA/SLAC  1 DECEMBER 1992
    Input Arguments :
    *  NBU,UL,UH ARE NUMBER OF BINS, LOW AND HIGH LIMITS
          FOR DEPENDENT VARIABLE U
    *  U,EU ARE VALUE AND SIGMA AT INDEPENDENT VARIABLE V=0
    *  EUMX IS HOW MANY SIGMAS THE DISTRIBUTION REMAINS GAUSSIAN
    *  NBV,VL,VH ARE NUMBER OF BINS, LOW AND HIGH LIMITS
          FOR INDEPENDENT VARIABLE
    *  DUDV,D2UDV2 ARE 1,2 DERIVATIVES OF U WITH RESPECT TO V
          U(V)= U + DUDV*V + .5*D2UDV2*V*V
    *  VLF(NBU*NBV) IS ARRAY CONTAINING LOG-LIKELIHOOD FUNCTION
          STORED AS VLF(IU,IV)
    Output Argument :
       ALTERS VLF()
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   YVSXZJ                                                                          
        |---- YVSLFL                                                               
                   |----  MAX                                 External             
   
 
3 YVSML1
         SUBROUTINE YVSML1(NB,UL,UH,VLF,UM,EUM,VLFM)
  ------------------------------------------------------------------------------
    CKEY  QVSRCH / INTERNAL
  ------------------------------------------------------------------------------
   Finds maximum of 1-dimensional likelhood function
    Author : T. MATTISON  U.A.BARCELONA/SLAC  1 DECEMBER 1992
    Input Arguments :
    *  NB,UL,UH ARE NUMBER OF BINS, LOWER AND UPPER LIMITS
    *  VLF() IS ARRAY CONTAINING LIKELIHOOD FUNCTION
    Output Arguments :
        (FROM LOCAL PARABOLA FIT TO 3 BINS AT PEAK)
    *  UM IS LOCATION OF MAXIMUM
    *  EUM IS ERROR (NEGATIVE IF NO REAL MAXIMUM FOUND)
    *  VLFM IS VALUE AT MAXIMUM
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   YVSZVC                                                                          
        |---- YVSML1                                                               
                   |----  SIGN                                External             
                   |----  SQRT                                External             
                   |----  ABS                                 External             
   
 
3 YVSML2
         SUBROUTINE YVSML2(NBU,UL,UH,NBV,VL,VH,VLF,
  ------------------------------------------------------------------------------
    CKEY  QVSRCH / INTERNAL
  ------------------------------------------------------------------------------
        > UM,EUM,VM,EVM,UVCR,VLFM)
   Finds maximum of 2-dimensional likelhood function
    Author : T. MATTISON  U.A.BARCELONA/SLAC  1 DECEMBER 1992
    Input Arguments :
    *  NBU,UL,UH ARE NUMBER OF BINS, LOWER AND UPPER LIMITS
          FOR FIRST VARIABLE
    *  NBU,UL,UH ARE SAME FOR SECOND VARIABLE
    *  VLF(NBU,NBV) IS ARRAY CONTAINING LIKELIHOOD FUNCTION
    Output Arguments :
        (FROM LOCAL PARABOLA FIT TO 9 BINS AT PEAK)
    *  UM IS LOCATION OF MAXIMUM IN FIRST VARIABLE
    *  EUM IS ERROR (NEGATIVE IF NO REAL MAXIMUM FOUND)
    *  VM,EVM ARE SAME FOR SECOND
    *  UVCR IS NORMALIZED CORRELATION
    *  VLFM IS VALUE AT MAXIMUM
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   YVSXZB                                                                          
        |---- YVSML2                                                               
                   |----  MAX                                 External             
                   |----  MIN                                 External             
                   |----  YVSPAR                                                   
                   |----  YVSPRM                                                   
                   |----  ABS                                 External             
   
 
3 YVSPAR
         SUBROUTINE YVSPAR(VLF,NBU,MU,MV,PAR)
  ------------------------------------------------------------------------------
    CKEY  QVSRCH / INTERNAL
  ------------------------------------------------------------------------------
   Finds paraboloid parameters for 2-d sampled distribution
       VLF(MU+DU,MV+DV)
        =  P1*DU**2+P2*DU+P3
          +P4*DV**2+P5*DV+P6*DU*DV
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   YVSML2                                                                          
   YVSPR2                                                                          
        |---- YVSPAR.                                                              
   
 
3 YVSPR2
         SUBROUTINE YVSPR2(F1,F2,NU1,NV,NU2,MU1,MV,MU2,
  ------------------------------------------------------------------------------
    CKEY  QVSRCH / INTERNAL
  ------------------------------------------------------------------------------
        > IERR,U1M,U1E,VM,VE,U2M,U2E,F1M,F2M)
   Fits combined paraboloid to 2 2-d functions
    Author : T. MATTISON  U.A.BARCELONA/SLAC  1 DECEMBER 1992
    Input Arguments :
    *  F1 IS FIRST FUNCTION, STORED AS IF DIMENSIONED F1(NU1,NV)
    *  F2(NU2,NV) IS ANALOGOUS
    *  NU1,NV,NU2 ARE THE DIMENSIONS
    *  MU1,MV,MU2 ARE THE COORDINATES OF THE MAXIMUM
          MUST BE >1, < DIMENSION
    Output Arguments :
    *  IERR=0 FOR OK, 1 FOR MATRIX PROBLEM, 2 FOR MAXIMUM PROBLEMS
    *  U1M IS THE FRACTION OF A BIN TO THE INTERPOLATED MAXIMUM
         FOR THE U VARIABLE IN F1
    *  U1E IS THE ERROR (HALF LOG-LIKELIHOOD UNIT) IN BIN UNITS
    *  U1M,U2E ARE ANALOGOUS FOR THE U2 VARIABLE IN F2
    *  VM,VE ARE ANALOGOUS FOR THE COMMON VARIABLE V
          ERRORS CAN BE NEGATIVE IF IERR .NE. 0
    *  F1M IS VALUE OF F1 AT THE MAXIMUM POINT, SIMILAR FOR F2M
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   YVSXZJ                                                                          
        |---- YVSPR2                                                               
                   |----  YVSPAR                                                   
                   |----  SQRT                                External             
                   |----  RFACT                               External             
                   |----  RFEQN                               External             
                   |----  RFINV                               External             
   
 
3 YVSPRM
         SUBROUTINE YVSPRM(PAR,DU,EU,DV,EV,UVCR,PMX)
  ------------------------------------------------------------------------------
    CKEY  QVSRCH / INTERNAL
  ------------------------------------------------------------------------------
   Finds maximum and error at peak of 6-parameter paraboloid
       REPRESENTING 2-D LIKELIHOOD PEAK
    Author : T. MATTISON  U.A.BARCELONA/SLAC  1 DECEMBER 1992
    Input Arguments :
       F=PAR(1)*DU*DU + PAR(2)*DU + PAR(3) +
         PAR(4)*DV*DV + PAR(5)*DV + PAR(6)*DU*DV
    Output Arguments :
    *  DU,DV STEPS TO MAX IN BIN UNITS
    *  EU,EV ARE ERROR IN BIN UNITS
    *  UVCR IS NORMALIZED CORRELATION
    *  PMX IS INTERPOLATED VALUE AT MAXIMUM
          IF PROBLEMS LIKE NO MAX, NOT POS-DEFINITE,
          EU AND/OR EV WILL BE NEGATIVE
          DU AND/OR DV MAY BE ZERO
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   YVSML2                                                                          
        |---- YVSPRM                                                               
                   |----  SQRT                                External             
                   |----  SIGN                                External             
   
 
3 YVSPVE
         SUBROUTINE YVSPVE(EVTX,DJET,EX,EZ,ET)
  ------------------------------------------------------------------------------
    CKEY  QVSRCH / INTERNAL
  ------------------------------------------------------------------------------
   Finds projected primary vertex errors in rotated system
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   QVSIMP                                                                          
   YVSXZJ                                                                          
        |---- YVSPVE                                                               
                   |----  UZERO                               External             
                   |----  YVSRMJ                                                   
                   |----  SQRT                                External             
                   |----  ABS                                 External             
   
 
3 YVSRMI
         SUBROUTINE YVSRMI(DIR,A,B)
  ------------------------------------------------------------------------------
    CKEY  QVSRCH / INTERNAL
  ------------------------------------------------------------------------------
   Inverse-rotates covariance or weight matrix
    Author : T. MATTISON  U.A.BARCELONA/SLAC  1 DECEMBER 1992
    Input Arguments :
    *  DIR() IS NORMALIZED DIRECTION VECTOR
    *  A(,) IS MATRIX IN COORDINATE SYSTEM WHERE DIR=(0,0,1)
    Output Argument :
       B(,) IS OUTPUT MATRIX
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   QVSAVX                                                                          
   QVSTKW                                                                          
        |---- YVSRMI                                                               
                   |----  YVSROM                                                   
                   |----  UCOPY                               External             
   
 
3 YVSRMJ
         SUBROUTINE YVSRMJ(DIR,A,B)
  ------------------------------------------------------------------------------
    CKEY  QVSRCH / INTERNAL
  ------------------------------------------------------------------------------
   Rotates covariance or weight matrix
    Author : T. MATTISON  U.A.BARCELONA/SLAC  1 DECEMBER 1992
    Input Arguments :
    *  DIR() IS NORMALIZED DIRECTION VECTOR
    *  A(,) IS INPUT MATRIX
    Output Argument :
    *  B(,) IS MATRIX IN COORDINATE SYSTEM WHERE DIR=(0,0,1)
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   QVSTKP                                                                          
   YVSPVE                                                                          
        |---- YVSRMJ                                                               
                   |----  YVSROM                                                   
                   |----  UCOPY                               External             
   
 
3 YVSROM
         SUBROUTINE YVSROM(DIR,ROT)
  ------------------------------------------------------------------------------
    CKEY  QVSRCH / INTERNAL
  ------------------------------------------------------------------------------
   Makes forward rotation matrix
    Author : T. MATTISON  U.A.BARCELONA/SLAC  1 DECEMBER 1992
    Input Argument :
       DIR() IS NORMALIZED DIRECTION VECTOR
    Output Argument :
       ROT(,) IS MATRIX THAT ROTATES DIR() TO DIR'=(0,0,+1)
          DIR'(I)= ROT(I,J)*DIR(J), SUMMED OVER J
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   YVSRMI                                                                          
   YVSRMJ                                                                          
   YVSRTI                                                                          
   YVSRTJ                                                                          
        |---- YVSROM                                                               
                   |----  SQRT                                External             
                   |----  UZERO                               External             
   
 
3 YVSRTI
         SUBROUTINE YVSRTI(DJET,XYZR,XYZ)
  ------------------------------------------------------------------------------
    CKEY  QVSRCH / INTERNAL
  ------------------------------------------------------------------------------
   Inverse-rotates vector xyz from djet direction
    Author : T. MATTISON  U.A.BARCELONA/SLAC  1 DECEMBER 1992
    Input Arguments :
    *  DJET() IS NORMALIZED DIRECTION VECTOR
    *  XYZR() IS VECTOR TO BE TRANSFORMED
         XYZR(3) COMPONENT IS ALONG DJET DIRECTION
    Output Argument :
    *  XYZ() IS VECTOR IN NEW SYSTEM
         CAN BE SAME FORTRAN ARRAY AS XYZR
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   YVSTRI                                                                          
        |---- YVSRTI                                                               
                   |----  YVSROM                                                   
   
 
3 YVSRTJ
         SUBROUTINE YVSRTJ(DJET,XYZ,XYZR)
  ------------------------------------------------------------------------------
    CKEY  QVSRCH / INTERNAL
  ------------------------------------------------------------------------------
   Rotates vector xyz into djet direction
    Author : T. MATTISON  U.A.BARCELONA/SLAC  1 DECEMBER 1992
    Input Arguments :
    *  DJET() IS NORMALIZED DIRECTION VECTOR
    *  XYZ() IS VECTOR TO BE TRANSFORMED
    Output Argument :
    *  XYZR() IS VECTOR IN NEW SYSTEM
         XYZR(3) COMPONENT IS ALONG DJET DIRECTION
         CAN BE SAME FORTRAN ARRAY AS XYZ
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   QVSTKP                                                                          
   YVSTRJ                                                                          
        |---- YVSRTJ                                                               
                   |----  YVSROM                                                   
   
 
3 YVSTKE
         SUBROUTINE YVSTKE(WTM,VXP,VZP,VXZ)
  ------------------------------------------------------------------------------
    CKEY  QVSRCH / INTERNAL
  ------------------------------------------------------------------------------
   Finds track error**2 in jet coordinate system
    Author : T. MATTISON  U.A.BARCELONA/SLAC  1 DECEMBER 1992
    Input Argument :
       WTM(,) IS 3D TRACK WEIGHT MATRIX IN JET SYSTEM
    Output Arguments :
    *  VXP IS TRACK VARIANCE (SIGMA**2) IN D0-LIKE DIRECTION
    *  VZP IS TRACK VARIANCE IN Z0-LIKE DIRECTION
    *  VXZ IS COVARIANCE
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   QVSTKP                                                                          
        |---- YVSTKE                                                               
                   |----  SQRT                                External             
                   |----  ABS                                 External             
                   |----  RSINV                               External             
                   |----  IFAILFORMAT                         External             
   
 
3 YVSTP0
         SUBROUTINE YVSTP0(XYZ,DIR,CRV,S0,IERR)
  ------------------------------------------------------------------------------
    CKEY  QVSRCH / INTERNAL
  ------------------------------------------------------------------------------
   Finds path-length that steps track vector to z=0
    Author : T. MATTISON  U.A.BARCELONA/SLAC  1 DECEMBER 1992
    Input Arguments :
    *  XYZ(3) IS TRACK POSITION  AT S=0
    *  DIR(3) IS TRACK DIRECTION AT S=0
    *  CRV(3) IS TRACK CURVATURE AT S=0
         COMPONENTS 1,2 ARE IGNORED
    Output Arguments :
    *  S0 IS S VALUE THAT MAKES XYZS(3)=0
    *  IERR IS ERROR FLAG
         =0 FOR OK
         =1 IF TRACK CURVES AWAY
            (S0 IS CALCULATED WITH CRV(3)=0 IN THIS CASE)
         =2 IF DIR(3)=CRV(3)=0
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   QVSTKP                                                                          
        |---- YVSTP0                                                               
                   |----  DSQRT                               External             
                   |----  ABS                                 External             
   
 
3 YVSTRI
         SUBROUTINE YVSTRI(PVTX,DJET,XYZR,XYZ)
  ------------------------------------------------------------------------------
    CKEY  QVSRCH / INTERNAL
  ------------------------------------------------------------------------------
   Inverse-tranforms point in xyzr system to xyz system
       (ORIGIN AT PVTX, ROTATED TO DJET DIRECTION)
    Author : T. MATTISON  U.A.BARCELONA/SLAC  1 DECEMBER 1992
    Input Arguments :
    *  PVTX() IS ORIGIN OF NEW SYSTEM (PRIMARY VERTEX)
    *  DJET() IS NORMALIZED DIRECTION VECTOR
    *  XYZR() IS POINT TO BE TRANSFORMED
         XYZR(3) COMPONENT IS ALONG DJET DIRECTION
    Output Argument :
    *  XYZ() IS POINT IN ORIGINAL SYSTEM
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   QVSAVX                                                                          
        |---- YVSTRI                                                               
                   |----  YVSRTI                                                   
   
 
3 YVSTRJ
         SUBROUTINE YVSTRJ(PVTX,DJET,XYZ,XYZR)
  ------------------------------------------------------------------------------
    CKEY  QVSRCH / INTERNAL
  ------------------------------------------------------------------------------
   Tranforms point in xyz system to xyzr system
       (ORIGIN AT PVTX, ROTATED TO DJET DIRECTION)
    Author : T. MATTISON  U.A.BARCELONA/SLAC  1 DECEMBER 1992
    Input Arguments :
    *  PVTX() IS ORIGIN OF NEW SYSTEM (PRIMARY VERTEX)
    *  DJET() IS NORMALIZED DIRECTION VECTOR
    *  XYZ() IS POINT TO BE TRANSFORMED
    Output Argument :
    *  XYZR() IS POINT IN NEW SYSTEM
         XYZR(3) COMPONENT IS ALONG DJET DIRECTION
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   QVSTKP                                                                          
        |---- YVSTRJ                                                               
                   |----  YVSRTJ                                                   
   
 
3 YVSVJE
         SUBROUTINE YVSVJE(EU,EDUDV,SGMX,NBU,UL,UH,NBV,VL,VH,VLF)
  ------------------------------------------------------------------------------
    CKEY  QVSRCH / INTERNAL
  ------------------------------------------------------------------------------
   Puts vertex and jet angle resolution into likelihood function
       CENTERED AT U=0, DU/DV=0
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   YVSXZJ                                                                          
        |---- YVSVJE                                                               
                   |----  SQRT                                External             
                   |----  MAX                                 External             
   
 
3 YVSWIM
         SUBROUTINE YVSWIM(S,XYZ,DIR,CRV,XYZS,DIRS)
  ------------------------------------------------------------------------------
    CKEY  QVSRCH / INTERNAL
  ------------------------------------------------------------------------------
   Swims track description vectors to path-length s
    Author : T. MATTISON  U.A.BARCELONA/SLAC  1 DECEMBER 1992
    Input Arguments :
    *  XYZ(3) IS TRACK POSITION  AT S=0
    *  DIR(3) IS TRACK DIRECTION AT S=0
    *  CRV(3) IS TRACK CURVATURE AT S=0
         AT ANY S, XYZS(I) = XYZ(I) + DIR(I)*S + .5*CRV(I)*S*S
    Output Arguments :
    *  XYZS(3) IS TRACK POSITION  AT S
    *  DIRS(3) IS TRACK DIRECTION AT S
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   QVSTKP                                                                          
        |---- YVSWIM.                                                              
   
 
3 YVSXZB
         SUBROUTINE YVSXZB(BPOS,BSIZ,NGTK,JGTK,TSMR,SGMX,
  ------------------------------------------------------------------------------
    CKEY  QVSRCH / INTERNAL
  ------------------------------------------------------------------------------
        > NBX,XL,XH,NBZ,ZL,ZH,VLF,
        > XV,EXV,ZV,EZV,VLFM)
   Finds x-z of primary vertex
       USING SAMPLED MAXIMUM LIKELIHOOD FIT TO X-Z PLANE
    Author : T. MATTISON  U.A.BARCELONA/SLAC  1 DECEMBER 1992
    Input Arguments :
    *  BPOS() IS BEAM POSITION X,Y,Z
        (Y COORDINATE SHOULD BE HIGH QUALITY, I.E., QVYNOM, OR FROM GETBP)
    *  BSIZ() IS LUMINOUS REGION SIZE (1 SIGMA)
    *  JGTK IS ARRAY CONTAINING A LIST OF NGTK TRACKS
    *  TSMR IS ADDITIONAL TRACK SMEARING
    *  SGMX IS NUMBER OF SIGMA ALLOWED TO USE A TRACK
    *  NBX,XL,XH ARE BINS, LOW AND HIGH LIMITS FOR VERTEX X
    *  NBZ,ZL,ZH ARE SAME FOR VERTEX Z
    *  VLF(NBX*NBZ) IS SAMPLED LOG-LIKELIHOOD ARRAY
    Output Arguments :
    *  XV,ZV,EXV,EZV ARE X AND Z VERTEX AND ERROR
         (Y VERTEX IS IMPLICITLY THE Y BEAM POSITION)
    *  VLF CONTAINS 2-DIMENSION LOG-LIKELIHOOD FUNCTION:
    *  VLFM IS THE INTERPOLATED VALUE OF LIKELIHOOD FUNCTION
          AT THE COMBINED PEAK
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   QVSPVX                                                                          
        |---- YVSXZB                                                               
                   |----  UZERO                               External             
                   |----  YVSLF2                                                   
                   |----  QVSXZB                                                   
                   |----  MAX                                 External             
                   |----  SQRT                                External             
                   |----  ABS                                 External             
                   |----  YVSML2                                                   
   
 
3 YVSXZJ
         SUBROUTINE YVSXZJ(NGTK,JGTK,PVTX,EVTX,DJET,JET,EJET,SGMX,
  ------------------------------------------------------------------------------
    CKEY  QVSRCH / INTERNAL
  ------------------------------------------------------------------------------
        > NBX,XL,XH,NBZ,ZL,ZH,NBT,TL,TH,VLF,
        > XV,EXV,ZV,EZV,TV,ETV,DLLX,DLLZ)
   Finds x,z,and t of secondary vertex
       IN VERTEX-JET COORDINATE SYSTEM (T MEANS ALONG JET DIRECTION)
       USING SAMPLED MAXIMUM LIKELIHOOD FIT TO PROJECTIONS
    Author : T. MATTISON  U.A.BARCELONA/SLAC  1 DECEMBER 1992
    Input Arguments :
    *  JGTK IS ARRAY CONTAINING A LIST OF NGTK TRACKS
    *  PVTX() IS COORDINATE OF PRIMARY VERTEX IN ALEPH COORDINATES
    *  EVTX() IS ERROR IN PVTX
    *  DJET() IS TWO NORMALIZED 3-VECTOR JET DIRECTIONS
          MUST BE NORMALIZED TO 1 (NOT CHECKED HERE)
    *  JET IS WHICH JET TO DO (1 OR 2)
    *  EJET IS ERROR IN JET ANGLE
    *  SGMX IS GAUSSIAN RANGE OF ERRORS (CONSIDERED FLAT BEYOND THIS)
    *  NBX,XL,XH ARE BINS, LOW AND HIGH LIMITS FOR VERTEX X
    *  NBZ,ZL,ZH ARE SAME FOR VERTEX Z
    *  NBT,TL,TH ARE SAME FOR DECAY LENGTH IN DJET DIRECTION
    *  VLF((NBX+NBZ)*NBT) IS SAMPLED LOG-LIKELIHOOD ARRAY
    Output Arguments :
    *  XV,ZV,EXV,EZV ARE X AND Z VERTEX AND ERROR NORMAL TO DJET(,JET)
          IN THE ROTATED AND TRANSLATED COORDINATE SYSTEM
    *  TV,ETV IS THE DECAY LENGTH AND ERROR
          IN THE DJET(,JET) DIRECTION
    *  VLF CONTAINS 2 2-DIMENSIONAL SAMPLED LOG-LIKELIHOOD FUNCTIONS:
          VLFX(NBX,NBT),VLFZ(NBZ,NBT)
    *  DLLX,DLLZ ARE VALUES OF LIKELIHOOD FUNCTIONS AT THE COMBINED PEAK
          WHICH IS ALSO THE DIFFERENCE IN LOG-LIKELIHOOD BETWEEN
          PRESENCE AND ABSENCE OF THE SECONDARY VERTEX
          IN THE TWO PROJECTIONS
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   QVSVTX                                                                          
        |---- YVSXZJ                                                               
                   |----  UZERO                               External             
                   |----  YVSPVE                                                   
                   |----  YVSVJE                                                   
                   |----  QVSTKJ                                                   
                   |----  QVSTKP                                                   
                   |----  MAX                                 External             
                   |----  SQRT                                External             
                   |----  ABS                                 External             
                   |----  MIN                                 External             
                   |----  YVSLFL                                                   
                   |----  YVSCM2                                                   
                   |----  YVSPR2                                                   
   
 
3 YVSZVC
         SUBROUTINE YVSZVC(PVXY,NGTK,JGTK,SGMX,NB,ZL,ZH,VLF,ZV,EZV)
  ------------------------------------------------------------------------------
    CKEY  QVSRCH / INTERNAL
  ------------------------------------------------------------------------------
   Finds coarse z vertex by sampled likelihood fit
       TO TRACK IMPACT PARAMETERS WITH BEAM AXIS
    Author : T. MATTISON  U.A.BARCELONA/SLAC  1 DECEMBER 1992
    Input Arguments :
    *  PVXY() IS X,Y COORDINATES OF BEAM AXIS
    *  JGTK() CONTAINS LIST OF TRACK INDICES
    *  NGTK IS NUMBER OF TRACKS
    *  VLF() IS WORK ARRAY VLF, LENGTH AT LEAST NB
    *  SGMX IS NUMBER OF SIGMAS AWAY FROM Z0 THAT ARE GAUSSIAN
         (ASSUMED FLAT BEYOND THIS)
    *  NB IS NUMBER OF BINS
    *  ZL, ZH ARE LOW AND HIGH LIMITS OF SEARCH FOR VERTEX Z
    Output Arguments :
    *  ZV IS THE RESULT, EZV IS THE ERROR
    *  VLF CONTAINS LOG-LIKELIHOOD FUNCTION
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   QVSPVX                                                                          
        |---- YVSZVC                                                               
                   |----  UZERO                               External             
                   |----  QVSZ0B                                                   
                   |----  MAX                                 External             
                   |----  SQRT                                External             
                   |----  ABS                                 External             
                   |----  YVSLF1                                                   
                   |----  YVSML1                                                   
   

2 UTIL

  >>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>
    CKEY 
      First entry of <ALFUTIL> set of ALPHA user's Physics routines
  <<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<
     BPLE14 
     CHTSIM     Check version of tpcsim.
     EPADE14    Xnano   .true. if input is a nanodst (in nano or epio format, depending
     IEFMC 
     IMCEF 
     JULMATCH   Match a reconstructed track with mc truth, and classify the track.
     KBESTM     Find best match between fitted and mc track
     KEFMC 
     KIDSAV     Save particle with name cnam and set the mass
     KMCEF 
     KMLEPT     Find true mc source of a detected lepton
     KNCHMC 
     KNECMC 
     KNEFMC 
     KNHCMC 
     KNMCCH 
     KNMCEC 
     KNMCEF 
     KNMCHC 
     KNMCSI 
     KNSIMC 
     KNTRU 
     KTRU 
     KVFITA     Fit mass and save particle with name cnam
     KVFITC     Fit ntkd tracks in itkd(i) to a common vertex with mass constr.
     KVFITM     Fit mass and save particle with name cnam
     KVFITN     Fit ntkd tracks in itkd(i) to a common vertex.
     KVFITV     Fit ntkd tracks itkd(i) to a common vertex using vertex ivtx as
     KVFTMC     Fit ntkd tracks in itkd(i) to a common vertex using a lagrange
     LCRAE14    Set of intrinsic functions to handle bos banks
     MCMATCH    Match a mc truth with reconstructed, and classify the track.
     MKPECPC    Xnano   .true. if input is a nanodst (in nano or epio format, depending
     MMUIDF     Calculates the muon id flag
     NDIGHE14   Xnano   .true. if input is a nanodst (in nano or epio format, depending
     PMOVE      Re-define the track parameters relative to a new point in space.
     QBMTAG     Invariant mass b tag.
     QCALE14    Xnano   .true. if input is a nanodst (in nano or epio format, depending
     QDDX       De/dx analysis in alpha
     QDEDX      De/dx analysis in alpha
     QDEDXK     Fast, simple de/dx simulation of a single track.
     QDEDXM     Analyse de/dx for monte carlo events by faking the ionization
     QDMMCL     Call qgjmmc, the improved, generalised jade algorithm jet finder
     QEFRTR     Search for track correponding to electron
     QELEP1     Get the run-averaged exact energy for 1993 -> 1995 lep 1 runs
     QELEP2     Get the "instantaneous" exact lep energy for lep 2 runs
     QEWSUM     Xnano   .true. if input is a nanodst (in nano or epio format, depending
     QFDE14     Xnano   .true. if input is a nanodst (in nano or epio format, depending
     QFGETCH 
     QFMCSX 
     QFMMCL     Evaluate jet multiplicities based on the scaled invariant mass
     QGETE14 
     QGETWE14   Set of intrinsic functions to handle bos banks
     QGFOXW     Calculate fox-wolfrom moments h0 -- h4.
     QGJMMC     Set up and call fjmmcl jet finding routine.
     QGLUCL     Evaluate jet multiplicities based on the luclus algorithm (jetset)
     QGMDCL     Evaluate jet multiplicities based on the scaled min. distance
     QGMMCL     Evaluate jet multiplicities based on the scaled invariant mass
     QGPTCL     Ptclus jet algorithm (see aleph  89-150)
     QGSPHE     Calculate sphericity
     QGTENS     Calculate normalised momentum tensor
     QGTHRU     Topological event analysis: thrust
     QIDV0      Calculate mass for particle pointing to v0
     QJADDP     Add 4-vectors
     QJEIG      Set up and call eigenvector  routine.
     QJFOXW     Set up and call fox-wolfram routine.
     QJHEMI     Divide the event into 2 hemispheres
     QJLUCL     Set up and call qglucl jet finding routine. (luclus)
     QJMDCL     Set up and call qgmdcl jet finding routine.
     QJMISS     Missing e,p,m
     QJMMCL     Call qgjmmc, the improved, generalised jade algorithm jet finder
     QJOPTM     Options for qj routines (mc particles)
     QJOPTR     Options for qj routines (reconstructed particles)
     QJPTCL     Calls qgptcl: ptclus jet algorithm (see aleph 89-150).
     QJSAVE     Save vector from topological buffer qctbuf with name cnam.
     QJSET0     Standard set-up for qj routines : get numbers
     QJSET1     Auxiliary to qjset0
     QJSETU     Standard set-up for qj routines
     QJSPHE     Set up and call sphericity routine.
     QJTENS     Set up and call routine to calculate normalized momentum tensor.
     QJTHRU     Thrust
     QKBLOK     Bethe-bloch parameterization of tpc de/dx which always uses the
     QKINKT     Gets alpha "track" list for tracks ending in a kink vertex
     QKINKV     Gets vertex numbers for kinks for new tracking
     QLITK      Set lock flag for track itk.
     QLOCK      Lock track itk.
     QLOCK2     Lock track itk.
     QLREV      Locked tracks -> unlocked tracks and vice versa
     QLREV2     Locked tracks -> unlocked tracks and vice versa
     QLTRK      Set lock flag for track itk.
     QLUITK     Reset lock flag for track itk.
     QLUTRK     Set lock flag for track itk.
     QLV0T      Gets alpha "track" limits for long v0s for new tracking
     QLV0V      Gets vertex numbers for long v0s for new tracking
     QLZER      Reset lock for reco (ifl=1) or mc (ifl=2)
     QLZER2     Reset lock for reco (ifl=1) or mc (ifl=2)
     QMASV0     Calculate v0 invariant mass from r and b parameters (see aleph 88-46)
     QMTHRU     Get pre-calculated thrust from bank 'pthr'
     QMUIDO     Get the muon id information from the banks mcad,hmad,muid
     QMUNEW     Initialize the muon identification
     QNUCL      Gets vertex numbers for nuclear interations for new tracking
     QPADX      De/dx analysis in alpha for pad de/dx
     QPAIRF     Calls dave cinabro's pairfd routine.
     QPCORR     Correct particle momenta for effects of residual distortions in
     QPVMDUM    Dummy routines for pvm on saga machines
     QSEFMC 
     QSMCEF 
     QSTRU 
     QTRUZ 
     QUMUPR     Prepare the muon identification
     QVDHIT     Provide array of number of vdet hits per layer for given track.
     QVKINK     Get special values for kink vertex ivx
     QVTRUH     Provide array of number of correctly associated vdet hits
     QWHICHBP 
     QWHICHEN 
     QWRFSEVT   Write sevt cards file from lists of events selected by the user.
     QWRQWSE    Write sevt cards for run nurun
     QWRSEVT    Fill internal banks for further writing of sevt cards
     QXTRAP     Say if a track intersects active regions of vdet
     QYFIT      Interface for simplified use of ytop from alpha
     QYFITC     Interface for simplified use of ytop with mass constraint from alpha
     QYFITV     Interface for simplified use of ytop from alpha
     QYFTMC     Interface for kvftmc : simplified use of ytop from alpha
     SIBKCL     Checks for quality flag of cluster
     SICLID     Sical returns identification of sical cluster
     TXTREE     Produce a latex source file of the decay tree from a mcarlo event.
     VDHITMAT   Auxiliary to vdhmatch
     VDHMATCH   Count matching vdet hits for a given reconstructed/mctrue track.
     XCEQAN     Particle itk = ipc or its antiparticle ?
     XMRMP 
     XPEQAN     Test if particle itk is of type cpar ( if ianti = 0 )
     XPEQOR     Test if particle itk is of type cpar or its antiparticle.
     XPEQU      Test if particle itk is of type cpar

3 BPLE14
   
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   
         logical function bpl_e14(module,iplane)
    this wire plane dead during the high energy running
   Auxiliary to QGETE14_MOD
   Author G. Taylor Oct 1997
         bpl_e14=.false.
         if (module.eq.15 .and. iplane.eq. 1) bpl_e14=.true. ! .1 Gev
         if (module.eq.22 .and. iplane.eq. 1) bpl_e14=.true. ! .1 Gev
         if (module.eq. 7 .and. iplane.eq. 2) bpl_e14=.true. ! .2 Gev
         if (module.eq.20 .and. iplane.eq. 2) bpl_e14=.true. ! .2 Gev
         if (module.eq.11 .and. iplane.eq. 6) bpl_e14=.true. ! .4 Gev
         if (module.eq.10 .and. iplane.eq.12) bpl_e14=.true. ! .8 Gev
         if (module.eq.3  .and. iplane.eq.18) bpl_e14=.true. ! .9 Gev
         if (module.eq.11 .and. iplane.eq.18) bpl_e14=.true. ! .9 Gev
         if (module.eq.11 .and. iplane.eq.27) bpl_e14=.true. ! .5 Gev
         if (module.eq. 9 .and. iplane.eq.30) bpl_e14=.true. ! .4 Gev
         if (module.eq.27 .and. iplane.eq.32) bpl_e14=.true. ! .3 Gev
         if (module.eq.20 .and. iplane.eq.34) bpl_e14=.true. ! .7 Gev
         if (module.eq. 6 .and. iplane.eq.39) bpl_e14=.true. ! .2 Gev
         if (module.eq. 4 .and. iplane.eq.40) bpl_e14=.true. ! .2 Gev
         if (module.eq. 5 .and. iplane.eq.42) bpl_e14=.true. ! .1 Gev
         if (module.eq. 1 .and. iplane.eq.45) bpl_e14=.true. ! .1 Gev
         if (module.eq. 2 .and. iplane.eq.45) bpl_e14=.true. ! .1 Gev
    in 98
         if (module.eq. 3 .and. iplane.eq.42) bpl_e14=.true. ! .1 Gev
         if (module.eq.17 .and. iplane.eq.43) bpl_e14=.true. ! .1 Gev
         if (module.eq.17 .and. iplane.eq.45) bpl_e14=.true. ! .1 Gev
         return
         end
 
3 CHTSIM
         FUNCTION CHTSIM(IVERS)
  ------------------------------------------------------------------------------
    CKEY  DEDX / USER
  ------------------------------------------------------------------------------
   Check version of tpcsim.
    the version number stored in the  TSIM bank is 216 or higher,
    QDEDX, rather than QDEDXM,  should be called.
     : none
    CHTSIM = .TRUE.  if TPCSIM version number is 216 or higher
                   = .FALSE. if number is less than 216, or if TSIM
                             bank cannot be found.
            IVERS  = TPCSIM version number.
     28-jan-1994 initial version.
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   QSELEP                                                                          
        |---- CHTSIM                                                               
                   |----  NAMIND                              External             
   
 
3 EPADE14
   
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   
         function epad_e14(ipeco,imodule)
    the pad energy of the peco cluster IPECO coming from module IMODULE
   Auxiliary to QFE14
   Author G. Taylor Oct 1997
   
   -------------------- /QCDE/ --- COMMONs, DIMENSIONs, etc. ------------
   
    of QCDESH ----------------------- Description in QDATA ---------
         PARAMETER (KCQDET=34, KCQFPA=8, KCQPAR=10, KCQVEC=73, KCQVRT=30,
        & KHE=1, KHMU=2, KHPI=3, KHK=4, KHP=5, KHPHOT=1, KHNHAD=2,
        & KMONTE=-2, KRECO=-1, KLOCKM=14, KSOVT=1, KSCHT=2, KSIST=3,
        & KSAST=4, KSEHT=5, KSV0T=6, KSDCT=7, KSEFT=8, KSNET=9, KSGAT=10,
        & KSJET=11, KSMCT=12, KSREV=13,
        & KSMCV=14, KUNDEF=-12344321, QQPI=3.141593, QQE=2.718282,
        & QQ2PI=QQPI*2., QQPIH=QQPI/2., QQRADP=180./QQPI, QQC=2.997925E10,
        & QQH=6.582173E-25, QQHC=QQH*QQC, QQIRP=.00029979)
         CHARACTER CQDATE*8, CQDWRK*80, CQFHIS*80, CQFOUT*80, CQFWRK*80,
        & CQHTIT*80, CQSEC*3, CQTIME*8, CQUNPK*30, CQVERS*6, CQRLST*800,
        & CQELST*800
         COMMON /QCDEC/ CQDATE, CQDWRK, CQFHIS, CQFOUT, CQFWRK, CQHTIT,
        & CQSEC(14), CQTIME, CQUNPK, CQVERS, CQRLST, CQELST
         COMMON /QCDE/ QELEP, QMFLD ,QMFLDC, QTIME, QTIMEI, QTIMEL,
        & QTIMES, QTIMET, QDHEEC, QDHEEL, QDHEPF, QDHETH, QDHEPH, QDHEEF,
        & QDHEET, QDHET1, QDHEP1, QDHET2, QDHEP2, QDHEE1, QDHEE2, QDHEE3,
        & QKEVRN, QKEVWT, QVXNOM, QVYNOM, QVZNOM, QVXNSG, QVYNSG, QVZNSG,
        & QINLUM, QRINLN, QRINLU, QDBOFS, QEECWI(36), QVXBOM, QVYBOM,
        & QSILUM, QRSLLU, QRSLBK, QRSLEW , QVTXBP(3), QVTEBP(3), QVTSBP(3)
         COMMON /QCDE/  KFOVT, KLOVT, KNOVT, KFCHT, KLCHT, KNCHT, KFIST,
        & KLIST, KNIST, KFAST, KLAST, KNAST, KFEHT, KLEHT, KNEHT, KFV0T,
        & KLV0T, KNV0T, KFDCT, KLDCT, KNDCT, KFEFT, KLEFT, KNEFT, KFNET,
        & KLNET, KNNET, KFGAT, KLGAT, KNGAT, KFJET, KLJET, KNJET, KFMCT,
        & KLMCT, KNMCT, KFREV, KLREV, KNREV, KFMCV, KLMCV, KNMCV, KLUST,
        & KLUSV, KFFRT, KLFRT, KFFRV, KLFRV, KNRET, KNCOT, KFFRD,
        & KLFJET,KLLJET,KLNJET
         COMMON /QCDE/ KBIT(32), KCLACO(KCQFPA), KCLAFR(KCQFPA), KCLARM
        & (KCQFPA), KDEBUG, KEVT, KEXP, KFFILL, KFEOUT, KJOPTN(2,2),
        & KLEOUT, KLROUT, KLOCK0(KLOCKM,2), KLOCK1(KLOCKM,2), KLOCK2(
        & KLOCKM,2), KMATIX(6,6), KMQFPA, KNEFIL, KNEOUT, KNEVT, KNPAST,
        & KNQDET, KNQFPA, KNQLIN, KNQMTX, KNQPAR, KNQPST, KNREIN, KNREOU,
        & KOQDET, KOQFPA, KOQLIN, KOQMTL, KOQMTS, KOQPAR, KOQPBT, KOQPLI,
        & KOQTRA, KOQVEC, KOQVRT, KQPAR, KQVEC, KQVRT, KQWRK, KQZER, KRUN,
        & KSTATU, KTDROP, KUCARD, KUCONS, KUHIST, KUINPU, KUOUTP, KUPRNT,
        & KUPTER, KDEBU1, KDEBU2, KNWRLM, KEFOPT, KUEDIN, KUEDOU, KURTOX,
        & KUCAR2, KNHDRN, KNBHAB, KSBHAB, KRSLLQ, KRSLNB
         COMMON /QCDE/ INDATA
         COMMON /QCDE/ KRINNE, KRINNF, KRINDC, KRINDQ, KRINNZ, KRINNB,
        & KRINBM, KRINFR, KRINLR, KRINLF
         COMMON /QCDE/ KEVERT, KEVEDA, KEVETI, KEVEMI(4), KEVETY, KEVEES,
        & KDHEFP, KDHENP, KDHENM, KKEVNT, KKEVNV, KKEVID, KDHENX, KDHENV,
        & KDHENJ, KREVDS, KXTET1, KXTET2, KXTEL2, KXTCGC, KXTCLL, KXTCBN,
        & KXTCCL, KXTCHV, KXTCEN, KCLASW, KERBOM, KBPSTA
         DIMENSION KLOCUS(3,14)
         EQUIVALENCE (KLOCUS(1,1),KFOVT), (KFOVT,KFRET), (KLIST,KLRET),
        & (KFIST,KFCOT), (KLAST,KLCOT)
         COMMON /QCDE/ XCOPYJ, XFLIAC, XHISTO, XLREV(2), XLREV2(2), XMCEV,
        & XMINI, XSYNTX, XWREVT, XWRRUN, XFILMC, XFILCH, XFILV0, XFILCO,
        & XFILEF, XFILPC, XFILGA, XFILJE,
        & XPRHIS, XFILL, XVITC, XVTPC, XVECAL, XVLCAL, XVTPCD,
        & XVSATR, XVHCAL, XHVTRG, XSREC, XWMINI, XIOKLU, XIOKSI, XFRF2,
        & XNSEQ, XVDOK, XFRF0, XFMUID, XFILEM, XWNANO, XROKSI, XGETBP,
        & XJTHRU
         LOGICAL XCOPYJ, XFLIAC, XHISTO, XLREV, XLREV2, XMCEV, XMINI,
        & XSYNTX, XWREVT, XWRRUN, XFILMC, XFILCH, XFILV0, XFILCO, XFILEF,
        & XFILPC, XPRHIS, XFILL, XVITC, XVTPC, XVECAL, XVLCAL, XVTPCD,
        & XVSATR, XVHCAL, XHVTRG, XSREC, XWMINI, XIOKLU, XFRF2, XFILJE,
        & XNSEQ, XFILGA, XVDOK, XFRF0, XFMUID, XFILEM, XWNANO, XIOKSI,
        & XROKSI, XGETBP, XJTHRU
   
   -------------------- /NANCOM/ --- NanoDst steering -------------------
   Xnano   .true. if input is a nanodst (in nano or epio format, depending
                      XNANOR)
   
         LOGICAL XNANO
         COMMON /NANCOM/XNANO
   
   
    bcs
         INTEGER LMHLEN, LMHCOL, LMHROW
         PARAMETER (LMHLEN=2, LMHCOL=1, LMHROW=2)
         COMMON /BCS/   IW(1000)
         INTEGER IW
         REAL RW(1000)
         EQUIVALENCE (RW(1),IW(1))
   
   
   ------------------ /QCNAMI/ --- name indices -------------------------
         COMMON /QCNAMI/ NAAFID,NAAJOB,NAASEV,NABCNT,NABHIT,NABOMB,
        1 NABOME,NABOMP,NABOMR,NABPTR,NADCAL,NADCRL,NADECO,NADEID,NADENF,
        2 NADEVT,NADEWI,NADFMC,NADFOT,NADGAM,NADHCO,NADHEA,NADHRL,NADJET,
        3 NADMID,NADMJT,NADMUO,NADNEU,NADPOB,NADRES,NADTBP,NADTMC,NADTRA,
        4 NADVER,NADVMC,NAECRQ,NAECTE,NAEGID,NAEGPC,NAEIDT,NAEJET,NAERRF,
        5 NAETDI,NAETKC,NAEVEH,NAEWHE,NAFICL,NAFKIN,NAFPOI,NAFPOL,NAFRFT,
        6 NAFRID,NAFRTL,NAFSTR,NAFTCL,NAFTCM,NAFTOC,NAFTTM,NAFVCL,NAFVER,
        7 NAFZFR,NAHCCV,NAHCTE,NAHINF,NAHMAD,NAHPDI,NAHROA,NAHSDA,NAHTUB,
        8 NAIASL,NAIPJT,NAIRJT,NAITCO,NAITMA,NAIXTR,NAIZBD,NAJBER,NAJEST,
        9 NAJSUM,NAKEVH,NAKINE,NAKJOB,NAKLIN,NAKPOL,NAKRUN,NALIDT,NALOLE,
        A NALUPA,NAMCAD,NAMHIT,NAMTHR,NAMUDG,NAMUEX,NAOSTS,NAPART,NAPASL,
        B NAPCHY,NAPCOB,NAPCOI,NAPCPA,NAPCQA,NAPCRL,NAPECO,NAPEHY,NAPEID,
        C NAPEMH,NAPEPT,NAPEST,NAPEWI,NAPFER,NAPFHR,NAPFRF,NAPFRT,NAPHCO,
        D NAPHER,NAPHHY,NAPHMH,NAPHST,NAPIDI,NAPITM,NAPLID,NAPLPD,NAPLSD,
        E NAPMSK,NAPNEU,NAPPDS,NAPPOB,NAPPRL,NAPRTM,NAPSCO,NAPSPO,NAPSTR,
        F NAPT2X,NAPTBC,NAPTCO,NAPTEX,NAPTMA,NAPTML,NAPTNC,NAPTST,NAPVCO,
        G NAPYER,NAPYFR,NAPYNE,NAQDET,NAQFPA,NAQLIN,NAQMTL,NAQMTS,NAQPAR,
        H NAQPBT,NAQPLI,NAQTRA,NAQVEC,NAQVRT,NAQWRK,NAQZER,NAREVH,NARHAH,
        I NARTLO,NARTLS,NARUNH,NARUNR,NASFTR,NATEXS,NATGMA,NATMTL,NATPCO,
        J NAVCOM,NAVCPL,NAVDCO,NAVDHT,NAVDXY,NAVDZT,NAVERT,NAVFHL,NAVFLG,
        K NAVFPH,NAVHLS,NAVPLH,NAX1AD,NAX1SC,NAX1TI,NAX2DF,NAX3EC,NAX3EW,
        L NAX3HC,NAX3IT,NAX3L2,NAX3LU,NAX3TM,NAX3TO,NAX3TP,NAX3X3,NAXTBN,
        M NAXTBP,NAXTCN,NAXTEB,NAXTOP,NAXTRB,NAYV0V,NAZPFR,NAEFOL,NAMUID,
        N NAPGID,NAPGPC,NAPGAC,NAPMSC,NAPTHR,NANBIP,NAPDLT,NAPMLT,NAPLJT
   
   
   ------------------ /QQQQJJ/ --- HAC parameters for ALPHA banks -------
         PARAMETER (JQVEQX= 1,JQVEQY= 2,JQVEQZ= 3,JQVEQE= 4,JQVEQM= 5,
        & JQVEQP= 6,JQVECH= 7,JQVETN= 8,JQVESC= 9,JQVEKS=10,JQVECL=11,
        & JQVEPA=12,JQVEQD=13,JQVENP=14,JQVESP=15,JQVEOV=16,JQVEEV=17,
        & JQVEND=18,JQVEDL=19,JQVENO=20,JQVEOL=21,JQVENM=22,JQVEML=23,
        & JQVEBM=24,JQVELK=38,JQVEDB=39,JQVEZB=40,JQVESD=41,JQVESZ=42,
        & JQVECB=43,JQVEEM=44,JQVECF=54,JQVEEW=55,JQVEUS=56)
         PARAMETER ( JQVRVX=1,JQVRVY=2,JQVRVZ=3,JQVRVN=4,JQVRTY=5,
        1   JQVRIP=6,JQVRND=7,JQVRDL=8,JQVRAY=9,JQVRAF=10,JQVREM=11,
        2   JQVRCF=17,JQVRET=18)
         PARAMETER ( JQDEAF= 1,JQDEAL= 2,JQDENT= 3,JQDEAT= 4,JQDELT= 8,
        &  JQDEAE= 9,JQDEAH=10,JQDEAM=11,JQDECF=12,JQDEEC=13,JQDEHC=14,
        &  JQDEET=15,JQDEFI=16,JQDENF=17,JQDEFL=18,JQDENE=19,JQDEEL=20,
        &  JQDENH=21,JQDEHL=22,JQDELH=23,JQDEEF=24,JQDEPC=25,JQDEEG=26,
        &  JQDEMU=27,JQDEDX=28,JQDEPG=29,JQDEPD=30,JQDEPM=31)
         PARAMETER ( JQPAGN=1, JQPANA=2, JQPACO=5, JQPAMA=6, JQPACH=7,
        & JQPALT=8,JQPAWI=9,JQPAAN=10)
   
   
         EXTERNAL CQPART, CQTPN, XCEQAN, XLUMOK, XPEQAN, XPEQOR, XPEQU,
        & XVDEOK, LLUMOK, SLUMOK
         CHARACTER * 12 CQPART, CQTPN
         LOGICAL XCAL, XCEQAN, XCEQOR, XCEQU, XECAL, XEID, XFRF, XHCAL,
        & XHMA, XLOCK, XLOCKN, XMC, XLUMOK, XMCA, XPEO, XPHO, XPEQAN,
        & XPEQOR, XPEQU, XSAME, XSIG, XTEX, XPEC, XPEP, XPHC, XYV0,
        & XFRIQF, XEFO, XPCQ, XEGP, XMUI, XVDEOK, XPGP, LLUMOK, SLUMOK,
        & XPGAC, XLEPTG, XLEPTH
   
    alcons
    define universal constants
         REAL PI, TWOPI, PIBY2, PIBY3, PIBY4, PIBY6, PIBY8, PIBY12
         REAL RADEG, DEGRA
         REAL CLGHT, ALDEDX
         PARAMETER (PI=3.141592653589)
         PARAMETER (RADEG=180./PI, DEGRA=PI/180.)
         PARAMETER (TWOPI = 2.*PI , PIBY2 = PI/2., PIBY4 = PI/4.)
         PARAMETER (PIBY6 = PI/6. , PIBY8 = PI/8.)
         PARAMETER (PIBY12= PI/12., PIBY3 = PI/3.)
         PARAMETER (CLGHT = 29.9792458, ALDEDX = 0.000307)
   
         ALDEDX  = constant used in the computation of DEDX in GeV
         CLGHT   = speed of light in cm/nsec
   
   
   
    efoljj
         INTEGER JEFOPX,JEFOPY,JEFOPZ,JEFOEW,JEFOWE,JEFOTY,JEFOLE,JEFOLT,
        +          JEFOLH,JEFOLC,JEFOLJ,LEFOLA
         PARAMETER(JEFOPX=1,JEFOPY=2,JEFOPZ=3,JEFOEW=4,JEFOWE=5,JEFOTY=6,
        +          JEFOLE=7,JEFOLT=8,JEFOLH=9,JEFOLC=10,JEFOLJ=11,
        +          LEFOLA=11)
   
   
    egpcjj
         INTEGER JEGPPX,JEGPPY,JEGPPZ,JEGPR1,JEGPR2,JEGPF4,JEGPDM,JEGPST,
        +          JEGPQU,JEGPPE,LEGPCA
         PARAMETER(JEGPPX=1,JEGPPY=2,JEGPPZ=3,JEGPR1=4,JEGPR2=5,JEGPF4=6,
        +          JEGPDM=7,JEGPST=8,JEGPQU=9,JEGPPE=10,LEGPCA=10)
   
   
    eidtjj
         INTEGER JEIDIF,JEIDR1,JEIDR2,JEIDR3,JEIDR4,JEIDR5,JEIDR6,JEIDR7,
        +          JEIDEC,JEIDIP,JEIDE1,JEIDE2,JEIDE3,JEIDFR,JEIDPE,LEIDTA
         PARAMETER(JEIDIF=1,JEIDR1=2,JEIDR2=3,JEIDR3=4,JEIDR4=5,JEIDR5=6,
        +          JEIDR6=7,JEIDR7=8,JEIDEC=9,JEIDIP=10,JEIDE1=11,
        +          JEIDE2=12,JEIDE3=13,JEIDFR=14,JEIDPE=15,LEIDTA=15)
   
   
    frftjj
         INTEGER JFRFIR,JFRFTL,JFRFP0,JFRFD0,JFRFZ0,JFRFAL,JFRFEM,JFRFC2,
        +          JFRFDF,JFRFNO,LFRFTA
         PARAMETER(JFRFIR=1,JFRFTL=2,JFRFP0=3,JFRFD0=4,JFRFZ0=5,JFRFAL=6,
        +          JFRFEM=7,JFRFC2=28,JFRFDF=29,JFRFNO=30,LFRFTA=30)
   
   
    fridjj
         INTEGER JFRIBP,JFRIDZ,JFRIBC,JFRIDC,JFRIPE,JFRIPM,JFRIPI,JFRIPK,
        +          JFRIPP,JFRINK,JFRIQF,LFRIDA
         PARAMETER(JFRIBP=1,JFRIDZ=2,JFRIBC=3,JFRIDC=4,JFRIPE=5,JFRIPM=6,
        +          JFRIPI=7,JFRIPK=8,JFRIPP=9,JFRINK=10,JFRIQF=11,
        +          LFRIDA=11)
   
   
    frtljj
         INTEGER JFRTIV,JFRTNV,JFRTII,JFRTNI,JFRTNE,JFRTIT,JFRTNT,JFRTNR,
        +          LFRTLA
         PARAMETER(JFRTIV=1,JFRTNV=2,JFRTII=3,JFRTNI=4,JFRTNE=5,JFRTIT=6,
        +          JFRTNT=7,JFRTNR=8,LFRTLA=8)
   
   
    hmadjj
         INTEGER JHMANF,JHMANE,JHMANL,JHMAMH,JHMAIG,JHMAED,JHMACS,JHMAND,
        +          JHMAIE,JHMAIT,JHMAIF,JHMATN,LHMADA
         PARAMETER(JHMANF=1,JHMANE=2,JHMANL=3,JHMAMH=4,JHMAIG=5,JHMAED=6,
        +          JHMACS=7,JHMAND=8,JHMAIE=9,JHMAIT=10,JHMAIF=11,
        +          JHMATN=12,LHMADA=12)
   
   
    mcadjj
         INTEGER JMCANH,JMCADH,JMCADC,JMCAAM,JMCAAC,JMCATN,LMCADA
         PARAMETER(JMCANH=1,JMCADH=3,JMCADC=5,JMCAAM=7,JMCAAC=8,JMCATN=9,
        +          LMCADA=9)
   
   
    muidjj
         INTEGER JMUIIF,JMUISR,JMUIDM,JMUIST,JMUITN,LMUIDA
         PARAMETER(JMUIIF=1,JMUISR=2,JMUIDM=3,JMUIST=4,JMUITN=5,LMUIDA=5)
   
   
    pcqajj
         INTEGER JPCQNA,JPCQPX,JPCQPY,JPCQPZ,JPCQEN,LPCQAA
         PARAMETER(JPCQNA=1,JPCQPX=2,JPCQPY=3,JPCQPZ=4,JPCQEN=5,LPCQAA=5)
   
   
    pdltjj
         INTEGER JPDLPA,JPDLJT,JPDLPI,JPDLPE,JPDLVP,JPDLFR,LPDLTA
         PARAMETER(JPDLPA=1,JPDLJT=2,JPDLPI=3,JPDLPE=4,JPDLVP=5,JPDLFR=6,
        +          LPDLTA=6)
   
   
    pecojj
         INTEGER JPECER,JPECE1,JPECE2,JPECTH,JPECPH,JPECEC,JPECKD,JPECCC,
        +          JPECRB,JPECPC,LPECOA
         PARAMETER(JPECER=1,JPECE1=2,JPECE2=3,JPECTH=4,JPECPH=5,JPECEC=6,
        +          JPECKD=7,JPECCC=8,JPECRB=9,JPECPC=10,LPECOA=10)
   
   
    peptjj
         INTEGER JPEPT1,JPEPP1,JPEPT3,JPEPP3,LPEPTA
         PARAMETER(JPEPT1=1,JPEPP1=2,JPEPT3=3,JPEPP3=4,LPEPTA=4)
   
   
    pgacjj
         INTEGER JPGAEC,JPGATC,JPGAPC,JPGAR1,JPGAR2,JPGAF4,JPGADM,JPGAST,
        +          JPGAQU,JPGAQ1,JPGAQ2,JPGAM1,JPGAM2,JPGAMA,JPGAER,JPGATR,
        +          JPGAPR,JPGAEF,JPGAGC,JPGAZS,JPGAPL,JPGAPH,JPGAPN,JPGAFA,
        +          JPGAPE,LPGACA
         PARAMETER(JPGAEC=1,JPGATC=2,JPGAPC=3,JPGAR1=4,JPGAR2=5,JPGAF4=6,
        +          JPGADM=7,JPGAST=8,JPGAQU=9,JPGAQ1=10,JPGAQ2=11,
        +          JPGAM1=12,JPGAM2=13,JPGAMA=14,JPGAER=15,JPGATR=16,
        +          JPGAPR=17,JPGAEF=18,JPGAGC=19,JPGAZS=20,JPGAPL=21,
        +          JPGAPH=22,JPGAPN=23,JPGAFA=24,JPGAPE=25,LPGACA=25)
   
   
    pgpcjj
         INTEGER JPGPEC,JPGPTC,JPGPPC,JPGPR1,JPGPR2,JPGPF4,JPGPDM,JPGPST,
        +          JPGPQU,JPGPQ1,JPGPQ2,JPGPM1,JPGPM2,JPGPMA,JPGPER,JPGPTR,
        +          JPGPPR,JPGPPE,LPGPCA
         PARAMETER(JPGPEC=1,JPGPTC=2,JPGPPC=3,JPGPR1=4,JPGPR2=5,JPGPF4=6,
        +          JPGPDM=7,JPGPST=8,JPGPQU=9,JPGPQ1=10,JPGPQ2=11,
        +          JPGPM1=12,JPGPM2=13,JPGPMA=14,JPGPER=15,JPGPTR=16,
        +          JPGPPR=17,JPGPPE=18,LPGPCA=18)
   
   
    phcojj
         INTEGER JPHCER,JPHCTH,JPHCPH,JPHCEC,JPHCKD,JPHCCC,JPHCRB,JPHCNF,
        +          JPHCPC,LPHCOA
         PARAMETER(JPHCER=1,JPHCTH=2,JPHCPH=3,JPHCEC=4,JPHCKD=5,JPHCCC=6,
        +          JPHCRB=7,JPHCNF=8,JPHCPC=9,LPHCOA=9)
   
   
    pmltjj
         INTEGER JPMLFL,JPMLPO,JPMLCH,JPMLSP,JPMLLE,JPMLME,JPMLKT,JPMLFR,
        +          LPMLTA
         PARAMETER(JPMLFL=1,JPMLPO=2,JPMLCH=3,JPMLSP=4,JPMLLE=5,JPMLME=6,
        +          JPMLKT=7,JPMLFR=8,LPMLTA=8)
   
   
    texsjj
         INTEGER JTEXSI,JTEXTM,JTEXTL,JTEXNS,JTEXAD,JTEXTN,JTEXSF,LTEXSA
         PARAMETER(JTEXSI=1,JTEXTM=2,JTEXTL=3,JTEXNS=4,JTEXAD=5,JTEXTN=6,
        +          JTEXSF=7,LTEXSA=7)
   
   
    yv0vjj
         INTEGER JYV0K1,JYV0K2,JYV0VX,JYV0VY,JYV0VZ,JYV0VM,JYV0PX,JYV0PY,
        +          JYV0PZ,JYV0PM,JYV0X1,JYV0X2,JYV0XM,JYV0C2,JYV0IC,JYV0P1,
        +          JYV0P2,JYV0EP,JYV0DM,JYV0S1,JYV0S2,LYV0VA
         PARAMETER(JYV0K1=1,JYV0K2=2,JYV0VX=3,JYV0VY=4,JYV0VZ=5,JYV0VM=6,
        +          JYV0PX=12,JYV0PY=13,JYV0PZ=14,JYV0PM=15,JYV0X1=21,
        +          JYV0X2=22,JYV0XM=23,JYV0C2=26,JYV0IC=27,JYV0P1=28,
        +          JYV0P2=31,JYV0EP=34,JYV0DM=55,JYV0S1=56,JYV0S2=57,
        +          LYV0VA=57)
   
   
         PARAMETER (IDPK = 2**16)
         PARAMETER (JETDTL = 1)
         parameter(mx=500)
         dimension mxcol(228)
         dimension epad(mx,36)
         save epad,lrun,levt
         logical first
         data first/.true./
   
    bmacro
       set of intrinsic functions to handle BOS banks
   - # of words/row in bank with index ID
         LCOLS(ID) = IW(ID+1)
   - # of rows in bank with index ID
         LROWS(ID) = IW(ID+2)
   - index of next row in the bank with index ID
         KNEXT(ID) = ID + LMHLEN + IW(ID+1)*IW(ID+2)
   - index of row # NRBOS in the bank with index ID
         KROW(ID,NRBOS) = ID + LMHLEN + IW(ID+1)*(NRBOS-1)
   - # of free words in the bank with index ID
         LFRWRD(ID) = ID + IW(ID) - KNEXT(ID)
   - # of free rows in the bank with index ID
         LFRROW(ID) = LFRWRD(ID) / LCOLS(ID)
   - Lth integer element of the NRBOSth row of the bank with index ID
         ITABL(ID,NRBOS,L) = IW(ID+LMHLEN+(NRBOS-1)*IW(ID+1)+L)
   - Lth real element of the NRBOSth row of the bank with index ID
         RTABL(ID,NRBOS,L) = RW(ID+LMHLEN+(NRBOS-1)*IW(ID+1)+L)
   
         epad_e14=0.
    the limits of the module indices
         if (first) then
          first=.false.
          do i=1,228
           CALL ECRWRG(I,IRSS,MXCOL(i))
          enddo
          LEVT=0
          LRUN=0
         endif
    a new event decode the storey info
         IF (KRUN.NE.LRUN.OR.KEVT.NE.LEVT) THEN
          LEVT=KEVT
          LRUN=KRUN
          call vzero(epad(1,1),mx*36)
    to the storey banks
          KETDI = IW(NAMIND('ETDI'))
          KPEST = IW(NAMIND('PEST'))
          if (Kpest.le.0.or.ketdi.le.0) go to 999
    over the storeys and sum the energy in each peco in each module
          CUTENER = 0.01           ! gampex value is 0.01
          npest=lrows(kpest)
          do ipest=1,npest
           ipc = itabl(kpest,ipest,5)
           if (ipc .gt. 0 ) then
            if (ipc .gt. mx ) go to 999
            epc = rtabl(kpest,ipest,2)
            ITO = ITABL(KPEST,IPEST,4)
            IF (ITO.gt.0) then
             K = ITABL(KPEST,IPEST,1)
             IWIN = ITABL(KETDI,ITO,JETDTL)
             I = IWIN / IDPK
             J = (IWIN - I * IDPK) / 4
             IF ( I.ge.1.and.I.le.228) then
              IF ( J.ge.1.and.J.le.mxcol(i)) then
               ENSTO = FLOAT (ITABL(KETDI,Ito,JETDTL+K)) / 1000000.
               ENSTO = ENSTO * ECETDI(I,J)
               IF (ENSTO.gt.CUTENER) then
                call emdtow(i,j,ksbd,kmodu,krg)
                module=kmodu+12*(ksbd-1)
                if (ipc .le. mx ) epad(ipc,module)=epad(ipc,module)+ensto
               endif
              endif
             endif
            endif
           endif
          enddo
         ENDIF
         if (ipeco.le.mx) epad_e14=epad(ipeco,imodule)
    999  return
         end
 
3 IEFMC
         INTEGER FUNCTION IEFMC(ITK)
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   
    array of previous inputs to see if we already know this object.
   Author: Paul Bright-Thomas
      03/03/97 PBT Created.
   
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   KEFMC                                                                           
   KNEFMC                                                                          
   QSEFMC                                                                          
   QSTRU                                                                           
        |---- IEFMC                                                                
                   |----  SIGN                                External             
                   |----  SQRT                                External             
                   |----  ABS                                 External             
                   |----  NINT                                External             
                   |----  KMATIX                              External             
                   |----  ATG                                 External             
                   |----  KCLARM                              External             
                   |----  IAND                                External             
                   |----  KLOCK0                              External             
                   |----  IABS                                External             
                   |----  MIN                                 External             
                   |----  ITEFIN                              External             
   
 
3 IMCEF
         INTEGER FUNCTION IMCEF(ITK)
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   
    array of previous inputs to see if we already know this object.
   Author: Paul Bright-Thomas
      03/03/97 PBT Created.
   
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   KMCEF                                                                           
   KNMCEF                                                                          
   QSMCEF                                                                          
   QSTRU                                                                           
        |---- IMCEF                                                                
                   |----  SIGN                                External             
                   |----  SQRT                                External             
                   |----  ABS                                 External             
                   |----  NINT                                External             
                   |----  KMATIX                              External             
                   |----  ATG                                 External             
                   |----  KCLARM                              External             
                   |----  IAND                                External             
                   |----  KLOCK0                              External             
                   |----  IABS                                External             
                   |----  MIN                                 External             
                   |----  ITMCIN                              External             
   
 
3 JULMATCH
         SUBROUTINE JULMATCH(IALTRK,IMCTRK,IFLAG)
  ------------------------------------------------------------------------------
    CKEY MATCHING / USER
  ------------------------------------------------------------------------------
   Match a reconstructed track with mc truth, and classify the track.
    Author Dave Brown, 29-6-94
    Modified  02-9-94  P. Rensing
    Good tracks are classified according to the origin of the true track
    Input argument :
       IALTRK =  Input ALPHA track number
    Output arguments :
       IMCTRK =  Associated ALPHA MC true track if there's a reasonable match
              =  0  if not
        IFLAG = -3     Hits not related to MC true hits
                -2     Hits mixed from several particles (not decays)
                -1     Spiral branch or calorimetric reflection
                 0     Double counted particles (2 tracks for 1 particle)
                 1      True track comes from true primary
                 2      True track comes from HF decay
                 3      True track comes from neutral decay
                 4      True track comes from charged decay (split kink)
                 5      Kink fit as a single track
                 6      True track comes from material interaction
                 7      Unknown
    Note: IMCTRK is returned zero for IFLAG <= -2
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   MCMATCH                                                                         
        |---- JULMATCH                                                             
                   |----  SIGN                                External             
                   |----  SQRT                                External             
                   |----  ABS                                 External             
                   |----  NINT                                External             
                   |----  KMATIX                              External             
                   |----  ATG                                 External             
                   |----  KCLARM                              External             
                   |----  IAND                                External             
                   |----  KLOCK0                              External             
                   |----  IABS                                External             
                   |----  KVNEW                                                    
                   |----  NAMIND                              External             
                   |----  SORTZV                              External             
                   |----  MIN                                 External             
                   |----  FLOAT                               External             
                   |----  PMOVE                                                    
                   |----  COS                                 External             
                   |----  SIN                                 External             
                   |----  QVZERO                                                   
                   |----  QVADDN                                                   
   
 
3 KBESTM
         INTEGER FUNCTION KBESTM(ITK)
  ------------------------------------------------------------------------------
    CKEY MONTE /INTERNAL
  ------------------------------------------------------------------------------
   Find best match between fitted and mc track
    R. Johnson   10-5-90
    Input:  ITK             /I   ALPHA charged track number, MC or DATA
    Output: KBESTM          /I   Best match to MC or data track
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   MINTRA                                                                          
   NADDXM                                                                          
   NMTAIL                                                                          
   QDEDXM                                                                          
   QMTAIL                                                                          
   QMUIDO                                                                          
   QVTRUH                                                                          
        |---- KBESTM                                                               
                   |----  SIGN                                External             
                   |----  SQRT                                External             
                   |----  ABS                                 External             
                   |----  NINT                                External             
                   |----  KMATIX                              External             
                   |----  ATG                                 External             
                   |----  KCLARM                              External             
                   |----  IAND                                External             
                   |----  KLOCK0                              External             
                   |----  IABS                                External             
   
 
3 KEFMC
         INTEGER FUNCTION KEFMC(ITK,I)
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   
    Ith alpha EF objects matching input MC track or vice versa.
   Author: Paul Bright-Thomas
      03/03/97 PBT Created.
   
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   KTRU                                                                            
        |---- KEFMC                                                                
                   |----  SIGN                                External             
                   |----  SQRT                                External             
                   |----  ABS                                 External             
                   |----  NINT                                External             
                   |----  KMATIX                              External             
                   |----  ATG                                 External             
                   |----  KCLARM                              External             
                   |----  IAND                                External             
                   |----  KLOCK0                              External             
                   |----  IABS                                External             
                   |----  IEFMC                                                    
                   |----  KNEFMC                                                   
                   |----  ITEFMC                              External             
   
 
3 KIDSAV
         FUNCTION KIDSAV (ITK,CNAM)
  ------------------------------------------------------------------------------
    CKEY PART /USER
  ------------------------------------------------------------------------------
   Save particle with name cnam and set the mass
                                                     H.ALBRECHT 19.10.89
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
              KIDSAV                                                               
                   |----  QSBANK                                                   
                   |----  KPART                                                    
                   |----  QWMESE                                                   
                   |----  SQRT                                External             
                   |----  KFPADR                                                   
                   |----  QAMOTH                                                   
   
 
3 KMCEF
         INTEGER FUNCTION KMCEF(ITK,I)
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   
    Ith alpha EF objects matching input MC track or vice versa.
   Author: Paul Bright-Thomas
      03/03/97 PBT Created.
   
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   KTRU                                                                            
        |---- KMCEF                                                                
                   |----  SIGN                                External             
                   |----  SQRT                                External             
                   |----  ABS                                 External             
                   |----  NINT                                External             
                   |----  KMATIX                              External             
                   |----  ATG                                 External             
                   |----  KCLARM                              External             
                   |----  IAND                                External             
                   |----  KLOCK0                              External             
                   |----  IABS                                External             
                   |----  IMCEF                                                    
                   |----  KNMCEF                                                   
                   |----  ITMCEF                              External             
   
 
3 KMLEPT
         SUBROUTINE KMLEPT(IMC,ISRC,JFLV)
  ------------------------------------------------------------------------------
    CKEY MUON /INTERNAL
  ------------------------------------------------------------------------------
   Find true mc source of a detected lepton
       Author    - G.Taylor              15-MAY-1992
       IMC       /I      Associated MC track
      ISRC      /I      MC source type
                              0= none of the below
                              1= misidentified hadron
                              2= photon conversion
                              3= pi0 or eta dalitz decay
                              4= K decay
                              5= pi decay
                              6= b decay
                              7= secondary c decay
                              8= primary c decay
                              9= tau decay
                             10= vector meson decay
                             11= muon decay
                             12= sigma barion decay
            JFLV      /I      Flavor of mother quark
                                 1= u  2=d  3=s  4=c  5=b  6=t
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   QMUIDO                                                                          
        |---- KMLEPT                                                               
                   |----  SIGN                                External             
                   |----  SQRT                                External             
                   |----  ABS                                 External             
                   |----  NINT                                External             
                   |----  KMATIX                              External             
                   |----  ATG                                 External             
                   |----  KCLARM                              External             
                   |----  IAND                                External             
                   |----  KLOCK0                              External             
                   |----  IABS                                External             
                   |----  XPEQOR                                                   
                   |----  IF                                  External             
                   |----  CQTPN                                                    
                   |----  QWSEC                                                    
   
 
3 KNCHMC
         INTEGER FUNCTION KNCHMC(ITK)
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   
    number of MC tracks that go with a charged EF object
    standard ALPHA routines, KNMTCH,KMTCH,KSMTCH
   Author: Paul Bright-Thomas
      03/03/97 PBT Created.
           06/03/97 PBT Faster for ITCH, take straight from ITEFFR and FKCHT
   
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   KNEFMC                                                                          
        |---- KNCHMC                                                               
                   |----  SIGN                                External             
                   |----  SQRT                                External             
                   |----  ABS                                 External             
                   |----  NINT                                External             
                   |----  KMATIX                              External             
                   |----  ATG                                 External             
                   |----  KCLARM                              External             
                   |----  IAND                                External             
                   |----  KLOCK0                              External             
                   |----  IABS                                External             
                   |----  QWMESE                                                   
                   |----  MIN                                 External             
                   |----  NEFMC                               External             
                   |----  ITEFMC                              External             
                   |----  FLOAT                               External             
   
 
3 KNECMC
         INTEGER FUNCTION KNECMC(ITK)
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   
    MC track alpha with matched PECO part belonging to input EFLW objects
    matching is circuitous -- using PEMH bank, FKIN number of MC input, and
    parts of EFLW objects
   Author: Paul Bright-Thomas
      03/03/97 PBT Created.
           04/03/97 PBT Note that LCAL clusters are also in PECO/PEMH
           05/03/97 PBT New level of indirection, via PECO links to PCOB object
             For KEFOTY(I)>4, only KEFOLC is filled, with PCOB object
             Then necessary to search all PECO rows for link to this PCOB,
             and keep this PECO object as a match to input EFLW object.
             Can then search PEMH for FKIN match.
             Allow for (remote) possibility of PECO and PCOB link to same EFLW
           06/03/97 PBT Faster for ITMC, use KFMCT and ITFK
   
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   KNEFMC                                                                          
        |---- KNECMC                                                               
                   |----  SIGN                                External             
                   |----  SQRT                                External             
                   |----  ABS                                 External             
                   |----  NINT                                External             
                   |----  KMATIX                              External             
                   |----  ATG                                 External             
                   |----  KCLARM                              External             
                   |----  IAND                                External             
                   |----  KLOCK0                              External             
                   |----  IABS                                External             
                   |----  NAMIND                              External             
                   |----  MIN                                 External             
                   |----  NEFMC                               External             
                   |----  ITEFMC                              External             
                   |----  QWMESE                                                   
                   |----  FLOAT                               External             
                   |----  FORMAT                              External             
   
 
3 KNEFMC
         INTEGER FUNCTION KNEFMC(ITK)
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   
    number of alpha EF objects matching input MC track or vice versa.
   Author: Paul Bright-Thomas
    results from counting are kept for quick access when the matches are
   
      03/03/97 PBT Created.
   
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   KEFMC                                                                           
   KNTRU                                                                           
   QSEFMC                                                                          
        |---- KNEFMC                                                               
                   |----  SIGN                                External             
                   |----  SQRT                                External             
                   |----  ABS                                 External             
                   |----  NINT                                External             
                   |----  KMATIX                              External             
                   |----  ATG                                 External             
                   |----  KCLARM                              External             
                   |----  IAND                                External             
                   |----  KLOCK0                              External             
                   |----  IABS                                External             
                   |----  IEFMC                                                    
                   |----  NEFMC                               External             
                   |----  QWMESE                                                   
                   |----  KNCHMC                                                   
                   |----  KNECMC                                                   
                   |----  KNHCMC                                                   
                   |----  KNSIMC                                                   
   
 
3 KNHCMC
         INTEGER FUNCTION KNHCMC(ITK)
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   
    MC track alpha with matched PHCO part belonging to input EFLW objects
    matching is circuitous -- using PHMH bank, FKIN number of MC input, and
    parts of EFLW objects
   Author: Paul Bright-Thomas
      03/03/97 PBT Created.
           04/03/97 PBT Note that LCAL clusters are also in PHCO/PHMH
           05/03/97 PBT New level of indirection, via PHCO links to PCOB object
             For KEFOTY(I)>4, only KEFOLC is filled, with PCOB object
             Then necessary to search all PHCO rows for link to this PCOB,
             and keep this PHCO object as a match to input EFLW object.
             Can then search PHMH for FKIN match.
             Allow for (remote) possibility of PHCO and PCOB link to same EFLW
           05/03/97 PBT While PHMH bank missing, resort to angular matches.
           06/03/97 PBT Angular matches indicated by -1.< SHCMC < 0.
           06/03/97 PBT Faster for ITMC, use KFMCT and ITFK
   
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   KNEFMC                                                                          
        |---- KNHCMC                                                               
                   |----  SIGN                                External             
                   |----  SQRT                                External             
                   |----  ABS                                 External             
                   |----  NINT                                External             
                   |----  KMATIX                              External             
                   |----  ATG                                 External             
                   |----  KCLARM                              External             
                   |----  IAND                                External             
                   |----  KLOCK0                              External             
                   |----  IABS                                External             
                   |----  NAMIND                              External             
                   |----  MIN                                 External             
                   |----  NEFMC                               External             
                   |----  ITEFMC                              External             
                   |----  QWMESE                                                   
                   |----  FORMAT                              External             
                   |----  CHAINT                              External             
                   |----  XPEQOR                                                   
                   |----  ACOS                                External             
   
 
3 KNMCCH
         INTEGER FUNCTION KNMCCH(ITK)
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   
    number of charged EF objects that go with input MC track.
    standard ALPHA routines, KNMTCH,KMTCH,KSMTCH
   Author: Paul Bright-Thomas
      03/03/97 PBT Created.
           06/03/97 PBT Tidied, to match KNCHMC.
   
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   KNMCEF                                                                          
        |---- KNMCCH                                                               
                   |----  SIGN                                External             
                   |----  SQRT                                External             
                   |----  ABS                                 External             
                   |----  NINT                                External             
                   |----  KMATIX                              External             
                   |----  ATG                                 External             
                   |----  KCLARM                              External             
                   |----  IAND                                External             
                   |----  KLOCK0                              External             
                   |----  IABS                                External             
                   |----  QWMESE                                                   
                   |----  KPDIR                                                    
                   |----  MIN                                 External             
                   |----  NMCEF                               External             
                   |----  ITMCEF                              External             
                   |----  FLOAT                               External             
   
 
3 KNMCEC
         INTEGER FUNCTION KNMCEC(ITK)
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   
    the alpha EFLW objects with PECO part matching input MC track.
    matching is circuitous -- using PEMH bank, FKIN number of MC input, and
    parts of EFLW objects
   Author: Paul Bright-Thomas
      03/03/97 PBT Created.
           04/03/97 PBT Note that LCAL clusters are also in PECO/PEMH
           05/03/97 PBT Yet to be updated for PCOB objects (KEFOLC)
   
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   KNMCEF                                                                          
        |---- KNMCEC                                                               
                   |----  SIGN                                External             
                   |----  SQRT                                External             
                   |----  ABS                                 External             
                   |----  NINT                                External             
                   |----  KMATIX                              External             
                   |----  ATG                                 External             
                   |----  KCLARM                              External             
                   |----  IAND                                External             
                   |----  KLOCK0                              External             
                   |----  IABS                                External             
                   |----  NAMIND                              External             
                   |----  KPDIR                                                    
                   |----  MIN                                 External             
                   |----  NMCEF                               External             
                   |----  ITMCEF                              External             
                   |----  QWMESE                                                   
                   |----  FLOAT                               External             
   
 
3 KNMCEF
         INTEGER FUNCTION KNMCEF(ITK)
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   
    number of alpha EF objects matching input MC track or vice versa.
   Author: Paul Bright-Thomas
    results from counting are kept for quick access when the matches are
   
      03/03/97 PBT Created.
   
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   KMCEF                                                                           
   KNTRU                                                                           
   QSMCEF                                                                          
        |---- KNMCEF                                                               
                   |----  SIGN                                External             
                   |----  SQRT                                External             
                   |----  ABS                                 External             
                   |----  NINT                                External             
                   |----  KMATIX                              External             
                   |----  ATG                                 External             
                   |----  KCLARM                              External             
                   |----  IAND                                External             
                   |----  KLOCK0                              External             
                   |----  IABS                                External             
                   |----  IMCEF                                                    
                   |----  NMCEF                               External             
                   |----  QWMESE                                                   
                   |----  KNMCCH                                                   
                   |----  KNMCEC                                                   
                   |----  KNMCHC                                                   
                   |----  KNMCSI                                                   
   
 
3 KNMCHC
         INTEGER FUNCTION KNMCHC(ITK)
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   
    the alpha EFLW objects with PHCO part matching input MC track.
    matching is circuitous -- using PHMH bank, FKIN number of MC input, and
    parts of EFLW objects
   Author: Paul Bright-Thomas
      03/03/97 PBT Created.
           04/03/97 PBT Absence of PHMH in most MC means a dirty angle fix.
           05/03/97 PBT Yet to be updated for PCOB objects (KEFOLC)
   
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   KNMCEF                                                                          
        |---- KNMCHC                                                               
                   |----  SIGN                                External             
                   |----  SQRT                                External             
                   |----  ABS                                 External             
                   |----  NINT                                External             
                   |----  KMATIX                              External             
                   |----  ATG                                 External             
                   |----  KCLARM                              External             
                   |----  IAND                                External             
                   |----  KLOCK0                              External             
                   |----  IABS                                External             
                   |----  NAMIND                              External             
                   |----  KPDIR                                                    
                   |----  MIN                                 External             
                   |----  NMCEF                               External             
                   |----  ITMCEF                              External             
                   |----  QWMESE                                                   
                   |----  FLOAT                               External             
                   |----  CHAINT                              External             
                   |----  XPEQOR                                                   
                   |----  ACOS                                External             
   
 
3 KNMCSI
         INTEGER FUNCTION KNMCSI(ITK)
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   
    number of SICAL EF objects that go with input MC track.
   Author: Paul Bright-Thomas
      03/03/97 PBT Created.
           04/03/97 PBT Required to only deal with SICAL clusters
           07/03/97 PBT Crude angular matching used, no real match info exists
   
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   KNMCEF                                                                          
        |---- KNMCSI                                                               
                   |----  SIGN                                External             
                   |----  SQRT                                External             
                   |----  ABS                                 External             
                   |----  NINT                                External             
                   |----  KMATIX                              External             
                   |----  ATG                                 External             
                   |----  KCLARM                              External             
                   |----  IAND                                External             
                   |----  KLOCK0                              External             
                   |----  IABS                                External             
                   |----  NAMIND                              External             
                   |----  CHAINT                              External             
                   |----  MIN                                 External             
                   |----  NMCEF                               External             
                   |----  ITMCEF                              External             
                   |----  ACOS                                External             
                   |----  NEFMC                               External             
   
 
3 KNSIMC
         INTEGER FUNCTION KNSIMC(ITK)
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   
    number of MC track going with input SICAL EFLW object
   Author: Paul Bright-Thomas
      03/03/97 PBT Created.
           04/03/97 PBT Required to only deal with SICAL clusters
           05/03/97 PBT SICAL clusters appear in PHCO, but not PEMH
             Crude angular matching used, since no real match info exists
   
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   KNEFMC                                                                          
        |---- KNSIMC                                                               
                   |----  SIGN                                External             
                   |----  SQRT                                External             
                   |----  ABS                                 External             
                   |----  NINT                                External             
                   |----  KMATIX                              External             
                   |----  ATG                                 External             
                   |----  KCLARM                              External             
                   |----  IAND                                External             
                   |----  KLOCK0                              External             
                   |----  IABS                                External             
                   |----  NAMIND                              External             
                   |----  CHAINT                              External             
                   |----  MIN                                 External             
                   |----  NEFMC                               External             
                   |----  ITEFMC                              External             
                   |----  ACOS                                External             
   
 
3 KNTRU
         INTEGER FUNCTION KNTRU(ITK)
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   
    number of alpha EF objects matching input MC track or vice versa.
   Author: Paul Bright-Thomas
      03/03/97 PBT Created.
   
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
              KNTRU                                                                
                   |----  SIGN                                External             
                   |----  SQRT                                External             
                   |----  ABS                                 External             
                   |----  NINT                                External             
                   |----  KMATIX                              External             
                   |----  ATG                                 External             
                   |----  KCLARM                              External             
                   |----  IAND                                External             
                   |----  KLOCK0                              External             
                   |----  IABS                                External             
                   |----  QTRUZ                                                    
                   |----  KNEFMC                                                   
                   |----  KNMCEF                                                   
   
 
3 KTRU
         INTEGER FUNCTION KTRU(ITK,I)
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   
    Ith alpha EF object matching input MC track or vice versa.
   Author: Paul Bright-Thomas
      03/03/97 PBT Created.
   
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
              KTRU                                                                 
                   |----  SIGN                                External             
                   |----  SQRT                                External             
                   |----  ABS                                 External             
                   |----  NINT                                External             
                   |----  KMATIX                              External             
                   |----  ATG                                 External             
                   |----  KCLARM                              External             
                   |----  IAND                                External             
                   |----  KLOCK0                              External             
                   |----  IABS                                External             
                   |----  KEFMC                                                    
                   |----  KMCEF                                                    
   
 
3 KVFITA
         FUNCTION KVFITA (ITK,CNAM,IANTI,IER)
  ------------------------------------------------------------------------------
    CKEY PART /USER
  ------------------------------------------------------------------------------
   Fit mass and save particle with name cnam
                                                      H.Albrecht 9.11.89
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
              KVFITA                                                               
                   |----  KPART                                                    
                   |----  QWMESE                                                   
                   |----  ABS                                 External             
                   |----  QSBANK                                                   
                   |----  SQRT                                External             
                   |----  QMCHI2                                                   
                   |----  KFPADR                                                   
                   |----  QAMOTH                                                   
   
 
3 KVFITC
         INTEGER FUNCTION KVFITC(NTKD,ITKD,RMAS,DRM,CNAM)
  ------------------------------------------------------------------------------
    CKEY YTOP VERTEX   /USER
  ------------------------------------------------------------------------------
   Fit ntkd tracks in itkd(i) to a common vertex with mass constr.
   
      Author   :- E. Blucher, H.G.Moser         22-Jan-1993
   
      Inputs:
           - Number of tracks to be fit to a vertex
           - Array of track numbers
           - mass constraint
           - error on mass**2 (= 2 * m * sigma(m) !)
   
      Outputs:
           - track number of incoming track created by routine
           - new vertex in QVRT is created.
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
              KVFITC                                                               
                   |----  SIGN                                External             
                   |----  SQRT                                External             
                   |----  ABS                                 External             
                   |----  NINT                                External             
                   |----  KMATIX                              External             
                   |----  ATG                                 External             
                   |----  KCLARM                              External             
                   |----  IAND                                External             
                   |----  KLOCK0                              External             
                   |----  IABS                                External             
                   |----  QWMESS                                                   
                   |----  QMTERM                                                   
                   |----  QYFITC                                                   
                   |----  QSBANK                                                   
                   |----  FLOAT                               External             
                   |----  KPART                                                    
                   |----  KFPADR                                                   
                   |----  QADAU                                                    
   
 
3 KVFITM
         FUNCTION KVFITM (ITK,CNAM,IER)
  ------------------------------------------------------------------------------
    CKEY PART /USER
  ------------------------------------------------------------------------------
   Fit mass and save particle with name cnam
                                                      H.Albrecht 9.11.89
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
              KVFITM                                                               
                   |----  KPART                                                    
                   |----  QWMESE                                                   
                   |----  ABS                                 External             
                   |----  QSBANK                                                   
                   |----  SQRT                                External             
                   |----  QMCHI2                                                   
                   |----  KFPADR                                                   
                   |----  QAMOTH                                                   
   
 
3 KVFITN
         INTEGER FUNCTION KVFITN(NTKD,ITKD,CNAM)
  ------------------------------------------------------------------------------
    CKEY YTOP VERTEX   /USER
  ------------------------------------------------------------------------------
   Fit ntkd tracks in itkd(i) to a common vertex.
   
      Author   :- E. Blucher, H.G.Moser         26-AUG-1992
   
      Inputs:
           - Number of tracks to be fit to a vertex
           - Array of track numbers
   
      Outputs:
           - track number of incoming track created by routine
           - new vertex in QVRT is created.
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   QBMTAG                                                                          
        |---- KVFITN                                                               
                   |----  SIGN                                External             
                   |----  SQRT                                External             
                   |----  ABS                                 External             
                   |----  NINT                                External             
                   |----  KMATIX                              External             
                   |----  ATG                                 External             
                   |----  KCLARM                              External             
                   |----  IAND                                External             
                   |----  KLOCK0                              External             
                   |----  IABS                                External             
                   |----  QWMESS                                                   
                   |----  QMTERM                                                   
                   |----  QYFIT                                                    
                   |----  QSBANK                                                   
                   |----  FLOAT                               External             
                   |----  KPART                                                    
                   |----  KFPADR                                                   
                   |----  QADAU                                                    
   
 
3 KVFITV
         INTEGER FUNCTION KVFITV(IVTX,NTKD,ITKD,CNAM)
  ------------------------------------------------------------------------------
    CKEY YTOP VERTEX   /USER
  ------------------------------------------------------------------------------
   Fit ntkd tracks itkd(i) to a common vertex using vertex ivtx as
     - additional constraint.
   
      Author   :- E. Blucher, H.G.Moser         26-AUG-1992
   
      Inputs:
           - Vertex number
           - Number of tracks to be fit to a vertex
           - Array of track numbers
   
      Outputs:
           - track number of incoming track created by routine
           - new vertex in QVRT is created.
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
              KVFITV                                                               
                   |----  SIGN                                External             
                   |----  SQRT                                External             
                   |----  ABS                                 External             
                   |----  NINT                                External             
                   |----  KMATIX                              External             
                   |----  ATG                                 External             
                   |----  KCLARM                              External             
                   |----  IAND                                External             
                   |----  KLOCK0                              External             
                   |----  IABS                                External             
                   |----  QWMESS                                                   
                   |----  QMTERM                                                   
                   |----  QYFITV                                                   
                   |----  QSBANK                                                   
                   |----  FLOAT                               External             
                   |----  KPART                                                    
                   |----  KFPADR                                                   
                   |----  QADAU                                                    
   
 
3 KVFTMC
         INTEGER FUNCTION KVFTMC(NTKD,ITKD,CNAM,USE,CONMAS)
  ------------------------------------------------------------------------------
    CKEY YTOP VERTEX   /USER
  ------------------------------------------------------------------------------
   Fit ntkd tracks in itkd(i) to a common vertex using a lagrange
       multipier mass constraint between a subset of the tracks.
   
      Author   :- G. Taylor         3-DEC-1993
   
      Inputs:
     NTKD      - Number of tracks to be fit to a vertex
     ITKD      - Array of track numbers
     CNAM      - alpha name of created track
     USE       - logical array of size NTKD which determines
                 whether this track is used in mass constraint
     CONMAS    - mass to which tracks are constrained
   
      Outputs:
           - track number of incoming track created by routine
           - new vertex in QVRT is created.
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
              KVFTMC                                                               
                   |----  SIGN                                External             
                   |----  SQRT                                External             
                   |----  ABS                                 External             
                   |----  NINT                                External             
                   |----  KMATIX                              External             
                   |----  ATG                                 External             
                   |----  KCLARM                              External             
                   |----  IAND                                External             
                   |----  KLOCK0                              External             
                   |----  IABS                                External             
                   |----  QWMESS                                                   
                   |----  QMTERM                                                   
                   |----  QYFTMC                                                   
                   |----  QSBANK                                                   
                   |----  FLOAT                               External             
                   |----  KPART                                                    
                   |----  KFPADR                                                   
                   |----  QADAU                                                    
   
 
3 LCRAE14
   
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
         integer function lcra_e14()
    pulse height seen in the LCAL crack scintillators
   Author G. Taylor Oct 1997
   
    bcs
         INTEGER LMHLEN, LMHCOL, LMHROW
         PARAMETER (LMHLEN=2, LMHCOL=1, LMHROW=2)
         COMMON /BCS/   IW(1000)
         INTEGER IW
         REAL RW(1000)
         EQUIVALENCE (RW(1),IW(1))
   
   
    bmacro
   Set of intrinsic functions to handle bos banks
   - # of words/row in bank with index ID
         LCOLS(ID) = IW(ID+1)
   - # of rows in bank with index ID
         LROWS(ID) = IW(ID+2)
   - index of next row in the bank with index ID
         KNEXT(ID) = ID + LMHLEN + IW(ID+1)*IW(ID+2)
   - index of row # NRBOS in the bank with index ID
         KROW(ID,NRBOS) = ID + LMHLEN + IW(ID+1)*(NRBOS-1)
   - # of free words in the bank with index ID
         LFRWRD(ID) = ID + IW(ID) - KNEXT(ID)
   - # of free rows in the bank with index ID
         LFRROW(ID) = LFRWRD(ID) / LCOLS(ID)
   - Lth integer element of the NRBOSth row of the bank with index ID
         ITABL(ID,NRBOS,L) = IW(ID+LMHLEN+(NRBOS-1)*IW(ID+1)+L)
   - Lth real element of the NRBOSth row of the bank with index ID
         RTABL(ID,NRBOS,L) = RW(ID+LMHLEN+(NRBOS-1)*IW(ID+1)+L)
   
         lcra_e14=-100
         klcra=iw(namind('LCRA'))
         if (klcra.gt.0) then
          do i=1,8
           if (itabl(klcra,1,i).gt.lcra_e14) lcra_e14=itabl(klcra,1,i)
          enddo
         endif
         return
         end
 
3 MCMATCH
         SUBROUTINE MCMATCH(IMCTRK,IALTRK,IFLAG)
  ------------------------------------------------------------------------------
    CKEY MATCHING / USER
  ------------------------------------------------------------------------------
   Match a mc truth with reconstructed, and classify the track.
    Author  Dave Brown, 7-6--94
    Good tracks are classified according to the origin of the true track
    Input argument :
     IMCTRK = Input ALPHA track number
    Output arguments :
     IALTRK = Associated ALPHA MC true track if there's a reasonable match
            = 0 otherwise
     IFLAG = -3    No Match (lost track)
             -2    Track decays before making hits
             -1    No well matching track
              0     mc track double counted
              1     Normal good match from primary vertex
              2     Normal good match from secondary vertex
              3     Normal good match from V0 decay
              4     Kink fit as 2 tracks
              5     Kink fit as a single track
              6     Normal good match from material interaction
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
              MCMATCH                                                              
                   |----  SIGN                                External             
                   |----  SQRT                                External             
                   |----  ABS                                 External             
                   |----  NINT                                External             
                   |----  KMATIX                              External             
                   |----  ATG                                 External             
                   |----  KCLARM                              External             
                   |----  IAND                                External             
                   |----  KLOCK0                              External             
                   |----  IABS                                External             
                   |----  JULMATCH                                                 
   
 
3 MKPECPC
         INTEGER FUNCTION MINI_KPECPC(IECAL)
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
       Input: IECAL (I) : ALPHA track number of the ECAL (PECO) object
       Output: (I): PCOB object number
       error code : -1 = invalid IECAL
                    -2 = IECAL is NOT a PECO object
                    -3 = cannot find PECO Julia number
                    -4 = cannot find PCRL
         IMPLICIT NONE
   
   ALPHA Version 122 - Implicit declaration include file : 12 April 1996
   
    bmacrod
         INTEGER LCOLS, LROWS, KROW, KNEXT, ITABL,LFRWRD, LFRROW
         REAL RTABL
         INTEGER ID, NRBOS, L
   
         REAL ATG
         REAL QQPI,QQE,QQ2PI,QQPIH,QQRADP,QQC,QQH,QQHC,QQIRP,QELEP,QMFLD
         REAL QMFLDC,QTIME,QTIMEI,QTIMEL,QTIMES,QTIMET,QDHEEC,QDHEEL
         REAL QDHEPF,QDHETH,QDHEPH,QDHEEF,QDHEET,QDHET1,QDHEP1,QDHET2
         REAL QDHEP2,QDHEE1,QDHEE2,QDHEE3,QKEVRN,QKEVWT,QVXNOM,QVYNOM
         REAL QVZNOM,QVXNSG,QVYNSG,QVZNSG,QINLUM,QRINLN,QRINLU,QDBOFS
         REAL QEECWI,QVXBOM,QVYBOM,QSILUM,QRSLLU,QRSLBK,QRSLEW,QVTXBP
         REAL QVTEBP,QVTSBP,QSQT,QF,QP,QX,QY,QZ,QE,QM,QCH,QCT,QDB
         REAL QZB,QDBS2,QZBS2,QBC2,QSIG,QSMAT,QSIGX,QSIGY,QSIGZ,QSIGEE
         REAL QSIGE,QSIGPP,QSIGP,QSIGMM,QSIGM,QMCHIF,QPH,QPT,QRDFL,QVX,QVY
         REAL QVZ,QVEM,QVCHIF,QVDIF2,QVDIF3,QMSQ2,QMSQ3,QMSQ4,QM2,QM3,QM4
         REAL QDMSQ,QBETA,QGAMMA,QDOT3,QDOT4,QCOSA,QPPAR,QPPER,QCMASS
         REAL QCCHAR,QCLIFE,QCWIDT,QFRFIR,QFRFTL,QFRFP0,QFRFD0,QFRFZ0
         REAL QFRFAL,QFRFEM,QFRFC2,QFRIPE,QFRIPM,QFRIPI,QFRIPK,QFRIPP
         REAL QFRINK,QTEXTM,QTEXTL,QTEXAD,QEIDRI,QEIDEC,QEIDEI,QHMAED
         REAL QHMACS,QMCADH,QMCADC,QMCAAM,QMCAAC,QMUISR,QMUIDM,QPECER
         REAL QPECE1,QPECE2,QPECTH,QPECPH,QPECEC,QPEPT1,QPEPP1,QPEPT3
         REAL QPEPP3,QPHCER,QPHCTH,QPHCPH,QPHCEC,QEFOWE,QEGPR1,QEGPR2
         REAL QEGPF4,QEGPDM,QPGPR1,QPGPR2,QPGPF4,QPGPDM,QPGPST,QPGPQ1
         REAL QPGPQ2,QPGPM1,QPGPM2,QPGPMA,QPGPER,QPGPTR,QPGPPR,QYV0VX
         REAL QYV0VY,QYV0VZ,QYV0X1,QYV0X2,QYV0C2,QYV0DM,QYV0S1,QYV0S2
         REAL QDECA2,QDECAN,QMASV0,QMCHI2,QMDIFF,QPCHAR,QPLIFE,QPMASS
         REAL QPWIDT,QKBLOK,QPGAEF,QPGAGC,QPGAZS,QPGAPL,QPGAPH
         REAL QLEPPI,QLEPPE
         INTEGER KI, KI1,KI2
         INTEGER KCQDET,KCQFPA,KCQPAR,KCQVEC,KCQVRT,KHE,KHMU,KHPI,KHK,KHP
         INTEGER KHPHOT,KHNHAD,KMONTE,KRECO,KLOCKM,KSOVT,KSCHT,KSIST,KSAST
         INTEGER KSEHT,KSV0T,KSDCT,KSEFT,KSNET,KSGAT,KSJET,KSMCT,KSREV
         INTEGER KSMCV,KUNDEF,KFOVT,KLOVT,KNOVT,KFCHT,KLCHT,KNCHT,KFIST
         INTEGER KLIST,KNIST,KFAST,KLAST,KNAST,KFEHT,KLEHT,KNEHT,KFV0T
         INTEGER KLV0T,KNV0T,KFDCT,KLDCT,KNDCT,KFEFT,KLEFT,KNEFT,KFNET
         INTEGER KLNET,KNNET,KFGAT,KLGAT,KNGAT,KFJET,KLJET,KNJET,KFMCT
         INTEGER KLMCT,KNMCT,KFREV,KLREV,KNREV,KFMCV,KLMCV,KNMCV,KLUST
         INTEGER KLUSV,KFFRT,KLFRT,KFFRV,KLFRV,KNRET,KNCOT,KFFRD,KBIT
         INTEGER KCLACO,KCLAFR,KCLARM,KDEBUG,KEVT,KEXP,KFFILL,KFEOUT
         INTEGER KJOPTN,KLEOUT,KLROUT,KLOCK0,KLOCK1,KLOCK2,KMATIX,KMQFPA
         INTEGER KNEFIL,KNEOUT,KNEVT,KNPAST,KNQDET,KNQFPA,KNQLIN,KNQMTX
         INTEGER KNQPAR,KNQPST,KNREIN,KNREOU,KOQDET,KOQFPA,KOQLIN,KOQMTL
         INTEGER KOQMTS,KOQPAR,KOQPBT,KOQPLI,KOQTRA,KOQVEC,KOQVRT,KQPAR
         INTEGER KQVEC,KQVRT,KQWRK,KQZER,KRUN,KSTATU,KTDROP,KUCARD,KUCONS
         INTEGER KUHIST,KUINPU,KUOUTP,KUPRNT,KUPTER,KDEBU1,KDEBU2,KNWRLM
         INTEGER KEFOPT,KUEDIN,KUEDOU,KURTOX,KUCAR2,KNHDRN,KNBHAB,KSBHAB
         INTEGER KRSLLQ,KRSLNB,INDATA,KRINNE,KRINNF,KRINDC,KRINDQ,KRINNZ
         INTEGER KRINNB,KRINBM,KRINFR,KRINLR,KRINLF,KEVERT,KEVEDA,KEVETI
         INTEGER KEVEMI,KEVETY,KEVEES,KDHEFP,KDHENP,KDHENM,KKEVNT,KKEVNV
         INTEGER KKEVID,KDHENX,KDHENV,KDHENJ,KREVDS,KXTET1,KXTET2,KXTEL2
         INTEGER KXTCGC,KXTCLL,KXTCBN,KXTCCL,KXTCHV,KXTCEN,KCLASW,KERBOM
         INTEGER KBPSTA,KLOCUS,KFRET,KLRET,KFCOT,KLCOT,NAAFID,NAAJOB
         INTEGER NAASEV,NABCNT,NABHIT,NABOMB,NABOME,NABOMP,NABOMR,NABPTR
         INTEGER NADCAL,NADCRL,NADECO,NADEID,NADENF,NADEVT,NADEWI,NADFMC
         INTEGER NADFOT,NADGAM,NADHCO,NADHEA,NADHRL,NADJET,NADMID,NADMJT
         INTEGER NADMUO,NADNEU,NADPOB,NADRES,NADTBP,NADTMC,NADTRA,NADVER
         INTEGER NADVMC,NAECRQ,NAECTE,NAEGID,NAEGPC,NAEIDT,NAEJET,NAERRF
         INTEGER NAETDI,NAETKC,NAEVEH,NAEWHE,NAFICL,NAFKIN,NAFPOI,NAFPOL
         INTEGER NAFRFT,NAFRID,NAFRTL,NAFSTR,NAFTCL,NAFTCM,NAFTOC,NAFTTM
         INTEGER NAFVCL,NAFVER,NAFZFR,NAHCCV,NAHCTE,NAHINF,NAHMAD,NAHPDI
         INTEGER NAHROA,NAHSDA,NAHTUB,NAIASL,NAIPJT,NAIRJT,NAITCO,NAITMA
         INTEGER NAIXTR,NAIZBD,NAJBER,NAJEST,NAJSUM,NAKEVH,NAKINE,NAKJOB
         INTEGER NAKLIN,NAKPOL,NAKRUN,NALIDT,NALOLE,NALUPA,NAMCAD,NAMHIT
         INTEGER NAMTHR,NAMUDG,NAMUEX,NAOSTS,NAPART,NAPASL,NAPCHY,NAPCOB
         INTEGER NAPCOI,NAPCPA,NAPCQA,NAPCRL,NAPECO,NAPEHY,NAPEID,NAPEMH
         INTEGER NAPEPT,NAPEST,NAPEWI,NAPFER,NAPFHR,NAPFRF,NAPFRT,NAPHCO
         INTEGER NAPHER,NAPHHY,NAPHMH,NAPHST,NAPIDI,NAPITM,NAPLID,NAPLPD
         INTEGER NAPLSD,NAPMSK,NAPNEU,NAPPDS,NAPPOB,NAPPRL,NAPRTM,NAPSCO
         INTEGER NAPSPO,NAPSTR,NAPT2X,NAPTBC,NAPTCO,NAPTEX,NAPTMA,NAPTML
         INTEGER NAPTNC,NAPTST,NAPVCO,NAPYER,NAPYFR,NAPYNE,NAQDET,NAQFPA
         INTEGER NAQLIN,NAQMTL,NAQMTS,NAQPAR,NAQPBT,NAQPLI,NAQTRA,NAQVEC
         INTEGER NAQVRT,NAQWRK,NAQZER,NAREVH,NARHAH,NARTLO,NARTLS,NARUNH
         INTEGER NARUNR,NASFTR,NATEXS,NATGMA,NATMTL,NATPCO,NAVCOM,NAVCPL
         INTEGER NAVDCO,NAVDHT,NAVDXY,NAVDZT,NAVERT,NAVFHL,NAVFLG,NAVFPH
         INTEGER NAVHLS,NAVPLH,NAX1AD,NAX1SC,NAX1TI,NAX2DF,NAX3EC,NAX3EW
         INTEGER NAX3HC,NAX3IT,NAX3L2,NAX3LU,NAX3TM,NAX3TO,NAX3TP,NAX3X3
         INTEGER NAXTBN,NAXTBP,NAXTCN,NAXTEB,NAXTOP,NAXTRB,NAYV0V,NAZPFR
         INTEGER NANBIP,NAPGAC,NAPMSC,NAPTHR,NAPDLT,NAPMLT,NAPLJT
         INTEGER NAEFOL,NAMUID,NAPGID,NAPGPC,JQVEQX,JQVEQY,JQVEQZ,JQVEQE
         INTEGER JQVEQM,JQVEQP,JQVECH,JQVETN,JQVESC,JQVEKS,JQVECL,JQVEPA
         INTEGER JQVEQD,JQVENP,JQVESP,JQVEOV,JQVEEV,JQVEND,JQVEDL,JQVENO
         INTEGER JQVEOL,JQVENM,JQVEML,JQVEBM,JQVELK,JQVEDB,JQVEZB,JQVESD
         INTEGER JQVESZ,JQVECB,JQVEEM,JQVECF,JQVEEW,JQVEUS,JQVRVX,JQVRVY
         INTEGER JQVRVZ,JQVRVN,JQVRTY,JQVRIP,JQVRND,JQVRDL,JQVRAY,JQVRAF
         INTEGER JQVREM,JQVRCF,JQVRET,JQDEAF,JQDEAL,JQDENT,JQDEAT,JQDELT
         INTEGER JQDEAE,JQDEAH,JQDEAM,JQDECF,JQDEEC,JQDEHC,JQDEET,JQDEFI
         INTEGER JQDENF,JQDEFL,JQDENE,JQDEEL,JQDENH,JQDEHL,JQDELH,JQDEEF
         INTEGER JQDEPC,JQDEEG,JQDEMU,JQDEDX,JQDEPG,JQPAGN,JQPANA,JQPACO
         INTEGER JQPAMA,JQPACH,JQPALT,JQPAWI,JQPAAN
         INTEGER KJQDET,KCH,KTN,KMC
         INTEGER KBMASK,KCALFL,KCHGD,KCLASS,KDAU,KECAL,KENDV,KFOLLO,KHCAL
         INTEGER KLUNDS,KNCHGD,KNECAL,KNHCAL,KNMOTH,KMOTH,KMTCH,KNDAU
         INTEGER KNMTCH,KORIV,KSAME,KSMTCH,KSTABC,KTPCOD,KRDFL,KVN,KVTYPE
         INTEGER KVINCP,KVNDAU,KVYV0V,KVFVER,KVDAU,KI3,KI4,KFRFDF,KFRFNO
         INTEGER KFRTNV,KFRTNI,KFRTNE,KFRTNT,KFRTNR,KFRIBP,KFRIDZ,KFRIBC
         INTEGER KFRIDC,KFRIQF,KNTEX,KTEXSI,KTEXNS,KEIDIF,KEIDIP,KHMANF
         INTEGER KHMANE,KHMANL,KHMAMH,KHMAIG,KHMAND,KHMAIE,KHMAIT,KHMAIF
         INTEGER KMCANH,KMUIIF,KMUIST,KMUITN,KPECKD,KPECCC,KPECRB,KPECPC
         INTEGER KPHCKD,KPHCCC,KPHCRB,KPHCPC,KEFOTY,KEFOLE,KEFOLT,KEFOLH
         INTEGER KEFOLC,KEFOLJ,KPCQNA,KEGPST,KEGPQU,KEGPPE,KPGPQU,KPGPPE
         INTEGER KYV0K1,KYV0K2,KYV0IC,KSCNEW,KSCOLD,KFPADR,KGLUND,KMCCOD
         INTEGER KCANTI,KCDIR,KCDIRA,KCHT,KIDSAV,KPANTI,KPART,KPDIR,KPDIRA
         INTEGER KTLOR,KTLOR1,KVFITA,KVFITC,KVFITM,KVFITN,KVFITV,KVFTMC
         INTEGER KTLORX,KVGOOD,KVNEW,KVSAVA,KVSAVC,KVSAVE,KPARTX,KPCCOMP
         INTEGER KPGAPN,KPGAFA,KPGAPE,KLEPPA,KLEPJT,KLEPFL,KLEPPO,KLEPCH
         INTEGER KPGAST,KLEPVP,KLEPSP,KLEPLE,KLEPME,KLEPKT,JQDEPD,JQDEPM
         INTEGER KLFJET,KLLJET,KLNJET,KLJTNO
   
   
   -------------------- /QCDE/ --- COMMONs, DIMENSIONs, etc. ------------
   
    of QCDESH ----------------------- Description in QDATA ---------
         PARAMETER (KCQDET=34, KCQFPA=8, KCQPAR=10, KCQVEC=73, KCQVRT=30,
        & KHE=1, KHMU=2, KHPI=3, KHK=4, KHP=5, KHPHOT=1, KHNHAD=2,
        & KMONTE=-2, KRECO=-1, KLOCKM=14, KSOVT=1, KSCHT=2, KSIST=3,
        & KSAST=4, KSEHT=5, KSV0T=6, KSDCT=7, KSEFT=8, KSNET=9, KSGAT=10,
        & KSJET=11, KSMCT=12, KSREV=13,
        & KSMCV=14, KUNDEF=-12344321, QQPI=3.141593, QQE=2.718282,
        & QQ2PI=QQPI*2., QQPIH=QQPI/2., QQRADP=180./QQPI, QQC=2.997925E10,
        & QQH=6.582173E-25, QQHC=QQH*QQC, QQIRP=.00029979)
         CHARACTER CQDATE*8, CQDWRK*80, CQFHIS*80, CQFOUT*80, CQFWRK*80,
        & CQHTIT*80, CQSEC*3, CQTIME*8, CQUNPK*30, CQVERS*6, CQRLST*800,
        & CQELST*800
         COMMON /QCDEC/ CQDATE, CQDWRK, CQFHIS, CQFOUT, CQFWRK, CQHTIT,
        & CQSEC(14), CQTIME, CQUNPK, CQVERS, CQRLST, CQELST
         COMMON /QCDE/ QELEP, QMFLD ,QMFLDC, QTIME, QTIMEI, QTIMEL,
        & QTIMES, QTIMET, QDHEEC, QDHEEL, QDHEPF, QDHETH, QDHEPH, QDHEEF,
        & QDHEET, QDHET1, QDHEP1, QDHET2, QDHEP2, QDHEE1, QDHEE2, QDHEE3,
        & QKEVRN, QKEVWT, QVXNOM, QVYNOM, QVZNOM, QVXNSG, QVYNSG, QVZNSG,
        & QINLUM, QRINLN, QRINLU, QDBOFS, QEECWI(36), QVXBOM, QVYBOM,
        & QSILUM, QRSLLU, QRSLBK, QRSLEW , QVTXBP(3), QVTEBP(3), QVTSBP(3)
         COMMON /QCDE/  KFOVT, KLOVT, KNOVT, KFCHT, KLCHT, KNCHT, KFIST,
        & KLIST, KNIST, KFAST, KLAST, KNAST, KFEHT, KLEHT, KNEHT, KFV0T,
        & KLV0T, KNV0T, KFDCT, KLDCT, KNDCT, KFEFT, KLEFT, KNEFT, KFNET,
        & KLNET, KNNET, KFGAT, KLGAT, KNGAT, KFJET, KLJET, KNJET, KFMCT,
        & KLMCT, KNMCT, KFREV, KLREV, KNREV, KFMCV, KLMCV, KNMCV, KLUST,
        & KLUSV, KFFRT, KLFRT, KFFRV, KLFRV, KNRET, KNCOT, KFFRD,
        & KLFJET,KLLJET,KLNJET
         COMMON /QCDE/ KBIT(32), KCLACO(KCQFPA), KCLAFR(KCQFPA), KCLARM
        & (KCQFPA), KDEBUG, KEVT, KEXP, KFFILL, KFEOUT, KJOPTN(2,2),
        & KLEOUT, KLROUT, KLOCK0(KLOCKM,2), KLOCK1(KLOCKM,2), KLOCK2(
        & KLOCKM,2), KMATIX(6,6), KMQFPA, KNEFIL, KNEOUT, KNEVT, KNPAST,
        & KNQDET, KNQFPA, KNQLIN, KNQMTX, KNQPAR, KNQPST, KNREIN, KNREOU,
        & KOQDET, KOQFPA, KOQLIN, KOQMTL, KOQMTS, KOQPAR, KOQPBT, KOQPLI,
        & KOQTRA, KOQVEC, KOQVRT, KQPAR, KQVEC, KQVRT, KQWRK, KQZER, KRUN,
        & KSTATU, KTDROP, KUCARD, KUCONS, KUHIST, KUINPU, KUOUTP, KUPRNT,
        & KUPTER, KDEBU1, KDEBU2, KNWRLM, KEFOPT, KUEDIN, KUEDOU, KURTOX,
        & KUCAR2, KNHDRN, KNBHAB, KSBHAB, KRSLLQ, KRSLNB
         COMMON /QCDE/ INDATA
         COMMON /QCDE/ KRINNE, KRINNF, KRINDC, KRINDQ, KRINNZ, KRINNB,
        & KRINBM, KRINFR, KRINLR, KRINLF
         COMMON /QCDE/ KEVERT, KEVEDA, KEVETI, KEVEMI(4), KEVETY, KEVEES,
        & KDHEFP, KDHENP, KDHENM, KKEVNT, KKEVNV, KKEVID, KDHENX, KDHENV,
        & KDHENJ, KREVDS, KXTET1, KXTET2, KXTEL2, KXTCGC, KXTCLL, KXTCBN,
        & KXTCCL, KXTCHV, KXTCEN, KCLASW, KERBOM, KBPSTA
         DIMENSION KLOCUS(3,14)
         EQUIVALENCE (KLOCUS(1,1),KFOVT), (KFOVT,KFRET), (KLIST,KLRET),
        & (KFIST,KFCOT), (KLAST,KLCOT)
         COMMON /QCDE/ XCOPYJ, XFLIAC, XHISTO, XLREV(2), XLREV2(2), XMCEV,
        & XMINI, XSYNTX, XWREVT, XWRRUN, XFILMC, XFILCH, XFILV0, XFILCO,
        & XFILEF, XFILPC, XFILGA, XFILJE,
        & XPRHIS, XFILL, XVITC, XVTPC, XVECAL, XVLCAL, XVTPCD,
        & XVSATR, XVHCAL, XHVTRG, XSREC, XWMINI, XIOKLU, XIOKSI, XFRF2,
        & XNSEQ, XVDOK, XFRF0, XFMUID, XFILEM, XWNANO, XROKSI, XGETBP,
        & XJTHRU
         LOGICAL XCOPYJ, XFLIAC, XHISTO, XLREV, XLREV2, XMCEV, XMINI,
        & XSYNTX, XWREVT, XWRRUN, XFILMC, XFILCH, XFILV0, XFILCO, XFILEF,
        & XFILPC, XPRHIS, XFILL, XVITC, XVTPC, XVECAL, XVLCAL, XVTPCD,
        & XVSATR, XVHCAL, XHVTRG, XSREC, XWMINI, XIOKLU, XFRF2, XFILJE,
        & XNSEQ, XFILGA, XVDOK, XFRF0, XFMUID, XFILEM, XWNANO, XIOKSI,
        & XROKSI, XGETBP, XJTHRU
   
   -------------------- /NANCOM/ --- NanoDst steering -------------------
   Xnano   .true. if input is a nanodst (in nano or epio format, depending
                      XNANOR)
   
         LOGICAL XNANO
         COMMON /NANCOM/XNANO
   
   
    bcs
         INTEGER LMHLEN, LMHCOL, LMHROW
         PARAMETER (LMHLEN=2, LMHCOL=1, LMHROW=2)
         COMMON /BCS/   IW(1000)
         INTEGER IW
         REAL RW(1000)
         EQUIVALENCE (RW(1),IW(1))
   
   
   ------------------ /QCNAMI/ --- name indices -------------------------
         COMMON /QCNAMI/ NAAFID,NAAJOB,NAASEV,NABCNT,NABHIT,NABOMB,
        1 NABOME,NABOMP,NABOMR,NABPTR,NADCAL,NADCRL,NADECO,NADEID,NADENF,
        2 NADEVT,NADEWI,NADFMC,NADFOT,NADGAM,NADHCO,NADHEA,NADHRL,NADJET,
        3 NADMID,NADMJT,NADMUO,NADNEU,NADPOB,NADRES,NADTBP,NADTMC,NADTRA,
        4 NADVER,NADVMC,NAECRQ,NAECTE,NAEGID,NAEGPC,NAEIDT,NAEJET,NAERRF,
        5 NAETDI,NAETKC,NAEVEH,NAEWHE,NAFICL,NAFKIN,NAFPOI,NAFPOL,NAFRFT,
        6 NAFRID,NAFRTL,NAFSTR,NAFTCL,NAFTCM,NAFTOC,NAFTTM,NAFVCL,NAFVER,
        7 NAFZFR,NAHCCV,NAHCTE,NAHINF,NAHMAD,NAHPDI,NAHROA,NAHSDA,NAHTUB,
        8 NAIASL,NAIPJT,NAIRJT,NAITCO,NAITMA,NAIXTR,NAIZBD,NAJBER,NAJEST,
        9 NAJSUM,NAKEVH,NAKINE,NAKJOB,NAKLIN,NAKPOL,NAKRUN,NALIDT,NALOLE,
        A NALUPA,NAMCAD,NAMHIT,NAMTHR,NAMUDG,NAMUEX,NAOSTS,NAPART,NAPASL,
        B NAPCHY,NAPCOB,NAPCOI,NAPCPA,NAPCQA,NAPCRL,NAPECO,NAPEHY,NAPEID,
        C NAPEMH,NAPEPT,NAPEST,NAPEWI,NAPFER,NAPFHR,NAPFRF,NAPFRT,NAPHCO,
        D NAPHER,NAPHHY,NAPHMH,NAPHST,NAPIDI,NAPITM,NAPLID,NAPLPD,NAPLSD,
        E NAPMSK,NAPNEU,NAPPDS,NAPPOB,NAPPRL,NAPRTM,NAPSCO,NAPSPO,NAPSTR,
        F NAPT2X,NAPTBC,NAPTCO,NAPTEX,NAPTMA,NAPTML,NAPTNC,NAPTST,NAPVCO,
        G NAPYER,NAPYFR,NAPYNE,NAQDET,NAQFPA,NAQLIN,NAQMTL,NAQMTS,NAQPAR,
        H NAQPBT,NAQPLI,NAQTRA,NAQVEC,NAQVRT,NAQWRK,NAQZER,NAREVH,NARHAH,
        I NARTLO,NARTLS,NARUNH,NARUNR,NASFTR,NATEXS,NATGMA,NATMTL,NATPCO,
        J NAVCOM,NAVCPL,NAVDCO,NAVDHT,NAVDXY,NAVDZT,NAVERT,NAVFHL,NAVFLG,
        K NAVFPH,NAVHLS,NAVPLH,NAX1AD,NAX1SC,NAX1TI,NAX2DF,NAX3EC,NAX3EW,
        L NAX3HC,NAX3IT,NAX3L2,NAX3LU,NAX3TM,NAX3TO,NAX3TP,NAX3X3,NAXTBN,
        M NAXTBP,NAXTCN,NAXTEB,NAXTOP,NAXTRB,NAYV0V,NAZPFR,NAEFOL,NAMUID,
        N NAPGID,NAPGPC,NAPGAC,NAPMSC,NAPTHR,NANBIP,NAPDLT,NAPMLT,NAPLJT
   
   
   ------------------ /QQQQJJ/ --- HAC parameters for ALPHA banks -------
         PARAMETER (JQVEQX= 1,JQVEQY= 2,JQVEQZ= 3,JQVEQE= 4,JQVEQM= 5,
        & JQVEQP= 6,JQVECH= 7,JQVETN= 8,JQVESC= 9,JQVEKS=10,JQVECL=11,
        & JQVEPA=12,JQVEQD=13,JQVENP=14,JQVESP=15,JQVEOV=16,JQVEEV=17,
        & JQVEND=18,JQVEDL=19,JQVENO=20,JQVEOL=21,JQVENM=22,JQVEML=23,
        & JQVEBM=24,JQVELK=38,JQVEDB=39,JQVEZB=40,JQVESD=41,JQVESZ=42,
        & JQVECB=43,JQVEEM=44,JQVECF=54,JQVEEW=55,JQVEUS=56)
         PARAMETER ( JQVRVX=1,JQVRVY=2,JQVRVZ=3,JQVRVN=4,JQVRTY=5,
        1   JQVRIP=6,JQVRND=7,JQVRDL=8,JQVRAY=9,JQVRAF=10,JQVREM=11,
        2   JQVRCF=17,JQVRET=18)
         PARAMETER ( JQDEAF= 1,JQDEAL= 2,JQDENT= 3,JQDEAT= 4,JQDELT= 8,
        &  JQDEAE= 9,JQDEAH=10,JQDEAM=11,JQDECF=12,JQDEEC=13,JQDEHC=14,
        &  JQDEET=15,JQDEFI=16,JQDENF=17,JQDEFL=18,JQDENE=19,JQDEEL=20,
        &  JQDENH=21,JQDEHL=22,JQDELH=23,JQDEEF=24,JQDEPC=25,JQDEEG=26,
        &  JQDEMU=27,JQDEDX=28,JQDEPG=29,JQDEPD=30,JQDEPM=31)
         PARAMETER ( JQPAGN=1, JQPANA=2, JQPACO=5, JQPAMA=6, JQPACH=7,
        & JQPALT=8,JQPAWI=9,JQPAAN=10)
   
   
         EXTERNAL CQPART, CQTPN, XCEQAN, XLUMOK, XPEQAN, XPEQOR, XPEQU,
        & XVDEOK, LLUMOK, SLUMOK
         CHARACTER * 12 CQPART, CQTPN
         LOGICAL XCAL, XCEQAN, XCEQOR, XCEQU, XECAL, XEID, XFRF, XHCAL,
        & XHMA, XLOCK, XLOCKN, XMC, XLUMOK, XMCA, XPEO, XPHO, XPEQAN,
        & XPEQOR, XPEQU, XSAME, XSIG, XTEX, XPEC, XPEP, XPHC, XYV0,
        & XFRIQF, XEFO, XPCQ, XEGP, XMUI, XVDEOK, XPGP, LLUMOK, SLUMOK,
        & XPGAC, XLEPTG, XLEPTH
   
    alcons
    define universal constants
         REAL PI, TWOPI, PIBY2, PIBY3, PIBY4, PIBY6, PIBY8, PIBY12
         REAL RADEG, DEGRA
         REAL CLGHT, ALDEDX
         PARAMETER (PI=3.141592653589)
         PARAMETER (RADEG=180./PI, DEGRA=PI/180.)
         PARAMETER (TWOPI = 2.*PI , PIBY2 = PI/2., PIBY4 = PI/4.)
         PARAMETER (PIBY6 = PI/6. , PIBY8 = PI/8.)
         PARAMETER (PIBY12= PI/12., PIBY3 = PI/3.)
         PARAMETER (CLGHT = 29.9792458, ALDEDX = 0.000307)
   
         ALDEDX  = constant used in the computation of DEDX in GeV
         CLGHT   = speed of light in cm/nsec
   
   
   
    efoljj
         INTEGER JEFOPX,JEFOPY,JEFOPZ,JEFOEW,JEFOWE,JEFOTY,JEFOLE,JEFOLT,
        +          JEFOLH,JEFOLC,JEFOLJ,LEFOLA
         PARAMETER(JEFOPX=1,JEFOPY=2,JEFOPZ=3,JEFOEW=4,JEFOWE=5,JEFOTY=6,
        +          JEFOLE=7,JEFOLT=8,JEFOLH=9,JEFOLC=10,JEFOLJ=11,
        +          LEFOLA=11)
   
   
    egpcjj
         INTEGER JEGPPX,JEGPPY,JEGPPZ,JEGPR1,JEGPR2,JEGPF4,JEGPDM,JEGPST,
        +          JEGPQU,JEGPPE,LEGPCA
         PARAMETER(JEGPPX=1,JEGPPY=2,JEGPPZ=3,JEGPR1=4,JEGPR2=5,JEGPF4=6,
        +          JEGPDM=7,JEGPST=8,JEGPQU=9,JEGPPE=10,LEGPCA=10)
   
   
    eidtjj
         INTEGER JEIDIF,JEIDR1,JEIDR2,JEIDR3,JEIDR4,JEIDR5,JEIDR6,JEIDR7,
        +          JEIDEC,JEIDIP,JEIDE1,JEIDE2,JEIDE3,JEIDFR,JEIDPE,LEIDTA
         PARAMETER(JEIDIF=1,JEIDR1=2,JEIDR2=3,JEIDR3=4,JEIDR4=5,JEIDR5=6,
        +          JEIDR6=7,JEIDR7=8,JEIDEC=9,JEIDIP=10,JEIDE1=11,
        +          JEIDE2=12,JEIDE3=13,JEIDFR=14,JEIDPE=15,LEIDTA=15)
   
   
    frftjj
         INTEGER JFRFIR,JFRFTL,JFRFP0,JFRFD0,JFRFZ0,JFRFAL,JFRFEM,JFRFC2,
        +          JFRFDF,JFRFNO,LFRFTA
         PARAMETER(JFRFIR=1,JFRFTL=2,JFRFP0=3,JFRFD0=4,JFRFZ0=5,JFRFAL=6,
        +          JFRFEM=7,JFRFC2=28,JFRFDF=29,JFRFNO=30,LFRFTA=30)
   
   
    fridjj
         INTEGER JFRIBP,JFRIDZ,JFRIBC,JFRIDC,JFRIPE,JFRIPM,JFRIPI,JFRIPK,
        +          JFRIPP,JFRINK,JFRIQF,LFRIDA
         PARAMETER(JFRIBP=1,JFRIDZ=2,JFRIBC=3,JFRIDC=4,JFRIPE=5,JFRIPM=6,
        +          JFRIPI=7,JFRIPK=8,JFRIPP=9,JFRINK=10,JFRIQF=11,
        +          LFRIDA=11)
   
   
    frtljj
         INTEGER JFRTIV,JFRTNV,JFRTII,JFRTNI,JFRTNE,JFRTIT,JFRTNT,JFRTNR,
        +          LFRTLA
         PARAMETER(JFRTIV=1,JFRTNV=2,JFRTII=3,JFRTNI=4,JFRTNE=5,JFRTIT=6,
        +          JFRTNT=7,JFRTNR=8,LFRTLA=8)
   
   
    hmadjj
         INTEGER JHMANF,JHMANE,JHMANL,JHMAMH,JHMAIG,JHMAED,JHMACS,JHMAND,
        +          JHMAIE,JHMAIT,JHMAIF,JHMATN,LHMADA
         PARAMETER(JHMANF=1,JHMANE=2,JHMANL=3,JHMAMH=4,JHMAIG=5,JHMAED=6,
        +          JHMACS=7,JHMAND=8,JHMAIE=9,JHMAIT=10,JHMAIF=11,
        +          JHMATN=12,LHMADA=12)
   
   
    mcadjj
         INTEGER JMCANH,JMCADH,JMCADC,JMCAAM,JMCAAC,JMCATN,LMCADA
         PARAMETER(JMCANH=1,JMCADH=3,JMCADC=5,JMCAAM=7,JMCAAC=8,JMCATN=9,
        +          LMCADA=9)
   
   
    muidjj
         INTEGER JMUIIF,JMUISR,JMUIDM,JMUIST,JMUITN,LMUIDA
         PARAMETER(JMUIIF=1,JMUISR=2,JMUIDM=3,JMUIST=4,JMUITN=5,LMUIDA=5)
   
   
    pcqajj
         INTEGER JPCQNA,JPCQPX,JPCQPY,JPCQPZ,JPCQEN,LPCQAA
         PARAMETER(JPCQNA=1,JPCQPX=2,JPCQPY=3,JPCQPZ=4,JPCQEN=5,LPCQAA=5)
   
   
    pdltjj
         INTEGER JPDLPA,JPDLJT,JPDLPI,JPDLPE,JPDLVP,JPDLFR,LPDLTA
         PARAMETER(JPDLPA=1,JPDLJT=2,JPDLPI=3,JPDLPE=4,JPDLVP=5,JPDLFR=6,
        +          LPDLTA=6)
   
   
    pecojj
         INTEGER JPECER,JPECE1,JPECE2,JPECTH,JPECPH,JPECEC,JPECKD,JPECCC,
        +          JPECRB,JPECPC,LPECOA
         PARAMETER(JPECER=1,JPECE1=2,JPECE2=3,JPECTH=4,JPECPH=5,JPECEC=6,
        +          JPECKD=7,JPECCC=8,JPECRB=9,JPECPC=10,LPECOA=10)
   
   
    peptjj
         INTEGER JPEPT1,JPEPP1,JPEPT3,JPEPP3,LPEPTA
         PARAMETER(JPEPT1=1,JPEPP1=2,JPEPT3=3,JPEPP3=4,LPEPTA=4)
   
   
    pgacjj
         INTEGER JPGAEC,JPGATC,JPGAPC,JPGAR1,JPGAR2,JPGAF4,JPGADM,JPGAST,
        +          JPGAQU,JPGAQ1,JPGAQ2,JPGAM1,JPGAM2,JPGAMA,JPGAER,JPGATR,
        +          JPGAPR,JPGAEF,JPGAGC,JPGAZS,JPGAPL,JPGAPH,JPGAPN,JPGAFA,
        +          JPGAPE,LPGACA
         PARAMETER(JPGAEC=1,JPGATC=2,JPGAPC=3,JPGAR1=4,JPGAR2=5,JPGAF4=6,
        +          JPGADM=7,JPGAST=8,JPGAQU=9,JPGAQ1=10,JPGAQ2=11,
        +          JPGAM1=12,JPGAM2=13,JPGAMA=14,JPGAER=15,JPGATR=16,
        +          JPGAPR=17,JPGAEF=18,JPGAGC=19,JPGAZS=20,JPGAPL=21,
        +          JPGAPH=22,JPGAPN=23,JPGAFA=24,JPGAPE=25,LPGACA=25)
   
   
    pgpcjj
         INTEGER JPGPEC,JPGPTC,JPGPPC,JPGPR1,JPGPR2,JPGPF4,JPGPDM,JPGPST,
        +          JPGPQU,JPGPQ1,JPGPQ2,JPGPM1,JPGPM2,JPGPMA,JPGPER,JPGPTR,
        +          JPGPPR,JPGPPE,LPGPCA
         PARAMETER(JPGPEC=1,JPGPTC=2,JPGPPC=3,JPGPR1=4,JPGPR2=5,JPGPF4=6,
        +          JPGPDM=7,JPGPST=8,JPGPQU=9,JPGPQ1=10,JPGPQ2=11,
        +          JPGPM1=12,JPGPM2=13,JPGPMA=14,JPGPER=15,JPGPTR=16,
        +          JPGPPR=17,JPGPPE=18,LPGPCA=18)
   
   
    phcojj
         INTEGER JPHCER,JPHCTH,JPHCPH,JPHCEC,JPHCKD,JPHCCC,JPHCRB,JPHCNF,
        +          JPHCPC,LPHCOA
         PARAMETER(JPHCER=1,JPHCTH=2,JPHCPH=3,JPHCEC=4,JPHCKD=5,JPHCCC=6,
        +          JPHCRB=7,JPHCNF=8,JPHCPC=9,LPHCOA=9)
   
   
    pmltjj
         INTEGER JPMLFL,JPMLPO,JPMLCH,JPMLSP,JPMLLE,JPMLME,JPMLKT,JPMLFR,
        +          LPMLTA
         PARAMETER(JPMLFL=1,JPMLPO=2,JPMLCH=3,JPMLSP=4,JPMLLE=5,JPMLME=6,
        +          JPMLKT=7,JPMLFR=8,LPMLTA=8)
   
   
    texsjj
         INTEGER JTEXSI,JTEXTM,JTEXTL,JTEXNS,JTEXAD,JTEXTN,JTEXSF,LTEXSA
         PARAMETER(JTEXSI=1,JTEXTM=2,JTEXTL=3,JTEXNS=4,JTEXAD=5,JTEXTN=6,
        +          JTEXSF=7,LTEXSA=7)
   
   
    yv0vjj
         INTEGER JYV0K1,JYV0K2,JYV0VX,JYV0VY,JYV0VZ,JYV0VM,JYV0PX,JYV0PY,
        +          JYV0PZ,JYV0PM,JYV0X1,JYV0X2,JYV0XM,JYV0C2,JYV0IC,JYV0P1,
        +          JYV0P2,JYV0EP,JYV0DM,JYV0S1,JYV0S2,LYV0VA
         PARAMETER(JYV0K1=1,JYV0K2=2,JYV0VX=3,JYV0VY=4,JYV0VZ=5,JYV0VM=6,
        +          JYV0PX=12,JYV0PY=13,JYV0PZ=14,JYV0PM=15,JYV0X1=21,
        +          JYV0X2=22,JYV0XM=23,JYV0C2=26,JYV0IC=27,JYV0P1=28,
        +          JYV0P2=31,JYV0EP=34,JYV0DM=55,JYV0S1=56,JYV0S2=57,
        +          LYV0VA=57)
   
   
   
   ALPHA Version 122 - HAC parameters include file created 12 April 1996
   
    afidjj
         INTEGER JAFIAR,JAFIAZ,JAFIMF,JAFIBE,LAFIDA
         PARAMETER(JAFIAR=1,JAFIAZ=2,JAFIMF=3,JAFIBE=4,LAFIDA=4)
   
   
    ajobjj
         INTEGER JAJOBM,JAJORM,JAJOGI,JAJOSO,JAJOSD,JAJOGC,JAJOJD,JAJOJT,
        +          JAJOGV,JAJOAV,JAJOFT,JAJOFS,JAJOFC,JAJODV,JAJODD,JAJOTV,
        +          JAJOCV,JAJOGN,LAJOBA
         PARAMETER(JAJOBM=1,JAJORM=2,JAJOGI=3,JAJOSO=4,JAJOSD=5,JAJOGC=6,
        +          JAJOJD=7,JAJOJT=8,JAJOGV=9,JAJOAV=10,JAJOFT=11,
        +          JAJOFS=12,JAJOFC=13,JAJODV=14,JAJODD=15,JAJOTV=16,
        +          JAJOCV=17,JAJOGN=18,LAJOBA=18)
   
   
    asevjj
         INTEGER JASERG,LASEVA
         PARAMETER(JASERG=1,LASEVA=3)
   
   
    bcntjj
         INTEGER JBCNBT,JBCNB1,JBCNB2,JBCNST,JBCND1,JBCND2,JBCNCT,LBCNTA
         PARAMETER(JBCNBT=1,JBCNB1=2,JBCNB2=3,JBCNST=4,JBCND1=8,JBCND2=9,
        +          JBCNCT=10,LBCNTA=10)
   
   
    bhitjj
         INTEGER JBHIDB,LBHITA
         PARAMETER(JBHIDB=1,LBHITA=1)
   
   
    bomajj
         INTEGER JBOMRU,JBOMXO,JBOMXS,JBOMYO,JBOMYS,JBOMFL,LBOMAA
         PARAMETER(JBOMRU=1,JBOMXO=2,JBOMXS=3,JBOMYO=4,JBOMYS=5,JBOMFL=6,
        +          LBOMAA=6)
   
   
    bombjj
         INTEGER JBOMXX,JBOMYY,JBOMEE,LBOMBA
         PARAMETER(JBOMXX=1,JBOMYY=2,JBOMEE=3,LBOMBA=3)
   
   
    bomejj
         INTEGER JBOMXI,JBOMXP,JBOMYI,JBOMYP,JBOMBU,JBOMIA,JBOMIB,JBOMR1,
        +          JBOMR2,JBOMR3,JBOMR4,JBOMER,LBOMEA
         PARAMETER(JBOMXI=1,JBOMXP=2,JBOMYI=3,JBOMYP=4,JBOMBU=5,JBOMIA=6,
        +          JBOMIB=7,JBOMR1=8,JBOMR2=9,JBOMR3=10,JBOMR4=11,
        +          JBOMER=12,LBOMEA=12)
   
   
    bompjj
         INTEGER JBOMXA,JBOMYA,JBOMSA,JBOMCA,JBOMXB,JBOMYB,JBOMSB,JBOMCB,
        +          JBOMBI,JBOMPU,LBOMPA
         PARAMETER(JBOMXA=1,JBOMYA=2,JBOMSA=3,JBOMCA=4,JBOMXB=5,JBOMYB=6,
        +          JBOMSB=7,JBOMCB=8,JBOMBI=9,JBOMPU=10,LBOMPA=10)
   
   
    bomrjj
         INTEGER JBOMMN,JBOMSI,JBOMPE,JBOMCL,LBOMRA
         PARAMETER(JBOMMN=1,JBOMSI=2,JBOMPE=3,JBOMCL=4,LBOMRA=4)
   
   
    bptrjj
         INTEGER JBPTAB,LBPTRA
         PARAMETER(JBPTAB=1,LBPTRA=1)
   
   
    dcrljj
         INTEGER JDCRDE,JDCRDH,JDCRDT,LDCRLA
         PARAMETER(JDCRDE=1,JDCRDH=2,JDCRDT=3,LDCRLA=3)
   
   
    decojj
         INTEGER JDECE0,JDECTH,JDECPH,JDECEF,JDECCC,LDECOA
         PARAMETER(JDECE0=1,JDECTH=2,JDECPH=3,JDECEF=4,JDECCC=6,LDECOA=6)
   
   
    deidjj
         INTEGER JDEIR2,JDEIR3,JDEIQF,JDEIDE,JDEIDT,LDEIDA
         PARAMETER(JDEIR2=1,JDEIR3=2,JDEIQF=3,JDEIDE=4,JDEIDT=5,LDEIDA=5)
   
   
    denfjj
         INTEGER JDENPX,JDENPY,JDENPZ,JDENE0,JDENWE,JDENTY,JDENPC,JDENDT,
        +          JDENDJ,LDENFA
         PARAMETER(JDENPX=1,JDENPY=2,JDENPZ=3,JDENE0=4,JDENWE=5,JDENTY=6,
        +          JDENPC=7,JDENDT=8,JDENDJ=9,LDENFA=9)
   
   
    devtjj
         INTEGER JDEVLE,JDEVWT,JDEVNX,JDEVNV,JDEVWR,JDEVWA,JDEVWB,JDEVPR,
        +          JDEVPA,JDEVPB,JDEVLA,JDEVLB,JDEVHR,JDEVHA,JDEVHB,LDEVTA
         PARAMETER(JDEVLE=1,JDEVWT=2,JDEVNX=3,JDEVNV=4,JDEVWR=5,JDEVWA=6,
        +          JDEVWB=7,JDEVPR=8,JDEVPA=9,JDEVPB=10,JDEVLA=11,
        +          JDEVLB=12,JDEVHR=13,JDEVHA=14,JDEVHB=15,LDEVTA=15)
   
   
    dewijj
         INTEGER JDEWMN,JDEWE0,JDEWEF,LDEWIA
         PARAMETER(JDEWMN=1,JDEWE0=2,JDEWEF=3,LDEWIA=4)
   
   
    dfmcjj
         INTEGER JDFMZF,LDFMCA
         PARAMETER(JDFMZF=1,LDFMCA=1)
   
   
    dfotjj
         INTEGER JDFOPX,JDFOPY,JDFOPZ,JDFOQF,JDFODE,LDFOTA
         PARAMETER(JDFOPX=1,JDFOPY=2,JDFOPZ=3,JDFOQF=4,JDFODE=5,LDFOTA=5)
   
   
    dgamjj
         INTEGER JDGANA,JDGAE1,JDGAE2,JDGAE3,JDGAE5,JDGAE6,JDGAE8,JDGAE0,
        +          JDGATH,JDGAPH,JDGADE,LDGAMA
         PARAMETER(JDGANA=1,JDGAE1=2,JDGAE2=3,JDGAE3=4,JDGAE5=5,JDGAE6=6,
        +          JDGAE8=7,JDGAE0=8,JDGATH=9,JDGAPH=10,JDGADE=11,
        +          LDGAMA=11)
   
   
    dhcojj
         INTEGER JDHCE0,JDHCTH,JDHCPH,JDHCBN,LDHCOA
         PARAMETER(JDHCE0=1,JDHCTH=2,JDHCPH=3,JDHCBN=4,LDHCOA=4)
   
   
    dheajj
         INTEGER JDHEFP,JDHENX,JDHENP,JDHENM,JDHENV,JDHENJ,JDHEEC,JDHEEL,
        +          JDHEPF,JDHETH,JDHEPH,JDHEEF,JDHEET,JDHET1,JDHEP1,JDHET2,
        +          JDHEP2,JDHEE1,JDHEE2,JDHEE3,JDHERS,JDHEWT,LDHEAA
         PARAMETER(JDHEFP=1,JDHENX=2,JDHENP=3,JDHENM=4,JDHENV=5,JDHENJ=6,
        +          JDHEEC=7,JDHEEL=8,JDHEPF=9,JDHETH=10,JDHEPH=11,
        +          JDHEEF=12,JDHEET=13,JDHET1=14,JDHEP1=15,JDHET2=16,
        +          JDHEP2=17,JDHEE1=18,JDHEE2=19,JDHEE3=20,JDHERS=21,
        +          JDHEWT=22,LDHEAA=22)
   
   
    dhrljj
         INTEGER JDHRDH,JDHRDP,LDHRLA
         PARAMETER(JDHRDH=1,JDHRDP=2,LDHRLA=2)
   
   
    djetjj
         INTEGER JDJEPX,JDJEPY,JDJEPZ,JDJEE0,LDJETA
         PARAMETER(JDJEPX=1,JDJEPY=2,JDJEPZ=3,JDJEE0=4,LDJETA=4)
   
   
    dmjtjj
         INTEGER JDMJNP,JDMJNM,JDMJP0,JDMJTH,JDMJPH,JDMJE0,LDMJTA
         PARAMETER(JDMJNP=1,JDMJNM=2,JDMJP0=3,JDMJTH=4,JDMJPH=5,JDMJE0=6,
        +          LDMJTA=6)
   
   
    dmuojj
         INTEGER JDMUHO,JDMUHE,JDMUSH,JDMUDT,LDMUOA
         PARAMETER(JDMUHO=1,JDMUHE=2,JDMUSH=3,JDMUDT=4,LDMUOA=4)
   
   
    dneujj
         INTEGER JDNENA,JDNEE0,JDNETH,JDNEPH,JDNER1,JDNER2,JDNEPC,JDNEDE,
        +          LDNEUA
         PARAMETER(JDNENA=1,JDNEE0=2,JDNETH=3,JDNEPH=4,JDNER1=5,JDNER2=6,
        +          JDNEPC=7,JDNEDE=8,LDNEUA=8)
   
   
    dpobjj
         INTEGER JDPOE0,LDPOBA
         PARAMETER(JDPOE0=1,LDPOBA=1)
   
   
    dresjj
         INTEGER JDRENA,JDREE0,JDRETH,JDREPH,JDREP0,JDREPS,JDREPC,LDRESA
         PARAMETER(JDRENA=1,JDREE0=2,JDRETH=3,JDREPH=4,JDREP0=5,JDREPS=6,
        +          JDREPC=7,LDRESA=7)
   
   
    dtbpjj
         INTEGER JDTBT1,JDTBT2,JDTBL2,LDTBPA
         PARAMETER(JDTBT1=1,JDTBT2=2,JDTBL2=3,LDTBPA=3)
   
   
    dtmcjj
         INTEGER JDTMPX,JDTMPY,JDTMPZ,JDTMMA,JDTMPA,JDTMOV,JDTMEV,JDTMHC,
        +          LDTMCA
         PARAMETER(JDTMPX=1,JDTMPY=2,JDTMPZ=3,JDTMMA=4,JDTMPA=5,JDTMOV=6,
        +          JDTMEV=7,JDTMHC=8,LDTMCA=8)
   
   
    dtrajj
         INTEGER JDTRCH,JDTRP0,JDTRTH,JDTRPH,JDTRD0,JDTRZ0,JDTRER,JDTRTF,
        +          JDTRHO,JDTRHM,JDTRVB,JDTRQF,JDTREA,JDTRVI,LDTRAA
         PARAMETER(JDTRCH=1,JDTRP0=2,JDTRTH=3,JDTRPH=4,JDTRD0=5,JDTRZ0=6,
        +          JDTRER=7,JDTRTF=12,JDTRHO=13,JDTRHM=14,JDTRVB=15,
        +          JDTRQF=16,JDTREA=17,JDTRVI=27,LDTRAA=27)
   
   
    dverjj
         INTEGER JDVEX0,JDVEY0,JDVEZ0,JDVEFP,JDVEMV,JDVEDT,LDVERA
         PARAMETER(JDVEX0=1,JDVEY0=2,JDVEZ0=3,JDVEFP=4,JDVEMV=5,JDVEDT=6,
        +          LDVERA=6)
   
   
    dvmcjj
         INTEGER JDVMVX,JDVMVY,JDVMVZ,JDVMIP,JDVMVN,JDVMVM,LDVMCA
         PARAMETER(JDVMVX=1,JDVMVY=2,JDVMVZ=3,JDVMIP=4,JDVMVN=5,JDVMVM=6,
        +          LDVMCA=6)
   
   
    ecrqjj
         INTEGER JECRMA,JECRCS,LECRQA
         PARAMETER(JECRMA=1,JECRCS=2,LECRQA=2)
   
   
    ectejj
         INTEGER JECTCA,JECTCE,LECTEA
         PARAMETER(JECTCA=1,JECTCE=2,LECTEA=2)
   
   
    egidjj
         INTEGER JEGIIF,JEGIE1,JEGIE2,JEGIE3,JEGIE4,JEGIE5,JEGIE6,JEGIE7,
        +          JEGIE8,JEGINA,JEGICE,JEGITH,JEGIPH,JEGIPE,LEGIDA
         PARAMETER(JEGIIF=1,JEGIE1=2,JEGIE2=3,JEGIE3=4,JEGIE4=5,JEGIE5=6,
        +          JEGIE6=7,JEGIE7=8,JEGIE8=9,JEGINA=10,JEGICE=11,
        +          JEGITH=12,JEGIPH=13,JEGIPE=14,LEGIDA=14)
   
   
    ejetjj
         INTEGER JEJEPX,JEJEPY,JEJEPZ,JEJEPE,LEJETA
         PARAMETER(JEJEPX=1,JEJEPY=2,JEJEPZ=3,JEJEPE=4,LEJETA=4)
   
   
    errfjj
         INTEGER JERREF,JERRRO,JERRAC,JERRC1,JERRC2,JERRC3,JERRE1,JERRE2,
        +          JERRE3,JERRF1,JERRF2,LERRFA
         PARAMETER(JERREF=1,JERRRO=2,JERRAC=3,JERRC1=4,JERRC2=5,JERRC3=6,
        +          JERRE1=7,JERRE2=8,JERRE3=9,JERRF1=10,JERRF2=11,
        +          LERRFA=11)
   
   
    etdijj
         INTEGER JETDTL,JETDS1,JETDS2,JETDS3,LETDIA
         PARAMETER(JETDTL=1,JETDS1=2,JETDS2=3,JETDS3=4,LETDIA=4)
   
   
    etkcjj
         INTEGER JETKTL,JETKS1,JETKS2,JETKS3,JETKKR,LETKCA
         PARAMETER(JETKTL=1,JETKS1=2,JETKS2=3,JETKS3=4,JETKKR=5,LETKCA=5)
   
   
    evehjj
         INTEGER JEVEEN,JEVERN,JEVERT,JEVEDA,JEVETI,JEVEEV,JEVEM1,JEVEM2,
        +          JEVEM3,JEVEM4,JEVETY,JEVEES,JEVETE,LEVEHA
         PARAMETER(JEVEEN=1,JEVERN=2,JEVERT=3,JEVEDA=4,JEVETI=5,JEVEEV=6,
        +          JEVEM1=7,JEVEM2=8,JEVEM3=9,JEVEM4=10,JEVETY=11,
        +          JEVEES=12,JEVETE=13,LEVEHA=13)
   
   
    ewhejj
         INTEGER JEWHSD,JEWHNU,LEWHEA
         PARAMETER(JEWHSD=1,JEWHNU=2,LEWHEA=2)
   
   
    fkinjj
         INTEGER JFKIPX,JFKIPY,JFKIPZ,JFKIMA,JFKIPA,JFKIOV,JFKIEV,JFKIHC,
        +          LFKINA
         PARAMETER(JFKIPX=1,JFKIPY=2,JFKIPZ=3,JFKIMA=4,JFKIPA=5,JFKIOV=6,
        +          JFKIEV=7,JFKIHC=8,LFKINA=8)
   
   
    fpoijj
         INTEGER JFPOIP,JFPOIS,LFPOIA
         PARAMETER(JFPOIP=1,JFPOIS=2,LFPOIA=2)
   
   
    fpoljj
         INTEGER JFPOKI,JFPOHX,JFPOHY,JFPOHZ,LFPOLA
         PARAMETER(JFPOKI=1,JFPOHX=2,JFPOHY=3,JFPOHZ=4,LFPOLA=4)
   
   
    fverjj
         INTEGER JFVEVX,JFVEVY,JFVEVZ,JFVETO,JFVEIP,JFVEIS,JFVENS,JFVEVN,
        +          JFVEVM,LFVERA
         PARAMETER(JFVEVX=1,JFVEVY=2,JFVEVZ=3,JFVETO=4,JFVEIP=5,JFVEIS=6,
        +          JFVENS=7,JFVEVN=8,JFVEVM=9,LFVERA=9)
   
   
    fzfrjj
         INTEGER JFZFZF,LFZFRA
         PARAMETER(JFZFZF=1,LFZFRA=1)
   
   
    hccvjj
         INTEGER JHCCCC,LHCCVA
         PARAMETER(JHCCCC=1,LHCCVA=1)
   
   
    hctejj
         INTEGER JHCTCA,JHCTCE,LHCTEA
         PARAMETER(JHCTCA=1,JHCTCE=2,LHCTEA=2)
   
   
    hinfjj
         INTEGER JHINEI,LHINFA
         PARAMETER(JHINEI=1,LHINFA=1)
   
   
    hpdijj
         INTEGER JHPDPA,JHPDED,LHPDIA
         PARAMETER(JHPDPA=1,JHPDED=2,LHPDIA=2)
   
   
    hroajj
         INTEGER JHRODX,JHROSG,JHROSF,JHROHI,LHROAA
         PARAMETER(JHRODX=1,JHROSG=2,JHROSF=3,JHROHI=4,LHROAA=4)
   
   
    htubjj
         INTEGER JHTUSN,JHTUMN,JHTULN,JHTULC,JHTUCW,JHTUPR,JHTUPP,LHTUBA
         PARAMETER(JHTUSN=1,JHTUMN=2,JHTULN=3,JHTULC=4,JHTUCW=5,JHTUPR=6,
        +          JHTUPP=7,LHTUBA=7)
   
   
    iasljj
         INTEGER JIASFK,JIASNH,JIASCS,LIASLA
         PARAMETER(JIASFK=1,JIASNH=2,JIASCS=3,LIASLA=3)
   
   
    ipjtjj
         INTEGER JIPJNH,JIPJNS,JIPJRN,LIPJTA
         PARAMETER(JIPJNH=1,JIPJNS=2,JIPJRN=3,LIPJTA=3)
   
   
    irjtjj
         INTEGER JIRJGN,JIRJNH,JIRJSH,LIRJTA
         PARAMETER(JIRJGN=1,JIRJNH=2,JIRJSH=3,LIRJTA=3)
   
   
    itmajj
         INTEGER JITMNA,JITMOF,JITMNC,LITMAA
         PARAMETER(JITMNA=1,JITMOF=2,JITMNC=3,LITMAA=3)
   
   
    ixtrjj
         INTEGER JIXTTI,LIXTRA
         PARAMETER(JIXTTI=1,LIXTRA=1)
   
   
    izdbjj
         INTEGER JIZDTI,LIZDBA
         PARAMETER(JIZDTI=1,LIZDBA=1)
   
   
    jberjj
         INTEGER JJBECO,LJBERA
         PARAMETER(JJBECO=1,LJBERA=1)
   
   
    jestjj
         INTEGER JJESET,JJESON,JJESNN,JJESOL,JJESCL,JJESPN,JJESBP,LJESTA
         PARAMETER(JJESET=1,JJESON=2,JJESNN=3,JJESOL=4,JJESCL=5,JJESPN=6,
        +          JJESBP=7,LJESTA=7)
   
   
    jsumjj
         INTEGER JJSUNT,JJSUNV,JJSUNZ,JJSUNL,JJSUNB,JJSUVT,JJSUVV,JJSUVZ,
        +          JJSUVL,JJSUVB,JJSUTT,JJSUTZ,JJSUTB,JJSULI,JJSUIZ,JJSULO,
        +          JJSULZ,JJSUXV,JJSUYV,JJSUZV,JJSUXS,JJSUYS,JJSUZS,JJSUKB,
        +          JJSUKW,JJSUTN,JJSUTS,JJSUTV,JJSUA0,JJSUA1,JJSUA2,JJSUA3,
        +          JJSUA4,JJSUA5,JJSUA6,JJSUA7,JJSUA8,JJSUA9,JJSUB0,JJSUB1,
        +          JJSUB2,JJSUB3,JJSUB4,JJSUB5,JJSUB6,JJSUB7,JJSUB8,JJSUB9,
        +          JJSUDA,JJSUTI,LJSUMA
         PARAMETER(JJSUNT=1,JJSUNV=2,JJSUNZ=3,JJSUNL=4,JJSUNB=5,JJSUVT=6,
        +          JJSUVV=7,JJSUVZ=8,JJSUVL=9,JJSUVB=10,JJSUTT=11,
        +          JJSUTZ=12,JJSUTB=13,JJSULI=14,JJSUIZ=15,JJSULO=16,
        +          JJSULZ=17,JJSUXV=18,JJSUYV=19,JJSUZV=20,JJSUXS=21,
        +          JJSUYS=22,JJSUZS=23,JJSUKB=24,JJSUKW=25,JJSUTN=26,
        +          JJSUTS=27,JJSUTV=28,JJSUA0=29,JJSUA1=30,JJSUA2=31,
        +          JJSUA3=32,JJSUA4=33,JJSUA5=34,JJSUA6=35,JJSUA7=36,
        +          JJSUA8=37,JJSUA9=38,JJSUB0=39,JJSUB1=40,JJSUB2=41,
        +          JJSUB3=42,JJSUB4=43,JJSUB5=44,JJSUB6=45,JJSUB7=46,
        +          JJSUB8=47,JJSUB9=48,JJSUDA=49,JJSUTI=50,LJSUMA=50)
   
   
    kevhjj
         INTEGER JKEVRN,JKEVNT,JKEVNV,JKEVPI,JKEVWT,JKEVSR,JKEVTR,LKEVHA
         PARAMETER(JKEVRN=1,JKEVNT=2,JKEVNV=3,JKEVPI=4,JKEVWT=5,JKEVSR=6,
        +          JKEVTR=7,LKEVHA=7)
   
   
    kinejj
         INTEGER JKINPX,JKINPY,JKINPZ,JKINMA,JKINPN,JKINVN,LKINEA
         PARAMETER(JKINPX=1,JKINPY=2,JKINPZ=3,JKINMA=4,JKINPN=5,JKINVN=6,
        +          LKINEA=6)
   
   
    kjobjj
         INTEGER JKJOJD,JKJOJT,JKJOAV,JKJODV,JKJODC,LKJOBA
         PARAMETER(JKJOJD=1,JKJOJT=2,JKJOAV=3,JKJODV=4,JKJODC=5,LKJOBA=5)
   
   
    kpoljj
         INTEGER JKPOKI,JKPOHX,JKPOHY,JKPOHZ,LKPOLA
         PARAMETER(JKPOKI=1,JKPOHX=2,JKPOHY=3,JKPOHZ=4,LKPOLA=4)
   
   
    lidtjj
         INTEGER JLIDIF,JLIDEC,JLIDTC,JLIDPC,JLIDE4,JLIDE1,JLIDE2,JLIDR1,
        +          JLIDR2,JLIDXX,JLIDYY,JLIDXY,JLIDDA,JLIDNT,JLIDLO,JLIDLS,
        +          JLIDST,LLIDTA
         PARAMETER(JLIDIF=1,JLIDEC=2,JLIDTC=3,JLIDPC=4,JLIDE4=5,JLIDE1=6,
        +          JLIDE2=7,JLIDR1=8,JLIDR2=9,JLIDXX=10,JLIDYY=11,
        +          JLIDXY=12,JLIDDA=13,JLIDNT=17,JLIDLO=18,JLIDLS=19,
        +          JLIDST=20,LLIDTA=20)
   
   
    lolejj
         INTEGER JLOLFB,JLOLSP,JLOLTO,JLOLMA,JLOLHV,JLOLER,LLOLEA
         PARAMETER(JLOLFB=1,JLOLSP=5,JLOLTO=6,JLOLMA=7,JLOLHV=11,JLOLER=12,
        +          LLOLEA=12)
   
   
    lupajj
         INTEGER JLUPGB,JLUPHV,JLUPT1,JLUPL2,JLUPTE,JLUPLO,JLUPAM,JLUPMD,
        +          JLUPEF,JLUPEC,JLUPEW,JLUPXC,JLUPYC,JLUPTC,JLUPPC,JLUPAX,
        +          JLUPAY,JLUPXX,JLUPYY,JLUPXY,JLUPXA,JLUPYA,JLUPXD,JLUPYD,
        +          JLUPAD,JLUPIT,JLUPCT,JLUPTT,JLUPPT,JLUPXT,JLUPYT,JLUPE1,
        +          JLUPE2,JLUPXL,JLUPYL,JLUPAI,JLUPES,JLUPXS,JLUPYS,JLUPAS,
        +          LLUPAA
         PARAMETER(JLUPGB=1,JLUPHV=2,JLUPT1=3,JLUPL2=4,JLUPTE=5,JLUPLO=6,
        +          JLUPAM=7,JLUPMD=8,JLUPEF=9,JLUPEC=10,JLUPEW=12,
        +          JLUPXC=14,JLUPYC=16,JLUPTC=18,JLUPPC=20,JLUPAX=22,
        +          JLUPAY=24,JLUPXX=26,JLUPYY=28,JLUPXY=30,JLUPXA=32,
        +          JLUPYA=34,JLUPXD=36,JLUPYD=38,JLUPAD=40,JLUPIT=42,
        +          JLUPCT=44,JLUPTT=46,JLUPPT=48,JLUPXT=50,JLUPYT=52,
        +          JLUPE1=54,JLUPE2=56,JLUPXL=58,JLUPYL=60,JLUPAI=62,
        +          JLUPES=64,JLUPXS=66,JLUPYS=68,JLUPAS=70,LLUPAA=71)
   
   
    mhitjj
         INTEGER JMHISC,JMHISN,JMHILN,JMHIXL,JMHIYL,JMHIRH,JMHITH,JMHIPH,
        +          LMHITA
         PARAMETER(JMHISC=1,JMHISN=2,JMHILN=3,JMHIXL=4,JMHIYL=5,JMHIRH=6,
        +          JMHITH=7,JMHIPH=8,LMHITA=8)
   
   
    mthrjj
         INTEGER JMTHHN,JMTHDD,JMTHTN,LMTHRA
         PARAMETER(JMTHHN=1,JMTHDD=2,JMTHTN=3,LMTHRA=3)
   
   
    mudgjj
         INTEGER JMUDEA,LMUDGA
         PARAMETER(JMUDEA=1,LMUDGA=1)
   
   
    muexjj
         INTEGER JMUEXE,JMUEPE,JMUEC0,JMUEC1,JMUEC2,LMUEXA
         PARAMETER(JMUEXE=1,JMUEPE=4,JMUEC0=7,JMUEC1=8,JMUEC2=9,LMUEXA=9)
   
   
    nbipjj
         INTEGER JNBITF,JNBITS,LNBIPA
         PARAMETER(JNBITF=1,JNBITS=2,LNBIPA=2)
   
   
    ostsjj
         INTEGER JOSTEI,JOSTOR,JOSTEL,JOSTTN,JOSTTM,JOSTET,LOSTSA
         PARAMETER(JOSTEI=1,JOSTOR=2,JOSTEL=3,JOSTTN=4,JOSTTM=5,JOSTET=6,
        +          LOSTSA=6)
   
   
    partjj
         INTEGER JPARGN,JPARNA,JPARCO,JPARMA,JPARCH,JPARLT,JPARMW,JPARAN,
        +          LPARTA
         PARAMETER(JPARGN=1,JPARNA=2,JPARCO=5,JPARMA=6,JPARCH=7,JPARLT=8,
        +          JPARMW=9,JPARAN=10,LPARTA=10)
   
   
    pasljj
         INTEGER JPASFK,JPASNH,LPASLA
         PARAMETER(JPASFK=1,JPASNH=2,LPASLA=2)
   
   
    pchyjj
         INTEGER JPCHBH,JPCHKT,JPCHPC,LPCHYA
         PARAMETER(JPCHBH=1,JPCHKT=2,JPCHPC=3,LPCHYA=3)
   
   
    pcobjj
         INTEGER LPCOBA
         PARAMETER(LPCOBA=0)
   
   
    pcoijj
         INTEGER JPCONP,JPCOPH,JPCOTF,JPCONH,JPCOPL,LPCOIA
         PARAMETER(JPCONP=1,JPCOPH=2,JPCOTF=3,JPCONH=4,JPCOPL=5,LPCOIA=5)
   
   
    pcpajj
         INTEGER JPCPNA,JPCPEN,JPCPTE,JPCPFI,JPCPR1,JPCPR2,JPCPPC,LPCPAA
         PARAMETER(JPCPNA=1,JPCPEN=2,JPCPTE=3,JPCPFI=4,JPCPR1=5,JPCPR2=6,
        +          JPCPPC=7,LPCPAA=7)
   
   
    pcrljj
         INTEGER JPCRPC,JPCRPE,JPCRPF,JPCRPH,JPCRPP,LPCRLA
         PARAMETER(JPCRPC=1,JPCRPE=2,JPCRPF=3,JPCRPH=4,JPCRPP=5,LPCRLA=5)
   
   
    pehyjj
         INTEGER JPEHBH,JPEHKT,JPEHPE,LPEHYA
         PARAMETER(JPEHBH=1,JPEHKT=2,JPEHPE=3,LPEHYA=3)
   
   
    peidjj
         INTEGER JPEIIF,JPEIR1,JPEIR2,JPEIR3,JPEIR4,JPEIR6,JPEIR7,JPEIEC,
        +          JPEIET,JPEIP1,JPEIP2,JPEIPF,LPEIDA
         PARAMETER(JPEIIF=1,JPEIR1=2,JPEIR2=3,JPEIR3=4,JPEIR4=5,JPEIR6=6,
        +          JPEIR7=7,JPEIEC=8,JPEIET=9,JPEIP1=10,JPEIP2=11,
        +          JPEIPF=12,LPEIDA=12)
   
   
    pemhjj
         INTEGER JPEMCO,JPEMTN,JPEMSE,LPEMHA
         PARAMETER(JPEMCO=1,JPEMTN=2,JPEMSE=3,LPEMHA=3)
   
   
    pestjj
         INTEGER JPESKS,JPESER,JPESED,JPESET,JPESPE,LPESTA
         PARAMETER(JPESKS=1,JPESER=2,JPESED=3,JPESET=4,JPESPE=5,LPESTA=5)
   
   
    pewijj
         INTEGER JPEWMN,JPEWPD,JPEWSS,JPEWTI,LPEWIA
         PARAMETER(JPEWMN=1,JPEWPD=2,JPEWSS=47,JPEWTI=55,LPEWIA=55)
   
   
    pferjj
         INTEGER JPFEPE,JPFEPF,LPFERA
         PARAMETER(JPFEPE=1,JPFEPF=2,LPFERA=2)
   
   
    pfhrjj
         INTEGER JPFHPF,JPFHPH,LPFHRA
         PARAMETER(JPFHPF=1,JPFHPH=2,LPFHRA=2)
   
   
    pfrfjj
         INTEGER JPFRIR,JPFRTL,JPFRP0,JPFRD0,JPFRZ0,JPFRAL,JPFREO,JPFREM,
        +          JPFRC2,JPFRNO,LPFRFA
         PARAMETER(JPFRIR=1,JPFRTL=2,JPFRP0=3,JPFRD0=4,JPFRZ0=5,JPFRAL=6,
        +          JPFREO=7,JPFREM=13,JPFRC2=28,JPFRNO=29,LPFRFA=29)
   
   
    pfrtjj
         INTEGER JPFRNV,JPFRNI,JPFRNE,JPFRNT,JPFRNR,LPFRTA
         PARAMETER(JPFRNV=1,JPFRNI=2,JPFRNE=3,JPFRNT=4,JPFRNR=5,LPFRTA=5)
   
   
    pgidjj
         INTEGER JPGIIF,JPGIDE,JPGICM,JPGIM1,JPGIM2,JPGIM3,JPGICE,JPGITH,
        +          JPGIPH,JPGIPE,LPGIDA
         PARAMETER(JPGIIF=1,JPGIDE=2,JPGICM=3,JPGIM1=4,JPGIM2=5,JPGIM3=6,
        +          JPGICE=7,JPGITH=8,JPGIPH=9,JPGIPE=10,LPGIDA=10)
   
   
    pherjj
         INTEGER JPHEPE,JPHEPH,LPHERA
         PARAMETER(JPHEPE=1,JPHEPH=2,LPHERA=2)
   
   
    phhyjj
         INTEGER JPHHBH,JPHHKT,JPHHPH,LPHHYA
         PARAMETER(JPHHBH=1,JPHHKT=2,JPHHPH=3,LPHHYA=3)
   
   
    phmhjj
         INTEGER JPHMCO,JPHMTN,LPHMHA
         PARAMETER(JPHMCO=1,JPHMTN=2,LPHMHA=2)
   
   
    phstjj
         INTEGER JPHSTI,JPHSPI,JPHSCE,JPHSPH,LPHSTA
         PARAMETER(JPHSTI=1,JPHSPI=2,JPHSCE=3,JPHSPH=4,LPHSTA=4)
   
   
    pidijj
         INTEGER JPIDPD,LPIDIA
         PARAMETER(JPIDPD=1,LPIDIA=1)
   
   
    pitmjj
         INTEGER JPITNA,LPITMA
         PARAMETER(JPITNA=1,LPITMA=1)
   
   
    plidjj
         INTEGER JPLIIF,JPLIEC,JPLITC,JPLIPC,JPLIE4,JPLIE1,JPLIE2,JPLIR1,
        +          JPLIR2,JPLIXX,JPLIYY,JPLIXY,JPLIDA,JPLINT,JPLIPE,JPLIPL,
        +          JPLIST,LPLIDA
         PARAMETER(JPLIIF=1,JPLIEC=2,JPLITC=3,JPLIPC=4,JPLIE4=5,JPLIE1=6,
        +          JPLIE2=7,JPLIR1=8,JPLIR2=9,JPLIXX=10,JPLIYY=11,
        +          JPLIXY=12,JPLIDA=13,JPLINT=17,JPLIPE=18,JPLIPL=19,
        +          JPLIST=20,LPLIDA=20)
   
   
    pljtjj
         INTEGER JPLJPX,JPLJPY,JPLJPZ,JPLJPE,JPLJNO,LPLJTA
         PARAMETER(JPLJPX=1,JPLJPY=2,JPLJPZ=3,JPLJPE=4,JPLJNO=5,LPLJTA=5)
   
   
    plpdjj
         INTEGER JPLPAD,JPLPEN,LPLPDA
         PARAMETER(JPLPAD=1,JPLPEN=2,LPLPDA=2)
   
   
    plsdjj
         INTEGER JPLSAD,JPLSE1,JPLSE2,JPLSE3,JPLSPE,LPLSDA
         PARAMETER(JPLSAD=1,JPLSE1=2,JPLSE2=3,JPLSE3=4,JPLSPE=5,LPLSDA=5)
   
   
    pmscjj
         INTEGER JPMSSA,LPMSCA
         PARAMETER(JPMSSA=1,LPMSCA=1)
   
   
    pmskjj
         INTEGER JPMSKT,JPMSEM,JPMSF1,JPMSF3,JPMST1,JPMSP1,JPMST3,JPMSP3,
        +          JPMSTH,JPMSPH,JPMSPF,LPMSKA
         PARAMETER(JPMSKT=1,JPMSEM=2,JPMSF1=3,JPMSF3=4,JPMST1=5,JPMSP1=6,
        +          JPMST3=7,JPMSP3=8,JPMSTH=9,JPMSPH=10,JPMSPF=11,
        +          LPMSKA=11)
   
   
    pneujj
         INTEGER JPNEPX,JPNEPY,JPNEPZ,JPNEPM,JPNEMS,JPNEEM,LPNEUA
         PARAMETER(JPNEPX=1,JPNEPY=2,JPNEPZ=3,JPNEPM=4,JPNEMS=10,JPNEEM=11,
        +          LPNEUA=11)
   
   
    ppdsjj
         INTEGER JPPDNL,JPPDFL,JPPDMD,JPPDPP,LPPDSA
         PARAMETER(JPPDNL=1,JPPDFL=2,JPPDMD=3,JPPDPP=4,LPPDSA=4)
   
   
    ppobjj
         INTEGER JPPODI,JPPODE,JPPOC1,JPPOC2,JPPOIP,JPPOFP,JPPOLP,JPPOMD,
        +          JPPOPD,LPPOBA
         PARAMETER(JPPODI=1,JPPODE=2,JPPOC1=3,JPPOC2=4,JPPOIP=5,JPPOFP=6,
        +          JPPOLP=7,JPPOMD=8,JPPOPD=9,LPPOBA=9)
   
   
    pprljj
         INTEGER JPPRPC,JPPRPE,JPPRPH,JPPRPP,LPPRLA
         PARAMETER(JPPRPC=1,JPPRPE=2,JPPRPH=3,JPPRPP=4,LPPRLA=4)
   
   
    prpwjj
         INTEGER JPRPPN,JPRPMR,JPRPMN,JPRPF1,JPRPF2,JPRPER,LPRPWA
         PARAMETER(JPRPPN=1,JPRPMR=2,JPRPMN=3,JPRPF1=4,JPRPF2=5,JPRPER=6,
        +          LPRPWA=6)
   
   
    prtmjj
         INTEGER JPRTMA,JPRTCT,LPRTMA
         PARAMETER(JPRTMA=1,JPRTCT=2,LPRTMA=2)
   
   
    pscojj
         INTEGER JPSCSI,JPSCLA,JPSCSC,JPSCTT,LPSCOA
         PARAMETER(JPSCSI=1,JPSCLA=2,JPSCSC=3,JPSCTT=4,LPSCOA=5)
   
   
    pspojj
         INTEGER JPSPTC,LPSPOA
         PARAMETER(JPSPTC=1,LPSPOA=9)
   
   
    pt2xjj
         INTEGER JPT2SL,JPT2TM,JPT2UL,JPT2NS,JPT2AD,JPT2T1,JPT2T2,LPT2XA
         PARAMETER(JPT2SL=1,JPT2TM=2,JPT2UL=3,JPT2NS=4,JPT2AD=5,JPT2T1=6,
        +          JPT2T2=7,LPT2XA=7)
   
   
    ptbcjj
         INTEGER JPTBSL,JPTBSR,JPTBPS,JPTBZV,JPTBNP,JPTBNB,LPTBCA
         PARAMETER(JPTBSL=1,JPTBSR=2,JPTBPS=3,JPTBZV=4,JPTBNP=5,JPTBNB=6,
        +          LPTBCA=6)
   
   
    ptcojj
         INTEGER JPTCSL,JPTCSR,JPTCPS,JPTCZV,JPTCSP,JPTCSZ,JPTCDR,LPTCOA
         PARAMETER(JPTCSL=1,JPTCSR=2,JPTCPS=3,JPTCZV=4,JPTCSP=5,JPTCSZ=6,
        +          JPTCDR=7,LPTCOA=7)
   
   
    ptexjj
         INTEGER JPTESL,JPTETM,JPTEUL,JPTENS,JPTEAD,JPTETN,JPTESF,LPTEXA
         PARAMETER(JPTESL=1,JPTETM=2,JPTEUL=3,JPTENS=4,JPTEAD=5,JPTETN=6,
        +          JPTESF=7,LPTEXA=7)
   
   
    pthrjj
         INTEGER JPTHTH,JPTHPX,JPTHPY,JPTHPZ,JPTHPE,LPTHRA
         PARAMETER(JPTHTH=1,JPTHPX=2,JPTHPY=3,JPTHPZ=4,JPTHPE=5,LPTHRA=5)
   
   
    ptmajj
         INTEGER JPTMNM,JPTMNA,LPTMAA
         PARAMETER(JPTMNM=1,JPTMNA=2,LPTMAA=2)
   
   
    ptmljj
         INTEGER JPTMMT,JPTMNH,LPTMLA
         PARAMETER(JPTMMT=1,JPTMNH=2,LPTMLA=2)
   
   
    ptncjj
         INTEGER JPTNSL,JPTNSR,JPTNRP,JPTNZV,JPTNSP,JPTNSZ,LPTNCA
         PARAMETER(JPTNSL=1,JPTNSR=2,JPTNRP=3,JPTNZV=4,JPTNSP=5,JPTNSZ=6,
        +          LPTNCA=6)
   
   
    ptstjj
         INTEGER JPTSSP,JPTSTW,JPTSTP,JPTSNT,JPTSTE,LPTSTA
         PARAMETER(JPTSSP=1,JPTSTW=2,JPTSTP=3,JPTSNT=4,JPTSTE=5,LPTSTA=5)
   
   
    pyerjj
         INTEGER JPYETY,JPYEVX,JPYEVY,JPYEVZ,JPYEVM,JPYEC2,JPYEDF,LPYERA
         PARAMETER(JPYETY=1,JPYEVX=2,JPYEVY=3,JPYEVZ=4,JPYEVM=5,JPYEC2=11,
        +          JPYEDF=12,LPYERA=12)
   
   
    pyfrjj
         INTEGER JPYFTN,JPYFVN,LPYFRA
         PARAMETER(JPYFTN=1,JPYFVN=2,LPYFRA=2)
   
   
    pynejj
         INTEGER JPYNTN,JPYNVN,LPYNEA
         PARAMETER(JPYNTN=1,JPYNVN=2,LPYNEA=2)
   
   
    revhjj
         INTEGER JREVDS,JREVFE,JREVNE,JREVSB,JREVTI,JREVRB,JREVEC,LREVHA
         PARAMETER(JREVDS=1,JREVFE=2,JREVNE=4,JREVSB=6,JREVTI=7,JREVRB=8,
        +          JREVEC=10,LREVHA=10)
   
   
    rhahjj
         INTEGER JRHAPN,JRHAPD,JRHAPH,JRHAPV,JRHAAV,JRHADV,JRHADD,JRHANI,
        +          JRHANO,JRHACV,JRHANU,LRHAHA
         PARAMETER(JRHAPN=1,JRHAPD=3,JRHAPH=4,JRHAPV=5,JRHAAV=6,JRHADV=7,
        +          JRHADD=8,JRHANI=9,JRHANO=10,JRHACV=11,JRHANU=12,
        +          LRHAHA=12)
   
   
    rtlojj
         INTEGER JRTLPA,JRTLET,JRTLTN,JRTLTM,JRTLT1,JRTLT2,JRTLT3,JRTLR1,
        +          JRTLR2,JRTLEL,JRTLCT,JRTLCH,LRTLOA
         PARAMETER(JRTLPA=1,JRTLET=2,JRTLTN=3,JRTLTM=4,JRTLT1=5,JRTLT2=6,
        +          JRTLT3=7,JRTLR1=8,JRTLR2=9,JRTLEL=10,JRTLCT=11,
        +          JRTLCH=12,LRTLOA=12)
   
   
    runhjj
         INTEGER JRUNEN,JRUNRN,JRUNRT,JRUNSD,JRUNST,JRUNTT,JRUNRC,LRUNHA
         PARAMETER(JRUNEN=1,JRUNRN=2,JRUNRT=3,JRUNSD=4,JRUNST=5,JRUNTT=6,
        +          JRUNRC=8,LRUNHA=9)
   
   
    sftrjj
         INTEGER JSFTNF,JSFTC2,JSFTQF,JSFTTH,JSFTPH,JSFTX0,JSFTY0,JSFTCM,
        +          JSFTLI,LSFTRA
         PARAMETER(JSFTNF=1,JSFTC2=2,JSFTQF=3,JSFTTH=4,JSFTPH=5,JSFTX0=6,
        +          JSFTY0=7,JSFTCM=8,JSFTLI=18,LSFTRA=18)
   
   
    tc2xjj
         INTEGER JTC2ID,JTC2VR,JTC2NR,JTC2SN,JTC2AP,JTC2RP,JTC2SL,LTC2XA
         PARAMETER(JTC2ID=1,JTC2VR=2,JTC2NR=4,JTC2SN=5,JTC2AP=41,JTC2RP=42,
        +          JTC2SL=46,LTC2XA=46)
   
   
    tc3xjj
         INTEGER JTC3ID,JTC3VR,JTC3NR,JTC3PR,LTC3XA
         PARAMETER(JTC3ID=1,JTC3VR=2,JTC3NR=4,JTC3PR=5,LTC3XA=11)
   
   
    tc4xjj
         INTEGER JTC4ID,JTC4VR,JTC4MN,JTC4MX,JTC4RP,JTC4IP,LTC4XA
         PARAMETER(JTC4ID=1,JTC4VR=2,JTC4MN=4,JTC4MX=5,JTC4RP=6,JTC4IP=13,
        +          LTC4XA=22)
   
   
    tgmajj
         INTEGER JTGMNM,JTGMOM,JTGMNC,JTGMNA,LTGMAA
         PARAMETER(JTGMNM=1,JTGMOM=2,JTGMNC=3,JTGMNA=4,LTGMAA=4)
   
   
    tmtljj
         INTEGER JTMTMT,JTMTNH,JTMTCS,LTMTLA
         PARAMETER(JTMTMT=1,JTMTNH=2,JTMTCS=3,LTMTLA=3)
   
   
    vcomjj
         INTEGER JVCOCM,LVCOMA
         PARAMETER(JVCOCM=1,LVCOMA=1)
   
   
    vcpljj
         INTEGER JVCPXB,JVCPNX,JVCPZB,JVCPNZ,JVCPC2,LVCPLA
         PARAMETER(JVCPXB=1,JVCPNX=2,JVCPZB=3,JVCPNZ=4,JVCPC2=5,LVCPLA=5)
   
   
    vdcojj
         INTEGER JVDCWI,JVDCR0,JVDCPH,JVDCZ0,JVDCSR,JVDCSZ,JVDCQF,JVDCTN,
        +          LVDCOA
         PARAMETER(JVDCWI=1,JVDCR0=2,JVDCPH=3,JVDCZ0=4,JVDCSR=5,JVDCSZ=6,
        +          JVDCQF=7,JVDCTN=8,LVDCOA=8)
   
   
    vdhtjj
         INTEGER JVDHTN,JVDHLN,JVDHPN,JVDHXE,JVDHYE,JVDHZE,JVDHXL,JVDHYL,
        +          JVDHZL,JVDHER,LVDHTA
         PARAMETER(JVDHTN=1,JVDHLN=2,JVDHPN=3,JVDHXE=4,JVDHYE=5,JVDHZE=6,
        +          JVDHXL=7,JVDHYL=8,JVDHZL=9,JVDHER=10,LVDHTA=10)
   
   
    vdxyjj
         INTEGER JVDXXC,JVDXYC,JVDXUC,JVDXSX,JVDXSY,JVDXSU,JVDXPH,JVDXQF,
        +          JVDXNA,JVDXIP,JVDXIW,JVDXIH,LVDXYA
         PARAMETER(JVDXXC=1,JVDXYC=2,JVDXUC=3,JVDXSX=4,JVDXSY=5,JVDXSU=6,
        +          JVDXPH=7,JVDXQF=8,JVDXNA=9,JVDXIP=10,JVDXIW=11,
        +          JVDXIH=12,LVDXYA=12)
   
   
    vdztjj
         INTEGER JVDZZC,JVDZWC,JVDZSZ,JVDZSW,JVDZPH,JVDZQF,JVDZNA,JVDZIP,
        +          JVDZIW,JVDZIH,LVDZTA
         PARAMETER(JVDZZC=1,JVDZWC=2,JVDZSZ=3,JVDZSW=4,JVDZPH=5,JVDZQF=6,
        +          JVDZNA=7,JVDZIP=8,JVDZIW=9,JVDZIH=10,LVDZTA=10)
   
   
    vertjj
         INTEGER JVERVX,JVERVY,JVERVZ,JVERTI,JVERIT,JVEROT,LVERTA
         PARAMETER(JVERVX=1,JVERVY=2,JVERVZ=3,JVERTI=4,JVERIT=5,JVEROT=6,
        +          LVERTA=6)
   
   
    vfhljj
         INTEGER JVFHHA,LVFHLA
         PARAMETER(JVFHHA=1,LVFHLA=1)
   
   
    vflgjj
         INTEGER JVFLFG,LVFLGA
         PARAMETER(JVFLFG=1,LVFLGA=1)
   
   
    vfphjj
         INTEGER JVFPPH,LVFPHA
         PARAMETER(JVFPPH=1,LVFPHA=1)
   
   
    vhlsjj
         INTEGER JVHLHC,LVHLSA
         PARAMETER(JVHLHC=1,LVHLSA=1)
   
   
    vplhjj
         INTEGER JVPLPC,LVPLHA
         PARAMETER(JVPLPC=1,LVPLHA=1)
   
   
    x1adjj
         INTEGER JX1AIT,JX1AAV,LX1ADA
         PARAMETER(JX1AIT=1,JX1AAV=2,LX1ADA=37)
   
   
    x1scjj
         INTEGER JX1SIT,JX1STS,JX1SSV,LX1SCA
         PARAMETER(JX1SIT=1,JX1STS=2,JX1SSV=3,LX1SCA=32)
   
   
    x2dfjj
         INTEGER JX2DDA,LX2DFA
         PARAMETER(JX2DDA=1,LX2DFA=1)
   
   
    x3ecjj
         INTEGER JX3EEL,JX3EEH,JX3ESL,JX3ESH,JX3ECL,JX3ELX,JX3ELY,JX3ELZ,
        +          JX3ECH,JX3EHX,JX3EHY,JX3EHZ,LX3ECA
         PARAMETER(JX3EEL=1,JX3EEH=2,JX3ESL=3,JX3ESH=6,JX3ECL=9,JX3ELX=12,
        +          JX3ELY=15,JX3ELZ=18,JX3ECH=21,JX3EHX=24,JX3EHY=27,
        +          JX3EHZ=30,LX3ECA=32)
   
   
    x3ewjj
         INTEGER JX3EES,JX3EEO,JX3EEE,JX3EEC,JX3EMP,JX3EFP,LX3EWA
         PARAMETER(JX3EES=1,JX3EEO=4,JX3EEE=5,JX3EEC=6,JX3EMP=7,JX3EFP=8,
        +          LX3EWA=8)
   
   
    x3hcjj
         INTEGER JX3HNT,JX3HTT,JX3HEC,JX3HET,JX3HEF,JX3HEB,JX3HTC,JX3HTF,
        +          JX3HTB,JX3HPC,JX3HPF,JX3HPB,JX3HFT,LX3HCA
         PARAMETER(JX3HNT=1,JX3HTT=2,JX3HEC=3,JX3HET=4,JX3HEF=5,JX3HEB=6,
        +          JX3HTC=7,JX3HTF=8,JX3HTB=9,JX3HPC=10,JX3HPF=11,
        +          JX3HPB=12,JX3HFT=13,LX3HCA=13)
   
   
    x3itjj
         INTEGER JX3IMN,JX3ITB,JX3IEL,JX3ICH,JX3IDF,JX3IRA,JX3IX0,JX3IY0,
        +          JX3ID0,JX3IRT,JX3IPT,JX3IAT,JX3IDP,LX3ITA
         PARAMETER(JX3IMN=1,JX3ITB=2,JX3IEL=3,JX3ICH=4,JX3IDF=5,JX3IRA=6,
        +          JX3IX0=7,JX3IY0=8,JX3ID0=9,JX3IRT=10,JX3IPT=11,
        +          JX3IAT=12,JX3IDP=13,LX3ITA=13)
   
   
    x3l2jj
         INTEGER JX3LZ0,JX3LTL,JX3LEV,JX3LCH,JX3LNF,LX3L2A
         PARAMETER(JX3LZ0=1,JX3LTL=2,JX3LEV=3,JX3LCH=6,JX3LNF=7,LX3L2A=7)
   
   
    x3lujj
         INTEGER JX3LMN,JX3LEC,JX3LTC,JX3LPC,JX3LCW,JX3LNT,JX3LEF,JX3LEM,
        +          JX3LEB,JX3LRE,LX3LUA
         PARAMETER(JX3LMN=1,JX3LEC=2,JX3LTC=3,JX3LPC=4,JX3LCW=5,JX3LNT=6,
        +          JX3LEF=7,JX3LEM=8,JX3LEB=9,JX3LRE=10,LX3LUA=10)
   
   
    x3tmjj
         INTEGER JX3TTS,JX3TTT,LX3TMA
         PARAMETER(JX3TTS=1,JX3TTT=2,LX3TMA=33)
   
   
    x3tojj
         INTEGER JX3TH1,JX3TH2,JX3TH3,JX3TH4,JX3TH5,JX3TH6,JX3TE1,JX3TE2,
        +          JX3TE3,JX3TE4,JX3TE5,JX3TE6,JX3TE7,JX3TE8,JX3TW1,JX3TW2,
        +          JX3TW3,JX3TW4,JX3TW5,JX3TW6,JX3TL1,JX3TL2,JX3TL3,JX3TL4,
        +          JX3TL5,JX3TL6,JX3TL7,JX3TL8,LX3TOA
         PARAMETER(JX3TH1=1,JX3TH2=4,JX3TH3=7,JX3TH4=10,JX3TH5=13,
        +          JX3TH6=16,JX3TE1=19,JX3TE2=22,JX3TE3=25,JX3TE4=28,
        +          JX3TE5=31,JX3TE6=34,JX3TE7=37,JX3TE8=40,JX3TW1=43,
        +          JX3TW2=46,JX3TW3=49,JX3TW4=52,JX3TW5=55,JX3TW6=58,
        +          JX3TL1=61,JX3TL2=63,JX3TL3=65,JX3TL4=67,JX3TL5=69,
        +          JX3TL6=71,JX3TL7=73,JX3TL8=75,LX3TOA=76)
   
   
    x3tpjj
         INTEGER JX3TTB,JX3TEL,JX3TNH,JX3TBL,JX3TIR,JX3TOR,JX3TPR,JX3TPI,
        +          JX3TTI,JX3TZI,JX3TPO,JX3TTO,JX3TZO,JX3TAT,LX3TPA
         PARAMETER(JX3TTB=1,JX3TEL=2,JX3TNH=3,JX3TBL=4,JX3TIR=5,JX3TOR=6,
        +          JX3TPR=7,JX3TPI=8,JX3TTI=9,JX3TZI=10,JX3TPO=11,
        +          JX3TTO=12,JX3TZO=13,JX3TAT=14,LX3TPA=14)
   
   
    x3x3jj
         INTEGER JX3XTR,JX3XST,JX3XFT,LX3X3A
         PARAMETER(JX3XTR=1,JX3XST=2,JX3XFT=3,LX3X3A=3)
   
   
    xtcnjj
         INTEGER JXTCTT,JXTCGC,JXTCLL,JXTCBN,JXTCCL,JXTCTR,LXTCNA
         PARAMETER(JXTCTT=1,JXTCGC=3,JXTCLL=4,JXTCBN=5,JXTCCL=6,JXTCTR=7,
        +          LXTCNA=16)
   
   
    xtebjj
         INTEGER JXTET1,JXTET2,JXTEL2,JXTEHT,JXTEHW,JXTELW,JXTEEW,JXTELT,
        +          JXTETE,JXTEIT,JXTETP,LXTEBA
         PARAMETER(JXTET1=1,JXTET2=2,JXTEL2=3,JXTEHT=4,JXTEHW=16,JXTELW=28,
        +          JXTEEW=40,JXTELT=52,JXTETE=56,JXTEIT=58,JXTETP=62,
        +          LXTEBA=65)
   
   
    xtbnjj
         INTEGER JXTBID,JXTBVR,JXTBTN,JXTBTB,JXTBBM,JXTBBN,JXTBAD,JXTBL1,
        +          JXTBL2,LXTBNA
         PARAMETER(JXTBID=1,JXTBVR=2,JXTBTN=4,JXTBTB=5,JXTBBM=6,JXTBBN=8,
        +          JXTBAD=18,JXTBL1=23,JXTBL2=24,LXTBNA=24)
   
   
    xtopjj
         INTEGER JXTOID,JXTOVR,JXTONA,JXTOTR,JXTOGS,JXTODS,JXTOTT,LXTOPA
         PARAMETER(JXTOID=1,JXTOVR=2,JXTONA=4,JXTOTR=6,JXTOGS=7,JXTODS=8,
        +          JXTOTT=16,LXTOPA=16)
   
   
    xtrbjj
         INTEGER JXTRRP,JXTRRN,LXTRBA
         PARAMETER(JXTRRP=1,JXTRRN=4,LXTRBA=4)
   
   
    zpfrjj
         INTEGER JZPFC1,JZPFC2,LZPFRA
         PARAMETER(JZPFC1=1,JZPFC2=2,LZPFRA=2)
   
   
         INTEGER IECAL,IPECO,KPCRL
         INTEGER ICOB
   
   -------------------- /QMACRO/ --- statement functions ----------------
   
    bmacro
       set of intrinsic functions to handle BOS banks
   - # of words/row in bank with index ID
         LCOLS(ID) = IW(ID+1)
   - # of rows in bank with index ID
         LROWS(ID) = IW(ID+2)
   - index of next row in the bank with index ID
         KNEXT(ID) = ID + LMHLEN + IW(ID+1)*IW(ID+2)
   - index of row # NRBOS in the bank with index ID
         KROW(ID,NRBOS) = ID + LMHLEN + IW(ID+1)*(NRBOS-1)
   - # of free words in the bank with index ID
         LFRWRD(ID) = ID + IW(ID) - KNEXT(ID)
   - # of free rows in the bank with index ID
         LFRROW(ID) = LFRWRD(ID) / LCOLS(ID)
   - Lth integer element of the NRBOSth row of the bank with index ID
         ITABL(ID,NRBOS,L) = IW(ID+LMHLEN+(NRBOS-1)*IW(ID+1)+L)
   - Lth real element of the NRBOSth row of the bank with index ID
         RTABL(ID,NRBOS,L) = RW(ID+LMHLEN+(NRBOS-1)*IW(ID+1)+L)
   
   -------------------- /QCFUNC/ --- statement functions for ALPHA banks
         KJQDET(KI)=IW(KOQVEC+KI*KCQVEC+JQVEQD)
         QSQT(QF)=SIGN(SQRT(ABS(QF)),QF)
         QP(KI)=RW(KOQVEC+KI*KCQVEC+JQVEQP)
         QX(KI)=RW(KOQVEC+KI*KCQVEC+JQVEQX)
         QY(KI)=RW(KOQVEC+KI*KCQVEC+JQVEQY)
         QZ(KI)=RW(KOQVEC+KI*KCQVEC+JQVEQZ)
         QE(KI)=RW(KOQVEC+KI*KCQVEC+JQVEQE)
         QM(KI)=RW(KOQVEC+KI*KCQVEC+JQVEQM)
         QCH(KI)=RW(KOQVEC+KI*KCQVEC+JQVECH)
         KCH(KI)=NINT (QCH(KI))
         QCT(KI)=QZ(KI)/QP(KI)
         QDB(KI)=RW(KOQVEC+KI*KCQVEC+JQVEDB)
         QZB(KI)=RW(KOQVEC+KI*KCQVEC+JQVEZB)
         QDBS2(KI)=RW(KOQVEC+KI*KCQVEC+JQVESD)
         QZBS2(KI)=RW(KOQVEC+KI*KCQVEC+JQVESZ)
         QBC2(KI)=RW(KOQVEC+KI*KCQVEC+JQVECB)
         QSIG(KI,KI1,KI2)=RW(KOQVEC+KI*KCQVEC+KMATIX(KI1,KI2)+JQVEEM)
         XSIG(KI)=RW(KOQVEC+KI*KCQVEC+JQVEEM).GE.0.
         QSMAT(KI,KI1)=RW(KOQVEC+KI*KCQVEC+KI1+JQVEEM)
         QSIGX(KI)=QSQT(QSMAT(KI,0))
         QSIGY(KI)=QSQT(QSMAT(KI,2))
         QSIGZ(KI)=QSQT(QSMAT(KI,5))
         QSIGEE(KI)=RW(KOQVEC+KI*KCQVEC+JQVEEM+9)
         QSIGE(KI)=QSQT(QSIGEE(KI))
         QSIGPP(KI)=(QX(KI)**2*QSMAT(KI,0)+QY(KI)**2*QSMAT(KI,2)+
        & QZ(KI)**2*QSMAT(KI,5)+2.*(QX(KI)*(QY(KI)*QSMAT(KI,1)+
        & QZ(KI)*QSMAT(KI,3))+QY(KI)*QZ(KI)*QSMAT(KI,4)))/QP(KI)**2
         QSIGP(KI)=QSQT(QSIGPP(KI))
         QSIGMM(KI)=QM(KI)*(QE(KI)**2*QSMAT(KI,9)+QX(KI)**2*QSMAT(KI,0)+
        & QY(KI)**2*QSMAT(KI,2)+QZ(KI)**2*QSMAT(KI,5)+2.*(QX(KI)*(QY(KI)
        & QSMAT(KI,1)+QZ(KI)*QSMAT(KI,3))+QY(KI)*QZ(KI)*QSMAT(KI,4)-
        & QE(KI)*(QX(KI)*QSMAT(KI,6)+QY(KI)*QSMAT(KI,7)+
        & QZ(KI)*QSMAT(KI,8))))/AMAX1(QM(KI)**3,1.E-16)
         QSIGM(KI)=QSQT(QSIGMM(KI))
         QMCHIF(KI)=RW(KOQVEC+KI*KCQVEC+JQVECF)
         QPH(KI)=ATG(QY(KI),QX(KI))
         QPT(KI)=SQRT(QX(KI)**2+QY(KI)**2)
         KTN(KI)=IW(KOQVEC+KI*KCQVEC+JQVETN)
         KMC(KI)=KCLARM(IW(KOQVEC+KI*KCQVEC+JQVECL))
         KBMASK(KI,KI1)=IW(KOQVEC+KI*KCQVEC+KI1+JQVEBM-1)
         KCALFL(KI)=IW(KJQDET(KI)+JQDECF)
         KCHGD(KI,KI1)=IW(KOQLIN+KI1+IW(KJQDET(KI)+JQDEFL))
         KCLASS(KI)=KCLACO(IW(KOQVEC+KI*KCQVEC+JQVECL))
         KDAU(KI,KI1)=IW(KOQLIN+KI1+IW(KOQVEC+KI*KCQVEC+JQVEDL))
         KECAL(KI,KI1)=IW(KOQLIN+KI1+IW(KJQDET(KI)+JQDEEL))
         KENDV(KI)=IW(KOQVEC+KI*KCQVEC+JQVEEV)
         KFOLLO(KI)=IW(KOQVEC+KI*KCQVEC+JQVENP)
         KHCAL(KI,KI1)=IW(KOQLIN+KI1+IW(KJQDET(KI)+JQDEHL))
         KLUNDS(KI)=IW(KOQVEC+KI*KCQVEC+JQVEKS)
         KNCHGD(KI)=IW(KJQDET(KI)+JQDENF)
         KNECAL(KI)=IW(KJQDET(KI)+JQDENE)
         KNHCAL(KI)=IW(KJQDET(KI)+JQDENH)
         KNMOTH(KI)=IW(KOQVEC+KI*KCQVEC+JQVENO)
         KMOTH(KI,KI1)=IW(KOQLIN+KI1+IW(KOQVEC+KI*KCQVEC+JQVEOL))
         KMTCH(KI,KI1)=IW(KOQMTL+KI1+IW(KOQVEC+KI*KCQVEC+JQVEML))
         KNDAU(KI)=IW(KOQVEC+KI*KCQVEC+JQVEND)
         KNMTCH(KI)=IW(KOQVEC+KI*KCQVEC+JQVENM)
         KORIV(KI)=IW(KOQVEC+KI*KCQVEC+JQVEOV)
         KSAME(KI)=IW(KOQVEC+KI*KCQVEC+JQVESP)
         KSMTCH(KI,KI1)=IW(KOQMTS+KI1+IW(KOQVEC+KI*KCQVEC+JQVEML))
         KSTABC(KI)=IW(KOQVEC+KI*KCQVEC+JQVESC)
         KTPCOD(KI)=IW(KOQVEC+KI*KCQVEC+JQVEPA)
         XLOCKN(KI,KI1)=IAND(KBMASK(KI,KI1),KLOCK0(KI1,KMC(KI))).NE.0
         XLOCK(KI)=IW(KOQVEC+KI*KCQVEC+JQVELK).NE.0.OR.XLOCKN(KI,1).OR.
        & XLOCKN(KI,2).OR.XLOCKN(KI,3).OR.XLOCKN(KI,4).OR.
        & XLOCKN(KI,5).OR.XLOCKN(KI,6).OR.XLOCKN(KI,7).OR.
        & XLOCKN(KI,8).OR.XLOCKN(KI,9).OR.XLOCKN(KI,10).OR.
        & XLOCKN(KI,11).OR.XLOCKN(KI,12).OR.XLOCKN(KI,13).OR.
        & XLOCKN(KI,14)
         XMC(KI)=KCLARM(IW(KOQVEC+KI*KCQVEC+JQVECL)).NE.1
         QRDFL(KI,KI1)=RW(KOQVEC+KI*KCQVEC+JQVEUS+KI1-1)
         KRDFL(KI,KI1)=IW(KOQVEC+KI*KCQVEC+JQVEUS+KI1-1)
         XCAL(KI)=IW(KJQDET(KI)+JQDECF).NE.0
         XECAL(KI)=IABS(IW(KJQDET(KI)+JQDECF)).EQ.1
         XHCAL(KI)=IABS(IW(KJQDET(KI)+JQDECF)).EQ.2
         QVX(KI)=RW(KOQVRT+KI*KCQVRT+JQVRVX)
         QVY(KI)=RW(KOQVRT+KI*KCQVRT+JQVRVY)
         QVZ(KI)=RW(KOQVRT+KI*KCQVRT+JQVRVZ)
         KVN(KI)=IW(KOQVRT+KI*KCQVRT+JQVRVN)
         KVTYPE(KI)=IW(KOQVRT+KI*KCQVRT+JQVRTY)
         KVINCP(KI)=IW(KOQVRT+KI*KCQVRT+JQVRIP)
         KVNDAU(KI)=IW(KOQVRT+KI*KCQVRT+JQVRND)
         KVYV0V(KI)=IW(KOQVRT+KI*KCQVRT+JQVRAY)
         KVFVER(KI)=IW(KOQVRT+KI*KCQVRT+JQVRAF)
         KVDAU(KI,KI1)=IW(KOQLIN+KI1+IW(KOQVRT+KI*KCQVRT+JQVRDL))
         QVEM(KI,KI1,KI2)=RW(KOQVRT+KI*KCQVRT+KMATIX(KI1,KI2)+JQVREM)
         QVCHIF(KI)=RW(KOQVRT+KI*KCQVRT+JQVRCF)
         QVDIF2(KI1,KI2)=SQRT((QVX(KI1)-QVX(KI2))**2+(QVY(KI1)-
        &QVY(KI2))**2)
         QVDIF3(KI1,KI2)=SQRT((QVX(KI1)-QVX(KI2))**2+(QVY(KI1)-
        &QVY(KI2))**2+ (QVZ(KI1)-QVZ(KI2))**2)
         QMSQ2(KI1,KI2)=(QE(KI1)+QE(KI2))**2-(QX(KI1)+QX(KI2))**2-
        & (QY(KI1)+QY(KI2))**2-(QZ(KI1)+QZ(KI2))**2
         QMSQ3(KI1,KI2,KI3)=(QE(KI1)+QE(KI2)+QE(KI3))**2-
        & (QX(KI1)+QX(KI2)+QX(KI3))**2-(QY(KI1)+QY(KI2)+QY(KI3))**2-
        & (QZ(KI1)+QZ(KI2)+QZ(KI3))**2
         QMSQ4(KI1,KI2,KI3,KI4)=(QE(KI1)+QE(KI2)+QE(KI3)+QE(KI4))**2-
        & (QX(KI1)+QX(KI2)+QX(KI3)+QX(KI4))**2-(QY(KI1)+QY(KI2)+
        & QY(KI3)+QY(KI4))**2-(QZ(KI1)+QZ(KI2)+QZ(KI3)+QZ(KI4))**2
         QM2(KI1,KI2)=QSQT(QMSQ2(KI1,KI2))
         QM3(KI1,KI2,KI3)=QSQT(QMSQ3(KI1,KI2,KI3))
         QM4(KI1,KI2,KI3,KI4)=QSQT(QMSQ4(KI1,KI2,KI3,KI4))
         QDMSQ(KI1,KI2)=(QE(KI1)-QE(KI2))**2-(QX(KI1)-QX(KI2))**2-
        & (QY(KI1)-QY(KI2))**2-(QZ(KI1)-QZ(KI2))**2
         QBETA(KI)=QP(KI)/QE(KI)
         QGAMMA(KI)=1./SQRT((1.-QBETA(KI))*(1.+QBETA(KI)))
         QDOT3(KI1,KI2)=QX(KI1)*QX(KI2)+QY(KI1)*QY(KI2)+QZ(KI1)*QZ(KI2)
         QDOT4(KI1,KI2)=QE(KI1)*QE(KI2)-QDOT3(KI1,KI2)
         QCOSA(KI1,KI2)=QDOT3(KI1,KI2)/(QP(KI1)*QP(KI2))
         QPPAR(KI1,KI2)=QDOT3(KI1,KI2)/QP(KI2)
         QPPER(KI1,KI2)=SQRT((QY(KI1)*QZ(KI2)-QZ(KI1)*QY(KI2))**2+
        & (QZ(KI1)*QX(KI2)-QX(KI1)*QZ(KI2))**2+
        & (QX(KI1)*QY(KI2)-QY(KI1)*QX(KI2))**2)/QP(KI2)
         XSAME(KI1,KI2)=IAND(KBMASK(KI1,1),KBMASK(KI2,1)).NE.0.OR.
        & IAND(KBMASK(KI1,2),KBMASK(KI2,2)).NE.0.OR.
        & IAND(KBMASK(KI1,3),KBMASK(KI2,3)).NE.0.OR.
        & IAND(KBMASK(KI1,4),KBMASK(KI2,4)).NE.0.OR.
        & IAND(KBMASK(KI1,5),KBMASK(KI2,5)).NE.0.OR.
        & IAND(KBMASK(KI1,6),KBMASK(KI2,6)).NE.0.OR.
        & IAND(KBMASK(KI1,7),KBMASK(KI2,7)).NE.0.OR.
        & IAND(KBMASK(KI1,8),KBMASK(KI2,8)).NE.0.OR.
        & IAND(KBMASK(KI1,9),KBMASK(KI2,9)).NE.0.OR.
        & IAND(KBMASK(KI1,10),KBMASK(KI2,10)).NE.0.OR.
        & IAND(KBMASK(KI1,11),KBMASK(KI2,11)).NE.0.OR.
        & IAND(KBMASK(KI1,12),KBMASK(KI2,12)).NE.0.OR.
        & IAND(KBMASK(KI1,13),KBMASK(KI2,13)).NE.0.OR.
        & IAND(KBMASK(KI1,14),KBMASK(KI2,14)).NE.0
         QCMASS(KI)=RW(KOQPAR+KI*KCQPAR+JQPAMA)
         QCCHAR(KI)=RW(KOQPAR+KI*KCQPAR+JQPACH)
         QCLIFE(KI)=RW(KOQPAR+KI*KCQPAR+JQPALT)
         QCWIDT(KI)=RW(KOQPAR+KI*KCQPAR+JQPAWI)
         XCEQOR(KI,KI1)=KTPCOD(KI).EQ.KI1.OR.
        & KTPCOD(KI).EQ.IW(KOQPAR+KI1*KCQPAR+JQPAAN)
         XCEQU(KI,KI1)=KTPCOD(KI).EQ.KI1
      QCFDET
         XFRF(KI)=IW(KJQDET(KI)+JQDEAF).NE.KQZER
         QFRFIR(KI)=RW(IW(KJQDET(KI)+JQDEAF)+JFRFIR)
         QFRFTL(KI)=RW(IW(KJQDET(KI)+JQDEAF)+JFRFTL)
         QFRFP0(KI)=RW(IW(KJQDET(KI)+JQDEAF)+JFRFP0)
         QFRFD0(KI)=RW(IW(KJQDET(KI)+JQDEAF)+JFRFD0)
         QFRFZ0(KI)=RW(IW(KJQDET(KI)+JQDEAF)+JFRFZ0)
         QFRFAL(KI)=RW(IW(KJQDET(KI)+JQDEAF)+JFRFAL)
         QFRFEM(KI,KI1,KI2)=RW(IW(KJQDET(KI)+JQDEAF)+
        & KMATIX(KI1,KI2)+JFRFEM)
         QFRFC2(KI)=RW(IW(KJQDET(KI)+JQDEAF)+JFRFC2)
         KFRFDF(KI)=IW(IW(KJQDET(KI)+JQDEAF)+JFRFDF)
         KFRFNO(KI)=IW(IW(KJQDET(KI)+JQDEAF)+JFRFNO)
         KFRTNV(KI)=IW(IW(KJQDET(KI)+JQDEAL)+JFRTNV)
         KFRTNI(KI)=IW(IW(KJQDET(KI)+JQDEAL)+JFRTNI)
         KFRTNE(KI)=IW(IW(KJQDET(KI)+JQDEAL)+JFRTNE)
         KFRTNT(KI)=IW(IW(KJQDET(KI)+JQDEAL)+JFRTNT)
         KFRTNR(KI)=IW(IW(KJQDET(KI)+JQDEAL)+JFRTNR)
         KFRIBP(KI)=IW(IW(KJQDET(KI)+JQDEFI)+JFRIBP)
         KFRIDZ(KI)=IW(IW(KJQDET(KI)+JQDEFI)+JFRIDZ)
         KFRIBC(KI)=IW(IW(KJQDET(KI)+JQDEFI)+JFRIBC)
         KFRIDC(KI)=IW(IW(KJQDET(KI)+JQDEFI)+JFRIDC)
         QFRIPE(KI)=RW(IW(KJQDET(KI)+JQDEFI)+JFRIPE)
         QFRIPM(KI)=RW(IW(KJQDET(KI)+JQDEFI)+JFRIPM)
         QFRIPI(KI)=RW(IW(KJQDET(KI)+JQDEFI)+JFRIPI)
         QFRIPK(KI)=RW(IW(KJQDET(KI)+JQDEFI)+JFRIPK)
         QFRIPP(KI)=RW(IW(KJQDET(KI)+JQDEFI)+JFRIPP)
         QFRINK(KI)=RW(IW(KJQDET(KI)+JQDEFI)+JFRINK)
         KFRIQF(KI)=IW(IW(KJQDET(KI)+JQDEFI)+JFRIQF)
         XFRIQF(KI)=KFRIQF(KI).EQ.1.OR.KFRIQF(KI).EQ.3
         KNTEX(KI)=IW(KJQDET(KI)+JQDENT)
         XTEX(KI)=IW(KJQDET(KI)+JQDENT).NE.0
         KTEXSI(KI,KI1)=IW(IW(KJQDET(KI)+KI1+JQDENT)+JTEXSI)
         QTEXTM(KI,KI1)=RW(IW(KJQDET(KI)+KI1+JQDENT)+JTEXTM)
         QTEXTL(KI,KI1)=RW(IW(KJQDET(KI)+KI1+JQDENT)+JTEXTL)
         KTEXNS(KI,KI1)=IW(IW(KJQDET(KI)+KI1+JQDENT)+JTEXNS)
         QTEXAD(KI,KI1)=RW(IW(KJQDET(KI)+KI1+JQDENT)+JTEXAD)
         XEID(KI)=IW(KJQDET(KI)+JQDEAE).NE.KQZER
         KEIDIF(KI)=IW(IW(KJQDET(KI)+JQDEAE)+JEIDIF)
         QEIDRI(KI,KI1)=RW(IW(KJQDET(KI)+JQDEAE)+KI1+JEIDR1-1)
         QEIDEC(KI)=RW(IW(KJQDET(KI)+JQDEAE)+JEIDEC)
         KEIDIP(KI)=IW(IW(KJQDET(KI)+JQDEAE)+JEIDIP)
         QEIDEI(KI,KI1)=RW(IW(KJQDET(KI)+JQDEAE)+KI1+JEIDE1-1)
         XHMA(KI)=IW(KJQDET(KI)+JQDEAH).NE.KQZER
         KHMANF(KI)=IW(IW(KJQDET(KI)+JQDEAH)+JHMANF)
         KHMANE(KI)=IW(IW(KJQDET(KI)+JQDEAH)+JHMANE)
         KHMANL(KI)=IW(IW(KJQDET(KI)+JQDEAH)+JHMANL)
         KHMAMH(KI)=IW(IW(KJQDET(KI)+JQDEAH)+JHMAMH)
         KHMAIG(KI)=IW(IW(KJQDET(KI)+JQDEAH)+JHMAIG)
         QHMAED(KI)=RW(IW(KJQDET(KI)+JQDEAH)+JHMAED)
         QHMACS(KI)=RW(IW(KJQDET(KI)+JQDEAH)+JHMACS)
         KHMAND(KI)=IW(IW(KJQDET(KI)+JQDEAH)+JHMAND)
         KHMAIE(KI)=IW(IW(KJQDET(KI)+JQDEAH)+JHMAIE)
         KHMAIT(KI)=IW(IW(KJQDET(KI)+JQDEAH)+JHMAIT)
         KHMAIF(KI)=IW(IW(KJQDET(KI)+JQDEAH)+JHMAIF)
         XMCA(KI)=IW(KJQDET(KI)+JQDEAM).NE.KQZER
         KMCANH(KI,KI1)=IW(IW(KJQDET(KI)+JQDEAM)+KI1+JMCANH-1)
         QMCADH(KI,KI1)=RW(IW(KJQDET(KI)+JQDEAM)+KI1+JMCADH-1)
         QMCADC(KI,KI1)=RW(IW(KJQDET(KI)+JQDEAM)+KI1+JMCADC-1)
         QMCAAM(KI)=RW(IW(KJQDET(KI)+JQDEAM)+JMCAAM)
         QMCAAC(KI)=RW(IW(KJQDET(KI)+JQDEAM)+JMCAAC)
         XMUI(KI)=IW(KJQDET(KI)+JQDEMU).NE.KQZER
         KMUIIF(KI)=IW(IW(KJQDET(KI)+JQDEMU)+JMUIIF)
         QMUISR(KI)=RW(IW(KJQDET(KI)+JQDEMU)+JMUISR)
         QMUIDM(KI)=RW(IW(KJQDET(KI)+JQDEMU)+JMUIDM)
         KMUIST(KI)=IW(IW(KJQDET(KI)+JQDEMU)+JMUIST)
         KMUITN(KI)=IW(IW(KJQDET(KI)+JQDEMU)+JMUITN)
         XPEC(KI)=IW(KJQDET(KI)+JQDEEC).NE.KQZER
         QPECER(KI)=RW(IW(KJQDET(KI)+JQDEEC)+JPECER)
         QPECE1(KI)=RW(IW(KJQDET(KI)+JQDEEC)+JPECE1)
         QPECE2(KI)=RW(IW(KJQDET(KI)+JQDEEC)+JPECE2)
         QPECTH(KI)=RW(IW(KJQDET(KI)+JQDEEC)+JPECTH)
         QPECPH(KI)=RW(IW(KJQDET(KI)+JQDEEC)+JPECPH)
         QPECEC(KI)=RW(IW(KJQDET(KI)+JQDEEC)+JPECEC)
         KPECKD(KI)=IW(IW(KJQDET(KI)+JQDEEC)+JPECKD)
         KPECCC(KI)=IW(IW(KJQDET(KI)+JQDEEC)+JPECCC)
         KPECRB(KI)=IW(IW(KJQDET(KI)+JQDEEC)+JPECRB)
         KPECPC(KI)=IW(IW(KJQDET(KI)+JQDEEC)+JPECPC)
         XPEP(KI)=IW(KJQDET(KI)+JQDEET).NE.KQZER
         QPEPT1(KI)=RW(IW(KJQDET(KI)+JQDEET)+JPEPT1)
         QPEPP1(KI)=RW(IW(KJQDET(KI)+JQDEET)+JPEPP1)
         QPEPT3(KI)=RW(IW(KJQDET(KI)+JQDEET)+JPEPT3)
         QPEPP3(KI)=RW(IW(KJQDET(KI)+JQDEET)+JPEPP3)
         XPHC(KI)=IW(KJQDET(KI)+JQDEHC).NE.KQZER
         QPHCER(KI)=RW(IW(KJQDET(KI)+JQDEHC)+JPHCER)
         QPHCTH(KI)=RW(IW(KJQDET(KI)+JQDEHC)+JPHCTH)
         QPHCPH(KI)=RW(IW(KJQDET(KI)+JQDEHC)+JPHCPH)
         QPHCEC(KI)=RW(IW(KJQDET(KI)+JQDEHC)+JPHCEC)
         KPHCKD(KI)=IW(IW(KJQDET(KI)+JQDEHC)+JPHCKD)
         KPHCCC(KI)=IW(IW(KJQDET(KI)+JQDEHC)+JPHCCC)
         KPHCRB(KI)=IW(IW(KJQDET(KI)+JQDEHC)+JPHCRB)
         KPHCPC(KI)=IW(IW(KJQDET(KI)+JQDEHC)+JPHCPC)
         XEFO(KI)=IW(KJQDET(KI)+JQDEEF).NE.KQZER
         QEFOWE(KI)=RW(IW(KJQDET(KI)+JQDEEF)+JEFOWE)
         KEFOTY(KI)=IW(IW(KJQDET(KI)+JQDEEF)+JEFOTY)
         KEFOLE(KI)=IW(IW(KJQDET(KI)+JQDEEF)+JEFOLE)
         KEFOLT(KI)=IW(IW(KJQDET(KI)+JQDEEF)+JEFOLT)
         KEFOLH(KI)=IW(IW(KJQDET(KI)+JQDEEF)+JEFOLH)
         KEFOLC(KI)=IW(IW(KJQDET(KI)+JQDEEF)+JEFOLC)
         KEFOLJ(KI)=IW(IW(KJQDET(KI)+JQDEEF)+JEFOLJ)
         XPCQ(KI)=IW(KJQDET(KI)+JQDEPC).NE.KQZER
         KPCQNA(KI)=IW(IW(KJQDET(KI)+JQDEPC)+JPCQNA)
         XEGP(KI)=IW(KJQDET(KI)+JQDEEG).NE.KQZER
         QEGPR1(KI)=RW(IW(KJQDET(KI)+JQDEEG)+JEGPR1)
         QEGPR2(KI)=RW(IW(KJQDET(KI)+JQDEEG)+JEGPR2)
         QEGPF4(KI)=RW(IW(KJQDET(KI)+JQDEEG)+JEGPF4)
         QEGPDM(KI)=RW(IW(KJQDET(KI)+JQDEEG)+JEGPDM)
         KEGPST(KI)=IW(IW(KJQDET(KI)+JQDEEG)+JEGPST)
         KEGPQU(KI)=IW(IW(KJQDET(KI)+JQDEEG)+JEGPQU)
         KEGPPE(KI)=IW(IW(KJQDET(KI)+JQDEEG)+JEGPPE)
         XPGP(KI)=IW(KJQDET(KI)+JQDEPG).NE.KQZER.AND.IW(NAPGPC).GT.0
         QPGPR1(KI)=RW(IW(KJQDET(KI)+JQDEPG)+JPGPR1)
         QPGPR2(KI)=RW(IW(KJQDET(KI)+JQDEPG)+JPGPR2)
         QPGPF4(KI)=RW(IW(KJQDET(KI)+JQDEPG)+JPGPF4)
         QPGPDM(KI)=RW(IW(KJQDET(KI)+JQDEPG)+JPGPDM)
         QPGPST(KI)=RW(IW(KJQDET(KI)+JQDEPG)+JPGPST)
         QPGPQ1(KI)=RW(IW(KJQDET(KI)+JQDEPG)+JPGPQ1)
         QPGPQ2(KI)=RW(IW(KJQDET(KI)+JQDEPG)+JPGPQ2)
         QPGPM1(KI)=RW(IW(KJQDET(KI)+JQDEPG)+JPGPM1)
         QPGPM2(KI)=RW(IW(KJQDET(KI)+JQDEPG)+JPGPM2)
         QPGPMA(KI)=RW(IW(KJQDET(KI)+JQDEPG)+JPGPMA)
         QPGPER(KI)=RW(IW(KJQDET(KI)+JQDEPG)+JPGPER)
         QPGPTR(KI)=RW(IW(KJQDET(KI)+JQDEPG)+JPGPTR)
         QPGPPR(KI)=RW(IW(KJQDET(KI)+JQDEPG)+JPGPPR)
         KPGPQU(KI)=IW(IW(KJQDET(KI)+JQDEPG)+JPGPQU)
         KPGPPE(KI)=IW(IW(KJQDET(KI)+JQDEPG)+JPGPPE)
         XPGAC(KI)=IW(KJQDET(KI)+JQDEPG).NE.KQZER.AND.IW(NAPGAC).GT.0
         KPGAST(KI)=IW(IW(KJQDET(KI)+JQDEPG)+JPGAST)
         QPGAEF(KI)=RW(IW(KJQDET(KI)+JQDEPG)+JPGAEF)
         QPGAGC(KI)=RW(IW(KJQDET(KI)+JQDEPG)+JPGAGC)
         QPGAZS(KI)=RW(IW(KJQDET(KI)+JQDEPG)+JPGAZS)
         QPGAPL(KI)=RW(IW(KJQDET(KI)+JQDEPG)+JPGAPL)
         QPGAPH(KI)=RW(IW(KJQDET(KI)+JQDEPG)+JPGAPH)
         KPGAPN(KI)=IW(IW(KJQDET(KI)+JQDEPG)+JPGAPN)
         KPGAFA(KI)=IW(IW(KJQDET(KI)+JQDEPG)+JPGAFA)
         KPGAPE(KI)=IW(IW(KJQDET(KI)+JQDEPG)+JPGAPE)
         XYV0(KI)=KVYV0V(KENDV(KI)).NE.0
         KYV0K1(KI)=IW(KVYV0V(KENDV(KI))+JYV0K1)
         KYV0K2(KI)=IW(KVYV0V(KENDV(KI))+JYV0K2)
         QYV0VX(KI)=RW(KVYV0V(KENDV(KI))+JYV0VX)
         QYV0VY(KI)=RW(KVYV0V(KENDV(KI))+JYV0VY)
         QYV0VZ(KI)=RW(KVYV0V(KENDV(KI))+JYV0VZ)
         QYV0X1(KI)=RW(KVYV0V(KENDV(KI))+JYV0X1)
         QYV0X2(KI)=RW(KVYV0V(KENDV(KI))+JYV0X2)
         QYV0C2(KI)=RW(KVYV0V(KENDV(KI))+JYV0C2)
         KYV0IC(KI)=IW(KVYV0V(KENDV(KI))+JYV0IC)
         QYV0DM(KI)=RW(KVYV0V(KENDV(KI))+JYV0DM)
         QYV0S1(KI)=RW(KVYV0V(KENDV(KI))+JYV0S1)
         QYV0S2(KI)=RW(KVYV0V(KENDV(KI))+JYV0S2)
         XLEPTG(KI)=IW(KJQDET(KI)+JQDEPD).NE.KQZER
         KLEPPA(KI)=IW(IW(KJQDET(KI)+JQDEPD)+JPDLPA)
         KLEPJT(KI)=IW(IW(KJQDET(KI)+JQDEPD)+JPDLJT)+KLFJET-1
         QLEPPI(KI)=RW(IW(KJQDET(KI)+JQDEPD)+JPDLPI)
         QLEPPE(KI)=RW(IW(KJQDET(KI)+JQDEPD)+JPDLPE)
         KLEPVP(KI)=IW(IW(KJQDET(KI)+JQDEPD)+JPDLVP)
         XLEPTH(KI)=IW(KJQDET(KI)+JQDEPM).NE.KQZER
         KLEPFL(KI)=IW(IW(KJQDET(KI)+JQDEPM)+JPMLFL)
         KLEPPO(KI)=IW(IW(KJQDET(KI)+JQDEPM)+JPMLPO)
         KLEPCH(KI)=IW(IW(KJQDET(KI)+JQDEPM)+JPMLCH)
         KLEPSP(KI)=IW(IW(KJQDET(KI)+JQDEPM)+JPMLSP)
         KLEPLE(KI)=IW(IW(KJQDET(KI)+JQDEPM)+JPMLLE)
         KLEPME(KI)=IW(IW(KJQDET(KI)+JQDEPM)+JPMLME)
         KLEPKT(KI)=IW(IW(KJQDET(KI)+JQDEPM)+JPMLKT)
   
         MINI_KPECPC=0
    if this is an ECAL object
         IF(IECAL.LE.0) THEN
           MINI_KPECPC=-1
           GOTO 999
         ELSEIF(.NOT.(XPEC(IECAL))) THEN
           MINI_KPECPC=-2
           GOTO 999
         ENDIF
    for the PECO row number
         IPECO=KTN(IECAL)
         IF(IPECO.LE.0) THEN
           MINI_KPECPC=-3
           GOTO 999
         ENDIF
    on PCRL to find the corresponding calobject number
         KPCRL=IW(NAPCRL)
         IF(KPCRL.LE.0) THEN
           MINI_KPECPC=-4
           GOTO 999
         ENDIF
         DO ICOB=1,LROWS(KPCRL)
           IF(IPECO.EQ.ITABL(KPCRL,ICOB,JPCRPE)) THEN
             MINI_KPECPC=ITABL(KPCRL,ICOB,JPCRPC)
             GOTO 999
           ENDIF
         ENDDO
    999  CONTINUE
         RETURN
         END
 
3 MMUIDF
         SUBROUTINE MMUIDF(NEXP,NFIR,IM1,IM2,N10,N03,MULT,ISHAD,IDF)
  ------------------------------------------------------------------------------
    CKEY MUONID MUON / INTERNAL
  ------------------------------------------------------------------------------
   Calculates the muon id flag
       authors: D.Cinabro    10-JUN-1990
       revised: G.Taylor     20-APR-1992
   
       input  : NEXP  /I = num of hcal dig hits expected
                NFIR  /I = num of hcal dig hits fired
                IM1   /I = num of muon chamber hits in first layer
                IM2   /I = num of muon chamber hits in second layer
                N10   /I = num of hcal dig hits fired in last 10 exp
                N03   /I = num of hcal dig hits fired in last 3 exp
                MULT  /I = excess digital multiplicity in last 10
                             hcal planes(*100)
                ISHAD /I = shadowing flag (=0 if best candidate)
   
       output : IDF/I = muon id flag
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   QMUIDO                                                                          
        |---- MMUIDF                                                               
                   |----  FLOAT                               External             
                   |----  ABS                                 External             
   
 
3 NDIGHE14
         integer function ndigh_e14(Ihco)
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
    PHCO row number IHCO how many distinct layers of digital hits
    associated to it
   Auxiliary to QFE14
   Author G. Taylor Oct 1997
         SAVE
   
   -------------------- /QCDE/ --- COMMONs, DIMENSIONs, etc. ------------
   
    of QCDESH ----------------------- Description in QDATA ---------
         PARAMETER (KCQDET=34, KCQFPA=8, KCQPAR=10, KCQVEC=73, KCQVRT=30,
        & KHE=1, KHMU=2, KHPI=3, KHK=4, KHP=5, KHPHOT=1, KHNHAD=2,
        & KMONTE=-2, KRECO=-1, KLOCKM=14, KSOVT=1, KSCHT=2, KSIST=3,
        & KSAST=4, KSEHT=5, KSV0T=6, KSDCT=7, KSEFT=8, KSNET=9, KSGAT=10,
        & KSJET=11, KSMCT=12, KSREV=13,
        & KSMCV=14, KUNDEF=-12344321, QQPI=3.141593, QQE=2.718282,
        & QQ2PI=QQPI*2., QQPIH=QQPI/2., QQRADP=180./QQPI, QQC=2.997925E10,
        & QQH=6.582173E-25, QQHC=QQH*QQC, QQIRP=.00029979)
         CHARACTER CQDATE*8, CQDWRK*80, CQFHIS*80, CQFOUT*80, CQFWRK*80,
        & CQHTIT*80, CQSEC*3, CQTIME*8, CQUNPK*30, CQVERS*6, CQRLST*800,
        & CQELST*800
         COMMON /QCDEC/ CQDATE, CQDWRK, CQFHIS, CQFOUT, CQFWRK, CQHTIT,
        & CQSEC(14), CQTIME, CQUNPK, CQVERS, CQRLST, CQELST
         COMMON /QCDE/ QELEP, QMFLD ,QMFLDC, QTIME, QTIMEI, QTIMEL,
        & QTIMES, QTIMET, QDHEEC, QDHEEL, QDHEPF, QDHETH, QDHEPH, QDHEEF,
        & QDHEET, QDHET1, QDHEP1, QDHET2, QDHEP2, QDHEE1, QDHEE2, QDHEE3,
        & QKEVRN, QKEVWT, QVXNOM, QVYNOM, QVZNOM, QVXNSG, QVYNSG, QVZNSG,
        & QINLUM, QRINLN, QRINLU, QDBOFS, QEECWI(36), QVXBOM, QVYBOM,
        & QSILUM, QRSLLU, QRSLBK, QRSLEW , QVTXBP(3), QVTEBP(3), QVTSBP(3)
         COMMON /QCDE/  KFOVT, KLOVT, KNOVT, KFCHT, KLCHT, KNCHT, KFIST,
        & KLIST, KNIST, KFAST, KLAST, KNAST, KFEHT, KLEHT, KNEHT, KFV0T,
        & KLV0T, KNV0T, KFDCT, KLDCT, KNDCT, KFEFT, KLEFT, KNEFT, KFNET,
        & KLNET, KNNET, KFGAT, KLGAT, KNGAT, KFJET, KLJET, KNJET, KFMCT,
        & KLMCT, KNMCT, KFREV, KLREV, KNREV, KFMCV, KLMCV, KNMCV, KLUST,
        & KLUSV, KFFRT, KLFRT, KFFRV, KLFRV, KNRET, KNCOT, KFFRD,
        & KLFJET,KLLJET,KLNJET
         COMMON /QCDE/ KBIT(32), KCLACO(KCQFPA), KCLAFR(KCQFPA), KCLARM
        & (KCQFPA), KDEBUG, KEVT, KEXP, KFFILL, KFEOUT, KJOPTN(2,2),
        & KLEOUT, KLROUT, KLOCK0(KLOCKM,2), KLOCK1(KLOCKM,2), KLOCK2(
        & KLOCKM,2), KMATIX(6,6), KMQFPA, KNEFIL, KNEOUT, KNEVT, KNPAST,
        & KNQDET, KNQFPA, KNQLIN, KNQMTX, KNQPAR, KNQPST, KNREIN, KNREOU,
        & KOQDET, KOQFPA, KOQLIN, KOQMTL, KOQMTS, KOQPAR, KOQPBT, KOQPLI,
        & KOQTRA, KOQVEC, KOQVRT, KQPAR, KQVEC, KQVRT, KQWRK, KQZER, KRUN,
        & KSTATU, KTDROP, KUCARD, KUCONS, KUHIST, KUINPU, KUOUTP, KUPRNT,
        & KUPTER, KDEBU1, KDEBU2, KNWRLM, KEFOPT, KUEDIN, KUEDOU, KURTOX,
        & KUCAR2, KNHDRN, KNBHAB, KSBHAB, KRSLLQ, KRSLNB
         COMMON /QCDE/ INDATA
         COMMON /QCDE/ KRINNE, KRINNF, KRINDC, KRINDQ, KRINNZ, KRINNB,
        & KRINBM, KRINFR, KRINLR, KRINLF
         COMMON /QCDE/ KEVERT, KEVEDA, KEVETI, KEVEMI(4), KEVETY, KEVEES,
        & KDHEFP, KDHENP, KDHENM, KKEVNT, KKEVNV, KKEVID, KDHENX, KDHENV,
        & KDHENJ, KREVDS, KXTET1, KXTET2, KXTEL2, KXTCGC, KXTCLL, KXTCBN,
        & KXTCCL, KXTCHV, KXTCEN, KCLASW, KERBOM, KBPSTA
         DIMENSION KLOCUS(3,14)
         EQUIVALENCE (KLOCUS(1,1),KFOVT), (KFOVT,KFRET), (KLIST,KLRET),
        & (KFIST,KFCOT), (KLAST,KLCOT)
         COMMON /QCDE/ XCOPYJ, XFLIAC, XHISTO, XLREV(2), XLREV2(2), XMCEV,
        & XMINI, XSYNTX, XWREVT, XWRRUN, XFILMC, XFILCH, XFILV0, XFILCO,
        & XFILEF, XFILPC, XFILGA, XFILJE,
        & XPRHIS, XFILL, XVITC, XVTPC, XVECAL, XVLCAL, XVTPCD,
        & XVSATR, XVHCAL, XHVTRG, XSREC, XWMINI, XIOKLU, XIOKSI, XFRF2,
        & XNSEQ, XVDOK, XFRF0, XFMUID, XFILEM, XWNANO, XROKSI, XGETBP,
        & XJTHRU
         LOGICAL XCOPYJ, XFLIAC, XHISTO, XLREV, XLREV2, XMCEV, XMINI,
        & XSYNTX, XWREVT, XWRRUN, XFILMC, XFILCH, XFILV0, XFILCO, XFILEF,
        & XFILPC, XPRHIS, XFILL, XVITC, XVTPC, XVECAL, XVLCAL, XVTPCD,
        & XVSATR, XVHCAL, XHVTRG, XSREC, XWMINI, XIOKLU, XFRF2, XFILJE,
        & XNSEQ, XFILGA, XVDOK, XFRF0, XFMUID, XFILEM, XWNANO, XIOKSI,
        & XROKSI, XGETBP, XJTHRU
   
   -------------------- /NANCOM/ --- NanoDst steering -------------------
   Xnano   .true. if input is a nanodst (in nano or epio format, depending
                      XNANOR)
   
         LOGICAL XNANO
         COMMON /NANCOM/XNANO
   
   
    bcs
         INTEGER LMHLEN, LMHCOL, LMHROW
         PARAMETER (LMHLEN=2, LMHCOL=1, LMHROW=2)
         COMMON /BCS/   IW(1000)
         INTEGER IW
         REAL RW(1000)
         EQUIVALENCE (RW(1),IW(1))
   
   
   ------------------ /QCNAMI/ --- name indices -------------------------
         COMMON /QCNAMI/ NAAFID,NAAJOB,NAASEV,NABCNT,NABHIT,NABOMB,
        1 NABOME,NABOMP,NABOMR,NABPTR,NADCAL,NADCRL,NADECO,NADEID,NADENF,
        2 NADEVT,NADEWI,NADFMC,NADFOT,NADGAM,NADHCO,NADHEA,NADHRL,NADJET,
        3 NADMID,NADMJT,NADMUO,NADNEU,NADPOB,NADRES,NADTBP,NADTMC,NADTRA,
        4 NADVER,NADVMC,NAECRQ,NAECTE,NAEGID,NAEGPC,NAEIDT,NAEJET,NAERRF,
        5 NAETDI,NAETKC,NAEVEH,NAEWHE,NAFICL,NAFKIN,NAFPOI,NAFPOL,NAFRFT,
        6 NAFRID,NAFRTL,NAFSTR,NAFTCL,NAFTCM,NAFTOC,NAFTTM,NAFVCL,NAFVER,
        7 NAFZFR,NAHCCV,NAHCTE,NAHINF,NAHMAD,NAHPDI,NAHROA,NAHSDA,NAHTUB,
        8 NAIASL,NAIPJT,NAIRJT,NAITCO,NAITMA,NAIXTR,NAIZBD,NAJBER,NAJEST,
        9 NAJSUM,NAKEVH,NAKINE,NAKJOB,NAKLIN,NAKPOL,NAKRUN,NALIDT,NALOLE,
        A NALUPA,NAMCAD,NAMHIT,NAMTHR,NAMUDG,NAMUEX,NAOSTS,NAPART,NAPASL,
        B NAPCHY,NAPCOB,NAPCOI,NAPCPA,NAPCQA,NAPCRL,NAPECO,NAPEHY,NAPEID,
        C NAPEMH,NAPEPT,NAPEST,NAPEWI,NAPFER,NAPFHR,NAPFRF,NAPFRT,NAPHCO,
        D NAPHER,NAPHHY,NAPHMH,NAPHST,NAPIDI,NAPITM,NAPLID,NAPLPD,NAPLSD,
        E NAPMSK,NAPNEU,NAPPDS,NAPPOB,NAPPRL,NAPRTM,NAPSCO,NAPSPO,NAPSTR,
        F NAPT2X,NAPTBC,NAPTCO,NAPTEX,NAPTMA,NAPTML,NAPTNC,NAPTST,NAPVCO,
        G NAPYER,NAPYFR,NAPYNE,NAQDET,NAQFPA,NAQLIN,NAQMTL,NAQMTS,NAQPAR,
        H NAQPBT,NAQPLI,NAQTRA,NAQVEC,NAQVRT,NAQWRK,NAQZER,NAREVH,NARHAH,
        I NARTLO,NARTLS,NARUNH,NARUNR,NASFTR,NATEXS,NATGMA,NATMTL,NATPCO,
        J NAVCOM,NAVCPL,NAVDCO,NAVDHT,NAVDXY,NAVDZT,NAVERT,NAVFHL,NAVFLG,
        K NAVFPH,NAVHLS,NAVPLH,NAX1AD,NAX1SC,NAX1TI,NAX2DF,NAX3EC,NAX3EW,
        L NAX3HC,NAX3IT,NAX3L2,NAX3LU,NAX3TM,NAX3TO,NAX3TP,NAX3X3,NAXTBN,
        M NAXTBP,NAXTCN,NAXTEB,NAXTOP,NAXTRB,NAYV0V,NAZPFR,NAEFOL,NAMUID,
        N NAPGID,NAPGPC,NAPGAC,NAPMSC,NAPTHR,NANBIP,NAPDLT,NAPMLT,NAPLJT
   
   
   ------------------ /QQQQJJ/ --- HAC parameters for ALPHA banks -------
         PARAMETER (JQVEQX= 1,JQVEQY= 2,JQVEQZ= 3,JQVEQE= 4,JQVEQM= 5,
        & JQVEQP= 6,JQVECH= 7,JQVETN= 8,JQVESC= 9,JQVEKS=10,JQVECL=11,
        & JQVEPA=12,JQVEQD=13,JQVENP=14,JQVESP=15,JQVEOV=16,JQVEEV=17,
        & JQVEND=18,JQVEDL=19,JQVENO=20,JQVEOL=21,JQVENM=22,JQVEML=23,
        & JQVEBM=24,JQVELK=38,JQVEDB=39,JQVEZB=40,JQVESD=41,JQVESZ=42,
        & JQVECB=43,JQVEEM=44,JQVECF=54,JQVEEW=55,JQVEUS=56)
         PARAMETER ( JQVRVX=1,JQVRVY=2,JQVRVZ=3,JQVRVN=4,JQVRTY=5,
        1   JQVRIP=6,JQVRND=7,JQVRDL=8,JQVRAY=9,JQVRAF=10,JQVREM=11,
        2   JQVRCF=17,JQVRET=18)
         PARAMETER ( JQDEAF= 1,JQDEAL= 2,JQDENT= 3,JQDEAT= 4,JQDELT= 8,
        &  JQDEAE= 9,JQDEAH=10,JQDEAM=11,JQDECF=12,JQDEEC=13,JQDEHC=14,
        &  JQDEET=15,JQDEFI=16,JQDENF=17,JQDEFL=18,JQDENE=19,JQDEEL=20,
        &  JQDENH=21,JQDEHL=22,JQDELH=23,JQDEEF=24,JQDEPC=25,JQDEEG=26,
        &  JQDEMU=27,JQDEDX=28,JQDEPG=29,JQDEPD=30,JQDEPM=31)
         PARAMETER ( JQPAGN=1, JQPANA=2, JQPACO=5, JQPAMA=6, JQPACH=7,
        & JQPALT=8,JQPAWI=9,JQPAAN=10)
   
   
         EXTERNAL CQPART, CQTPN, XCEQAN, XLUMOK, XPEQAN, XPEQOR, XPEQU,
        & XVDEOK, LLUMOK, SLUMOK
         CHARACTER * 12 CQPART, CQTPN
         LOGICAL XCAL, XCEQAN, XCEQOR, XCEQU, XECAL, XEID, XFRF, XHCAL,
        & XHMA, XLOCK, XLOCKN, XMC, XLUMOK, XMCA, XPEO, XPHO, XPEQAN,
        & XPEQOR, XPEQU, XSAME, XSIG, XTEX, XPEC, XPEP, XPHC, XYV0,
        & XFRIQF, XEFO, XPCQ, XEGP, XMUI, XVDEOK, XPGP, LLUMOK, SLUMOK,
        & XPGAC, XLEPTG, XLEPTH
   
    alcons
    define universal constants
         REAL PI, TWOPI, PIBY2, PIBY3, PIBY4, PIBY6, PIBY8, PIBY12
         REAL RADEG, DEGRA
         REAL CLGHT, ALDEDX
         PARAMETER (PI=3.141592653589)
         PARAMETER (RADEG=180./PI, DEGRA=PI/180.)
         PARAMETER (TWOPI = 2.*PI , PIBY2 = PI/2., PIBY4 = PI/4.)
         PARAMETER (PIBY6 = PI/6. , PIBY8 = PI/8.)
         PARAMETER (PIBY12= PI/12., PIBY3 = PI/3.)
         PARAMETER (CLGHT = 29.9792458, ALDEDX = 0.000307)
   
         ALDEDX  = constant used in the computation of DEDX in GeV
         CLGHT   = speed of light in cm/nsec
   
   
   
    efoljj
         INTEGER JEFOPX,JEFOPY,JEFOPZ,JEFOEW,JEFOWE,JEFOTY,JEFOLE,JEFOLT,
        +          JEFOLH,JEFOLC,JEFOLJ,LEFOLA
         PARAMETER(JEFOPX=1,JEFOPY=2,JEFOPZ=3,JEFOEW=4,JEFOWE=5,JEFOTY=6,
        +          JEFOLE=7,JEFOLT=8,JEFOLH=9,JEFOLC=10,JEFOLJ=11,
        +          LEFOLA=11)
   
   
    egpcjj
         INTEGER JEGPPX,JEGPPY,JEGPPZ,JEGPR1,JEGPR2,JEGPF4,JEGPDM,JEGPST,
        +          JEGPQU,JEGPPE,LEGPCA
         PARAMETER(JEGPPX=1,JEGPPY=2,JEGPPZ=3,JEGPR1=4,JEGPR2=5,JEGPF4=6,
        +          JEGPDM=7,JEGPST=8,JEGPQU=9,JEGPPE=10,LEGPCA=10)
   
   
    eidtjj
         INTEGER JEIDIF,JEIDR1,JEIDR2,JEIDR3,JEIDR4,JEIDR5,JEIDR6,JEIDR7,
        +          JEIDEC,JEIDIP,JEIDE1,JEIDE2,JEIDE3,JEIDFR,JEIDPE,LEIDTA
         PARAMETER(JEIDIF=1,JEIDR1=2,JEIDR2=3,JEIDR3=4,JEIDR4=5,JEIDR5=6,
        +          JEIDR6=7,JEIDR7=8,JEIDEC=9,JEIDIP=10,JEIDE1=11,
        +          JEIDE2=12,JEIDE3=13,JEIDFR=14,JEIDPE=15,LEIDTA=15)
   
   
    frftjj
         INTEGER JFRFIR,JFRFTL,JFRFP0,JFRFD0,JFRFZ0,JFRFAL,JFRFEM,JFRFC2,
        +          JFRFDF,JFRFNO,LFRFTA
         PARAMETER(JFRFIR=1,JFRFTL=2,JFRFP0=3,JFRFD0=4,JFRFZ0=5,JFRFAL=6,
        +          JFRFEM=7,JFRFC2=28,JFRFDF=29,JFRFNO=30,LFRFTA=30)
   
   
    fridjj
         INTEGER JFRIBP,JFRIDZ,JFRIBC,JFRIDC,JFRIPE,JFRIPM,JFRIPI,JFRIPK,
        +          JFRIPP,JFRINK,JFRIQF,LFRIDA
         PARAMETER(JFRIBP=1,JFRIDZ=2,JFRIBC=3,JFRIDC=4,JFRIPE=5,JFRIPM=6,
        +          JFRIPI=7,JFRIPK=8,JFRIPP=9,JFRINK=10,JFRIQF=11,
        +          LFRIDA=11)
   
   
    frtljj
         INTEGER JFRTIV,JFRTNV,JFRTII,JFRTNI,JFRTNE,JFRTIT,JFRTNT,JFRTNR,
        +          LFRTLA
         PARAMETER(JFRTIV=1,JFRTNV=2,JFRTII=3,JFRTNI=4,JFRTNE=5,JFRTIT=6,
        +          JFRTNT=7,JFRTNR=8,LFRTLA=8)
   
   
    hmadjj
         INTEGER JHMANF,JHMANE,JHMANL,JHMAMH,JHMAIG,JHMAED,JHMACS,JHMAND,
        +          JHMAIE,JHMAIT,JHMAIF,JHMATN,LHMADA
         PARAMETER(JHMANF=1,JHMANE=2,JHMANL=3,JHMAMH=4,JHMAIG=5,JHMAED=6,
        +          JHMACS=7,JHMAND=8,JHMAIE=9,JHMAIT=10,JHMAIF=11,
        +          JHMATN=12,LHMADA=12)
   
   
    mcadjj
         INTEGER JMCANH,JMCADH,JMCADC,JMCAAM,JMCAAC,JMCATN,LMCADA
         PARAMETER(JMCANH=1,JMCADH=3,JMCADC=5,JMCAAM=7,JMCAAC=8,JMCATN=9,
        +          LMCADA=9)
   
   
    muidjj
         INTEGER JMUIIF,JMUISR,JMUIDM,JMUIST,JMUITN,LMUIDA
         PARAMETER(JMUIIF=1,JMUISR=2,JMUIDM=3,JMUIST=4,JMUITN=5,LMUIDA=5)
   
   
    pcqajj
         INTEGER JPCQNA,JPCQPX,JPCQPY,JPCQPZ,JPCQEN,LPCQAA
         PARAMETER(JPCQNA=1,JPCQPX=2,JPCQPY=3,JPCQPZ=4,JPCQEN=5,LPCQAA=5)
   
   
    pdltjj
         INTEGER JPDLPA,JPDLJT,JPDLPI,JPDLPE,JPDLVP,JPDLFR,LPDLTA
         PARAMETER(JPDLPA=1,JPDLJT=2,JPDLPI=3,JPDLPE=4,JPDLVP=5,JPDLFR=6,
        +          LPDLTA=6)
   
   
    pecojj
         INTEGER JPECER,JPECE1,JPECE2,JPECTH,JPECPH,JPECEC,JPECKD,JPECCC,
        +          JPECRB,JPECPC,LPECOA
         PARAMETER(JPECER=1,JPECE1=2,JPECE2=3,JPECTH=4,JPECPH=5,JPECEC=6,
        +          JPECKD=7,JPECCC=8,JPECRB=9,JPECPC=10,LPECOA=10)
   
   
    peptjj
         INTEGER JPEPT1,JPEPP1,JPEPT3,JPEPP3,LPEPTA
         PARAMETER(JPEPT1=1,JPEPP1=2,JPEPT3=3,JPEPP3=4,LPEPTA=4)
   
   
    pgacjj
         INTEGER JPGAEC,JPGATC,JPGAPC,JPGAR1,JPGAR2,JPGAF4,JPGADM,JPGAST,
        +          JPGAQU,JPGAQ1,JPGAQ2,JPGAM1,JPGAM2,JPGAMA,JPGAER,JPGATR,
        +          JPGAPR,JPGAEF,JPGAGC,JPGAZS,JPGAPL,JPGAPH,JPGAPN,JPGAFA,
        +          JPGAPE,LPGACA
         PARAMETER(JPGAEC=1,JPGATC=2,JPGAPC=3,JPGAR1=4,JPGAR2=5,JPGAF4=6,
        +          JPGADM=7,JPGAST=8,JPGAQU=9,JPGAQ1=10,JPGAQ2=11,
        +          JPGAM1=12,JPGAM2=13,JPGAMA=14,JPGAER=15,JPGATR=16,
        +          JPGAPR=17,JPGAEF=18,JPGAGC=19,JPGAZS=20,JPGAPL=21,
        +          JPGAPH=22,JPGAPN=23,JPGAFA=24,JPGAPE=25,LPGACA=25)
   
   
    pgpcjj
         INTEGER JPGPEC,JPGPTC,JPGPPC,JPGPR1,JPGPR2,JPGPF4,JPGPDM,JPGPST,
        +          JPGPQU,JPGPQ1,JPGPQ2,JPGPM1,JPGPM2,JPGPMA,JPGPER,JPGPTR,
        +          JPGPPR,JPGPPE,LPGPCA
         PARAMETER(JPGPEC=1,JPGPTC=2,JPGPPC=3,JPGPR1=4,JPGPR2=5,JPGPF4=6,
        +          JPGPDM=7,JPGPST=8,JPGPQU=9,JPGPQ1=10,JPGPQ2=11,
        +          JPGPM1=12,JPGPM2=13,JPGPMA=14,JPGPER=15,JPGPTR=16,
        +          JPGPPR=17,JPGPPE=18,LPGPCA=18)
   
   
    phcojj
         INTEGER JPHCER,JPHCTH,JPHCPH,JPHCEC,JPHCKD,JPHCCC,JPHCRB,JPHCNF,
        +          JPHCPC,LPHCOA
         PARAMETER(JPHCER=1,JPHCTH=2,JPHCPH=3,JPHCEC=4,JPHCKD=5,JPHCCC=6,
        +          JPHCRB=7,JPHCNF=8,JPHCPC=9,LPHCOA=9)
   
   
    pmltjj
         INTEGER JPMLFL,JPMLPO,JPMLCH,JPMLSP,JPMLLE,JPMLME,JPMLKT,JPMLFR,
        +          LPMLTA
         PARAMETER(JPMLFL=1,JPMLPO=2,JPMLCH=3,JPMLSP=4,JPMLLE=5,JPMLME=6,
        +          JPMLKT=7,JPMLFR=8,LPMLTA=8)
   
   
    texsjj
         INTEGER JTEXSI,JTEXTM,JTEXTL,JTEXNS,JTEXAD,JTEXTN,JTEXSF,LTEXSA
         PARAMETER(JTEXSI=1,JTEXTM=2,JTEXTL=3,JTEXNS=4,JTEXAD=5,JTEXTN=6,
        +          JTEXSF=7,LTEXSA=7)
   
   
    yv0vjj
         INTEGER JYV0K1,JYV0K2,JYV0VX,JYV0VY,JYV0VZ,JYV0VM,JYV0PX,JYV0PY,
        +          JYV0PZ,JYV0PM,JYV0X1,JYV0X2,JYV0XM,JYV0C2,JYV0IC,JYV0P1,
        +          JYV0P2,JYV0EP,JYV0DM,JYV0S1,JYV0S2,LYV0VA
         PARAMETER(JYV0K1=1,JYV0K2=2,JYV0VX=3,JYV0VY=4,JYV0VZ=5,JYV0VM=6,
        +          JYV0PX=12,JYV0PY=13,JYV0PZ=14,JYV0PM=15,JYV0X1=21,
        +          JYV0X2=22,JYV0XM=23,JYV0C2=26,JYV0IC=27,JYV0P1=28,
        +          JYV0P2=31,JYV0EP=34,JYV0DM=55,JYV0S1=56,JYV0S2=57,
        +          LYV0VA=57)
   
   
   
    phstjj
         INTEGER JPHSTI,JPHSPI,JPHSCE,JPHSPH,LPHSTA
         PARAMETER(JPHSTI=1,JPHSPI=2,JPHSCE=3,JPHSPH=4,LPHSTA=4)
   
         parameter ( nhsmi = 0 , nhsmx = 190 )
         integer ifired(3,24,23)
         integer imodh(100),isch(100)
         LOGICAL FIRST
         DATA FIRST/.TRUE./
   
    bmacro
       set of intrinsic functions to handle BOS banks
   - # of words/row in bank with index ID
         LCOLS(ID) = IW(ID+1)
   - # of rows in bank with index ID
         LROWS(ID) = IW(ID+2)
   - index of next row in the bank with index ID
         KNEXT(ID) = ID + LMHLEN + IW(ID+1)*IW(ID+2)
   - index of row # NRBOS in the bank with index ID
         KROW(ID,NRBOS) = ID + LMHLEN + IW(ID+1)*(NRBOS-1)
   - # of free words in the bank with index ID
         LFRWRD(ID) = ID + IW(ID) - KNEXT(ID)
   - # of free rows in the bank with index ID
         LFRROW(ID) = LFRWRD(ID) / LCOLS(ID)
   - Lth integer element of the NRBOSth row of the bank with index ID
         ITABL(ID,NRBOS,L) = IW(ID+LMHLEN+(NRBOS-1)*IW(ID+1)+L)
   - Lth real element of the NRBOSth row of the bank with index ID
         RTABL(ID,NRBOS,L) = RW(ID+LMHLEN+(NRBOS-1)*IW(ID+1)+L)
   
         ndigh_e14=0
         IF (FIRST) THEN
           FIRST=.FALSE.
           NAPHST=NAMIND('PHST')
         ENDIF
         IF (IW(NAPHST).LE.0) return
         NHSTO=LROWS (IW(NAPHST))
         IF (NHSTO.LE.0) return
         KPHST=IW(NAPHST)
         nmod=0
         DO 100 IST=1,NHSTO
              get module #, subcomp #
           ITETHS=ITABL(KPHST,IST,JPHSTI)
           ISTKHS=1
           IF (ITETHS.GT.128) THEN
             ITETHS=ITETHS-128
             ISTKHS=2
           ENDIF
           if (iteths.le.nhsmi.or.iteths.gt.nhsmx) go to 100
           IPHIHS=ITABL(KPHST,IST,JPHSPI)
           CALL HFNDMD(ITETHS,IPHIHS,ISTKHS,ISUBHS,IMODHS,IOVRHS)
           if (ITABL(KPHST,IST,JPHSPH).eq.ihco) then
            nmod=nmod+1
            imodh(nmod)=imodhs
            isch(nmod)=isubhs
           endif
    100  continue
         nhtub=0
         khtub=iw(namind('HTUB'))
         call vzero(ifired(1,1,1),23*3*24)
         if (khtub.gt.0) then
          nhtub=lrows(khtub)
          do i=1,lrows(khtub)
           isc=itabl(khtub,i,1)
           imod=itabl(khtub,i,2)
           ilay=itabl(khtub,i,3)
           ifired(isc,imod,ilay)=ifired(isc,imod,ilay)+1
          enddo
          do ilay=1,23
           iuse=0
           do isc=1,3
            do imod=1,24
             if (ifired(isc,imod,ilay).ne.0) then
              do i=1,nmod
               if (isc.eq.isch(i).and.imod.eq.imodh(i)) iuse=1
              enddo
             endif
            enddo
           enddo
           if (iuse.eq.1) ndigh_e14=ndigh_e14+1
          enddo
         endif
         return
         END
 
3 PMOVE
         SUBROUTINE PMOVE(POINT,TPAR)
  ------------------------------------------------------------------------------
    CKEY MATCHING / INTERNAL
  ------------------------------------------------------------------------------
   Re-define the track parameters relative to a new point in space.
    Auxiliary to JULMATCH
    Author                                        Dave Brown 4-9-93
    Inputs arguments :
       POINT(3) = point in space
       TPAR(5)  = track parameters
    Outputs arguments :
        TPAR  updated
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   JULMATCH                                                                        
        |---- PMOVE                                                                
                   |----  COS                                 External             
                   |----  SIN                                 External             
                   |----  ATAN2                               External             
                   |----  ABS                                 External             
                   |----  NINT                                External             
   
 
3 QBMTAG
         SUBROUTINE QBMTAG(METHOD,NTRACK,NJET,TRKJET,PROBTRK,FRF2TRK,
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
        +                  PVTX,SVTX,DJET,
        +                  CLMASS,CTSTAR,NSEC,CLMASJ,CTSTAJ,NSECJ,
        +                  LISTTRK,LISTEH,LISTJET)
   Invariant mass b tag.
      Can be called after QIPBTAG or QVSRCH, to further increase b purity.
   
    For each event-half, QBMTAG loops over tracks in order of decreasing
    inconsistency with primary vertex, and stops when their combined
    invariant mass exceeds 1.8 GeV. (i.e. The mass of a typical charmed
    hadron). It then returns a tag, CLMASS, indicating the probablity the
    that the "last track" used came from primary vertex.
      For a very high purity tag, CLMASS should be combined with the
    QIPTBAG or QVSRCH tags. The optimal linear combination (together with
    suggested cuts) is
           0.7*CLMASS - 0.3*log10(QIPBTAG) > 2.4
      or   0.7*CLMASS + 0.3*QVSRCH > 8.3
   
       Author: I.Tomalin  24/3/95
       Mod: I. Tomalin 10/3/99 - Output confidence levels for jets.
   
    Input Arguments:
       INTE METHOD    : =1 if using QIPBTAG, =2 if using QVSRCH.
     Following only needed if METHOD=1 (dummy otherwise):
       INTE NTRACK    : Number of tracks used by QIPBTAG.
       INTE NJET      : Number of jets considered by QIPBTAG.
       INTE TRKJET(*) : ALPHA track number of QIPBTAG jets.
       REAL PROBTRK(*): QIPBTAG track probabilities.
       INTE FRF2TRK(*): Row in FRFT bank of QIPBTAG tracks.
     Following only needed if METHOD=2 (dummy otherwise):
       REAL PVTX(3)   : Position of primary vertex from QVSRCH.
       REAL SVTX(3,2) : Positions of two secondary vertices in jet
                        coordinate system from QVSRCH.
       REAL DJET(3,2) : Unitized jet directions from QVSRCH.
   
    Output Arguments. (Dimensioned 2 to correspond to two event-halves):
       REAL CLMASS(2) : For METHOD=1, = -log10(confidence level) for
                        "last track" to come from primary vertex
                        (c.l. in range 0-1).
                        For METHOD=2, = QSQT(CHI**2 (primary) minus
                        CHI**2 (secondary)) for "last track".
       REAL CTSTAR(2) : Decay angle of "last track" in "b" rest frame.
       INTE NSEC(2)   : Number of tracks used to reach 1.8 GeV mass.
                        (zero if couldn't reach 1.8 GeV).
   
    Following jet info available only if METHOD=1:
       REAL CLMASJ(*) : Same variables for jets (ordered as in TRKJET)
       REAL CLSTAJ(*) :            "
       INTE NSECJ(*)  :            "
   
       INTE LISTTRK(*): List of all ALPHA charged tracks and V0s which
                        were considered by QBMTAG.
                        If the track is neutral, it is a V0. If a V0
                        is not in the range KFV0T-KLV0T, then it has
                        been created using YTOP, and its daughters
                        are (refitted) copies of tracks from the
                        KFCHT-KLCHT section.
       INTE LISTEH(*) : If track comtributed to 1.8 GeV hemisphere mass,
                        then =1 or =2 to show which hemisphere it's in.
                        If =0, then track was rejected.
       INTE LISTJET(*): If track comtributed to 1.8 GeV jet mass,
                        then =ALPHA track number of jet.
                        If =0, then track was rejected.
   B. IF METHOD=1, then one can obtain higher purities by using the
   BNEG card. This allows QIPBTAG and QBMTAG to use information from
    +ve and -ve impact parameter tracks. (See ALNEWS 1389 in
    folder). If one omits this card, however, then in the same
    as one can measure the uds efficiency of QIPBTAG using the -ve
    tag NPROBHEMI, it is possible to create a -ve tag from
   BMTAG for the same purpose. This can be done by calling it with
    NPROBTRK instead of PROBTRK.
   
   
   
   
   
   
   
   
   
   
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
              QBMTAG                                                               
                   |----  SIGN                                External             
                   |----  SQRT                                External             
                   |----  ABS                                 External             
                   |----  NINT                                External             
                   |----  KMATIX                              External             
                   |----  ATG                                 External             
                   |----  KCLARM                              External             
                   |----  IAND                                External             
                   |----  KLOCK0                              External             
                   |----  IABS                                External             
                   |----  KPDIR                                                    
                   |----  QVDROP                                                   
                   |----  KCHT                                                     
                   |----  KVSAVE                                                   
                   |----  KVFITN                                                   
                   |----  QVSETM                                                   
                   |----  QPMASS                                                   
                   |----  LOG10                               External             
                   |----  QVSTVA                                                   
                   |----  QVSTCHI2                                                 
                   |----  MIN                                 External             
                   |----  SORTZV                              External             
                   |----  KVNEW                                                    
                   |----  FLOAT                               External             
                   |----  QVADDN                                                   
                   |----  MAX                                 External             
                   |----  QDECAN                                                   
                   |----  QVZERO                                                   
   
 
3 QCALE14
         subroutine qcale14(e14ec,e14hc)
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
    the energy in a cone 14 degrees around the beam pipe
   Author G. Taylor Oct 1997
    version on 23/10/97 use PECO/PHCO with slightly more
    definition of energy
   
   -------------------- /QCDE/ --- COMMONs, DIMENSIONs, etc. ------------
   
    of QCDESH ----------------------- Description in QDATA ---------
         PARAMETER (KCQDET=34, KCQFPA=8, KCQPAR=10, KCQVEC=73, KCQVRT=30,
        & KHE=1, KHMU=2, KHPI=3, KHK=4, KHP=5, KHPHOT=1, KHNHAD=2,
        & KMONTE=-2, KRECO=-1, KLOCKM=14, KSOVT=1, KSCHT=2, KSIST=3,
        & KSAST=4, KSEHT=5, KSV0T=6, KSDCT=7, KSEFT=8, KSNET=9, KSGAT=10,
        & KSJET=11, KSMCT=12, KSREV=13,
        & KSMCV=14, KUNDEF=-12344321, QQPI=3.141593, QQE=2.718282,
        & QQ2PI=QQPI*2., QQPIH=QQPI/2., QQRADP=180./QQPI, QQC=2.997925E10,
        & QQH=6.582173E-25, QQHC=QQH*QQC, QQIRP=.00029979)
         CHARACTER CQDATE*8, CQDWRK*80, CQFHIS*80, CQFOUT*80, CQFWRK*80,
        & CQHTIT*80, CQSEC*3, CQTIME*8, CQUNPK*30, CQVERS*6, CQRLST*800,
        & CQELST*800
         COMMON /QCDEC/ CQDATE, CQDWRK, CQFHIS, CQFOUT, CQFWRK, CQHTIT,
        & CQSEC(14), CQTIME, CQUNPK, CQVERS, CQRLST, CQELST
         COMMON /QCDE/ QELEP, QMFLD ,QMFLDC, QTIME, QTIMEI, QTIMEL,
        & QTIMES, QTIMET, QDHEEC, QDHEEL, QDHEPF, QDHETH, QDHEPH, QDHEEF,
        & QDHEET, QDHET1, QDHEP1, QDHET2, QDHEP2, QDHEE1, QDHEE2, QDHEE3,
        & QKEVRN, QKEVWT, QVXNOM, QVYNOM, QVZNOM, QVXNSG, QVYNSG, QVZNSG,
        & QINLUM, QRINLN, QRINLU, QDBOFS, QEECWI(36), QVXBOM, QVYBOM,
        & QSILUM, QRSLLU, QRSLBK, QRSLEW , QVTXBP(3), QVTEBP(3), QVTSBP(3)
         COMMON /QCDE/  KFOVT, KLOVT, KNOVT, KFCHT, KLCHT, KNCHT, KFIST,
        & KLIST, KNIST, KFAST, KLAST, KNAST, KFEHT, KLEHT, KNEHT, KFV0T,
        & KLV0T, KNV0T, KFDCT, KLDCT, KNDCT, KFEFT, KLEFT, KNEFT, KFNET,
        & KLNET, KNNET, KFGAT, KLGAT, KNGAT, KFJET, KLJET, KNJET, KFMCT,
        & KLMCT, KNMCT, KFREV, KLREV, KNREV, KFMCV, KLMCV, KNMCV, KLUST,
        & KLUSV, KFFRT, KLFRT, KFFRV, KLFRV, KNRET, KNCOT, KFFRD,
        & KLFJET,KLLJET,KLNJET
         COMMON /QCDE/ KBIT(32), KCLACO(KCQFPA), KCLAFR(KCQFPA), KCLARM
        & (KCQFPA), KDEBUG, KEVT, KEXP, KFFILL, KFEOUT, KJOPTN(2,2),
        & KLEOUT, KLROUT, KLOCK0(KLOCKM,2), KLOCK1(KLOCKM,2), KLOCK2(
        & KLOCKM,2), KMATIX(6,6), KMQFPA, KNEFIL, KNEOUT, KNEVT, KNPAST,
        & KNQDET, KNQFPA, KNQLIN, KNQMTX, KNQPAR, KNQPST, KNREIN, KNREOU,
        & KOQDET, KOQFPA, KOQLIN, KOQMTL, KOQMTS, KOQPAR, KOQPBT, KOQPLI,
        & KOQTRA, KOQVEC, KOQVRT, KQPAR, KQVEC, KQVRT, KQWRK, KQZER, KRUN,
        & KSTATU, KTDROP, KUCARD, KUCONS, KUHIST, KUINPU, KUOUTP, KUPRNT,
        & KUPTER, KDEBU1, KDEBU2, KNWRLM, KEFOPT, KUEDIN, KUEDOU, KURTOX,
        & KUCAR2, KNHDRN, KNBHAB, KSBHAB, KRSLLQ, KRSLNB
         COMMON /QCDE/ INDATA
         COMMON /QCDE/ KRINNE, KRINNF, KRINDC, KRINDQ, KRINNZ, KRINNB,
        & KRINBM, KRINFR, KRINLR, KRINLF
         COMMON /QCDE/ KEVERT, KEVEDA, KEVETI, KEVEMI(4), KEVETY, KEVEES,
        & KDHEFP, KDHENP, KDHENM, KKEVNT, KKEVNV, KKEVID, KDHENX, KDHENV,
        & KDHENJ, KREVDS, KXTET1, KXTET2, KXTEL2, KXTCGC, KXTCLL, KXTCBN,
        & KXTCCL, KXTCHV, KXTCEN, KCLASW, KERBOM, KBPSTA
         DIMENSION KLOCUS(3,14)
         EQUIVALENCE (KLOCUS(1,1),KFOVT), (KFOVT,KFRET), (KLIST,KLRET),
        & (KFIST,KFCOT), (KLAST,KLCOT)
         COMMON /QCDE/ XCOPYJ, XFLIAC, XHISTO, XLREV(2), XLREV2(2), XMCEV,
        & XMINI, XSYNTX, XWREVT, XWRRUN, XFILMC, XFILCH, XFILV0, XFILCO,
        & XFILEF, XFILPC, XFILGA, XFILJE,
        & XPRHIS, XFILL, XVITC, XVTPC, XVECAL, XVLCAL, XVTPCD,
        & XVSATR, XVHCAL, XHVTRG, XSREC, XWMINI, XIOKLU, XIOKSI, XFRF2,
        & XNSEQ, XVDOK, XFRF0, XFMUID, XFILEM, XWNANO, XROKSI, XGETBP,
        & XJTHRU
         LOGICAL XCOPYJ, XFLIAC, XHISTO, XLREV, XLREV2, XMCEV, XMINI,
        & XSYNTX, XWREVT, XWRRUN, XFILMC, XFILCH, XFILV0, XFILCO, XFILEF,
        & XFILPC, XPRHIS, XFILL, XVITC, XVTPC, XVECAL, XVLCAL, XVTPCD,
        & XVSATR, XVHCAL, XHVTRG, XSREC, XWMINI, XIOKLU, XFRF2, XFILJE,
        & XNSEQ, XFILGA, XVDOK, XFRF0, XFMUID, XFILEM, XWNANO, XIOKSI,
        & XROKSI, XGETBP, XJTHRU
   
   -------------------- /NANCOM/ --- NanoDst steering -------------------
   Xnano   .true. if input is a nanodst (in nano or epio format, depending
                      XNANOR)
   
         LOGICAL XNANO
         COMMON /NANCOM/XNANO
   
   
    bcs
         INTEGER LMHLEN, LMHCOL, LMHROW
         PARAMETER (LMHLEN=2, LMHCOL=1, LMHROW=2)
         COMMON /BCS/   IW(1000)
         INTEGER IW
         REAL RW(1000)
         EQUIVALENCE (RW(1),IW(1))
   
   
   ------------------ /QCNAMI/ --- name indices -------------------------
         COMMON /QCNAMI/ NAAFID,NAAJOB,NAASEV,NABCNT,NABHIT,NABOMB,
        1 NABOME,NABOMP,NABOMR,NABPTR,NADCAL,NADCRL,NADECO,NADEID,NADENF,
        2 NADEVT,NADEWI,NADFMC,NADFOT,NADGAM,NADHCO,NADHEA,NADHRL,NADJET,
        3 NADMID,NADMJT,NADMUO,NADNEU,NADPOB,NADRES,NADTBP,NADTMC,NADTRA,
        4 NADVER,NADVMC,NAECRQ,NAECTE,NAEGID,NAEGPC,NAEIDT,NAEJET,NAERRF,
        5 NAETDI,NAETKC,NAEVEH,NAEWHE,NAFICL,NAFKIN,NAFPOI,NAFPOL,NAFRFT,
        6 NAFRID,NAFRTL,NAFSTR,NAFTCL,NAFTCM,NAFTOC,NAFTTM,NAFVCL,NAFVER,
        7 NAFZFR,NAHCCV,NAHCTE,NAHINF,NAHMAD,NAHPDI,NAHROA,NAHSDA,NAHTUB,
        8 NAIASL,NAIPJT,NAIRJT,NAITCO,NAITMA,NAIXTR,NAIZBD,NAJBER,NAJEST,
        9 NAJSUM,NAKEVH,NAKINE,NAKJOB,NAKLIN,NAKPOL,NAKRUN,NALIDT,NALOLE,
        A NALUPA,NAMCAD,NAMHIT,NAMTHR,NAMUDG,NAMUEX,NAOSTS,NAPART,NAPASL,
        B NAPCHY,NAPCOB,NAPCOI,NAPCPA,NAPCQA,NAPCRL,NAPECO,NAPEHY,NAPEID,
        C NAPEMH,NAPEPT,NAPEST,NAPEWI,NAPFER,NAPFHR,NAPFRF,NAPFRT,NAPHCO,
        D NAPHER,NAPHHY,NAPHMH,NAPHST,NAPIDI,NAPITM,NAPLID,NAPLPD,NAPLSD,
        E NAPMSK,NAPNEU,NAPPDS,NAPPOB,NAPPRL,NAPRTM,NAPSCO,NAPSPO,NAPSTR,
        F NAPT2X,NAPTBC,NAPTCO,NAPTEX,NAPTMA,NAPTML,NAPTNC,NAPTST,NAPVCO,
        G NAPYER,NAPYFR,NAPYNE,NAQDET,NAQFPA,NAQLIN,NAQMTL,NAQMTS,NAQPAR,
        H NAQPBT,NAQPLI,NAQTRA,NAQVEC,NAQVRT,NAQWRK,NAQZER,NAREVH,NARHAH,
        I NARTLO,NARTLS,NARUNH,NARUNR,NASFTR,NATEXS,NATGMA,NATMTL,NATPCO,
        J NAVCOM,NAVCPL,NAVDCO,NAVDHT,NAVDXY,NAVDZT,NAVERT,NAVFHL,NAVFLG,
        K NAVFPH,NAVHLS,NAVPLH,NAX1AD,NAX1SC,NAX1TI,NAX2DF,NAX3EC,NAX3EW,
        L NAX3HC,NAX3IT,NAX3L2,NAX3LU,NAX3TM,NAX3TO,NAX3TP,NAX3X3,NAXTBN,
        M NAXTBP,NAXTCN,NAXTEB,NAXTOP,NAXTRB,NAYV0V,NAZPFR,NAEFOL,NAMUID,
        N NAPGID,NAPGPC,NAPGAC,NAPMSC,NAPTHR,NANBIP,NAPDLT,NAPMLT,NAPLJT
   
   
   ------------------ /QQQQJJ/ --- HAC parameters for ALPHA banks -------
         PARAMETER (JQVEQX= 1,JQVEQY= 2,JQVEQZ= 3,JQVEQE= 4,JQVEQM= 5,
        & JQVEQP= 6,JQVECH= 7,JQVETN= 8,JQVESC= 9,JQVEKS=10,JQVECL=11,
        & JQVEPA=12,JQVEQD=13,JQVENP=14,JQVESP=15,JQVEOV=16,JQVEEV=17,
        & JQVEND=18,JQVEDL=19,JQVENO=20,JQVEOL=21,JQVENM=22,JQVEML=23,
        & JQVEBM=24,JQVELK=38,JQVEDB=39,JQVEZB=40,JQVESD=41,JQVESZ=42,
        & JQVECB=43,JQVEEM=44,JQVECF=54,JQVEEW=55,JQVEUS=56)
         PARAMETER ( JQVRVX=1,JQVRVY=2,JQVRVZ=3,JQVRVN=4,JQVRTY=5,
        1   JQVRIP=6,JQVRND=7,JQVRDL=8,JQVRAY=9,JQVRAF=10,JQVREM=11,
        2   JQVRCF=17,JQVRET=18)
         PARAMETER ( JQDEAF= 1,JQDEAL= 2,JQDENT= 3,JQDEAT= 4,JQDELT= 8,
        &  JQDEAE= 9,JQDEAH=10,JQDEAM=11,JQDECF=12,JQDEEC=13,JQDEHC=14,
        &  JQDEET=15,JQDEFI=16,JQDENF=17,JQDEFL=18,JQDENE=19,JQDEEL=20,
        &  JQDENH=21,JQDEHL=22,JQDELH=23,JQDEEF=24,JQDEPC=25,JQDEEG=26,
        &  JQDEMU=27,JQDEDX=28,JQDEPG=29,JQDEPD=30,JQDEPM=31)
         PARAMETER ( JQPAGN=1, JQPANA=2, JQPACO=5, JQPAMA=6, JQPACH=7,
        & JQPALT=8,JQPAWI=9,JQPAAN=10)
   
   
         EXTERNAL CQPART, CQTPN, XCEQAN, XLUMOK, XPEQAN, XPEQOR, XPEQU,
        & XVDEOK, LLUMOK, SLUMOK
         CHARACTER * 12 CQPART, CQTPN
         LOGICAL XCAL, XCEQAN, XCEQOR, XCEQU, XECAL, XEID, XFRF, XHCAL,
        & XHMA, XLOCK, XLOCKN, XMC, XLUMOK, XMCA, XPEO, XPHO, XPEQAN,
        & XPEQOR, XPEQU, XSAME, XSIG, XTEX, XPEC, XPEP, XPHC, XYV0,
        & XFRIQF, XEFO, XPCQ, XEGP, XMUI, XVDEOK, XPGP, LLUMOK, SLUMOK,
        & XPGAC, XLEPTG, XLEPTH
   
    alcons
    define universal constants
         REAL PI, TWOPI, PIBY2, PIBY3, PIBY4, PIBY6, PIBY8, PIBY12
         REAL RADEG, DEGRA
         REAL CLGHT, ALDEDX
         PARAMETER (PI=3.141592653589)
         PARAMETER (RADEG=180./PI, DEGRA=PI/180.)
         PARAMETER (TWOPI = 2.*PI , PIBY2 = PI/2., PIBY4 = PI/4.)
         PARAMETER (PIBY6 = PI/6. , PIBY8 = PI/8.)
         PARAMETER (PIBY12= PI/12., PIBY3 = PI/3.)
         PARAMETER (CLGHT = 29.9792458, ALDEDX = 0.000307)
   
         ALDEDX  = constant used in the computation of DEDX in GeV
         CLGHT   = speed of light in cm/nsec
   
   
   
    efoljj
         INTEGER JEFOPX,JEFOPY,JEFOPZ,JEFOEW,JEFOWE,JEFOTY,JEFOLE,JEFOLT,
        +          JEFOLH,JEFOLC,JEFOLJ,LEFOLA
         PARAMETER(JEFOPX=1,JEFOPY=2,JEFOPZ=3,JEFOEW=4,JEFOWE=5,JEFOTY=6,
        +          JEFOLE=7,JEFOLT=8,JEFOLH=9,JEFOLC=10,JEFOLJ=11,
        +          LEFOLA=11)
   
   
    egpcjj
         INTEGER JEGPPX,JEGPPY,JEGPPZ,JEGPR1,JEGPR2,JEGPF4,JEGPDM,JEGPST,
        +          JEGPQU,JEGPPE,LEGPCA
         PARAMETER(JEGPPX=1,JEGPPY=2,JEGPPZ=3,JEGPR1=4,JEGPR2=5,JEGPF4=6,
        +          JEGPDM=7,JEGPST=8,JEGPQU=9,JEGPPE=10,LEGPCA=10)
   
   
    eidtjj
         INTEGER JEIDIF,JEIDR1,JEIDR2,JEIDR3,JEIDR4,JEIDR5,JEIDR6,JEIDR7,
        +          JEIDEC,JEIDIP,JEIDE1,JEIDE2,JEIDE3,JEIDFR,JEIDPE,LEIDTA
         PARAMETER(JEIDIF=1,JEIDR1=2,JEIDR2=3,JEIDR3=4,JEIDR4=5,JEIDR5=6,
        +          JEIDR6=7,JEIDR7=8,JEIDEC=9,JEIDIP=10,JEIDE1=11,
        +          JEIDE2=12,JEIDE3=13,JEIDFR=14,JEIDPE=15,LEIDTA=15)
   
   
    frftjj
         INTEGER JFRFIR,JFRFTL,JFRFP0,JFRFD0,JFRFZ0,JFRFAL,JFRFEM,JFRFC2,
        +          JFRFDF,JFRFNO,LFRFTA
         PARAMETER(JFRFIR=1,JFRFTL=2,JFRFP0=3,JFRFD0=4,JFRFZ0=5,JFRFAL=6,
        +          JFRFEM=7,JFRFC2=28,JFRFDF=29,JFRFNO=30,LFRFTA=30)
   
   
    fridjj
         INTEGER JFRIBP,JFRIDZ,JFRIBC,JFRIDC,JFRIPE,JFRIPM,JFRIPI,JFRIPK,
        +          JFRIPP,JFRINK,JFRIQF,LFRIDA
         PARAMETER(JFRIBP=1,JFRIDZ=2,JFRIBC=3,JFRIDC=4,JFRIPE=5,JFRIPM=6,
        +          JFRIPI=7,JFRIPK=8,JFRIPP=9,JFRINK=10,JFRIQF=11,
        +          LFRIDA=11)
   
   
    frtljj
         INTEGER JFRTIV,JFRTNV,JFRTII,JFRTNI,JFRTNE,JFRTIT,JFRTNT,JFRTNR,
        +          LFRTLA
         PARAMETER(JFRTIV=1,JFRTNV=2,JFRTII=3,JFRTNI=4,JFRTNE=5,JFRTIT=6,
        +          JFRTNT=7,JFRTNR=8,LFRTLA=8)
   
   
    hmadjj
         INTEGER JHMANF,JHMANE,JHMANL,JHMAMH,JHMAIG,JHMAED,JHMACS,JHMAND,
        +          JHMAIE,JHMAIT,JHMAIF,JHMATN,LHMADA
         PARAMETER(JHMANF=1,JHMANE=2,JHMANL=3,JHMAMH=4,JHMAIG=5,JHMAED=6,
        +          JHMACS=7,JHMAND=8,JHMAIE=9,JHMAIT=10,JHMAIF=11,
        +          JHMATN=12,LHMADA=12)
   
   
    mcadjj
         INTEGER JMCANH,JMCADH,JMCADC,JMCAAM,JMCAAC,JMCATN,LMCADA
         PARAMETER(JMCANH=1,JMCADH=3,JMCADC=5,JMCAAM=7,JMCAAC=8,JMCATN=9,
        +          LMCADA=9)
   
   
    muidjj
         INTEGER JMUIIF,JMUISR,JMUIDM,JMUIST,JMUITN,LMUIDA
         PARAMETER(JMUIIF=1,JMUISR=2,JMUIDM=3,JMUIST=4,JMUITN=5,LMUIDA=5)
   
   
    pcqajj
         INTEGER JPCQNA,JPCQPX,JPCQPY,JPCQPZ,JPCQEN,LPCQAA
         PARAMETER(JPCQNA=1,JPCQPX=2,JPCQPY=3,JPCQPZ=4,JPCQEN=5,LPCQAA=5)
   
   
    pdltjj
         INTEGER JPDLPA,JPDLJT,JPDLPI,JPDLPE,JPDLVP,JPDLFR,LPDLTA
         PARAMETER(JPDLPA=1,JPDLJT=2,JPDLPI=3,JPDLPE=4,JPDLVP=5,JPDLFR=6,
        +          LPDLTA=6)
   
   
    pecojj
         INTEGER JPECER,JPECE1,JPECE2,JPECTH,JPECPH,JPECEC,JPECKD,JPECCC,
        +          JPECRB,JPECPC,LPECOA
         PARAMETER(JPECER=1,JPECE1=2,JPECE2=3,JPECTH=4,JPECPH=5,JPECEC=6,
        +          JPECKD=7,JPECCC=8,JPECRB=9,JPECPC=10,LPECOA=10)
   
   
    peptjj
         INTEGER JPEPT1,JPEPP1,JPEPT3,JPEPP3,LPEPTA
         PARAMETER(JPEPT1=1,JPEPP1=2,JPEPT3=3,JPEPP3=4,LPEPTA=4)
   
   
    pgacjj
         INTEGER JPGAEC,JPGATC,JPGAPC,JPGAR1,JPGAR2,JPGAF4,JPGADM,JPGAST,
        +          JPGAQU,JPGAQ1,JPGAQ2,JPGAM1,JPGAM2,JPGAMA,JPGAER,JPGATR,
        +          JPGAPR,JPGAEF,JPGAGC,JPGAZS,JPGAPL,JPGAPH,JPGAPN,JPGAFA,
        +          JPGAPE,LPGACA
         PARAMETER(JPGAEC=1,JPGATC=2,JPGAPC=3,JPGAR1=4,JPGAR2=5,JPGAF4=6,
        +          JPGADM=7,JPGAST=8,JPGAQU=9,JPGAQ1=10,JPGAQ2=11,
        +          JPGAM1=12,JPGAM2=13,JPGAMA=14,JPGAER=15,JPGATR=16,
        +          JPGAPR=17,JPGAEF=18,JPGAGC=19,JPGAZS=20,JPGAPL=21,
        +          JPGAPH=22,JPGAPN=23,JPGAFA=24,JPGAPE=25,LPGACA=25)
   
   
    pgpcjj
         INTEGER JPGPEC,JPGPTC,JPGPPC,JPGPR1,JPGPR2,JPGPF4,JPGPDM,JPGPST,
        +          JPGPQU,JPGPQ1,JPGPQ2,JPGPM1,JPGPM2,JPGPMA,JPGPER,JPGPTR,
        +          JPGPPR,JPGPPE,LPGPCA
         PARAMETER(JPGPEC=1,JPGPTC=2,JPGPPC=3,JPGPR1=4,JPGPR2=5,JPGPF4=6,
        +          JPGPDM=7,JPGPST=8,JPGPQU=9,JPGPQ1=10,JPGPQ2=11,
        +          JPGPM1=12,JPGPM2=13,JPGPMA=14,JPGPER=15,JPGPTR=16,
        +          JPGPPR=17,JPGPPE=18,LPGPCA=18)
   
   
    phcojj
         INTEGER JPHCER,JPHCTH,JPHCPH,JPHCEC,JPHCKD,JPHCCC,JPHCRB,JPHCNF,
        +          JPHCPC,LPHCOA
         PARAMETER(JPHCER=1,JPHCTH=2,JPHCPH=3,JPHCEC=4,JPHCKD=5,JPHCCC=6,
        +          JPHCRB=7,JPHCNF=8,JPHCPC=9,LPHCOA=9)
   
   
    pmltjj
         INTEGER JPMLFL,JPMLPO,JPMLCH,JPMLSP,JPMLLE,JPMLME,JPMLKT,JPMLFR,
        +          LPMLTA
         PARAMETER(JPMLFL=1,JPMLPO=2,JPMLCH=3,JPMLSP=4,JPMLLE=5,JPMLME=6,
        +          JPMLKT=7,JPMLFR=8,LPMLTA=8)
   
   
    texsjj
         INTEGER JTEXSI,JTEXTM,JTEXTL,JTEXNS,JTEXAD,JTEXTN,JTEXSF,LTEXSA
         PARAMETER(JTEXSI=1,JTEXTM=2,JTEXTL=3,JTEXNS=4,JTEXAD=5,JTEXTN=6,
        +          JTEXSF=7,LTEXSA=7)
   
   
    yv0vjj
         INTEGER JYV0K1,JYV0K2,JYV0VX,JYV0VY,JYV0VZ,JYV0VM,JYV0PX,JYV0PY,
        +          JYV0PZ,JYV0PM,JYV0X1,JYV0X2,JYV0XM,JYV0C2,JYV0IC,JYV0P1,
        +          JYV0P2,JYV0EP,JYV0DM,JYV0S1,JYV0S2,LYV0VA
         PARAMETER(JYV0K1=1,JYV0K2=2,JYV0VX=3,JYV0VY=4,JYV0VZ=5,JYV0VM=6,
        +          JYV0PX=12,JYV0PY=13,JYV0PZ=14,JYV0PM=15,JYV0X1=21,
        +          JYV0X2=22,JYV0XM=23,JYV0C2=26,JYV0IC=27,JYV0P1=28,
        +          JYV0P2=31,JYV0EP=34,JYV0DM=55,JYV0S1=56,JYV0S2=57,
        +          LYV0VA=57)
   
   
         real eplane(45),estack(3)
   
   -------------------- /QMACRO/ --- statement functions ----------------
   
    bmacro
       set of intrinsic functions to handle BOS banks
   - # of words/row in bank with index ID
         LCOLS(ID) = IW(ID+1)
   - # of rows in bank with index ID
         LROWS(ID) = IW(ID+2)
   - index of next row in the bank with index ID
         KNEXT(ID) = ID + LMHLEN + IW(ID+1)*IW(ID+2)
   - index of row # NRBOS in the bank with index ID
         KROW(ID,NRBOS) = ID + LMHLEN + IW(ID+1)*(NRBOS-1)
   - # of free words in the bank with index ID
         LFRWRD(ID) = ID + IW(ID) - KNEXT(ID)
   - # of free rows in the bank with index ID
         LFRROW(ID) = LFRWRD(ID) / LCOLS(ID)
   - Lth integer element of the NRBOSth row of the bank with index ID
         ITABL(ID,NRBOS,L) = IW(ID+LMHLEN+(NRBOS-1)*IW(ID+1)+L)
   - Lth real element of the NRBOSth row of the bank with index ID
         RTABL(ID,NRBOS,L) = RW(ID+LMHLEN+(NRBOS-1)*IW(ID+1)+L)
   
   -------------------- /QCFUNC/ --- statement functions for ALPHA banks
         KJQDET(KI)=IW(KOQVEC+KI*KCQVEC+JQVEQD)
         QSQT(QF)=SIGN(SQRT(ABS(QF)),QF)
         QP(KI)=RW(KOQVEC+KI*KCQVEC+JQVEQP)
         QX(KI)=RW(KOQVEC+KI*KCQVEC+JQVEQX)
         QY(KI)=RW(KOQVEC+KI*KCQVEC+JQVEQY)
         QZ(KI)=RW(KOQVEC+KI*KCQVEC+JQVEQZ)
         QE(KI)=RW(KOQVEC+KI*KCQVEC+JQVEQE)
         QM(KI)=RW(KOQVEC+KI*KCQVEC+JQVEQM)
         QCH(KI)=RW(KOQVEC+KI*KCQVEC+JQVECH)
         KCH(KI)=NINT (QCH(KI))
         QCT(KI)=QZ(KI)/QP(KI)
         QDB(KI)=RW(KOQVEC+KI*KCQVEC+JQVEDB)
         QZB(KI)=RW(KOQVEC+KI*KCQVEC+JQVEZB)
         QDBS2(KI)=RW(KOQVEC+KI*KCQVEC+JQVESD)
         QZBS2(KI)=RW(KOQVEC+KI*KCQVEC+JQVESZ)
         QBC2(KI)=RW(KOQVEC+KI*KCQVEC+JQVECB)
         QSIG(KI,KI1,KI2)=RW(KOQVEC+KI*KCQVEC+KMATIX(KI1,KI2)+JQVEEM)
         XSIG(KI)=RW(KOQVEC+KI*KCQVEC+JQVEEM).GE.0.
         QSMAT(KI,KI1)=RW(KOQVEC+KI*KCQVEC+KI1+JQVEEM)
         QSIGX(KI)=QSQT(QSMAT(KI,0))
         QSIGY(KI)=QSQT(QSMAT(KI,2))
         QSIGZ(KI)=QSQT(QSMAT(KI,5))
         QSIGEE(KI)=RW(KOQVEC+KI*KCQVEC+JQVEEM+9)
         QSIGE(KI)=QSQT(QSIGEE(KI))
         QSIGPP(KI)=(QX(KI)**2*QSMAT(KI,0)+QY(KI)**2*QSMAT(KI,2)+
        & QZ(KI)**2*QSMAT(KI,5)+2.*(QX(KI)*(QY(KI)*QSMAT(KI,1)+
        & QZ(KI)*QSMAT(KI,3))+QY(KI)*QZ(KI)*QSMAT(KI,4)))/QP(KI)**2
         QSIGP(KI)=QSQT(QSIGPP(KI))
         QSIGMM(KI)=QM(KI)*(QE(KI)**2*QSMAT(KI,9)+QX(KI)**2*QSMAT(KI,0)+
        & QY(KI)**2*QSMAT(KI,2)+QZ(KI)**2*QSMAT(KI,5)+2.*(QX(KI)*(QY(KI)
        & QSMAT(KI,1)+QZ(KI)*QSMAT(KI,3))+QY(KI)*QZ(KI)*QSMAT(KI,4)-
        & QE(KI)*(QX(KI)*QSMAT(KI,6)+QY(KI)*QSMAT(KI,7)+
        & QZ(KI)*QSMAT(KI,8))))/AMAX1(QM(KI)**3,1.E-16)
         QSIGM(KI)=QSQT(QSIGMM(KI))
         QMCHIF(KI)=RW(KOQVEC+KI*KCQVEC+JQVECF)
         QPH(KI)=ATG(QY(KI),QX(KI))
         QPT(KI)=SQRT(QX(KI)**2+QY(KI)**2)
         KTN(KI)=IW(KOQVEC+KI*KCQVEC+JQVETN)
         KMC(KI)=KCLARM(IW(KOQVEC+KI*KCQVEC+JQVECL))
         KBMASK(KI,KI1)=IW(KOQVEC+KI*KCQVEC+KI1+JQVEBM-1)
         KCALFL(KI)=IW(KJQDET(KI)+JQDECF)
         KCHGD(KI,KI1)=IW(KOQLIN+KI1+IW(KJQDET(KI)+JQDEFL))
         KCLASS(KI)=KCLACO(IW(KOQVEC+KI*KCQVEC+JQVECL))
         KDAU(KI,KI1)=IW(KOQLIN+KI1+IW(KOQVEC+KI*KCQVEC+JQVEDL))
         KECAL(KI,KI1)=IW(KOQLIN+KI1+IW(KJQDET(KI)+JQDEEL))
         KENDV(KI)=IW(KOQVEC+KI*KCQVEC+JQVEEV)
         KFOLLO(KI)=IW(KOQVEC+KI*KCQVEC+JQVENP)
         KHCAL(KI,KI1)=IW(KOQLIN+KI1+IW(KJQDET(KI)+JQDEHL))
         KLUNDS(KI)=IW(KOQVEC+KI*KCQVEC+JQVEKS)
         KNCHGD(KI)=IW(KJQDET(KI)+JQDENF)
         KNECAL(KI)=IW(KJQDET(KI)+JQDENE)
         KNHCAL(KI)=IW(KJQDET(KI)+JQDENH)
         KNMOTH(KI)=IW(KOQVEC+KI*KCQVEC+JQVENO)
         KMOTH(KI,KI1)=IW(KOQLIN+KI1+IW(KOQVEC+KI*KCQVEC+JQVEOL))
         KMTCH(KI,KI1)=IW(KOQMTL+KI1+IW(KOQVEC+KI*KCQVEC+JQVEML))
         KNDAU(KI)=IW(KOQVEC+KI*KCQVEC+JQVEND)
         KNMTCH(KI)=IW(KOQVEC+KI*KCQVEC+JQVENM)
         KORIV(KI)=IW(KOQVEC+KI*KCQVEC+JQVEOV)
         KSAME(KI)=IW(KOQVEC+KI*KCQVEC+JQVESP)
         KSMTCH(KI,KI1)=IW(KOQMTS+KI1+IW(KOQVEC+KI*KCQVEC+JQVEML))
         KSTABC(KI)=IW(KOQVEC+KI*KCQVEC+JQVESC)
         KTPCOD(KI)=IW(KOQVEC+KI*KCQVEC+JQVEPA)
         XLOCKN(KI,KI1)=IAND(KBMASK(KI,KI1),KLOCK0(KI1,KMC(KI))).NE.0
         XLOCK(KI)=IW(KOQVEC+KI*KCQVEC+JQVELK).NE.0.OR.XLOCKN(KI,1).OR.
        & XLOCKN(KI,2).OR.XLOCKN(KI,3).OR.XLOCKN(KI,4).OR.
        & XLOCKN(KI,5).OR.XLOCKN(KI,6).OR.XLOCKN(KI,7).OR.
        & XLOCKN(KI,8).OR.XLOCKN(KI,9).OR.XLOCKN(KI,10).OR.
        & XLOCKN(KI,11).OR.XLOCKN(KI,12).OR.XLOCKN(KI,13).OR.
        & XLOCKN(KI,14)
         XMC(KI)=KCLARM(IW(KOQVEC+KI*KCQVEC+JQVECL)).NE.1
         QRDFL(KI,KI1)=RW(KOQVEC+KI*KCQVEC+JQVEUS+KI1-1)
         KRDFL(KI,KI1)=IW(KOQVEC+KI*KCQVEC+JQVEUS+KI1-1)
         XCAL(KI)=IW(KJQDET(KI)+JQDECF).NE.0
         XECAL(KI)=IABS(IW(KJQDET(KI)+JQDECF)).EQ.1
         XHCAL(KI)=IABS(IW(KJQDET(KI)+JQDECF)).EQ.2
         QVX(KI)=RW(KOQVRT+KI*KCQVRT+JQVRVX)
         QVY(KI)=RW(KOQVRT+KI*KCQVRT+JQVRVY)
         QVZ(KI)=RW(KOQVRT+KI*KCQVRT+JQVRVZ)
         KVN(KI)=IW(KOQVRT+KI*KCQVRT+JQVRVN)
         KVTYPE(KI)=IW(KOQVRT+KI*KCQVRT+JQVRTY)
         KVINCP(KI)=IW(KOQVRT+KI*KCQVRT+JQVRIP)
         KVNDAU(KI)=IW(KOQVRT+KI*KCQVRT+JQVRND)
         KVYV0V(KI)=IW(KOQVRT+KI*KCQVRT+JQVRAY)
         KVFVER(KI)=IW(KOQVRT+KI*KCQVRT+JQVRAF)
         KVDAU(KI,KI1)=IW(KOQLIN+KI1+IW(KOQVRT+KI*KCQVRT+JQVRDL))
         QVEM(KI,KI1,KI2)=RW(KOQVRT+KI*KCQVRT+KMATIX(KI1,KI2)+JQVREM)
         QVCHIF(KI)=RW(KOQVRT+KI*KCQVRT+JQVRCF)
         QVDIF2(KI1,KI2)=SQRT((QVX(KI1)-QVX(KI2))**2+(QVY(KI1)-
        &QVY(KI2))**2)
         QVDIF3(KI1,KI2)=SQRT((QVX(KI1)-QVX(KI2))**2+(QVY(KI1)-
        &QVY(KI2))**2+ (QVZ(KI1)-QVZ(KI2))**2)
         QMSQ2(KI1,KI2)=(QE(KI1)+QE(KI2))**2-(QX(KI1)+QX(KI2))**2-
        & (QY(KI1)+QY(KI2))**2-(QZ(KI1)+QZ(KI2))**2
         QMSQ3(KI1,KI2,KI3)=(QE(KI1)+QE(KI2)+QE(KI3))**2-
        & (QX(KI1)+QX(KI2)+QX(KI3))**2-(QY(KI1)+QY(KI2)+QY(KI3))**2-
        & (QZ(KI1)+QZ(KI2)+QZ(KI3))**2
         QMSQ4(KI1,KI2,KI3,KI4)=(QE(KI1)+QE(KI2)+QE(KI3)+QE(KI4))**2-
        & (QX(KI1)+QX(KI2)+QX(KI3)+QX(KI4))**2-(QY(KI1)+QY(KI2)+
        & QY(KI3)+QY(KI4))**2-(QZ(KI1)+QZ(KI2)+QZ(KI3)+QZ(KI4))**2
         QM2(KI1,KI2)=QSQT(QMSQ2(KI1,KI2))
         QM3(KI1,KI2,KI3)=QSQT(QMSQ3(KI1,KI2,KI3))
         QM4(KI1,KI2,KI3,KI4)=QSQT(QMSQ4(KI1,KI2,KI3,KI4))
         QDMSQ(KI1,KI2)=(QE(KI1)-QE(KI2))**2-(QX(KI1)-QX(KI2))**2-
        & (QY(KI1)-QY(KI2))**2-(QZ(KI1)-QZ(KI2))**2
         QBETA(KI)=QP(KI)/QE(KI)
         QGAMMA(KI)=1./SQRT((1.-QBETA(KI))*(1.+QBETA(KI)))
         QDOT3(KI1,KI2)=QX(KI1)*QX(KI2)+QY(KI1)*QY(KI2)+QZ(KI1)*QZ(KI2)
         QDOT4(KI1,KI2)=QE(KI1)*QE(KI2)-QDOT3(KI1,KI2)
         QCOSA(KI1,KI2)=QDOT3(KI1,KI2)/(QP(KI1)*QP(KI2))
         QPPAR(KI1,KI2)=QDOT3(KI1,KI2)/QP(KI2)
         QPPER(KI1,KI2)=SQRT((QY(KI1)*QZ(KI2)-QZ(KI1)*QY(KI2))**2+
        & (QZ(KI1)*QX(KI2)-QX(KI1)*QZ(KI2))**2+
        & (QX(KI1)*QY(KI2)-QY(KI1)*QX(KI2))**2)/QP(KI2)
         XSAME(KI1,KI2)=IAND(KBMASK(KI1,1),KBMASK(KI2,1)).NE.0.OR.
        & IAND(KBMASK(KI1,2),KBMASK(KI2,2)).NE.0.OR.
        & IAND(KBMASK(KI1,3),KBMASK(KI2,3)).NE.0.OR.
        & IAND(KBMASK(KI1,4),KBMASK(KI2,4)).NE.0.OR.
        & IAND(KBMASK(KI1,5),KBMASK(KI2,5)).NE.0.OR.
        & IAND(KBMASK(KI1,6),KBMASK(KI2,6)).NE.0.OR.
        & IAND(KBMASK(KI1,7),KBMASK(KI2,7)).NE.0.OR.
        & IAND(KBMASK(KI1,8),KBMASK(KI2,8)).NE.0.OR.
        & IAND(KBMASK(KI1,9),KBMASK(KI2,9)).NE.0.OR.
        & IAND(KBMASK(KI1,10),KBMASK(KI2,10)).NE.0.OR.
        & IAND(KBMASK(KI1,11),KBMASK(KI2,11)).NE.0.OR.
        & IAND(KBMASK(KI1,12),KBMASK(KI2,12)).NE.0.OR.
        & IAND(KBMASK(KI1,13),KBMASK(KI2,13)).NE.0.OR.
        & IAND(KBMASK(KI1,14),KBMASK(KI2,14)).NE.0
         QCMASS(KI)=RW(KOQPAR+KI*KCQPAR+JQPAMA)
         QCCHAR(KI)=RW(KOQPAR+KI*KCQPAR+JQPACH)
         QCLIFE(KI)=RW(KOQPAR+KI*KCQPAR+JQPALT)
         QCWIDT(KI)=RW(KOQPAR+KI*KCQPAR+JQPAWI)
         XCEQOR(KI,KI1)=KTPCOD(KI).EQ.KI1.OR.
        & KTPCOD(KI).EQ.IW(KOQPAR+KI1*KCQPAR+JQPAAN)
         XCEQU(KI,KI1)=KTPCOD(KI).EQ.KI1
      QCFDET
         XFRF(KI)=IW(KJQDET(KI)+JQDEAF).NE.KQZER
         QFRFIR(KI)=RW(IW(KJQDET(KI)+JQDEAF)+JFRFIR)
         QFRFTL(KI)=RW(IW(KJQDET(KI)+JQDEAF)+JFRFTL)
         QFRFP0(KI)=RW(IW(KJQDET(KI)+JQDEAF)+JFRFP0)
         QFRFD0(KI)=RW(IW(KJQDET(KI)+JQDEAF)+JFRFD0)
         QFRFZ0(KI)=RW(IW(KJQDET(KI)+JQDEAF)+JFRFZ0)
         QFRFAL(KI)=RW(IW(KJQDET(KI)+JQDEAF)+JFRFAL)
         QFRFEM(KI,KI1,KI2)=RW(IW(KJQDET(KI)+JQDEAF)+
        & KMATIX(KI1,KI2)+JFRFEM)
         QFRFC2(KI)=RW(IW(KJQDET(KI)+JQDEAF)+JFRFC2)
         KFRFDF(KI)=IW(IW(KJQDET(KI)+JQDEAF)+JFRFDF)
         KFRFNO(KI)=IW(IW(KJQDET(KI)+JQDEAF)+JFRFNO)
         KFRTNV(KI)=IW(IW(KJQDET(KI)+JQDEAL)+JFRTNV)
         KFRTNI(KI)=IW(IW(KJQDET(KI)+JQDEAL)+JFRTNI)
         KFRTNE(KI)=IW(IW(KJQDET(KI)+JQDEAL)+JFRTNE)
         KFRTNT(KI)=IW(IW(KJQDET(KI)+JQDEAL)+JFRTNT)
         KFRTNR(KI)=IW(IW(KJQDET(KI)+JQDEAL)+JFRTNR)
         KFRIBP(KI)=IW(IW(KJQDET(KI)+JQDEFI)+JFRIBP)
         KFRIDZ(KI)=IW(IW(KJQDET(KI)+JQDEFI)+JFRIDZ)
         KFRIBC(KI)=IW(IW(KJQDET(KI)+JQDEFI)+JFRIBC)
         KFRIDC(KI)=IW(IW(KJQDET(KI)+JQDEFI)+JFRIDC)
         QFRIPE(KI)=RW(IW(KJQDET(KI)+JQDEFI)+JFRIPE)
         QFRIPM(KI)=RW(IW(KJQDET(KI)+JQDEFI)+JFRIPM)
         QFRIPI(KI)=RW(IW(KJQDET(KI)+JQDEFI)+JFRIPI)
         QFRIPK(KI)=RW(IW(KJQDET(KI)+JQDEFI)+JFRIPK)
         QFRIPP(KI)=RW(IW(KJQDET(KI)+JQDEFI)+JFRIPP)
         QFRINK(KI)=RW(IW(KJQDET(KI)+JQDEFI)+JFRINK)
         KFRIQF(KI)=IW(IW(KJQDET(KI)+JQDEFI)+JFRIQF)
         XFRIQF(KI)=KFRIQF(KI).EQ.1.OR.KFRIQF(KI).EQ.3
         KNTEX(KI)=IW(KJQDET(KI)+JQDENT)
         XTEX(KI)=IW(KJQDET(KI)+JQDENT).NE.0
         KTEXSI(KI,KI1)=IW(IW(KJQDET(KI)+KI1+JQDENT)+JTEXSI)
         QTEXTM(KI,KI1)=RW(IW(KJQDET(KI)+KI1+JQDENT)+JTEXTM)
         QTEXTL(KI,KI1)=RW(IW(KJQDET(KI)+KI1+JQDENT)+JTEXTL)
         KTEXNS(KI,KI1)=IW(IW(KJQDET(KI)+KI1+JQDENT)+JTEXNS)
         QTEXAD(KI,KI1)=RW(IW(KJQDET(KI)+KI1+JQDENT)+JTEXAD)
         XEID(KI)=IW(KJQDET(KI)+JQDEAE).NE.KQZER
         KEIDIF(KI)=IW(IW(KJQDET(KI)+JQDEAE)+JEIDIF)
         QEIDRI(KI,KI1)=RW(IW(KJQDET(KI)+JQDEAE)+KI1+JEIDR1-1)
         QEIDEC(KI)=RW(IW(KJQDET(KI)+JQDEAE)+JEIDEC)
         KEIDIP(KI)=IW(IW(KJQDET(KI)+JQDEAE)+JEIDIP)
         QEIDEI(KI,KI1)=RW(IW(KJQDET(KI)+JQDEAE)+KI1+JEIDE1-1)
         XHMA(KI)=IW(KJQDET(KI)+JQDEAH).NE.KQZER
         KHMANF(KI)=IW(IW(KJQDET(KI)+JQDEAH)+JHMANF)
         KHMANE(KI)=IW(IW(KJQDET(KI)+JQDEAH)+JHMANE)
         KHMANL(KI)=IW(IW(KJQDET(KI)+JQDEAH)+JHMANL)
         KHMAMH(KI)=IW(IW(KJQDET(KI)+JQDEAH)+JHMAMH)
         KHMAIG(KI)=IW(IW(KJQDET(KI)+JQDEAH)+JHMAIG)
         QHMAED(KI)=RW(IW(KJQDET(KI)+JQDEAH)+JHMAED)
         QHMACS(KI)=RW(IW(KJQDET(KI)+JQDEAH)+JHMACS)
         KHMAND(KI)=IW(IW(KJQDET(KI)+JQDEAH)+JHMAND)
         KHMAIE(KI)=IW(IW(KJQDET(KI)+JQDEAH)+JHMAIE)
         KHMAIT(KI)=IW(IW(KJQDET(KI)+JQDEAH)+JHMAIT)
         KHMAIF(KI)=IW(IW(KJQDET(KI)+JQDEAH)+JHMAIF)
         XMCA(KI)=IW(KJQDET(KI)+JQDEAM).NE.KQZER
         KMCANH(KI,KI1)=IW(IW(KJQDET(KI)+JQDEAM)+KI1+JMCANH-1)
         QMCADH(KI,KI1)=RW(IW(KJQDET(KI)+JQDEAM)+KI1+JMCADH-1)
         QMCADC(KI,KI1)=RW(IW(KJQDET(KI)+JQDEAM)+KI1+JMCADC-1)
         QMCAAM(KI)=RW(IW(KJQDET(KI)+JQDEAM)+JMCAAM)
         QMCAAC(KI)=RW(IW(KJQDET(KI)+JQDEAM)+JMCAAC)
         XMUI(KI)=IW(KJQDET(KI)+JQDEMU).NE.KQZER
         KMUIIF(KI)=IW(IW(KJQDET(KI)+JQDEMU)+JMUIIF)
         QMUISR(KI)=RW(IW(KJQDET(KI)+JQDEMU)+JMUISR)
         QMUIDM(KI)=RW(IW(KJQDET(KI)+JQDEMU)+JMUIDM)
         KMUIST(KI)=IW(IW(KJQDET(KI)+JQDEMU)+JMUIST)
         KMUITN(KI)=IW(IW(KJQDET(KI)+JQDEMU)+JMUITN)
         XPEC(KI)=IW(KJQDET(KI)+JQDEEC).NE.KQZER
         QPECER(KI)=RW(IW(KJQDET(KI)+JQDEEC)+JPECER)
         QPECE1(KI)=RW(IW(KJQDET(KI)+JQDEEC)+JPECE1)
         QPECE2(KI)=RW(IW(KJQDET(KI)+JQDEEC)+JPECE2)
         QPECTH(KI)=RW(IW(KJQDET(KI)+JQDEEC)+JPECTH)
         QPECPH(KI)=RW(IW(KJQDET(KI)+JQDEEC)+JPECPH)
         QPECEC(KI)=RW(IW(KJQDET(KI)+JQDEEC)+JPECEC)
         KPECKD(KI)=IW(IW(KJQDET(KI)+JQDEEC)+JPECKD)
         KPECCC(KI)=IW(IW(KJQDET(KI)+JQDEEC)+JPECCC)
         KPECRB(KI)=IW(IW(KJQDET(KI)+JQDEEC)+JPECRB)
         KPECPC(KI)=IW(IW(KJQDET(KI)+JQDEEC)+JPECPC)
         XPEP(KI)=IW(KJQDET(KI)+JQDEET).NE.KQZER
         QPEPT1(KI)=RW(IW(KJQDET(KI)+JQDEET)+JPEPT1)
         QPEPP1(KI)=RW(IW(KJQDET(KI)+JQDEET)+JPEPP1)
         QPEPT3(KI)=RW(IW(KJQDET(KI)+JQDEET)+JPEPT3)
         QPEPP3(KI)=RW(IW(KJQDET(KI)+JQDEET)+JPEPP3)
         XPHC(KI)=IW(KJQDET(KI)+JQDEHC).NE.KQZER
         QPHCER(KI)=RW(IW(KJQDET(KI)+JQDEHC)+JPHCER)
         QPHCTH(KI)=RW(IW(KJQDET(KI)+JQDEHC)+JPHCTH)
         QPHCPH(KI)=RW(IW(KJQDET(KI)+JQDEHC)+JPHCPH)
         QPHCEC(KI)=RW(IW(KJQDET(KI)+JQDEHC)+JPHCEC)
         KPHCKD(KI)=IW(IW(KJQDET(KI)+JQDEHC)+JPHCKD)
         KPHCCC(KI)=IW(IW(KJQDET(KI)+JQDEHC)+JPHCCC)
         KPHCRB(KI)=IW(IW(KJQDET(KI)+JQDEHC)+JPHCRB)
         KPHCPC(KI)=IW(IW(KJQDET(KI)+JQDEHC)+JPHCPC)
         XEFO(KI)=IW(KJQDET(KI)+JQDEEF).NE.KQZER
         QEFOWE(KI)=RW(IW(KJQDET(KI)+JQDEEF)+JEFOWE)
         KEFOTY(KI)=IW(IW(KJQDET(KI)+JQDEEF)+JEFOTY)
         KEFOLE(KI)=IW(IW(KJQDET(KI)+JQDEEF)+JEFOLE)
         KEFOLT(KI)=IW(IW(KJQDET(KI)+JQDEEF)+JEFOLT)
         KEFOLH(KI)=IW(IW(KJQDET(KI)+JQDEEF)+JEFOLH)
         KEFOLC(KI)=IW(IW(KJQDET(KI)+JQDEEF)+JEFOLC)
         KEFOLJ(KI)=IW(IW(KJQDET(KI)+JQDEEF)+JEFOLJ)
         XPCQ(KI)=IW(KJQDET(KI)+JQDEPC).NE.KQZER
         KPCQNA(KI)=IW(IW(KJQDET(KI)+JQDEPC)+JPCQNA)
         XEGP(KI)=IW(KJQDET(KI)+JQDEEG).NE.KQZER
         QEGPR1(KI)=RW(IW(KJQDET(KI)+JQDEEG)+JEGPR1)
         QEGPR2(KI)=RW(IW(KJQDET(KI)+JQDEEG)+JEGPR2)
         QEGPF4(KI)=RW(IW(KJQDET(KI)+JQDEEG)+JEGPF4)
         QEGPDM(KI)=RW(IW(KJQDET(KI)+JQDEEG)+JEGPDM)
         KEGPST(KI)=IW(IW(KJQDET(KI)+JQDEEG)+JEGPST)
         KEGPQU(KI)=IW(IW(KJQDET(KI)+JQDEEG)+JEGPQU)
         KEGPPE(KI)=IW(IW(KJQDET(KI)+JQDEEG)+JEGPPE)
         XPGP(KI)=IW(KJQDET(KI)+JQDEPG).NE.KQZER.AND.IW(NAPGPC).GT.0
         QPGPR1(KI)=RW(IW(KJQDET(KI)+JQDEPG)+JPGPR1)
         QPGPR2(KI)=RW(IW(KJQDET(KI)+JQDEPG)+JPGPR2)
         QPGPF4(KI)=RW(IW(KJQDET(KI)+JQDEPG)+JPGPF4)
         QPGPDM(KI)=RW(IW(KJQDET(KI)+JQDEPG)+JPGPDM)
         QPGPST(KI)=RW(IW(KJQDET(KI)+JQDEPG)+JPGPST)
         QPGPQ1(KI)=RW(IW(KJQDET(KI)+JQDEPG)+JPGPQ1)
         QPGPQ2(KI)=RW(IW(KJQDET(KI)+JQDEPG)+JPGPQ2)
         QPGPM1(KI)=RW(IW(KJQDET(KI)+JQDEPG)+JPGPM1)
         QPGPM2(KI)=RW(IW(KJQDET(KI)+JQDEPG)+JPGPM2)
         QPGPMA(KI)=RW(IW(KJQDET(KI)+JQDEPG)+JPGPMA)
         QPGPER(KI)=RW(IW(KJQDET(KI)+JQDEPG)+JPGPER)
         QPGPTR(KI)=RW(IW(KJQDET(KI)+JQDEPG)+JPGPTR)
         QPGPPR(KI)=RW(IW(KJQDET(KI)+JQDEPG)+JPGPPR)
         KPGPQU(KI)=IW(IW(KJQDET(KI)+JQDEPG)+JPGPQU)
         KPGPPE(KI)=IW(IW(KJQDET(KI)+JQDEPG)+JPGPPE)
         XPGAC(KI)=IW(KJQDET(KI)+JQDEPG).NE.KQZER.AND.IW(NAPGAC).GT.0
         KPGAST(KI)=IW(IW(KJQDET(KI)+JQDEPG)+JPGAST)
         QPGAEF(KI)=RW(IW(KJQDET(KI)+JQDEPG)+JPGAEF)
         QPGAGC(KI)=RW(IW(KJQDET(KI)+JQDEPG)+JPGAGC)
         QPGAZS(KI)=RW(IW(KJQDET(KI)+JQDEPG)+JPGAZS)
         QPGAPL(KI)=RW(IW(KJQDET(KI)+JQDEPG)+JPGAPL)
         QPGAPH(KI)=RW(IW(KJQDET(KI)+JQDEPG)+JPGAPH)
         KPGAPN(KI)=IW(IW(KJQDET(KI)+JQDEPG)+JPGAPN)
         KPGAFA(KI)=IW(IW(KJQDET(KI)+JQDEPG)+JPGAFA)
         KPGAPE(KI)=IW(IW(KJQDET(KI)+JQDEPG)+JPGAPE)
         XYV0(KI)=KVYV0V(KENDV(KI)).NE.0
         KYV0K1(KI)=IW(KVYV0V(KENDV(KI))+JYV0K1)
         KYV0K2(KI)=IW(KVYV0V(KENDV(KI))+JYV0K2)
         QYV0VX(KI)=RW(KVYV0V(KENDV(KI))+JYV0VX)
         QYV0VY(KI)=RW(KVYV0V(KENDV(KI))+JYV0VY)
         QYV0VZ(KI)=RW(KVYV0V(KENDV(KI))+JYV0VZ)
         QYV0X1(KI)=RW(KVYV0V(KENDV(KI))+JYV0X1)
         QYV0X2(KI)=RW(KVYV0V(KENDV(KI))+JYV0X2)
         QYV0C2(KI)=RW(KVYV0V(KENDV(KI))+JYV0C2)
         KYV0IC(KI)=IW(KVYV0V(KENDV(KI))+JYV0IC)
         QYV0DM(KI)=RW(KVYV0V(KENDV(KI))+JYV0DM)
         QYV0S1(KI)=RW(KVYV0V(KENDV(KI))+JYV0S1)
         QYV0S2(KI)=RW(KVYV0V(KENDV(KI))+JYV0S2)
         XLEPTG(KI)=IW(KJQDET(KI)+JQDEPD).NE.KQZER
         KLEPPA(KI)=IW(IW(KJQDET(KI)+JQDEPD)+JPDLPA)
         KLEPJT(KI)=IW(IW(KJQDET(KI)+JQDEPD)+JPDLJT)+KLFJET-1
         QLEPPI(KI)=RW(IW(KJQDET(KI)+JQDEPD)+JPDLPI)
         QLEPPE(KI)=RW(IW(KJQDET(KI)+JQDEPD)+JPDLPE)
         KLEPVP(KI)=IW(IW(KJQDET(KI)+JQDEPD)+JPDLVP)
         XLEPTH(KI)=IW(KJQDET(KI)+JQDEPM).NE.KQZER
         KLEPFL(KI)=IW(IW(KJQDET(KI)+JQDEPM)+JPMLFL)
         KLEPPO(KI)=IW(IW(KJQDET(KI)+JQDEPM)+JPMLPO)
         KLEPCH(KI)=IW(IW(KJQDET(KI)+JQDEPM)+JPMLCH)
         KLEPSP(KI)=IW(IW(KJQDET(KI)+JQDEPM)+JPMLSP)
         KLEPLE(KI)=IW(IW(KJQDET(KI)+JQDEPM)+JPMLLE)
         KLEPME(KI)=IW(IW(KJQDET(KI)+JQDEPM)+JPMLME)
         KLEPKT(KI)=IW(IW(KJQDET(KI)+JQDEPM)+JPMLKT)
   
   
         e14ec=0.
         itk=kpdir('ECAL',kreco)
         do while(itk.ne.0)
          act=abs(qct(itk))
          if (act.ge..97) then
           if (kpeckd(itk).lt.192) then
   AL : Require at least 200 MeV in the ECAL to avoid noise
          require also that there is at least 100 MeV of energy
          in the wires (excluding the most energetic wires)
            iwireok=0
            do i=1,36
             e=epad_e14(ktn(itk),i)
             if (e.gt.0) then
              call qgetw_e14(i,eplane,estack,esum,t0)
              emx=0.
              es=0.
              do iplane=1,45
               if (eplane(iplane).gt.emx) emx=eplane(iplane)
               es=es+eplane(iplane)
              enddo
              if (es-emx.gt..1) iwireok=1
             endif
            enddo
            if (iwireok.eq.1.and.qe(itk).gt..2) e14ec=e14ec+qe(itk)
           else if (kpeckd(itk).eq.192) then
   AL : for lcal energy simply require that there is some pad energy
          somewhere in the LCAL
            kplpd=iw(namind('PLPD'))
            if (kplpd.gt.0.and.lrows(kplpd).gt.0) e14ec=e14ec+qe(itk)
           else
   AL : always take sical energy
            e14ec=e14ec+qe(itk)
           endif
          endif
          itk=kfollo(itk)
         enddo
   
         e14hc=0.
         itk=kpdir('HCAL',kreco)
         do while(itk.ne.0)
          act=abs(qct(itk))
   AL : require that there always be at least 3 fired digital planes
          in the same module as the hcal energy
          if (act.ge..97.and.ndigh_e14(ktn(itk)).gt.2)
        &     e14hc=e14hc+qe(itk)
          itk=kfollo(itk)
         enddo
         RETURN
         END
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   QFDE14                                                                          
        |---- QCALE14                                                              
                   |----  SIGN                                External             
                   |----  SQRT                                External             
                   |----  ABS                                 External             
                   |----  NINT                                External             
                   |----  KMATIX                              External             
                   |----  ATG                                 External             
                   |----  KCLARM                              External             
                   |----  IAND                                External             
                   |----  KLOCK0                              External             
                   |----  IABS                                External             
                   |----  KPDIR                                                    
                   |----  QCT                                 External             
                   |----  KPECKD                              External             
                   |----  EPAD_E14                                                 
                   |----  KTN                                 External             
                   |----  QGETW_E14                                                
                   |----  QE                                  External             
                   |----  IW                                  External             
                   |----  NAMIND                              External             
                   |----  LROWS                               External             
                   |----  KFOLLO                              External             
   
 
3 QDDX
         subroutine qddx(itk, nhyp, rmass, Q, ns,
  ------------------------------------------------------------------------------
    CKEY DEDX /USER
  ------------------------------------------------------------------------------
        &     npad,extimator, ier)
   De/dx analysis in alpha
    By Tommaso Boccali, 1999
    computes the best extimation for de/dx, using wires and pads
    INPUT:
        itk         : ALPHA TRACK
        nhyp        : Number of hypotheses to be tested
        rmass       : vector(1..nhyp) of the masses of the tests
        Q           : vector(1..nhyp) of the charge of the tests
    OUTPUT:
        ns          : number of wires available, -1 if no wires info
        npad        : number of pads (REAL!!!!), -1 if no pad info
        extimator   : (ri-rexp)/sigma for each test particle
        ier         : 1 if no information was available
                    : 0 if an estimator was calculated
         implicit none
   
   ALPHA Version 122 - Implicit declaration include file : 12 April 1996
   
    bmacrod
         INTEGER LCOLS, LROWS, KROW, KNEXT, ITABL,LFRWRD, LFRROW
         REAL RTABL
         INTEGER ID, NRBOS, L
   
         REAL ATG
         REAL QQPI,QQE,QQ2PI,QQPIH,QQRADP,QQC,QQH,QQHC,QQIRP,QELEP,QMFLD
         REAL QMFLDC,QTIME,QTIMEI,QTIMEL,QTIMES,QTIMET,QDHEEC,QDHEEL
         REAL QDHEPF,QDHETH,QDHEPH,QDHEEF,QDHEET,QDHET1,QDHEP1,QDHET2
         REAL QDHEP2,QDHEE1,QDHEE2,QDHEE3,QKEVRN,QKEVWT,QVXNOM,QVYNOM
         REAL QVZNOM,QVXNSG,QVYNSG,QVZNSG,QINLUM,QRINLN,QRINLU,QDBOFS
         REAL QEECWI,QVXBOM,QVYBOM,QSILUM,QRSLLU,QRSLBK,QRSLEW,QVTXBP
         REAL QVTEBP,QVTSBP,QSQT,QF,QP,QX,QY,QZ,QE,QM,QCH,QCT,QDB
         REAL QZB,QDBS2,QZBS2,QBC2,QSIG,QSMAT,QSIGX,QSIGY,QSIGZ,QSIGEE
         REAL QSIGE,QSIGPP,QSIGP,QSIGMM,QSIGM,QMCHIF,QPH,QPT,QRDFL,QVX,QVY
         REAL QVZ,QVEM,QVCHIF,QVDIF2,QVDIF3,QMSQ2,QMSQ3,QMSQ4,QM2,QM3,QM4
         REAL QDMSQ,QBETA,QGAMMA,QDOT3,QDOT4,QCOSA,QPPAR,QPPER,QCMASS
         REAL QCCHAR,QCLIFE,QCWIDT,QFRFIR,QFRFTL,QFRFP0,QFRFD0,QFRFZ0
         REAL QFRFAL,QFRFEM,QFRFC2,QFRIPE,QFRIPM,QFRIPI,QFRIPK,QFRIPP
         REAL QFRINK,QTEXTM,QTEXTL,QTEXAD,QEIDRI,QEIDEC,QEIDEI,QHMAED
         REAL QHMACS,QMCADH,QMCADC,QMCAAM,QMCAAC,QMUISR,QMUIDM,QPECER
         REAL QPECE1,QPECE2,QPECTH,QPECPH,QPECEC,QPEPT1,QPEPP1,QPEPT3
         REAL QPEPP3,QPHCER,QPHCTH,QPHCPH,QPHCEC,QEFOWE,QEGPR1,QEGPR2
         REAL QEGPF4,QEGPDM,QPGPR1,QPGPR2,QPGPF4,QPGPDM,QPGPST,QPGPQ1
         REAL QPGPQ2,QPGPM1,QPGPM2,QPGPMA,QPGPER,QPGPTR,QPGPPR,QYV0VX
         REAL QYV0VY,QYV0VZ,QYV0X1,QYV0X2,QYV0C2,QYV0DM,QYV0S1,QYV0S2
         REAL QDECA2,QDECAN,QMASV0,QMCHI2,QMDIFF,QPCHAR,QPLIFE,QPMASS
         REAL QPWIDT,QKBLOK,QPGAEF,QPGAGC,QPGAZS,QPGAPL,QPGAPH
         REAL QLEPPI,QLEPPE
         INTEGER KI, KI1,KI2
         INTEGER KCQDET,KCQFPA,KCQPAR,KCQVEC,KCQVRT,KHE,KHMU,KHPI,KHK,KHP
         INTEGER KHPHOT,KHNHAD,KMONTE,KRECO,KLOCKM,KSOVT,KSCHT,KSIST,KSAST
         INTEGER KSEHT,KSV0T,KSDCT,KSEFT,KSNET,KSGAT,KSJET,KSMCT,KSREV
         INTEGER KSMCV,KUNDEF,KFOVT,KLOVT,KNOVT,KFCHT,KLCHT,KNCHT,KFIST
         INTEGER KLIST,KNIST,KFAST,KLAST,KNAST,KFEHT,KLEHT,KNEHT,KFV0T
         INTEGER KLV0T,KNV0T,KFDCT,KLDCT,KNDCT,KFEFT,KLEFT,KNEFT,KFNET
         INTEGER KLNET,KNNET,KFGAT,KLGAT,KNGAT,KFJET,KLJET,KNJET,KFMCT
         INTEGER KLMCT,KNMCT,KFREV,KLREV,KNREV,KFMCV,KLMCV,KNMCV,KLUST
         INTEGER KLUSV,KFFRT,KLFRT,KFFRV,KLFRV,KNRET,KNCOT,KFFRD,KBIT
         INTEGER KCLACO,KCLAFR,KCLARM,KDEBUG,KEVT,KEXP,KFFILL,KFEOUT
         INTEGER KJOPTN,KLEOUT,KLROUT,KLOCK0,KLOCK1,KLOCK2,KMATIX,KMQFPA
         INTEGER KNEFIL,KNEOUT,KNEVT,KNPAST,KNQDET,KNQFPA,KNQLIN,KNQMTX
         INTEGER KNQPAR,KNQPST,KNREIN,KNREOU,KOQDET,KOQFPA,KOQLIN,KOQMTL
         INTEGER KOQMTS,KOQPAR,KOQPBT,KOQPLI,KOQTRA,KOQVEC,KOQVRT,KQPAR
         INTEGER KQVEC,KQVRT,KQWRK,KQZER,KRUN,KSTATU,KTDROP,KUCARD,KUCONS
         INTEGER KUHIST,KUINPU,KUOUTP,KUPRNT,KUPTER,KDEBU1,KDEBU2,KNWRLM
         INTEGER KEFOPT,KUEDIN,KUEDOU,KURTOX,KUCAR2,KNHDRN,KNBHAB,KSBHAB
         INTEGER KRSLLQ,KRSLNB,INDATA,KRINNE,KRINNF,KRINDC,KRINDQ,KRINNZ
         INTEGER KRINNB,KRINBM,KRINFR,KRINLR,KRINLF,KEVERT,KEVEDA,KEVETI
         INTEGER KEVEMI,KEVETY,KEVEES,KDHEFP,KDHENP,KDHENM,KKEVNT,KKEVNV
         INTEGER KKEVID,KDHENX,KDHENV,KDHENJ,KREVDS,KXTET1,KXTET2,KXTEL2
         INTEGER KXTCGC,KXTCLL,KXTCBN,KXTCCL,KXTCHV,KXTCEN,KCLASW,KERBOM
         INTEGER KBPSTA,KLOCUS,KFRET,KLRET,KFCOT,KLCOT,NAAFID,NAAJOB
         INTEGER NAASEV,NABCNT,NABHIT,NABOMB,NABOME,NABOMP,NABOMR,NABPTR
         INTEGER NADCAL,NADCRL,NADECO,NADEID,NADENF,NADEVT,NADEWI,NADFMC
         INTEGER NADFOT,NADGAM,NADHCO,NADHEA,NADHRL,NADJET,NADMID,NADMJT
         INTEGER NADMUO,NADNEU,NADPOB,NADRES,NADTBP,NADTMC,NADTRA,NADVER
         INTEGER NADVMC,NAECRQ,NAECTE,NAEGID,NAEGPC,NAEIDT,NAEJET,NAERRF
         INTEGER NAETDI,NAETKC,NAEVEH,NAEWHE,NAFICL,NAFKIN,NAFPOI,NAFPOL
         INTEGER NAFRFT,NAFRID,NAFRTL,NAFSTR,NAFTCL,NAFTCM,NAFTOC,NAFTTM
         INTEGER NAFVCL,NAFVER,NAFZFR,NAHCCV,NAHCTE,NAHINF,NAHMAD,NAHPDI
         INTEGER NAHROA,NAHSDA,NAHTUB,NAIASL,NAIPJT,NAIRJT,NAITCO,NAITMA
         INTEGER NAIXTR,NAIZBD,NAJBER,NAJEST,NAJSUM,NAKEVH,NAKINE,NAKJOB
         INTEGER NAKLIN,NAKPOL,NAKRUN,NALIDT,NALOLE,NALUPA,NAMCAD,NAMHIT
         INTEGER NAMTHR,NAMUDG,NAMUEX,NAOSTS,NAPART,NAPASL,NAPCHY,NAPCOB
         INTEGER NAPCOI,NAPCPA,NAPCQA,NAPCRL,NAPECO,NAPEHY,NAPEID,NAPEMH
         INTEGER NAPEPT,NAPEST,NAPEWI,NAPFER,NAPFHR,NAPFRF,NAPFRT,NAPHCO
         INTEGER NAPHER,NAPHHY,NAPHMH,NAPHST,NAPIDI,NAPITM,NAPLID,NAPLPD
         INTEGER NAPLSD,NAPMSK,NAPNEU,NAPPDS,NAPPOB,NAPPRL,NAPRTM,NAPSCO
         INTEGER NAPSPO,NAPSTR,NAPT2X,NAPTBC,NAPTCO,NAPTEX,NAPTMA,NAPTML
         INTEGER NAPTNC,NAPTST,NAPVCO,NAPYER,NAPYFR,NAPYNE,NAQDET,NAQFPA
         INTEGER NAQLIN,NAQMTL,NAQMTS,NAQPAR,NAQPBT,NAQPLI,NAQTRA,NAQVEC
         INTEGER NAQVRT,NAQWRK,NAQZER,NAREVH,NARHAH,NARTLO,NARTLS,NARUNH
         INTEGER NARUNR,NASFTR,NATEXS,NATGMA,NATMTL,NATPCO,NAVCOM,NAVCPL
         INTEGER NAVDCO,NAVDHT,NAVDXY,NAVDZT,NAVERT,NAVFHL,NAVFLG,NAVFPH
         INTEGER NAVHLS,NAVPLH,NAX1AD,NAX1SC,NAX1TI,NAX2DF,NAX3EC,NAX3EW
         INTEGER NAX3HC,NAX3IT,NAX3L2,NAX3LU,NAX3TM,NAX3TO,NAX3TP,NAX3X3
         INTEGER NAXTBN,NAXTBP,NAXTCN,NAXTEB,NAXTOP,NAXTRB,NAYV0V,NAZPFR
         INTEGER NANBIP,NAPGAC,NAPMSC,NAPTHR,NAPDLT,NAPMLT,NAPLJT
         INTEGER NAEFOL,NAMUID,NAPGID,NAPGPC,JQVEQX,JQVEQY,JQVEQZ,JQVEQE
         INTEGER JQVEQM,JQVEQP,JQVECH,JQVETN,JQVESC,JQVEKS,JQVECL,JQVEPA
         INTEGER JQVEQD,JQVENP,JQVESP,JQVEOV,JQVEEV,JQVEND,JQVEDL,JQVENO
         INTEGER JQVEOL,JQVENM,JQVEML,JQVEBM,JQVELK,JQVEDB,JQVEZB,JQVESD
         INTEGER JQVESZ,JQVECB,JQVEEM,JQVECF,JQVEEW,JQVEUS,JQVRVX,JQVRVY
         INTEGER JQVRVZ,JQVRVN,JQVRTY,JQVRIP,JQVRND,JQVRDL,JQVRAY,JQVRAF
         INTEGER JQVREM,JQVRCF,JQVRET,JQDEAF,JQDEAL,JQDENT,JQDEAT,JQDELT
         INTEGER JQDEAE,JQDEAH,JQDEAM,JQDECF,JQDEEC,JQDEHC,JQDEET,JQDEFI
         INTEGER JQDENF,JQDEFL,JQDENE,JQDEEL,JQDENH,JQDEHL,JQDELH,JQDEEF
         INTEGER JQDEPC,JQDEEG,JQDEMU,JQDEDX,JQDEPG,JQPAGN,JQPANA,JQPACO
         INTEGER JQPAMA,JQPACH,JQPALT,JQPAWI,JQPAAN
         INTEGER KJQDET,KCH,KTN,KMC
         INTEGER KBMASK,KCALFL,KCHGD,KCLASS,KDAU,KECAL,KENDV,KFOLLO,KHCAL
         INTEGER KLUNDS,KNCHGD,KNECAL,KNHCAL,KNMOTH,KMOTH,KMTCH,KNDAU
         INTEGER KNMTCH,KORIV,KSAME,KSMTCH,KSTABC,KTPCOD,KRDFL,KVN,KVTYPE
         INTEGER KVINCP,KVNDAU,KVYV0V,KVFVER,KVDAU,KI3,KI4,KFRFDF,KFRFNO
         INTEGER KFRTNV,KFRTNI,KFRTNE,KFRTNT,KFRTNR,KFRIBP,KFRIDZ,KFRIBC
         INTEGER KFRIDC,KFRIQF,KNTEX,KTEXSI,KTEXNS,KEIDIF,KEIDIP,KHMANF
         INTEGER KHMANE,KHMANL,KHMAMH,KHMAIG,KHMAND,KHMAIE,KHMAIT,KHMAIF
         INTEGER KMCANH,KMUIIF,KMUIST,KMUITN,KPECKD,KPECCC,KPECRB,KPECPC
         INTEGER KPHCKD,KPHCCC,KPHCRB,KPHCPC,KEFOTY,KEFOLE,KEFOLT,KEFOLH
         INTEGER KEFOLC,KEFOLJ,KPCQNA,KEGPST,KEGPQU,KEGPPE,KPGPQU,KPGPPE
         INTEGER KYV0K1,KYV0K2,KYV0IC,KSCNEW,KSCOLD,KFPADR,KGLUND,KMCCOD
         INTEGER KCANTI,KCDIR,KCDIRA,KCHT,KIDSAV,KPANTI,KPART,KPDIR,KPDIRA
         INTEGER KTLOR,KTLOR1,KVFITA,KVFITC,KVFITM,KVFITN,KVFITV,KVFTMC
         INTEGER KTLORX,KVGOOD,KVNEW,KVSAVA,KVSAVC,KVSAVE,KPARTX,KPCCOMP
         INTEGER KPGAPN,KPGAFA,KPGAPE,KLEPPA,KLEPJT,KLEPFL,KLEPPO,KLEPCH
         INTEGER KPGAST,KLEPVP,KLEPSP,KLEPLE,KLEPME,KLEPKT,JQDEPD,JQDEPM
         INTEGER KLFJET,KLLJET,KLNJET,KLJTNO
   
   
   -------------------- /QCDE/ --- COMMONs, DIMENSIONs, etc. ------------
   
    of QCDESH ----------------------- Description in QDATA ---------
         PARAMETER (KCQDET=34, KCQFPA=8, KCQPAR=10, KCQVEC=73, KCQVRT=30,
        & KHE=1, KHMU=2, KHPI=3, KHK=4, KHP=5, KHPHOT=1, KHNHAD=2,
        & KMONTE=-2, KRECO=-1, KLOCKM=14, KSOVT=1, KSCHT=2, KSIST=3,
        & KSAST=4, KSEHT=5, KSV0T=6, KSDCT=7, KSEFT=8, KSNET=9, KSGAT=10,
        & KSJET=11, KSMCT=12, KSREV=13,
        & KSMCV=14, KUNDEF=-12344321, QQPI=3.141593, QQE=2.718282,
        & QQ2PI=QQPI*2., QQPIH=QQPI/2., QQRADP=180./QQPI, QQC=2.997925E10,
        & QQH=6.582173E-25, QQHC=QQH*QQC, QQIRP=.00029979)
         CHARACTER CQDATE*8, CQDWRK*80, CQFHIS*80, CQFOUT*80, CQFWRK*80,
        & CQHTIT*80, CQSEC*3, CQTIME*8, CQUNPK*30, CQVERS*6, CQRLST*800,
        & CQELST*800
         COMMON /QCDEC/ CQDATE, CQDWRK, CQFHIS, CQFOUT, CQFWRK, CQHTIT,
        & CQSEC(14), CQTIME, CQUNPK, CQVERS, CQRLST, CQELST
         COMMON /QCDE/ QELEP, QMFLD ,QMFLDC, QTIME, QTIMEI, QTIMEL,
        & QTIMES, QTIMET, QDHEEC, QDHEEL, QDHEPF, QDHETH, QDHEPH, QDHEEF,
        & QDHEET, QDHET1, QDHEP1, QDHET2, QDHEP2, QDHEE1, QDHEE2, QDHEE3,
        & QKEVRN, QKEVWT, QVXNOM, QVYNOM, QVZNOM, QVXNSG, QVYNSG, QVZNSG,
        & QINLUM, QRINLN, QRINLU, QDBOFS, QEECWI(36), QVXBOM, QVYBOM,
        & QSILUM, QRSLLU, QRSLBK, QRSLEW , QVTXBP(3), QVTEBP(3), QVTSBP(3)
         COMMON /QCDE/  KFOVT, KLOVT, KNOVT, KFCHT, KLCHT, KNCHT, KFIST,
        & KLIST, KNIST, KFAST, KLAST, KNAST, KFEHT, KLEHT, KNEHT, KFV0T,
        & KLV0T, KNV0T, KFDCT, KLDCT, KNDCT, KFEFT, KLEFT, KNEFT, KFNET,
        & KLNET, KNNET, KFGAT, KLGAT, KNGAT, KFJET, KLJET, KNJET, KFMCT,
        & KLMCT, KNMCT, KFREV, KLREV, KNREV, KFMCV, KLMCV, KNMCV, KLUST,
        & KLUSV, KFFRT, KLFRT, KFFRV, KLFRV, KNRET, KNCOT, KFFRD,
        & KLFJET,KLLJET,KLNJET
         COMMON /QCDE/ KBIT(32), KCLACO(KCQFPA), KCLAFR(KCQFPA), KCLARM
        & (KCQFPA), KDEBUG, KEVT, KEXP, KFFILL, KFEOUT, KJOPTN(2,2),
        & KLEOUT, KLROUT, KLOCK0(KLOCKM,2), KLOCK1(KLOCKM,2), KLOCK2(
        & KLOCKM,2), KMATIX(6,6), KMQFPA, KNEFIL, KNEOUT, KNEVT, KNPAST,
        & KNQDET, KNQFPA, KNQLIN, KNQMTX, KNQPAR, KNQPST, KNREIN, KNREOU,
        & KOQDET, KOQFPA, KOQLIN, KOQMTL, KOQMTS, KOQPAR, KOQPBT, KOQPLI,
        & KOQTRA, KOQVEC, KOQVRT, KQPAR, KQVEC, KQVRT, KQWRK, KQZER, KRUN,
        & KSTATU, KTDROP, KUCARD, KUCONS, KUHIST, KUINPU, KUOUTP, KUPRNT,
        & KUPTER, KDEBU1, KDEBU2, KNWRLM, KEFOPT, KUEDIN, KUEDOU, KURTOX,
        & KUCAR2, KNHDRN, KNBHAB, KSBHAB, KRSLLQ, KRSLNB
         COMMON /QCDE/ INDATA
         COMMON /QCDE/ KRINNE, KRINNF, KRINDC, KRINDQ, KRINNZ, KRINNB,
        & KRINBM, KRINFR, KRINLR, KRINLF
         COMMON /QCDE/ KEVERT, KEVEDA, KEVETI, KEVEMI(4), KEVETY, KEVEES,
        & KDHEFP, KDHENP, KDHENM, KKEVNT, KKEVNV, KKEVID, KDHENX, KDHENV,
        & KDHENJ, KREVDS, KXTET1, KXTET2, KXTEL2, KXTCGC, KXTCLL, KXTCBN,
        & KXTCCL, KXTCHV, KXTCEN, KCLASW, KERBOM, KBPSTA
         DIMENSION KLOCUS(3,14)
         EQUIVALENCE (KLOCUS(1,1),KFOVT), (KFOVT,KFRET), (KLIST,KLRET),
        & (KFIST,KFCOT), (KLAST,KLCOT)
         COMMON /QCDE/ XCOPYJ, XFLIAC, XHISTO, XLREV(2), XLREV2(2), XMCEV,
        & XMINI, XSYNTX, XWREVT, XWRRUN, XFILMC, XFILCH, XFILV0, XFILCO,
        & XFILEF, XFILPC, XFILGA, XFILJE,
        & XPRHIS, XFILL, XVITC, XVTPC, XVECAL, XVLCAL, XVTPCD,
        & XVSATR, XVHCAL, XHVTRG, XSREC, XWMINI, XIOKLU, XIOKSI, XFRF2,
        & XNSEQ, XVDOK, XFRF0, XFMUID, XFILEM, XWNANO, XROKSI, XGETBP,
        & XJTHRU
         LOGICAL XCOPYJ, XFLIAC, XHISTO, XLREV, XLREV2, XMCEV, XMINI,
        & XSYNTX, XWREVT, XWRRUN, XFILMC, XFILCH, XFILV0, XFILCO, XFILEF,
        & XFILPC, XPRHIS, XFILL, XVITC, XVTPC, XVECAL, XVLCAL, XVTPCD,
        & XVSATR, XVHCAL, XHVTRG, XSREC, XWMINI, XIOKLU, XFRF2, XFILJE,
        & XNSEQ, XFILGA, XVDOK, XFRF0, XFMUID, XFILEM, XWNANO, XIOKSI,
        & XROKSI, XGETBP, XJTHRU
   
   -------------------- /NANCOM/ --- NanoDst steering -------------------
    XNANO   .TRUE. if input is a NanoDst (in NANO or EPIO format, depending
                      XNANOR)
   
         LOGICAL XNANO
         COMMON /NANCOM/XNANO
   
   
    bcs
         INTEGER LMHLEN, LMHCOL, LMHROW
         PARAMETER (LMHLEN=2, LMHCOL=1, LMHROW=2)
         COMMON /BCS/   IW(1000)
         INTEGER IW
         REAL RW(1000)
         EQUIVALENCE (RW(1),IW(1))
   
   
   ------------------ /QCNAMI/ --- name indices -------------------------
         COMMON /QCNAMI/ NAAFID,NAAJOB,NAASEV,NABCNT,NABHIT,NABOMB,
        1 NABOME,NABOMP,NABOMR,NABPTR,NADCAL,NADCRL,NADECO,NADEID,NADENF,
        2 NADEVT,NADEWI,NADFMC,NADFOT,NADGAM,NADHCO,NADHEA,NADHRL,NADJET,
        3 NADMID,NADMJT,NADMUO,NADNEU,NADPOB,NADRES,NADTBP,NADTMC,NADTRA,
        4 NADVER,NADVMC,NAECRQ,NAECTE,NAEGID,NAEGPC,NAEIDT,NAEJET,NAERRF,
        5 NAETDI,NAETKC,NAEVEH,NAEWHE,NAFICL,NAFKIN,NAFPOI,NAFPOL,NAFRFT,
        6 NAFRID,NAFRTL,NAFSTR,NAFTCL,NAFTCM,NAFTOC,NAFTTM,NAFVCL,NAFVER,
        7 NAFZFR,NAHCCV,NAHCTE,NAHINF,NAHMAD,NAHPDI,NAHROA,NAHSDA,NAHTUB,
        8 NAIASL,NAIPJT,NAIRJT,NAITCO,NAITMA,NAIXTR,NAIZBD,NAJBER,NAJEST,
        9 NAJSUM,NAKEVH,NAKINE,NAKJOB,NAKLIN,NAKPOL,NAKRUN,NALIDT,NALOLE,
        A NALUPA,NAMCAD,NAMHIT,NAMTHR,NAMUDG,NAMUEX,NAOSTS,NAPART,NAPASL,
        B NAPCHY,NAPCOB,NAPCOI,NAPCPA,NAPCQA,NAPCRL,NAPECO,NAPEHY,NAPEID,
        C NAPEMH,NAPEPT,NAPEST,NAPEWI,NAPFER,NAPFHR,NAPFRF,NAPFRT,NAPHCO,
        D NAPHER,NAPHHY,NAPHMH,NAPHST,NAPIDI,NAPITM,NAPLID,NAPLPD,NAPLSD,
        E NAPMSK,NAPNEU,NAPPDS,NAPPOB,NAPPRL,NAPRTM,NAPSCO,NAPSPO,NAPSTR,
        F NAPT2X,NAPTBC,NAPTCO,NAPTEX,NAPTMA,NAPTML,NAPTNC,NAPTST,NAPVCO,
        G NAPYER,NAPYFR,NAPYNE,NAQDET,NAQFPA,NAQLIN,NAQMTL,NAQMTS,NAQPAR,
        H NAQPBT,NAQPLI,NAQTRA,NAQVEC,NAQVRT,NAQWRK,NAQZER,NAREVH,NARHAH,
        I NARTLO,NARTLS,NARUNH,NARUNR,NASFTR,NATEXS,NATGMA,NATMTL,NATPCO,
        J NAVCOM,NAVCPL,NAVDCO,NAVDHT,NAVDXY,NAVDZT,NAVERT,NAVFHL,NAVFLG,
        K NAVFPH,NAVHLS,NAVPLH,NAX1AD,NAX1SC,NAX1TI,NAX2DF,NAX3EC,NAX3EW,
        L NAX3HC,NAX3IT,NAX3L2,NAX3LU,NAX3TM,NAX3TO,NAX3TP,NAX3X3,NAXTBN,
        M NAXTBP,NAXTCN,NAXTEB,NAXTOP,NAXTRB,NAYV0V,NAZPFR,NAEFOL,NAMUID,
        N NAPGID,NAPGPC,NAPGAC,NAPMSC,NAPTHR,NANBIP,NAPDLT,NAPMLT,NAPLJT
   
   
   ------------------ /QQQQJJ/ --- HAC parameters for ALPHA banks -------
         PARAMETER (JQVEQX= 1,JQVEQY= 2,JQVEQZ= 3,JQVEQE= 4,JQVEQM= 5,
        & JQVEQP= 6,JQVECH= 7,JQVETN= 8,JQVESC= 9,JQVEKS=10,JQVECL=11,
        & JQVEPA=12,JQVEQD=13,JQVENP=14,JQVESP=15,JQVEOV=16,JQVEEV=17,
        & JQVEND=18,JQVEDL=19,JQVENO=20,JQVEOL=21,JQVENM=22,JQVEML=23,
        & JQVEBM=24,JQVELK=38,JQVEDB=39,JQVEZB=40,JQVESD=41,JQVESZ=42,
        & JQVECB=43,JQVEEM=44,JQVECF=54,JQVEEW=55,JQVEUS=56)
         PARAMETER ( JQVRVX=1,JQVRVY=2,JQVRVZ=3,JQVRVN=4,JQVRTY=5,
        1   JQVRIP=6,JQVRND=7,JQVRDL=8,JQVRAY=9,JQVRAF=10,JQVREM=11,
        2   JQVRCF=17,JQVRET=18)
         PARAMETER ( JQDEAF= 1,JQDEAL= 2,JQDENT= 3,JQDEAT= 4,JQDELT= 8,
        &  JQDEAE= 9,JQDEAH=10,JQDEAM=11,JQDECF=12,JQDEEC=13,JQDEHC=14,
        &  JQDEET=15,JQDEFI=16,JQDENF=17,JQDEFL=18,JQDENE=19,JQDEEL=20,
        &  JQDENH=21,JQDEHL=22,JQDELH=23,JQDEEF=24,JQDEPC=25,JQDEEG=26,
        &  JQDEMU=27,JQDEDX=28,JQDEPG=29,JQDEPD=30,JQDEPM=31)
         PARAMETER ( JQPAGN=1, JQPANA=2, JQPACO=5, JQPAMA=6, JQPACH=7,
        & JQPALT=8,JQPAWI=9,JQPAAN=10)
   
   
         EXTERNAL CQPART, CQTPN, XCEQAN, XLUMOK, XPEQAN, XPEQOR, XPEQU,
        & XVDEOK, LLUMOK, SLUMOK
         CHARACTER * 12 CQPART, CQTPN
         LOGICAL XCAL, XCEQAN, XCEQOR, XCEQU, XECAL, XEID, XFRF, XHCAL,
        & XHMA, XLOCK, XLOCKN, XMC, XLUMOK, XMCA, XPEO, XPHO, XPEQAN,
        & XPEQOR, XPEQU, XSAME, XSIG, XTEX, XPEC, XPEP, XPHC, XYV0,
        & XFRIQF, XEFO, XPCQ, XEGP, XMUI, XVDEOK, XPGP, LLUMOK, SLUMOK,
        & XPGAC, XLEPTG, XLEPTH
   
    alcons
    define universal constants
         REAL PI, TWOPI, PIBY2, PIBY3, PIBY4, PIBY6, PIBY8, PIBY12
         REAL RADEG, DEGRA
         REAL CLGHT, ALDEDX
         PARAMETER (PI=3.141592653589)
         PARAMETER (RADEG=180./PI, DEGRA=PI/180.)
         PARAMETER (TWOPI = 2.*PI , PIBY2 = PI/2., PIBY4 = PI/4.)
         PARAMETER (PIBY6 = PI/6. , PIBY8 = PI/8.)
         PARAMETER (PIBY12= PI/12., PIBY3 = PI/3.)
         PARAMETER (CLGHT = 29.9792458, ALDEDX = 0.000307)
   
         ALDEDX  = constant used in the computation of DEDX in GeV
         CLGHT   = speed of light in cm/nsec
   
   
   
    efoljj
         INTEGER JEFOPX,JEFOPY,JEFOPZ,JEFOEW,JEFOWE,JEFOTY,JEFOLE,JEFOLT,
        +          JEFOLH,JEFOLC,JEFOLJ,LEFOLA
         PARAMETER(JEFOPX=1,JEFOPY=2,JEFOPZ=3,JEFOEW=4,JEFOWE=5,JEFOTY=6,
        +          JEFOLE=7,JEFOLT=8,JEFOLH=9,JEFOLC=10,JEFOLJ=11,
        +          LEFOLA=11)
   
   
    egpcjj
         INTEGER JEGPPX,JEGPPY,JEGPPZ,JEGPR1,JEGPR2,JEGPF4,JEGPDM,JEGPST,
        +          JEGPQU,JEGPPE,LEGPCA
         PARAMETER(JEGPPX=1,JEGPPY=2,JEGPPZ=3,JEGPR1=4,JEGPR2=5,JEGPF4=6,
        +          JEGPDM=7,JEGPST=8,JEGPQU=9,JEGPPE=10,LEGPCA=10)
   
   
    eidtjj
         INTEGER JEIDIF,JEIDR1,JEIDR2,JEIDR3,JEIDR4,JEIDR5,JEIDR6,JEIDR7,
        +          JEIDEC,JEIDIP,JEIDE1,JEIDE2,JEIDE3,JEIDFR,JEIDPE,LEIDTA
         PARAMETER(JEIDIF=1,JEIDR1=2,JEIDR2=3,JEIDR3=4,JEIDR4=5,JEIDR5=6,
        +          JEIDR6=7,JEIDR7=8,JEIDEC=9,JEIDIP=10,JEIDE1=11,
        +          JEIDE2=12,JEIDE3=13,JEIDFR=14,JEIDPE=15,LEIDTA=15)
   
   
    frftjj
         INTEGER JFRFIR,JFRFTL,JFRFP0,JFRFD0,JFRFZ0,JFRFAL,JFRFEM,JFRFC2,
        +          JFRFDF,JFRFNO,LFRFTA
         PARAMETER(JFRFIR=1,JFRFTL=2,JFRFP0=3,JFRFD0=4,JFRFZ0=5,JFRFAL=6,
        +          JFRFEM=7,JFRFC2=28,JFRFDF=29,JFRFNO=30,LFRFTA=30)
   
   
    fridjj
         INTEGER JFRIBP,JFRIDZ,JFRIBC,JFRIDC,JFRIPE,JFRIPM,JFRIPI,JFRIPK,
        +          JFRIPP,JFRINK,JFRIQF,LFRIDA
         PARAMETER(JFRIBP=1,JFRIDZ=2,JFRIBC=3,JFRIDC=4,JFRIPE=5,JFRIPM=6,
        +          JFRIPI=7,JFRIPK=8,JFRIPP=9,JFRINK=10,JFRIQF=11,
        +          LFRIDA=11)
   
   
    frtljj
         INTEGER JFRTIV,JFRTNV,JFRTII,JFRTNI,JFRTNE,JFRTIT,JFRTNT,JFRTNR,
        +          LFRTLA
         PARAMETER(JFRTIV=1,JFRTNV=2,JFRTII=3,JFRTNI=4,JFRTNE=5,JFRTIT=6,
        +          JFRTNT=7,JFRTNR=8,LFRTLA=8)
   
   
    hmadjj
         INTEGER JHMANF,JHMANE,JHMANL,JHMAMH,JHMAIG,JHMAED,JHMACS,JHMAND,
        +          JHMAIE,JHMAIT,JHMAIF,JHMATN,LHMADA
         PARAMETER(JHMANF=1,JHMANE=2,JHMANL=3,JHMAMH=4,JHMAIG=5,JHMAED=6,
        +          JHMACS=7,JHMAND=8,JHMAIE=9,JHMAIT=10,JHMAIF=11,
        +          JHMATN=12,LHMADA=12)
   
   
    mcadjj
         INTEGER JMCANH,JMCADH,JMCADC,JMCAAM,JMCAAC,JMCATN,LMCADA
         PARAMETER(JMCANH=1,JMCADH=3,JMCADC=5,JMCAAM=7,JMCAAC=8,JMCATN=9,
        +          LMCADA=9)
   
   
    muidjj
         INTEGER JMUIIF,JMUISR,JMUIDM,JMUIST,JMUITN,LMUIDA
         PARAMETER(JMUIIF=1,JMUISR=2,JMUIDM=3,JMUIST=4,JMUITN=5,LMUIDA=5)
   
   
    pcqajj
         INTEGER JPCQNA,JPCQPX,JPCQPY,JPCQPZ,JPCQEN,LPCQAA
         PARAMETER(JPCQNA=1,JPCQPX=2,JPCQPY=3,JPCQPZ=4,JPCQEN=5,LPCQAA=5)
   
   
    pdltjj
         INTEGER JPDLPA,JPDLJT,JPDLPI,JPDLPE,JPDLVP,JPDLFR,LPDLTA
         PARAMETER(JPDLPA=1,JPDLJT=2,JPDLPI=3,JPDLPE=4,JPDLVP=5,JPDLFR=6,
        +          LPDLTA=6)
   
   
    pecojj
         INTEGER JPECER,JPECE1,JPECE2,JPECTH,JPECPH,JPECEC,JPECKD,JPECCC,
        +          JPECRB,JPECPC,LPECOA
         PARAMETER(JPECER=1,JPECE1=2,JPECE2=3,JPECTH=4,JPECPH=5,JPECEC=6,
        +          JPECKD=7,JPECCC=8,JPECRB=9,JPECPC=10,LPECOA=10)
   
   
    peptjj
         INTEGER JPEPT1,JPEPP1,JPEPT3,JPEPP3,LPEPTA
         PARAMETER(JPEPT1=1,JPEPP1=2,JPEPT3=3,JPEPP3=4,LPEPTA=4)
   
   
    pgacjj
         INTEGER JPGAEC,JPGATC,JPGAPC,JPGAR1,JPGAR2,JPGAF4,JPGADM,JPGAST,
        +          JPGAQU,JPGAQ1,JPGAQ2,JPGAM1,JPGAM2,JPGAMA,JPGAER,JPGATR,
        +          JPGAPR,JPGAEF,JPGAGC,JPGAZS,JPGAPL,JPGAPH,JPGAPN,JPGAFA,
        +          JPGAPE,LPGACA
         PARAMETER(JPGAEC=1,JPGATC=2,JPGAPC=3,JPGAR1=4,JPGAR2=5,JPGAF4=6,
        +          JPGADM=7,JPGAST=8,JPGAQU=9,JPGAQ1=10,JPGAQ2=11,
        +          JPGAM1=12,JPGAM2=13,JPGAMA=14,JPGAER=15,JPGATR=16,
        +          JPGAPR=17,JPGAEF=18,JPGAGC=19,JPGAZS=20,JPGAPL=21,
        +          JPGAPH=22,JPGAPN=23,JPGAFA=24,JPGAPE=25,LPGACA=25)
   
   
    pgpcjj
         INTEGER JPGPEC,JPGPTC,JPGPPC,JPGPR1,JPGPR2,JPGPF4,JPGPDM,JPGPST,
        +          JPGPQU,JPGPQ1,JPGPQ2,JPGPM1,JPGPM2,JPGPMA,JPGPER,JPGPTR,
        +          JPGPPR,JPGPPE,LPGPCA
         PARAMETER(JPGPEC=1,JPGPTC=2,JPGPPC=3,JPGPR1=4,JPGPR2=5,JPGPF4=6,
        +          JPGPDM=7,JPGPST=8,JPGPQU=9,JPGPQ1=10,JPGPQ2=11,
        +          JPGPM1=12,JPGPM2=13,JPGPMA=14,JPGPER=15,JPGPTR=16,
        +          JPGPPR=17,JPGPPE=18,LPGPCA=18)
   
   
    phcojj
         INTEGER JPHCER,JPHCTH,JPHCPH,JPHCEC,JPHCKD,JPHCCC,JPHCRB,JPHCNF,
        +          JPHCPC,LPHCOA
         PARAMETER(JPHCER=1,JPHCTH=2,JPHCPH=3,JPHCEC=4,JPHCKD=5,JPHCCC=6,
        +          JPHCRB=7,JPHCNF=8,JPHCPC=9,LPHCOA=9)
   
   
    pmltjj
         INTEGER JPMLFL,JPMLPO,JPMLCH,JPMLSP,JPMLLE,JPMLME,JPMLKT,JPMLFR,
        +          LPMLTA
         PARAMETER(JPMLFL=1,JPMLPO=2,JPMLCH=3,JPMLSP=4,JPMLLE=5,JPMLME=6,
        +          JPMLKT=7,JPMLFR=8,LPMLTA=8)
   
   
    texsjj
         INTEGER JTEXSI,JTEXTM,JTEXTL,JTEXNS,JTEXAD,JTEXTN,JTEXSF,LTEXSA
         PARAMETER(JTEXSI=1,JTEXTM=2,JTEXTL=3,JTEXNS=4,JTEXAD=5,JTEXTN=6,
        +          JTEXSF=7,LTEXSA=7)
   
   
    yv0vjj
         INTEGER JYV0K1,JYV0K2,JYV0VX,JYV0VY,JYV0VZ,JYV0VM,JYV0PX,JYV0PY,
        +          JYV0PZ,JYV0PM,JYV0X1,JYV0X2,JYV0XM,JYV0C2,JYV0IC,JYV0P1,
        +          JYV0P2,JYV0EP,JYV0DM,JYV0S1,JYV0S2,LYV0VA
         PARAMETER(JYV0K1=1,JYV0K2=2,JYV0VX=3,JYV0VY=4,JYV0VZ=5,JYV0VM=6,
        +          JYV0PX=12,JYV0PY=13,JYV0PZ=14,JYV0PM=15,JYV0X1=21,
        +          JYV0X2=22,JYV0XM=23,JYV0C2=26,JYV0IC=27,JYV0P1=28,
        +          JYV0P2=31,JYV0EP=34,JYV0DM=55,JYV0S1=56,JYV0S2=57,
        +          LYV0VA=57)
   
   
         integer itk, nhyp,ier,ns
         real rmass(*),q(*), npad,extimator(*), tl
         real p,ct
         integer i,j,k
         real bestsigma, bestri
         real denom2,denom,w(2),matrix(2,2),imatrix(2,2)
         real padre(nhyp),padsg(nhyp),filre(nhyp),filsg(nhyp)
         real padri,filri,padtl,filtl
         real correlation
         real findcorr
         real temp(2)
         integer ifail,padier,filier
   
   -------------------- /QMACRO/ --- statement functions ----------------
   
    bmacro
       set of intrinsic functions to handle BOS banks
   - # of words/row in bank with index ID
         LCOLS(ID) = IW(ID+1)
   - # of rows in bank with index ID
         LROWS(ID) = IW(ID+2)
   - index of next row in the bank with index ID
         KNEXT(ID) = ID + LMHLEN + IW(ID+1)*IW(ID+2)
   - index of row # NRBOS in the bank with index ID
         KROW(ID,NRBOS) = ID + LMHLEN + IW(ID+1)*(NRBOS-1)
   - # of free words in the bank with index ID
         LFRWRD(ID) = ID + IW(ID) - KNEXT(ID)
   - # of free rows in the bank with index ID
         LFRROW(ID) = LFRWRD(ID) / LCOLS(ID)
   - Lth integer element of the NRBOSth row of the bank with index ID
         ITABL(ID,NRBOS,L) = IW(ID+LMHLEN+(NRBOS-1)*IW(ID+1)+L)
   - Lth real element of the NRBOSth row of the bank with index ID
         RTABL(ID,NRBOS,L) = RW(ID+LMHLEN+(NRBOS-1)*IW(ID+1)+L)
   
   -------------------- /QCFUNC/ --- statement functions for ALPHA banks
         KJQDET(KI)=IW(KOQVEC+KI*KCQVEC+JQVEQD)
         QSQT(QF)=SIGN(SQRT(ABS(QF)),QF)
         QP(KI)=RW(KOQVEC+KI*KCQVEC+JQVEQP)
         QX(KI)=RW(KOQVEC+KI*KCQVEC+JQVEQX)
         QY(KI)=RW(KOQVEC+KI*KCQVEC+JQVEQY)
         QZ(KI)=RW(KOQVEC+KI*KCQVEC+JQVEQZ)
         QE(KI)=RW(KOQVEC+KI*KCQVEC+JQVEQE)
         QM(KI)=RW(KOQVEC+KI*KCQVEC+JQVEQM)
         QCH(KI)=RW(KOQVEC+KI*KCQVEC+JQVECH)
         KCH(KI)=NINT (QCH(KI))
         QCT(KI)=QZ(KI)/QP(KI)
         QDB(KI)=RW(KOQVEC+KI*KCQVEC+JQVEDB)
         QZB(KI)=RW(KOQVEC+KI*KCQVEC+JQVEZB)
         QDBS2(KI)=RW(KOQVEC+KI*KCQVEC+JQVESD)
         QZBS2(KI)=RW(KOQVEC+KI*KCQVEC+JQVESZ)
         QBC2(KI)=RW(KOQVEC+KI*KCQVEC+JQVECB)
         QSIG(KI,KI1,KI2)=RW(KOQVEC+KI*KCQVEC+KMATIX(KI1,KI2)+JQVEEM)
         XSIG(KI)=RW(KOQVEC+KI*KCQVEC+JQVEEM).GE.0.
         QSMAT(KI,KI1)=RW(KOQVEC+KI*KCQVEC+KI1+JQVEEM)
         QSIGX(KI)=QSQT(QSMAT(KI,0))
         QSIGY(KI)=QSQT(QSMAT(KI,2))
         QSIGZ(KI)=QSQT(QSMAT(KI,5))
         QSIGEE(KI)=RW(KOQVEC+KI*KCQVEC+JQVEEM+9)
         QSIGE(KI)=QSQT(QSIGEE(KI))
         QSIGPP(KI)=(QX(KI)**2*QSMAT(KI,0)+QY(KI)**2*QSMAT(KI,2)+
        & QZ(KI)**2*QSMAT(KI,5)+2.*(QX(KI)*(QY(KI)*QSMAT(KI,1)+
        & QZ(KI)*QSMAT(KI,3))+QY(KI)*QZ(KI)*QSMAT(KI,4)))/QP(KI)**2
         QSIGP(KI)=QSQT(QSIGPP(KI))
         QSIGMM(KI)=QM(KI)*(QE(KI)**2*QSMAT(KI,9)+QX(KI)**2*QSMAT(KI,0)+
        & QY(KI)**2*QSMAT(KI,2)+QZ(KI)**2*QSMAT(KI,5)+2.*(QX(KI)*(QY(KI)
        & QSMAT(KI,1)+QZ(KI)*QSMAT(KI,3))+QY(KI)*QZ(KI)*QSMAT(KI,4)-
        & QE(KI)*(QX(KI)*QSMAT(KI,6)+QY(KI)*QSMAT(KI,7)+
        & QZ(KI)*QSMAT(KI,8))))/AMAX1(QM(KI)**3,1.E-16)
         QSIGM(KI)=QSQT(QSIGMM(KI))
         QMCHIF(KI)=RW(KOQVEC+KI*KCQVEC+JQVECF)
         QPH(KI)=ATG(QY(KI),QX(KI))
         QPT(KI)=SQRT(QX(KI)**2+QY(KI)**2)
         KTN(KI)=IW(KOQVEC+KI*KCQVEC+JQVETN)
         KMC(KI)=KCLARM(IW(KOQVEC+KI*KCQVEC+JQVECL))
         KBMASK(KI,KI1)=IW(KOQVEC+KI*KCQVEC+KI1+JQVEBM-1)
         KCALFL(KI)=IW(KJQDET(KI)+JQDECF)
         KCHGD(KI,KI1)=IW(KOQLIN+KI1+IW(KJQDET(KI)+JQDEFL))
         KCLASS(KI)=KCLACO(IW(KOQVEC+KI*KCQVEC+JQVECL))
         KDAU(KI,KI1)=IW(KOQLIN+KI1+IW(KOQVEC+KI*KCQVEC+JQVEDL))
         KECAL(KI,KI1)=IW(KOQLIN+KI1+IW(KJQDET(KI)+JQDEEL))
         KENDV(KI)=IW(KOQVEC+KI*KCQVEC+JQVEEV)
         KFOLLO(KI)=IW(KOQVEC+KI*KCQVEC+JQVENP)
         KHCAL(KI,KI1)=IW(KOQLIN+KI1+IW(KJQDET(KI)+JQDEHL))
         KLUNDS(KI)=IW(KOQVEC+KI*KCQVEC+JQVEKS)
         KNCHGD(KI)=IW(KJQDET(KI)+JQDENF)
         KNECAL(KI)=IW(KJQDET(KI)+JQDENE)
         KNHCAL(KI)=IW(KJQDET(KI)+JQDENH)
         KNMOTH(KI)=IW(KOQVEC+KI*KCQVEC+JQVENO)
         KMOTH(KI,KI1)=IW(KOQLIN+KI1+IW(KOQVEC+KI*KCQVEC+JQVEOL))
         KMTCH(KI,KI1)=IW(KOQMTL+KI1+IW(KOQVEC+KI*KCQVEC+JQVEML))
         KNDAU(KI)=IW(KOQVEC+KI*KCQVEC+JQVEND)
         KNMTCH(KI)=IW(KOQVEC+KI*KCQVEC+JQVENM)
         KORIV(KI)=IW(KOQVEC+KI*KCQVEC+JQVEOV)
         KSAME(KI)=IW(KOQVEC+KI*KCQVEC+JQVESP)
         KSMTCH(KI,KI1)=IW(KOQMTS+KI1+IW(KOQVEC+KI*KCQVEC+JQVEML))
         KSTABC(KI)=IW(KOQVEC+KI*KCQVEC+JQVESC)
         KTPCOD(KI)=IW(KOQVEC+KI*KCQVEC+JQVEPA)
         XLOCKN(KI,KI1)=IAND(KBMASK(KI,KI1),KLOCK0(KI1,KMC(KI))).NE.0
         XLOCK(KI)=IW(KOQVEC+KI*KCQVEC+JQVELK).NE.0.OR.XLOCKN(KI,1).OR.
        & XLOCKN(KI,2).OR.XLOCKN(KI,3).OR.XLOCKN(KI,4).OR.
        & XLOCKN(KI,5).OR.XLOCKN(KI,6).OR.XLOCKN(KI,7).OR.
        & XLOCKN(KI,8).OR.XLOCKN(KI,9).OR.XLOCKN(KI,10).OR.
        & XLOCKN(KI,11).OR.XLOCKN(KI,12).OR.XLOCKN(KI,13).OR.
        & XLOCKN(KI,14)
         XMC(KI)=KCLARM(IW(KOQVEC+KI*KCQVEC+JQVECL)).NE.1
         QRDFL(KI,KI1)=RW(KOQVEC+KI*KCQVEC+JQVEUS+KI1-1)
         KRDFL(KI,KI1)=IW(KOQVEC+KI*KCQVEC+JQVEUS+KI1-1)
         XCAL(KI)=IW(KJQDET(KI)+JQDECF).NE.0
         XECAL(KI)=IABS(IW(KJQDET(KI)+JQDECF)).EQ.1
         XHCAL(KI)=IABS(IW(KJQDET(KI)+JQDECF)).EQ.2
         QVX(KI)=RW(KOQVRT+KI*KCQVRT+JQVRVX)
         QVY(KI)=RW(KOQVRT+KI*KCQVRT+JQVRVY)
         QVZ(KI)=RW(KOQVRT+KI*KCQVRT+JQVRVZ)
         KVN(KI)=IW(KOQVRT+KI*KCQVRT+JQVRVN)
         KVTYPE(KI)=IW(KOQVRT+KI*KCQVRT+JQVRTY)
         KVINCP(KI)=IW(KOQVRT+KI*KCQVRT+JQVRIP)
         KVNDAU(KI)=IW(KOQVRT+KI*KCQVRT+JQVRND)
         KVYV0V(KI)=IW(KOQVRT+KI*KCQVRT+JQVRAY)
         KVFVER(KI)=IW(KOQVRT+KI*KCQVRT+JQVRAF)
         KVDAU(KI,KI1)=IW(KOQLIN+KI1+IW(KOQVRT+KI*KCQVRT+JQVRDL))
         QVEM(KI,KI1,KI2)=RW(KOQVRT+KI*KCQVRT+KMATIX(KI1,KI2)+JQVREM)
         QVCHIF(KI)=RW(KOQVRT+KI*KCQVRT+JQVRCF)
         QVDIF2(KI1,KI2)=SQRT((QVX(KI1)-QVX(KI2))**2+(QVY(KI1)-
        &QVY(KI2))**2)
         QVDIF3(KI1,KI2)=SQRT((QVX(KI1)-QVX(KI2))**2+(QVY(KI1)-
        &QVY(KI2))**2+ (QVZ(KI1)-QVZ(KI2))**2)
         QMSQ2(KI1,KI2)=(QE(KI1)+QE(KI2))**2-(QX(KI1)+QX(KI2))**2-
        & (QY(KI1)+QY(KI2))**2-(QZ(KI1)+QZ(KI2))**2
         QMSQ3(KI1,KI2,KI3)=(QE(KI1)+QE(KI2)+QE(KI3))**2-
        & (QX(KI1)+QX(KI2)+QX(KI3))**2-(QY(KI1)+QY(KI2)+QY(KI3))**2-
        & (QZ(KI1)+QZ(KI2)+QZ(KI3))**2
         QMSQ4(KI1,KI2,KI3,KI4)=(QE(KI1)+QE(KI2)+QE(KI3)+QE(KI4))**2-
        & (QX(KI1)+QX(KI2)+QX(KI3)+QX(KI4))**2-(QY(KI1)+QY(KI2)+
        & QY(KI3)+QY(KI4))**2-(QZ(KI1)+QZ(KI2)+QZ(KI3)+QZ(KI4))**2
         QM2(KI1,KI2)=QSQT(QMSQ2(KI1,KI2))
         QM3(KI1,KI2,KI3)=QSQT(QMSQ3(KI1,KI2,KI3))
         QM4(KI1,KI2,KI3,KI4)=QSQT(QMSQ4(KI1,KI2,KI3,KI4))
         QDMSQ(KI1,KI2)=(QE(KI1)-QE(KI2))**2-(QX(KI1)-QX(KI2))**2-
        & (QY(KI1)-QY(KI2))**2-(QZ(KI1)-QZ(KI2))**2
         QBETA(KI)=QP(KI)/QE(KI)
         QGAMMA(KI)=1./SQRT((1.-QBETA(KI))*(1.+QBETA(KI)))
         QDOT3(KI1,KI2)=QX(KI1)*QX(KI2)+QY(KI1)*QY(KI2)+QZ(KI1)*QZ(KI2)
         QDOT4(KI1,KI2)=QE(KI1)*QE(KI2)-QDOT3(KI1,KI2)
         QCOSA(KI1,KI2)=QDOT3(KI1,KI2)/(QP(KI1)*QP(KI2))
         QPPAR(KI1,KI2)=QDOT3(KI1,KI2)/QP(KI2)
         QPPER(KI1,KI2)=SQRT((QY(KI1)*QZ(KI2)-QZ(KI1)*QY(KI2))**2+
        & (QZ(KI1)*QX(KI2)-QX(KI1)*QZ(KI2))**2+
        & (QX(KI1)*QY(KI2)-QY(KI1)*QX(KI2))**2)/QP(KI2)
         XSAME(KI1,KI2)=IAND(KBMASK(KI1,1),KBMASK(KI2,1)).NE.0.OR.
        & IAND(KBMASK(KI1,2),KBMASK(KI2,2)).NE.0.OR.
        & IAND(KBMASK(KI1,3),KBMASK(KI2,3)).NE.0.OR.
        & IAND(KBMASK(KI1,4),KBMASK(KI2,4)).NE.0.OR.
        & IAND(KBMASK(KI1,5),KBMASK(KI2,5)).NE.0.OR.
        & IAND(KBMASK(KI1,6),KBMASK(KI2,6)).NE.0.OR.
        & IAND(KBMASK(KI1,7),KBMASK(KI2,7)).NE.0.OR.
        & IAND(KBMASK(KI1,8),KBMASK(KI2,8)).NE.0.OR.
        & IAND(KBMASK(KI1,9),KBMASK(KI2,9)).NE.0.OR.
        & IAND(KBMASK(KI1,10),KBMASK(KI2,10)).NE.0.OR.
        & IAND(KBMASK(KI1,11),KBMASK(KI2,11)).NE.0.OR.
        & IAND(KBMASK(KI1,12),KBMASK(KI2,12)).NE.0.OR.
        & IAND(KBMASK(KI1,13),KBMASK(KI2,13)).NE.0.OR.
        & IAND(KBMASK(KI1,14),KBMASK(KI2,14)).NE.0
         QCMASS(KI)=RW(KOQPAR+KI*KCQPAR+JQPAMA)
         QCCHAR(KI)=RW(KOQPAR+KI*KCQPAR+JQPACH)
         QCLIFE(KI)=RW(KOQPAR+KI*KCQPAR+JQPALT)
         QCWIDT(KI)=RW(KOQPAR+KI*KCQPAR+JQPAWI)
         XCEQOR(KI,KI1)=KTPCOD(KI).EQ.KI1.OR.
        & KTPCOD(KI).EQ.IW(KOQPAR+KI1*KCQPAR+JQPAAN)
         XCEQU(KI,KI1)=KTPCOD(KI).EQ.KI1
      QCFDET
         XFRF(KI)=IW(KJQDET(KI)+JQDEAF).NE.KQZER
         QFRFIR(KI)=RW(IW(KJQDET(KI)+JQDEAF)+JFRFIR)
         QFRFTL(KI)=RW(IW(KJQDET(KI)+JQDEAF)+JFRFTL)
         QFRFP0(KI)=RW(IW(KJQDET(KI)+JQDEAF)+JFRFP0)
         QFRFD0(KI)=RW(IW(KJQDET(KI)+JQDEAF)+JFRFD0)
         QFRFZ0(KI)=RW(IW(KJQDET(KI)+JQDEAF)+JFRFZ0)
         QFRFAL(KI)=RW(IW(KJQDET(KI)+JQDEAF)+JFRFAL)
         QFRFEM(KI,KI1,KI2)=RW(IW(KJQDET(KI)+JQDEAF)+
        & KMATIX(KI1,KI2)+JFRFEM)
         QFRFC2(KI)=RW(IW(KJQDET(KI)+JQDEAF)+JFRFC2)
         KFRFDF(KI)=IW(IW(KJQDET(KI)+JQDEAF)+JFRFDF)
         KFRFNO(KI)=IW(IW(KJQDET(KI)+JQDEAF)+JFRFNO)
         KFRTNV(KI)=IW(IW(KJQDET(KI)+JQDEAL)+JFRTNV)
         KFRTNI(KI)=IW(IW(KJQDET(KI)+JQDEAL)+JFRTNI)
         KFRTNE(KI)=IW(IW(KJQDET(KI)+JQDEAL)+JFRTNE)
         KFRTNT(KI)=IW(IW(KJQDET(KI)+JQDEAL)+JFRTNT)
         KFRTNR(KI)=IW(IW(KJQDET(KI)+JQDEAL)+JFRTNR)
         KFRIBP(KI)=IW(IW(KJQDET(KI)+JQDEFI)+JFRIBP)
         KFRIDZ(KI)=IW(IW(KJQDET(KI)+JQDEFI)+JFRIDZ)
         KFRIBC(KI)=IW(IW(KJQDET(KI)+JQDEFI)+JFRIBC)
         KFRIDC(KI)=IW(IW(KJQDET(KI)+JQDEFI)+JFRIDC)
         QFRIPE(KI)=RW(IW(KJQDET(KI)+JQDEFI)+JFRIPE)
         QFRIPM(KI)=RW(IW(KJQDET(KI)+JQDEFI)+JFRIPM)
         QFRIPI(KI)=RW(IW(KJQDET(KI)+JQDEFI)+JFRIPI)
         QFRIPK(KI)=RW(IW(KJQDET(KI)+JQDEFI)+JFRIPK)
         QFRIPP(KI)=RW(IW(KJQDET(KI)+JQDEFI)+JFRIPP)
         QFRINK(KI)=RW(IW(KJQDET(KI)+JQDEFI)+JFRINK)
         KFRIQF(KI)=IW(IW(KJQDET(KI)+JQDEFI)+JFRIQF)
         XFRIQF(KI)=KFRIQF(KI).EQ.1.OR.KFRIQF(KI).EQ.3
         KNTEX(KI)=IW(KJQDET(KI)+JQDENT)
         XTEX(KI)=IW(KJQDET(KI)+JQDENT).NE.0
         KTEXSI(KI,KI1)=IW(IW(KJQDET(KI)+KI1+JQDENT)+JTEXSI)
         QTEXTM(KI,KI1)=RW(IW(KJQDET(KI)+KI1+JQDENT)+JTEXTM)
         QTEXTL(KI,KI1)=RW(IW(KJQDET(KI)+KI1+JQDENT)+JTEXTL)
         KTEXNS(KI,KI1)=IW(IW(KJQDET(KI)+KI1+JQDENT)+JTEXNS)
         QTEXAD(KI,KI1)=RW(IW(KJQDET(KI)+KI1+JQDENT)+JTEXAD)
         XEID(KI)=IW(KJQDET(KI)+JQDEAE).NE.KQZER
         KEIDIF(KI)=IW(IW(KJQDET(KI)+JQDEAE)+JEIDIF)
         QEIDRI(KI,KI1)=RW(IW(KJQDET(KI)+JQDEAE)+KI1+JEIDR1-1)
         QEIDEC(KI)=RW(IW(KJQDET(KI)+JQDEAE)+JEIDEC)
         KEIDIP(KI)=IW(IW(KJQDET(KI)+JQDEAE)+JEIDIP)
         QEIDEI(KI,KI1)=RW(IW(KJQDET(KI)+JQDEAE)+KI1+JEIDE1-1)
         XHMA(KI)=IW(KJQDET(KI)+JQDEAH).NE.KQZER
         KHMANF(KI)=IW(IW(KJQDET(KI)+JQDEAH)+JHMANF)
         KHMANE(KI)=IW(IW(KJQDET(KI)+JQDEAH)+JHMANE)
         KHMANL(KI)=IW(IW(KJQDET(KI)+JQDEAH)+JHMANL)
         KHMAMH(KI)=IW(IW(KJQDET(KI)+JQDEAH)+JHMAMH)
         KHMAIG(KI)=IW(IW(KJQDET(KI)+JQDEAH)+JHMAIG)
         QHMAED(KI)=RW(IW(KJQDET(KI)+JQDEAH)+JHMAED)
         QHMACS(KI)=RW(IW(KJQDET(KI)+JQDEAH)+JHMACS)
         KHMAND(KI)=IW(IW(KJQDET(KI)+JQDEAH)+JHMAND)
         KHMAIE(KI)=IW(IW(KJQDET(KI)+JQDEAH)+JHMAIE)
         KHMAIT(KI)=IW(IW(KJQDET(KI)+JQDEAH)+JHMAIT)
         KHMAIF(KI)=IW(IW(KJQDET(KI)+JQDEAH)+JHMAIF)
         XMCA(KI)=IW(KJQDET(KI)+JQDEAM).NE.KQZER
         KMCANH(KI,KI1)=IW(IW(KJQDET(KI)+JQDEAM)+KI1+JMCANH-1)
         QMCADH(KI,KI1)=RW(IW(KJQDET(KI)+JQDEAM)+KI1+JMCADH-1)
         QMCADC(KI,KI1)=RW(IW(KJQDET(KI)+JQDEAM)+KI1+JMCADC-1)
         QMCAAM(KI)=RW(IW(KJQDET(KI)+JQDEAM)+JMCAAM)
         QMCAAC(KI)=RW(IW(KJQDET(KI)+JQDEAM)+JMCAAC)
         XMUI(KI)=IW(KJQDET(KI)+JQDEMU).NE.KQZER
         KMUIIF(KI)=IW(IW(KJQDET(KI)+JQDEMU)+JMUIIF)
         QMUISR(KI)=RW(IW(KJQDET(KI)+JQDEMU)+JMUISR)
         QMUIDM(KI)=RW(IW(KJQDET(KI)+JQDEMU)+JMUIDM)
         KMUIST(KI)=IW(IW(KJQDET(KI)+JQDEMU)+JMUIST)
         KMUITN(KI)=IW(IW(KJQDET(KI)+JQDEMU)+JMUITN)
         XPEC(KI)=IW(KJQDET(KI)+JQDEEC).NE.KQZER
         QPECER(KI)=RW(IW(KJQDET(KI)+JQDEEC)+JPECER)
         QPECE1(KI)=RW(IW(KJQDET(KI)+JQDEEC)+JPECE1)
         QPECE2(KI)=RW(IW(KJQDET(KI)+JQDEEC)+JPECE2)
         QPECTH(KI)=RW(IW(KJQDET(KI)+JQDEEC)+JPECTH)
         QPECPH(KI)=RW(IW(KJQDET(KI)+JQDEEC)+JPECPH)
         QPECEC(KI)=RW(IW(KJQDET(KI)+JQDEEC)+JPECEC)
         KPECKD(KI)=IW(IW(KJQDET(KI)+JQDEEC)+JPECKD)
         KPECCC(KI)=IW(IW(KJQDET(KI)+JQDEEC)+JPECCC)
         KPECRB(KI)=IW(IW(KJQDET(KI)+JQDEEC)+JPECRB)
         KPECPC(KI)=IW(IW(KJQDET(KI)+JQDEEC)+JPECPC)
         XPEP(KI)=IW(KJQDET(KI)+JQDEET).NE.KQZER
         QPEPT1(KI)=RW(IW(KJQDET(KI)+JQDEET)+JPEPT1)
         QPEPP1(KI)=RW(IW(KJQDET(KI)+JQDEET)+JPEPP1)
         QPEPT3(KI)=RW(IW(KJQDET(KI)+JQDEET)+JPEPT3)
         QPEPP3(KI)=RW(IW(KJQDET(KI)+JQDEET)+JPEPP3)
         XPHC(KI)=IW(KJQDET(KI)+JQDEHC).NE.KQZER
         QPHCER(KI)=RW(IW(KJQDET(KI)+JQDEHC)+JPHCER)
         QPHCTH(KI)=RW(IW(KJQDET(KI)+JQDEHC)+JPHCTH)
         QPHCPH(KI)=RW(IW(KJQDET(KI)+JQDEHC)+JPHCPH)
         QPHCEC(KI)=RW(IW(KJQDET(KI)+JQDEHC)+JPHCEC)
         KPHCKD(KI)=IW(IW(KJQDET(KI)+JQDEHC)+JPHCKD)
         KPHCCC(KI)=IW(IW(KJQDET(KI)+JQDEHC)+JPHCCC)
         KPHCRB(KI)=IW(IW(KJQDET(KI)+JQDEHC)+JPHCRB)
         KPHCPC(KI)=IW(IW(KJQDET(KI)+JQDEHC)+JPHCPC)
         XEFO(KI)=IW(KJQDET(KI)+JQDEEF).NE.KQZER
         QEFOWE(KI)=RW(IW(KJQDET(KI)+JQDEEF)+JEFOWE)
         KEFOTY(KI)=IW(IW(KJQDET(KI)+JQDEEF)+JEFOTY)
         KEFOLE(KI)=IW(IW(KJQDET(KI)+JQDEEF)+JEFOLE)
         KEFOLT(KI)=IW(IW(KJQDET(KI)+JQDEEF)+JEFOLT)
         KEFOLH(KI)=IW(IW(KJQDET(KI)+JQDEEF)+JEFOLH)
         KEFOLC(KI)=IW(IW(KJQDET(KI)+JQDEEF)+JEFOLC)
         KEFOLJ(KI)=IW(IW(KJQDET(KI)+JQDEEF)+JEFOLJ)
         XPCQ(KI)=IW(KJQDET(KI)+JQDEPC).NE.KQZER
         KPCQNA(KI)=IW(IW(KJQDET(KI)+JQDEPC)+JPCQNA)
         XEGP(KI)=IW(KJQDET(KI)+JQDEEG).NE.KQZER
         QEGPR1(KI)=RW(IW(KJQDET(KI)+JQDEEG)+JEGPR1)
         QEGPR2(KI)=RW(IW(KJQDET(KI)+JQDEEG)+JEGPR2)
         QEGPF4(KI)=RW(IW(KJQDET(KI)+JQDEEG)+JEGPF4)
         QEGPDM(KI)=RW(IW(KJQDET(KI)+JQDEEG)+JEGPDM)
         KEGPST(KI)=IW(IW(KJQDET(KI)+JQDEEG)+JEGPST)
         KEGPQU(KI)=IW(IW(KJQDET(KI)+JQDEEG)+JEGPQU)
         KEGPPE(KI)=IW(IW(KJQDET(KI)+JQDEEG)+JEGPPE)
         XPGP(KI)=IW(KJQDET(KI)+JQDEPG).NE.KQZER.AND.IW(NAPGPC).GT.0
         QPGPR1(KI)=RW(IW(KJQDET(KI)+JQDEPG)+JPGPR1)
         QPGPR2(KI)=RW(IW(KJQDET(KI)+JQDEPG)+JPGPR2)
         QPGPF4(KI)=RW(IW(KJQDET(KI)+JQDEPG)+JPGPF4)
         QPGPDM(KI)=RW(IW(KJQDET(KI)+JQDEPG)+JPGPDM)
         QPGPST(KI)=RW(IW(KJQDET(KI)+JQDEPG)+JPGPST)
         QPGPQ1(KI)=RW(IW(KJQDET(KI)+JQDEPG)+JPGPQ1)
         QPGPQ2(KI)=RW(IW(KJQDET(KI)+JQDEPG)+JPGPQ2)
         QPGPM1(KI)=RW(IW(KJQDET(KI)+JQDEPG)+JPGPM1)
         QPGPM2(KI)=RW(IW(KJQDET(KI)+JQDEPG)+JPGPM2)
         QPGPMA(KI)=RW(IW(KJQDET(KI)+JQDEPG)+JPGPMA)
         QPGPER(KI)=RW(IW(KJQDET(KI)+JQDEPG)+JPGPER)
         QPGPTR(KI)=RW(IW(KJQDET(KI)+JQDEPG)+JPGPTR)
         QPGPPR(KI)=RW(IW(KJQDET(KI)+JQDEPG)+JPGPPR)
         KPGPQU(KI)=IW(IW(KJQDET(KI)+JQDEPG)+JPGPQU)
         KPGPPE(KI)=IW(IW(KJQDET(KI)+JQDEPG)+JPGPPE)
         XPGAC(KI)=IW(KJQDET(KI)+JQDEPG).NE.KQZER.AND.IW(NAPGAC).GT.0
         KPGAST(KI)=IW(IW(KJQDET(KI)+JQDEPG)+JPGAST)
         QPGAEF(KI)=RW(IW(KJQDET(KI)+JQDEPG)+JPGAEF)
         QPGAGC(KI)=RW(IW(KJQDET(KI)+JQDEPG)+JPGAGC)
         QPGAZS(KI)=RW(IW(KJQDET(KI)+JQDEPG)+JPGAZS)
         QPGAPL(KI)=RW(IW(KJQDET(KI)+JQDEPG)+JPGAPL)
         QPGAPH(KI)=RW(IW(KJQDET(KI)+JQDEPG)+JPGAPH)
         KPGAPN(KI)=IW(IW(KJQDET(KI)+JQDEPG)+JPGAPN)
         KPGAFA(KI)=IW(IW(KJQDET(KI)+JQDEPG)+JPGAFA)
         KPGAPE(KI)=IW(IW(KJQDET(KI)+JQDEPG)+JPGAPE)
         XYV0(KI)=KVYV0V(KENDV(KI)).NE.0
         KYV0K1(KI)=IW(KVYV0V(KENDV(KI))+JYV0K1)
         KYV0K2(KI)=IW(KVYV0V(KENDV(KI))+JYV0K2)
         QYV0VX(KI)=RW(KVYV0V(KENDV(KI))+JYV0VX)
         QYV0VY(KI)=RW(KVYV0V(KENDV(KI))+JYV0VY)
         QYV0VZ(KI)=RW(KVYV0V(KENDV(KI))+JYV0VZ)
         QYV0X1(KI)=RW(KVYV0V(KENDV(KI))+JYV0X1)
         QYV0X2(KI)=RW(KVYV0V(KENDV(KI))+JYV0X2)
         QYV0C2(KI)=RW(KVYV0V(KENDV(KI))+JYV0C2)
         KYV0IC(KI)=IW(KVYV0V(KENDV(KI))+JYV0IC)
         QYV0DM(KI)=RW(KVYV0V(KENDV(KI))+JYV0DM)
         QYV0S1(KI)=RW(KVYV0V(KENDV(KI))+JYV0S1)
         QYV0S2(KI)=RW(KVYV0V(KENDV(KI))+JYV0S2)
         XLEPTG(KI)=IW(KJQDET(KI)+JQDEPD).NE.KQZER
         KLEPPA(KI)=IW(IW(KJQDET(KI)+JQDEPD)+JPDLPA)
         KLEPJT(KI)=IW(IW(KJQDET(KI)+JQDEPD)+JPDLJT)+KLFJET-1
         QLEPPI(KI)=RW(IW(KJQDET(KI)+JQDEPD)+JPDLPI)
         QLEPPE(KI)=RW(IW(KJQDET(KI)+JQDEPD)+JPDLPE)
         KLEPVP(KI)=IW(IW(KJQDET(KI)+JQDEPD)+JPDLVP)
         XLEPTH(KI)=IW(KJQDET(KI)+JQDEPM).NE.KQZER
         KLEPFL(KI)=IW(IW(KJQDET(KI)+JQDEPM)+JPMLFL)
         KLEPPO(KI)=IW(IW(KJQDET(KI)+JQDEPM)+JPMLPO)
         KLEPCH(KI)=IW(IW(KJQDET(KI)+JQDEPM)+JPMLCH)
         KLEPSP(KI)=IW(IW(KJQDET(KI)+JQDEPM)+JPMLSP)
         KLEPLE(KI)=IW(IW(KJQDET(KI)+JQDEPM)+JPMLLE)
         KLEPME(KI)=IW(IW(KJQDET(KI)+JQDEPM)+JPMLME)
         KLEPKT(KI)=IW(IW(KJQDET(KI)+JQDEPM)+JPMLKT)
   
         ier=1
         call qpadx(itk,nhyp,rmass,q,Padri,npad,Padtl,Padre,Padsg
        &     ,Padier)
         call qdedx(itk,nhyp,rmass,q,filri,ns,filtl,filre,filsg,filier)
         if (filier.ne.0) ns =-1
         if (padier.ne.0) npad =-1.
   
    various cases
   
         if (padier.eq.0.and.filier.ne.0) then
            ier=0
            do i=1,nhyp
               extimator(i) = (padri-padre(i))/padsg(i)
            enddo
         endif
   
         if (filier.eq.0.and.padier.ne.0) then
            ier=0
            do i=1,nhyp
               extimator(i) = (filri-filre(i))/filsg(i)
            enddo
         endif
   
         if (padier.eq.0.and.filier.eq.0) then
            ier=0
   
    here I can combine with blue
   
            p = qp(itk)
            ct =qct(itk)
   
            do k=1,nhyp
               correlation = findcorr(k,nhyp,rmass,p,ct)
               matrix(1,1) = padsg(k)**2
               matrix(2,2) = filsg(k)**2
               matrix(1,2) = correlation * padsg(k) * filsg(k)
               matrix(2,1) = matrix(1,2)
   
               do i=1,2
                  do j=1,2
                     imatrix(i,j)=matrix(i,j)
                  enddo
               enddo
   
               call rinv(2,imatrix,2,temp,ifail)
               if (ifail.ne.0) then
                  ier=1
                  return
               endif
   
               denom =0.
   
               do i=1,2
                  do j=1,2
                     denom = denom +imatrix(i,j)
                  enddo
               enddo
   
               do i=1,2
                  w(i)=0.
                  do j=1,2
                     w(i) = w(i) + imatrix(i,j)/denom
                  enddo
               enddo
   
        this should be 1 by construction, but let's check..
   
               denom2 = w(1)+w(2)
   
               bestsigma = 0.
               bestri = w(1)*(padri-padre(k))+w(2)
        &           (filri-filre(k))
               do i=1,2
                  do j=1,2
                     bestsigma = bestsigma +w(i)*matrix(i,j)*w(j)/denom2
                  enddo
               enddo
               bestsigma = sqrt(bestsigma)
               extimator(k) =  bestri/bestsigma
            enddo
   
         endif
   
         return
         end
         real function findcorr(k,nhyp,rmass,p,ct)
   Auxiliary to qddx
    Boccali  March 1999
         implicit none
   
   ALPHA Version 122 - Implicit declaration include file : 12 April 1996
   
    bmacrod
         INTEGER LCOLS, LROWS, KROW, KNEXT, ITABL,LFRWRD, LFRROW
         REAL RTABL
         INTEGER ID, NRBOS, L
   
         REAL ATG
         REAL QQPI,QQE,QQ2PI,QQPIH,QQRADP,QQC,QQH,QQHC,QQIRP,QELEP,QMFLD
         REAL QMFLDC,QTIME,QTIMEI,QTIMEL,QTIMES,QTIMET,QDHEEC,QDHEEL
         REAL QDHEPF,QDHETH,QDHEPH,QDHEEF,QDHEET,QDHET1,QDHEP1,QDHET2
         REAL QDHEP2,QDHEE1,QDHEE2,QDHEE3,QKEVRN,QKEVWT,QVXNOM,QVYNOM
         REAL QVZNOM,QVXNSG,QVYNSG,QVZNSG,QINLUM,QRINLN,QRINLU,QDBOFS
         REAL QEECWI,QVXBOM,QVYBOM,QSILUM,QRSLLU,QRSLBK,QRSLEW,QVTXBP
         REAL QVTEBP,QVTSBP,QSQT,QF,QP,QX,QY,QZ,QE,QM,QCH,QCT,QDB
         REAL QZB,QDBS2,QZBS2,QBC2,QSIG,QSMAT,QSIGX,QSIGY,QSIGZ,QSIGEE
         REAL QSIGE,QSIGPP,QSIGP,QSIGMM,QSIGM,QMCHIF,QPH,QPT,QRDFL,QVX,QVY
         REAL QVZ,QVEM,QVCHIF,QVDIF2,QVDIF3,QMSQ2,QMSQ3,QMSQ4,QM2,QM3,QM4
         REAL QDMSQ,QBETA,QGAMMA,QDOT3,QDOT4,QCOSA,QPPAR,QPPER,QCMASS
         REAL QCCHAR,QCLIFE,QCWIDT,QFRFIR,QFRFTL,QFRFP0,QFRFD0,QFRFZ0
         REAL QFRFAL,QFRFEM,QFRFC2,QFRIPE,QFRIPM,QFRIPI,QFRIPK,QFRIPP
         REAL QFRINK,QTEXTM,QTEXTL,QTEXAD,QEIDRI,QEIDEC,QEIDEI,QHMAED
         REAL QHMACS,QMCADH,QMCADC,QMCAAM,QMCAAC,QMUISR,QMUIDM,QPECER
         REAL QPECE1,QPECE2,QPECTH,QPECPH,QPECEC,QPEPT1,QPEPP1,QPEPT3
         REAL QPEPP3,QPHCER,QPHCTH,QPHCPH,QPHCEC,QEFOWE,QEGPR1,QEGPR2
         REAL QEGPF4,QEGPDM,QPGPR1,QPGPR2,QPGPF4,QPGPDM,QPGPST,QPGPQ1
         REAL QPGPQ2,QPGPM1,QPGPM2,QPGPMA,QPGPER,QPGPTR,QPGPPR,QYV0VX
         REAL QYV0VY,QYV0VZ,QYV0X1,QYV0X2,QYV0C2,QYV0DM,QYV0S1,QYV0S2
         REAL QDECA2,QDECAN,QMASV0,QMCHI2,QMDIFF,QPCHAR,QPLIFE,QPMASS
         REAL QPWIDT,QKBLOK,QPGAEF,QPGAGC,QPGAZS,QPGAPL,QPGAPH
         REAL QLEPPI,QLEPPE
         INTEGER KI, KI1,KI2
         INTEGER KCQDET,KCQFPA,KCQPAR,KCQVEC,KCQVRT,KHE,KHMU,KHPI,KHK,KHP
         INTEGER KHPHOT,KHNHAD,KMONTE,KRECO,KLOCKM,KSOVT,KSCHT,KSIST,KSAST
         INTEGER KSEHT,KSV0T,KSDCT,KSEFT,KSNET,KSGAT,KSJET,KSMCT,KSREV
         INTEGER KSMCV,KUNDEF,KFOVT,KLOVT,KNOVT,KFCHT,KLCHT,KNCHT,KFIST
         INTEGER KLIST,KNIST,KFAST,KLAST,KNAST,KFEHT,KLEHT,KNEHT,KFV0T
         INTEGER KLV0T,KNV0T,KFDCT,KLDCT,KNDCT,KFEFT,KLEFT,KNEFT,KFNET
         INTEGER KLNET,KNNET,KFGAT,KLGAT,KNGAT,KFJET,KLJET,KNJET,KFMCT
         INTEGER KLMCT,KNMCT,KFREV,KLREV,KNREV,KFMCV,KLMCV,KNMCV,KLUST
         INTEGER KLUSV,KFFRT,KLFRT,KFFRV,KLFRV,KNRET,KNCOT,KFFRD,KBIT
         INTEGER KCLACO,KCLAFR,KCLARM,KDEBUG,KEVT,KEXP,KFFILL,KFEOUT
         INTEGER KJOPTN,KLEOUT,KLROUT,KLOCK0,KLOCK1,KLOCK2,KMATIX,KMQFPA
         INTEGER KNEFIL,KNEOUT,KNEVT,KNPAST,KNQDET,KNQFPA,KNQLIN,KNQMTX
         INTEGER KNQPAR,KNQPST,KNREIN,KNREOU,KOQDET,KOQFPA,KOQLIN,KOQMTL
         INTEGER KOQMTS,KOQPAR,KOQPBT,KOQPLI,KOQTRA,KOQVEC,KOQVRT,KQPAR
         INTEGER KQVEC,KQVRT,KQWRK,KQZER,KRUN,KSTATU,KTDROP,KUCARD,KUCONS
         INTEGER KUHIST,KUINPU,KUOUTP,KUPRNT,KUPTER,KDEBU1,KDEBU2,KNWRLM
         INTEGER KEFOPT,KUEDIN,KUEDOU,KURTOX,KUCAR2,KNHDRN,KNBHAB,KSBHAB
         INTEGER KRSLLQ,KRSLNB,INDATA,KRINNE,KRINNF,KRINDC,KRINDQ,KRINNZ
         INTEGER KRINNB,KRINBM,KRINFR,KRINLR,KRINLF,KEVERT,KEVEDA,KEVETI
         INTEGER KEVEMI,KEVETY,KEVEES,KDHEFP,KDHENP,KDHENM,KKEVNT,KKEVNV
         INTEGER KKEVID,KDHENX,KDHENV,KDHENJ,KREVDS,KXTET1,KXTET2,KXTEL2
         INTEGER KXTCGC,KXTCLL,KXTCBN,KXTCCL,KXTCHV,KXTCEN,KCLASW,KERBOM
         INTEGER KBPSTA,KLOCUS,KFRET,KLRET,KFCOT,KLCOT,NAAFID,NAAJOB
         INTEGER NAASEV,NABCNT,NABHIT,NABOMB,NABOME,NABOMP,NABOMR,NABPTR
         INTEGER NADCAL,NADCRL,NADECO,NADEID,NADENF,NADEVT,NADEWI,NADFMC
         INTEGER NADFOT,NADGAM,NADHCO,NADHEA,NADHRL,NADJET,NADMID,NADMJT
         INTEGER NADMUO,NADNEU,NADPOB,NADRES,NADTBP,NADTMC,NADTRA,NADVER
         INTEGER NADVMC,NAECRQ,NAECTE,NAEGID,NAEGPC,NAEIDT,NAEJET,NAERRF
         INTEGER NAETDI,NAETKC,NAEVEH,NAEWHE,NAFICL,NAFKIN,NAFPOI,NAFPOL
         INTEGER NAFRFT,NAFRID,NAFRTL,NAFSTR,NAFTCL,NAFTCM,NAFTOC,NAFTTM
         INTEGER NAFVCL,NAFVER,NAFZFR,NAHCCV,NAHCTE,NAHINF,NAHMAD,NAHPDI
         INTEGER NAHROA,NAHSDA,NAHTUB,NAIASL,NAIPJT,NAIRJT,NAITCO,NAITMA
         INTEGER NAIXTR,NAIZBD,NAJBER,NAJEST,NAJSUM,NAKEVH,NAKINE,NAKJOB
         INTEGER NAKLIN,NAKPOL,NAKRUN,NALIDT,NALOLE,NALUPA,NAMCAD,NAMHIT
         INTEGER NAMTHR,NAMUDG,NAMUEX,NAOSTS,NAPART,NAPASL,NAPCHY,NAPCOB
         INTEGER NAPCOI,NAPCPA,NAPCQA,NAPCRL,NAPECO,NAPEHY,NAPEID,NAPEMH
         INTEGER NAPEPT,NAPEST,NAPEWI,NAPFER,NAPFHR,NAPFRF,NAPFRT,NAPHCO
         INTEGER NAPHER,NAPHHY,NAPHMH,NAPHST,NAPIDI,NAPITM,NAPLID,NAPLPD
         INTEGER NAPLSD,NAPMSK,NAPNEU,NAPPDS,NAPPOB,NAPPRL,NAPRTM,NAPSCO
         INTEGER NAPSPO,NAPSTR,NAPT2X,NAPTBC,NAPTCO,NAPTEX,NAPTMA,NAPTML
         INTEGER NAPTNC,NAPTST,NAPVCO,NAPYER,NAPYFR,NAPYNE,NAQDET,NAQFPA
         INTEGER NAQLIN,NAQMTL,NAQMTS,NAQPAR,NAQPBT,NAQPLI,NAQTRA,NAQVEC
         INTEGER NAQVRT,NAQWRK,NAQZER,NAREVH,NARHAH,NARTLO,NARTLS,NARUNH
         INTEGER NARUNR,NASFTR,NATEXS,NATGMA,NATMTL,NATPCO,NAVCOM,NAVCPL
         INTEGER NAVDCO,NAVDHT,NAVDXY,NAVDZT,NAVERT,NAVFHL,NAVFLG,NAVFPH
         INTEGER NAVHLS,NAVPLH,NAX1AD,NAX1SC,NAX1TI,NAX2DF,NAX3EC,NAX3EW
         INTEGER NAX3HC,NAX3IT,NAX3L2,NAX3LU,NAX3TM,NAX3TO,NAX3TP,NAX3X3
         INTEGER NAXTBN,NAXTBP,NAXTCN,NAXTEB,NAXTOP,NAXTRB,NAYV0V,NAZPFR
         INTEGER NANBIP,NAPGAC,NAPMSC,NAPTHR,NAPDLT,NAPMLT,NAPLJT
         INTEGER NAEFOL,NAMUID,NAPGID,NAPGPC,JQVEQX,JQVEQY,JQVEQZ,JQVEQE
         INTEGER JQVEQM,JQVEQP,JQVECH,JQVETN,JQVESC,JQVEKS,JQVECL,JQVEPA
         INTEGER JQVEQD,JQVENP,JQVESP,JQVEOV,JQVEEV,JQVEND,JQVEDL,JQVENO
         INTEGER JQVEOL,JQVENM,JQVEML,JQVEBM,JQVELK,JQVEDB,JQVEZB,JQVESD
         INTEGER JQVESZ,JQVECB,JQVEEM,JQVECF,JQVEEW,JQVEUS,JQVRVX,JQVRVY
         INTEGER JQVRVZ,JQVRVN,JQVRTY,JQVRIP,JQVRND,JQVRDL,JQVRAY,JQVRAF
         INTEGER JQVREM,JQVRCF,JQVRET,JQDEAF,JQDEAL,JQDENT,JQDEAT,JQDELT
         INTEGER JQDEAE,JQDEAH,JQDEAM,JQDECF,JQDEEC,JQDEHC,JQDEET,JQDEFI
         INTEGER JQDENF,JQDEFL,JQDENE,JQDEEL,JQDENH,JQDEHL,JQDELH,JQDEEF
         INTEGER JQDEPC,JQDEEG,JQDEMU,JQDEDX,JQDEPG,JQPAGN,JQPANA,JQPACO
         INTEGER JQPAMA,JQPACH,JQPALT,JQPAWI,JQPAAN
         INTEGER KJQDET,KCH,KTN,KMC
         INTEGER KBMASK,KCALFL,KCHGD,KCLASS,KDAU,KECAL,KENDV,KFOLLO,KHCAL
         INTEGER KLUNDS,KNCHGD,KNECAL,KNHCAL,KNMOTH,KMOTH,KMTCH,KNDAU
         INTEGER KNMTCH,KORIV,KSAME,KSMTCH,KSTABC,KTPCOD,KRDFL,KVN,KVTYPE
         INTEGER KVINCP,KVNDAU,KVYV0V,KVFVER,KVDAU,KI3,KI4,KFRFDF,KFRFNO
         INTEGER KFRTNV,KFRTNI,KFRTNE,KFRTNT,KFRTNR,KFRIBP,KFRIDZ,KFRIBC
         INTEGER KFRIDC,KFRIQF,KNTEX,KTEXSI,KTEXNS,KEIDIF,KEIDIP,KHMANF
         INTEGER KHMANE,KHMANL,KHMAMH,KHMAIG,KHMAND,KHMAIE,KHMAIT,KHMAIF
         INTEGER KMCANH,KMUIIF,KMUIST,KMUITN,KPECKD,KPECCC,KPECRB,KPECPC
         INTEGER KPHCKD,KPHCCC,KPHCRB,KPHCPC,KEFOTY,KEFOLE,KEFOLT,KEFOLH
         INTEGER KEFOLC,KEFOLJ,KPCQNA,KEGPST,KEGPQU,KEGPPE,KPGPQU,KPGPPE
         INTEGER KYV0K1,KYV0K2,KYV0IC,KSCNEW,KSCOLD,KFPADR,KGLUND,KMCCOD
         INTEGER KCANTI,KCDIR,KCDIRA,KCHT,KIDSAV,KPANTI,KPART,KPDIR,KPDIRA
         INTEGER KTLOR,KTLOR1,KVFITA,KVFITC,KVFITM,KVFITN,KVFITV,KVFTMC
         INTEGER KTLORX,KVGOOD,KVNEW,KVSAVA,KVSAVC,KVSAVE,KPARTX,KPCCOMP
         INTEGER KPGAPN,KPGAFA,KPGAPE,KLEPPA,KLEPJT,KLEPFL,KLEPPO,KLEPCH
         INTEGER KPGAST,KLEPVP,KLEPSP,KLEPLE,KLEPME,KLEPKT,JQDEPD,JQDEPM
         INTEGER KLFJET,KLLJET,KLNJET,KLJTNO
   
   
   -------------------- /QCDE/ --- COMMONs, DIMENSIONs, etc. ------------
   
    of QCDESH ----------------------- Description in QDATA ---------
         PARAMETER (KCQDET=34, KCQFPA=8, KCQPAR=10, KCQVEC=73, KCQVRT=30,
        & KHE=1, KHMU=2, KHPI=3, KHK=4, KHP=5, KHPHOT=1, KHNHAD=2,
        & KMONTE=-2, KRECO=-1, KLOCKM=14, KSOVT=1, KSCHT=2, KSIST=3,
        & KSAST=4, KSEHT=5, KSV0T=6, KSDCT=7, KSEFT=8, KSNET=9, KSGAT=10,
        & KSJET=11, KSMCT=12, KSREV=13,
        & KSMCV=14, KUNDEF=-12344321, QQPI=3.141593, QQE=2.718282,
        & QQ2PI=QQPI*2., QQPIH=QQPI/2., QQRADP=180./QQPI, QQC=2.997925E10,
        & QQH=6.582173E-25, QQHC=QQH*QQC, QQIRP=.00029979)
         CHARACTER CQDATE*8, CQDWRK*80, CQFHIS*80, CQFOUT*80, CQFWRK*80,
        & CQHTIT*80, CQSEC*3, CQTIME*8, CQUNPK*30, CQVERS*6, CQRLST*800,
        & CQELST*800
         COMMON /QCDEC/ CQDATE, CQDWRK, CQFHIS, CQFOUT, CQFWRK, CQHTIT,
        & CQSEC(14), CQTIME, CQUNPK, CQVERS, CQRLST, CQELST
         COMMON /QCDE/ QELEP, QMFLD ,QMFLDC, QTIME, QTIMEI, QTIMEL,
        & QTIMES, QTIMET, QDHEEC, QDHEEL, QDHEPF, QDHETH, QDHEPH, QDHEEF,
        & QDHEET, QDHET1, QDHEP1, QDHET2, QDHEP2, QDHEE1, QDHEE2, QDHEE3,
        & QKEVRN, QKEVWT, QVXNOM, QVYNOM, QVZNOM, QVXNSG, QVYNSG, QVZNSG,
        & QINLUM, QRINLN, QRINLU, QDBOFS, QEECWI(36), QVXBOM, QVYBOM,
        & QSILUM, QRSLLU, QRSLBK, QRSLEW , QVTXBP(3), QVTEBP(3), QVTSBP(3)
         COMMON /QCDE/  KFOVT, KLOVT, KNOVT, KFCHT, KLCHT, KNCHT, KFIST,
        & KLIST, KNIST, KFAST, KLAST, KNAST, KFEHT, KLEHT, KNEHT, KFV0T,
        & KLV0T, KNV0T, KFDCT, KLDCT, KNDCT, KFEFT, KLEFT, KNEFT, KFNET,
        & KLNET, KNNET, KFGAT, KLGAT, KNGAT, KFJET, KLJET, KNJET, KFMCT,
        & KLMCT, KNMCT, KFREV, KLREV, KNREV, KFMCV, KLMCV, KNMCV, KLUST,
        & KLUSV, KFFRT, KLFRT, KFFRV, KLFRV, KNRET, KNCOT, KFFRD,
        & KLFJET,KLLJET,KLNJET
         COMMON /QCDE/ KBIT(32), KCLACO(KCQFPA), KCLAFR(KCQFPA), KCLARM
        & (KCQFPA), KDEBUG, KEVT, KEXP, KFFILL, KFEOUT, KJOPTN(2,2),
        & KLEOUT, KLROUT, KLOCK0(KLOCKM,2), KLOCK1(KLOCKM,2), KLOCK2(
        & KLOCKM,2), KMATIX(6,6), KMQFPA, KNEFIL, KNEOUT, KNEVT, KNPAST,
        & KNQDET, KNQFPA, KNQLIN, KNQMTX, KNQPAR, KNQPST, KNREIN, KNREOU,
        & KOQDET, KOQFPA, KOQLIN, KOQMTL, KOQMTS, KOQPAR, KOQPBT, KOQPLI,
        & KOQTRA, KOQVEC, KOQVRT, KQPAR, KQVEC, KQVRT, KQWRK, KQZER, KRUN,
        & KSTATU, KTDROP, KUCARD, KUCONS, KUHIST, KUINPU, KUOUTP, KUPRNT,
        & KUPTER, KDEBU1, KDEBU2, KNWRLM, KEFOPT, KUEDIN, KUEDOU, KURTOX,
        & KUCAR2, KNHDRN, KNBHAB, KSBHAB, KRSLLQ, KRSLNB
         COMMON /QCDE/ INDATA
         COMMON /QCDE/ KRINNE, KRINNF, KRINDC, KRINDQ, KRINNZ, KRINNB,
        & KRINBM, KRINFR, KRINLR, KRINLF
         COMMON /QCDE/ KEVERT, KEVEDA, KEVETI, KEVEMI(4), KEVETY, KEVEES,
        & KDHEFP, KDHENP, KDHENM, KKEVNT, KKEVNV, KKEVID, KDHENX, KDHENV,
        & KDHENJ, KREVDS, KXTET1, KXTET2, KXTEL2, KXTCGC, KXTCLL, KXTCBN,
        & KXTCCL, KXTCHV, KXTCEN, KCLASW, KERBOM, KBPSTA
         DIMENSION KLOCUS(3,14)
         EQUIVALENCE (KLOCUS(1,1),KFOVT), (KFOVT,KFRET), (KLIST,KLRET),
        & (KFIST,KFCOT), (KLAST,KLCOT)
         COMMON /QCDE/ XCOPYJ, XFLIAC, XHISTO, XLREV(2), XLREV2(2), XMCEV,
        & XMINI, XSYNTX, XWREVT, XWRRUN, XFILMC, XFILCH, XFILV0, XFILCO,
        & XFILEF, XFILPC, XFILGA, XFILJE,
        & XPRHIS, XFILL, XVITC, XVTPC, XVECAL, XVLCAL, XVTPCD,
        & XVSATR, XVHCAL, XHVTRG, XSREC, XWMINI, XIOKLU, XIOKSI, XFRF2,
        & XNSEQ, XVDOK, XFRF0, XFMUID, XFILEM, XWNANO, XROKSI, XGETBP,
        & XJTHRU
         LOGICAL XCOPYJ, XFLIAC, XHISTO, XLREV, XLREV2, XMCEV, XMINI,
        & XSYNTX, XWREVT, XWRRUN, XFILMC, XFILCH, XFILV0, XFILCO, XFILEF,
        & XFILPC, XPRHIS, XFILL, XVITC, XVTPC, XVECAL, XVLCAL, XVTPCD,
        & XVSATR, XVHCAL, XHVTRG, XSREC, XWMINI, XIOKLU, XFRF2, XFILJE,
        & XNSEQ, XFILGA, XVDOK, XFRF0, XFMUID, XFILEM, XWNANO, XIOKSI,
        & XROKSI, XGETBP, XJTHRU
   
   -------------------- /NANCOM/ --- NanoDst steering -------------------
    XNANO   .TRUE. if input is a NanoDst (in NANO or EPIO format, depending
                      XNANOR)
   
         LOGICAL XNANO
         COMMON /NANCOM/XNANO
   
   
    bcs
         INTEGER LMHLEN, LMHCOL, LMHROW
         PARAMETER (LMHLEN=2, LMHCOL=1, LMHROW=2)
         COMMON /BCS/   IW(1000)
         INTEGER IW
         REAL RW(1000)
         EQUIVALENCE (RW(1),IW(1))
   
   
   ------------------ /QCNAMI/ --- name indices -------------------------
         COMMON /QCNAMI/ NAAFID,NAAJOB,NAASEV,NABCNT,NABHIT,NABOMB,
        1 NABOME,NABOMP,NABOMR,NABPTR,NADCAL,NADCRL,NADECO,NADEID,NADENF,
        2 NADEVT,NADEWI,NADFMC,NADFOT,NADGAM,NADHCO,NADHEA,NADHRL,NADJET,
        3 NADMID,NADMJT,NADMUO,NADNEU,NADPOB,NADRES,NADTBP,NADTMC,NADTRA,
        4 NADVER,NADVMC,NAECRQ,NAECTE,NAEGID,NAEGPC,NAEIDT,NAEJET,NAERRF,
        5 NAETDI,NAETKC,NAEVEH,NAEWHE,NAFICL,NAFKIN,NAFPOI,NAFPOL,NAFRFT,
        6 NAFRID,NAFRTL,NAFSTR,NAFTCL,NAFTCM,NAFTOC,NAFTTM,NAFVCL,NAFVER,
        7 NAFZFR,NAHCCV,NAHCTE,NAHINF,NAHMAD,NAHPDI,NAHROA,NAHSDA,NAHTUB,
        8 NAIASL,NAIPJT,NAIRJT,NAITCO,NAITMA,NAIXTR,NAIZBD,NAJBER,NAJEST,
        9 NAJSUM,NAKEVH,NAKINE,NAKJOB,NAKLIN,NAKPOL,NAKRUN,NALIDT,NALOLE,
        A NALUPA,NAMCAD,NAMHIT,NAMTHR,NAMUDG,NAMUEX,NAOSTS,NAPART,NAPASL,
        B NAPCHY,NAPCOB,NAPCOI,NAPCPA,NAPCQA,NAPCRL,NAPECO,NAPEHY,NAPEID,
        C NAPEMH,NAPEPT,NAPEST,NAPEWI,NAPFER,NAPFHR,NAPFRF,NAPFRT,NAPHCO,
        D NAPHER,NAPHHY,NAPHMH,NAPHST,NAPIDI,NAPITM,NAPLID,NAPLPD,NAPLSD,
        E NAPMSK,NAPNEU,NAPPDS,NAPPOB,NAPPRL,NAPRTM,NAPSCO,NAPSPO,NAPSTR,
        F NAPT2X,NAPTBC,NAPTCO,NAPTEX,NAPTMA,NAPTML,NAPTNC,NAPTST,NAPVCO,
        G NAPYER,NAPYFR,NAPYNE,NAQDET,NAQFPA,NAQLIN,NAQMTL,NAQMTS,NAQPAR,
        H NAQPBT,NAQPLI,NAQTRA,NAQVEC,NAQVRT,NAQWRK,NAQZER,NAREVH,NARHAH,
        I NARTLO,NARTLS,NARUNH,NARUNR,NASFTR,NATEXS,NATGMA,NATMTL,NATPCO,
        J NAVCOM,NAVCPL,NAVDCO,NAVDHT,NAVDXY,NAVDZT,NAVERT,NAVFHL,NAVFLG,
        K NAVFPH,NAVHLS,NAVPLH,NAX1AD,NAX1SC,NAX1TI,NAX2DF,NAX3EC,NAX3EW,
        L NAX3HC,NAX3IT,NAX3L2,NAX3LU,NAX3TM,NAX3TO,NAX3TP,NAX3X3,NAXTBN,
        M NAXTBP,NAXTCN,NAXTEB,NAXTOP,NAXTRB,NAYV0V,NAZPFR,NAEFOL,NAMUID,
        N NAPGID,NAPGPC,NAPGAC,NAPMSC,NAPTHR,NANBIP,NAPDLT,NAPMLT,NAPLJT
   
   
   ------------------ /QQQQJJ/ --- HAC parameters for ALPHA banks -------
         PARAMETER (JQVEQX= 1,JQVEQY= 2,JQVEQZ= 3,JQVEQE= 4,JQVEQM= 5,
        & JQVEQP= 6,JQVECH= 7,JQVETN= 8,JQVESC= 9,JQVEKS=10,JQVECL=11,
        & JQVEPA=12,JQVEQD=13,JQVENP=14,JQVESP=15,JQVEOV=16,JQVEEV=17,
        & JQVEND=18,JQVEDL=19,JQVENO=20,JQVEOL=21,JQVENM=22,JQVEML=23,
        & JQVEBM=24,JQVELK=38,JQVEDB=39,JQVEZB=40,JQVESD=41,JQVESZ=42,
        & JQVECB=43,JQVEEM=44,JQVECF=54,JQVEEW=55,JQVEUS=56)
         PARAMETER ( JQVRVX=1,JQVRVY=2,JQVRVZ=3,JQVRVN=4,JQVRTY=5,
        1   JQVRIP=6,JQVRND=7,JQVRDL=8,JQVRAY=9,JQVRAF=10,JQVREM=11,
        2   JQVRCF=17,JQVRET=18)
         PARAMETER ( JQDEAF= 1,JQDEAL= 2,JQDENT= 3,JQDEAT= 4,JQDELT= 8,
        &  JQDEAE= 9,JQDEAH=10,JQDEAM=11,JQDECF=12,JQDEEC=13,JQDEHC=14,
        &  JQDEET=15,JQDEFI=16,JQDENF=17,JQDEFL=18,JQDENE=19,JQDEEL=20,
        &  JQDENH=21,JQDEHL=22,JQDELH=23,JQDEEF=24,JQDEPC=25,JQDEEG=26,
        &  JQDEMU=27,JQDEDX=28,JQDEPG=29,JQDEPD=30,JQDEPM=31)
         PARAMETER ( JQPAGN=1, JQPANA=2, JQPACO=5, JQPAMA=6, JQPACH=7,
        & JQPALT=8,JQPAWI=9,JQPAAN=10)
   
   
         EXTERNAL CQPART, CQTPN, XCEQAN, XLUMOK, XPEQAN, XPEQOR, XPEQU,
        & XVDEOK, LLUMOK, SLUMOK
         CHARACTER * 12 CQPART, CQTPN
         LOGICAL XCAL, XCEQAN, XCEQOR, XCEQU, XECAL, XEID, XFRF, XHCAL,
        & XHMA, XLOCK, XLOCKN, XMC, XLUMOK, XMCA, XPEO, XPHO, XPEQAN,
        & XPEQOR, XPEQU, XSAME, XSIG, XTEX, XPEC, XPEP, XPHC, XYV0,
        & XFRIQF, XEFO, XPCQ, XEGP, XMUI, XVDEOK, XPGP, LLUMOK, SLUMOK,
        & XPGAC, XLEPTG, XLEPTH
   
    alcons
    define universal constants
         REAL PI, TWOPI, PIBY2, PIBY3, PIBY4, PIBY6, PIBY8, PIBY12
         REAL RADEG, DEGRA
         REAL CLGHT, ALDEDX
         PARAMETER (PI=3.141592653589)
         PARAMETER (RADEG=180./PI, DEGRA=PI/180.)
         PARAMETER (TWOPI = 2.*PI , PIBY2 = PI/2., PIBY4 = PI/4.)
         PARAMETER (PIBY6 = PI/6. , PIBY8 = PI/8.)
         PARAMETER (PIBY12= PI/12., PIBY3 = PI/3.)
         PARAMETER (CLGHT = 29.9792458, ALDEDX = 0.000307)
   
         ALDEDX  = constant used in the computation of DEDX in GeV
         CLGHT   = speed of light in cm/nsec
   
   
   
    efoljj
         INTEGER JEFOPX,JEFOPY,JEFOPZ,JEFOEW,JEFOWE,JEFOTY,JEFOLE,JEFOLT,
        +          JEFOLH,JEFOLC,JEFOLJ,LEFOLA
         PARAMETER(JEFOPX=1,JEFOPY=2,JEFOPZ=3,JEFOEW=4,JEFOWE=5,JEFOTY=6,
        +          JEFOLE=7,JEFOLT=8,JEFOLH=9,JEFOLC=10,JEFOLJ=11,
        +          LEFOLA=11)
   
   
    egpcjj
         INTEGER JEGPPX,JEGPPY,JEGPPZ,JEGPR1,JEGPR2,JEGPF4,JEGPDM,JEGPST,
        +          JEGPQU,JEGPPE,LEGPCA
         PARAMETER(JEGPPX=1,JEGPPY=2,JEGPPZ=3,JEGPR1=4,JEGPR2=5,JEGPF4=6,
        +          JEGPDM=7,JEGPST=8,JEGPQU=9,JEGPPE=10,LEGPCA=10)
   
   
    eidtjj
         INTEGER JEIDIF,JEIDR1,JEIDR2,JEIDR3,JEIDR4,JEIDR5,JEIDR6,JEIDR7,
        +          JEIDEC,JEIDIP,JEIDE1,JEIDE2,JEIDE3,JEIDFR,JEIDPE,LEIDTA
         PARAMETER(JEIDIF=1,JEIDR1=2,JEIDR2=3,JEIDR3=4,JEIDR4=5,JEIDR5=6,
        +          JEIDR6=7,JEIDR7=8,JEIDEC=9,JEIDIP=10,JEIDE1=11,
        +          JEIDE2=12,JEIDE3=13,JEIDFR=14,JEIDPE=15,LEIDTA=15)
   
   
    frftjj
         INTEGER JFRFIR,JFRFTL,JFRFP0,JFRFD0,JFRFZ0,JFRFAL,JFRFEM,JFRFC2,
        +          JFRFDF,JFRFNO,LFRFTA
         PARAMETER(JFRFIR=1,JFRFTL=2,JFRFP0=3,JFRFD0=4,JFRFZ0=5,JFRFAL=6,
        +          JFRFEM=7,JFRFC2=28,JFRFDF=29,JFRFNO=30,LFRFTA=30)
   
   
    fridjj
         INTEGER JFRIBP,JFRIDZ,JFRIBC,JFRIDC,JFRIPE,JFRIPM,JFRIPI,JFRIPK,
        +          JFRIPP,JFRINK,JFRIQF,LFRIDA
         PARAMETER(JFRIBP=1,JFRIDZ=2,JFRIBC=3,JFRIDC=4,JFRIPE=5,JFRIPM=6,
        +          JFRIPI=7,JFRIPK=8,JFRIPP=9,JFRINK=10,JFRIQF=11,
        +          LFRIDA=11)
   
   
    frtljj
         INTEGER JFRTIV,JFRTNV,JFRTII,JFRTNI,JFRTNE,JFRTIT,JFRTNT,JFRTNR,
        +          LFRTLA
         PARAMETER(JFRTIV=1,JFRTNV=2,JFRTII=3,JFRTNI=4,JFRTNE=5,JFRTIT=6,
        +          JFRTNT=7,JFRTNR=8,LFRTLA=8)
   
   
    hmadjj
         INTEGER JHMANF,JHMANE,JHMANL,JHMAMH,JHMAIG,JHMAED,JHMACS,JHMAND,
        +          JHMAIE,JHMAIT,JHMAIF,JHMATN,LHMADA
         PARAMETER(JHMANF=1,JHMANE=2,JHMANL=3,JHMAMH=4,JHMAIG=5,JHMAED=6,
        +          JHMACS=7,JHMAND=8,JHMAIE=9,JHMAIT=10,JHMAIF=11,
        +          JHMATN=12,LHMADA=12)
   
   
    mcadjj
         INTEGER JMCANH,JMCADH,JMCADC,JMCAAM,JMCAAC,JMCATN,LMCADA
         PARAMETER(JMCANH=1,JMCADH=3,JMCADC=5,JMCAAM=7,JMCAAC=8,JMCATN=9,
        +          LMCADA=9)
   
   
    muidjj
         INTEGER JMUIIF,JMUISR,JMUIDM,JMUIST,JMUITN,LMUIDA
         PARAMETER(JMUIIF=1,JMUISR=2,JMUIDM=3,JMUIST=4,JMUITN=5,LMUIDA=5)
   
   
    pcqajj
         INTEGER JPCQNA,JPCQPX,JPCQPY,JPCQPZ,JPCQEN,LPCQAA
         PARAMETER(JPCQNA=1,JPCQPX=2,JPCQPY=3,JPCQPZ=4,JPCQEN=5,LPCQAA=5)
   
   
    pdltjj
         INTEGER JPDLPA,JPDLJT,JPDLPI,JPDLPE,JPDLVP,JPDLFR,LPDLTA
         PARAMETER(JPDLPA=1,JPDLJT=2,JPDLPI=3,JPDLPE=4,JPDLVP=5,JPDLFR=6,
        +          LPDLTA=6)
   
   
    pecojj
         INTEGER JPECER,JPECE1,JPECE2,JPECTH,JPECPH,JPECEC,JPECKD,JPECCC,
        +          JPECRB,JPECPC,LPECOA
         PARAMETER(JPECER=1,JPECE1=2,JPECE2=3,JPECTH=4,JPECPH=5,JPECEC=6,
        +          JPECKD=7,JPECCC=8,JPECRB=9,JPECPC=10,LPECOA=10)
   
   
    peptjj
         INTEGER JPEPT1,JPEPP1,JPEPT3,JPEPP3,LPEPTA
         PARAMETER(JPEPT1=1,JPEPP1=2,JPEPT3=3,JPEPP3=4,LPEPTA=4)
   
   
    pgacjj
         INTEGER JPGAEC,JPGATC,JPGAPC,JPGAR1,JPGAR2,JPGAF4,JPGADM,JPGAST,
        +          JPGAQU,JPGAQ1,JPGAQ2,JPGAM1,JPGAM2,JPGAMA,JPGAER,JPGATR,
        +          JPGAPR,JPGAEF,JPGAGC,JPGAZS,JPGAPL,JPGAPH,JPGAPN,JPGAFA,
        +          JPGAPE,LPGACA
         PARAMETER(JPGAEC=1,JPGATC=2,JPGAPC=3,JPGAR1=4,JPGAR2=5,JPGAF4=6,
        +          JPGADM=7,JPGAST=8,JPGAQU=9,JPGAQ1=10,JPGAQ2=11,
        +          JPGAM1=12,JPGAM2=13,JPGAMA=14,JPGAER=15,JPGATR=16,
        +          JPGAPR=17,JPGAEF=18,JPGAGC=19,JPGAZS=20,JPGAPL=21,
        +          JPGAPH=22,JPGAPN=23,JPGAFA=24,JPGAPE=25,LPGACA=25)
   
   
    pgpcjj
         INTEGER JPGPEC,JPGPTC,JPGPPC,JPGPR1,JPGPR2,JPGPF4,JPGPDM,JPGPST,
        +          JPGPQU,JPGPQ1,JPGPQ2,JPGPM1,JPGPM2,JPGPMA,JPGPER,JPGPTR,
        +          JPGPPR,JPGPPE,LPGPCA
         PARAMETER(JPGPEC=1,JPGPTC=2,JPGPPC=3,JPGPR1=4,JPGPR2=5,JPGPF4=6,
        +          JPGPDM=7,JPGPST=8,JPGPQU=9,JPGPQ1=10,JPGPQ2=11,
        +          JPGPM1=12,JPGPM2=13,JPGPMA=14,JPGPER=15,JPGPTR=16,
        +          JPGPPR=17,JPGPPE=18,LPGPCA=18)
   
   
    phcojj
         INTEGER JPHCER,JPHCTH,JPHCPH,JPHCEC,JPHCKD,JPHCCC,JPHCRB,JPHCNF,
        +          JPHCPC,LPHCOA
         PARAMETER(JPHCER=1,JPHCTH=2,JPHCPH=3,JPHCEC=4,JPHCKD=5,JPHCCC=6,
        +          JPHCRB=7,JPHCNF=8,JPHCPC=9,LPHCOA=9)
   
   
    pmltjj
         INTEGER JPMLFL,JPMLPO,JPMLCH,JPMLSP,JPMLLE,JPMLME,JPMLKT,JPMLFR,
        +          LPMLTA
         PARAMETER(JPMLFL=1,JPMLPO=2,JPMLCH=3,JPMLSP=4,JPMLLE=5,JPMLME=6,
        +          JPMLKT=7,JPMLFR=8,LPMLTA=8)
   
   
    texsjj
         INTEGER JTEXSI,JTEXTM,JTEXTL,JTEXNS,JTEXAD,JTEXTN,JTEXSF,LTEXSA
         PARAMETER(JTEXSI=1,JTEXTM=2,JTEXTL=3,JTEXNS=4,JTEXAD=5,JTEXTN=6,
        +          JTEXSF=7,LTEXSA=7)
   
   
    yv0vjj
         INTEGER JYV0K1,JYV0K2,JYV0VX,JYV0VY,JYV0VZ,JYV0VM,JYV0PX,JYV0PY,
        +          JYV0PZ,JYV0PM,JYV0X1,JYV0X2,JYV0XM,JYV0C2,JYV0IC,JYV0P1,
        +          JYV0P2,JYV0EP,JYV0DM,JYV0S1,JYV0S2,LYV0VA
         PARAMETER(JYV0K1=1,JYV0K2=2,JYV0VX=3,JYV0VY=4,JYV0VZ=5,JYV0VM=6,
        +          JYV0PX=12,JYV0PY=13,JYV0PZ=14,JYV0PM=15,JYV0X1=21,
        +          JYV0X2=22,JYV0XM=23,JYV0C2=26,JYV0IC=27,JYV0P1=28,
        +          JYV0P2=31,JYV0EP=34,JYV0DM=55,JYV0S1=56,JYV0S2=57,
        +          LYV0VA=57)
   
   
         integer k,nhyp
         real ct
         real correlation
         real rmass(*)
         real p
         integer findindexct,findindexbg
   
     parameterization:
   
    1 - betagamma
    2 - cos(theta)
         real correH(3,2)
         real corree(2)
         real bg
         logical goodwindow
         integer ict,inbg
   
    binning:
   
         data correH /0.53, 0.48, 0.51, 0.35, 0.34, 0.44/
         data corree /0.43, 0.36/
   
   -------------------- /QMACRO/ --- statement functions ----------------
   
    bmacro
       set of intrinsic functions to handle BOS banks
   - # of words/row in bank with index ID
         LCOLS(ID) = IW(ID+1)
   - # of rows in bank with index ID
         LROWS(ID) = IW(ID+2)
   - index of next row in the bank with index ID
         KNEXT(ID) = ID + LMHLEN + IW(ID+1)*IW(ID+2)
   - index of row # NRBOS in the bank with index ID
         KROW(ID,NRBOS) = ID + LMHLEN + IW(ID+1)*(NRBOS-1)
   - # of free words in the bank with index ID
         LFRWRD(ID) = ID + IW(ID) - KNEXT(ID)
   - # of free rows in the bank with index ID
         LFRROW(ID) = LFRWRD(ID) / LCOLS(ID)
   - Lth integer element of the NRBOSth row of the bank with index ID
         ITABL(ID,NRBOS,L) = IW(ID+LMHLEN+(NRBOS-1)*IW(ID+1)+L)
   - Lth real element of the NRBOSth row of the bank with index ID
         RTABL(ID,NRBOS,L) = RW(ID+LMHLEN+(NRBOS-1)*IW(ID+1)+L)
   
   -------------------- /QCFUNC/ --- statement functions for ALPHA banks
         KJQDET(KI)=IW(KOQVEC+KI*KCQVEC+JQVEQD)
         QSQT(QF)=SIGN(SQRT(ABS(QF)),QF)
         QP(KI)=RW(KOQVEC+KI*KCQVEC+JQVEQP)
         QX(KI)=RW(KOQVEC+KI*KCQVEC+JQVEQX)
         QY(KI)=RW(KOQVEC+KI*KCQVEC+JQVEQY)
         QZ(KI)=RW(KOQVEC+KI*KCQVEC+JQVEQZ)
         QE(KI)=RW(KOQVEC+KI*KCQVEC+JQVEQE)
         QM(KI)=RW(KOQVEC+KI*KCQVEC+JQVEQM)
         QCH(KI)=RW(KOQVEC+KI*KCQVEC+JQVECH)
         KCH(KI)=NINT (QCH(KI))
         QCT(KI)=QZ(KI)/QP(KI)
         QDB(KI)=RW(KOQVEC+KI*KCQVEC+JQVEDB)
         QZB(KI)=RW(KOQVEC+KI*KCQVEC+JQVEZB)
         QDBS2(KI)=RW(KOQVEC+KI*KCQVEC+JQVESD)
         QZBS2(KI)=RW(KOQVEC+KI*KCQVEC+JQVESZ)
         QBC2(KI)=RW(KOQVEC+KI*KCQVEC+JQVECB)
         QSIG(KI,KI1,KI2)=RW(KOQVEC+KI*KCQVEC+KMATIX(KI1,KI2)+JQVEEM)
         XSIG(KI)=RW(KOQVEC+KI*KCQVEC+JQVEEM).GE.0.
         QSMAT(KI,KI1)=RW(KOQVEC+KI*KCQVEC+KI1+JQVEEM)
         QSIGX(KI)=QSQT(QSMAT(KI,0))
         QSIGY(KI)=QSQT(QSMAT(KI,2))
         QSIGZ(KI)=QSQT(QSMAT(KI,5))
         QSIGEE(KI)=RW(KOQVEC+KI*KCQVEC+JQVEEM+9)
         QSIGE(KI)=QSQT(QSIGEE(KI))
         QSIGPP(KI)=(QX(KI)**2*QSMAT(KI,0)+QY(KI)**2*QSMAT(KI,2)+
        & QZ(KI)**2*QSMAT(KI,5)+2.*(QX(KI)*(QY(KI)*QSMAT(KI,1)+
        & QZ(KI)*QSMAT(KI,3))+QY(KI)*QZ(KI)*QSMAT(KI,4)))/QP(KI)**2
         QSIGP(KI)=QSQT(QSIGPP(KI))
         QSIGMM(KI)=QM(KI)*(QE(KI)**2*QSMAT(KI,9)+QX(KI)**2*QSMAT(KI,0)+
        & QY(KI)**2*QSMAT(KI,2)+QZ(KI)**2*QSMAT(KI,5)+2.*(QX(KI)*(QY(KI)
        & QSMAT(KI,1)+QZ(KI)*QSMAT(KI,3))+QY(KI)*QZ(KI)*QSMAT(KI,4)-
        & QE(KI)*(QX(KI)*QSMAT(KI,6)+QY(KI)*QSMAT(KI,7)+
        & QZ(KI)*QSMAT(KI,8))))/AMAX1(QM(KI)**3,1.E-16)
         QSIGM(KI)=QSQT(QSIGMM(KI))
         QMCHIF(KI)=RW(KOQVEC+KI*KCQVEC+JQVECF)
         QPH(KI)=ATG(QY(KI),QX(KI))
         QPT(KI)=SQRT(QX(KI)**2+QY(KI)**2)
         KTN(KI)=IW(KOQVEC+KI*KCQVEC+JQVETN)
         KMC(KI)=KCLARM(IW(KOQVEC+KI*KCQVEC+JQVECL))
         KBMASK(KI,KI1)=IW(KOQVEC+KI*KCQVEC+KI1+JQVEBM-1)
         KCALFL(KI)=IW(KJQDET(KI)+JQDECF)
         KCHGD(KI,KI1)=IW(KOQLIN+KI1+IW(KJQDET(KI)+JQDEFL))
         KCLASS(KI)=KCLACO(IW(KOQVEC+KI*KCQVEC+JQVECL))
         KDAU(KI,KI1)=IW(KOQLIN+KI1+IW(KOQVEC+KI*KCQVEC+JQVEDL))
         KECAL(KI,KI1)=IW(KOQLIN+KI1+IW(KJQDET(KI)+JQDEEL))
         KENDV(KI)=IW(KOQVEC+KI*KCQVEC+JQVEEV)
         KFOLLO(KI)=IW(KOQVEC+KI*KCQVEC+JQVENP)
         KHCAL(KI,KI1)=IW(KOQLIN+KI1+IW(KJQDET(KI)+JQDEHL))
         KLUNDS(KI)=IW(KOQVEC+KI*KCQVEC+JQVEKS)
         KNCHGD(KI)=IW(KJQDET(KI)+JQDENF)
         KNECAL(KI)=IW(KJQDET(KI)+JQDENE)
         KNHCAL(KI)=IW(KJQDET(KI)+JQDENH)
         KNMOTH(KI)=IW(KOQVEC+KI*KCQVEC+JQVENO)
         KMOTH(KI,KI1)=IW(KOQLIN+KI1+IW(KOQVEC+KI*KCQVEC+JQVEOL))
         KMTCH(KI,KI1)=IW(KOQMTL+KI1+IW(KOQVEC+KI*KCQVEC+JQVEML))
         KNDAU(KI)=IW(KOQVEC+KI*KCQVEC+JQVEND)
         KNMTCH(KI)=IW(KOQVEC+KI*KCQVEC+JQVENM)
         KORIV(KI)=IW(KOQVEC+KI*KCQVEC+JQVEOV)
         KSAME(KI)=IW(KOQVEC+KI*KCQVEC+JQVESP)
         KSMTCH(KI,KI1)=IW(KOQMTS+KI1+IW(KOQVEC+KI*KCQVEC+JQVEML))
         KSTABC(KI)=IW(KOQVEC+KI*KCQVEC+JQVESC)
         KTPCOD(KI)=IW(KOQVEC+KI*KCQVEC+JQVEPA)
         XLOCKN(KI,KI1)=IAND(KBMASK(KI,KI1),KLOCK0(KI1,KMC(KI))).NE.0
         XLOCK(KI)=IW(KOQVEC+KI*KCQVEC+JQVELK).NE.0.OR.XLOCKN(KI,1).OR.
        & XLOCKN(KI,2).OR.XLOCKN(KI,3).OR.XLOCKN(KI,4).OR.
        & XLOCKN(KI,5).OR.XLOCKN(KI,6).OR.XLOCKN(KI,7).OR.
        & XLOCKN(KI,8).OR.XLOCKN(KI,9).OR.XLOCKN(KI,10).OR.
        & XLOCKN(KI,11).OR.XLOCKN(KI,12).OR.XLOCKN(KI,13).OR.
        & XLOCKN(KI,14)
         XMC(KI)=KCLARM(IW(KOQVEC+KI*KCQVEC+JQVECL)).NE.1
         QRDFL(KI,KI1)=RW(KOQVEC+KI*KCQVEC+JQVEUS+KI1-1)
         KRDFL(KI,KI1)=IW(KOQVEC+KI*KCQVEC+JQVEUS+KI1-1)
         XCAL(KI)=IW(KJQDET(KI)+JQDECF).NE.0
         XECAL(KI)=IABS(IW(KJQDET(KI)+JQDECF)).EQ.1
         XHCAL(KI)=IABS(IW(KJQDET(KI)+JQDECF)).EQ.2
         QVX(KI)=RW(KOQVRT+KI*KCQVRT+JQVRVX)
         QVY(KI)=RW(KOQVRT+KI*KCQVRT+JQVRVY)
         QVZ(KI)=RW(KOQVRT+KI*KCQVRT+JQVRVZ)
         KVN(KI)=IW(KOQVRT+KI*KCQVRT+JQVRVN)
         KVTYPE(KI)=IW(KOQVRT+KI*KCQVRT+JQVRTY)
         KVINCP(KI)=IW(KOQVRT+KI*KCQVRT+JQVRIP)
         KVNDAU(KI)=IW(KOQVRT+KI*KCQVRT+JQVRND)
         KVYV0V(KI)=IW(KOQVRT+KI*KCQVRT+JQVRAY)
         KVFVER(KI)=IW(KOQVRT+KI*KCQVRT+JQVRAF)
         KVDAU(KI,KI1)=IW(KOQLIN+KI1+IW(KOQVRT+KI*KCQVRT+JQVRDL))
         QVEM(KI,KI1,KI2)=RW(KOQVRT+KI*KCQVRT+KMATIX(KI1,KI2)+JQVREM)
         QVCHIF(KI)=RW(KOQVRT+KI*KCQVRT+JQVRCF)
         QVDIF2(KI1,KI2)=SQRT((QVX(KI1)-QVX(KI2))**2+(QVY(KI1)-
        &QVY(KI2))**2)
         QVDIF3(KI1,KI2)=SQRT((QVX(KI1)-QVX(KI2))**2+(QVY(KI1)-
        &QVY(KI2))**2+ (QVZ(KI1)-QVZ(KI2))**2)
         QMSQ2(KI1,KI2)=(QE(KI1)+QE(KI2))**2-(QX(KI1)+QX(KI2))**2-
        & (QY(KI1)+QY(KI2))**2-(QZ(KI1)+QZ(KI2))**2
         QMSQ3(KI1,KI2,KI3)=(QE(KI1)+QE(KI2)+QE(KI3))**2-
        & (QX(KI1)+QX(KI2)+QX(KI3))**2-(QY(KI1)+QY(KI2)+QY(KI3))**2-
        & (QZ(KI1)+QZ(KI2)+QZ(KI3))**2
         QMSQ4(KI1,KI2,KI3,KI4)=(QE(KI1)+QE(KI2)+QE(KI3)+QE(KI4))**2-
        & (QX(KI1)+QX(KI2)+QX(KI3)+QX(KI4))**2-(QY(KI1)+QY(KI2)+
        & QY(KI3)+QY(KI4))**2-(QZ(KI1)+QZ(KI2)+QZ(KI3)+QZ(KI4))**2
         QM2(KI1,KI2)=QSQT(QMSQ2(KI1,KI2))
         QM3(KI1,KI2,KI3)=QSQT(QMSQ3(KI1,KI2,KI3))
         QM4(KI1,KI2,KI3,KI4)=QSQT(QMSQ4(KI1,KI2,KI3,KI4))
         QDMSQ(KI1,KI2)=(QE(KI1)-QE(KI2))**2-(QX(KI1)-QX(KI2))**2-
        & (QY(KI1)-QY(KI2))**2-(QZ(KI1)-QZ(KI2))**2
         QBETA(KI)=QP(KI)/QE(KI)
         QGAMMA(KI)=1./SQRT((1.-QBETA(KI))*(1.+QBETA(KI)))
         QDOT3(KI1,KI2)=QX(KI1)*QX(KI2)+QY(KI1)*QY(KI2)+QZ(KI1)*QZ(KI2)
         QDOT4(KI1,KI2)=QE(KI1)*QE(KI2)-QDOT3(KI1,KI2)
         QCOSA(KI1,KI2)=QDOT3(KI1,KI2)/(QP(KI1)*QP(KI2))
         QPPAR(KI1,KI2)=QDOT3(KI1,KI2)/QP(KI2)
         QPPER(KI1,KI2)=SQRT((QY(KI1)*QZ(KI2)-QZ(KI1)*QY(KI2))**2+
        & (QZ(KI1)*QX(KI2)-QX(KI1)*QZ(KI2))**2+
        & (QX(KI1)*QY(KI2)-QY(KI1)*QX(KI2))**2)/QP(KI2)
         XSAME(KI1,KI2)=IAND(KBMASK(KI1,1),KBMASK(KI2,1)).NE.0.OR.
        & IAND(KBMASK(KI1,2),KBMASK(KI2,2)).NE.0.OR.
        & IAND(KBMASK(KI1,3),KBMASK(KI2,3)).NE.0.OR.
        & IAND(KBMASK(KI1,4),KBMASK(KI2,4)).NE.0.OR.
        & IAND(KBMASK(KI1,5),KBMASK(KI2,5)).NE.0.OR.
        & IAND(KBMASK(KI1,6),KBMASK(KI2,6)).NE.0.OR.
        & IAND(KBMASK(KI1,7),KBMASK(KI2,7)).NE.0.OR.
        & IAND(KBMASK(KI1,8),KBMASK(KI2,8)).NE.0.OR.
        & IAND(KBMASK(KI1,9),KBMASK(KI2,9)).NE.0.OR.
        & IAND(KBMASK(KI1,10),KBMASK(KI2,10)).NE.0.OR.
        & IAND(KBMASK(KI1,11),KBMASK(KI2,11)).NE.0.OR.
        & IAND(KBMASK(KI1,12),KBMASK(KI2,12)).NE.0.OR.
        & IAND(KBMASK(KI1,13),KBMASK(KI2,13)).NE.0.OR.
        & IAND(KBMASK(KI1,14),KBMASK(KI2,14)).NE.0
         QCMASS(KI)=RW(KOQPAR+KI*KCQPAR+JQPAMA)
         QCCHAR(KI)=RW(KOQPAR+KI*KCQPAR+JQPACH)
         QCLIFE(KI)=RW(KOQPAR+KI*KCQPAR+JQPALT)
         QCWIDT(KI)=RW(KOQPAR+KI*KCQPAR+JQPAWI)
         XCEQOR(KI,KI1)=KTPCOD(KI).EQ.KI1.OR.
        & KTPCOD(KI).EQ.IW(KOQPAR+KI1*KCQPAR+JQPAAN)
         XCEQU(KI,KI1)=KTPCOD(KI).EQ.KI1
      QCFDET
         XFRF(KI)=IW(KJQDET(KI)+JQDEAF).NE.KQZER
         QFRFIR(KI)=RW(IW(KJQDET(KI)+JQDEAF)+JFRFIR)
         QFRFTL(KI)=RW(IW(KJQDET(KI)+JQDEAF)+JFRFTL)
         QFRFP0(KI)=RW(IW(KJQDET(KI)+JQDEAF)+JFRFP0)
         QFRFD0(KI)=RW(IW(KJQDET(KI)+JQDEAF)+JFRFD0)
         QFRFZ0(KI)=RW(IW(KJQDET(KI)+JQDEAF)+JFRFZ0)
         QFRFAL(KI)=RW(IW(KJQDET(KI)+JQDEAF)+JFRFAL)
         QFRFEM(KI,KI1,KI2)=RW(IW(KJQDET(KI)+JQDEAF)+
        & KMATIX(KI1,KI2)+JFRFEM)
         QFRFC2(KI)=RW(IW(KJQDET(KI)+JQDEAF)+JFRFC2)
         KFRFDF(KI)=IW(IW(KJQDET(KI)+JQDEAF)+JFRFDF)
         KFRFNO(KI)=IW(IW(KJQDET(KI)+JQDEAF)+JFRFNO)
         KFRTNV(KI)=IW(IW(KJQDET(KI)+JQDEAL)+JFRTNV)
         KFRTNI(KI)=IW(IW(KJQDET(KI)+JQDEAL)+JFRTNI)
         KFRTNE(KI)=IW(IW(KJQDET(KI)+JQDEAL)+JFRTNE)
         KFRTNT(KI)=IW(IW(KJQDET(KI)+JQDEAL)+JFRTNT)
         KFRTNR(KI)=IW(IW(KJQDET(KI)+JQDEAL)+JFRTNR)
         KFRIBP(KI)=IW(IW(KJQDET(KI)+JQDEFI)+JFRIBP)
         KFRIDZ(KI)=IW(IW(KJQDET(KI)+JQDEFI)+JFRIDZ)
         KFRIBC(KI)=IW(IW(KJQDET(KI)+JQDEFI)+JFRIBC)
         KFRIDC(KI)=IW(IW(KJQDET(KI)+JQDEFI)+JFRIDC)
         QFRIPE(KI)=RW(IW(KJQDET(KI)+JQDEFI)+JFRIPE)
         QFRIPM(KI)=RW(IW(KJQDET(KI)+JQDEFI)+JFRIPM)
         QFRIPI(KI)=RW(IW(KJQDET(KI)+JQDEFI)+JFRIPI)
         QFRIPK(KI)=RW(IW(KJQDET(KI)+JQDEFI)+JFRIPK)
         QFRIPP(KI)=RW(IW(KJQDET(KI)+JQDEFI)+JFRIPP)
         QFRINK(KI)=RW(IW(KJQDET(KI)+JQDEFI)+JFRINK)
         KFRIQF(KI)=IW(IW(KJQDET(KI)+JQDEFI)+JFRIQF)
         XFRIQF(KI)=KFRIQF(KI).EQ.1.OR.KFRIQF(KI).EQ.3
         KNTEX(KI)=IW(KJQDET(KI)+JQDENT)
         XTEX(KI)=IW(KJQDET(KI)+JQDENT).NE.0
         KTEXSI(KI,KI1)=IW(IW(KJQDET(KI)+KI1+JQDENT)+JTEXSI)
         QTEXTM(KI,KI1)=RW(IW(KJQDET(KI)+KI1+JQDENT)+JTEXTM)
         QTEXTL(KI,KI1)=RW(IW(KJQDET(KI)+KI1+JQDENT)+JTEXTL)
         KTEXNS(KI,KI1)=IW(IW(KJQDET(KI)+KI1+JQDENT)+JTEXNS)
         QTEXAD(KI,KI1)=RW(IW(KJQDET(KI)+KI1+JQDENT)+JTEXAD)
         XEID(KI)=IW(KJQDET(KI)+JQDEAE).NE.KQZER
         KEIDIF(KI)=IW(IW(KJQDET(KI)+JQDEAE)+JEIDIF)
         QEIDRI(KI,KI1)=RW(IW(KJQDET(KI)+JQDEAE)+KI1+JEIDR1-1)
         QEIDEC(KI)=RW(IW(KJQDET(KI)+JQDEAE)+JEIDEC)
         KEIDIP(KI)=IW(IW(KJQDET(KI)+JQDEAE)+JEIDIP)
         QEIDEI(KI,KI1)=RW(IW(KJQDET(KI)+JQDEAE)+KI1+JEIDE1-1)
         XHMA(KI)=IW(KJQDET(KI)+JQDEAH).NE.KQZER
         KHMANF(KI)=IW(IW(KJQDET(KI)+JQDEAH)+JHMANF)
         KHMANE(KI)=IW(IW(KJQDET(KI)+JQDEAH)+JHMANE)
         KHMANL(KI)=IW(IW(KJQDET(KI)+JQDEAH)+JHMANL)
         KHMAMH(KI)=IW(IW(KJQDET(KI)+JQDEAH)+JHMAMH)
         KHMAIG(KI)=IW(IW(KJQDET(KI)+JQDEAH)+JHMAIG)
         QHMAED(KI)=RW(IW(KJQDET(KI)+JQDEAH)+JHMAED)
         QHMACS(KI)=RW(IW(KJQDET(KI)+JQDEAH)+JHMACS)
         KHMAND(KI)=IW(IW(KJQDET(KI)+JQDEAH)+JHMAND)
         KHMAIE(KI)=IW(IW(KJQDET(KI)+JQDEAH)+JHMAIE)
         KHMAIT(KI)=IW(IW(KJQDET(KI)+JQDEAH)+JHMAIT)
         KHMAIF(KI)=IW(IW(KJQDET(KI)+JQDEAH)+JHMAIF)
         XMCA(KI)=IW(KJQDET(KI)+JQDEAM).NE.KQZER
         KMCANH(KI,KI1)=IW(IW(KJQDET(KI)+JQDEAM)+KI1+JMCANH-1)
         QMCADH(KI,KI1)=RW(IW(KJQDET(KI)+JQDEAM)+KI1+JMCADH-1)
         QMCADC(KI,KI1)=RW(IW(KJQDET(KI)+JQDEAM)+KI1+JMCADC-1)
         QMCAAM(KI)=RW(IW(KJQDET(KI)+JQDEAM)+JMCAAM)
         QMCAAC(KI)=RW(IW(KJQDET(KI)+JQDEAM)+JMCAAC)
         XMUI(KI)=IW(KJQDET(KI)+JQDEMU).NE.KQZER
         KMUIIF(KI)=IW(IW(KJQDET(KI)+JQDEMU)+JMUIIF)
         QMUISR(KI)=RW(IW(KJQDET(KI)+JQDEMU)+JMUISR)
         QMUIDM(KI)=RW(IW(KJQDET(KI)+JQDEMU)+JMUIDM)
         KMUIST(KI)=IW(IW(KJQDET(KI)+JQDEMU)+JMUIST)
         KMUITN(KI)=IW(IW(KJQDET(KI)+JQDEMU)+JMUITN)
         XPEC(KI)=IW(KJQDET(KI)+JQDEEC).NE.KQZER
         QPECER(KI)=RW(IW(KJQDET(KI)+JQDEEC)+JPECER)
         QPECE1(KI)=RW(IW(KJQDET(KI)+JQDEEC)+JPECE1)
         QPECE2(KI)=RW(IW(KJQDET(KI)+JQDEEC)+JPECE2)
         QPECTH(KI)=RW(IW(KJQDET(KI)+JQDEEC)+JPECTH)
         QPECPH(KI)=RW(IW(KJQDET(KI)+JQDEEC)+JPECPH)
         QPECEC(KI)=RW(IW(KJQDET(KI)+JQDEEC)+JPECEC)
         KPECKD(KI)=IW(IW(KJQDET(KI)+JQDEEC)+JPECKD)
         KPECCC(KI)=IW(IW(KJQDET(KI)+JQDEEC)+JPECCC)
         KPECRB(KI)=IW(IW(KJQDET(KI)+JQDEEC)+JPECRB)
         KPECPC(KI)=IW(IW(KJQDET(KI)+JQDEEC)+JPECPC)
         XPEP(KI)=IW(KJQDET(KI)+JQDEET).NE.KQZER
         QPEPT1(KI)=RW(IW(KJQDET(KI)+JQDEET)+JPEPT1)
         QPEPP1(KI)=RW(IW(KJQDET(KI)+JQDEET)+JPEPP1)
         QPEPT3(KI)=RW(IW(KJQDET(KI)+JQDEET)+JPEPT3)
         QPEPP3(KI)=RW(IW(KJQDET(KI)+JQDEET)+JPEPP3)
         XPHC(KI)=IW(KJQDET(KI)+JQDEHC).NE.KQZER
         QPHCER(KI)=RW(IW(KJQDET(KI)+JQDEHC)+JPHCER)
         QPHCTH(KI)=RW(IW(KJQDET(KI)+JQDEHC)+JPHCTH)
         QPHCPH(KI)=RW(IW(KJQDET(KI)+JQDEHC)+JPHCPH)
         QPHCEC(KI)=RW(IW(KJQDET(KI)+JQDEHC)+JPHCEC)
         KPHCKD(KI)=IW(IW(KJQDET(KI)+JQDEHC)+JPHCKD)
         KPHCCC(KI)=IW(IW(KJQDET(KI)+JQDEHC)+JPHCCC)
         KPHCRB(KI)=IW(IW(KJQDET(KI)+JQDEHC)+JPHCRB)
         KPHCPC(KI)=IW(IW(KJQDET(KI)+JQDEHC)+JPHCPC)
         XEFO(KI)=IW(KJQDET(KI)+JQDEEF).NE.KQZER
         QEFOWE(KI)=RW(IW(KJQDET(KI)+JQDEEF)+JEFOWE)
         KEFOTY(KI)=IW(IW(KJQDET(KI)+JQDEEF)+JEFOTY)
         KEFOLE(KI)=IW(IW(KJQDET(KI)+JQDEEF)+JEFOLE)
         KEFOLT(KI)=IW(IW(KJQDET(KI)+JQDEEF)+JEFOLT)
         KEFOLH(KI)=IW(IW(KJQDET(KI)+JQDEEF)+JEFOLH)
         KEFOLC(KI)=IW(IW(KJQDET(KI)+JQDEEF)+JEFOLC)
         KEFOLJ(KI)=IW(IW(KJQDET(KI)+JQDEEF)+JEFOLJ)
         XPCQ(KI)=IW(KJQDET(KI)+JQDEPC).NE.KQZER
         KPCQNA(KI)=IW(IW(KJQDET(KI)+JQDEPC)+JPCQNA)
         XEGP(KI)=IW(KJQDET(KI)+JQDEEG).NE.KQZER
         QEGPR1(KI)=RW(IW(KJQDET(KI)+JQDEEG)+JEGPR1)
         QEGPR2(KI)=RW(IW(KJQDET(KI)+JQDEEG)+JEGPR2)
         QEGPF4(KI)=RW(IW(KJQDET(KI)+JQDEEG)+JEGPF4)
         QEGPDM(KI)=RW(IW(KJQDET(KI)+JQDEEG)+JEGPDM)
         KEGPST(KI)=IW(IW(KJQDET(KI)+JQDEEG)+JEGPST)
         KEGPQU(KI)=IW(IW(KJQDET(KI)+JQDEEG)+JEGPQU)
         KEGPPE(KI)=IW(IW(KJQDET(KI)+JQDEEG)+JEGPPE)
         XPGP(KI)=IW(KJQDET(KI)+JQDEPG).NE.KQZER.AND.IW(NAPGPC).GT.0
         QPGPR1(KI)=RW(IW(KJQDET(KI)+JQDEPG)+JPGPR1)
         QPGPR2(KI)=RW(IW(KJQDET(KI)+JQDEPG)+JPGPR2)
         QPGPF4(KI)=RW(IW(KJQDET(KI)+JQDEPG)+JPGPF4)
         QPGPDM(KI)=RW(IW(KJQDET(KI)+JQDEPG)+JPGPDM)
         QPGPST(KI)=RW(IW(KJQDET(KI)+JQDEPG)+JPGPST)
         QPGPQ1(KI)=RW(IW(KJQDET(KI)+JQDEPG)+JPGPQ1)
         QPGPQ2(KI)=RW(IW(KJQDET(KI)+JQDEPG)+JPGPQ2)
         QPGPM1(KI)=RW(IW(KJQDET(KI)+JQDEPG)+JPGPM1)
         QPGPM2(KI)=RW(IW(KJQDET(KI)+JQDEPG)+JPGPM2)
         QPGPMA(KI)=RW(IW(KJQDET(KI)+JQDEPG)+JPGPMA)
         QPGPER(KI)=RW(IW(KJQDET(KI)+JQDEPG)+JPGPER)
         QPGPTR(KI)=RW(IW(KJQDET(KI)+JQDEPG)+JPGPTR)
         QPGPPR(KI)=RW(IW(KJQDET(KI)+JQDEPG)+JPGPPR)
         KPGPQU(KI)=IW(IW(KJQDET(KI)+JQDEPG)+JPGPQU)
         KPGPPE(KI)=IW(IW(KJQDET(KI)+JQDEPG)+JPGPPE)
         XPGAC(KI)=IW(KJQDET(KI)+JQDEPG).NE.KQZER.AND.IW(NAPGAC).GT.0
         KPGAST(KI)=IW(IW(KJQDET(KI)+JQDEPG)+JPGAST)
         QPGAEF(KI)=RW(IW(KJQDET(KI)+JQDEPG)+JPGAEF)
         QPGAGC(KI)=RW(IW(KJQDET(KI)+JQDEPG)+JPGAGC)
         QPGAZS(KI)=RW(IW(KJQDET(KI)+JQDEPG)+JPGAZS)
         QPGAPL(KI)=RW(IW(KJQDET(KI)+JQDEPG)+JPGAPL)
         QPGAPH(KI)=RW(IW(KJQDET(KI)+JQDEPG)+JPGAPH)
         KPGAPN(KI)=IW(IW(KJQDET(KI)+JQDEPG)+JPGAPN)
         KPGAFA(KI)=IW(IW(KJQDET(KI)+JQDEPG)+JPGAFA)
         KPGAPE(KI)=IW(IW(KJQDET(KI)+JQDEPG)+JPGAPE)
         XYV0(KI)=KVYV0V(KENDV(KI)).NE.0
         KYV0K1(KI)=IW(KVYV0V(KENDV(KI))+JYV0K1)
         KYV0K2(KI)=IW(KVYV0V(KENDV(KI))+JYV0K2)
         QYV0VX(KI)=RW(KVYV0V(KENDV(KI))+JYV0VX)
         QYV0VY(KI)=RW(KVYV0V(KENDV(KI))+JYV0VY)
         QYV0VZ(KI)=RW(KVYV0V(KENDV(KI))+JYV0VZ)
         QYV0X1(KI)=RW(KVYV0V(KENDV(KI))+JYV0X1)
         QYV0X2(KI)=RW(KVYV0V(KENDV(KI))+JYV0X2)
         QYV0C2(KI)=RW(KVYV0V(KENDV(KI))+JYV0C2)
         KYV0IC(KI)=IW(KVYV0V(KENDV(KI))+JYV0IC)
         QYV0DM(KI)=RW(KVYV0V(KENDV(KI))+JYV0DM)
         QYV0S1(KI)=RW(KVYV0V(KENDV(KI))+JYV0S1)
         QYV0S2(KI)=RW(KVYV0V(KENDV(KI))+JYV0S2)
         XLEPTG(KI)=IW(KJQDET(KI)+JQDEPD).NE.KQZER
         KLEPPA(KI)=IW(IW(KJQDET(KI)+JQDEPD)+JPDLPA)
         KLEPJT(KI)=IW(IW(KJQDET(KI)+JQDEPD)+JPDLJT)+KLFJET-1
         QLEPPI(KI)=RW(IW(KJQDET(KI)+JQDEPD)+JPDLPI)
         QLEPPE(KI)=RW(IW(KJQDET(KI)+JQDEPD)+JPDLPE)
         KLEPVP(KI)=IW(IW(KJQDET(KI)+JQDEPD)+JPDLVP)
         XLEPTH(KI)=IW(KJQDET(KI)+JQDEPM).NE.KQZER
         KLEPFL(KI)=IW(IW(KJQDET(KI)+JQDEPM)+JPMLFL)
         KLEPPO(KI)=IW(IW(KJQDET(KI)+JQDEPM)+JPMLPO)
         KLEPCH(KI)=IW(IW(KJQDET(KI)+JQDEPM)+JPMLCH)
         KLEPSP(KI)=IW(IW(KJQDET(KI)+JQDEPM)+JPMLSP)
         KLEPLE(KI)=IW(IW(KJQDET(KI)+JQDEPM)+JPMLLE)
         KLEPME(KI)=IW(IW(KJQDET(KI)+JQDEPM)+JPMLME)
         KLEPKT(KI)=IW(IW(KJQDET(KI)+JQDEPM)+JPMLKT)
   
         bg = log10(p/rmass(k))
         ict = findindexct(ct)
         inbg = findindexbg(bg)
   
    look if it's an electron first.
    that case use specific parameterization
   
         if (goodwindow(rmass(k),qcmass(3))) then
            correlation = correE(ict)
         else
            correlation = correH(inbg,ict)
         endif
         findcorr= correlation
         return
         end
         integer function findindexct(ct)
   Auxiliary to findcorr - qddx
    Boccali  March 1999
         implicit none
         real ct
         integer temp
         temp=0
   
         if (abs(ct).lt..75) then
            temp=1
         else
            temp=2
         endif
   
         findindexct = temp
   
         return
         end
         integer function findindexbg(bg)
   Auxiliary to findcorr - qddx
    Boccali  March 1999
         implicit none
         real  bg
         integer temp
         temp=0
         if (bg.lt.0.) then
            temp=1
         elseif(bg.ge.0.and.bg.lt..5) then
            temp=2
         else
            temp=3
         endif
   
         findindexbg = temp
   
         return
         end
         logical function goodwindow(mass1,mass2)
   Auxiliary to findcorr - qddx
    Boccali  March 1999
         implicit none
         real mass1, mass2
         goodwindow=.false.
         if ((mass1*1.1).gt.mass2.and.(mass1*.9).lt.mass2)
        &     goodwindow=.true.
         return
         end
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
              QDDX                                                                 
                   |----  SIGN                                External             
                   |----  SQRT                                External             
                   |----  ABS                                 External             
                   |----  NINT                                External             
                   |----  KMATIX                              External             
                   |----  ATG                                 External             
                   |----  KCLARM                              External             
                   |----  IAND                                External             
                   |----  KLOCK0                              External             
                   |----  IABS                                External             
                   |----  QPADX                                                    
                   |----  QDEDX                                                    
                   |----  QP                                  External             
                   |----  QCT                                 External             
                   |----  FINDCORR                                                 
                   |----  RINV                                External             
   
 
3 QDEDX
         SUBROUTINE QDEDX(ITK,N,RMASS,QH,RI,NS,TL,RIEXP,SIGMA,IER)
  ------------------------------------------------------------------------------
    CKEY DEDX /USER
  ------------------------------------------------------------------------------
   De/dx analysis in alpha
    ALPHA interface to the ALEPHLIB routine TIDHYP
    Author:  R. Johnson   27-07-89
    Modified :  G. Graefe    25-04-94 some changes for NanoDst input
       Input:   ITK      /I       ALPHA track number
                N        /I       Number of hypothesis to try
                RMASS(n) /R       Mass hypotheses
                QH(n)     /R       Charge hypotheses (sign doesn't matter
       Output:  RI       /R       Measured ionization (1.O=minion, Q=1)
                NS       /R       Number of useful wire samples on track
                TL       /T       Useful length of the track (cm)
                RIEXP(n) /R       Expected ionization for the given
                                  mass hypothesis (1.0=minion, Q=1)
                SIGMA(n) /R       Sigma of dE/dx measurement error,
                                  including the momentum error.
                                  Note that one can calculate a
                                  chi-squared with 1 d.o.f. as:
                                  chi2 = ((RI-RIEXP)/SIGMA)**2
                IER      /I       Error return= 0 for success
                                  1= can't find track bank or not
                                     a reconstructed charged track
                                  2= can't find dE/dx bank
                                  3= track has no dE/dx information
                                  4= can't find calibration banks
                                     TC1X, TC2X, and/or TC3X
                                  5= cannot find RUNH or EVEH bank
                                     from which to get the run number
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   MDSTWR                                                                          
   QFNDV0                                                                          
   QSELEP                                                                          
   QDDX                                                                            
        |---- QDEDX                                                                
                   |----  SIGN                                External             
                   |----  SQRT                                External             
                   |----  ABS                                 External             
                   |----  NINT                                External             
                   |----  KMATIX                              External             
                   |----  ATG                                 External             
                   |----  KCLARM                              External             
                   |----  IAND                                External             
                   |----  KLOCK0                              External             
                   |----  IABS                                External             
                   |----  NADDX                                                    
                   |----  KCHT                                                     
                   |----  TIDHYP                              External             
   
 
3 QDEDXK
         SUBROUTINE QDEDXK(IRUN,P,Q,RMASS,DX,NSMP,DEDX,EDEDX,SIGMA)
  ------------------------------------------------------------------------------
    CKEY DEDX MONTE /INTERNAL
  ------------------------------------------------------------------------------
   Fast, simple de/dx simulation of a single track.
    R. Johnson   5-02-90
    Input:    IRUN       /I       Run number for calibration constants
              P          /R       Track momentum
              Q          /R       Particle charge
              RMASS      /R       Particle mass
              DX         /R       Average sample length
              NSMP       /I       Number of dE/dx samples
    Output:   DEDX       /R       Simulated dE/dx
              EDEDX      /R       Expected mean dE/dx
              SIGMA      /R       dE/dx resolution
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   NADDXM                                                                          
   NMTAIL                                                                          
   QDEDXM                                                                          
   QMTAIL                                                                          
        |---- QDEDXK                                                               
                   |----  NDANR                               External             
                   |----  JUNIDB                              External             
                   |----  QMTERM                                                   
                   |----  MDARD                               External             
                   |----  NDROP                               External             
                   |----  QKBLOK                                                   
                   |----  FLOAT                               External             
                   |----  SQRT                                External             
                   |----  RANNOR                              External             
   
 
3 QDEDXM
         SUBROUTINE QDEDXM(ITK,N,RMASS,QH,RI,NS,TL,RIEXP,SIGMA,IER)
  ------------------------------------------------------------------------------
    CKEY DEDX MONTE /USER
  ------------------------------------------------------------------------------
   Analyse de/dx for monte carlo events by faking the ionization
    with a gaussian random number.  If called for real data, the
    result will be the same as if QDEDX were called.
    R. Johnson   10-5-90
    modified D. Casper  05-04-1993 for 1992 MCarlos
    modified G. Graefe  26-04-1994 for NanoDst input
       Input:   ITK      /I       ALPHA track number
                N        /I       Number of hypothesis to try
                RMASS(n) /R       Mass hypotheses
                QH(n)    /R       Charge hypotheses (sign doesn't matter)
       Output:  RI       /R       Measured ionization (1.O=minion, Q=1)
                NS       /I       Number of useful wire samples on track
                TL       /R       Useful length of the track (cm)
                RIEXP(n) /R       Expected ionization for the given
                                  mass hypothesis (1.0=minion, Q=1)
                SIGMA(n) /R       Sigma of dE/dx measurement error,
                                  including the momentum error.
                                  Note that one can calculate a
                                  chi-squared with 1 d.o.f. as:
                                  chi2 = ((RI-RIEXP)/SIGMA)**2
                IER      /I       Error return= 0 for success
                                  1= can't find track bank or not
                                     a reconstructed charged track
                                  2= can't find dE/dx bank
                                  3= track has no dE/dx information
                                  4= can't find calibration banks
                                     TC1X, TC2X, and/or TC3X
                                  5= cannot find RUNH or EVEH bank
                                     from which to get the run number
                                  6= No MC truth
                                  7= No RHAH bank
                                  8= 'JULIA' not found in RHAH
     Input to the entry point QMTAIL.  This entry may be called to
     -----                    ------   set the parameter TAIL, which
                                       otherwise defaults to 999. It
                                       only need be called once.
                TAIL     /R       If the dE/dx from TPCSIM is more than
                                  TAIL sigmas from the "true" mean dE/dx
                                  then the TPCSIM dE/dx will be kept.
                                  This is to allow one to retain some
                                  of the simulation of tails, which
                                  usually arise from track overlap.
                                  If TAIL is set less than 3.0, then
                                  the value 3.0 is used. Set to a large
                                  value if you don't want this feature.
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   QSELEP                                                                          
        |---- QDEDXM                                                               
                   |----  SIGN                                External             
                   |----  SQRT                                External             
                   |----  ABS                                 External             
                   |----  NINT                                External             
                   |----  KMATIX                              External             
                   |----  ATG                                 External             
                   |----  KCLARM                              External             
                   |----  IAND                                External             
                   |----  KLOCK0                              External             
                   |----  IABS                                External             
                   |----  NADDXM                                                   
                   |----  KCHT                                                     
                   |----  TIDHYP                              External             
                   |----  CHAINT                              External             
                   |----  KBESTM                                                   
                   |----  QPMASS                                                   
                   |----  FLOAT                               External             
                   |----  INT                                 External             
                   |----  RDMIN                               External             
                   |----  RANNOR                              External             
                   |----  QDEDXK                                                   
                   |----  QKBLOK                                                   
                   |----  NMTAIL                                                   
   
 
3 QDMMCL
         SUBROUTINE QDMMCL( NJETS, CNAM, ICLASS, YCUT, EVIS )
  ------------------------------------------------------------------------------
    CKEY ALPHA JETS /USER
  ------------------------------------------------------------------------------
     Author   : C. Bowdery     17-NOV-1993
     Based upon QJMMCL by P. Perez       28-MAR-1989
     Description
     ===========
   Call qgjmmc, the improved, generalised jade algorithm jet finder
      with the arguments set to 'E' scheme and DURHAM algorithm.
    Input   : CNAM            the name to be used for the jet 'particles'
              ICLASS          KRECO or KMONTE
              YCUT            YCUT value ( (M/EVIS)**2 )
              EVIS            visible energy for normalisation
                              (if EVIS=0., it is computed from the
                               input particle energies)
    Output  : NJETS           number of jets found or error code if -ve
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
              QDMMCL                                                               
                   |----  QGJMMC                                                   
   
 
3 QEFRTR
         SUBROUTINE QEFRTR(JEFOL,ITRACK)
  ------------------------------------------------------------------------------
    CKEY FILL EFLOW /INTERNAL
  ------------------------------------------------------------------------------
   Search for track correponding to electron
      Author   :- M.N. Minard    02-Apr-1992
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   QFEFLO                                                                          
        |---- QEFRTR                                                               
                   |----  SIGN                                External             
                   |----  SQRT                                External             
                   |----  ABS                                 External             
                   |----  NINT                                External             
                   |----  KMATIX                              External             
                   |----  ATG                                 External             
                   |----  KCLARM                              External             
                   |----  IAND                                External             
                   |----  KLOCK0                              External             
                   |----  IABS                                External             
   
 
3 QELEP1
         SUBROUTINE QELEP1(ELEP,IFLAG)
  ------------------------------------------------------------------------------
    CKEY ENERGY/USER
  ------------------------------------------------------------------------------
   Get the run-averaged exact energy for 1993 -> 1995 lep 1 runs
    Simple interface to ALEPHLIB routine GETLE1   J.Boucrot 26.08.97
    arguments :
    ELEP  = LEP c.m.s. energy, in Gev
    IFLAG = 2 if ELEP found from average run energy
          = 3 in all other cases (then ELEP taken from bank LFIL)
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
              QELEP1                                                               
                   |----  GETLE1                              External             
   
 
3 QELEP2
         SUBROUTINE QELEP2(ELEP,IFLAG)
  ------------------------------------------------------------------------------
    CKEY ENERGY/USER
  ------------------------------------------------------------------------------
   Get the "instantaneous" exact lep energy for lep 2 runs
    Simple interface to ALEPHLIB routine GETLE2   J.Boucrot  26.3.97
    arguments :
    ELEP  = LEP c.m.s. energy, in Gev
    IFLAG = 1 if ELEP found from official time-slice LEP information
          = 2 if ELEP found from average run energy
          = 3 in all other cases (then ELEP taken from bank LFIL)
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
              QELEP2                                                               
                   |----  GETLE2                              External             
   
 
3 QEWSUM
         SUBROUTINE QEWSUM(eweven,ewodd,ier)
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   
   
    pweijj
         INTEGER JPWEMN,JPWEPD,JPWESS,JPWETI,LPWEIA
         PARAMETER(JPWEMN=1,JPWEPD=2,JPWESS=47,JPWETI=63,LPWEIA=63)
   
   
    dwesjj
         INTEGER JDWEMN,JDWESO,JDWESE,JDWEEF,LDWESA
         PARAMETER(JDWEMN=1,JDWESO=2,JDWESE=3,JDWEEF=4,LDWESA=5)
   
   
   -------------------- /QCDE/ --- COMMONs, DIMENSIONs, etc. ------------
   
    of QCDESH ----------------------- Description in QDATA ---------
         PARAMETER (KCQDET=34, KCQFPA=8, KCQPAR=10, KCQVEC=73, KCQVRT=30,
        & KHE=1, KHMU=2, KHPI=3, KHK=4, KHP=5, KHPHOT=1, KHNHAD=2,
        & KMONTE=-2, KRECO=-1, KLOCKM=14, KSOVT=1, KSCHT=2, KSIST=3,
        & KSAST=4, KSEHT=5, KSV0T=6, KSDCT=7, KSEFT=8, KSNET=9, KSGAT=10,
        & KSJET=11, KSMCT=12, KSREV=13,
        & KSMCV=14, KUNDEF=-12344321, QQPI=3.141593, QQE=2.718282,
        & QQ2PI=QQPI*2., QQPIH=QQPI/2., QQRADP=180./QQPI, QQC=2.997925E10,
        & QQH=6.582173E-25, QQHC=QQH*QQC, QQIRP=.00029979)
         CHARACTER CQDATE*8, CQDWRK*80, CQFHIS*80, CQFOUT*80, CQFWRK*80,
        & CQHTIT*80, CQSEC*3, CQTIME*8, CQUNPK*30, CQVERS*6, CQRLST*800,
        & CQELST*800
         COMMON /QCDEC/ CQDATE, CQDWRK, CQFHIS, CQFOUT, CQFWRK, CQHTIT,
        & CQSEC(14), CQTIME, CQUNPK, CQVERS, CQRLST, CQELST
         COMMON /QCDE/ QELEP, QMFLD ,QMFLDC, QTIME, QTIMEI, QTIMEL,
        & QTIMES, QTIMET, QDHEEC, QDHEEL, QDHEPF, QDHETH, QDHEPH, QDHEEF,
        & QDHEET, QDHET1, QDHEP1, QDHET2, QDHEP2, QDHEE1, QDHEE2, QDHEE3,
        & QKEVRN, QKEVWT, QVXNOM, QVYNOM, QVZNOM, QVXNSG, QVYNSG, QVZNSG,
        & QINLUM, QRINLN, QRINLU, QDBOFS, QEECWI(36), QVXBOM, QVYBOM,
        & QSILUM, QRSLLU, QRSLBK, QRSLEW , QVTXBP(3), QVTEBP(3), QVTSBP(3)
         COMMON /QCDE/  KFOVT, KLOVT, KNOVT, KFCHT, KLCHT, KNCHT, KFIST,
        & KLIST, KNIST, KFAST, KLAST, KNAST, KFEHT, KLEHT, KNEHT, KFV0T,
        & KLV0T, KNV0T, KFDCT, KLDCT, KNDCT, KFEFT, KLEFT, KNEFT, KFNET,
        & KLNET, KNNET, KFGAT, KLGAT, KNGAT, KFJET, KLJET, KNJET, KFMCT,
        & KLMCT, KNMCT, KFREV, KLREV, KNREV, KFMCV, KLMCV, KNMCV, KLUST,
        & KLUSV, KFFRT, KLFRT, KFFRV, KLFRV, KNRET, KNCOT, KFFRD,
        & KLFJET,KLLJET,KLNJET
         COMMON /QCDE/ KBIT(32), KCLACO(KCQFPA), KCLAFR(KCQFPA), KCLARM
        & (KCQFPA), KDEBUG, KEVT, KEXP, KFFILL, KFEOUT, KJOPTN(2,2),
        & KLEOUT, KLROUT, KLOCK0(KLOCKM,2), KLOCK1(KLOCKM,2), KLOCK2(
        & KLOCKM,2), KMATIX(6,6), KMQFPA, KNEFIL, KNEOUT, KNEVT, KNPAST,
        & KNQDET, KNQFPA, KNQLIN, KNQMTX, KNQPAR, KNQPST, KNREIN, KNREOU,
        & KOQDET, KOQFPA, KOQLIN, KOQMTL, KOQMTS, KOQPAR, KOQPBT, KOQPLI,
        & KOQTRA, KOQVEC, KOQVRT, KQPAR, KQVEC, KQVRT, KQWRK, KQZER, KRUN,
        & KSTATU, KTDROP, KUCARD, KUCONS, KUHIST, KUINPU, KUOUTP, KUPRNT,
        & KUPTER, KDEBU1, KDEBU2, KNWRLM, KEFOPT, KUEDIN, KUEDOU, KURTOX,
        & KUCAR2, KNHDRN, KNBHAB, KSBHAB, KRSLLQ, KRSLNB
         COMMON /QCDE/ INDATA
         COMMON /QCDE/ KRINNE, KRINNF, KRINDC, KRINDQ, KRINNZ, KRINNB,
        & KRINBM, KRINFR, KRINLR, KRINLF
         COMMON /QCDE/ KEVERT, KEVEDA, KEVETI, KEVEMI(4), KEVETY, KEVEES,
        & KDHEFP, KDHENP, KDHENM, KKEVNT, KKEVNV, KKEVID, KDHENX, KDHENV,
        & KDHENJ, KREVDS, KXTET1, KXTET2, KXTEL2, KXTCGC, KXTCLL, KXTCBN,
        & KXTCCL, KXTCHV, KXTCEN, KCLASW, KERBOM, KBPSTA
         DIMENSION KLOCUS(3,14)
         EQUIVALENCE (KLOCUS(1,1),KFOVT), (KFOVT,KFRET), (KLIST,KLRET),
        & (KFIST,KFCOT), (KLAST,KLCOT)
         COMMON /QCDE/ XCOPYJ, XFLIAC, XHISTO, XLREV(2), XLREV2(2), XMCEV,
        & XMINI, XSYNTX, XWREVT, XWRRUN, XFILMC, XFILCH, XFILV0, XFILCO,
        & XFILEF, XFILPC, XFILGA, XFILJE,
        & XPRHIS, XFILL, XVITC, XVTPC, XVECAL, XVLCAL, XVTPCD,
        & XVSATR, XVHCAL, XHVTRG, XSREC, XWMINI, XIOKLU, XIOKSI, XFRF2,
        & XNSEQ, XVDOK, XFRF0, XFMUID, XFILEM, XWNANO, XROKSI, XGETBP,
        & XJTHRU
         LOGICAL XCOPYJ, XFLIAC, XHISTO, XLREV, XLREV2, XMCEV, XMINI,
        & XSYNTX, XWREVT, XWRRUN, XFILMC, XFILCH, XFILV0, XFILCO, XFILEF,
        & XFILPC, XPRHIS, XFILL, XVITC, XVTPC, XVECAL, XVLCAL, XVTPCD,
        & XVSATR, XVHCAL, XHVTRG, XSREC, XWMINI, XIOKLU, XFRF2, XFILJE,
        & XNSEQ, XFILGA, XVDOK, XFRF0, XFMUID, XFILEM, XWNANO, XIOKSI,
        & XROKSI, XGETBP, XJTHRU
   
   -------------------- /NANCOM/ --- NanoDst steering -------------------
   Xnano   .true. if input is a nanodst (in nano or epio format, depending
                      XNANOR)
   
         LOGICAL XNANO
         COMMON /NANCOM/XNANO
   
   
    bcs
         INTEGER LMHLEN, LMHCOL, LMHROW
         PARAMETER (LMHLEN=2, LMHCOL=1, LMHROW=2)
         COMMON /BCS/   IW(1000)
         INTEGER IW
         REAL RW(1000)
         EQUIVALENCE (RW(1),IW(1))
   
   
   ------------------ /QCNAMI/ --- name indices -------------------------
         COMMON /QCNAMI/ NAAFID,NAAJOB,NAASEV,NABCNT,NABHIT,NABOMB,
        1 NABOME,NABOMP,NABOMR,NABPTR,NADCAL,NADCRL,NADECO,NADEID,NADENF,
        2 NADEVT,NADEWI,NADFMC,NADFOT,NADGAM,NADHCO,NADHEA,NADHRL,NADJET,
        3 NADMID,NADMJT,NADMUO,NADNEU,NADPOB,NADRES,NADTBP,NADTMC,NADTRA,
        4 NADVER,NADVMC,NAECRQ,NAECTE,NAEGID,NAEGPC,NAEIDT,NAEJET,NAERRF,
        5 NAETDI,NAETKC,NAEVEH,NAEWHE,NAFICL,NAFKIN,NAFPOI,NAFPOL,NAFRFT,
        6 NAFRID,NAFRTL,NAFSTR,NAFTCL,NAFTCM,NAFTOC,NAFTTM,NAFVCL,NAFVER,
        7 NAFZFR,NAHCCV,NAHCTE,NAHINF,NAHMAD,NAHPDI,NAHROA,NAHSDA,NAHTUB,
        8 NAIASL,NAIPJT,NAIRJT,NAITCO,NAITMA,NAIXTR,NAIZBD,NAJBER,NAJEST,
        9 NAJSUM,NAKEVH,NAKINE,NAKJOB,NAKLIN,NAKPOL,NAKRUN,NALIDT,NALOLE,
        A NALUPA,NAMCAD,NAMHIT,NAMTHR,NAMUDG,NAMUEX,NAOSTS,NAPART,NAPASL,
        B NAPCHY,NAPCOB,NAPCOI,NAPCPA,NAPCQA,NAPCRL,NAPECO,NAPEHY,NAPEID,
        C NAPEMH,NAPEPT,NAPEST,NAPEWI,NAPFER,NAPFHR,NAPFRF,NAPFRT,NAPHCO,
        D NAPHER,NAPHHY,NAPHMH,NAPHST,NAPIDI,NAPITM,NAPLID,NAPLPD,NAPLSD,
        E NAPMSK,NAPNEU,NAPPDS,NAPPOB,NAPPRL,NAPRTM,NAPSCO,NAPSPO,NAPSTR,
        F NAPT2X,NAPTBC,NAPTCO,NAPTEX,NAPTMA,NAPTML,NAPTNC,NAPTST,NAPVCO,
        G NAPYER,NAPYFR,NAPYNE,NAQDET,NAQFPA,NAQLIN,NAQMTL,NAQMTS,NAQPAR,
        H NAQPBT,NAQPLI,NAQTRA,NAQVEC,NAQVRT,NAQWRK,NAQZER,NAREVH,NARHAH,
        I NARTLO,NARTLS,NARUNH,NARUNR,NASFTR,NATEXS,NATGMA,NATMTL,NATPCO,
        J NAVCOM,NAVCPL,NAVDCO,NAVDHT,NAVDXY,NAVDZT,NAVERT,NAVFHL,NAVFLG,
        K NAVFPH,NAVHLS,NAVPLH,NAX1AD,NAX1SC,NAX1TI,NAX2DF,NAX3EC,NAX3EW,
        L NAX3HC,NAX3IT,NAX3L2,NAX3LU,NAX3TM,NAX3TO,NAX3TP,NAX3X3,NAXTBN,
        M NAXTBP,NAXTCN,NAXTEB,NAXTOP,NAXTRB,NAYV0V,NAZPFR,NAEFOL,NAMUID,
        N NAPGID,NAPGPC,NAPGAC,NAPMSC,NAPTHR,NANBIP,NAPDLT,NAPMLT,NAPLJT
   
   
   ------------------ /QQQQJJ/ --- HAC parameters for ALPHA banks -------
         PARAMETER (JQVEQX= 1,JQVEQY= 2,JQVEQZ= 3,JQVEQE= 4,JQVEQM= 5,
        & JQVEQP= 6,JQVECH= 7,JQVETN= 8,JQVESC= 9,JQVEKS=10,JQVECL=11,
        & JQVEPA=12,JQVEQD=13,JQVENP=14,JQVESP=15,JQVEOV=16,JQVEEV=17,
        & JQVEND=18,JQVEDL=19,JQVENO=20,JQVEOL=21,JQVENM=22,JQVEML=23,
        & JQVEBM=24,JQVELK=38,JQVEDB=39,JQVEZB=40,JQVESD=41,JQVESZ=42,
        & JQVECB=43,JQVEEM=44,JQVECF=54,JQVEEW=55,JQVEUS=56)
         PARAMETER ( JQVRVX=1,JQVRVY=2,JQVRVZ=3,JQVRVN=4,JQVRTY=5,
        1   JQVRIP=6,JQVRND=7,JQVRDL=8,JQVRAY=9,JQVRAF=10,JQVREM=11,
        2   JQVRCF=17,JQVRET=18)
         PARAMETER ( JQDEAF= 1,JQDEAL= 2,JQDENT= 3,JQDEAT= 4,JQDELT= 8,
        &  JQDEAE= 9,JQDEAH=10,JQDEAM=11,JQDECF=12,JQDEEC=13,JQDEHC=14,
        &  JQDEET=15,JQDEFI=16,JQDENF=17,JQDEFL=18,JQDENE=19,JQDEEL=20,
        &  JQDENH=21,JQDEHL=22,JQDELH=23,JQDEEF=24,JQDEPC=25,JQDEEG=26,
        &  JQDEMU=27,JQDEDX=28,JQDEPG=29,JQDEPD=30,JQDEPM=31)
         PARAMETER ( JQPAGN=1, JQPANA=2, JQPACO=5, JQPAMA=6, JQPACH=7,
        & JQPALT=8,JQPAWI=9,JQPAAN=10)
   
   
         EXTERNAL CQPART, CQTPN, XCEQAN, XLUMOK, XPEQAN, XPEQOR, XPEQU,
        & XVDEOK, LLUMOK, SLUMOK
         CHARACTER * 12 CQPART, CQTPN
         LOGICAL XCAL, XCEQAN, XCEQOR, XCEQU, XECAL, XEID, XFRF, XHCAL,
        & XHMA, XLOCK, XLOCKN, XMC, XLUMOK, XMCA, XPEO, XPHO, XPEQAN,
        & XPEQOR, XPEQU, XSAME, XSIG, XTEX, XPEC, XPEP, XPHC, XYV0,
        & XFRIQF, XEFO, XPCQ, XEGP, XMUI, XVDEOK, XPGP, LLUMOK, SLUMOK,
        & XPGAC, XLEPTG, XLEPTH
   
    alcons
    define universal constants
         REAL PI, TWOPI, PIBY2, PIBY3, PIBY4, PIBY6, PIBY8, PIBY12
         REAL RADEG, DEGRA
         REAL CLGHT, ALDEDX
         PARAMETER (PI=3.141592653589)
         PARAMETER (RADEG=180./PI, DEGRA=PI/180.)
         PARAMETER (TWOPI = 2.*PI , PIBY2 = PI/2., PIBY4 = PI/4.)
         PARAMETER (PIBY6 = PI/6. , PIBY8 = PI/8.)
         PARAMETER (PIBY12= PI/12., PIBY3 = PI/3.)
         PARAMETER (CLGHT = 29.9792458, ALDEDX = 0.000307)
   
         ALDEDX  = constant used in the computation of DEDX in GeV
         CLGHT   = speed of light in cm/nsec
   
   
   
    efoljj
         INTEGER JEFOPX,JEFOPY,JEFOPZ,JEFOEW,JEFOWE,JEFOTY,JEFOLE,JEFOLT,
        +          JEFOLH,JEFOLC,JEFOLJ,LEFOLA
         PARAMETER(JEFOPX=1,JEFOPY=2,JEFOPZ=3,JEFOEW=4,JEFOWE=5,JEFOTY=6,
        +          JEFOLE=7,JEFOLT=8,JEFOLH=9,JEFOLC=10,JEFOLJ=11,
        +          LEFOLA=11)
   
   
    egpcjj
         INTEGER JEGPPX,JEGPPY,JEGPPZ,JEGPR1,JEGPR2,JEGPF4,JEGPDM,JEGPST,
        +          JEGPQU,JEGPPE,LEGPCA
         PARAMETER(JEGPPX=1,JEGPPY=2,JEGPPZ=3,JEGPR1=4,JEGPR2=5,JEGPF4=6,
        +          JEGPDM=7,JEGPST=8,JEGPQU=9,JEGPPE=10,LEGPCA=10)
   
   
    eidtjj
         INTEGER JEIDIF,JEIDR1,JEIDR2,JEIDR3,JEIDR4,JEIDR5,JEIDR6,JEIDR7,
        +          JEIDEC,JEIDIP,JEIDE1,JEIDE2,JEIDE3,JEIDFR,JEIDPE,LEIDTA
         PARAMETER(JEIDIF=1,JEIDR1=2,JEIDR2=3,JEIDR3=4,JEIDR4=5,JEIDR5=6,
        +          JEIDR6=7,JEIDR7=8,JEIDEC=9,JEIDIP=10,JEIDE1=11,
        +          JEIDE2=12,JEIDE3=13,JEIDFR=14,JEIDPE=15,LEIDTA=15)
   
   
    frftjj
         INTEGER JFRFIR,JFRFTL,JFRFP0,JFRFD0,JFRFZ0,JFRFAL,JFRFEM,JFRFC2,
        +          JFRFDF,JFRFNO,LFRFTA
         PARAMETER(JFRFIR=1,JFRFTL=2,JFRFP0=3,JFRFD0=4,JFRFZ0=5,JFRFAL=6,
        +          JFRFEM=7,JFRFC2=28,JFRFDF=29,JFRFNO=30,LFRFTA=30)
   
   
    fridjj
         INTEGER JFRIBP,JFRIDZ,JFRIBC,JFRIDC,JFRIPE,JFRIPM,JFRIPI,JFRIPK,
        +          JFRIPP,JFRINK,JFRIQF,LFRIDA
         PARAMETER(JFRIBP=1,JFRIDZ=2,JFRIBC=3,JFRIDC=4,JFRIPE=5,JFRIPM=6,
        +          JFRIPI=7,JFRIPK=8,JFRIPP=9,JFRINK=10,JFRIQF=11,
        +          LFRIDA=11)
   
   
    frtljj
         INTEGER JFRTIV,JFRTNV,JFRTII,JFRTNI,JFRTNE,JFRTIT,JFRTNT,JFRTNR,
        +          LFRTLA
         PARAMETER(JFRTIV=1,JFRTNV=2,JFRTII=3,JFRTNI=4,JFRTNE=5,JFRTIT=6,
        +          JFRTNT=7,JFRTNR=8,LFRTLA=8)
   
   
    hmadjj
         INTEGER JHMANF,JHMANE,JHMANL,JHMAMH,JHMAIG,JHMAED,JHMACS,JHMAND,
        +          JHMAIE,JHMAIT,JHMAIF,JHMATN,LHMADA
         PARAMETER(JHMANF=1,JHMANE=2,JHMANL=3,JHMAMH=4,JHMAIG=5,JHMAED=6,
        +          JHMACS=7,JHMAND=8,JHMAIE=9,JHMAIT=10,JHMAIF=11,
        +          JHMATN=12,LHMADA=12)
   
   
    mcadjj
         INTEGER JMCANH,JMCADH,JMCADC,JMCAAM,JMCAAC,JMCATN,LMCADA
         PARAMETER(JMCANH=1,JMCADH=3,JMCADC=5,JMCAAM=7,JMCAAC=8,JMCATN=9,
        +          LMCADA=9)
   
   
    muidjj
         INTEGER JMUIIF,JMUISR,JMUIDM,JMUIST,JMUITN,LMUIDA
         PARAMETER(JMUIIF=1,JMUISR=2,JMUIDM=3,JMUIST=4,JMUITN=5,LMUIDA=5)
   
   
    pcqajj
         INTEGER JPCQNA,JPCQPX,JPCQPY,JPCQPZ,JPCQEN,LPCQAA
         PARAMETER(JPCQNA=1,JPCQPX=2,JPCQPY=3,JPCQPZ=4,JPCQEN=5,LPCQAA=5)
   
   
    pdltjj
         INTEGER JPDLPA,JPDLJT,JPDLPI,JPDLPE,JPDLVP,JPDLFR,LPDLTA
         PARAMETER(JPDLPA=1,JPDLJT=2,JPDLPI=3,JPDLPE=4,JPDLVP=5,JPDLFR=6,
        +          LPDLTA=6)
   
   
    pecojj
         INTEGER JPECER,JPECE1,JPECE2,JPECTH,JPECPH,JPECEC,JPECKD,JPECCC,
        +          JPECRB,JPECPC,LPECOA
         PARAMETER(JPECER=1,JPECE1=2,JPECE2=3,JPECTH=4,JPECPH=5,JPECEC=6,
        +          JPECKD=7,JPECCC=8,JPECRB=9,JPECPC=10,LPECOA=10)
   
   
    peptjj
         INTEGER JPEPT1,JPEPP1,JPEPT3,JPEPP3,LPEPTA
         PARAMETER(JPEPT1=1,JPEPP1=2,JPEPT3=3,JPEPP3=4,LPEPTA=4)
   
   
    pgacjj
         INTEGER JPGAEC,JPGATC,JPGAPC,JPGAR1,JPGAR2,JPGAF4,JPGADM,JPGAST,
        +          JPGAQU,JPGAQ1,JPGAQ2,JPGAM1,JPGAM2,JPGAMA,JPGAER,JPGATR,
        +          JPGAPR,JPGAEF,JPGAGC,JPGAZS,JPGAPL,JPGAPH,JPGAPN,JPGAFA,
        +          JPGAPE,LPGACA
         PARAMETER(JPGAEC=1,JPGATC=2,JPGAPC=3,JPGAR1=4,JPGAR2=5,JPGAF4=6,
        +          JPGADM=7,JPGAST=8,JPGAQU=9,JPGAQ1=10,JPGAQ2=11,
        +          JPGAM1=12,JPGAM2=13,JPGAMA=14,JPGAER=15,JPGATR=16,
        +          JPGAPR=17,JPGAEF=18,JPGAGC=19,JPGAZS=20,JPGAPL=21,
        +          JPGAPH=22,JPGAPN=23,JPGAFA=24,JPGAPE=25,LPGACA=25)
   
   
    pgpcjj
         INTEGER JPGPEC,JPGPTC,JPGPPC,JPGPR1,JPGPR2,JPGPF4,JPGPDM,JPGPST,
        +          JPGPQU,JPGPQ1,JPGPQ2,JPGPM1,JPGPM2,JPGPMA,JPGPER,JPGPTR,
        +          JPGPPR,JPGPPE,LPGPCA
         PARAMETER(JPGPEC=1,JPGPTC=2,JPGPPC=3,JPGPR1=4,JPGPR2=5,JPGPF4=6,
        +          JPGPDM=7,JPGPST=8,JPGPQU=9,JPGPQ1=10,JPGPQ2=11,
        +          JPGPM1=12,JPGPM2=13,JPGPMA=14,JPGPER=15,JPGPTR=16,
        +          JPGPPR=17,JPGPPE=18,LPGPCA=18)
   
   
    phcojj
         INTEGER JPHCER,JPHCTH,JPHCPH,JPHCEC,JPHCKD,JPHCCC,JPHCRB,JPHCNF,
        +          JPHCPC,LPHCOA
         PARAMETER(JPHCER=1,JPHCTH=2,JPHCPH=3,JPHCEC=4,JPHCKD=5,JPHCCC=6,
        +          JPHCRB=7,JPHCNF=8,JPHCPC=9,LPHCOA=9)
   
   
    pmltjj
         INTEGER JPMLFL,JPMLPO,JPMLCH,JPMLSP,JPMLLE,JPMLME,JPMLKT,JPMLFR,
        +          LPMLTA
         PARAMETER(JPMLFL=1,JPMLPO=2,JPMLCH=3,JPMLSP=4,JPMLLE=5,JPMLME=6,
        +          JPMLKT=7,JPMLFR=8,LPMLTA=8)
   
   
    texsjj
         INTEGER JTEXSI,JTEXTM,JTEXTL,JTEXNS,JTEXAD,JTEXTN,JTEXSF,LTEXSA
         PARAMETER(JTEXSI=1,JTEXTM=2,JTEXTL=3,JTEXNS=4,JTEXAD=5,JTEXTN=6,
        +          JTEXSF=7,LTEXSA=7)
   
   
    yv0vjj
         INTEGER JYV0K1,JYV0K2,JYV0VX,JYV0VY,JYV0VZ,JYV0VM,JYV0PX,JYV0PY,
        +          JYV0PZ,JYV0PM,JYV0X1,JYV0X2,JYV0XM,JYV0C2,JYV0IC,JYV0P1,
        +          JYV0P2,JYV0EP,JYV0DM,JYV0S1,JYV0S2,LYV0VA
         PARAMETER(JYV0K1=1,JYV0K2=2,JYV0VX=3,JYV0VY=4,JYV0VZ=5,JYV0VM=6,
        +          JYV0PX=12,JYV0PY=13,JYV0PZ=14,JYV0PM=15,JYV0X1=21,
        +          JYV0X2=22,JYV0XM=23,JYV0C2=26,JYV0IC=27,JYV0P1=28,
        +          JYV0P2=31,JYV0EP=34,JYV0DM=55,JYV0S1=56,JYV0S2=57,
        +          LYV0VA=57)
   
   
         PARAMETER ( NMOD=36 , FACMI = 1000.)
         REAL*4   EWEVEN(NMOD),EWODD(NMOD)
   
   -------------------- /QMACRO/ --- statement functions ----------------
   
    bmacro
       set of intrinsic functions to handle BOS banks
   - # of words/row in bank with index ID
         LCOLS(ID) = IW(ID+1)
   - # of rows in bank with index ID
         LROWS(ID) = IW(ID+2)
   - index of next row in the bank with index ID
         KNEXT(ID) = ID + LMHLEN + IW(ID+1)*IW(ID+2)
   - index of row # NRBOS in the bank with index ID
         KROW(ID,NRBOS) = ID + LMHLEN + IW(ID+1)*(NRBOS-1)
   - # of free words in the bank with index ID
         LFRWRD(ID) = ID + IW(ID) - KNEXT(ID)
   - # of free rows in the bank with index ID
         LFRROW(ID) = LFRWRD(ID) / LCOLS(ID)
   - Lth integer element of the NRBOSth row of the bank with index ID
         ITABL(ID,NRBOS,L) = IW(ID+LMHLEN+(NRBOS-1)*IW(ID+1)+L)
   - Lth real element of the NRBOSth row of the bank with index ID
         RTABL(ID,NRBOS,L) = RW(ID+LMHLEN+(NRBOS-1)*IW(ID+1)+L)
   
   -------------------- /QCFUNC/ --- statement functions for ALPHA banks
         KJQDET(KI)=IW(KOQVEC+KI*KCQVEC+JQVEQD)
         QSQT(QF)=SIGN(SQRT(ABS(QF)),QF)
         QP(KI)=RW(KOQVEC+KI*KCQVEC+JQVEQP)
         QX(KI)=RW(KOQVEC+KI*KCQVEC+JQVEQX)
         QY(KI)=RW(KOQVEC+KI*KCQVEC+JQVEQY)
         QZ(KI)=RW(KOQVEC+KI*KCQVEC+JQVEQZ)
         QE(KI)=RW(KOQVEC+KI*KCQVEC+JQVEQE)
         QM(KI)=RW(KOQVEC+KI*KCQVEC+JQVEQM)
         QCH(KI)=RW(KOQVEC+KI*KCQVEC+JQVECH)
         KCH(KI)=NINT (QCH(KI))
         QCT(KI)=QZ(KI)/QP(KI)
         QDB(KI)=RW(KOQVEC+KI*KCQVEC+JQVEDB)
         QZB(KI)=RW(KOQVEC+KI*KCQVEC+JQVEZB)
         QDBS2(KI)=RW(KOQVEC+KI*KCQVEC+JQVESD)
         QZBS2(KI)=RW(KOQVEC+KI*KCQVEC+JQVESZ)
         QBC2(KI)=RW(KOQVEC+KI*KCQVEC+JQVECB)
         QSIG(KI,KI1,KI2)=RW(KOQVEC+KI*KCQVEC+KMATIX(KI1,KI2)+JQVEEM)
         XSIG(KI)=RW(KOQVEC+KI*KCQVEC+JQVEEM).GE.0.
         QSMAT(KI,KI1)=RW(KOQVEC+KI*KCQVEC+KI1+JQVEEM)
         QSIGX(KI)=QSQT(QSMAT(KI,0))
         QSIGY(KI)=QSQT(QSMAT(KI,2))
         QSIGZ(KI)=QSQT(QSMAT(KI,5))
         QSIGEE(KI)=RW(KOQVEC+KI*KCQVEC+JQVEEM+9)
         QSIGE(KI)=QSQT(QSIGEE(KI))
         QSIGPP(KI)=(QX(KI)**2*QSMAT(KI,0)+QY(KI)**2*QSMAT(KI,2)+
        & QZ(KI)**2*QSMAT(KI,5)+2.*(QX(KI)*(QY(KI)*QSMAT(KI,1)+
        & QZ(KI)*QSMAT(KI,3))+QY(KI)*QZ(KI)*QSMAT(KI,4)))/QP(KI)**2
         QSIGP(KI)=QSQT(QSIGPP(KI))
         QSIGMM(KI)=QM(KI)*(QE(KI)**2*QSMAT(KI,9)+QX(KI)**2*QSMAT(KI,0)+
        & QY(KI)**2*QSMAT(KI,2)+QZ(KI)**2*QSMAT(KI,5)+2.*(QX(KI)*(QY(KI)
        & QSMAT(KI,1)+QZ(KI)*QSMAT(KI,3))+QY(KI)*QZ(KI)*QSMAT(KI,4)-
        & QE(KI)*(QX(KI)*QSMAT(KI,6)+QY(KI)*QSMAT(KI,7)+
        & QZ(KI)*QSMAT(KI,8))))/AMAX1(QM(KI)**3,1.E-16)
         QSIGM(KI)=QSQT(QSIGMM(KI))
         QMCHIF(KI)=RW(KOQVEC+KI*KCQVEC+JQVECF)
         QPH(KI)=ATG(QY(KI),QX(KI))
         QPT(KI)=SQRT(QX(KI)**2+QY(KI)**2)
         KTN(KI)=IW(KOQVEC+KI*KCQVEC+JQVETN)
         KMC(KI)=KCLARM(IW(KOQVEC+KI*KCQVEC+JQVECL))
         KBMASK(KI,KI1)=IW(KOQVEC+KI*KCQVEC+KI1+JQVEBM-1)
         KCALFL(KI)=IW(KJQDET(KI)+JQDECF)
         KCHGD(KI,KI1)=IW(KOQLIN+KI1+IW(KJQDET(KI)+JQDEFL))
         KCLASS(KI)=KCLACO(IW(KOQVEC+KI*KCQVEC+JQVECL))
         KDAU(KI,KI1)=IW(KOQLIN+KI1+IW(KOQVEC+KI*KCQVEC+JQVEDL))
         KECAL(KI,KI1)=IW(KOQLIN+KI1+IW(KJQDET(KI)+JQDEEL))
         KENDV(KI)=IW(KOQVEC+KI*KCQVEC+JQVEEV)
         KFOLLO(KI)=IW(KOQVEC+KI*KCQVEC+JQVENP)
         KHCAL(KI,KI1)=IW(KOQLIN+KI1+IW(KJQDET(KI)+JQDEHL))
         KLUNDS(KI)=IW(KOQVEC+KI*KCQVEC+JQVEKS)
         KNCHGD(KI)=IW(KJQDET(KI)+JQDENF)
         KNECAL(KI)=IW(KJQDET(KI)+JQDENE)
         KNHCAL(KI)=IW(KJQDET(KI)+JQDENH)
         KNMOTH(KI)=IW(KOQVEC+KI*KCQVEC+JQVENO)
         KMOTH(KI,KI1)=IW(KOQLIN+KI1+IW(KOQVEC+KI*KCQVEC+JQVEOL))
         KMTCH(KI,KI1)=IW(KOQMTL+KI1+IW(KOQVEC+KI*KCQVEC+JQVEML))
         KNDAU(KI)=IW(KOQVEC+KI*KCQVEC+JQVEND)
         KNMTCH(KI)=IW(KOQVEC+KI*KCQVEC+JQVENM)
         KORIV(KI)=IW(KOQVEC+KI*KCQVEC+JQVEOV)
         KSAME(KI)=IW(KOQVEC+KI*KCQVEC+JQVESP)
         KSMTCH(KI,KI1)=IW(KOQMTS+KI1+IW(KOQVEC+KI*KCQVEC+JQVEML))
         KSTABC(KI)=IW(KOQVEC+KI*KCQVEC+JQVESC)
         KTPCOD(KI)=IW(KOQVEC+KI*KCQVEC+JQVEPA)
         XLOCKN(KI,KI1)=IAND(KBMASK(KI,KI1),KLOCK0(KI1,KMC(KI))).NE.0
         XLOCK(KI)=IW(KOQVEC+KI*KCQVEC+JQVELK).NE.0.OR.XLOCKN(KI,1).OR.
        & XLOCKN(KI,2).OR.XLOCKN(KI,3).OR.XLOCKN(KI,4).OR.
        & XLOCKN(KI,5).OR.XLOCKN(KI,6).OR.XLOCKN(KI,7).OR.
        & XLOCKN(KI,8).OR.XLOCKN(KI,9).OR.XLOCKN(KI,10).OR.
        & XLOCKN(KI,11).OR.XLOCKN(KI,12).OR.XLOCKN(KI,13).OR.
        & XLOCKN(KI,14)
         XMC(KI)=KCLARM(IW(KOQVEC+KI*KCQVEC+JQVECL)).NE.1
         QRDFL(KI,KI1)=RW(KOQVEC+KI*KCQVEC+JQVEUS+KI1-1)
         KRDFL(KI,KI1)=IW(KOQVEC+KI*KCQVEC+JQVEUS+KI1-1)
         XCAL(KI)=IW(KJQDET(KI)+JQDECF).NE.0
         XECAL(KI)=IABS(IW(KJQDET(KI)+JQDECF)).EQ.1
         XHCAL(KI)=IABS(IW(KJQDET(KI)+JQDECF)).EQ.2
         QVX(KI)=RW(KOQVRT+KI*KCQVRT+JQVRVX)
         QVY(KI)=RW(KOQVRT+KI*KCQVRT+JQVRVY)
         QVZ(KI)=RW(KOQVRT+KI*KCQVRT+JQVRVZ)
         KVN(KI)=IW(KOQVRT+KI*KCQVRT+JQVRVN)
         KVTYPE(KI)=IW(KOQVRT+KI*KCQVRT+JQVRTY)
         KVINCP(KI)=IW(KOQVRT+KI*KCQVRT+JQVRIP)
         KVNDAU(KI)=IW(KOQVRT+KI*KCQVRT+JQVRND)
         KVYV0V(KI)=IW(KOQVRT+KI*KCQVRT+JQVRAY)
         KVFVER(KI)=IW(KOQVRT+KI*KCQVRT+JQVRAF)
         KVDAU(KI,KI1)=IW(KOQLIN+KI1+IW(KOQVRT+KI*KCQVRT+JQVRDL))
         QVEM(KI,KI1,KI2)=RW(KOQVRT+KI*KCQVRT+KMATIX(KI1,KI2)+JQVREM)
         QVCHIF(KI)=RW(KOQVRT+KI*KCQVRT+JQVRCF)
         QVDIF2(KI1,KI2)=SQRT((QVX(KI1)-QVX(KI2))**2+(QVY(KI1)-
        &QVY(KI2))**2)
         QVDIF3(KI1,KI2)=SQRT((QVX(KI1)-QVX(KI2))**2+(QVY(KI1)-
        &QVY(KI2))**2+ (QVZ(KI1)-QVZ(KI2))**2)
         QMSQ2(KI1,KI2)=(QE(KI1)+QE(KI2))**2-(QX(KI1)+QX(KI2))**2-
        & (QY(KI1)+QY(KI2))**2-(QZ(KI1)+QZ(KI2))**2
         QMSQ3(KI1,KI2,KI3)=(QE(KI1)+QE(KI2)+QE(KI3))**2-
        & (QX(KI1)+QX(KI2)+QX(KI3))**2-(QY(KI1)+QY(KI2)+QY(KI3))**2-
        & (QZ(KI1)+QZ(KI2)+QZ(KI3))**2
         QMSQ4(KI1,KI2,KI3,KI4)=(QE(KI1)+QE(KI2)+QE(KI3)+QE(KI4))**2-
        & (QX(KI1)+QX(KI2)+QX(KI3)+QX(KI4))**2-(QY(KI1)+QY(KI2)+
        & QY(KI3)+QY(KI4))**2-(QZ(KI1)+QZ(KI2)+QZ(KI3)+QZ(KI4))**2
         QM2(KI1,KI2)=QSQT(QMSQ2(KI1,KI2))
         QM3(KI1,KI2,KI3)=QSQT(QMSQ3(KI1,KI2,KI3))
         QM4(KI1,KI2,KI3,KI4)=QSQT(QMSQ4(KI1,KI2,KI3,KI4))
         QDMSQ(KI1,KI2)=(QE(KI1)-QE(KI2))**2-(QX(KI1)-QX(KI2))**2-
        & (QY(KI1)-QY(KI2))**2-(QZ(KI1)-QZ(KI2))**2
         QBETA(KI)=QP(KI)/QE(KI)
         QGAMMA(KI)=1./SQRT((1.-QBETA(KI))*(1.+QBETA(KI)))
         QDOT3(KI1,KI2)=QX(KI1)*QX(KI2)+QY(KI1)*QY(KI2)+QZ(KI1)*QZ(KI2)
         QDOT4(KI1,KI2)=QE(KI1)*QE(KI2)-QDOT3(KI1,KI2)
         QCOSA(KI1,KI2)=QDOT3(KI1,KI2)/(QP(KI1)*QP(KI2))
         QPPAR(KI1,KI2)=QDOT3(KI1,KI2)/QP(KI2)
         QPPER(KI1,KI2)=SQRT((QY(KI1)*QZ(KI2)-QZ(KI1)*QY(KI2))**2+
        & (QZ(KI1)*QX(KI2)-QX(KI1)*QZ(KI2))**2+
        & (QX(KI1)*QY(KI2)-QY(KI1)*QX(KI2))**2)/QP(KI2)
         XSAME(KI1,KI2)=IAND(KBMASK(KI1,1),KBMASK(KI2,1)).NE.0.OR.
        & IAND(KBMASK(KI1,2),KBMASK(KI2,2)).NE.0.OR.
        & IAND(KBMASK(KI1,3),KBMASK(KI2,3)).NE.0.OR.
        & IAND(KBMASK(KI1,4),KBMASK(KI2,4)).NE.0.OR.
        & IAND(KBMASK(KI1,5),KBMASK(KI2,5)).NE.0.OR.
        & IAND(KBMASK(KI1,6),KBMASK(KI2,6)).NE.0.OR.
        & IAND(KBMASK(KI1,7),KBMASK(KI2,7)).NE.0.OR.
        & IAND(KBMASK(KI1,8),KBMASK(KI2,8)).NE.0.OR.
        & IAND(KBMASK(KI1,9),KBMASK(KI2,9)).NE.0.OR.
        & IAND(KBMASK(KI1,10),KBMASK(KI2,10)).NE.0.OR.
        & IAND(KBMASK(KI1,11),KBMASK(KI2,11)).NE.0.OR.
        & IAND(KBMASK(KI1,12),KBMASK(KI2,12)).NE.0.OR.
        & IAND(KBMASK(KI1,13),KBMASK(KI2,13)).NE.0.OR.
        & IAND(KBMASK(KI1,14),KBMASK(KI2,14)).NE.0
         QCMASS(KI)=RW(KOQPAR+KI*KCQPAR+JQPAMA)
         QCCHAR(KI)=RW(KOQPAR+KI*KCQPAR+JQPACH)
         QCLIFE(KI)=RW(KOQPAR+KI*KCQPAR+JQPALT)
         QCWIDT(KI)=RW(KOQPAR+KI*KCQPAR+JQPAWI)
         XCEQOR(KI,KI1)=KTPCOD(KI).EQ.KI1.OR.
        & KTPCOD(KI).EQ.IW(KOQPAR+KI1*KCQPAR+JQPAAN)
         XCEQU(KI,KI1)=KTPCOD(KI).EQ.KI1
      QCFDET
         XFRF(KI)=IW(KJQDET(KI)+JQDEAF).NE.KQZER
         QFRFIR(KI)=RW(IW(KJQDET(KI)+JQDEAF)+JFRFIR)
         QFRFTL(KI)=RW(IW(KJQDET(KI)+JQDEAF)+JFRFTL)
         QFRFP0(KI)=RW(IW(KJQDET(KI)+JQDEAF)+JFRFP0)
         QFRFD0(KI)=RW(IW(KJQDET(KI)+JQDEAF)+JFRFD0)
         QFRFZ0(KI)=RW(IW(KJQDET(KI)+JQDEAF)+JFRFZ0)
         QFRFAL(KI)=RW(IW(KJQDET(KI)+JQDEAF)+JFRFAL)
         QFRFEM(KI,KI1,KI2)=RW(IW(KJQDET(KI)+JQDEAF)+
        & KMATIX(KI1,KI2)+JFRFEM)
         QFRFC2(KI)=RW(IW(KJQDET(KI)+JQDEAF)+JFRFC2)
         KFRFDF(KI)=IW(IW(KJQDET(KI)+JQDEAF)+JFRFDF)
         KFRFNO(KI)=IW(IW(KJQDET(KI)+JQDEAF)+JFRFNO)
         KFRTNV(KI)=IW(IW(KJQDET(KI)+JQDEAL)+JFRTNV)
         KFRTNI(KI)=IW(IW(KJQDET(KI)+JQDEAL)+JFRTNI)
         KFRTNE(KI)=IW(IW(KJQDET(KI)+JQDEAL)+JFRTNE)
         KFRTNT(KI)=IW(IW(KJQDET(KI)+JQDEAL)+JFRTNT)
         KFRTNR(KI)=IW(IW(KJQDET(KI)+JQDEAL)+JFRTNR)
         KFRIBP(KI)=IW(IW(KJQDET(KI)+JQDEFI)+JFRIBP)
         KFRIDZ(KI)=IW(IW(KJQDET(KI)+JQDEFI)+JFRIDZ)
         KFRIBC(KI)=IW(IW(KJQDET(KI)+JQDEFI)+JFRIBC)
         KFRIDC(KI)=IW(IW(KJQDET(KI)+JQDEFI)+JFRIDC)
         QFRIPE(KI)=RW(IW(KJQDET(KI)+JQDEFI)+JFRIPE)
         QFRIPM(KI)=RW(IW(KJQDET(KI)+JQDEFI)+JFRIPM)
         QFRIPI(KI)=RW(IW(KJQDET(KI)+JQDEFI)+JFRIPI)
         QFRIPK(KI)=RW(IW(KJQDET(KI)+JQDEFI)+JFRIPK)
         QFRIPP(KI)=RW(IW(KJQDET(KI)+JQDEFI)+JFRIPP)
         QFRINK(KI)=RW(IW(KJQDET(KI)+JQDEFI)+JFRINK)
         KFRIQF(KI)=IW(IW(KJQDET(KI)+JQDEFI)+JFRIQF)
         XFRIQF(KI)=KFRIQF(KI).EQ.1.OR.KFRIQF(KI).EQ.3
         KNTEX(KI)=IW(KJQDET(KI)+JQDENT)
         XTEX(KI)=IW(KJQDET(KI)+JQDENT).NE.0
         KTEXSI(KI,KI1)=IW(IW(KJQDET(KI)+KI1+JQDENT)+JTEXSI)
         QTEXTM(KI,KI1)=RW(IW(KJQDET(KI)+KI1+JQDENT)+JTEXTM)
         QTEXTL(KI,KI1)=RW(IW(KJQDET(KI)+KI1+JQDENT)+JTEXTL)
         KTEXNS(KI,KI1)=IW(IW(KJQDET(KI)+KI1+JQDENT)+JTEXNS)
         QTEXAD(KI,KI1)=RW(IW(KJQDET(KI)+KI1+JQDENT)+JTEXAD)
         XEID(KI)=IW(KJQDET(KI)+JQDEAE).NE.KQZER
         KEIDIF(KI)=IW(IW(KJQDET(KI)+JQDEAE)+JEIDIF)
         QEIDRI(KI,KI1)=RW(IW(KJQDET(KI)+JQDEAE)+KI1+JEIDR1-1)
         QEIDEC(KI)=RW(IW(KJQDET(KI)+JQDEAE)+JEIDEC)
         KEIDIP(KI)=IW(IW(KJQDET(KI)+JQDEAE)+JEIDIP)
         QEIDEI(KI,KI1)=RW(IW(KJQDET(KI)+JQDEAE)+KI1+JEIDE1-1)
         XHMA(KI)=IW(KJQDET(KI)+JQDEAH).NE.KQZER
         KHMANF(KI)=IW(IW(KJQDET(KI)+JQDEAH)+JHMANF)
         KHMANE(KI)=IW(IW(KJQDET(KI)+JQDEAH)+JHMANE)
         KHMANL(KI)=IW(IW(KJQDET(KI)+JQDEAH)+JHMANL)
         KHMAMH(KI)=IW(IW(KJQDET(KI)+JQDEAH)+JHMAMH)
         KHMAIG(KI)=IW(IW(KJQDET(KI)+JQDEAH)+JHMAIG)
         QHMAED(KI)=RW(IW(KJQDET(KI)+JQDEAH)+JHMAED)
         QHMACS(KI)=RW(IW(KJQDET(KI)+JQDEAH)+JHMACS)
         KHMAND(KI)=IW(IW(KJQDET(KI)+JQDEAH)+JHMAND)
         KHMAIE(KI)=IW(IW(KJQDET(KI)+JQDEAH)+JHMAIE)
         KHMAIT(KI)=IW(IW(KJQDET(KI)+JQDEAH)+JHMAIT)
         KHMAIF(KI)=IW(IW(KJQDET(KI)+JQDEAH)+JHMAIF)
         XMCA(KI)=IW(KJQDET(KI)+JQDEAM).NE.KQZER
         KMCANH(KI,KI1)=IW(IW(KJQDET(KI)+JQDEAM)+KI1+JMCANH-1)
         QMCADH(KI,KI1)=RW(IW(KJQDET(KI)+JQDEAM)+KI1+JMCADH-1)
         QMCADC(KI,KI1)=RW(IW(KJQDET(KI)+JQDEAM)+KI1+JMCADC-1)
         QMCAAM(KI)=RW(IW(KJQDET(KI)+JQDEAM)+JMCAAM)
         QMCAAC(KI)=RW(IW(KJQDET(KI)+JQDEAM)+JMCAAC)
         XMUI(KI)=IW(KJQDET(KI)+JQDEMU).NE.KQZER
         KMUIIF(KI)=IW(IW(KJQDET(KI)+JQDEMU)+JMUIIF)
         QMUISR(KI)=RW(IW(KJQDET(KI)+JQDEMU)+JMUISR)
         QMUIDM(KI)=RW(IW(KJQDET(KI)+JQDEMU)+JMUIDM)
         KMUIST(KI)=IW(IW(KJQDET(KI)+JQDEMU)+JMUIST)
         KMUITN(KI)=IW(IW(KJQDET(KI)+JQDEMU)+JMUITN)
         XPEC(KI)=IW(KJQDET(KI)+JQDEEC).NE.KQZER
         QPECER(KI)=RW(IW(KJQDET(KI)+JQDEEC)+JPECER)
         QPECE1(KI)=RW(IW(KJQDET(KI)+JQDEEC)+JPECE1)
         QPECE2(KI)=RW(IW(KJQDET(KI)+JQDEEC)+JPECE2)
         QPECTH(KI)=RW(IW(KJQDET(KI)+JQDEEC)+JPECTH)
         QPECPH(KI)=RW(IW(KJQDET(KI)+JQDEEC)+JPECPH)
         QPECEC(KI)=RW(IW(KJQDET(KI)+JQDEEC)+JPECEC)
         KPECKD(KI)=IW(IW(KJQDET(KI)+JQDEEC)+JPECKD)
         KPECCC(KI)=IW(IW(KJQDET(KI)+JQDEEC)+JPECCC)
         KPECRB(KI)=IW(IW(KJQDET(KI)+JQDEEC)+JPECRB)
         KPECPC(KI)=IW(IW(KJQDET(KI)+JQDEEC)+JPECPC)
         XPEP(KI)=IW(KJQDET(KI)+JQDEET).NE.KQZER
         QPEPT1(KI)=RW(IW(KJQDET(KI)+JQDEET)+JPEPT1)
         QPEPP1(KI)=RW(IW(KJQDET(KI)+JQDEET)+JPEPP1)
         QPEPT3(KI)=RW(IW(KJQDET(KI)+JQDEET)+JPEPT3)
         QPEPP3(KI)=RW(IW(KJQDET(KI)+JQDEET)+JPEPP3)
         XPHC(KI)=IW(KJQDET(KI)+JQDEHC).NE.KQZER
         QPHCER(KI)=RW(IW(KJQDET(KI)+JQDEHC)+JPHCER)
         QPHCTH(KI)=RW(IW(KJQDET(KI)+JQDEHC)+JPHCTH)
         QPHCPH(KI)=RW(IW(KJQDET(KI)+JQDEHC)+JPHCPH)
         QPHCEC(KI)=RW(IW(KJQDET(KI)+JQDEHC)+JPHCEC)
         KPHCKD(KI)=IW(IW(KJQDET(KI)+JQDEHC)+JPHCKD)
         KPHCCC(KI)=IW(IW(KJQDET(KI)+JQDEHC)+JPHCCC)
         KPHCRB(KI)=IW(IW(KJQDET(KI)+JQDEHC)+JPHCRB)
         KPHCPC(KI)=IW(IW(KJQDET(KI)+JQDEHC)+JPHCPC)
         XEFO(KI)=IW(KJQDET(KI)+JQDEEF).NE.KQZER
         QEFOWE(KI)=RW(IW(KJQDET(KI)+JQDEEF)+JEFOWE)
         KEFOTY(KI)=IW(IW(KJQDET(KI)+JQDEEF)+JEFOTY)
         KEFOLE(KI)=IW(IW(KJQDET(KI)+JQDEEF)+JEFOLE)
         KEFOLT(KI)=IW(IW(KJQDET(KI)+JQDEEF)+JEFOLT)
         KEFOLH(KI)=IW(IW(KJQDET(KI)+JQDEEF)+JEFOLH)
         KEFOLC(KI)=IW(IW(KJQDET(KI)+JQDEEF)+JEFOLC)
         KEFOLJ(KI)=IW(IW(KJQDET(KI)+JQDEEF)+JEFOLJ)
         XPCQ(KI)=IW(KJQDET(KI)+JQDEPC).NE.KQZER
         KPCQNA(KI)=IW(IW(KJQDET(KI)+JQDEPC)+JPCQNA)
         XEGP(KI)=IW(KJQDET(KI)+JQDEEG).NE.KQZER
         QEGPR1(KI)=RW(IW(KJQDET(KI)+JQDEEG)+JEGPR1)
         QEGPR2(KI)=RW(IW(KJQDET(KI)+JQDEEG)+JEGPR2)
         QEGPF4(KI)=RW(IW(KJQDET(KI)+JQDEEG)+JEGPF4)
         QEGPDM(KI)=RW(IW(KJQDET(KI)+JQDEEG)+JEGPDM)
         KEGPST(KI)=IW(IW(KJQDET(KI)+JQDEEG)+JEGPST)
         KEGPQU(KI)=IW(IW(KJQDET(KI)+JQDEEG)+JEGPQU)
         KEGPPE(KI)=IW(IW(KJQDET(KI)+JQDEEG)+JEGPPE)
         XPGP(KI)=IW(KJQDET(KI)+JQDEPG).NE.KQZER.AND.IW(NAPGPC).GT.0
         QPGPR1(KI)=RW(IW(KJQDET(KI)+JQDEPG)+JPGPR1)
         QPGPR2(KI)=RW(IW(KJQDET(KI)+JQDEPG)+JPGPR2)
         QPGPF4(KI)=RW(IW(KJQDET(KI)+JQDEPG)+JPGPF4)
         QPGPDM(KI)=RW(IW(KJQDET(KI)+JQDEPG)+JPGPDM)
         QPGPST(KI)=RW(IW(KJQDET(KI)+JQDEPG)+JPGPST)
         QPGPQ1(KI)=RW(IW(KJQDET(KI)+JQDEPG)+JPGPQ1)
         QPGPQ2(KI)=RW(IW(KJQDET(KI)+JQDEPG)+JPGPQ2)
         QPGPM1(KI)=RW(IW(KJQDET(KI)+JQDEPG)+JPGPM1)
         QPGPM2(KI)=RW(IW(KJQDET(KI)+JQDEPG)+JPGPM2)
         QPGPMA(KI)=RW(IW(KJQDET(KI)+JQDEPG)+JPGPMA)
         QPGPER(KI)=RW(IW(KJQDET(KI)+JQDEPG)+JPGPER)
         QPGPTR(KI)=RW(IW(KJQDET(KI)+JQDEPG)+JPGPTR)
         QPGPPR(KI)=RW(IW(KJQDET(KI)+JQDEPG)+JPGPPR)
         KPGPQU(KI)=IW(IW(KJQDET(KI)+JQDEPG)+JPGPQU)
         KPGPPE(KI)=IW(IW(KJQDET(KI)+JQDEPG)+JPGPPE)
         XPGAC(KI)=IW(KJQDET(KI)+JQDEPG).NE.KQZER.AND.IW(NAPGAC).GT.0
         KPGAST(KI)=IW(IW(KJQDET(KI)+JQDEPG)+JPGAST)
         QPGAEF(KI)=RW(IW(KJQDET(KI)+JQDEPG)+JPGAEF)
         QPGAGC(KI)=RW(IW(KJQDET(KI)+JQDEPG)+JPGAGC)
         QPGAZS(KI)=RW(IW(KJQDET(KI)+JQDEPG)+JPGAZS)
         QPGAPL(KI)=RW(IW(KJQDET(KI)+JQDEPG)+JPGAPL)
         QPGAPH(KI)=RW(IW(KJQDET(KI)+JQDEPG)+JPGAPH)
         KPGAPN(KI)=IW(IW(KJQDET(KI)+JQDEPG)+JPGAPN)
         KPGAFA(KI)=IW(IW(KJQDET(KI)+JQDEPG)+JPGAFA)
         KPGAPE(KI)=IW(IW(KJQDET(KI)+JQDEPG)+JPGAPE)
         XYV0(KI)=KVYV0V(KENDV(KI)).NE.0
         KYV0K1(KI)=IW(KVYV0V(KENDV(KI))+JYV0K1)
         KYV0K2(KI)=IW(KVYV0V(KENDV(KI))+JYV0K2)
         QYV0VX(KI)=RW(KVYV0V(KENDV(KI))+JYV0VX)
         QYV0VY(KI)=RW(KVYV0V(KENDV(KI))+JYV0VY)
         QYV0VZ(KI)=RW(KVYV0V(KENDV(KI))+JYV0VZ)
         QYV0X1(KI)=RW(KVYV0V(KENDV(KI))+JYV0X1)
         QYV0X2(KI)=RW(KVYV0V(KENDV(KI))+JYV0X2)
         QYV0C2(KI)=RW(KVYV0V(KENDV(KI))+JYV0C2)
         KYV0IC(KI)=IW(KVYV0V(KENDV(KI))+JYV0IC)
         QYV0DM(KI)=RW(KVYV0V(KENDV(KI))+JYV0DM)
         QYV0S1(KI)=RW(KVYV0V(KENDV(KI))+JYV0S1)
         QYV0S2(KI)=RW(KVYV0V(KENDV(KI))+JYV0S2)
         XLEPTG(KI)=IW(KJQDET(KI)+JQDEPD).NE.KQZER
         KLEPPA(KI)=IW(IW(KJQDET(KI)+JQDEPD)+JPDLPA)
         KLEPJT(KI)=IW(IW(KJQDET(KI)+JQDEPD)+JPDLJT)+KLFJET-1
         QLEPPI(KI)=RW(IW(KJQDET(KI)+JQDEPD)+JPDLPI)
         QLEPPE(KI)=RW(IW(KJQDET(KI)+JQDEPD)+JPDLPE)
         KLEPVP(KI)=IW(IW(KJQDET(KI)+JQDEPD)+JPDLVP)
         XLEPTH(KI)=IW(KJQDET(KI)+JQDEPM).NE.KQZER
         KLEPFL(KI)=IW(IW(KJQDET(KI)+JQDEPM)+JPMLFL)
         KLEPPO(KI)=IW(IW(KJQDET(KI)+JQDEPM)+JPMLPO)
         KLEPCH(KI)=IW(IW(KJQDET(KI)+JQDEPM)+JPMLCH)
         KLEPSP(KI)=IW(IW(KJQDET(KI)+JQDEPM)+JPMLSP)
         KLEPLE(KI)=IW(IW(KJQDET(KI)+JQDEPM)+JPMLLE)
         KLEPME(KI)=IW(IW(KJQDET(KI)+JQDEPM)+JPMLME)
         KLEPKT(KI)=IW(IW(KJQDET(KI)+JQDEPM)+JPMLKT)
   
         IER=1
         CALL VZERO(EWEVEN,NMOD)
         CALL VZERO(EWODD,NMOD)
         IF (XNANO) GO TO 999
    a MINI: Information is in bank 'DWES' :
         IF (XMINI) THEN
           JDWES=IW(NAMIND('DWES'))
           IF(JDWES .EQ. 0) GO TO 999
           IER=0
           DO 100 IDWES=1,LROWS(JDWES)
              KDWES=KROW(JDWES,IDWES)
              IMOD=IW(KDWES+JDWEMN)
              IF (IMOD.LE.0.OR.IMOD.GT.NMOD) GO TO 100
              EWODD(IMOD) =FLOAT(IW(KDWES+JDWESO))/FACMI
              EWEVEN(IMOD)=FLOAT(IW(KDWES+JDWESE))/FACMI
    100    CONTINUE
           GO TO 999
         ENDIF
    a POT or a DST: information in PWEI or PEWI bank:
         JPWEI = IW(NAMIND('PWEI'))
         IF (JPWEI .EQ. 0) JPWEI = IW(NAMIND('PEWI'))
         IF (JPWEI.EQ.0) GO TO 999
         FACPO = FACMI*FACMI
         DO 200 I = 1,LROWS(JPWEI)
           IMODUL = ITABL(JPWEI,I,JPWEMN)
           IF (IMODUL.LE.0.OR.IMODUL.GT.NMOD) GO TO 200
           IPMIN=JPWEPD-1
           IPMAX=JPWESS-2
           DO IPLA = ipmin,ipmax
             ENEPL = FLOAT(ITABL(JPWEI,I,IPLA+1))/FACPO
             IF(MOD(IPLA,2).EQ.0) THEN
               EWEVEN(IMODUL) = EWEVEN(IMODUL) + ENEPL
             ELSE
               EWODD(IMODUL) = EWODD(IMODUL) + ENEPL
             ENDIF
           ENDDO
    200  CONTINUE
         IER=0
    999  RETURN
         END
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
              QEWSUM                                                               
                   |----  SIGN                                External             
                   |----  SQRT                                External             
                   |----  ABS                                 External             
                   |----  NINT                                External             
                   |----  KMATIX                              External             
                   |----  ATG                                 External             
                   |----  KCLARM                              External             
                   |----  IAND                                External             
                   |----  KLOCK0                              External             
                   |----  IABS                                External             
                   |----  VZERO                               External             
                   |----  NAMIND                              External             
                   |----  FLOAT                               External             
                   |----  MOD                                 External             
   
 
3 QFDE14
         SUBROUTINE QFDE14
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
    the results of the E14 algorithm
    MINI write requested,  fills MINI bank DE14
    Boucrot 9 Oct 2000
   
   -------------------- /QCDE/ --- COMMONs, DIMENSIONs, etc. ------------
   
    of QCDESH ----------------------- Description in QDATA ---------
         PARAMETER (KCQDET=34, KCQFPA=8, KCQPAR=10, KCQVEC=73, KCQVRT=30,
        & KHE=1, KHMU=2, KHPI=3, KHK=4, KHP=5, KHPHOT=1, KHNHAD=2,
        & KMONTE=-2, KRECO=-1, KLOCKM=14, KSOVT=1, KSCHT=2, KSIST=3,
        & KSAST=4, KSEHT=5, KSV0T=6, KSDCT=7, KSEFT=8, KSNET=9, KSGAT=10,
        & KSJET=11, KSMCT=12, KSREV=13,
        & KSMCV=14, KUNDEF=-12344321, QQPI=3.141593, QQE=2.718282,
        & QQ2PI=QQPI*2., QQPIH=QQPI/2., QQRADP=180./QQPI, QQC=2.997925E10,
        & QQH=6.582173E-25, QQHC=QQH*QQC, QQIRP=.00029979)
         CHARACTER CQDATE*8, CQDWRK*80, CQFHIS*80, CQFOUT*80, CQFWRK*80,
        & CQHTIT*80, CQSEC*3, CQTIME*8, CQUNPK*30, CQVERS*6, CQRLST*800,
        & CQELST*800
         COMMON /QCDEC/ CQDATE, CQDWRK, CQFHIS, CQFOUT, CQFWRK, CQHTIT,
        & CQSEC(14), CQTIME, CQUNPK, CQVERS, CQRLST, CQELST
         COMMON /QCDE/ QELEP, QMFLD ,QMFLDC, QTIME, QTIMEI, QTIMEL,
        & QTIMES, QTIMET, QDHEEC, QDHEEL, QDHEPF, QDHETH, QDHEPH, QDHEEF,
        & QDHEET, QDHET1, QDHEP1, QDHET2, QDHEP2, QDHEE1, QDHEE2, QDHEE3,
        & QKEVRN, QKEVWT, QVXNOM, QVYNOM, QVZNOM, QVXNSG, QVYNSG, QVZNSG,
        & QINLUM, QRINLN, QRINLU, QDBOFS, QEECWI(36), QVXBOM, QVYBOM,
        & QSILUM, QRSLLU, QRSLBK, QRSLEW , QVTXBP(3), QVTEBP(3), QVTSBP(3)
         COMMON /QCDE/  KFOVT, KLOVT, KNOVT, KFCHT, KLCHT, KNCHT, KFIST,
        & KLIST, KNIST, KFAST, KLAST, KNAST, KFEHT, KLEHT, KNEHT, KFV0T,
        & KLV0T, KNV0T, KFDCT, KLDCT, KNDCT, KFEFT, KLEFT, KNEFT, KFNET,
        & KLNET, KNNET, KFGAT, KLGAT, KNGAT, KFJET, KLJET, KNJET, KFMCT,
        & KLMCT, KNMCT, KFREV, KLREV, KNREV, KFMCV, KLMCV, KNMCV, KLUST,
        & KLUSV, KFFRT, KLFRT, KFFRV, KLFRV, KNRET, KNCOT, KFFRD,
        & KLFJET,KLLJET,KLNJET
         COMMON /QCDE/ KBIT(32), KCLACO(KCQFPA), KCLAFR(KCQFPA), KCLARM
        & (KCQFPA), KDEBUG, KEVT, KEXP, KFFILL, KFEOUT, KJOPTN(2,2),
        & KLEOUT, KLROUT, KLOCK0(KLOCKM,2), KLOCK1(KLOCKM,2), KLOCK2(
        & KLOCKM,2), KMATIX(6,6), KMQFPA, KNEFIL, KNEOUT, KNEVT, KNPAST,
        & KNQDET, KNQFPA, KNQLIN, KNQMTX, KNQPAR, KNQPST, KNREIN, KNREOU,
        & KOQDET, KOQFPA, KOQLIN, KOQMTL, KOQMTS, KOQPAR, KOQPBT, KOQPLI,
        & KOQTRA, KOQVEC, KOQVRT, KQPAR, KQVEC, KQVRT, KQWRK, KQZER, KRUN,
        & KSTATU, KTDROP, KUCARD, KUCONS, KUHIST, KUINPU, KUOUTP, KUPRNT,
        & KUPTER, KDEBU1, KDEBU2, KNWRLM, KEFOPT, KUEDIN, KUEDOU, KURTOX,
        & KUCAR2, KNHDRN, KNBHAB, KSBHAB, KRSLLQ, KRSLNB
         COMMON /QCDE/ INDATA
         COMMON /QCDE/ KRINNE, KRINNF, KRINDC, KRINDQ, KRINNZ, KRINNB,
        & KRINBM, KRINFR, KRINLR, KRINLF
         COMMON /QCDE/ KEVERT, KEVEDA, KEVETI, KEVEMI(4), KEVETY, KEVEES,
        & KDHEFP, KDHENP, KDHENM, KKEVNT, KKEVNV, KKEVID, KDHENX, KDHENV,
        & KDHENJ, KREVDS, KXTET1, KXTET2, KXTEL2, KXTCGC, KXTCLL, KXTCBN,
        & KXTCCL, KXTCHV, KXTCEN, KCLASW, KERBOM, KBPSTA
         DIMENSION KLOCUS(3,14)
         EQUIVALENCE (KLOCUS(1,1),KFOVT), (KFOVT,KFRET), (KLIST,KLRET),
        & (KFIST,KFCOT), (KLAST,KLCOT)
         COMMON /QCDE/ XCOPYJ, XFLIAC, XHISTO, XLREV(2), XLREV2(2), XMCEV,
        & XMINI, XSYNTX, XWREVT, XWRRUN, XFILMC, XFILCH, XFILV0, XFILCO,
        & XFILEF, XFILPC, XFILGA, XFILJE,
        & XPRHIS, XFILL, XVITC, XVTPC, XVECAL, XVLCAL, XVTPCD,
        & XVSATR, XVHCAL, XHVTRG, XSREC, XWMINI, XIOKLU, XIOKSI, XFRF2,
        & XNSEQ, XVDOK, XFRF0, XFMUID, XFILEM, XWNANO, XROKSI, XGETBP,
        & XJTHRU
         LOGICAL XCOPYJ, XFLIAC, XHISTO, XLREV, XLREV2, XMCEV, XMINI,
        & XSYNTX, XWREVT, XWRRUN, XFILMC, XFILCH, XFILV0, XFILCO, XFILEF,
        & XFILPC, XPRHIS, XFILL, XVITC, XVTPC, XVECAL, XVLCAL, XVTPCD,
        & XVSATR, XVHCAL, XHVTRG, XSREC, XWMINI, XIOKLU, XFRF2, XFILJE,
        & XNSEQ, XFILGA, XVDOK, XFRF0, XFMUID, XFILEM, XWNANO, XIOKSI,
        & XROKSI, XGETBP, XJTHRU
   
   -------------------- /NANCOM/ --- NanoDst steering -------------------
   Xnano   .true. if input is a nanodst (in nano or epio format, depending
                      XNANOR)
   
         LOGICAL XNANO
         COMMON /NANCOM/XNANO
   
   
    bcs
         INTEGER LMHLEN, LMHCOL, LMHROW
         PARAMETER (LMHLEN=2, LMHCOL=1, LMHROW=2)
         COMMON /BCS/   IW(1000)
         INTEGER IW
         REAL RW(1000)
         EQUIVALENCE (RW(1),IW(1))
   
   
   ------------------ /QCNAMI/ --- name indices -------------------------
         COMMON /QCNAMI/ NAAFID,NAAJOB,NAASEV,NABCNT,NABHIT,NABOMB,
        1 NABOME,NABOMP,NABOMR,NABPTR,NADCAL,NADCRL,NADECO,NADEID,NADENF,
        2 NADEVT,NADEWI,NADFMC,NADFOT,NADGAM,NADHCO,NADHEA,NADHRL,NADJET,
        3 NADMID,NADMJT,NADMUO,NADNEU,NADPOB,NADRES,NADTBP,NADTMC,NADTRA,
        4 NADVER,NADVMC,NAECRQ,NAECTE,NAEGID,NAEGPC,NAEIDT,NAEJET,NAERRF,
        5 NAETDI,NAETKC,NAEVEH,NAEWHE,NAFICL,NAFKIN,NAFPOI,NAFPOL,NAFRFT,
        6 NAFRID,NAFRTL,NAFSTR,NAFTCL,NAFTCM,NAFTOC,NAFTTM,NAFVCL,NAFVER,
        7 NAFZFR,NAHCCV,NAHCTE,NAHINF,NAHMAD,NAHPDI,NAHROA,NAHSDA,NAHTUB,
        8 NAIASL,NAIPJT,NAIRJT,NAITCO,NAITMA,NAIXTR,NAIZBD,NAJBER,NAJEST,
        9 NAJSUM,NAKEVH,NAKINE,NAKJOB,NAKLIN,NAKPOL,NAKRUN,NALIDT,NALOLE,
        A NALUPA,NAMCAD,NAMHIT,NAMTHR,NAMUDG,NAMUEX,NAOSTS,NAPART,NAPASL,
        B NAPCHY,NAPCOB,NAPCOI,NAPCPA,NAPCQA,NAPCRL,NAPECO,NAPEHY,NAPEID,
        C NAPEMH,NAPEPT,NAPEST,NAPEWI,NAPFER,NAPFHR,NAPFRF,NAPFRT,NAPHCO,
        D NAPHER,NAPHHY,NAPHMH,NAPHST,NAPIDI,NAPITM,NAPLID,NAPLPD,NAPLSD,
        E NAPMSK,NAPNEU,NAPPDS,NAPPOB,NAPPRL,NAPRTM,NAPSCO,NAPSPO,NAPSTR,
        F NAPT2X,NAPTBC,NAPTCO,NAPTEX,NAPTMA,NAPTML,NAPTNC,NAPTST,NAPVCO,
        G NAPYER,NAPYFR,NAPYNE,NAQDET,NAQFPA,NAQLIN,NAQMTL,NAQMTS,NAQPAR,
        H NAQPBT,NAQPLI,NAQTRA,NAQVEC,NAQVRT,NAQWRK,NAQZER,NAREVH,NARHAH,
        I NARTLO,NARTLS,NARUNH,NARUNR,NASFTR,NATEXS,NATGMA,NATMTL,NATPCO,
        J NAVCOM,NAVCPL,NAVDCO,NAVDHT,NAVDXY,NAVDZT,NAVERT,NAVFHL,NAVFLG,
        K NAVFPH,NAVHLS,NAVPLH,NAX1AD,NAX1SC,NAX1TI,NAX2DF,NAX3EC,NAX3EW,
        L NAX3HC,NAX3IT,NAX3L2,NAX3LU,NAX3TM,NAX3TO,NAX3TP,NAX3X3,NAXTBN,
        M NAXTBP,NAXTCN,NAXTEB,NAXTOP,NAXTRB,NAYV0V,NAZPFR,NAEFOL,NAMUID,
        N NAPGID,NAPGPC,NAPGAC,NAPMSC,NAPTHR,NANBIP,NAPDLT,NAPMLT,NAPLJT
   
   
   ------------------ /QQQQJJ/ --- HAC parameters for ALPHA banks -------
         PARAMETER (JQVEQX= 1,JQVEQY= 2,JQVEQZ= 3,JQVEQE= 4,JQVEQM= 5,
        & JQVEQP= 6,JQVECH= 7,JQVETN= 8,JQVESC= 9,JQVEKS=10,JQVECL=11,
        & JQVEPA=12,JQVEQD=13,JQVENP=14,JQVESP=15,JQVEOV=16,JQVEEV=17,
        & JQVEND=18,JQVEDL=19,JQVENO=20,JQVEOL=21,JQVENM=22,JQVEML=23,
        & JQVEBM=24,JQVELK=38,JQVEDB=39,JQVEZB=40,JQVESD=41,JQVESZ=42,
        & JQVECB=43,JQVEEM=44,JQVECF=54,JQVEEW=55,JQVEUS=56)
         PARAMETER ( JQVRVX=1,JQVRVY=2,JQVRVZ=3,JQVRVN=4,JQVRTY=5,
        1   JQVRIP=6,JQVRND=7,JQVRDL=8,JQVRAY=9,JQVRAF=10,JQVREM=11,
        2   JQVRCF=17,JQVRET=18)
         PARAMETER ( JQDEAF= 1,JQDEAL= 2,JQDENT= 3,JQDEAT= 4,JQDELT= 8,
        &  JQDEAE= 9,JQDEAH=10,JQDEAM=11,JQDECF=12,JQDEEC=13,JQDEHC=14,
        &  JQDEET=15,JQDEFI=16,JQDENF=17,JQDEFL=18,JQDENE=19,JQDEEL=20,
        &  JQDENH=21,JQDEHL=22,JQDELH=23,JQDEEF=24,JQDEPC=25,JQDEEG=26,
        &  JQDEMU=27,JQDEDX=28,JQDEPG=29,JQDEPD=30,JQDEPM=31)
         PARAMETER ( JQPAGN=1, JQPANA=2, JQPACO=5, JQPAMA=6, JQPACH=7,
        & JQPALT=8,JQPAWI=9,JQPAAN=10)
   
   
         EXTERNAL CQPART, CQTPN, XCEQAN, XLUMOK, XPEQAN, XPEQOR, XPEQU,
        & XVDEOK, LLUMOK, SLUMOK
         CHARACTER * 12 CQPART, CQTPN
         LOGICAL XCAL, XCEQAN, XCEQOR, XCEQU, XECAL, XEID, XFRF, XHCAL,
        & XHMA, XLOCK, XLOCKN, XMC, XLUMOK, XMCA, XPEO, XPHO, XPEQAN,
        & XPEQOR, XPEQU, XSAME, XSIG, XTEX, XPEC, XPEP, XPHC, XYV0,
        & XFRIQF, XEFO, XPCQ, XEGP, XMUI, XVDEOK, XPGP, LLUMOK, SLUMOK,
        & XPGAC, XLEPTG, XLEPTH
   
    alcons
    define universal constants
         REAL PI, TWOPI, PIBY2, PIBY3, PIBY4, PIBY6, PIBY8, PIBY12
         REAL RADEG, DEGRA
         REAL CLGHT, ALDEDX
         PARAMETER (PI=3.141592653589)
         PARAMETER (RADEG=180./PI, DEGRA=PI/180.)
         PARAMETER (TWOPI = 2.*PI , PIBY2 = PI/2., PIBY4 = PI/4.)
         PARAMETER (PIBY6 = PI/6. , PIBY8 = PI/8.)
         PARAMETER (PIBY12= PI/12., PIBY3 = PI/3.)
         PARAMETER (CLGHT = 29.9792458, ALDEDX = 0.000307)
   
         ALDEDX  = constant used in the computation of DEDX in GeV
         CLGHT   = speed of light in cm/nsec
   
   
   
    efoljj
         INTEGER JEFOPX,JEFOPY,JEFOPZ,JEFOEW,JEFOWE,JEFOTY,JEFOLE,JEFOLT,
        +          JEFOLH,JEFOLC,JEFOLJ,LEFOLA
         PARAMETER(JEFOPX=1,JEFOPY=2,JEFOPZ=3,JEFOEW=4,JEFOWE=5,JEFOTY=6,
        +          JEFOLE=7,JEFOLT=8,JEFOLH=9,JEFOLC=10,JEFOLJ=11,
        +          LEFOLA=11)
   
   
    egpcjj
         INTEGER JEGPPX,JEGPPY,JEGPPZ,JEGPR1,JEGPR2,JEGPF4,JEGPDM,JEGPST,
        +          JEGPQU,JEGPPE,LEGPCA
         PARAMETER(JEGPPX=1,JEGPPY=2,JEGPPZ=3,JEGPR1=4,JEGPR2=5,JEGPF4=6,
        +          JEGPDM=7,JEGPST=8,JEGPQU=9,JEGPPE=10,LEGPCA=10)
   
   
    eidtjj
         INTEGER JEIDIF,JEIDR1,JEIDR2,JEIDR3,JEIDR4,JEIDR5,JEIDR6,JEIDR7,
        +          JEIDEC,JEIDIP,JEIDE1,JEIDE2,JEIDE3,JEIDFR,JEIDPE,LEIDTA
         PARAMETER(JEIDIF=1,JEIDR1=2,JEIDR2=3,JEIDR3=4,JEIDR4=5,JEIDR5=6,
        +          JEIDR6=7,JEIDR7=8,JEIDEC=9,JEIDIP=10,JEIDE1=11,
        +          JEIDE2=12,JEIDE3=13,JEIDFR=14,JEIDPE=15,LEIDTA=15)
   
   
    frftjj
         INTEGER JFRFIR,JFRFTL,JFRFP0,JFRFD0,JFRFZ0,JFRFAL,JFRFEM,JFRFC2,
        +          JFRFDF,JFRFNO,LFRFTA
         PARAMETER(JFRFIR=1,JFRFTL=2,JFRFP0=3,JFRFD0=4,JFRFZ0=5,JFRFAL=6,
        +          JFRFEM=7,JFRFC2=28,JFRFDF=29,JFRFNO=30,LFRFTA=30)
   
   
    fridjj
         INTEGER JFRIBP,JFRIDZ,JFRIBC,JFRIDC,JFRIPE,JFRIPM,JFRIPI,JFRIPK,
        +          JFRIPP,JFRINK,JFRIQF,LFRIDA
         PARAMETER(JFRIBP=1,JFRIDZ=2,JFRIBC=3,JFRIDC=4,JFRIPE=5,JFRIPM=6,
        +          JFRIPI=7,JFRIPK=8,JFRIPP=9,JFRINK=10,JFRIQF=11,
        +          LFRIDA=11)
   
   
    frtljj
         INTEGER JFRTIV,JFRTNV,JFRTII,JFRTNI,JFRTNE,JFRTIT,JFRTNT,JFRTNR,
        +          LFRTLA
         PARAMETER(JFRTIV=1,JFRTNV=2,JFRTII=3,JFRTNI=4,JFRTNE=5,JFRTIT=6,
        +          JFRTNT=7,JFRTNR=8,LFRTLA=8)
   
   
    hmadjj
         INTEGER JHMANF,JHMANE,JHMANL,JHMAMH,JHMAIG,JHMAED,JHMACS,JHMAND,
        +          JHMAIE,JHMAIT,JHMAIF,JHMATN,LHMADA
         PARAMETER(JHMANF=1,JHMANE=2,JHMANL=3,JHMAMH=4,JHMAIG=5,JHMAED=6,
        +          JHMACS=7,JHMAND=8,JHMAIE=9,JHMAIT=10,JHMAIF=11,
        +          JHMATN=12,LHMADA=12)
   
   
    mcadjj
         INTEGER JMCANH,JMCADH,JMCADC,JMCAAM,JMCAAC,JMCATN,LMCADA
         PARAMETER(JMCANH=1,JMCADH=3,JMCADC=5,JMCAAM=7,JMCAAC=8,JMCATN=9,
        +          LMCADA=9)
   
   
    muidjj
         INTEGER JMUIIF,JMUISR,JMUIDM,JMUIST,JMUITN,LMUIDA
         PARAMETER(JMUIIF=1,JMUISR=2,JMUIDM=3,JMUIST=4,JMUITN=5,LMUIDA=5)
   
   
    pcqajj
         INTEGER JPCQNA,JPCQPX,JPCQPY,JPCQPZ,JPCQEN,LPCQAA
         PARAMETER(JPCQNA=1,JPCQPX=2,JPCQPY=3,JPCQPZ=4,JPCQEN=5,LPCQAA=5)
   
   
    pdltjj
         INTEGER JPDLPA,JPDLJT,JPDLPI,JPDLPE,JPDLVP,JPDLFR,LPDLTA
         PARAMETER(JPDLPA=1,JPDLJT=2,JPDLPI=3,JPDLPE=4,JPDLVP=5,JPDLFR=6,
        +          LPDLTA=6)
   
   
    pecojj
         INTEGER JPECER,JPECE1,JPECE2,JPECTH,JPECPH,JPECEC,JPECKD,JPECCC,
        +          JPECRB,JPECPC,LPECOA
         PARAMETER(JPECER=1,JPECE1=2,JPECE2=3,JPECTH=4,JPECPH=5,JPECEC=6,
        +          JPECKD=7,JPECCC=8,JPECRB=9,JPECPC=10,LPECOA=10)
   
   
    peptjj
         INTEGER JPEPT1,JPEPP1,JPEPT3,JPEPP3,LPEPTA
         PARAMETER(JPEPT1=1,JPEPP1=2,JPEPT3=3,JPEPP3=4,LPEPTA=4)
   
   
    pgacjj
         INTEGER JPGAEC,JPGATC,JPGAPC,JPGAR1,JPGAR2,JPGAF4,JPGADM,JPGAST,
        +          JPGAQU,JPGAQ1,JPGAQ2,JPGAM1,JPGAM2,JPGAMA,JPGAER,JPGATR,
        +          JPGAPR,JPGAEF,JPGAGC,JPGAZS,JPGAPL,JPGAPH,JPGAPN,JPGAFA,
        +          JPGAPE,LPGACA
         PARAMETER(JPGAEC=1,JPGATC=2,JPGAPC=3,JPGAR1=4,JPGAR2=5,JPGAF4=6,
        +          JPGADM=7,JPGAST=8,JPGAQU=9,JPGAQ1=10,JPGAQ2=11,
        +          JPGAM1=12,JPGAM2=13,JPGAMA=14,JPGAER=15,JPGATR=16,
        +          JPGAPR=17,JPGAEF=18,JPGAGC=19,JPGAZS=20,JPGAPL=21,
        +          JPGAPH=22,JPGAPN=23,JPGAFA=24,JPGAPE=25,LPGACA=25)
   
   
    pgpcjj
         INTEGER JPGPEC,JPGPTC,JPGPPC,JPGPR1,JPGPR2,JPGPF4,JPGPDM,JPGPST,
        +          JPGPQU,JPGPQ1,JPGPQ2,JPGPM1,JPGPM2,JPGPMA,JPGPER,JPGPTR,
        +          JPGPPR,JPGPPE,LPGPCA
         PARAMETER(JPGPEC=1,JPGPTC=2,JPGPPC=3,JPGPR1=4,JPGPR2=5,JPGPF4=6,
        +          JPGPDM=7,JPGPST=8,JPGPQU=9,JPGPQ1=10,JPGPQ2=11,
        +          JPGPM1=12,JPGPM2=13,JPGPMA=14,JPGPER=15,JPGPTR=16,
        +          JPGPPR=17,JPGPPE=18,LPGPCA=18)
   
   
    phcojj
         INTEGER JPHCER,JPHCTH,JPHCPH,JPHCEC,JPHCKD,JPHCCC,JPHCRB,JPHCNF,
        +          JPHCPC,LPHCOA
         PARAMETER(JPHCER=1,JPHCTH=2,JPHCPH=3,JPHCEC=4,JPHCKD=5,JPHCCC=6,
        +          JPHCRB=7,JPHCNF=8,JPHCPC=9,LPHCOA=9)
   
   
    pmltjj
         INTEGER JPMLFL,JPMLPO,JPMLCH,JPMLSP,JPMLLE,JPMLME,JPMLKT,JPMLFR,
        +          LPMLTA
         PARAMETER(JPMLFL=1,JPMLPO=2,JPMLCH=3,JPMLSP=4,JPMLLE=5,JPMLME=6,
        +          JPMLKT=7,JPMLFR=8,LPMLTA=8)
   
   
    texsjj
         INTEGER JTEXSI,JTEXTM,JTEXTL,JTEXNS,JTEXAD,JTEXTN,JTEXSF,LTEXSA
         PARAMETER(JTEXSI=1,JTEXTM=2,JTEXTL=3,JTEXNS=4,JTEXAD=5,JTEXTN=6,
        +          JTEXSF=7,LTEXSA=7)
   
   
    yv0vjj
         INTEGER JYV0K1,JYV0K2,JYV0VX,JYV0VY,JYV0VZ,JYV0VM,JYV0PX,JYV0PY,
        +          JYV0PZ,JYV0PM,JYV0X1,JYV0X2,JYV0XM,JYV0C2,JYV0IC,JYV0P1,
        +          JYV0P2,JYV0EP,JYV0DM,JYV0S1,JYV0S2,LYV0VA
         PARAMETER(JYV0K1=1,JYV0K2=2,JYV0VX=3,JYV0VY=4,JYV0VZ=5,JYV0VM=6,
        +          JYV0PX=12,JYV0PY=13,JYV0PZ=14,JYV0PM=15,JYV0X1=21,
        +          JYV0X2=22,JYV0XM=23,JYV0C2=26,JYV0IC=27,JYV0P1=28,
        +          JYV0P2=31,JYV0EP=34,JYV0DM=55,JYV0S1=56,JYV0S2=57,
        +          LYV0VA=57)
   
   
   
    de14jj
         INTEGER JDE1EC,JDE1HC,JDE1LV,LDE14A
         PARAMETER(JDE1EC=1,JDE1HC=2,JDE1LV=3,LDE14A=3)
   
         PARAMETER ( FDE14 = 1000000. , EMXT = 1000.)
         COMMON / E14VARS / E14ECA,E14HCA,ILCCVT
   
    bmacro
       set of intrinsic functions to handle BOS banks
   - # of words/row in bank with index ID
         LCOLS(ID) = IW(ID+1)
   - # of rows in bank with index ID
         LROWS(ID) = IW(ID+2)
   - index of next row in the bank with index ID
         KNEXT(ID) = ID + LMHLEN + IW(ID+1)*IW(ID+2)
   - index of row # NRBOS in the bank with index ID
         KROW(ID,NRBOS) = ID + LMHLEN + IW(ID+1)*(NRBOS-1)
   - # of free words in the bank with index ID
         LFRWRD(ID) = ID + IW(ID) - KNEXT(ID)
   - # of free rows in the bank with index ID
         LFRROW(ID) = LFRWRD(ID) / LCOLS(ID)
   - Lth integer element of the NRBOSth row of the bank with index ID
         ITABL(ID,NRBOS,L) = IW(ID+LMHLEN+(NRBOS-1)*IW(ID+1)+L)
   - Lth real element of the NRBOSth row of the bank with index ID
         RTABL(ID,NRBOS,L) = RW(ID+LMHLEN+(NRBOS-1)*IW(ID+1)+L)
   
         e14ec=0.
         e14hc=0.
         lveto=0
    one is not reading a MINI, call the E14 algorithm:
         if (.not.xmini) then
            call qcale14(e14ec,e14hc)
            lveto=lcra_e14()
            if (e14ec.gt.emxt) e14ec=emxt
            if (e14hc.gt.emxt) e14hc=emxt
    one is writing a MINI, build the 'DE14' bank:
            if (xwmini) then
               call bdrop(IW,'DE14')
               LE14=LMHLEN+LDE14A
               CALL AUBOS('DE14',0,LE14,JDE14,IGARB)
               IF (IGARB.EQ.2) GO TO 800
               IW(JDE14+LMHROW)=1
               IW(JDE14+LMHCOL)=LDE14A
               KDE14=KROW(JDE14,1)
               IW(KDE14+JDE1EC)=NINT(FDE14*E14EC)
               IW(KDE14+JDE1HC)=NINT(FDE14*E14HC)
               IW(KDE14+JDE1LV)=LVETO
             endif
    one is reading a MINI, get the result of E14 from
    'DE14' bank:
         else
            jde14=iw(namind('DE14'))
            if (jde14.eq.0) go to 800
            kde14=krow(jde14,1)
            e14ec=float(iw(kde14+jde1ec))/fde14
            e14hc=float(iw(kde14+jde1hc))/fde14
            lveto=iw(kde14+jde1lv)
         endif
    the variables of common / E14VARS / :
    800  e14eca=e14ec
         e14hca=e14hc
         ilccvt=lveto
    999  return
         end
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   QFILL                                                                           
        |---- QFDE14                                                               
                   |----  QCALE14                                                  
                   |----  LCRA_E14                                                 
                   |----  BDROP                               External             
                   |----  AUBOS                               External             
                   |----  NINT                                External             
                   |----  IW                                  External             
                   |----  NAMIND                              External             
                   |----  KROW                                External             
                   |----  FLOAT                               External             
   
 
3 QFGETCH
         SUBROUTINE QFGET_CH (IFRUN, IFEVT, ILRUN, ILEVT)
  ------------------------------------------------------------------------------
    CKEY FILL BEAMSPOT / INTERNAL
  ------------------------------------------------------------------------------
     Author  S. Wasserbaech  2-5-95
     Returns first and last event numbers for the chunk containing the
     event IRUN/IEVT specified in the previous call to QFGET_BP.  The
     outputs are zero if the previous call to QFGET_BP was unsuccessful,
     or if Monte Carlo is being analyzed.
   - Input:
     None.
   - Output:
     IFRUN  / I  Run number for first event in chunk
     IFEVT  / I  Event number for first event in chunk
     ILRUN  / I  Run number for last event in chunk
     ILEVT  / I  Event number for last event in chunk.  Notice that this
                   does not necessarily correspond to a real event: an
                   arbitrary large number may be given if the chunk
                   extends to the end of a run.
   
   
 
3 QFMCSX
         SUBROUTINE QFMCSX (ISETUP, SIGMAX)
  ------------------------------------------------------------------------------
    CKEY FILL BEAMSPOT / INTERNAL
  ------------------------------------------------------------------------------
     Author  S. Wasserbaech  2-5-95
     Returns the BE setup code (row index in ALRP) used in the previous
     call to QFGET_BP, and the generated sigma_x (width of the luminous
     region) for that call.  The outputs are -1 if the previous call to
     QFGET_BP was unsuccessful, or if real data is being analyzed, or
     if a BSIZ card is in use.
   - Input:
     None.
   - Output:
     ISETUP  / I  Selected/generated BE setup code
     SIGMAX  / R  Generated sigma_x (cm)
   
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   QBEAMX                                                                          
        |---- QFMCSX.                                                              
   
 
3 QFMMCL
         SUBROUTINE QFMMCL( YCUT, EVIST, MASMAT, PP, LENM )
  ------------------------------------------------------------------------------
    CKEY ALPHA JETS /INTERNAL
  ------------------------------------------------------------------------------
     New      : C. Bowdery      9-OCT-1990  Faster algortihm than QGMMCL
     Description
     ===========
   Evaluate jet multiplicities based on the scaled invariant mass
      squared algorithm using BOS work bank
      from momentum vectors stored in QCTBUF.INC
    input   : YCUT            ycut value ( (M/EVIST)**2 )
              EVIST           visible energy
                              (if EVIST=0., it is computed from the
                               input particle energies)
              MASMAT          (empty) invariant mass**2 square matrix
              PP              (empty) matrix for temporary particle usage
              LENM            dimension of MASMAT and PP matrices
              KTBI            # of particles           (from QCTBUF)
              QTBIX,Y,Z,E(i)  four momentum (i=1,KTBI) ( "     "   )
    output  :
              QTBOX,Y,Z,E(j)  four  momentum of jet j (j=1,NJET)
              KTBOF(i)        jet # of particle i     (i=1,KTBI)
              KTBO        -1  input  error (KTBI/EVIST) (in   QCTBUF)
                          -2  error from individ. track
                          -3  too many jets
                         NJET # of jets (normal return)
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
              QFMMCL                                                               
                   |----  QTBIE                               External             
                   |----  SQRT                                External             
                   |----  JIF                                 External             
   
 
3 QGETE14
         SUBROUTINE QGETE14(e14ec,e14hc,lveto)
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   -access to  the results of the E14 algorithm
    Boucrot 9 Oct 2000
         COMMON / E14VARS / E14ECA,E14HCA,ILCCVT
         e14ec=e14eca
         e14hc=e14hca
         lveto=ilccvt
         return
         end
 
3 QGETWE14
   
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   
         subroutine qgetw_e14(module,eplane,estack,esum,t0)
    some relevant information from the wires of a given ECAL module
   Auxiliary to QFE14
   Author G. Taylor Oct 1997
   
    bcs
         INTEGER LMHLEN, LMHCOL, LMHROW
         PARAMETER (LMHLEN=2, LMHCOL=1, LMHROW=2)
         COMMON /BCS/   IW(1000)
         INTEGER IW
         REAL RW(1000)
         EQUIVALENCE (RW(1),IW(1))
   
         parameter(nplane=45)
         real eplane(nplane),estack(3)
         real enoise(nplane)
         logical bpl_e14,xfound
   
    bmacro
   Set of intrinsic functions to handle bos banks
   - # of words/row in bank with index ID
         LCOLS(ID) = IW(ID+1)
   - # of rows in bank with index ID
         LROWS(ID) = IW(ID+2)
   - index of next row in the bank with index ID
         KNEXT(ID) = ID + LMHLEN + IW(ID+1)*IW(ID+2)
   - index of row # NRBOS in the bank with index ID
         KROW(ID,NRBOS) = ID + LMHLEN + IW(ID+1)*(NRBOS-1)
   - # of free words in the bank with index ID
         LFRWRD(ID) = ID + IW(ID) - KNEXT(ID)
   - # of free rows in the bank with index ID
         LFRROW(ID) = LFRWRD(ID) / LCOLS(ID)
   - Lth integer element of the NRBOSth row of the bank with index ID
         ITABL(ID,NRBOS,L) = IW(ID+LMHLEN+(NRBOS-1)*IW(ID+1)+L)
   - Lth real element of the NRBOSth row of the bank with index ID
         RTABL(ID,NRBOS,L) = RW(ID+LMHLEN+(NRBOS-1)*IW(ID+1)+L)
   
         call vzero(estack(1),3)
         call vzero(eplane(1),nplane)
         esum=0.
         t0=0.
   
         kdewi=iw(namind('DEWI'))
         if (kdewi.gt.0) then
          do i=1,lrows(kdewi)
           if (module.eq.itabl(kdewi,i,1)) then
            esum=real(itabl(kdewi,i,2))/1000.
           endif
          enddo
    this is all there is on the mini
          return
         endif
         xfound=.false.
   
         kpwei=iw(namind('PWEI'))
         if (kpwei.gt.0) then
          do i=1,lrows(kpwei)
           if (module.eq.itabl(kpwei,i,1)) then
            xfound=.true.
            do iplane=1,45
             eplane(iplane)=real(itabl(kpwei,i,iplane+1))/1000000.
            enddo
            t0=real(itabl(kpwei,i,63))
           endif
          enddo
         endif
   
         kpewi=iw(namind('PEWI'))
         if (kpewi.gt.0) then
          do i=1,lrows(kpewi)
           if (module.eq.itabl(kpewi,i,1)) then
            xfound=.true.
            do iplane=1,45
             eplane(iplane)=real(itabl(kpewi,i,iplane+1))/1000000.
            enddo
            t0=real(itabl(kpewi,i,55))
           endif
          enddo
         endif
    divide stack 3 by 50% tp make more uniform
         do iplane=34,45
          eplane(iplane)=eplane(iplane)/2.
         enddo
         if (.not.xfound) return
    the dead wires ....
         do iplane=1,nplane
          if (bpl_e14(module,iplane)) then
           if (iplane.eq.1) then
            enew=eplane(iplane+1)
           else if (iplane.eq.45) then
            enew=eplane(iplane-1)
           else
            enew=(eplane(iplane-1)+eplane(iplane+1))/2.
           endif
           eplane(iplane)=enew
          endif
         enddo
    the noisy wires ....
         do iplane=1,nplane
    allowed noise on third stack to deal with gain
    first plane of stack three to be conservative
          if (iplane.le.34) then
           enoise(iplane)=2.5
          else
           enoise(iplane)=1.25
          endif
         enddo
         do iplane=1,nplane
          enew=-1.
          if (iplane.eq.1) then
           if (eplane(iplane)-eplane(iplane+1).gt.enoise(iplane))
        &    enew=eplane(iplane+1)
          else if (iplane.eq.45) then
           if (eplane(iplane)-eplane(iplane-1).gt.enoise(iplane))
        &    enew=eplane(iplane-1)
          else
           ed1=abs(eplane(iplane-1)-eplane(iplane))
           ed2=abs(eplane(iplane+1)-eplane(iplane))
           edmax=max(ed1,ed2)
           edmin=min(ed1,ed2)
           if (edmax.gt.enoise(iplane).and.edmin.gt.0.66*enoise(iplane))
        &    enew=(eplane(iplane-1)+eplane(iplane+1))/2.
          endif
          if (enew.gt.-1.) eplane(iplane)=enew
         enddo
         do iplane=1,nplane-1
          ed1=eplane(iplane+1)-eplane(iplane)
          if (abs(ed1).gt.1.00*enoise(iplane)) then
           do jplane=iplane+1,nplane-1
            ed2=eplane(jplane+1)-eplane(jplane)
            edmax=max(abs(ed1),abs(ed2))
            edmin=min(abs(ed1),abs(ed2))
            if (edmax.gt.max(enoise(iplane),enoise(jplane)).and.
        &      edmin.gt.1.00*min(enoise(iplane),enoise(jplane)).and.
        &      ed1.gt.0..and.ed2.lt.0.) then
             enew=(eplane(iplane)+eplane(jplane+1))/2.
             do kplane=iplane+1,jplane
              eplane(kplane)=enew
             enddo
             goto 200
            endif
           enddo
          endif
    200   continue
         enddo
    stack 3 by 2
         do iplane=34,45
          eplane(iplane)=eplane(iplane)*2.
         enddo
         do iplane=1,nplane
          esum=esum+eplane(iplane)
          istack=1
          if (istack.gt.10) istack=2
          if (istack.gt.10+23) istack=3
          estack(istack)=estack(istack)+eplane(iplane)
         enddo
   
         if (kpwei.gt.0) then
          f3=0.
          if (estack(3).gt.0.) f3=estack(3)/esum
          if (module.le.12.or.module.ge.25) then
           t0=(t0-8)+80*f3
          else
           t0=(t0-16)+60*f3
          endif
         endif
         RETURN
         END
 
3 QGFOXW
         SUBROUTINE QGFOXW
  ------------------------------------------------------------------------------
    CKEY SHAPE /INTERNAL
  ------------------------------------------------------------------------------
     Author   : E. Blucher     1-MAR-1989
     Description
     ===========
   Calculate fox-wolfrom moments h0 -- h4.
          QTBOR(1), ..., QTBOR(5) = H0, ..., H4
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   QJFOXW                                                                          
        |---- QGFOXW                                                               
                   |----  SQRT                                External             
   
 
3 QGJMMC
         SUBROUTINE QGJMMC( NJETS, CNAM, ICLASS, YCUT, EVIS, SCHEME, VERSN)
  ------------------------------------------------------------------------------
    CKEY ALPHA JETS /INTERNAL
  ------------------------------------------------------------------------------
     Author   : C. Bowdery     18-APR-1991 based on QJMMCL by P. Perez
     Modified : C. Bowdery     28-APR-1991 add VERSN argument
     Modified : C. Bowdery     18-OCT-1991 new name
     Modified : C. Bowdery     24-OCT-1991 work bank index corrected
     Modified : C. Bowdery     24-OCT-1991 remove call to SJMMCL
     Modified : C. Bowdery      9-JUN-1994 allow 'JADE  ' and 'DURHAM'
     Description
     ===========
   Set up and call fjmmcl jet finding routine.
      Generalised version of QJMMCL with SCHEME and VERSN argument.
    Input   : CNAM            name of jet particles to be created
              ICLASS          KRECO or KMONTE
              YCUT            YCUT value ( (M/EVIS)**2 )
              EVIS            visible energy
                              (if EVIS=0., it is computed from the
                               input particle energies)
              SCHEME          CHAR*2, combination scheme 'E ', 'E0', 'P '
              VERSN           CHAR*6, 'NORMAL' aka 'JADE  ' or
                                      'BETTER' aka 'DURHAM'
    Output  : NJETS           number of jets found or error code if -ve
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   QDMMCL                                                                          
   QJMMCL                                                                          
        |---- QGJMMC                                                               
                   |----  CLTOU                               External             
                   |----  INDEX                               External             
                   |----  QJSETU                                                   
                   |----  WBANK                               External             
                   |----  FJMMCL                              External             
                   |----  WDROP                               External             
                   |----  QWMESE                                                   
                   |----  QJSAVE                                                   
   
 
3 QGLUCL
         SUBROUTINE QGLUCL(MINCLU,DMAX1,DMAX2,MULSYM
  ------------------------------------------------------------------------------
    CKEY JETS /INTERNAL
  ------------------------------------------------------------------------------
        &                 ,NJET,TGEN,DMIN)
     Author   : P. Perez       20-APR-1989
     Description
     ===========
   Evaluate jet multiplicities based on the luclus algorithm (jetset)
    :
           MINCLU min. # of clusters to be reconstructed
                   (if <0, work space momenta are used as a start)
                   (usually=1)
           DMAX1 max. distance to form starting clusters(usually=0.25GeV)
           DMAX2  "      "     to join 2 clusters       (usually=2.5 GeV)
           MULSYM = 1 for symmetric distance criterion (usual)
                  = 2  "  multicity    "
           KTBI            # of particles           (from QCTBUF)
           QTBIX,Y,Z,E(i)  four momentum (i=1,KTBI) ( "     "   )
    NJET number of reconstructed jets
                = -1 if not enough particles
                = -2 not enough working space (MXWORK)
           TGEN generalized thrust
           DMIN minimum distance between 2 jets
                = 0  when only 1 jet
                = -1 , -2 as for NJET
           QTBOX,Y,Z,E(j)  four  momentum of jet j (j=1,NJET)(in QCTBUF)
           KTBOF(i)        jet # of particle i     (i=1,KTBI)( "   "   )
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   QJLUCL                                                                          
        |---- QGLUCL                                                               
                   |----  SQRT                                External             
                   |----  MAX                                 External             
                   |----  QTBIE                               External             
                   |----  IABS                                External             
   
 
3 QGMDCL
         SUBROUTINE QGMDCL(ALPHA,DELTA,ETA,EVIST)
  ------------------------------------------------------------------------------
    CKEY JETS /INTERNAL
  ------------------------------------------------------------------------------
     Author   : P. Perez       28-MAR-1989
     Description
     ===========
   Evaluate jet multiplicities based on the scaled min. distance
      method (suggested by Hagiwara)
      from momentum vectors stored in QCTBUF.INC
     Distance between particles i and j is defined by :
                                     2. * (Ei*Ej)**alpha * (1-cos(i,j))
    input   : ALPHA           weight
              DELTA           half opening angle (degrees)
              ETA             energy cut-off for jets (in un. of Evis)
              EVIST           visible energy
                              (if EVIST=0., it is computed from the
                               input particle energies)
              KTBI            # of particles           (from QCTBUF)
              QTBIX,Y,Z,E(i)  four momentum (i=1,KTBI) ( "     "   )
    output  :
              QTBOX,Y,Z,E(j)  four  momentum of jet j (j=1,NJET)
              KTBOF(i)        jet # of particle i     (i=1,KTBI)
              KTBO        -1  input  error (KTBI/EVIST) (in   QCTBUF)
                          -2  error from individ. track
                          -3  too many jets
                         NJET # of jets (normal return)
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   QJMDCL                                                                          
        |---- QGMDCL                                                               
                   |----  QTBIE                               External             
                   |----  SQRT                                External             
                   |----  COS                                 External             
                   |----  ABS                                 External             
                   |----  SIGN                                External             
   
 
3 QGMMCL
         SUBROUTINE QGMMCL(YCUT,EVIST)
  ------------------------------------------------------------------------------
    CKEY JETS /INTERNAL
  ------------------------------------------------------------------------------
     Author   : P. Perez       28-MAR-1989
     Modified : C. Bowdery      4-DEC-1990   Prevent infinite loops
     Description
     ===========
   Evaluate jet multiplicities based on the scaled invariant mass
      squared algorithm
      from momentum vectors stored iN QCTBUF.INC
    input   : YCUT            ycut value ( (M/EVIST)**2 )
              EVIST           visible energy
                              (if EVIST=0., it is computed from the
                               input particle energies)
              KTBI            # of particles           (from QCTBUF)
              QTBIX,Y,Z,E(i)  four momentum (i=1,KTBI) ( "     "   )
    output  :
              QTBOX,Y,Z,E(j)  four  momentum of jet j (j=1,NJET)
              KTBOF(i)        jet # of particle i     (i=1,KTBI)
              KTBO        -1  input  error (KTBI/EVIST) (in   QCTBUF)
                          -2  error from individ. track
                          -3  too many jets
                         NJET # of jets (normal return)
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
              QGMMCL                                                               
                   |----  QTBIE                               External             
                   |----  SQRT                                External             
                   |----  ABS                                 External             
                   |----  SIGN                                External             
   
 
3 QGPTCL
         SUBROUTINE QGPTCL (YVALUT,THRUST,NJTLIM,YJTLIM,EVIS)
  ------------------------------------------------------------------------------
    CKEY JETS /INTERNAL
  ------------------------------------------------------------------------------
   Ptclus jet algorithm (see aleph  89-150)
   
      Author   :- J.M.SCARR
   ------CLUSTER (JET) ALGORITHM FOR HIGH ENERGY FINAL STATES.
   ------SCARR JM. 89.II.13 DOX#89.3.                     LST CHG 89.II.28
   
      Inputs:
   
         NJTLIM  =  LIMIT MINIMUM NUMBER OF CLUSTERS.
                    (ALWAYS TEST  KTBO)
         YJTLIM  =  UPPER LIMIT OF  SEMS  OF 2 CLUSTERS MERGED.
   
   
      Outputs:
           -     KTBO  =  NUMBER OF CLUSTERS FOUND.(in QCTBUF.INC)
           -   THRUST  =  GENERALISED THRUST.
         YVALUT(1) =   SEMS  OF LAST MERGED CLUSTERS.
         YVALUT(2) =   LOWEST  SEMS  OF TWO CLUSTERS.
                    SEMS = SCALED EFFECTIV MASS SQUARED, M*M/S.
         YVALUT(3)=   FRACTIONAL ENERGY REASSIGNED IN LAST MERGE.
                    SEMS = SCALED EFFECTIV MASS SQUARED, M*M/S.
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   QJPTCL                                                                          
        |---- QGPTCL                                                               
                   |----  QWMESE                                                   
                   |----  QTBIE                               External             
                   |----  SQRT                                External             
   
 
3 QGSPHE
         SUBROUTINE QGSPHE
  ------------------------------------------------------------------------------
    CKEY SHAPE /INTERNAL
  ------------------------------------------------------------------------------
     Author   : E. Blucher     27-FEB-1989
     Libraries required: CERNLIB (VSCALE,EIGRS1,SORTZV)
     Description
     ===========
   Calculate sphericity
     from momentum vectors stored in QCTBUF.INC.
     QTBOX,Y,Z(1) = major axis (sphericity axis)
     QTBOX,Y,Z(2) = semi-major axis
     QTBOX,Y,Z(3) = minor axis
     QTBOR(1,2,3) = eigenvalues in decending order
           sphericity = 1.5*(1-qtbor(1))
           aplanarity = 1.5*qtbor(3)
           planarity = qtbor(3)/qtbor(2)
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   QJEIG                                                                           
   QJSPHE                                                                          
        |---- QGSPHE                                                               
                   |----  SQRT                                External             
                   |----  VSCALE                              External             
                   |----  EISRS1                              External             
                   |----  SORTZV                              External             
   
 
3 QGTENS
         SUBROUTINE QGTENS
  ------------------------------------------------------------------------------
    CKEY SHAPE /INTERNAL
  ------------------------------------------------------------------------------
       Author : M.N.Minard , M.Pepe
          Modified version of QGSPHE, E. Blucher.
       Libraries required CERNLIB ( VSCALE,EIGRS1 )
   Calculate normalised momentum tensor
       eigen-vectors and eigen-values from vectors in QCTBUF
       QTBOX , Y , Z (1) = major axis
       QTBOX , Y , Z (2) = semi-major axis
       QTBOX , Y , Z (3) = minor axis
       QTBOR(1,2,3)      = eigenvalues in descending order.
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   QJTENS                                                                          
        |---- QGTENS                                                               
                   |----  QTBIE                               External             
                   |----  VSCALE                              External             
                   |----  EISRS1                              External             
                   |----  SORTZV                              External             
                   |----  SQRT                                External             
   
 
3 QGTHRU
         SUBROUTINE QGTHRU
  ------------------------------------------------------------------------------
    CKEY SHAPE /INTERNAL
  ------------------------------------------------------------------------------
   Topological event analysis: thrust
                                                     H. Albrecht. feb 82
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   QJTHRU                                                                          
        |---- QGTHRU                                                               
                   |----  SQRT                                External             
   
 
3 QIDV0
         SUBROUTINE QIDV0 (ITKV0, CNAM1, CNAM2)
  ------------------------------------------------------------------------------
    CKEY PART /USER
  ------------------------------------------------------------------------------
   Calculate mass for particle pointing to v0
                                                      H.Albrecht 6.11.89
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
              QIDV0                                                                
                   |----  QWMESE                                                   
                   |----  AMAX1                               External             
   
 
3 QJADDP
         SUBROUTINE QJADDP (PSUM,CNAM,ICLASS)
  ------------------------------------------------------------------------------
    CKEY SHAPE JETS /USER
  ------------------------------------------------------------------------------
   Add 4-vectors
                                                      H.Albrecht 22.2.89
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
              QJADDP                                                               
                   |----  QJSET0                                                   
                   |----  KTBIT                               External             
                   |----  SQRT                                External             
                   |----  QJSAVE                                                   
   
 
3 QJEIG
         SUBROUTINE QJEIG(EVAL,CNAM,ICLASS)
  ------------------------------------------------------------------------------
    CKEY SHAPE /USER
  ------------------------------------------------------------------------------
     Author   : E. Blucher     27-FEB-1989
     Description
     ===========
   Set up and call eigenvector  routine.
     KPDIR(CNAM,ICLASS) = major axis (sphericity axis)
     KFOLLO (...) = semi-major axis
     KFOLLO (...) = minor axis
     EVAL(1,2,3) = eigenvalues in descending order
           sphericity = 1.5*(1-EVAL(1))
           aplanarity = 1.5*EVAL(3)
           planarity = EVAL(3)/EVAL(2)
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
              QJEIG                                                                
                   |----  QJSETU                                                   
                   |----  QGSPHE                                                   
                   |----  QTBOR                               External             
                   |----  KSCOLD                                                   
                   |----  QJSAVE                                                   
   
 
3 QJFOXW
         SUBROUTINE QJFOXW (FOX,ICLASS)
  ------------------------------------------------------------------------------
    CKEY SHAPE /USER
  ------------------------------------------------------------------------------
     Author   : E. Blucher     2-APR-1989
     Description
     ===========
   Set up and call fox-wolfram routine.
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
              QJFOXW                                                               
                   |----  QJSETU                                                   
                   |----  QGFOXW                                                   
                   |----  QTBOR                               External             
   
 
3 QJHEMI
         SUBROUTINE QJHEMI (CSAM,COPP,ICLASS,ITKAXI,CUTCOS)
  ------------------------------------------------------------------------------
    CKEY SHAPE /USER
  ------------------------------------------------------------------------------
   Divide the event into 2 hemispheres
                                                      H.Albrecht 22.2.89
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
              QJHEMI                                                               
                   |----  SIGN                                External             
                   |----  SQRT                                External             
                   |----  ABS                                 External             
                   |----  NINT                                External             
                   |----  KMATIX                              External             
                   |----  ATG                                 External             
                   |----  KCLARM                              External             
                   |----  IAND                                External             
                   |----  KLOCK0                              External             
                   |----  IABS                                External             
                   |----  QJSET0                                                   
                   |----  KTBIT                               External             
                   |----  QJSAVE                                                   
   
 
3 QJLUCL
         SUBROUTINE QJLUCL (NJETS,CNAM,ICLASS,MINCLU,DMAX1,DMAX2,MULSYM,
  ------------------------------------------------------------------------------
    CKEY JETS /USER
  ------------------------------------------------------------------------------
        &                   TGEN,DMIN)
     Author   : P. Perez       20-APR-1989
     Description
     ===========
   Set up and call qglucl jet finding routine. (luclus)
    input:
           MINCLU min. # of clusters to be reconstructed
                   (if <0, work space momenta are used as a start)
                   (usually=1)
           DMAX1 max. distance to form starting clusters(usually=0.25GeV)
           DMAX2  "      "     to join 2 clusters       (usually=2.5 GeV)
           MULSYM = 1 for symmetric distance criterion (usual)
                  = 2  "  multicity    "
    NJET number of reconstructed jets
                = -1 if not enough particles
                = -2 not enough working space (KTBOMX
           TGEN generalized thrust
           DMIN minimum distance between 2 jets
                = 0  when only 1 jet
                = -1 , -2 as for NJET
           QCTBUF.INC contains jet momenta and track-jet association
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
              QJLUCL                                                               
                   |----  QJSETU                                                   
                   |----  QGLUCL                                                   
                   |----  QJSAVE                                                   
   
 
3 QJMDCL
         SUBROUTINE QJMDCL (NJETS,CNAM,ICLASS,ALPHA,DELTA,ETA,EVIS)
  ------------------------------------------------------------------------------
    CKEY JETS /USER
  ------------------------------------------------------------------------------
     Author   : P. Perez       28-MAR-1989
     Description
     ===========
   Set up and call qgmdcl jet finding routine.
    input   : ALPHA           weight
              DELTA           half opening angle (degrees)
              ETA             energy cut-off for jets(in units of Evis)
              EVIS            visible energy
             (if EVIS=0., it is computed from the input part. energies)
     output: NJETS and QCTBUF.INC
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
              QJMDCL                                                               
                   |----  QJSETU                                                   
                   |----  QGMDCL                                                   
                   |----  QJSAVE                                                   
   
 
3 QJMISS
         SUBROUTINE QJMISS (PSUM,CNAM,ICLASS,ITKTOT)
  ------------------------------------------------------------------------------
    CKEY SHAPE /USER
  ------------------------------------------------------------------------------
   Missing e,p,m
                                                      H.Albrecht 22.2.89
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
              QJMISS                                                               
                   |----  QJSET0                                                   
                   |----  KTBIT                               External             
                   |----  SQRT                                External             
                   |----  AMAX1                               External             
                   |----  QJSAVE                                                   
   
 
3 QJMMCL
         SUBROUTINE QJMMCL (NJETS,CNAM,ICLASS,YCUT,EVIS)
  ------------------------------------------------------------------------------
    CKEY ALPHA JETS /USER
  ------------------------------------------------------------------------------
     Author   : P. Perez       28-MAR-1989
     Modified : C. Bowdery      5-OCT-1990
     Modified : C. Bowdery     18-APR-1991 to use the E scheme explicitly
     Modified : C. Bowdery     28-APR-1991 to use the NORMAL algorithm
     Modified : C. Bowdery     18-OCT-1991 to call QGJMMC
     Description
     ===========
   Call qgjmmc, the improved, generalised jade algorithm jet finder
      with the arguments set to 'E' scheme and normal JADE algorithm.
    Input   : CNAM            the name to be used for the jet 'particles'
              ICLASS          KRECO or KMONTE
              YCUT            YCUT value ( (M/EVIS)**2 )
              EVIS            visible energy for normalisation
                              (if EVIS=0., it is computed from the
                               input particle energies)
    Output  : NJETS           number of jets found or error code if -ve
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   JETCLU                                                                          
   QSELEP                                                                          
   QVSJET                                                                          
        |---- QJMMCL                                                               
                   |----  QGJMMC                                                   
   
 
3 QJOPTM
         SUBROUTINE QJOPTM (COPT,CADD)
  ------------------------------------------------------------------------------
    CKEY SHAPE JETS MC /USER
  ------------------------------------------------------------------------------
   Options for qj routines (mc particles)
                                                      H.Albrecht 22.2.89
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
              QJOPTM                                                               
                   |----  QMTERM                                                   
                   |----  KPART                                                    
   
 
3 QJOPTR
         SUBROUTINE QJOPTR (COPT,CADD)
  ------------------------------------------------------------------------------
    CKEY SHAPE JETS /USER
  ------------------------------------------------------------------------------
   Options for qj routines (reconstructed particles)
                                                      H.Albrecht 22.2.89
                                      Modified:       E.Blucher  30.1.92
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   MINALGO                                                                         
   JETCLU                                                                          
   QIPBTAG                                                                         
   QSELEP                                                                          
   QVSJET                                                                          
        |---- QJOPTR                                                               
                   |----  QMTERM                                                   
                   |----  KPART                                                    
   
 
3 QJPTCL
         SUBROUTINE QJPTCL  (NJETS, CNAM, ICLASS ,NJTLIM,YJTLIM , EVIS)
  ------------------------------------------------------------------------------
    CKEY JETS /USER
  ------------------------------------------------------------------------------
   Calls qgptcl: ptclus jet algorithm (see aleph 89-150).
   
      Author   :- MIKE SCARR Glasgow University
   
      Modified :- John Hearns           31-Aug-1989
                - Ingrid ten Have        8-Oct-1989
   
      Inputs:
           -   ICLASS  =  class of ALPHA particles to work on
           -   NJTLIM  =  the least number of jets to search for.
                          If NJTLIM = 0 the algorithm finds the number
                          of jets determined by YJTLIM.
                          but is you want to force say 3-jet events
                          set NJTLIM to 3 and YJTLIM to a very high value
           -   YJTLIM =   maximum allowed distance between two clusters
                          in (invariant mass divided by the
                          visible energy)**2 space
                          a  range for YJTLIM is 0.01 - 0.1
                          Recommended values are 0.01-0.02 yielding a
                          high resolution
           -   EVIS   =   can be set to the required value by the user.
                          if it is set to zero on input then
                          EVIS is replaced by the visible energy in the
                          event
                       *! EVIS is  IGNORED if LSCALE is set to FALSE
                              in the routine QGPTCL *!
   
      Outputs:
           -   NJETS - number of jets found
                        set to negative number if error condition
           -   THRUST  =  GENERALISED THRUST.
   
      Libraries required:
   
      Description
      ===========
      SET UP AND  CALL THE JET FINDING ROUTINE QGPTCL (PTCLUS)
      written by Mike Scarr of Glasgow University
      uses QCTBUF.INC and  the common variables therein
   
      ps---
        ALSO COULD OUTPUT IF WANTED :
           -   THRUST  =  GENERALISED THRUST.
        but I want to keep calling sequence same as other ALPHA jetfinder
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
              QJPTCL                                                               
                   |----  QJSETU                                                   
                   |----  QGPTCL                                                   
                   |----  QJSAVE                                                   
   
 
3 QJSAVE
         SUBROUTINE QJSAVE (CNAM,NTB,ICLASS,IDR,IRE,IAL)
  ------------------------------------------------------------------------------
    CKEY JETS SHAPE /INTERNAL
  ------------------------------------------------------------------------------
   Save vector from topological buffer qctbuf with name cnam.
    NTB : output buffer number in QCTBUF.
    ICL : sequential class number.
    IDR = 0 : drop existing particles.
    IRE = 0 : no moth/dau relation.
    IAL = 0 : all particles contribute to CNAM.
                                                      H.Albrecht 22.2.89
                                     Modified:        E.Blucher  27.9.91
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   QGJMMC                                                                          
   QJADDP                                                                          
   QJEIG                                                                           
   QJHEMI                                                                          
   QJLUCL                                                                          
   QJMDCL                                                                          
   QJMISS                                                                          
   QJPTCL                                                                          
   QJSPHE                                                                          
   QJTENS                                                                          
   QJTHRU                                                                          
        |---- QJSAVE                                                               
                   |----  KTBIT                               External             
                   |----  KSCOLD                                                   
                   |----  QSBANK                                                   
                   |----  QTBOX                               External             
                   |----  QTBOY                               External             
                   |----  QTBOZ                               External             
                   |----  QTBOE                               External             
                   |----  KPART                                                    
                   |----  KFPADR                                                   
                   |----  IAND                                External             
                   |----  QWMESE                                                   
                   |----  QVDROA                                                   
                   |----  IOR                                 External             
                   |----  KCLARM                              External             
                   |----  KTBOF                               External             
                   |----  QADAU                                                    
   
 
3 QJSET0
         SUBROUTINE QJSET0 (ICLASS)
  ------------------------------------------------------------------------------
    CKEY JETS SHAPE /INTERNAL
  ------------------------------------------------------------------------------
   Standard set-up for qj routines : get numbers
                                            Author: H.Albrecht 22.2.89
                                          Modified: E.Blucher  22.6.89
                                          Modified: E.Blucher  28.9.91
                                          Modified: E.Blucher  01.2.92
    Completely rewritten to avoid ASSIGN statements J.Boucrot  24.9.93
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   QTCLAS                                                                          
   QJADDP                                                                          
   QJHEMI                                                                          
   QJMISS                                                                          
   QJSETU                                                                          
        |---- QJSET0                                                               
                   |----  SIGN                                External             
                   |----  SQRT                                External             
                   |----  ABS                                 External             
                   |----  NINT                                External             
                   |----  KMATIX                              External             
                   |----  ATG                                 External             
                   |----  KCLARM                              External             
                   |----  IAND                                External             
                   |----  KLOCK0                              External             
                   |----  IABS                                External             
                   |----  KSCOLD                                                   
                   |----  KJOPTN                              External             
                   |----  QJSET1                                                   
                   |----  QMTERM                                                   
   
 
3 QJSET1
         SUBROUTINE QJSET1 (IRM,N1,N2,ICL,IJMP)
  ------------------------------------------------------------------------------
    CKEY JETS SHAPE /INTERNAL
  ------------------------------------------------------------------------------
   Auxiliary to qjset0
                                            Author: J.Boucrot  24.9.93
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   QJSET0                                                                          
        |---- QJSET1                                                               
                   |----  SIGN                                External             
                   |----  SQRT                                External             
                   |----  ABS                                 External             
                   |----  NINT                                External             
                   |----  KMATIX                              External             
                   |----  ATG                                 External             
                   |----  KCLARM                              External             
                   |----  IAND                                External             
                   |----  KLOCK0                              External             
                   |----  IABS                                External             
                   |----  QMTERM                                                   
   
 
3 QJSETU
         SUBROUTINE QJSETU (ICLASS)
  ------------------------------------------------------------------------------
    CKEY JETS SHAPE /USER
  ------------------------------------------------------------------------------
   Standard set-up for qj routines
                                                      H.Albrecht 22.2.89
                                   Modified:          E.Blucher  28.9.91
                                   Modified:          E.Blucher  30.1.92
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   QGJMMC                                                                          
   QJEIG                                                                           
   QJFOXW                                                                          
   QJLUCL                                                                          
   QJMDCL                                                                          
   QJPTCL                                                                          
   QJSPHE                                                                          
   QJTENS                                                                          
   QJTHRU                                                                          
        |---- QJSETU                                                               
                   |----  QJSET0                                                   
                   |----  KTBIT                               External             
   
 
3 QJSPHE
         SUBROUTINE QJSPHE (SPHER,CNAM,ICLASS)
  ------------------------------------------------------------------------------
    CKEY SHAPE /USER
  ------------------------------------------------------------------------------
     Author   : E. Blucher     27-FEB-1989
     Description
     ===========
   Set up and call sphericity routine.
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
              QJSPHE                                                               
                   |----  QJSETU                                                   
                   |----  QGSPHE                                                   
                   |----  QTBOR                               External             
                   |----  QJSAVE                                                   
   
 
3 QJTENS
         SUBROUTINE QJTENS(EVAL,CNAM,ICLASS)
  ------------------------------------------------------------------------------
    CKEY SHAPE /USER
  ------------------------------------------------------------------------------
     Author   : E. Blucher     30-JUN-1989
     Description
     ===========
   Set up and call routine to calculate normalized momentum tensor.
     KPDIR(CNAM,ICLASS) = major axis (sphericity axis)
     KFOLLO (...) = semi-major axis
     KFOLLO (...) = minor axis
     EVAL(1,2,3) = eigenvalues in descending order
           sphericity = 1.5*(1-EVAL(1))
           aplanarity = 1.5*EVAL(3)
           planarity = EVAL(3)/EVAL(2)
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
              QJTENS                                                               
                   |----  QJSETU                                                   
                   |----  QGTENS                                                   
                   |----  QTBOR                               External             
                   |----  KSCOLD                                                   
                   |----  QJSAVE                                                   
   
 
3 QJTHRU
         SUBROUTINE QJTHRU (THRU,CNAM,ICLASS)
  ------------------------------------------------------------------------------
    CKEY SHAPE /USER
  ------------------------------------------------------------------------------
   Thrust
                                                      H.Albrecht 22.2.89
    Modified for QMTHRU                               J.Boucrot 18.10.94
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   MINALGO                                                                         
   QIPBTAG                                                                         
        |---- QJTHRU                                                               
                   |----  IW                                  External             
                   |----  NAMIND                              External             
                   |----  QMTHRU                                                   
                   |----  QJSETU                                                   
                   |----  QGTHRU                                                   
                   |----  QTBOR                               External             
                   |----  QJSAVE                                                   
   
 
3 QKBLOK
         FUNCTION QKBLOK(IRUN,BG,Q)
  ------------------------------------------------------------------------------
    CKEY DEDX /INTERNAL
  ------------------------------------------------------------------------------
   Bethe-bloch parameterization of tpc de/dx which always uses the
    parameterization for data (run 6001) regardless of current run
    number (this is to be used for MC simulation).
   
      Created by Robert P. Johnson     22-AUG-1988
   
      Inputs    : IRUN      /I      Run number for calibration constants
                  BG        /R      beta*gamma
                  Q         /R      particle charge
      Outputs   : QKBLOK    /R      dE/dx with minion=1.0
                                    Set to zero if Q=0 or if the
                                    calibration cannot be found.
   
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   NADDXM                                                                          
   NMTAIL                                                                          
   QDEDXK                                                                          
   QDEDXM                                                                          
   QMTAIL                                                                          
        |---- QKBLOK                                                               
                   |----  NDANR                               External             
                   |----  JUNIDB                              External             
                   |----  QMTERM                                                   
                   |----  MDARD                               External             
                   |----  NDROP                               External             
                   |----  ALOG                                External             
                   |----  SQRT                                External             
   
 
3 QKINKT
         SUBROUTINE QKINKT(NKINK,LISKI)
  ------------------------------------------------------------------------------
    CKEY USER VERTEX
  ------------------------------------------------------------------------------
   Gets alpha "track" list for tracks ending in a kink vertex
   
      Author   :- J. Boucrot                    21-Apr-1997
      Output arguments
        NKINK = number of reconstructed charged tracks with a kink
        LISKI = list of ALPHA track numbers ( 50 maximum )
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   QWNEWTR                                                                         
        |---- QKINKT                                                               
                   |----  SIGN                                External             
                   |----  SQRT                                External             
                   |----  ABS                                 External             
                   |----  NINT                                External             
                   |----  KMATIX                              External             
                   |----  ATG                                 External             
                   |----  KCLARM                              External             
                   |----  IAND                                External             
                   |----  KLOCK0                              External             
                   |----  IABS                                External             
                   |----  VZERO                               External             
   
 
3 QKINKV
         SUBROUTINE QKINKV(KFKIV,KLKIV)
  ------------------------------------------------------------------------------
    CKEY USER VERTEX
  ------------------------------------------------------------------------------
   Gets vertex numbers for kinks for new tracking
   
      Author   :- J. Boucrot                    21-Apr-1997
      Output arguments
        KFKIV,KLKIV : first and last kink vertex number
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   QWNEWTR                                                                         
        |---- QKINKV                                                               
                   |----  SIGN                                External             
                   |----  SQRT                                External             
                   |----  ABS                                 External             
                   |----  NINT                                External             
                   |----  KMATIX                              External             
                   |----  ATG                                 External             
                   |----  KCLARM                              External             
                   |----  IAND                                External             
                   |----  KLOCK0                              External             
                   |----  IABS                                External             
                   |----  MIN0                                External             
                   |----  MAX0                                External             
   
 
3 QLITK
         SUBROUTINE QLITK (ITK)
  ------------------------------------------------------------------------------
    CKEY LOCK /USER
  ------------------------------------------------------------------------------
   Set lock flag for track itk.
    from user routines
                                                     H.Albrecht 27.11.88
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
              QLITK                                                                
                   |----  QWMESS                                                   
   
 
3 QLOCK
         SUBROUTINE QLOCK (ITK)
  ------------------------------------------------------------------------------
    CKEY LOCK /USER
  ------------------------------------------------------------------------------
   Lock track itk.
    from user routines
                                                     H.Albrecht 27.11.88
                                           Modified: E.Blucher  01.08.90
                                           Modified: E.Blucher  03.02.93
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
              QLOCK                                                                
                   |----  SIGN                                External             
                   |----  SQRT                                External             
                   |----  ABS                                 External             
                   |----  NINT                                External             
                   |----  KMATIX                              External             
                   |----  ATG                                 External             
                   |----  KCLARM                              External             
                   |----  IAND                                External             
                   |----  KLOCK0                              External             
                   |----  IABS                                External             
                   |----  QWMESE                                                   
                   |----  IOR                                 External             
                   |----  KLOCK2                              External             
   
 
3 QLOCK2
         SUBROUTINE QLOCK2 (ITK)
  ------------------------------------------------------------------------------
    CKEY LOCK /USER
  ------------------------------------------------------------------------------
   Lock track itk.
    from user routines
                                                     H.Albrecht 27.11.88
                                           Modified: E.Blucher  01.08.90
                                           Modified: E.Blucher  03.02.93
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
              QLOCK2                                                               
                   |----  SIGN                                External             
                   |----  SQRT                                External             
                   |----  ABS                                 External             
                   |----  NINT                                External             
                   |----  KMATIX                              External             
                   |----  ATG                                 External             
                   |----  KCLARM                              External             
                   |----  IAND                                External             
                   |----  KLOCK0                              External             
                   |----  IABS                                External             
                   |----  QWMESE                                                   
                   |----  IOR                                 External             
                   |----  KLOCK1                              External             
   
 
3 QLREV
         SUBROUTINE QLREV (IFLAG)
  ------------------------------------------------------------------------------
    CKEY LOCK /USER
  ------------------------------------------------------------------------------
   Locked tracks -> unlocked tracks and vice versa
    from user routines
                                                     H.Albrecht 27.11.88
                                           Modified: E.Blucher  01.08.90
                                           Modified: E.Blucher  03.02.93
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
              QLREV                                                                
                   |----  NOT                                 External             
                   |----  IOR                                 External             
                   |----  KLOCK2                              External             
   
 
3 QLREV2
         SUBROUTINE QLREV2 (IFLAG)
  ------------------------------------------------------------------------------
    CKEY LOCK /USER
  ------------------------------------------------------------------------------
   Locked tracks -> unlocked tracks and vice versa
    from user routines
                                                     H.Albrecht 27.11.88
                                           Modified: E.Blucher  01.08.90
                                           Modified: E.Blucher  03.02.93
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
              QLREV2                                                               
                   |----  NOT                                 External             
                   |----  IOR                                 External             
                   |----  KLOCK1                              External             
   
 
3 QLTRK
         SUBROUTINE QLTRK (ITK)
  ------------------------------------------------------------------------------
    CKEY LOCK /USER
  ------------------------------------------------------------------------------
   Set lock flag for track itk.
    from user routines
                                                     H.Albrecht 27.11.88
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   GAMIXED                                                                         
   LUMIAD                                                                          
   PARTID                                                                          
   PRESEL                                                                          
   PRESELFW                                                                        
   V0SUM                                                                           
   QSELEP                                                                          
        |---- QLTRK .                                                              
   
 
3 QLUITK
         SUBROUTINE QLUITK (ITK)
  ------------------------------------------------------------------------------
    CKEY LOCK /USER
  ------------------------------------------------------------------------------
   Reset lock flag for track itk.
    from user routines
                                                     H.Albrecht 27.11.88
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
              QLUITK.                                                              
   
 
3 QLUTRK
         SUBROUTINE QLUTRK (ITK)
  ------------------------------------------------------------------------------
    CKEY LOCK /USER
  ------------------------------------------------------------------------------
   Set lock flag for track itk.
    from user routines
                                                     H.Albrecht 27.11.88
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   DLOCKS                                                                          
   QSELEP                                                                          
        |---- QLUTRK.                                                              
   
 
3 QLV0T
         SUBROUTINE QLV0T(KFLVT,KLLVT)
  ------------------------------------------------------------------------------
    CKEY USER VERTEX
  ------------------------------------------------------------------------------
   Gets alpha "track" limits for long v0s for new tracking
   
      Author   :- J. Boucrot                    21-Apr-1997
      Output arguments
        KFLVT,KLLVT : first and last Long V0 "track" number
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   QWNEWTR                                                                         
        |---- QLV0T                                                                
                   |----  SIGN                                External             
                   |----  SQRT                                External             
                   |----  ABS                                 External             
                   |----  NINT                                External             
                   |----  KMATIX                              External             
                   |----  ATG                                 External             
                   |----  KCLARM                              External             
                   |----  IAND                                External             
                   |----  KLOCK0                              External             
                   |----  IABS                                External             
                   |----  MIN0                                External             
                   |----  MAX0                                External             
   
 
3 QLV0V
         SUBROUTINE QLV0V(KFLV0,KLLV0)
  ------------------------------------------------------------------------------
    CKEY USER VERTEX
  ------------------------------------------------------------------------------
   Gets vertex numbers for long v0s for new tracking
   
      Author   :- J. Boucrot                    21-Apr-1997
      Output arguments
        KFLV0,KLLV0 : first and last Long V0 vertex number
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   QWNEWTR                                                                         
        |---- QLV0V                                                                
                   |----  SIGN                                External             
                   |----  SQRT                                External             
                   |----  ABS                                 External             
                   |----  NINT                                External             
                   |----  KMATIX                              External             
                   |----  ATG                                 External             
                   |----  KCLARM                              External             
                   |----  IAND                                External             
                   |----  KLOCK0                              External             
                   |----  IABS                                External             
                   |----  MIN0                                External             
                   |----  MAX0                                External             
   
 
3 QLZER
         SUBROUTINE QLZER (IFLAG)
  ------------------------------------------------------------------------------
    CKEY LOCK /USER
  ------------------------------------------------------------------------------
   Reset lock for reco (ifl=1) or mc (ifl=2)
    from user routines
                                                     H.Albrecht 27.11.88
                                           Modified: E.Blucher  01.08.90
                                           Modified: E.Blucher  03.02.93
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   DLOCKS                                                                          
   QSELEP                                                                          
        |---- QLZER                                                                
                   |----  KLOCK2                              External             
   
 
3 QLZER2
         SUBROUTINE QLZER2 (IFLAG)
  ------------------------------------------------------------------------------
    CKEY LOCK /USER
  ------------------------------------------------------------------------------
   Reset lock for reco (ifl=1) or mc (ifl=2)
    from user routines
                                                     H.Albrecht 27.11.88
                                           Modified: E.Blucher  01.08.90
                                           Modified: E.Blucher  03.02.93
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
              QLZER2                                                               
                   |----  KLOCK1                              External             
   
 
3 QMASV0
         FUNCTION QMASV0(I,CINP)
  ------------------------------------------------------------------------------
    CKEY V0 KINEMATICS /USER
  ------------------------------------------------------------------------------
   Calculate v0 invariant mass from r and b parameters (see aleph 88-46)
    For gamma conversions, calculate invariant mass of daughters.
     Author   : E. Blucher            19-APR-1989
     Inputs:
       I =  ALPHA V0 track number
       CINP = V0 particle name:
              GAMMA OR GA
              K0s or K0
              LAM0 or LA
              LAM#0 or AL
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
              QMASV0                                                               
                   |----  SIGN                                External             
                   |----  SQRT                                External             
                   |----  ABS                                 External             
                   |----  NINT                                External             
                   |----  KMATIX                              External             
                   |----  ATG                                 External             
                   |----  KCLARM                              External             
                   |----  IAND                                External             
                   |----  KLOCK0                              External             
                   |----  IABS                                External             
                   |----  KPCOMP                                                   
                   |----  SPACES                              External             
                   |----  CLTOU                               External             
                   |----  QVSETM                                                   
                   |----  QWMESS                                                   
   
 
3 QMTHRU
         SUBROUTINE QMTHRU
  ------------------------------------------------------------------------------
    CKEY SHAPE /INTERNAL
  ------------------------------------------------------------------------------
   Get pre-calculated thrust from bank 'pthr'
                                                      J.Boucrot 18.10.94
    Called from QJTHRU
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   QJTHRU                                                                          
        |---- QMTHRU.                                                              
   
 
3 QMUIDO
         SUBROUTINE QMUIDO(ITK,IRUN,IBE,IBT,IM1,IM2,NEXP,NFIR,N10,N03,
  ------------------------------------------------------------------------------
    CKEY MUON /USER
  ------------------------------------------------------------------------------
        &  XMULT,RAPP,ANG,ISHAD,SUDNT,IDF,IMCF,IER)
   Get the muon id information from the banks mcad,hmad,muid
   
       Author    - G.Taylor              15-MAY-1992
   
       Inputs  :  ITRAC /I = Track number in FRFT bank
       Outputs :  IRUN  /I = (=0)
                  IBE   /I = Expected HCAL bit map
                  IBT   /I = Found HCAL bit map
                  IM1   /I = num hits in first layer of muon chambers
                  IM2   /I = num hits in first layer of muon chambers
                  NEXP  /I = num fired planes expected in hcal
                  NFIR  /I = num fired planes in hcal
                  N10   /I = num fired planes in last 10 expected
                  N03   /I = num fired planes in last 3 expected
                  XMULT /R = excess digital multiplicity in last 10
                              hcal planes
                  RAPP  /R = (dist/dcut) for closest muon chamber hit
                  ANG   /R = angle between shadowing track and muon
                             chamber track segment
                  ISHAD /R = shadowing flag (=0 if not shadowing,
                             otherwise is the JULIA track number which
                             it was shadowing)
                  SUDNT /R = sum of hcal residuals
                  IDF   /I = muon id flag (see bank MUID)
                  IMCF /I = Type of muon considered
                        0 : ambigous or data
                        1 : primary b
                        2 : secondary c
                        3 : primary c
                        4 : b to tau
                        5 : other muon
                        6 : non decaying hadron or electron
                        7 : decay hadron
                  IER   /I = (=0)
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   PARTID                                                                          
   REBUILD                                                                         
   QSELEP                                                                          
        |---- QMUIDO                                                               
                   |----  SIGN                                External             
                   |----  SQRT                                External             
                   |----  ABS                                 External             
                   |----  NINT                                External             
                   |----  KMATIX                              External             
                   |----  ATG                                 External             
                   |----  KCLARM                              External             
                   |----  IAND                                External             
                   |----  KLOCK0                              External             
                   |----  IABS                                External             
                   |----  NLINK                               External             
                   |----  MINQMU                                                   
                   |----  MMUIDF                                                   
                   |----  AMUID                               External             
                   |----  KBESTM                                                   
                   |----  KMLEPT                                                   
   
 
3 QMUNEW
         SUBROUTINE QMUNEW
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Initialize the muon identification
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   QMNEWR                                                                          
        |---- QMUNEW                                                               
                   |----  MUNEWRRETURN                        External             
   
 
3 QNUCL
         SUBROUTINE QNUCL(KFNIV,KLNIV)
  ------------------------------------------------------------------------------
    CKEY USER VERTEX
  ------------------------------------------------------------------------------
   Gets vertex numbers for nuclear interations for new tracking
   
      Author   :- J. Boucrot                    21-Apr-1997
      Output arguments
        KFNIV,KLNIV : first and last nuclear interaction vertex number
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   QWNEWTR                                                                         
        |---- QNUCL                                                                
                   |----  SIGN                                External             
                   |----  SQRT                                External             
                   |----  ABS                                 External             
                   |----  NINT                                External             
                   |----  KMATIX                              External             
                   |----  ATG                                 External             
                   |----  KCLARM                              External             
                   |----  IAND                                External             
                   |----  KLOCK0                              External             
                   |----  IABS                                External             
                   |----  MIN0                                External             
                   |----  MAX0                                External             
   
 
3 QPADX
         SUBROUTINE QPADX(ITK,N,RMASS,QH,RI,XNS,TL,RIEXP,SIGMA,IER)
  ------------------------------------------------------------------------------
    CKEY DEDX /USER
  ------------------------------------------------------------------------------
   De/dx analysis in alpha for pad de/dx
    ALPHA interface to the ALEPHLIB routine TIDHYP
    Author   :  D. Casper 14-06-95
       Input:   ITK      /I       ALPHA track number
                N        /I       Number of hypothesis to try
                RMASS(n) /R       Mass hypotheses
                QH(n)     /R       Charge hypotheses (sign doesn't matter
       Output:  RI       /R       Measured ionization (1.O=minion, Q=1)
                NS       /R       Number of useful wire samples on track
                TL       /T       Useful length of the track (cm)
                RIEXP(n) /R       Expected ionization for the given
                                  mass hypothesis (1.0=minion, Q=1)
                SIGMA(n) /R       Sigma of dE/dx measurement error,
                                  including the momentum error.
                                  Note that one can calculate a
                                  chi-squared with 1 d.o.f. as:
                                  chi2 = ((RI-RIEXP)/SIGMA)**2
                IER      /I       Error return= 0 for success
                                  1= can't find track bank or not
                                     a reconstructed charged track
                                  2= can't find dE/dx bank
                                  3= track has no dE/dx information
                                  4= can't find calibration banks
                                     TC1X, TC2X, TP3X and/or TC3X
                                  5= cannot find RUNH or EVEH bank
                                     from which to get the run number
                                  6= can't find TCSX,TCGX banks
                                  7= not supported on nano-dst
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   QDDX                                                                            
        |---- QPADX                                                                
                   |----  SIGN                                External             
                   |----  SQRT                                External             
                   |----  ABS                                 External             
                   |----  NINT                                External             
                   |----  KMATIX                              External             
                   |----  ATG                                 External             
                   |----  KCLARM                              External             
                   |----  IAND                                External             
                   |----  KLOCK0                              External             
                   |----  IABS                                External             
                   |----  KCHT                                                     
                   |----  TPDHYP                              External             
   
 
3 QPAIRF
         SUBROUTINE QPAIRF(I1,I2,DXY,DZ0,DZ2,DTH,RMA,ZMA,XMA,NC1,
  ------------------------------------------------------------------------------
    CKEY KINEMATICS /USER
  ------------------------------------------------------------------------------
        &                  DIN1,NC2,DIN2,P,IER)
     Author   : E. Blucher            22-APR-1989
     Modified : G. Graefe             22-APR-1994 input from NanoDst
     Description
     ===========
   Calls dave cinabro's pairfd routine.
    I1 = Alpha track number (in CHT section)
           I2 = Another ALPHA track (in CHT section)
    DXY = the distance(cm) in the xy plane at the closest approach
           DZ2 = the distance(cm) between the tracks in z at the xy point
           DZ0 = the distance(cm) between the tracks in z at the origin
           DTH = the theta difference of the two tracks
           RMA = the rho value at the average materialization point
           ZMA = the z value at the average materialization point
           XMA = the invariant mass of the tracks at the materializtion
                 point assuming they are both electrons
           NC1(2) = Number of coordinates with radius inside RMA for t
                    track 1(2).  0 if no coordinate information available
           DIN1(2) = Distance(cm) in radius that the furthest coordinate
                     is inside of RMA for track 1(2).  0. if no coordinat
                     information is available.
           P(3) = Summed momentum of the two tracks at the materializatio
                  point
           IER = 0 if all OK
                 1 if error in calculation
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   QSELEP                                                                          
        |---- QPAIRF                                                               
                   |----  SIGN                                External             
                   |----  SQRT                                External             
                   |----  ABS                                 External             
                   |----  NINT                                External             
                   |----  KMATIX                              External             
                   |----  ATG                                 External             
                   |----  KCLARM                              External             
                   |----  IAND                                External             
                   |----  KLOCK0                              External             
                   |----  IABS                                External             
                   |----  KCHT                                                     
                   |----  NAIRFD                                                   
                   |----  PAIRFD                              External             
                   |----  QWMESE                                                   
   
 
3 QPCORR
         FUNCTION QPCORR(ITRK,ASCALE,NVDET,ERCORR)
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Correct particle momenta for effects of residual distortions in
    the central tracking detector.
      This is the so called "sagitta correction".
    It depends upon cos(theta) and the year of data taking.
   
       Author   :  I.R. Tomalin
                   Based on subroutine QFBDEV written by I. ten Have.
       Date     :  10-3-1994
       Modified :  I.Tomalin 30/1/97.
                   Add LEP2 corrections and prepare move to ALEPHLIB.
                   G.Dissertori 9/8/99
                   Warnings are issued only for every new run number
                   and printed to standard output
   
    Input Arguments:
       ITRK    (Integer): ALPHA track number.
       ASCALE  (Logical): Set .TRUE. if ALPHA variables like QX,QY,QZ
                          are to be rescaled by calling QVSCAL.
                          N.B. Don't call this routine twice for the
                          same track with ASCALE = .TRUE. !
       NVDET   (Integer): If your analysis only uses tracks with at
                          least 1 VDET hit, set NVDET=1; otherwise =0.
       Also uses EVEH and FRFT banks.
    Output Arguments:
       QPCORR  (Real)   : Scale factor applied/to be applied to momentum.
       ERCORR  (Real)   : Statistical error on this factor.
    Calls:
       Function PPCORR (ALEPHLIB).
   
    Motivation:
      Every year, even after the detector alignment is finished and
    corrections have been made for field distortions etc., it is found
    that Ebeam/P in Z0 -> mu+mu- events is not precisely 1, presumably
    because of residual distortions.
      (Typically, in the region |cos(theta)| > 0.9, Ebeam/p is about 0.94
    for +ve tracks and 1.06 for -ve tracks. Elsewhere, Ebeam/p is usually
    consistent with 1 to within a percent or so. The effect is not quite
    forward-backward symmetric).
      The relative bias in momentum is proportional to P, so most people
    analysing hadronic events can ignore it. Exceptions include analyses
    using the ECAL electron identifiers in the region |cos(theta)| > 0.9,
    or analyses which are very sensitive to systematic biases in the
    momenta (e.g. jet charge, tau polarization).
      This routine provides a correction for the momenta based upon
    Ebeam/P measurements in Z0 -> mu+mu- events. It assumes that the
    corrections for -ve and +ve particles are equal in size, but of
    opposite sign. This is observed to be true, apart from a constant
    offset, Ebeam/p = 1.002, which is also present in the MC and so not
    corrected for.
      In principle, the correction depends upon your track selection
    cuts, but providing that the corrections have a small effect on your
    analysis, you can ignore this. Arguement NVDET does correct for this
    to first approximation however.
   
    If corrections are not up to date, please contact the tracking group.
         LOGICAL ASCALE
         DATA NWARN/0/
         DATA KRUNL/0/
         PARAMETER (MAXWAR=10)
   
   -------------------- /QCDE/ --- COMMONs, DIMENSIONs, etc. ------------
   
    of QCDESH ----------------------- Description in QDATA ---------
         PARAMETER (KCQDET=34, KCQFPA=8, KCQPAR=10, KCQVEC=73, KCQVRT=30,
        & KHE=1, KHMU=2, KHPI=3, KHK=4, KHP=5, KHPHOT=1, KHNHAD=2,
        & KMONTE=-2, KRECO=-1, KLOCKM=14, KSOVT=1, KSCHT=2, KSIST=3,
        & KSAST=4, KSEHT=5, KSV0T=6, KSDCT=7, KSEFT=8, KSNET=9, KSGAT=10,
        & KSJET=11, KSMCT=12, KSREV=13,
        & KSMCV=14, KUNDEF=-12344321, QQPI=3.141593, QQE=2.718282,
        & QQ2PI=QQPI*2., QQPIH=QQPI/2., QQRADP=180./QQPI, QQC=2.997925E10,
        & QQH=6.582173E-25, QQHC=QQH*QQC, QQIRP=.00029979)
         CHARACTER CQDATE*8, CQDWRK*80, CQFHIS*80, CQFOUT*80, CQFWRK*80,
        & CQHTIT*80, CQSEC*3, CQTIME*8, CQUNPK*30, CQVERS*6, CQRLST*800,
        & CQELST*800
         COMMON /QCDEC/ CQDATE, CQDWRK, CQFHIS, CQFOUT, CQFWRK, CQHTIT,
        & CQSEC(14), CQTIME, CQUNPK, CQVERS, CQRLST, CQELST
         COMMON /QCDE/ QELEP, QMFLD ,QMFLDC, QTIME, QTIMEI, QTIMEL,
        & QTIMES, QTIMET, QDHEEC, QDHEEL, QDHEPF, QDHETH, QDHEPH, QDHEEF,
        & QDHEET, QDHET1, QDHEP1, QDHET2, QDHEP2, QDHEE1, QDHEE2, QDHEE3,
        & QKEVRN, QKEVWT, QVXNOM, QVYNOM, QVZNOM, QVXNSG, QVYNSG, QVZNSG,
        & QINLUM, QRINLN, QRINLU, QDBOFS, QEECWI(36), QVXBOM, QVYBOM,
        & QSILUM, QRSLLU, QRSLBK, QRSLEW , QVTXBP(3), QVTEBP(3), QVTSBP(3)
         COMMON /QCDE/  KFOVT, KLOVT, KNOVT, KFCHT, KLCHT, KNCHT, KFIST,
        & KLIST, KNIST, KFAST, KLAST, KNAST, KFEHT, KLEHT, KNEHT, KFV0T,
        & KLV0T, KNV0T, KFDCT, KLDCT, KNDCT, KFEFT, KLEFT, KNEFT, KFNET,
        & KLNET, KNNET, KFGAT, KLGAT, KNGAT, KFJET, KLJET, KNJET, KFMCT,
        & KLMCT, KNMCT, KFREV, KLREV, KNREV, KFMCV, KLMCV, KNMCV, KLUST,
        & KLUSV, KFFRT, KLFRT, KFFRV, KLFRV, KNRET, KNCOT, KFFRD,
        & KLFJET,KLLJET,KLNJET
         COMMON /QCDE/ KBIT(32), KCLACO(KCQFPA), KCLAFR(KCQFPA), KCLARM
        & (KCQFPA), KDEBUG, KEVT, KEXP, KFFILL, KFEOUT, KJOPTN(2,2),
        & KLEOUT, KLROUT, KLOCK0(KLOCKM,2), KLOCK1(KLOCKM,2), KLOCK2(
        & KLOCKM,2), KMATIX(6,6), KMQFPA, KNEFIL, KNEOUT, KNEVT, KNPAST,
        & KNQDET, KNQFPA, KNQLIN, KNQMTX, KNQPAR, KNQPST, KNREIN, KNREOU,
        & KOQDET, KOQFPA, KOQLIN, KOQMTL, KOQMTS, KOQPAR, KOQPBT, KOQPLI,
        & KOQTRA, KOQVEC, KOQVRT, KQPAR, KQVEC, KQVRT, KQWRK, KQZER, KRUN,
        & KSTATU, KTDROP, KUCARD, KUCONS, KUHIST, KUINPU, KUOUTP, KUPRNT,
        & KUPTER, KDEBU1, KDEBU2, KNWRLM, KEFOPT, KUEDIN, KUEDOU, KURTOX,
        & KUCAR2, KNHDRN, KNBHAB, KSBHAB, KRSLLQ, KRSLNB
         COMMON /QCDE/ INDATA
         COMMON /QCDE/ KRINNE, KRINNF, KRINDC, KRINDQ, KRINNZ, KRINNB,
        & KRINBM, KRINFR, KRINLR, KRINLF
         COMMON /QCDE/ KEVERT, KEVEDA, KEVETI, KEVEMI(4), KEVETY, KEVEES,
        & KDHEFP, KDHENP, KDHENM, KKEVNT, KKEVNV, KKEVID, KDHENX, KDHENV,
        & KDHENJ, KREVDS, KXTET1, KXTET2, KXTEL2, KXTCGC, KXTCLL, KXTCBN,
        & KXTCCL, KXTCHV, KXTCEN, KCLASW, KERBOM, KBPSTA
         DIMENSION KLOCUS(3,14)
         EQUIVALENCE (KLOCUS(1,1),KFOVT), (KFOVT,KFRET), (KLIST,KLRET),
        & (KFIST,KFCOT), (KLAST,KLCOT)
         COMMON /QCDE/ XCOPYJ, XFLIAC, XHISTO, XLREV(2), XLREV2(2), XMCEV,
        & XMINI, XSYNTX, XWREVT, XWRRUN, XFILMC, XFILCH, XFILV0, XFILCO,
        & XFILEF, XFILPC, XFILGA, XFILJE,
        & XPRHIS, XFILL, XVITC, XVTPC, XVECAL, XVLCAL, XVTPCD,
        & XVSATR, XVHCAL, XHVTRG, XSREC, XWMINI, XIOKLU, XIOKSI, XFRF2,
        & XNSEQ, XVDOK, XFRF0, XFMUID, XFILEM, XWNANO, XROKSI, XGETBP,
        & XJTHRU
         LOGICAL XCOPYJ, XFLIAC, XHISTO, XLREV, XLREV2, XMCEV, XMINI,
        & XSYNTX, XWREVT, XWRRUN, XFILMC, XFILCH, XFILV0, XFILCO, XFILEF,
        & XFILPC, XPRHIS, XFILL, XVITC, XVTPC, XVECAL, XVLCAL, XVTPCD,
        & XVSATR, XVHCAL, XHVTRG, XSREC, XWMINI, XIOKLU, XFRF2, XFILJE,
        & XNSEQ, XFILGA, XVDOK, XFRF0, XFMUID, XFILEM, XWNANO, XIOKSI,
        & XROKSI, XGETBP, XJTHRU
   
   -------------------- /NANCOM/ --- NanoDst steering -------------------
    XNANO   .TRUE. if input is a NanoDst (in NANO or EPIO format, depending
                      XNANOR)
   
         LOGICAL XNANO
         COMMON /NANCOM/XNANO
   
   
    bcs
         INTEGER LMHLEN, LMHCOL, LMHROW
         PARAMETER (LMHLEN=2, LMHCOL=1, LMHROW=2)
         COMMON /BCS/   IW(1000)
         INTEGER IW
         REAL RW(1000)
         EQUIVALENCE (RW(1),IW(1))
   
   
   ------------------ /QCNAMI/ --- name indices -------------------------
         COMMON /QCNAMI/ NAAFID,NAAJOB,NAASEV,NABCNT,NABHIT,NABOMB,
        1 NABOME,NABOMP,NABOMR,NABPTR,NADCAL,NADCRL,NADECO,NADEID,NADENF,
        2 NADEVT,NADEWI,NADFMC,NADFOT,NADGAM,NADHCO,NADHEA,NADHRL,NADJET,
        3 NADMID,NADMJT,NADMUO,NADNEU,NADPOB,NADRES,NADTBP,NADTMC,NADTRA,
        4 NADVER,NADVMC,NAECRQ,NAECTE,NAEGID,NAEGPC,NAEIDT,NAEJET,NAERRF,
        5 NAETDI,NAETKC,NAEVEH,NAEWHE,NAFICL,NAFKIN,NAFPOI,NAFPOL,NAFRFT,
        6 NAFRID,NAFRTL,NAFSTR,NAFTCL,NAFTCM,NAFTOC,NAFTTM,NAFVCL,NAFVER,
        7 NAFZFR,NAHCCV,NAHCTE,NAHINF,NAHMAD,NAHPDI,NAHROA,NAHSDA,NAHTUB,
        8 NAIASL,NAIPJT,NAIRJT,NAITCO,NAITMA,NAIXTR,NAIZBD,NAJBER,NAJEST,
        9 NAJSUM,NAKEVH,NAKINE,NAKJOB,NAKLIN,NAKPOL,NAKRUN,NALIDT,NALOLE,
        A NALUPA,NAMCAD,NAMHIT,NAMTHR,NAMUDG,NAMUEX,NAOSTS,NAPART,NAPASL,
        B NAPCHY,NAPCOB,NAPCOI,NAPCPA,NAPCQA,NAPCRL,NAPECO,NAPEHY,NAPEID,
        C NAPEMH,NAPEPT,NAPEST,NAPEWI,NAPFER,NAPFHR,NAPFRF,NAPFRT,NAPHCO,
        D NAPHER,NAPHHY,NAPHMH,NAPHST,NAPIDI,NAPITM,NAPLID,NAPLPD,NAPLSD,
        E NAPMSK,NAPNEU,NAPPDS,NAPPOB,NAPPRL,NAPRTM,NAPSCO,NAPSPO,NAPSTR,
        F NAPT2X,NAPTBC,NAPTCO,NAPTEX,NAPTMA,NAPTML,NAPTNC,NAPTST,NAPVCO,
        G NAPYER,NAPYFR,NAPYNE,NAQDET,NAQFPA,NAQLIN,NAQMTL,NAQMTS,NAQPAR,
        H NAQPBT,NAQPLI,NAQTRA,NAQVEC,NAQVRT,NAQWRK,NAQZER,NAREVH,NARHAH,
        I NARTLO,NARTLS,NARUNH,NARUNR,NASFTR,NATEXS,NATGMA,NATMTL,NATPCO,
        J NAVCOM,NAVCPL,NAVDCO,NAVDHT,NAVDXY,NAVDZT,NAVERT,NAVFHL,NAVFLG,
        K NAVFPH,NAVHLS,NAVPLH,NAX1AD,NAX1SC,NAX1TI,NAX2DF,NAX3EC,NAX3EW,
        L NAX3HC,NAX3IT,NAX3L2,NAX3LU,NAX3TM,NAX3TO,NAX3TP,NAX3X3,NAXTBN,
        M NAXTBP,NAXTCN,NAXTEB,NAXTOP,NAXTRB,NAYV0V,NAZPFR,NAEFOL,NAMUID,
        N NAPGID,NAPGPC,NAPGAC,NAPMSC,NAPTHR,NANBIP,NAPDLT,NAPMLT,NAPLJT
   
   
   ------------------ /QQQQJJ/ --- HAC parameters for ALPHA banks -------
         PARAMETER (JQVEQX= 1,JQVEQY= 2,JQVEQZ= 3,JQVEQE= 4,JQVEQM= 5,
        & JQVEQP= 6,JQVECH= 7,JQVETN= 8,JQVESC= 9,JQVEKS=10,JQVECL=11,
        & JQVEPA=12,JQVEQD=13,JQVENP=14,JQVESP=15,JQVEOV=16,JQVEEV=17,
        & JQVEND=18,JQVEDL=19,JQVENO=20,JQVEOL=21,JQVENM=22,JQVEML=23,
        & JQVEBM=24,JQVELK=38,JQVEDB=39,JQVEZB=40,JQVESD=41,JQVESZ=42,
        & JQVECB=43,JQVEEM=44,JQVECF=54,JQVEEW=55,JQVEUS=56)
         PARAMETER ( JQVRVX=1,JQVRVY=2,JQVRVZ=3,JQVRVN=4,JQVRTY=5,
        1   JQVRIP=6,JQVRND=7,JQVRDL=8,JQVRAY=9,JQVRAF=10,JQVREM=11,
        2   JQVRCF=17,JQVRET=18)
         PARAMETER ( JQDEAF= 1,JQDEAL= 2,JQDENT= 3,JQDEAT= 4,JQDELT= 8,
        &  JQDEAE= 9,JQDEAH=10,JQDEAM=11,JQDECF=12,JQDEEC=13,JQDEHC=14,
        &  JQDEET=15,JQDEFI=16,JQDENF=17,JQDEFL=18,JQDENE=19,JQDEEL=20,
        &  JQDENH=21,JQDEHL=22,JQDELH=23,JQDEEF=24,JQDEPC=25,JQDEEG=26,
        &  JQDEMU=27,JQDEDX=28,JQDEPG=29,JQDEPD=30,JQDEPM=31)
         PARAMETER ( JQPAGN=1, JQPANA=2, JQPACO=5, JQPAMA=6, JQPACH=7,
        & JQPALT=8,JQPAWI=9,JQPAAN=10)
   
   
         EXTERNAL CQPART, CQTPN, XCEQAN, XLUMOK, XPEQAN, XPEQOR, XPEQU,
        & XVDEOK, LLUMOK, SLUMOK
         CHARACTER * 12 CQPART, CQTPN
         LOGICAL XCAL, XCEQAN, XCEQOR, XCEQU, XECAL, XEID, XFRF, XHCAL,
        & XHMA, XLOCK, XLOCKN, XMC, XLUMOK, XMCA, XPEO, XPHO, XPEQAN,
        & XPEQOR, XPEQU, XSAME, XSIG, XTEX, XPEC, XPEP, XPHC, XYV0,
        & XFRIQF, XEFO, XPCQ, XEGP, XMUI, XVDEOK, XPGP, LLUMOK, SLUMOK,
        & XPGAC, XLEPTG, XLEPTH
   
    alcons
    define universal constants
         REAL PI, TWOPI, PIBY2, PIBY3, PIBY4, PIBY6, PIBY8, PIBY12
         REAL RADEG, DEGRA
         REAL CLGHT, ALDEDX
         PARAMETER (PI=3.141592653589)
         PARAMETER (RADEG=180./PI, DEGRA=PI/180.)
         PARAMETER (TWOPI = 2.*PI , PIBY2 = PI/2., PIBY4 = PI/4.)
         PARAMETER (PIBY6 = PI/6. , PIBY8 = PI/8.)
         PARAMETER (PIBY12= PI/12., PIBY3 = PI/3.)
         PARAMETER (CLGHT = 29.9792458, ALDEDX = 0.000307)
   
         ALDEDX  = constant used in the computation of DEDX in GeV
         CLGHT   = speed of light in cm/nsec
   
   
   
    efoljj
         INTEGER JEFOPX,JEFOPY,JEFOPZ,JEFOEW,JEFOWE,JEFOTY,JEFOLE,JEFOLT,
        +          JEFOLH,JEFOLC,JEFOLJ,LEFOLA
         PARAMETER(JEFOPX=1,JEFOPY=2,JEFOPZ=3,JEFOEW=4,JEFOWE=5,JEFOTY=6,
        +          JEFOLE=7,JEFOLT=8,JEFOLH=9,JEFOLC=10,JEFOLJ=11,
        +          LEFOLA=11)
   
   
    egpcjj
         INTEGER JEGPPX,JEGPPY,JEGPPZ,JEGPR1,JEGPR2,JEGPF4,JEGPDM,JEGPST,
        +          JEGPQU,JEGPPE,LEGPCA
         PARAMETER(JEGPPX=1,JEGPPY=2,JEGPPZ=3,JEGPR1=4,JEGPR2=5,JEGPF4=6,
        +          JEGPDM=7,JEGPST=8,JEGPQU=9,JEGPPE=10,LEGPCA=10)
   
   
    eidtjj
         INTEGER JEIDIF,JEIDR1,JEIDR2,JEIDR3,JEIDR4,JEIDR5,JEIDR6,JEIDR7,
        +          JEIDEC,JEIDIP,JEIDE1,JEIDE2,JEIDE3,JEIDFR,JEIDPE,LEIDTA
         PARAMETER(JEIDIF=1,JEIDR1=2,JEIDR2=3,JEIDR3=4,JEIDR4=5,JEIDR5=6,
        +          JEIDR6=7,JEIDR7=8,JEIDEC=9,JEIDIP=10,JEIDE1=11,
        +          JEIDE2=12,JEIDE3=13,JEIDFR=14,JEIDPE=15,LEIDTA=15)
   
   
    frftjj
         INTEGER JFRFIR,JFRFTL,JFRFP0,JFRFD0,JFRFZ0,JFRFAL,JFRFEM,JFRFC2,
        +          JFRFDF,JFRFNO,LFRFTA
         PARAMETER(JFRFIR=1,JFRFTL=2,JFRFP0=3,JFRFD0=4,JFRFZ0=5,JFRFAL=6,
        +          JFRFEM=7,JFRFC2=28,JFRFDF=29,JFRFNO=30,LFRFTA=30)
   
   
    fridjj
         INTEGER JFRIBP,JFRIDZ,JFRIBC,JFRIDC,JFRIPE,JFRIPM,JFRIPI,JFRIPK,
        +          JFRIPP,JFRINK,JFRIQF,LFRIDA
         PARAMETER(JFRIBP=1,JFRIDZ=2,JFRIBC=3,JFRIDC=4,JFRIPE=5,JFRIPM=6,
        +          JFRIPI=7,JFRIPK=8,JFRIPP=9,JFRINK=10,JFRIQF=11,
        +          LFRIDA=11)
   
   
    frtljj
         INTEGER JFRTIV,JFRTNV,JFRTII,JFRTNI,JFRTNE,JFRTIT,JFRTNT,JFRTNR,
        +          LFRTLA
         PARAMETER(JFRTIV=1,JFRTNV=2,JFRTII=3,JFRTNI=4,JFRTNE=5,JFRTIT=6,
        +          JFRTNT=7,JFRTNR=8,LFRTLA=8)
   
   
    hmadjj
         INTEGER JHMANF,JHMANE,JHMANL,JHMAMH,JHMAIG,JHMAED,JHMACS,JHMAND,
        +          JHMAIE,JHMAIT,JHMAIF,JHMATN,LHMADA
         PARAMETER(JHMANF=1,JHMANE=2,JHMANL=3,JHMAMH=4,JHMAIG=5,JHMAED=6,
        +          JHMACS=7,JHMAND=8,JHMAIE=9,JHMAIT=10,JHMAIF=11,
        +          JHMATN=12,LHMADA=12)
   
   
    mcadjj
         INTEGER JMCANH,JMCADH,JMCADC,JMCAAM,JMCAAC,JMCATN,LMCADA
         PARAMETER(JMCANH=1,JMCADH=3,JMCADC=5,JMCAAM=7,JMCAAC=8,JMCATN=9,
        +          LMCADA=9)
   
   
    muidjj
         INTEGER JMUIIF,JMUISR,JMUIDM,JMUIST,JMUITN,LMUIDA
         PARAMETER(JMUIIF=1,JMUISR=2,JMUIDM=3,JMUIST=4,JMUITN=5,LMUIDA=5)
   
   
    pcqajj
         INTEGER JPCQNA,JPCQPX,JPCQPY,JPCQPZ,JPCQEN,LPCQAA
         PARAMETER(JPCQNA=1,JPCQPX=2,JPCQPY=3,JPCQPZ=4,JPCQEN=5,LPCQAA=5)
   
   
    pdltjj
         INTEGER JPDLPA,JPDLJT,JPDLPI,JPDLPE,JPDLVP,JPDLFR,LPDLTA
         PARAMETER(JPDLPA=1,JPDLJT=2,JPDLPI=3,JPDLPE=4,JPDLVP=5,JPDLFR=6,
        +          LPDLTA=6)
   
   
    pecojj
         INTEGER JPECER,JPECE1,JPECE2,JPECTH,JPECPH,JPECEC,JPECKD,JPECCC,
        +          JPECRB,JPECPC,LPECOA
         PARAMETER(JPECER=1,JPECE1=2,JPECE2=3,JPECTH=4,JPECPH=5,JPECEC=6,
        +          JPECKD=7,JPECCC=8,JPECRB=9,JPECPC=10,LPECOA=10)
   
   
    peptjj
         INTEGER JPEPT1,JPEPP1,JPEPT3,JPEPP3,LPEPTA
         PARAMETER(JPEPT1=1,JPEPP1=2,JPEPT3=3,JPEPP3=4,LPEPTA=4)
   
   
    pgacjj
         INTEGER JPGAEC,JPGATC,JPGAPC,JPGAR1,JPGAR2,JPGAF4,JPGADM,JPGAST,
        +          JPGAQU,JPGAQ1,JPGAQ2,JPGAM1,JPGAM2,JPGAMA,JPGAER,JPGATR,
        +          JPGAPR,JPGAEF,JPGAGC,JPGAZS,JPGAPL,JPGAPH,JPGAPN,JPGAFA,
        +          JPGAPE,LPGACA
         PARAMETER(JPGAEC=1,JPGATC=2,JPGAPC=3,JPGAR1=4,JPGAR2=5,JPGAF4=6,
        +          JPGADM=7,JPGAST=8,JPGAQU=9,JPGAQ1=10,JPGAQ2=11,
        +          JPGAM1=12,JPGAM2=13,JPGAMA=14,JPGAER=15,JPGATR=16,
        +          JPGAPR=17,JPGAEF=18,JPGAGC=19,JPGAZS=20,JPGAPL=21,
        +          JPGAPH=22,JPGAPN=23,JPGAFA=24,JPGAPE=25,LPGACA=25)
   
   
    pgpcjj
         INTEGER JPGPEC,JPGPTC,JPGPPC,JPGPR1,JPGPR2,JPGPF4,JPGPDM,JPGPST,
        +          JPGPQU,JPGPQ1,JPGPQ2,JPGPM1,JPGPM2,JPGPMA,JPGPER,JPGPTR,
        +          JPGPPR,JPGPPE,LPGPCA
         PARAMETER(JPGPEC=1,JPGPTC=2,JPGPPC=3,JPGPR1=4,JPGPR2=5,JPGPF4=6,
        +          JPGPDM=7,JPGPST=8,JPGPQU=9,JPGPQ1=10,JPGPQ2=11,
        +          JPGPM1=12,JPGPM2=13,JPGPMA=14,JPGPER=15,JPGPTR=16,
        +          JPGPPR=17,JPGPPE=18,LPGPCA=18)
   
   
    phcojj
         INTEGER JPHCER,JPHCTH,JPHCPH,JPHCEC,JPHCKD,JPHCCC,JPHCRB,JPHCNF,
        +          JPHCPC,LPHCOA
         PARAMETER(JPHCER=1,JPHCTH=2,JPHCPH=3,JPHCEC=4,JPHCKD=5,JPHCCC=6,
        +          JPHCRB=7,JPHCNF=8,JPHCPC=9,LPHCOA=9)
   
   
    pmltjj
         INTEGER JPMLFL,JPMLPO,JPMLCH,JPMLSP,JPMLLE,JPMLME,JPMLKT,JPMLFR,
        +          LPMLTA
         PARAMETER(JPMLFL=1,JPMLPO=2,JPMLCH=3,JPMLSP=4,JPMLLE=5,JPMLME=6,
        +          JPMLKT=7,JPMLFR=8,LPMLTA=8)
   
   
    texsjj
         INTEGER JTEXSI,JTEXTM,JTEXTL,JTEXNS,JTEXAD,JTEXTN,JTEXSF,LTEXSA
         PARAMETER(JTEXSI=1,JTEXTM=2,JTEXTL=3,JTEXNS=4,JTEXAD=5,JTEXTN=6,
        +          JTEXSF=7,LTEXSA=7)
   
   
    yv0vjj
         INTEGER JYV0K1,JYV0K2,JYV0VX,JYV0VY,JYV0VZ,JYV0VM,JYV0PX,JYV0PY,
        +          JYV0PZ,JYV0PM,JYV0X1,JYV0X2,JYV0XM,JYV0C2,JYV0IC,JYV0P1,
        +          JYV0P2,JYV0EP,JYV0DM,JYV0S1,JYV0S2,LYV0VA
         PARAMETER(JYV0K1=1,JYV0K2=2,JYV0VX=3,JYV0VY=4,JYV0VZ=5,JYV0VM=6,
        +          JYV0PX=12,JYV0PY=13,JYV0PZ=14,JYV0PM=15,JYV0X1=21,
        +          JYV0X2=22,JYV0XM=23,JYV0C2=26,JYV0IC=27,JYV0P1=28,
        +          JYV0P2=31,JYV0EP=34,JYV0DM=55,JYV0S1=56,JYV0S2=57,
        +          LYV0VA=57)
   
   
   
   -------------------- /QMACRO/ --- statement functions ----------------
   
    bmacro
       set of intrinsic functions to handle BOS banks
   - # of words/row in bank with index ID
         LCOLS(ID) = IW(ID+1)
   - # of rows in bank with index ID
         LROWS(ID) = IW(ID+2)
   - index of next row in the bank with index ID
         KNEXT(ID) = ID + LMHLEN + IW(ID+1)*IW(ID+2)
   - index of row # NRBOS in the bank with index ID
         KROW(ID,NRBOS) = ID + LMHLEN + IW(ID+1)*(NRBOS-1)
   - # of free words in the bank with index ID
         LFRWRD(ID) = ID + IW(ID) - KNEXT(ID)
   - # of free rows in the bank with index ID
         LFRROW(ID) = LFRWRD(ID) / LCOLS(ID)
   - Lth integer element of the NRBOSth row of the bank with index ID
         ITABL(ID,NRBOS,L) = IW(ID+LMHLEN+(NRBOS-1)*IW(ID+1)+L)
   - Lth real element of the NRBOSth row of the bank with index ID
         RTABL(ID,NRBOS,L) = RW(ID+LMHLEN+(NRBOS-1)*IW(ID+1)+L)
   
   -------------------- /QCFUNC/ --- statement functions for ALPHA banks
         KJQDET(KI)=IW(KOQVEC+KI*KCQVEC+JQVEQD)
         QSQT(QF)=SIGN(SQRT(ABS(QF)),QF)
         QP(KI)=RW(KOQVEC+KI*KCQVEC+JQVEQP)
         QX(KI)=RW(KOQVEC+KI*KCQVEC+JQVEQX)
         QY(KI)=RW(KOQVEC+KI*KCQVEC+JQVEQY)
         QZ(KI)=RW(KOQVEC+KI*KCQVEC+JQVEQZ)
         QE(KI)=RW(KOQVEC+KI*KCQVEC+JQVEQE)
         QM(KI)=RW(KOQVEC+KI*KCQVEC+JQVEQM)
         QCH(KI)=RW(KOQVEC+KI*KCQVEC+JQVECH)
         KCH(KI)=NINT (QCH(KI))
         QCT(KI)=QZ(KI)/QP(KI)
         QDB(KI)=RW(KOQVEC+KI*KCQVEC+JQVEDB)
         QZB(KI)=RW(KOQVEC+KI*KCQVEC+JQVEZB)
         QDBS2(KI)=RW(KOQVEC+KI*KCQVEC+JQVESD)
         QZBS2(KI)=RW(KOQVEC+KI*KCQVEC+JQVESZ)
         QBC2(KI)=RW(KOQVEC+KI*KCQVEC+JQVECB)
         QSIG(KI,KI1,KI2)=RW(KOQVEC+KI*KCQVEC+KMATIX(KI1,KI2)+JQVEEM)
         XSIG(KI)=RW(KOQVEC+KI*KCQVEC+JQVEEM).GE.0.
         QSMAT(KI,KI1)=RW(KOQVEC+KI*KCQVEC+KI1+JQVEEM)
         QSIGX(KI)=QSQT(QSMAT(KI,0))
         QSIGY(KI)=QSQT(QSMAT(KI,2))
         QSIGZ(KI)=QSQT(QSMAT(KI,5))
         QSIGEE(KI)=RW(KOQVEC+KI*KCQVEC+JQVEEM+9)
         QSIGE(KI)=QSQT(QSIGEE(KI))
         QSIGPP(KI)=(QX(KI)**2*QSMAT(KI,0)+QY(KI)**2*QSMAT(KI,2)+
        & QZ(KI)**2*QSMAT(KI,5)+2.*(QX(KI)*(QY(KI)*QSMAT(KI,1)+
        & QZ(KI)*QSMAT(KI,3))+QY(KI)*QZ(KI)*QSMAT(KI,4)))/QP(KI)**2
         QSIGP(KI)=QSQT(QSIGPP(KI))
         QSIGMM(KI)=QM(KI)*(QE(KI)**2*QSMAT(KI,9)+QX(KI)**2*QSMAT(KI,0)+
        & QY(KI)**2*QSMAT(KI,2)+QZ(KI)**2*QSMAT(KI,5)+2.*(QX(KI)*(QY(KI)
        & QSMAT(KI,1)+QZ(KI)*QSMAT(KI,3))+QY(KI)*QZ(KI)*QSMAT(KI,4)-
        & QE(KI)*(QX(KI)*QSMAT(KI,6)+QY(KI)*QSMAT(KI,7)+
        & QZ(KI)*QSMAT(KI,8))))/AMAX1(QM(KI)**3,1.E-16)
         QSIGM(KI)=QSQT(QSIGMM(KI))
         QMCHIF(KI)=RW(KOQVEC+KI*KCQVEC+JQVECF)
         QPH(KI)=ATG(QY(KI),QX(KI))
         QPT(KI)=SQRT(QX(KI)**2+QY(KI)**2)
         KTN(KI)=IW(KOQVEC+KI*KCQVEC+JQVETN)
         KMC(KI)=KCLARM(IW(KOQVEC+KI*KCQVEC+JQVECL))
         KBMASK(KI,KI1)=IW(KOQVEC+KI*KCQVEC+KI1+JQVEBM-1)
         KCALFL(KI)=IW(KJQDET(KI)+JQDECF)
         KCHGD(KI,KI1)=IW(KOQLIN+KI1+IW(KJQDET(KI)+JQDEFL))
         KCLASS(KI)=KCLACO(IW(KOQVEC+KI*KCQVEC+JQVECL))
         KDAU(KI,KI1)=IW(KOQLIN+KI1+IW(KOQVEC+KI*KCQVEC+JQVEDL))
         KECAL(KI,KI1)=IW(KOQLIN+KI1+IW(KJQDET(KI)+JQDEEL))
         KENDV(KI)=IW(KOQVEC+KI*KCQVEC+JQVEEV)
         KFOLLO(KI)=IW(KOQVEC+KI*KCQVEC+JQVENP)
         KHCAL(KI,KI1)=IW(KOQLIN+KI1+IW(KJQDET(KI)+JQDEHL))
         KLUNDS(KI)=IW(KOQVEC+KI*KCQVEC+JQVEKS)
         KNCHGD(KI)=IW(KJQDET(KI)+JQDENF)
         KNECAL(KI)=IW(KJQDET(KI)+JQDENE)
         KNHCAL(KI)=IW(KJQDET(KI)+JQDENH)
         KNMOTH(KI)=IW(KOQVEC+KI*KCQVEC+JQVENO)
         KMOTH(KI,KI1)=IW(KOQLIN+KI1+IW(KOQVEC+KI*KCQVEC+JQVEOL))
         KMTCH(KI,KI1)=IW(KOQMTL+KI1+IW(KOQVEC+KI*KCQVEC+JQVEML))
         KNDAU(KI)=IW(KOQVEC+KI*KCQVEC+JQVEND)
         KNMTCH(KI)=IW(KOQVEC+KI*KCQVEC+JQVENM)
         KORIV(KI)=IW(KOQVEC+KI*KCQVEC+JQVEOV)
         KSAME(KI)=IW(KOQVEC+KI*KCQVEC+JQVESP)
         KSMTCH(KI,KI1)=IW(KOQMTS+KI1+IW(KOQVEC+KI*KCQVEC+JQVEML))
         KSTABC(KI)=IW(KOQVEC+KI*KCQVEC+JQVESC)
         KTPCOD(KI)=IW(KOQVEC+KI*KCQVEC+JQVEPA)
         XLOCKN(KI,KI1)=IAND(KBMASK(KI,KI1),KLOCK0(KI1,KMC(KI))).NE.0
         XLOCK(KI)=IW(KOQVEC+KI*KCQVEC+JQVELK).NE.0.OR.XLOCKN(KI,1).OR.
        & XLOCKN(KI,2).OR.XLOCKN(KI,3).OR.XLOCKN(KI,4).OR.
        & XLOCKN(KI,5).OR.XLOCKN(KI,6).OR.XLOCKN(KI,7).OR.
        & XLOCKN(KI,8).OR.XLOCKN(KI,9).OR.XLOCKN(KI,10).OR.
        & XLOCKN(KI,11).OR.XLOCKN(KI,12).OR.XLOCKN(KI,13).OR.
        & XLOCKN(KI,14)
         XMC(KI)=KCLARM(IW(KOQVEC+KI*KCQVEC+JQVECL)).NE.1
         QRDFL(KI,KI1)=RW(KOQVEC+KI*KCQVEC+JQVEUS+KI1-1)
         KRDFL(KI,KI1)=IW(KOQVEC+KI*KCQVEC+JQVEUS+KI1-1)
         XCAL(KI)=IW(KJQDET(KI)+JQDECF).NE.0
         XECAL(KI)=IABS(IW(KJQDET(KI)+JQDECF)).EQ.1
         XHCAL(KI)=IABS(IW(KJQDET(KI)+JQDECF)).EQ.2
         QVX(KI)=RW(KOQVRT+KI*KCQVRT+JQVRVX)
         QVY(KI)=RW(KOQVRT+KI*KCQVRT+JQVRVY)
         QVZ(KI)=RW(KOQVRT+KI*KCQVRT+JQVRVZ)
         KVN(KI)=IW(KOQVRT+KI*KCQVRT+JQVRVN)
         KVTYPE(KI)=IW(KOQVRT+KI*KCQVRT+JQVRTY)
         KVINCP(KI)=IW(KOQVRT+KI*KCQVRT+JQVRIP)
         KVNDAU(KI)=IW(KOQVRT+KI*KCQVRT+JQVRND)
         KVYV0V(KI)=IW(KOQVRT+KI*KCQVRT+JQVRAY)
         KVFVER(KI)=IW(KOQVRT+KI*KCQVRT+JQVRAF)
         KVDAU(KI,KI1)=IW(KOQLIN+KI1+IW(KOQVRT+KI*KCQVRT+JQVRDL))
         QVEM(KI,KI1,KI2)=RW(KOQVRT+KI*KCQVRT+KMATIX(KI1,KI2)+JQVREM)
         QVCHIF(KI)=RW(KOQVRT+KI*KCQVRT+JQVRCF)
         QVDIF2(KI1,KI2)=SQRT((QVX(KI1)-QVX(KI2))**2+(QVY(KI1)-
        &QVY(KI2))**2)
         QVDIF3(KI1,KI2)=SQRT((QVX(KI1)-QVX(KI2))**2+(QVY(KI1)-
        &QVY(KI2))**2+ (QVZ(KI1)-QVZ(KI2))**2)
         QMSQ2(KI1,KI2)=(QE(KI1)+QE(KI2))**2-(QX(KI1)+QX(KI2))**2-
        & (QY(KI1)+QY(KI2))**2-(QZ(KI1)+QZ(KI2))**2
         QMSQ3(KI1,KI2,KI3)=(QE(KI1)+QE(KI2)+QE(KI3))**2-
        & (QX(KI1)+QX(KI2)+QX(KI3))**2-(QY(KI1)+QY(KI2)+QY(KI3))**2-
        & (QZ(KI1)+QZ(KI2)+QZ(KI3))**2
         QMSQ4(KI1,KI2,KI3,KI4)=(QE(KI1)+QE(KI2)+QE(KI3)+QE(KI4))**2-
        & (QX(KI1)+QX(KI2)+QX(KI3)+QX(KI4))**2-(QY(KI1)+QY(KI2)+
        & QY(KI3)+QY(KI4))**2-(QZ(KI1)+QZ(KI2)+QZ(KI3)+QZ(KI4))**2
         QM2(KI1,KI2)=QSQT(QMSQ2(KI1,KI2))
         QM3(KI1,KI2,KI3)=QSQT(QMSQ3(KI1,KI2,KI3))
         QM4(KI1,KI2,KI3,KI4)=QSQT(QMSQ4(KI1,KI2,KI3,KI4))
         QDMSQ(KI1,KI2)=(QE(KI1)-QE(KI2))**2-(QX(KI1)-QX(KI2))**2-
        & (QY(KI1)-QY(KI2))**2-(QZ(KI1)-QZ(KI2))**2
         QBETA(KI)=QP(KI)/QE(KI)
         QGAMMA(KI)=1./SQRT((1.-QBETA(KI))*(1.+QBETA(KI)))
         QDOT3(KI1,KI2)=QX(KI1)*QX(KI2)+QY(KI1)*QY(KI2)+QZ(KI1)*QZ(KI2)
         QDOT4(KI1,KI2)=QE(KI1)*QE(KI2)-QDOT3(KI1,KI2)
         QCOSA(KI1,KI2)=QDOT3(KI1,KI2)/(QP(KI1)*QP(KI2))
         QPPAR(KI1,KI2)=QDOT3(KI1,KI2)/QP(KI2)
         QPPER(KI1,KI2)=SQRT((QY(KI1)*QZ(KI2)-QZ(KI1)*QY(KI2))**2+
        & (QZ(KI1)*QX(KI2)-QX(KI1)*QZ(KI2))**2+
        & (QX(KI1)*QY(KI2)-QY(KI1)*QX(KI2))**2)/QP(KI2)
         XSAME(KI1,KI2)=IAND(KBMASK(KI1,1),KBMASK(KI2,1)).NE.0.OR.
        & IAND(KBMASK(KI1,2),KBMASK(KI2,2)).NE.0.OR.
        & IAND(KBMASK(KI1,3),KBMASK(KI2,3)).NE.0.OR.
        & IAND(KBMASK(KI1,4),KBMASK(KI2,4)).NE.0.OR.
        & IAND(KBMASK(KI1,5),KBMASK(KI2,5)).NE.0.OR.
        & IAND(KBMASK(KI1,6),KBMASK(KI2,6)).NE.0.OR.
        & IAND(KBMASK(KI1,7),KBMASK(KI2,7)).NE.0.OR.
        & IAND(KBMASK(KI1,8),KBMASK(KI2,8)).NE.0.OR.
        & IAND(KBMASK(KI1,9),KBMASK(KI2,9)).NE.0.OR.
        & IAND(KBMASK(KI1,10),KBMASK(KI2,10)).NE.0.OR.
        & IAND(KBMASK(KI1,11),KBMASK(KI2,11)).NE.0.OR.
        & IAND(KBMASK(KI1,12),KBMASK(KI2,12)).NE.0.OR.
        & IAND(KBMASK(KI1,13),KBMASK(KI2,13)).NE.0.OR.
        & IAND(KBMASK(KI1,14),KBMASK(KI2,14)).NE.0
         QCMASS(KI)=RW(KOQPAR+KI*KCQPAR+JQPAMA)
         QCCHAR(KI)=RW(KOQPAR+KI*KCQPAR+JQPACH)
         QCLIFE(KI)=RW(KOQPAR+KI*KCQPAR+JQPALT)
         QCWIDT(KI)=RW(KOQPAR+KI*KCQPAR+JQPAWI)
         XCEQOR(KI,KI1)=KTPCOD(KI).EQ.KI1.OR.
        & KTPCOD(KI).EQ.IW(KOQPAR+KI1*KCQPAR+JQPAAN)
         XCEQU(KI,KI1)=KTPCOD(KI).EQ.KI1
      QCFDET
         XFRF(KI)=IW(KJQDET(KI)+JQDEAF).NE.KQZER
         QFRFIR(KI)=RW(IW(KJQDET(KI)+JQDEAF)+JFRFIR)
         QFRFTL(KI)=RW(IW(KJQDET(KI)+JQDEAF)+JFRFTL)
         QFRFP0(KI)=RW(IW(KJQDET(KI)+JQDEAF)+JFRFP0)
         QFRFD0(KI)=RW(IW(KJQDET(KI)+JQDEAF)+JFRFD0)
         QFRFZ0(KI)=RW(IW(KJQDET(KI)+JQDEAF)+JFRFZ0)
         QFRFAL(KI)=RW(IW(KJQDET(KI)+JQDEAF)+JFRFAL)
         QFRFEM(KI,KI1,KI2)=RW(IW(KJQDET(KI)+JQDEAF)+
        & KMATIX(KI1,KI2)+JFRFEM)
         QFRFC2(KI)=RW(IW(KJQDET(KI)+JQDEAF)+JFRFC2)
         KFRFDF(KI)=IW(IW(KJQDET(KI)+JQDEAF)+JFRFDF)
         KFRFNO(KI)=IW(IW(KJQDET(KI)+JQDEAF)+JFRFNO)
         KFRTNV(KI)=IW(IW(KJQDET(KI)+JQDEAL)+JFRTNV)
         KFRTNI(KI)=IW(IW(KJQDET(KI)+JQDEAL)+JFRTNI)
         KFRTNE(KI)=IW(IW(KJQDET(KI)+JQDEAL)+JFRTNE)
         KFRTNT(KI)=IW(IW(KJQDET(KI)+JQDEAL)+JFRTNT)
         KFRTNR(KI)=IW(IW(KJQDET(KI)+JQDEAL)+JFRTNR)
         KFRIBP(KI)=IW(IW(KJQDET(KI)+JQDEFI)+JFRIBP)
         KFRIDZ(KI)=IW(IW(KJQDET(KI)+JQDEFI)+JFRIDZ)
         KFRIBC(KI)=IW(IW(KJQDET(KI)+JQDEFI)+JFRIBC)
         KFRIDC(KI)=IW(IW(KJQDET(KI)+JQDEFI)+JFRIDC)
         QFRIPE(KI)=RW(IW(KJQDET(KI)+JQDEFI)+JFRIPE)
         QFRIPM(KI)=RW(IW(KJQDET(KI)+JQDEFI)+JFRIPM)
         QFRIPI(KI)=RW(IW(KJQDET(KI)+JQDEFI)+JFRIPI)
         QFRIPK(KI)=RW(IW(KJQDET(KI)+JQDEFI)+JFRIPK)
         QFRIPP(KI)=RW(IW(KJQDET(KI)+JQDEFI)+JFRIPP)
         QFRINK(KI)=RW(IW(KJQDET(KI)+JQDEFI)+JFRINK)
         KFRIQF(KI)=IW(IW(KJQDET(KI)+JQDEFI)+JFRIQF)
         XFRIQF(KI)=KFRIQF(KI).EQ.1.OR.KFRIQF(KI).EQ.3
         KNTEX(KI)=IW(KJQDET(KI)+JQDENT)
         XTEX(KI)=IW(KJQDET(KI)+JQDENT).NE.0
         KTEXSI(KI,KI1)=IW(IW(KJQDET(KI)+KI1+JQDENT)+JTEXSI)
         QTEXTM(KI,KI1)=RW(IW(KJQDET(KI)+KI1+JQDENT)+JTEXTM)
         QTEXTL(KI,KI1)=RW(IW(KJQDET(KI)+KI1+JQDENT)+JTEXTL)
         KTEXNS(KI,KI1)=IW(IW(KJQDET(KI)+KI1+JQDENT)+JTEXNS)
         QTEXAD(KI,KI1)=RW(IW(KJQDET(KI)+KI1+JQDENT)+JTEXAD)
         XEID(KI)=IW(KJQDET(KI)+JQDEAE).NE.KQZER
         KEIDIF(KI)=IW(IW(KJQDET(KI)+JQDEAE)+JEIDIF)
         QEIDRI(KI,KI1)=RW(IW(KJQDET(KI)+JQDEAE)+KI1+JEIDR1-1)
         QEIDEC(KI)=RW(IW(KJQDET(KI)+JQDEAE)+JEIDEC)
         KEIDIP(KI)=IW(IW(KJQDET(KI)+JQDEAE)+JEIDIP)
         QEIDEI(KI,KI1)=RW(IW(KJQDET(KI)+JQDEAE)+KI1+JEIDE1-1)
         XHMA(KI)=IW(KJQDET(KI)+JQDEAH).NE.KQZER
         KHMANF(KI)=IW(IW(KJQDET(KI)+JQDEAH)+JHMANF)
         KHMANE(KI)=IW(IW(KJQDET(KI)+JQDEAH)+JHMANE)
         KHMANL(KI)=IW(IW(KJQDET(KI)+JQDEAH)+JHMANL)
         KHMAMH(KI)=IW(IW(KJQDET(KI)+JQDEAH)+JHMAMH)
         KHMAIG(KI)=IW(IW(KJQDET(KI)+JQDEAH)+JHMAIG)
         QHMAED(KI)=RW(IW(KJQDET(KI)+JQDEAH)+JHMAED)
         QHMACS(KI)=RW(IW(KJQDET(KI)+JQDEAH)+JHMACS)
         KHMAND(KI)=IW(IW(KJQDET(KI)+JQDEAH)+JHMAND)
         KHMAIE(KI)=IW(IW(KJQDET(KI)+JQDEAH)+JHMAIE)
         KHMAIT(KI)=IW(IW(KJQDET(KI)+JQDEAH)+JHMAIT)
         KHMAIF(KI)=IW(IW(KJQDET(KI)+JQDEAH)+JHMAIF)
         XMCA(KI)=IW(KJQDET(KI)+JQDEAM).NE.KQZER
         KMCANH(KI,KI1)=IW(IW(KJQDET(KI)+JQDEAM)+KI1+JMCANH-1)
         QMCADH(KI,KI1)=RW(IW(KJQDET(KI)+JQDEAM)+KI1+JMCADH-1)
         QMCADC(KI,KI1)=RW(IW(KJQDET(KI)+JQDEAM)+KI1+JMCADC-1)
         QMCAAM(KI)=RW(IW(KJQDET(KI)+JQDEAM)+JMCAAM)
         QMCAAC(KI)=RW(IW(KJQDET(KI)+JQDEAM)+JMCAAC)
         XMUI(KI)=IW(KJQDET(KI)+JQDEMU).NE.KQZER
         KMUIIF(KI)=IW(IW(KJQDET(KI)+JQDEMU)+JMUIIF)
         QMUISR(KI)=RW(IW(KJQDET(KI)+JQDEMU)+JMUISR)
         QMUIDM(KI)=RW(IW(KJQDET(KI)+JQDEMU)+JMUIDM)
         KMUIST(KI)=IW(IW(KJQDET(KI)+JQDEMU)+JMUIST)
         KMUITN(KI)=IW(IW(KJQDET(KI)+JQDEMU)+JMUITN)
         XPEC(KI)=IW(KJQDET(KI)+JQDEEC).NE.KQZER
         QPECER(KI)=RW(IW(KJQDET(KI)+JQDEEC)+JPECER)
         QPECE1(KI)=RW(IW(KJQDET(KI)+JQDEEC)+JPECE1)
         QPECE2(KI)=RW(IW(KJQDET(KI)+JQDEEC)+JPECE2)
         QPECTH(KI)=RW(IW(KJQDET(KI)+JQDEEC)+JPECTH)
         QPECPH(KI)=RW(IW(KJQDET(KI)+JQDEEC)+JPECPH)
         QPECEC(KI)=RW(IW(KJQDET(KI)+JQDEEC)+JPECEC)
         KPECKD(KI)=IW(IW(KJQDET(KI)+JQDEEC)+JPECKD)
         KPECCC(KI)=IW(IW(KJQDET(KI)+JQDEEC)+JPECCC)
         KPECRB(KI)=IW(IW(KJQDET(KI)+JQDEEC)+JPECRB)
         KPECPC(KI)=IW(IW(KJQDET(KI)+JQDEEC)+JPECPC)
         XPEP(KI)=IW(KJQDET(KI)+JQDEET).NE.KQZER
         QPEPT1(KI)=RW(IW(KJQDET(KI)+JQDEET)+JPEPT1)
         QPEPP1(KI)=RW(IW(KJQDET(KI)+JQDEET)+JPEPP1)
         QPEPT3(KI)=RW(IW(KJQDET(KI)+JQDEET)+JPEPT3)
         QPEPP3(KI)=RW(IW(KJQDET(KI)+JQDEET)+JPEPP3)
         XPHC(KI)=IW(KJQDET(KI)+JQDEHC).NE.KQZER
         QPHCER(KI)=RW(IW(KJQDET(KI)+JQDEHC)+JPHCER)
         QPHCTH(KI)=RW(IW(KJQDET(KI)+JQDEHC)+JPHCTH)
         QPHCPH(KI)=RW(IW(KJQDET(KI)+JQDEHC)+JPHCPH)
         QPHCEC(KI)=RW(IW(KJQDET(KI)+JQDEHC)+JPHCEC)
         KPHCKD(KI)=IW(IW(KJQDET(KI)+JQDEHC)+JPHCKD)
         KPHCCC(KI)=IW(IW(KJQDET(KI)+JQDEHC)+JPHCCC)
         KPHCRB(KI)=IW(IW(KJQDET(KI)+JQDEHC)+JPHCRB)
         KPHCPC(KI)=IW(IW(KJQDET(KI)+JQDEHC)+JPHCPC)
         XEFO(KI)=IW(KJQDET(KI)+JQDEEF).NE.KQZER
         QEFOWE(KI)=RW(IW(KJQDET(KI)+JQDEEF)+JEFOWE)
         KEFOTY(KI)=IW(IW(KJQDET(KI)+JQDEEF)+JEFOTY)
         KEFOLE(KI)=IW(IW(KJQDET(KI)+JQDEEF)+JEFOLE)
         KEFOLT(KI)=IW(IW(KJQDET(KI)+JQDEEF)+JEFOLT)
         KEFOLH(KI)=IW(IW(KJQDET(KI)+JQDEEF)+JEFOLH)
         KEFOLC(KI)=IW(IW(KJQDET(KI)+JQDEEF)+JEFOLC)
         KEFOLJ(KI)=IW(IW(KJQDET(KI)+JQDEEF)+JEFOLJ)
         XPCQ(KI)=IW(KJQDET(KI)+JQDEPC).NE.KQZER
         KPCQNA(KI)=IW(IW(KJQDET(KI)+JQDEPC)+JPCQNA)
         XEGP(KI)=IW(KJQDET(KI)+JQDEEG).NE.KQZER
         QEGPR1(KI)=RW(IW(KJQDET(KI)+JQDEEG)+JEGPR1)
         QEGPR2(KI)=RW(IW(KJQDET(KI)+JQDEEG)+JEGPR2)
         QEGPF4(KI)=RW(IW(KJQDET(KI)+JQDEEG)+JEGPF4)
         QEGPDM(KI)=RW(IW(KJQDET(KI)+JQDEEG)+JEGPDM)
         KEGPST(KI)=IW(IW(KJQDET(KI)+JQDEEG)+JEGPST)
         KEGPQU(KI)=IW(IW(KJQDET(KI)+JQDEEG)+JEGPQU)
         KEGPPE(KI)=IW(IW(KJQDET(KI)+JQDEEG)+JEGPPE)
         XPGP(KI)=IW(KJQDET(KI)+JQDEPG).NE.KQZER.AND.IW(NAPGPC).GT.0
         QPGPR1(KI)=RW(IW(KJQDET(KI)+JQDEPG)+JPGPR1)
         QPGPR2(KI)=RW(IW(KJQDET(KI)+JQDEPG)+JPGPR2)
         QPGPF4(KI)=RW(IW(KJQDET(KI)+JQDEPG)+JPGPF4)
         QPGPDM(KI)=RW(IW(KJQDET(KI)+JQDEPG)+JPGPDM)
         QPGPST(KI)=RW(IW(KJQDET(KI)+JQDEPG)+JPGPST)
         QPGPQ1(KI)=RW(IW(KJQDET(KI)+JQDEPG)+JPGPQ1)
         QPGPQ2(KI)=RW(IW(KJQDET(KI)+JQDEPG)+JPGPQ2)
         QPGPM1(KI)=RW(IW(KJQDET(KI)+JQDEPG)+JPGPM1)
         QPGPM2(KI)=RW(IW(KJQDET(KI)+JQDEPG)+JPGPM2)
         QPGPMA(KI)=RW(IW(KJQDET(KI)+JQDEPG)+JPGPMA)
         QPGPER(KI)=RW(IW(KJQDET(KI)+JQDEPG)+JPGPER)
         QPGPTR(KI)=RW(IW(KJQDET(KI)+JQDEPG)+JPGPTR)
         QPGPPR(KI)=RW(IW(KJQDET(KI)+JQDEPG)+JPGPPR)
         KPGPQU(KI)=IW(IW(KJQDET(KI)+JQDEPG)+JPGPQU)
         KPGPPE(KI)=IW(IW(KJQDET(KI)+JQDEPG)+JPGPPE)
         XPGAC(KI)=IW(KJQDET(KI)+JQDEPG).NE.KQZER.AND.IW(NAPGAC).GT.0
         KPGAST(KI)=IW(IW(KJQDET(KI)+JQDEPG)+JPGAST)
         QPGAEF(KI)=RW(IW(KJQDET(KI)+JQDEPG)+JPGAEF)
         QPGAGC(KI)=RW(IW(KJQDET(KI)+JQDEPG)+JPGAGC)
         QPGAZS(KI)=RW(IW(KJQDET(KI)+JQDEPG)+JPGAZS)
         QPGAPL(KI)=RW(IW(KJQDET(KI)+JQDEPG)+JPGAPL)
         QPGAPH(KI)=RW(IW(KJQDET(KI)+JQDEPG)+JPGAPH)
         KPGAPN(KI)=IW(IW(KJQDET(KI)+JQDEPG)+JPGAPN)
         KPGAFA(KI)=IW(IW(KJQDET(KI)+JQDEPG)+JPGAFA)
         KPGAPE(KI)=IW(IW(KJQDET(KI)+JQDEPG)+JPGAPE)
         XYV0(KI)=KVYV0V(KENDV(KI)).NE.0
         KYV0K1(KI)=IW(KVYV0V(KENDV(KI))+JYV0K1)
         KYV0K2(KI)=IW(KVYV0V(KENDV(KI))+JYV0K2)
         QYV0VX(KI)=RW(KVYV0V(KENDV(KI))+JYV0VX)
         QYV0VY(KI)=RW(KVYV0V(KENDV(KI))+JYV0VY)
         QYV0VZ(KI)=RW(KVYV0V(KENDV(KI))+JYV0VZ)
         QYV0X1(KI)=RW(KVYV0V(KENDV(KI))+JYV0X1)
         QYV0X2(KI)=RW(KVYV0V(KENDV(KI))+JYV0X2)
         QYV0C2(KI)=RW(KVYV0V(KENDV(KI))+JYV0C2)
         KYV0IC(KI)=IW(KVYV0V(KENDV(KI))+JYV0IC)
         QYV0DM(KI)=RW(KVYV0V(KENDV(KI))+JYV0DM)
         QYV0S1(KI)=RW(KVYV0V(KENDV(KI))+JYV0S1)
         QYV0S2(KI)=RW(KVYV0V(KENDV(KI))+JYV0S2)
         XLEPTG(KI)=IW(KJQDET(KI)+JQDEPD).NE.KQZER
         KLEPPA(KI)=IW(IW(KJQDET(KI)+JQDEPD)+JPDLPA)
         KLEPJT(KI)=IW(IW(KJQDET(KI)+JQDEPD)+JPDLJT)+KLFJET-1
         QLEPPI(KI)=RW(IW(KJQDET(KI)+JQDEPD)+JPDLPI)
         QLEPPE(KI)=RW(IW(KJQDET(KI)+JQDEPD)+JPDLPE)
         KLEPVP(KI)=IW(IW(KJQDET(KI)+JQDEPD)+JPDLVP)
         XLEPTH(KI)=IW(KJQDET(KI)+JQDEPM).NE.KQZER
         KLEPFL(KI)=IW(IW(KJQDET(KI)+JQDEPM)+JPMLFL)
         KLEPPO(KI)=IW(IW(KJQDET(KI)+JQDEPM)+JPMLPO)
         KLEPCH(KI)=IW(IW(KJQDET(KI)+JQDEPM)+JPMLCH)
         KLEPSP(KI)=IW(IW(KJQDET(KI)+JQDEPM)+JPMLSP)
         KLEPLE(KI)=IW(IW(KJQDET(KI)+JQDEPM)+JPMLLE)
         KLEPME(KI)=IW(IW(KJQDET(KI)+JQDEPM)+JPMLME)
         KLEPKT(KI)=IW(IW(KJQDET(KI)+JQDEPM)+JPMLKT)
   
    track number in FRFT bank.
         IJUL = KTN(ITRK)
    scale factor to be applied to momentum and error on it.
         QPCORR = PPCORR(IJUL,NVDET,ERCORR,IFAIL)
         IF (IFAIL.NE.0.AND.NWARN.LT.MAXWAR.AND.KRUN.NE.KRUNL) THEN
           NWARN = NWARN + 1
           IF (IFAIL.LT.0) THEN
             WRITE(KUPRNT,*)
             WRITE(KUPRNT,10) IFAIL,KRUN
             WRITE(KUPRNT,*)
      10     FORMAT(' QPCORR warning ',I2,
        &           ' : No corrections available for run ',I6)
           ELSE
             WRITE(KUPRNT,*)
             WRITE(KUPRNT,20) IFAIL,KRUN
             WRITE(KUPRNT,*)
      20     FORMAT(' QPCORR error ',I2,
        &           ' : No corrections made for run ',I6)
           END IF
         END IF
    ALPHA momentum if required.
         IF (ASCALE) CALL QVSCAL(ITRK,QPCORR)
   
   -- remember the last run number
         IF (KRUN.NE.KRUNL) KRUNL = KRUN
   
         END
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   QTRESC                                                                          
        |---- QPCORR                                                               
                   |----  SIGN                                External             
                   |----  SQRT                                External             
                   |----  ABS                                 External             
                   |----  NINT                                External             
                   |----  KMATIX                              External             
                   |----  ATG                                 External             
                   |----  KCLARM                              External             
                   |----  IAND                                External             
                   |----  KLOCK0                              External             
                   |----  IABS                                External             
                   |----  PPCORR                              External             
                   |----  QVSCAL                                                   
   
 
3 QPVMDUM
   
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
         SUBROUTINE QPVMCD(CQFWRK)
   Dummy routines for pvm on saga machines
   
   
 
3 QSEFMC
         REAL FUNCTION QSEFMC(ITK,I)
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   
    matching quantity for Ith alpha EF objects matching input MC track
    vice versa.
   Author: Paul Bright-Thomas
      03/03/97 PBT Created.
   
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
              QSEFMC                                                               
                   |----  SIGN                                External             
                   |----  SQRT                                External             
                   |----  ABS                                 External             
                   |----  NINT                                External             
                   |----  KMATIX                              External             
                   |----  ATG                                 External             
                   |----  KCLARM                              External             
                   |----  IAND                                External             
                   |----  KLOCK0                              External             
                   |----  IABS                                External             
                   |----  IEFMC                                                    
                   |----  KNEFMC                                                   
                   |----  SEFMC                               External             
   
 
3 QSMCEF
         REAL FUNCTION QSMCEF(ITK,I)
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   
    matching quantity for Ith alpha EF objects matching input MC track
    vice versa.
   Author: Paul Bright-Thomas
      03/03/97 PBT Created.
   
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
              QSMCEF                                                               
                   |----  SIGN                                External             
                   |----  SQRT                                External             
                   |----  ABS                                 External             
                   |----  NINT                                External             
                   |----  KMATIX                              External             
                   |----  ATG                                 External             
                   |----  KCLARM                              External             
                   |----  IAND                                External             
                   |----  KLOCK0                              External             
                   |----  IABS                                External             
                   |----  IMCEF                                                    
                   |----  KNMCEF                                                   
   
 
3 QSTRU
         REAL FUNCTION QSTRU(ITK,I)
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   
    matching criteria of Ith alpha EF object matching input MC track
    vice versa.
    QSRTU returns >  0.,        it is energy shared between cluster and FKIN
    QSRTU returns <  0., > -1., it is angle match for HCAL/SICAL and FKIN
    QSRTU returns < -1.,        it is shared hits for charged track and FKIN
   
    the input or returned EF object is KEFOTY 5,6 or 8, the match is angle.
   Author: Paul Bright-Thomas
      03/03/97 PBT Created.
           O4/O3/97 PBT Hadronic objects are matched on angle (until PHMH bank
                        restored to POTs).
   
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
              QSTRU                                                                
                   |----  SIGN                                External             
                   |----  SQRT                                External             
                   |----  ABS                                 External             
                   |----  NINT                                External             
                   |----  KMATIX                              External             
                   |----  ATG                                 External             
                   |----  KCLARM                              External             
                   |----  IAND                                External             
                   |----  KLOCK0                              External             
                   |----  IABS                                External             
                   |----  IEFMC                                                    
                   |----  IMCEF                                                    
   
 
3 QTRUZ
         SUBROUTINE QTRUZ
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   
    the history of the event wrt MC-EF matching.
   Author: Paul Bright-Thomas
      03/03/97 PBT Created.
   
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   KNTRU                                                                           
        |---- QTRUZ .                                                              
   
 
3 QUMUPR
         SUBROUTINE QUMUPR
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Prepare the muon identification
   
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
              QUMUPR                                                               
                   |----  NSWAP                               External             
                   |----  MUREDO                              External             
   
 
3 QVDHIT
         SUBROUTINE QVDHIT(ITRK, IVHIT)
  ------------------------------------------------------------------------------
    CKEY VDET /USER
  ------------------------------------------------------------------------------
   Provide array of number of vdet hits per layer for given track.
    Haywood     13-03-92
         ITRK      /I     Alpha track number
        IVHIT(1)  /I     Num Vdet hits in r-phi on inner layer
               IVHIT(2)  /I     Num Vdet hits in r-phi on outer layer
               IVHIT(3)  /I     Num Vdet hits in z     on inner layer
               IVHIT(4)  /I     Num Vdet hits in z     on outer layer
    r-phi = U and z = W in Vdet scheme.
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
              QVDHIT                                                               
                   |----  SIGN                                External             
                   |----  SQRT                                External             
                   |----  ABS                                 External             
                   |----  NINT                                External             
                   |----  KMATIX                              External             
                   |----  ATG                                 External             
                   |----  KCLARM                              External             
                   |----  IAND                                External             
                   |----  KLOCK0                              External             
                   |----  IABS                                External             
                   |----  VZERO                               External             
                   |----  MINGTV                                                   
                   |----  VDHITS                              External             
   
 
3 QVKINK
         SUBROUTINE QVKINK(IVK,Patkink,ptout,plout,ihypk,ier)
  ------------------------------------------------------------------------------
    CKEY WRITE VERTEX /USER
  ------------------------------------------------------------------------------
   Get special values for kink vertex ivx
    from user routines
                                                     J.Boucrot 29.04.97
    Input argument :
       IVK  = ALPHA number for kink vertex
    Output arguments :
       IER  = 0 if this is realluy a kink vertex
            = 1 if not
     If IER = 0 , the following quantities are defined :
    Patkink = Momentum of parent at kink position
    Ptout   = Pt of outgoing charged particle relative to parent
    Plout   = Pl of outgoing charged particle relative to parent
    IHYPK   = Hypothesis of mass cuts satisfied by this decay.
            = 1   pi -> mu nu
            = 2   K -> mu nu
            = 3   K -> pi pi0
            = 4   Sigma+ -> p pi0
            = 5   Sigma+ -> pi+ n
            = 6   Sigma- -> pi- n
            = 7   Xi- -> pi- Lambda
            = 8   Omega- -> K- Lambda
            = 9   Omega- -> pi- Xi0
            = 10  Omega- -> Xi- pi0
            = 0   if none of the above hypotheses are satisfied
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   QWNEWTR                                                                         
        |---- QVKINK                                                               
                   |----  SIGN                                External             
                   |----  SQRT                                External             
                   |----  ABS                                 External             
                   |----  NINT                                External             
                   |----  KMATIX                              External             
                   |----  ATG                                 External             
                   |----  KCLARM                              External             
                   |----  IAND                                External             
                   |----  KLOCK0                              External             
                   |----  IABS                                External             
                   |----  BTEST                                                    
   
 
3 QVTRUH
         SUBROUTINE QVTRUH(ITRK, IVHIT)
  ------------------------------------------------------------------------------
    CKEY UTIL VDET /USER
  ------------------------------------------------------------------------------
   Provide array of number of correctly associated vdet hits
     per layer for given track.
   A. Bonissent 30-05-96
         ITRK      /I     Alpha track number
        IVHIT(1)  /I     Num Vdet hits OK in r-phi on inner layer
               IVHIT(2)  /I     Num Vdet hits OK in r-phi on outer layer
               IVHIT(3)  /I     Num Vdet hits OK in z     on inner layer
               IVHIT(4)  /I     Num Vdet hits OK in z     on outer layer
    r-phi = U and z = W in Vdet scheme.
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
              QVTRUH                                                               
                   |----  SIGN                                External             
                   |----  SQRT                                External             
                   |----  ABS                                 External             
                   |----  NINT                                External             
                   |----  KMATIX                              External             
                   |----  ATG                                 External             
                   |----  KCLARM                              External             
                   |----  IAND                                External             
                   |----  KLOCK0                              External             
                   |----  IABS                                External             
                   |----  VZERO                               External             
                   |----  MINGTV                                                   
                   |----  KBESTM                                                   
                   |----  VTRUH                               External             
                   |----  ISHFT                               External             
   
 
3 QWHICHBP
         SUBROUTINE  QWHICH_BP(IFLAG)
  ------------------------------------------------------------------------------
    CKEY FILL USER
  ------------------------------------------------------------------------------
     Author  J. Boucrot     28-9-98
     Returns a code indicating the origin of the BEAM SPOT
     transmitted in the QVXNOM,QVYNOM,QVZNOM variables
   - Input:
     None.
   - Output:
     IFLAG   / I  Origin of the beam spot:
          = 0  no beam position found (should never happen)
          = 1  from the 'JSUM' bank - should be very rare,
               only if getbp fails and neither RXYZ nor LFIL exist
          = 2  from the 'LFIL' bank, if getbp fails and no RXYZ exists
          = 3  from the 'RXYZ' bank (only for old LEP1 data processing
               of 1989 -> 1995 if getbp fails )
          = 4  from getbp (event-chunk beam position)
   
   
 
3 QWHICHEN
         SUBROUTINE  QWHICH_EN(IFLAG)
  ------------------------------------------------------------------------------
    CKEY FILL USER
  ------------------------------------------------------------------------------
     Author  J. Boucrot     28-9-98
     Returns a code indicating the origin of the LEP energy
     transmitted in the QELEP variable
   - Input:
     None.
   - Output:
     IFLAG   / I  Origin of the LEP energy value QELEP :
          = 0  no energy found
          = 1  from the 'RLEP' bank (always the case for MCarlo)
          = 2  from the 'LFIL' bank
               for 1989 -> 1992 real data
               or LEP2 data when neither time-slice nor run-averaged
          = 3  from the run-averaged values of the LEP Working Group
               for 1993 -> 1995 LEP 1 data, or LEP 2 data if
               or LEP 2 data if no time-slice available
          = 4  from the 15' time-slices of the LEP Working Group
               for LEP 2 data
   
   
 
3 QWRFSEVT
         SUBROUTINE QWRFSEVT(SEVTF)
  ------------------------------------------------------------------------------
    CKEY FILL /INTERNAL
  ------------------------------------------------------------------------------
   Write sevt cards file from lists of events selected by the user.
       Author: J. Boucrot      27-Jan-2000
       Input  : QWSE banks
       Called by the user in QUTERM
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
              QWRFSEVT                                                             
                   |----  NAMIND                              External             
                   |----  AUBPRS                              External             
                   |----  LNBLNK                              External             
                   |----  AOPENW                              External             
                   |----  QWRQWSE                                                  
                   |----  ACLOSE                              External             
   
 
3 QWRQWSE
         SUBROUTINE QWRQWSE(lun,nurun,iers)
  ------------------------------------------------------------------------------
    CKEY FILL /INTERNAL
  ------------------------------------------------------------------------------
   Write sevt cards for run nurun
       Author: J. Boucrot      27-Jan-2000
       Input  : QWSE bank
                lun = Fortran output unit
               nurun= run number
       Called by QWRFSEVT
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   QWRFSEVT                                                                        
        |---- QWRQWSE                                                              
                   |----  NLINK                               External             
                   |----  MIN0                                External             
   
 
3 QWRSEVT
         SUBROUTINE QWRSEVT
  ------------------------------------------------------------------------------
    CKEY FILL INTERNAL
  ------------------------------------------------------------------------------
   Fill internal banks for further writing of sevt cards
                                                  J. Boucrot 29-01-2000
    by the user in QUEVNT for selected events
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
              QWRSEVT                                                              
                   |----  SIGN                                External             
                   |----  SQRT                                External             
                   |----  ABS                                 External             
                   |----  NINT                                External             
                   |----  KMATIX                              External             
                   |----  ATG                                 External             
                   |----  KCLARM                              External             
                   |----  IAND                                External             
                   |----  KLOCK0                              External             
                   |----  IABS                                External             
                   |----  NLINK                               External             
                   |----  AUBOS                               External             
   
 
3 QXTRAP
         SUBROUTINE QXTRAP(IALTK,LAY1,LAY2)
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   
    Author : A. Bonissent. J. Carr, March 03 1997
   Say if a track intersects active regions of vdet
       IALTK = Alpha track number
       LAY1, LAY0 = 0 if tracks does not intersect active region
                    1 if tracks does intersect active region
   
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
              QXTRAP                                                               
                   |----  SIGN                                External             
                   |----  SQRT                                External             
                   |----  ABS                                 External             
                   |----  NINT                                External             
                   |----  KMATIX                              External             
                   |----  ATG                                 External             
                   |----  KCLARM                              External             
                   |----  IAND                                External             
                   |----  KLOCK0                              External             
                   |----  IABS                                External             
                   |----  VTRKEX                              External             
                   |----  NLINK                               External             
                   |----  VADEWA                              External             
   
 
3 QYFIT
         SUBROUTINE QYFIT(ILST,NTR,PSUM,VPSUM,IQCH,VOUT,VVOUT,VPSVX,CHI2)
  ------------------------------------------------------------------------------
    CKEY YTOP VERTEX   /INTERNAL
  ------------------------------------------------------------------------------
   Interface for simplified use of ytop from alpha
       H-G Moser 31-09-92
       Modification log:
       E.Rohne   10-03-99 Suppressed error message
                          CALL QWMESE('_QYFIT_ crazy values from YTOPOL fit.')
       input parameters :    ILST        list of track numbers
                             NTR         number of tracks
       output           :    PSUM(5)     4-momentum of res. track, mass
                             VPSUM(10)   covariance of 4-momentum
                             VOUT(3)     vertex position
                             VVOUT(6)    vertex covariance matrix
                             VPSVX((3,3) correlation vertex <-> momentum
                             CHI2        chi**2 of vertex, <0: error
       particles created by this routine have particle names:
       input particles are checked whether they are reconstructed tracks,
       then the errors from the FRF2 bank will be used
       if the input is a YTOP track, the error will be taken from the
       YTOP vertex and track parameters
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   KVFITN                                                                          
        |---- QYFIT                                                                
                   |----  SIGN                                External             
                   |----  SQRT                                External             
                   |----  ABS                                 External             
                   |----  NINT                                External             
                   |----  KMATIX                              External             
                   |----  ATG                                 External             
                   |----  KCLARM                              External             
                   |----  IAND                                External             
                   |----  KLOCK0                              External             
                   |----  IABS                                External             
                   |----  MIN                                 External             
                   |----  QVGET3                                                   
                   |----  QVGETS                                                   
                   |----  YTPAR                               External             
                   |----  YFMVTR                              External             
                   |----  FLOAT                               External             
   
 
3 QYFITC
         SUBROUTINE QYFITC(ILST,NTR,RM,DRM,PSUM,VPSUM,IQCH,VOUT,
  ------------------------------------------------------------------------------
    CKEY YTOP VERTEX   /INTERNAL
  ------------------------------------------------------------------------------
        &VVOUT,VPSVX,CHI2)
   Interface for simplified use of ytop with mass constraint from alpha
       H-G Moser 31-09-92
       input parameters :    ILST        list of track numbers
                             NTR         number of tracks
                             RM          mass constraint
                             DRM         mass constraint error
       output           :    PSUM(5)     4-momentum of res. track, mass
                             VPSUM(6)    covariance of 3-momentum
                             VOUT(3)     vertex position
                             VVOUT(10)   vertex covariance matrix
                             VPSVX((3,3) correlation vertex <-> momentum
                             CHI2        chi**2 of vertex, <0: error
       particles created by this routine have particle names:
       input particles are checked whether they are reconstructed tracks,
       then the errors from the FRF2 bank will be used
       if the input is a YTOP track, the error will be taken from the
       YTOP vertex and track parameters
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   KVFITC                                                                          
        |---- QYFITC                                                               
                   |----  SIGN                                External             
                   |----  SQRT                                External             
                   |----  ABS                                 External             
                   |----  NINT                                External             
                   |----  KMATIX                              External             
                   |----  ATG                                 External             
                   |----  KCLARM                              External             
                   |----  IAND                                External             
                   |----  KLOCK0                              External             
                   |----  IABS                                External             
                   |----  MIN                                 External             
                   |----  QVGET3                                                   
                   |----  QVGETS                                                   
                   |----  YTPAR                               External             
                   |----  YFVMC                               External             
                   |----  FLOAT                               External             
                   |----  PSUM                                External             
                   |----  VPSUM                               External             
   
 
3 QYFITV
         SUBROUTINE QYFITV(IVTX,ILST,NTR,
  ------------------------------------------------------------------------------
    CKEY YTOP VERTEX   /USER
  ------------------------------------------------------------------------------
        &PSUM,VPSUM,IQCH,VOUT,VVOUT,VPSVX,CHI2)
   Interface for simplified use of ytop from alpha
       H-G Moser 31-09-92
       input parameters :    IVTX        vertex number
                             ILST        list of track numbers
                             NTR         number of tracks
       output           :    PSUM(5)     4-momentum of res. track, mass
                             VPSUM(10)   covariance of 3-momentum
                             VOUT(3)     vertex position
                             VVOUT(6)    vertex covariance matrix
                             VPSVX((3,3) correlation vertex <-> momentum
                             CHI2        chi**2 of vertex, <0: error
       particles created by this routine have particle names:
       input particles are checked whether they are reconstructed tracks,
       then the errors from the FRF2 bank will be used
       if the input is a YTOP track, the error will be taken from the
       YTOP vertex and track parameters
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   KVFITV                                                                          
        |---- QYFITV                                                               
                   |----  SIGN                                External             
                   |----  SQRT                                External             
                   |----  ABS                                 External             
                   |----  NINT                                External             
                   |----  KMATIX                              External             
                   |----  ATG                                 External             
                   |----  KCLARM                              External             
                   |----  IAND                                External             
                   |----  KLOCK0                              External             
                   |----  IABS                                External             
                   |----  MIN                                 External             
                   |----  QVGET3                                                   
                   |----  QVGETS                                                   
                   |----  YTPAR                               External             
                   |----  YFMVTR                              External             
                   |----  FLOAT                               External             
   
 
3 QYFTMC
         SUBROUTINE QYFTMC(USE,CONMAS,
  ------------------------------------------------------------------------------
    CKEY YTOP VERTEX   /INTERNAL
  ------------------------------------------------------------------------------
        &  ILST,NTR,PSUM,VPSUM,IQCH,VOUT,VVOUT,VPSVX,CHI2)
   Interface for kvftmc : simplified use of ytop from alpha
       H-G Moser 31-09-92
       input parameters :    USE         use this track in mass constraint
                             CONMAS      mass to constrain tracks to
                             ILST        list of track numbers
                             NTR         number of tracks
       output           :    PSUM(5)     4-momentum of res. track, mass
                             VPSUM(10)   covariance of 4-momentum
                             VOUT(3)     vertex position
                             VVOUT(6)    vertex covariance matrix
                             VPSVX((3,3) correlation vertex <-> momentum
                             CHI2        chi**2 of vertex, <0: error
       particles created by this routine have particle names:
       input particles are checked whether they are reconstructed tracks,
       then the errors from the FRF2 bank will be used
       if the input is a YTOP track, the error will be taken from the
       YTOP vertex and track parameters
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   KVFTMC                                                                          
        |---- QYFTMC                                                               
                   |----  SIGN                                External             
                   |----  SQRT                                External             
                   |----  ABS                                 External             
                   |----  NINT                                External             
                   |----  KMATIX                              External             
                   |----  ATG                                 External             
                   |----  KCLARM                              External             
                   |----  IAND                                External             
                   |----  KLOCK0                              External             
                   |----  IABS                                External             
                   |----  MIN                                 External             
                   |----  QVGET3                                                   
                   |----  QVGETS                                                   
                   |----  YTPAR                               External             
                   |----  YFMVTC                              External             
                   |----  FLOAT                               External             
   
 
3 SIBKCL
         SUBROUTINE SIBKCL(irun,kcl,iflag)
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Checks for quality flag of cluster
   
   
       Author:     B. Bloch-Devaux   June 1998
                   modified April 99 to extend to more backgrounds types
   
       Input:      -irun = run number
                   - kcl = cluster number in SCLS
                   _ banks 'SCLS' from Sical clusters
                     from data base: 'SNOI' to setup background cuts
       Output:
                   - iflag quality flag 0 = OK,1= oscillating,2= beam loss
                                        3=backwards,4=scraping,5=offmom
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   SICLID                                                                          
        |---- SIBKCL                                                               
                   |----  JUNIDB                              External             
                   |----  ALGTDB                              External             
                   |----  NAMIND                              External             
                   |----  INT                                 External             
                   |----  GETLEP                              External             
                   |----  VZERO                               External             
                   |----  SIFSUM                              External             
                   |----  IFCLU                               External             
   
 
3 SICLID
   
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
         SUBROUTINE SICLID(ICLU,ITYP,IFLAG)
   Sical returns identification of sical cluster
   
      Author   :- B. Bloch          18-Apr-1999
   
       Input:      - iclu = cluster number in bank
                     ityp = 1 bank is PECO,
                            2 bank is SCLS,
                            3 bank is SILU
       Output:
                   - iflag quality flag 0 = OK,
                                        1= oscillating,2= beam loss,
                                        3=backwards,   4=scraping,
                                        5=offmom
                                       -1= not a Sical cluster,
                                       -2= not enough info
       if flag is not stored with the data, it is recomputed by SIBKCL
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   GAMIXED                                                                         
        |---- SICLID                                                               
                   |----  NAMIND                              External             
                   |----  IW                                  External             
                   |----  ITABL                               External             
                   |----  RTABL                               External             
                   |----  LROWS                               External             
                   |----  ABS                                 External             
                   |----  ABRUEV                              External             
                   |----  SIBKCL                                                   
   
 
3 TXTREE
         SUBROUTINE TXTREE(MOTHU,OPT)
  ------------------------------------------------------------------------------
    CKEY TOOLS / USER
  ------------------------------------------------------------------------------
   Produce a latex source file of the decay tree from a mcarlo event.
    Author   : A. Bonissent October 1992
    Modified : B Marx December 1992 : works on IBM or Vax;
    be called inside an Alpha job
      Input arguments :
        MOTHU : the alpha particle number where the tree will start
        OPT   : a character string ;
                if it includes 'TRACK#', the ALPHA track number will be
                be displayed as well as the particle's name
                If not, only the particle's code will appear
      Output : The file txtree.tex is produced and updated at each
               call. It is also closed at each call, so that it can be
               latexed at any time
               A new file will be created at each job
               On VAXes the file is put automatically on the scweek: directory
      Here is an example of how to use it
     Find the index of a psi
        N=KPDIR('JPSI',-2)
     Find the mother of the psi
        MOTH=KMOTH(N,1)
     Produce the tree (labels only)
        CALL TXTREE(MOTH,'    ')
     Produce the tree (labels and track number)
        CALL TXTREE(MOTH,'TRACK#')
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
              TXTREE                                                               
                   |----  SIGN                                External             
                   |----  SQRT                                External             
                   |----  ABS                                 External             
                   |----  NINT                                External             
                   |----  KMATIX                              External             
                   |----  ATG                                 External             
                   |----  KCLARM                              External             
                   |----  IAND                                External             
                   |----  KLOCK0                              External             
                   |----  IABS                                External             
                   |----  INDEX                               External             
                   |----  TXWHEA                                                   
                   |----  TXKOD                                                    
                   |----  TXLINE                                                   
                   |----  TXWCLO                                                   
   
 
3 VDHITMAT
         SUBROUTINE VDHITMATCH
  ------------------------------------------------------------------------------
    CKEY MATCHING / INTERNAL
  ------------------------------------------------------------------------------
   Auxiliary to vdhmatch
    Match VDET hits with MC truth.  This uses the VDHT,FPOI banks for the
    MC truth, VCPL,VDXY and VDZY for the reconstructed hits.
    Author      Dave Brown, 30-6-94
    Modified: Paul Rensing 30-1-96
        Use new VDET geometry package.
        Assume VDET geometry is already initialized.
        Fix problem with MC hits right at edge of wafer.
   
 
3 VDHMATCH
  ------------------------------------------------------------------------------
    CKEY MATCHING / USER
  ------------------------------------------------------------------------------
         SUBROUTINE VDHMATCH(IALTRK,IMCTRK,NTRUE,NWRONG,NMISS,NDOUBLE)
   Count matching vdet hits for a given reconstructed/mctrue track.
    Author   Dave Brown, 18-7-94
    Modified: Paul Rensing 30-1-96  to be put in ALPHA 122 :
         Use new VDET geometry package
    The association of recontructed with MC track must have already been
    done (for example, by calling JULMATCH).
    This routine will ONLY work for POT/DST files, IE NOT ON MINIS !
    Input arguments :
     IALTRK  =  ALPHA track number of RECONSTRUCTED track
     IMCTRK  =  ALPHA track number of associated MONTE CARLO track
    Output arguments :
     NTRUE      =  # of true VDET hits on this track
     NWRONG(2)  =  # of hits on reconstructed track which truely came from
                      a track other than IMCTRK (split z/rphi)
     NMISS(2)   =  # of true hits not used in reconstruction (split z/rphi)
     NDOUBLE(2) =  # of hits on reconstructed track which are associated
                     with >=2 MC true tracks (split z/rphi)
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
              VDHMATCH                                                             
                   |----  VDHITMATCH                                               
                   |----  VFWAFI                              External             
                   |----  VAENWA                              External             
                   |----  VRMWF                               External             
                   |----  VADEWA                              External             
                   |----  VJWFFW                              External             
                   |----  MAX                                 External             
   
 
3 XCEQAN
         FUNCTION XCEQAN (ITK,IPC,IANTI)
  ------------------------------------------------------------------------------
    CKEY PART /USER
  ------------------------------------------------------------------------------
   Particle itk = ipc or its antiparticle ?
                                                     H.Albrecht 27.11.88
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
              XCEQAN.                                                              
   
 
3 XMRMP
         logical function xmrmp(dum)
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
      B.Bloch June 2000
      function is false when during a miniramp
                  true  when outside a miniramp ( Energy is stable)
         integer xhvbit
         parameter(ibit=18)
         iret = xhvbit(jhvst)
         xmrmp = btest(jhvst,(ibit-1))
         return
         end
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
              XMRMP                                                                
                   |----  XHVBIT                              External             
                   |----  BTEST                                                    
   
 
3 XPEQAN
         FUNCTION XPEQAN(ITK,CPAR,IANTI)
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Test if particle itk is of type cpar ( if ianti = 0 )
       or its antiparticle ( if IANTI .NE. 0 )
       J. Boucrot  10-Nov-1993           adapted from I.Tomalin   1/2/93
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
              XPEQAN                                                               
                   |----  KCANTI                                                   
   
 
3 XPEQOR
         FUNCTION XPEQOR(ITK,CPAR)
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Test if particle itk is of type cpar or its antiparticle.
       J. Boucrot  10-Nov-1993           adapted from I.Tomalin   1/2/93
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   IBFUNC                                                                          
   ISP                                                                             
   CCBMES                                                                          
   QTRUTH                                                                          
   KMLEPT                                                                          
   KNHCMC                                                                          
   KNMCHC                                                                          
        |---- XPEQOR                                                               
                   |----  KCANTI                                                   
   
 
3 XPEQU
         FUNCTION XPEQU(ITK,CPAR)
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Test if particle itk is of type cpar
       J. Boucrot  10-Nov-1993           adapted from I.Tomalin   1/2/93
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
              XPEQU .                                                              
   
