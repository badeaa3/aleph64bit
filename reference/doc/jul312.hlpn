1 JULIA

    on AXP/VMS:
         source:  JUL312:[*]*.F,JUL312:[INC]*.h
         library: JUL:JUL312.OLB, _D.OLB, .NEWS
         program: JUL:JUL312.EXE, _D.EXE
    on UNIX :  source:    $ALROOT/jul312/?_
               library:   $ALEPH/jul/libjul312.a  _dbx.a
               program:   $ALEPH/jul/jul312.0
  -----------------------------------------------------------------------------
 ! 20000320 JULIA 31.2 - Version for 2000 data-taking
             In h_news.h
     HMROAD : Fixed bug affecing MUID in last layer of endcaps (A.Sciaba')
             In l_news.h
     LHVSTA, LPRLUM, LSELBH : Calculate luminosity taking into account
              mini-ramp.                                        (P.Hansen)
             In r_news.h
     RINCND : Remove initialisation of ENERRC LEP energy            (M.Cattaneo)
     RINRUN : Use GETLEP to initialise ENERRC and RENLEP LEP energy (M.Cattaneo)
 			In s_news.h
     SICAOK : uses XLUM2K instead of XLUMOK to compute Luminosity
              whatever status has the Energy stability bit       (B.Bloch)
     SILUAD : stores two luminosities in 2000 in SLUM
              with XLUMOK = including only Energy stability bit ON events
              with XLUM2K = ignoring Energy stability bit
              backward compatible for previous years/MC/Z runs.. (B.Bloch)
     SICLEAN: makes use of the Alephlib routine SIBKCL           (B.Bloch)
     SIESUM : SIFSUM moved to Alephlib                           (M.Cattaneo)
  -----------------------------------------------------------------------------
 ! 19991208 JULIA 31.1 - Y2K compliant
                         must be linked with Alephlib>=314
                         must use ADBSCONS>=300
             In r_news.h
     RCJSUM : y2k fix to JSUM date                  (M.Cattaneo)
     RCPAS0 : Fix IDAT and format statement for y2k (M.Cattaneo)
     RINJOB : STOP if DB<300 or Alephlib<314        (F.Ranjard)
     RINCND : Fix format statement for y2k          (F.Ranjard) 
             In s_news.h
     SIPEDFX: Bug fix to correction of julia 31.0 - units are MeV, 
 		   not ADC counts                       (B.Bloch)
             In t_news.h
     TFCAND : Kill hits on a chain if there are more than 21 pad rows 
              in the chain, due to pattern recognition error that 
              should never happen.....                   (M.Cattaneo)
  -----------------------------------------------------------------------------
  * 19991110 corr file 310.1
             In e_news.h
     EFIXI99: Drop run header bank EDDB at start of 1999 (M.-N.Minard)
 ! 19991027 JULIA 31.0
             In e_news.h
     EFOLMK,ESVETO : Increase energy cut to 250 GeV  (M.-N.Minard)
             In f_news.h
     FCFRID : Set particle probabilities to 0.0 if they are smaller than 1.E-30
                                                                   (M.Cattaneo)
     FLV0DX : Call TPDHYP instead of obsolete TIDHYP (M.Cattaneo)
             In f_news.h
     LBHCOR : Double precision fixes for Linux       (D.Smith)
             In o_news.h
     OCBPRE : Double precision fixes for Linux       (D.Smith)
             In r_news.h
     RMONIT : Increase max PMOM to 150 GeV           (M.Cattaneo)
             In s_news.h
     SICLUS : Apply better calibration in delayed timing mode    (B.Bloch)
     SIEPCR : Introduce bunch dependent phi modulation           (B.Bloch)
     SIINIRU: Load SCBP instead of SCPH when runnning in HE mode (B.Bloch)
     SIPEDFX: Correct wrong pedestals in runs 50118-50122        (B.Bloch) 
     SICLC2,SRFIT0,SRFIT2,SRSELO,SRUPAR : 
              Double precision fixes for Linux                   (D.Smith)
             In t_news.h
     TFITHL,TMSHEL,TRHLX2,TWIREZ : Double precision fixes for Linux (D.Smith)
             In u_news.h
     UFITMS,UMXINV,UVPFIT,UVPMAT,UXSFIT,UXSMAT :
              Double precision fixes for Linux       (D.Smith)
             In v_news.h
     VDKLCP : Bug fix - Modification of the logic of the VKIL bank to 
                        delete the correct hits.
              Add protections for garbage collection. (P.Coyle, T.Kachelhoffer)
     VDKMCE : Add protections for garbage collection. (T.Kachelhoffer)
     VSPXYZ : Bug fix - Apply VRECOR correction only to real data
                                                      (P.Coyle, T.Kachelhoffer)
             In y_news.h
     YKVDET : Double precision fixes for Linux       (D.Smith)
  -----------------------------------------------------------------------------
  * 19990518 corr file 309.1
             In r_news.h
     RFJCON : Use clock frequency in Hz from TSOR bank (exists from run 49394)
                                                             (W.Wiedenmann)
             In t_news.h
     TRNCON : Read    clock frequency in Hz from TSOR bank (W.Wiedenmann)
     TSORDP : Display clock frequency in Hz from TSOR bank (W.Wiedenmann)
 ! 19990426 JULIA 30.9
   New version for 1999 data taking.
             In r_news.h
     RDEFIO : Add banks KWGT,SIID,BLUM to POT                (M.Cattaneo)
     RFORMA : Define SIID format                             (B.Bloch)
     RPOTCL : Drop BLUM from POT for all but random triggers (M.Cattaneo)
             In s_news.h
     SICLEAN: Extend background identification to other types,
              create and fill SIID  bank                       (B.Bloch)
     SICRPOT: Update pointer to PECO bank in SIID. 
              All clusters are transmitted                     (B.Bloch)
     SILUMI : Update pointer to SILU bank in SIID. Only valid
              clusters are considered to build the SILU bank   (B.Bloch)
     SICLUS : Move call to SICLEAN to the end                  (B.Bloch)
             In t_news.h
     TWIREZ : Bug fix - use IROWP instead of IROW (uninitialised variable) in 
              definition of IROWS. Screwed up check on whether a coordinate
              includes half-pads.                                 (D.Casper)
  -----------------------------------------------------------------------------
  * 981202 corr file 308.6
             In r_news.h
     RECEVT : Remove TPC hit smearing (A.Bonissent)
  * 981118 corr file 308.5
             In t_news.h
     TPDELS : Change value of logarithmic correction coefficient (J-Y.Nief)
  * 981116 corr file 308.4
             In t_news.h
     TPADDX : Bug fix - consider a large pad crossing angle (F.Palla)
  * 981109 corr file 308.3
             In b_news.h
     BCALJU : New - Create BCPO (BCAL POT bank) (P.Morawitz,G.Merino,M.Cattaneo)
     BCAREC : Obsolete. Will be removed from library in JULIA 309
     BCFILE : New - Translate BCAL raw data from ADC to Module mapping
                                                (P.Morawitz,G.Merino,M.Cattaneo)
     BCGETE : New - Read in BCAL raw data event (P.Morawitz,G.Merino,M.Cattaneo)
             In l_news.h
     LPREMC : Remove offline pedestal follower after run 45000 (P.Hansen)
             In r_news.h
     RDEFIO : New bank BCPO to POT, remove BLCT (can be made from BCPO)
                                                       (M.Cattaneo,P.Morawitz)
     RECEVT : Replace call to BCAREC (obsolete) with call to BCALJU (M.Cattaneo)
             In r_news.h
     SIPEDFX: New - Fix pedestal of specific runs          (B.Bloch)
     SIPREDA: Call SIPEDFX to fix pedestal problem if any  (B. Bloch)
  * 981014 corr file 308.2
             In e_news.h
     EPRTPC : Protect against divide by zero (M.Cattaneo)
  * 980928 corr file 308.1
             In r_news.h
     RECEVT : Bug fix: VDYEAR was declared as LOGICAL (A.Waananen)
             In t_news.h
     TMSHEL : Protect against divide by zero when DENOM=0.0, again (M.Cattaneo)
 ! 980914 JULIA 30.8
             In a_news.
     AAMAIN : Change TIMEST value to get better timing resolution (O.Callot)
             In r_news.h
     RLOOPR : Modify format statement (M.Cattaneo)
             In v_news.h
     Following 4 routines implement chip specific efficiencies in MonteCarlo
     for VDET95. Needs ADBS 240, Alephlib 308.3 or greater   (M.Thulasidas)
     VDKLCP : Introduced the new bank VDCE instead of the VDEM bank.
              (VDet Chip Efficiency map)
     VDMCEF : Move the VDKLCP section before the test on NOTDO
     VDMKCE : NEW - Makes the Chip efficiency map file VDCE from VDPR and VDCM
     VINIRU : Add VDPR, VDCM to list of banks to be loaded with the setup code
     VSPXYZ : Correct coordinate for additional bonding problems (VRECOR)
                                                                   (J.Rothberg)
  -----------------------------------------------------------------------------
  * 980824 corr file 307.4
             In r_news.h
     RLOOPR : Print also the processing time of the previous event (M.Cattaneo)
             In t_news.h
     The changes to TFTWTB and TRKELS fix the problem with dE/dx in the 
     reprocessing of 1991 data.
     TFTWTB : suppress missed hits if they will not be used           (D.Casper)
     TRKELS : ensure that zero charge samples remain zero after correction 
                                                                      (D.Casper)
     TTWODX : Bug fix: bank T2XS was not being extended a second time if 
              necessary                                             (M.Cattaneo)
  * 980708 corr file 307.3
             In r_news.h
     RECEVT : Change defaults for VGLOB. If VDYEAR < 95, VGLOB is
              default, otherwise not. Steering card VGLO forces VGLOB on
              NVGL forces VGLOB off                             (M.Cattaneo)
             In v_news.h
     VPRSUM : Improve test on VGLOB execution                   (M.Cattaneo)
  * 980608 corr file 307.2
             In s_news.h
     SICLEAN: NEW. Checks for quality flag of SiCAL cluster     (B.Bloch)
     SICLUS : Extend LMAXL to 400, 
              Compute quality flag for each cluster             (B.Bloch)
     SICRPOT: Exclude from PECO/PCRL clusters identified as
              electronic noise                                  (B.Bloch)
     SIINIRU: Load SNOI bank from database                      (B.Bloch)
     SILUMI : Skip identified electronic noise                  (B.Bloch)
     SIPREDA: Apply bunch dependent calibration also after 1997 (B.Bloch)
  * 980528 corr file 307.1
             In h_news.h
     HCORFC : NEW. HCAL tower energy correction for the bug that was 
              present on the online software in 1996, 1997 and early 1998 data
                                                                    (A.Sciaba)
     HPRANA : Add call to HCORFC                                    (A.Sciaba)
             In m_news.h
     MPREDG : If max no. of hits reached, fill MHIT up to max no. of hits
              rather than return empty MHIT                         (G.Bagliesi)
 ! 980502 JULIA 30.7
     This version will be used in Falcon for the 1998 data
             In e_news.h
     ECSW94 : EXIT JULIA if EAGC cards are missing when required
              (1994 raw data, run range 25000-25893)                (M.Cattaneo)
             In t_news.h
     TPREDA : Force use of unreduced wire data (raw data banks TWIR/TWDI)
              in run range 10000-11800 (1991)          (W.Wiedenmann,M.Cattaneo)
             In v_news.h
     VPREDA : Skip VDET reconstruction if VDOK (HV) not on         (A.Bonissent)
  * 980417 corr file 306.3
             In r_news.h
     RDEFIO : New bank BCHG to POT     (M.Cattaneo)
             In v_news.h
     VDECOD : Protect against corrupted raw data (A.Bonissent)
  * 980401 corr file 306.2
             In r_news.h
     RDEFIO : Banks FSHO, KMAR, KWTK to POT (M.Cattaneo)
  * 980324 corr file 306.1
             In t_news.h
     TWIREZ : Up to 1991 the banks (TSIR,TSDI,TSLE) 
              were called (TRIR,TRDI,TRLE)          (W.Wiedenmann)
 ! 980226 JULIA 30.6
     This version reimplements the TPC hit smearing for MonteCarlo. FRFT/0 and
     FRFT/2 contain the track parameters after refit with the smeared hits but 
     keeping the error matrix from the unsmeared fit. This gives the best 
     agreement between data and MonteCarlo. The track fit using the unsmeared 
     hits is still available in FRFT/10, FRFT/12. Note that the V0s, kinks etc.
     are done with the  smeared tracks.
             In r_news.h
     RECEVT : Move TPC hit smearing to after track fit and
              refit tracks with smeared hits (MonteCarlo only)  (A.Bonissent)
             In t_news.h
     TPSMR1 : Change the Z smearing proportional to the drift distance
              to an average smearing. Fixes cos(theta) dependence (Thulasidas)
     TREFIT : NEW Refit frft 2 tracks after monte carlo smearing (A.Bonissent) 
     TSMFT  : NEW Steering to smear and refit frft tracks in MC  (A.Bonissent)
  -----------------------------------------------------------------------------
  * 980226 corr file 305.4
             In s_news.h
     SICREC : Skip if setup code is zero (< 9209)                   (M.Cattaneo)
             In u_news.h
     UFITMS : Tighten numerical checks                              (D.Casper)
              Bring phi back into 0-2*pi range after Newtonian step (M.Cattaneo)
  * 980209 corr file 305.3
             In t_news.h
     TFITHL : Bug fix: Protect against arg SIN > 1.0 (M.Cattaneo)
     TFLNKS : Fix typo in "long-range" code. 
              Select best link, not first....        (D.Casper)
     TOVRLP : Changed scale factor in ITRKSW(2) to 10000 
              to allow for events with > 999 tracks  (I.Tomalin)
              Prevent track candidates from winding up with more 
              than one hit in a given padrow.        (D.Casper)
             In u_news.h
     UCTGFT : Test error return of UFITMS                          (D.Casper)
     UFITMS : Make sure all tracks have sensible covariance matrix (D.Casper)
              Fix precision problem for GG0P variable            (M.Cattaneo)
  * 971209 corr file 305.2
             In e_news.h
     ECLAMP : Rescale cut to effective threshold. Affects MC only (M.N.Minard)
     ECMOD  : Bug fix for overlap region (G.Taylor)
             In r_news.h
     RECEVT : Add TPC hit smearing (M.Thulasidas)
             In s_news.h
     SIINIRU: Suppress error message for missing SECT when setup<7  (M.Cattaneo)
             In t_news.h
     Add TPC smearing routines for MonteCarlo
     TPDIAG : NEW Finds eigen values and vectors from cov. mat.    (Thulasidas)
     TPHSMR : NEW smears the TPCO coordinates in accordance with the 
                  database bank TPSM for Monte Carlo events        (Thulasidas)
     TPRNDM : NEW generates random vars. from eigen values/vectors (Thulasidas)
     TPSMGT : NEW Used to read TPSM bank from database             (Thulasidas)
     TPSMR1 : NEW adds the smearing vector to the TPCO coordinates (Thulasidas)
  * 971205 corr file 305.1
             In l_news.h
     LHVSTA : use XLUMOK from ALEPHLIB (version>306)  (B.Bloch)
             In o_news.h
     OBSPOT : Call xvdeok instead of VDETOK (Needs Alephlib>306) (M.Cattaneo)
             In r_news.h
     RLOOPR : Fix format statement when event length > 1Mbyte (M.Cattaneo)
     RREVHE : Use xlumok from Alephlib (version>306)          (B.Bloch)
             In s_news.h
     SICAOK : use XLUMOK from alephlib (>306) for complete checks   (B.Bloch)
             In t_news.h
     TMSHEL : Protect against divide by zero when DENOM=0.0 (M.Cattaneo)
             In v_news.h
     VBSPOT : Call xvdeok (from Alephlib > 306) instead of VDETOK (M.Cattaneo)
     VDETOK : Obsolete. Use XVDEOK instead (Alephlib version>306) (M.Cattaneo)
 ! 971106 JULIA 30.5
             In a_news.h
     AJMMCL : fix variable type inconsistencies in function calls,
              for Linux                                           (A.Waananen)
             In b_news.h
     BCAREC : New - Create and fill BLCT bank  (G.Boix, I.C.Park, M.Cattaneo)
             In c_news.h
     CRCHRL : fix variable type inconsistencies in function calls,
              for Linux                                           (A.Waananen)
             In e_news.h
     EINIRU : Remove 'Temporary' (since before 1993!) call to EFIX  (M.Cattaneo)
     EFIX   : DELETED from library (was supposed to be temporary fix pending
              Alephlib fix, and did not have intended effect)       (M.Cattaneo)
     ETHRES : Rename 'LOCAL' common for work bank indices to 
              something more unique (CMETHR)                        (M.Cattaneo)
     E4BARY,E4FDIJ,EFIJOB : fix variable type inconsistencies in 
                            function calls, for Linux               (A.Waananen)
             In f_news.h
     FPIDEN : Obsolete, replaced by FCFRID                         (M.Cattaneo)
     FCFRID : Same as FPIDEN, but with option to do bit patterns for
              tracks only. Reaccess FRFT if garbage collection occurs 
              when creating FRID                          (D.Casper,M.Cattaneo)
             In g_news.h
     GASTEER : fix variable type inconsistencies in function calls, 
               for Linux                                           (A.Waananen)
             In h_news.h
     HCCONS.H : COMMON block is also defined in Alephlib with longer
                length. COPYed Alephlib definition to JULIA        (M.Cattaneo)
     HCLCRA : fix variable type inconsistencies in function calls, 
              for Linux                                            (A.Waananen)
             In i_news.h
     ITEXTN : fix variable type inconsistencies in function calls, 
              for Linux                                            (A.Waananen)
             In l_news.h
     LENLIS,LSELBA : fix variable type inconsistencies in 
                     function calls, for Linux                  (A.Waananen)
     LUPACR : Store X1RG, XTPB, XTCN, SFTR name indices locally (M.Cattaneo)
     LUPAIN : Suppress filling of x1namc COMMON due to clash with
              Alephlib in definition of same common             (M.Cattaneo)
             In r_news.h
     RDEFIO : New bank BLCT to POT     (M.Cattaneo)
     RECEVT : Call BCAL reconstruction (M.Cattaneo)
              Create track hit bit patters for secondary vtx. search (D.Casper)
     RLOOPR,RPRSUM,RREVEH,RUNKNO,RWREVT: fix variable type 
              inconsistencies in function calls, for Linux         (A.Waananen)
             In s_news.h
     SIBUN.H: New common block                                      (B.Bloch)
     SICLUS : In 1997 correct for time dependent gain if not 
              already done in SIPREDA                               (B.Bloch)
     SIINIRU: Load SECT bank                                        (B.Bloch)
     SIPREDA: Apply a bunch dependant calibration for delayed 
              timimg in 1997                                        (B.Bloch)
     SILHCR : Store XTBP,XTCN,X1SC name indices locally          (M.Cattaneo)
     STMASK,STRIGF : Deleted from Julia library. Identical routines
                     exist in Alephlib                           (M.Cattaneo)
             In t_news.h
     TSACOR : Bug fix: NLINK was called with TPCO bank index
              rather than name                               (A.Waananen)
     TLIPAK : fix variable type inconsistencies in function calls, 
              for Linux                                            (A.Waananen)
             In u_news.h
     UFITMS : fix variable type inconsistencies in function calls, 
              for Linux                                            (A.Waananen)
             In v_news.h
     VDECOD,VPREDA : fix variable type inconsistencies in 
                     function calls, for Linux                  (A.Waananen)
             In vglobnews.h
     VFTALL,VGBRAN,VGBRUT,VGFEVT,VGTCUT,VMCHIP,VMCLLD : fix variable 
              type inconsistencies in function calls, for Linux    (A.Waananen)
             In x_news.h
     X1NAMC.H : Deleted. COMMON block is also defined in Alephlib with 
                DIFFERENT variables                          (M.Cattaneo)
             In y_news.h
     YKSFIT : fix variable type inconsistencies in function calls, 
              for Linux                                            (A.Waananen)
  -----------------------------------------------------------------------------
  * 971027 corr file 304.3
             In t_news.h
     TPREDA : Correct 1997 T0 for problems (I.Tomalin)
  * 971017 corr file 304.2
             In t_news.h
     TPAKCO : Create PTNC even if FRTL and FTCL are missing (M.Cattaneo)
             In u_news.h
     UFITMS : Protect against divide by zero (M.Cattaneo)
  * 971001 corr file 304.1
             In e_news.h
     EBOXHI : Remove CALL from function references, for Linux. (A.Waananen)
             In f_news.h
     FITALL,FREFIT:Remove CALL from function references, for Linux. (A.Waananen)
             In r_news.h
     RTLSUM,RWRUNH:Remove CALL from function references, for Linux. (A.Waananen)
             In t_news.h
     TFITKF,TOVRLP,TSUMVD,TWIREZ :
                   Remove CALL from function references, for Linux. (A.Waananen)
             In v_news.h
     VDECOD,VDFSUP,VDRTAN,VHINIT,VSPXYZ :
                   Remove CALL from function references, for Linux. (A.Waananen)
             In y_news.h
     YKINIT : Remove CALL from function references, for Linux. (A.Waananen)
 ! 970819 JULIA 30.4
             In h_news.h
     HVMASK : Get database from LRGEOM rather than LRCONS (A.Sciaba')
             In l_news.h
     LPREMC : Resurrection of dead wires at storey 2/3 interface corrected,
              Storey energy redistributed in case of dead wires
              Suppress negative energies                          (P.Hansen)
     LPRLUM : Compensate for dead module in early 1997 running    (P.Hansen)
             In o_news.h
     OLSPOT : Remove apostrophes from strings passed to RERROR (D.Casper)
             In r_news.h
     RDEFIO : Add YSMO to POT                      (D.Casper)
     RFORMA : Add YSMO, correct YKNK,YSVT formats  (D.Casper)
             In s_news.h
     SIINIRU,SIINIJO : Move booking of SSTA internal bank from siiniru to
                       siinijo, to avoid problems when processing multiple
                       runs with different bunch train setups.   (M.Cattaneo)
             In t_news.h
     TCOOR,TCOORT,TSAWIR : Replace call to THPFDG with new routine THPCOR, 
                           to correct 1 half-pad coordinates too.   (D.Casper)
     TCSHF1 : New. Copy of TCSHFT to shift coordinates derived from 
                   sub-clusters with one, rather than two, half-pads (D.Casper)
     THPCOR : New. Copy of THPFDG to handle corrections for 
                   1 half-pad coords as well                        (D.Casper)
     TRNCON : Read TNRN from database                               (M.Cattaneo)
     TWIREZ : Protect vs. ABS(B1) .GT. RPAD                         (M.Cattaneo)
              Do not apply Landau to coords with half-pads, since the PH
              response is falling off at the sector edge.           (D.Casper)
             In v_news.h
     VDECOD : Protect against corrupted raw data (A.Bonissent, M.Cattaneo)
             In vglobnews.h
     VFTALL : Tracks identified as originating at a secondary vertex 
              have their errors and energy loss propagated only to the 
              corresponding point.                                  (D.Casper)
             In y_news.h
     YKFFIT : Suppress Kalman filter error message               (D.Casper)
     YKSRCH : Allow more than one bit to be set in the hypothesis mask, 
              if candidate passes more than one cut; if is INCOMING
              to two kink candidates, save only the best candidate 
              (smallest chi^2) to avoid confusing DALI, ENFLW, etc.  
              Also drop output bank at entry, if present.         (D.Casper)
  -----------------------------------------------------------------------------
  * 970718 corr file 303.7
             In a_news.h
     ALGTWA : Run 29977 also had bunch trains             (M.Cattaneo)
    	    In l_news.h
     LINIRU : Enable taking LDST from start of run record (P.Hansen,M.Cattaneo)
    	    In v_news.h
     VDJACB : Fix the missing JACOB(3) bug (in IV=2) (M.Thulasidas)
    	    In vglobnews.h
     VFTALL : Do not generate "Fatal" error if no track banks found (D.Casper)
  * 970716 corr file 303.6
    	    In e_news.h
     EPRTPC : Comment call to UFITQL (results are never used!!) (M.Cattaneo)
  * 970710 corr file 303.5
    	    In r_news.h
     RINCND : Protect against zero magnetic field: Set FIELRC to 0.0001
              if ALFIEL returns 0., produce a "fatal" error        (M.Cattaneo)
    	    In t_news.h
     TFCHEK : New - Check TPC helix parameters for basic sanity  (D.Casper)
     TFITTK : Protect against crazy fits by calling sanity check (D.Casper)
     TFLNK2 : Protect against crazy fits by calling sanity check (D.Casper)
    	    In u_news.h
     UCTGFT : Protect against crazy fits by calling sanity check (D.Casper)
  * 970707 corr file 303.4
    	    In l_news.h
     LIDCOD : Bug - ref. energy for method<9, run>40000 was wrong (P.Hansen)
     LSELBH : Bug - ref. energy for method<9, run>40000 was wrong (P.Hansen)
    	    In h_news.h
     HVMASK : Get run number with ABRUEV rather than from rcurnt.h  (A.Sciaba)
    	    In t_news.h
     TPLANA : Bug - Update IOFFS after calls to WBANK (M.Cattaneo)
  * 970616 corr file 303.3
    	    In l_news.h
     LCNAMC.H Add name index for BHZ0 bank                 (P.H.Hansen)
     LBHCOR : Use BHZ0 bank for LEP1 runs during LEP2 era  (P.H.Hansen)
     LBINDX : Initialize name index for BHZ0 bank          (P.H.Hansen)
     LIDCOD : Use BHZ0 bank for LEP1 runs during LEP2 era  (P.H.Hansen)
     LINIRU : Get BHZ0 bank from database                  (M.Cattaneo)
     LPRLUM : Use BHZ0 bank for LEP1 runs during LEP2 era  (P.H.Hansen)
    	    In vglobnews.h
     VGLINK : Create FXTR if it doesn't exist; primarily to 
              facilitate ALPHA interface                   (D.Casper)
  * 970609 corr file 303.2
    	    In r_news.h
     RECEVT : Bug fix - RDMIN was called with SEED=0. every time!  (M.Cattaneo)
    	    In y_news.h
     YKSFIT : Check basic quality cuts (minimum distance and #bad hits) 
              here rather than in calling routine, to avoid asking YTOP 
              for impossible fits                                 (D.Casper)
     YKSRCH : Remove basic quality cuts                           (D.Casper)
  * 970603 corr file 303.1
    	    In r_news.h
     RECEVT : Add call to RDMIN to initialise RANNOR (and RNDM) random
              numbers once per event.                              (F.Ranjard)
             In v_news.h
     VDOSMR : Remove call to NORRIN, replace RANNOR by VDGAUS      (M.Cattaneo)
     VDISMR,VDOSMR,VDWSMR : replace WRITE(6,*) by WRITE(IW(6),*)   (M.Cattaneo)
     VDXYZT : Replace call exit() by RERROR,
              Move 999 label to include BDROP of work banks        (M.Cattaneo)
 ! 970514 JULIA 30.3
    	    In f_news.h
     FITALL : Bug fix: KENKF was always 0 (not initialised)         (D.Casper)
    	    In h_news.h
     HCMASK.H New - COMMON containing MASKHV array            (A.Sciaba)
     HINIRU : Add call to HVMASK                              (A.Sciaba)
     HVMASK : New - Fills MASKHV with HV masking information from HSSR 
                    Slow Control bank                         (A.Sciaba)
     HMROAD : Take into account info in MASKHV when calculating expected
              number of hits in HCAL                          (A.Sciaba)
    	    In r_news.h
     RCPAS0, RIPAS0 : If PVGG card present, PASS0 drift velocity is taken
              from VDET/gamma-gamma for all runs taken with new VDET 
              (and not just LEP2 runs)                              (I.Tomalin)
     RDEFIO : Add new banks BCSC,BCSL,BCTR to output list          (M.Cattaneo)
     RDETEC : In PASS0 mode, force YNSV,YNLV,YNKF,TNPX,ENKF,VNSL   (M.Cattaneo)
              In PASS0 mode, switch on use of TPC wires by default (I.Tomalin) 
     RECEVT : Call VDET global pattern recognition if VGLO card found (D.Casper)
              Moved call to TSUMVD from RECONS to RECEVT           (I.Tomalin)
     RECONS : Moved call to TSUMVD from RECONS to RECEVT           (I.Tomalin)
    	    In t_news.h
     TGETQT : Restrict tan(lambda) to range +/-3                    (D.Casper)
     TJTOP  : Reverse the order of calls to TPAKCO and TFPCOI       (D.Casper)
     TPK1CO : Recalculate the coordinate errors for pad coordinates (D.Casper)
     TWIREZ : Protect vs. negative VARFIT(3)                        (D.Casper)
             In u_news.h
     UFITMS : Disable Newtonian for 3-hit tracks (D.Casper)
    	    In v_news.h
     VDRCUN, VINIRU : Mods to PASS0 to allow drift velocity to be taken for
              all data taken with new VDET (and not just LEP2 runs) (I.Tomalin)
     VPRSUM : Print end of job statistics for VGLOB code (P.Rensing)
    	    In vglobnews.h
     New package in JULIA to do VDET global pattern recognition in the context
     of the tracking upgrade. The package is called as an option in JULIA, by
     adding the steering card VGLO.
     IMPORTANT NOTE. This software is currently not officially supported in
     Aleph, since its authors (P.Rensing, J-F.Pusztaszeri) have left and noone
     has been found to take over responsibility.
    	    In y_news.h
     YKSFIT : Bug fix - do not call YFTVTC with identical input
              and output vertex arguments                       (M.Cattaneo)
  -----------------------------------------------------------------------------
  * corr file 302.6
    	    In t_news.h
     TPADDX : Add protection for logarithmic correction  (J-Y.Nief,D.Casper)
     TPDELS : Add log. correction to specific ionisation (J-Y.Nief,D.Casper)
    	    In y_news.h
     YKFFIT : Add protections against negative SQRT               (D.Casper)
     YKSRCH : Store a record of what mass cuts are passed in YKNK (D.Casper)
  * corr file 302.5
     In this correction file we implement the kinks package by P.Rensing
     with minor corrections by D.Casper
    	    In r_news.h
     RVDPRE : Protect against garbage collection in called routines (F.Ranjard)
    	    In t_news.h
     TWIREZ : Bug fixes - protect against -ve SQRT, initialize EZPAD2 (D.Casper)
    	    In v_news.h
     VDMSUP2: New. Update face extrapolation bank VDMS for true VDET
              hit position. Based on VDMSUP from ALEPHLIB. Used by
              kinks package (and VGLOB)
    	    In y_news.h
     YKNKCM.H New - Common blocks for kinks
     YKNKPT.H New - Common block for kinks
     YKFFIT : New - Full fit of two tracks to seach for a kink
     YKINIT : New - Initialize the cuts used in the Kink analysis
     YKLDC  : New - Load kink coordinate arrays for an FRFT track
     YKNEM2 : New - Find the mass^2 of a kink's neutral daughter
     YKSFIT : New - Simple fit of two tracks to seach for a kink
     YKSRCH : Main Kink search routine, replaces dummy routine from JULIA 302
     YKVDET : New - Look for free VDET hits which match the inner track
              of a potential kink. This routine is inserted in the library
              for completenes but is never called because it relies on VGLOB.
              The code calling it (in YKSRCH) is commented out.
  * corr file 302.4
    	    In v_news.h
     VRECLT : Bug fix. Do not reduce clusters of < 2 strips (A.Bonissent 020497)
  * corr file 302.3
    	    In t_news.h
     TFILTJ : Allow errors to be packed into 2 bytes instead of 1, to allow
              accurate refitting.  Scale factors changed accordingly. (D.Casper)
     TPK1CO : Remove requirement that errors fit into a byte, to allow
              scale factors to change and round-off to be reduced     (D.Casper)
  * corr file 302.2
    	    In r_news.h
     RDEFIO : Add KXME (Kingal output) to POT      (B.Bloch)
     RFORMA : Add KXME format                      (M.Cattaneo)
    	    In s_news.h
     SIPREDA : Apply bunch train correction only to 1995 data (B.Bloch)
  * corr file 302.1
    	    In r_news.h
     RDEFIO : Add LCRA (LCAL scintillator raw data) to POT      (M.Cattaneo)
     RFORMA : Add LCRA, VDTD formats                            (M.Cattaneo)
    	    In t_news.h
     TWIREZ : Use finer T0 offset correction (D.Casper)
 ! 970307 JULIA 30.2
    This version is the first official release of the tracking upgrade code.
    It does NOT contain the VGLOB global VDET pattern recognition package, nor
    the kink finding package, both by P.Rensing
    	    In a_news.h
     AAMAIN : Increase length of IW array to 3M words (from 2M) (D.Casper)
    	    In e_news.h
     EPRTPC : Extrapolate to ECAL from outermost TPC coordinate. (D.Casper)
              Do not extrapolate incoming tracks of kink.
              Can be disabled with ENKF card.
    	    In f_news.h
     FDETCO : Find DET coord. number for coord. on track            (F.Ranjard)
              (replaces FITCOR,FTPCOR,FVDCOR,TTGCLR by D.Casper)
     FITALL : Call new Kalman filter
              Remove filtered coords. from coordinates list         (D.Casper)
              Call FDETCO,FRMHIT                                    (F.Ranjard)
     FITWRI : Create packed POT bank PFXT from FXTR                 (D.Casper)
     FLNGV0 : New. Select V0 decaying into the TPC volume           (P.Spagnolo)
              Create high purity YLV0 bank for e.g. DALI            (D.Casper)
     FLV0DX : New. Calculate the dE/dX of track ITK assuming 
              Proton, Electron and Pion                             (D.Casper)
     FPMOVE : Redef. track params. relative to a new point in space (D.Brown)
              Use PI,TWOPI from alcons.h                            (F.Ranjard)
     FRMHIT : Remove DET hits contained in LIST from track ITRK     (F.Ranjard)
              (replaces FRMITH,FRMTPH,FRMVDH,TRMHIT by D.Casper)
     FTPCER : Return without error if TPCO 1 already exists         (D.Casper)
     FTRACK : Don't extrapolate tracks from a kink                  (D.Casper)
    	    In i_news.h
     IREFIN : Don't drop old ICCO, to keep valid coordinates (D.Casper)
     ITCINF.H Increase JRESMX from 80 to 200                 (D.Casper)
    	    In r_news.h
     RDEFIO : Tracking upgrade banks added to output list       (D.Casper)
     RECEVT : Call new modules VTRPRE, KINKS, NUCVTX (M.Cattaneo,D.Casper)
     RFORMA : Add PFXT,TRIK,TWZA,TWZZ,VGHC,VGXC,YKNK,YLV0,YNLI,
              YNVH,YS0L,YSTL,YSTC,YSTV,YSVT,YSVX,YSCL formats   (D.Casper)
     RVDPRE : New. Steer VDET track preselection                (M.Cattaneo)
     RPARAC.H Added modules VTRPRE, KINKS, NUCVTX               (M.Cattaneo)
    	    In t_news.h
     TCOOR  : Correct z for shaping effects
              Call new alignment routine TCRTRN instead of TCRTRA    (D.Casper)
     TCOORT : Correct subpulses for shaping effects
              Add wire coordinates
              Add TNLC,TNGS,TWNZ steering cards
              Call new alignment routine TCRTRN instead of TCRTRA    (D.Casper)
     TERPAR : Treat wire-corrected coordinates
              Replace TERN bank with TLCE                            (D.Casper)
     TFITHL : Cosmetic changes, add a protection on divide by 0      (D.Casper)
     TFITKF : Replace dummy routine                                  (D.Casper)
              Refit TGFT tracks using Kalman filter
              Remove hits flagged as outliers from coordinate list
              Replace calls to TTGCLR,TRMHIT with FDETCO,FRMHIT      (F.Ranjard)
     TFLNK2 : Treatment of track candidates (2 linked tracks)
              is now consistent with that in TFITTK                  (P.Colrain)
     TFLNKS : Protection added for DPHI > PI                         (P.Colrain)
              Use PI,TWOPI from alcons.h                             (F.Ranjard)
     TFPCOI : Include info on Landau corrections                     (D.Casper)
     TGETQT : **BEWARE** Changed calling sequence
              Support for shaping correction                         (D.Casper)
              Inline code instead of calls to TSHAP1,TSHAP2          (F.Ranjard)
     TINIJO : Default for bank TWPU changed to TRUE                  (D.Casper)
     TPADDX : Improved protection on bad coordinates                 (D.Casper)
     TPCREC : Refit after corrections and removal of filtered coords
              is now default. Switch off with TNFF card              (D.Casper)
     TRNCON : Read constants for pulse-shape correction from 
              TSHP bank on database.                                 (D.Casper)
     TSACOR : Flag coords modified by this routine to avoid
              correcting wire Z                                      (D.Casper)
     TSAWIR : Handle changed calling sequence of TGETQT
              Fix grotesque bugs in field/alignment correction
              Call new alignment routine TCRTRN instead of TCRTRA    (D.Casper)
     TSCFIL : Replace algorithm 1 with new code                      (D.Casper)
     TSHPCO.H New. Constants for correction of TPC pad pulses        (D.Casper)
     TWINCO : Handle changed calling sequence of TGETQT
              Call new alignment routine TCRTRN instead of TCRTRA    (D.Casper)
     TWIREZ : New. Process Landau corrections and wire Z coordinates (D.Casper)
              Inline code instead of call to TFUNL                   (F.Ranjard)
    	    In v_news.h
     VTRUTH : Removed from library (replaced by VTRURL in JUL285) (M.Cattaneo)
    	    In y_news.h
     YKSRCH : Main Kink search routine. Dummy for now   (M.Cattaneo)
  * corr file 285.1
         In r_news.h
     RDEFIO : Add PHMH to output list (P.Bright-Thomas 4/3/97)
         In t_news.h
     TSUMVD : Put TSVDWB COMMON in include file   (M.Cattaneo 4/3/97)
     TVDVEL : Put TSVDWB COMMON in include file   (M.Cattaneo 4/3/97)
     TALIGN.H Removed. Duplicated in Alephlib!!   (M.Cattaneo 4/3/97)
     TSVDWB.H New. Include file for TSVDWB COMMON (M.Cattaneo 4/3/97)
         In l_news.h
    LUPACR : Reinstate filling of trigger enable mask in LUPA (M.Cattaneo Jan96)
         In m_news.h
    MUREDO : Moved to Julia library from Alephlib (version 216) because it 
             calls Julia routines (A.Waananen 5/12/96, M.Cattaneo 19/02/97)
         In r_news.h
    RFORMA : Add VSPL bank (A.Bonissent, Dec96)
         In v_news.h
    VDXYZT :     keep track of strips which belong to two clusters
                 (after splitting) (A.Bonissent, Dec96)
    VUMCTR, VDMCTR, VDGTHT : handle properly strips which
                 belong to two clusters (A.Bonissent, Dec96)
    VTRURL : New routine, gives truth MC relation between hits and tracks
             (A.Bonissent, Dec96). 
             IMPORTANT NOTE: VTRURL supersedes VTRUTH (changed calling sequence)
             VTRUTH is obsolete and will be removed in a future JULIA version.
  * corr file 284.1
         In o_news.h
    OLSPOD : Minor bug fix (O.Schneider, November 1996)
    OLSPOT : Minor bug fix (O.Schneider, November 1996)
         In r_news.h
    RCPAS0 : ALLEP1 declared as logical, not integer (A.Waanenen 16/10/96)
    RIPAS0 : ALLEP1 declared as logical, not integer (A.Waanenen 16/10/96)
         In v_news.h
    VDECOD : Do not check for cable swap in MonteCarlo (PBT, Nov96) 
  -----------------------------------------------------------------------------
 ! 961009 JULIA 28.4
         In f_news.h
    FITALL : Fix bug which can result in losing association to ECAL cluster for
             track following a curling track in the track list 
             (A.Venturi 10/10/96)
         In m_news.h
    MPREDG : Ignore bits 8-11 in data from new Astros (G.Bagliesi 9-10-96)
         In r_news.h
    RIPAS0 : Detects if PVGG card is being used. (I.Tomalin 9/10/96)
    RCPAS0 : Fill's PASS0 banks with drift velocity from VDET + 
             gamma-gamma events if requested by PVGG card.(I.Tomalin 9/10/96)
         In t_news.h
    TSUMVD.F    : Truncated mean improved to make drift velocity calculation 
                   from VDET/gamma-gamma more reliable.
    TVDVEL.F    : Ditto.  (I.Tomalin 09/10/96)
         In v_news.h
    VINIRU.F : Request creation of VDZT banks during PASS0 if PVGG
               option being used. (I.Tomalin 09/10/96)
    VDRCUN.F : Ditto.             (I.Tomalin 09/10/96)
  * corr file 283.01
         In e_news.h
    ECCLUS : Change level of error 1 from Fatal to Warning
         In o_news.h
     Replace specific intrinsic functions with generic intrinsic functions
     obspot.F,ocbpre.F,ogtblq.F,olspod.F,olspot.F,olspou.F
         In r_news.h
    REPORT : Change message for non-fatal errors (M.Cattaneo 7 October 1996)
  -----------------------------------------------------------------------------
 ! 960924 - JULIA 28.3
         In g_news.h
    GAPECO : create PECO NR=1 bank also when PECO NR=0 has zero rows 
             (P.Janot 24/9/96)
         In o_news.h
    Upgraded OLSPOT to perform the alignment of the BOMs on a
    run-by-run basis; OLSPOT now makes a beam spot fit (using all the tracks
    in the run) with respect to the BOM+QS0 estimate. A new routine 
    OBSPOT, which is a modified copy of VBSPOT, is called by OLSPOT to do 
    that job. (O.Schneider, September 1996)
      olspot.F updated
      olspou.F updated
      olspod.F updated
      obsinr.F new: modified copy of vbsinr.F
      obspot.F new: modified copy of vbspot.F
      obsclr.F new: modified copy of vbsclr.F
      obmfit.F new: modified copy of vbmfit.F
      ocbfit.F new: modified copy of vcbfit.F
      obscom.h new: modified copy of vbscom.h
      ocbpre.F new: called in ocbfit.F to compute new track parameters
      ogtblq.F new: called in ocbpre.F to get unaligned BOM+QS0 position
         In v_news.h
    Replace expicit BOS macro declaration by #include bmacrod.h (O.Schneider)
    Affects: vbmfit, vbsclr, vbsinr, vbspot, vcbfit, vdosmr
  * corr file 282.01
    Fixes of comments and missing #ifndef DOCs for documentation. Affects
    documentation only.  (M.Cattaneo, 3 September 1996)
  -----------------------------------------------------------------------------
 ! 960719 - JULIA 28.2
         In e_news.h
    EGETDS : Replace LENOCC by LNBLNK (M.Cattaneo, July 1996)
         In l_news.h
    LINIRU : Force picking up of LDST bank from database (F.Ranjard, July 96)
         In o_news.h
    OLSPOD, OLSPOT, OLSPOU : New routines to get beam spot from LEP boms
                             (O.Schneider, June 1996)
         In r_news.h
    RLUNIT.H : Increase size of output bank list to 200 banks 
               (M.Cattaneo, July 96, requested by D.Casper)
    RCLRUN : Add call to OLSPOT (M.Cattaneo, June 1996)
    RECONS : Add call to OLSPOT (M.Cattaneo, June 1996)
    RFORMA : Add format for BLQP bank (M.Cattaneo, June 1996)
    RINJOB : Add BLQP to SUMLIS (M.Cattaneo, June 1996)
    RLTOCH : Replace LENOCC by LNBLNK (M.Cattaneo, July 1996)
    RSMJOB : Add call to OLSPOT (M.Cattaneo, June 1996)
    RUNKNO : Add call to OLSPOT (M.Cattaneo, June 1996)
  * corr file 281.03
         In l_news.h
    LOLERR : Fix cut against "sparks" at LEP 2 energy (P.H.Hansen 11-Jul-96)
         In s_news.h
    SILUMI : Fix energy cuts for high energy data (B.Bloch 11-Jul-96)
  * corr file 281.02
         In l_news.h
    LHVSTA : Make same event selection as XLUMOK for lumi. (P.H.Hansen July 96)
         In r_news.h
    RERROR : Fix bug: error was not reported on autoinitialising first call 
             (M.Cattaneo, June 96)
         In s_news.h
    SILUMI : Add protection for new acceptance cuts (M.Cattaneo 30-Jun-96)
         In t_news.h
    TVDVEL : More protections against small statistics (M.C, I.T. July 96)
         In v_news.h
      - VDMCEF : move the treatment of the new VDET to VDKLCP. It can not be 
                 done in VDMCEF because of multiplexing. (M.Thulasidas)
      - VDKLCP : New routine to take care of the efficiency map for the new
                 VDET, making sure that the multiplexed hits get killed
                 together. (M.Thulasidas)
         In x_news.h
    XTPENB : Make same event selection as XLUMOK for lumi. (P.H.Hansen July 96)
  * corr file 281.01
         In f_news.h
    FITALL : Fix bug which can result in overwriting BOS when an
             ITC track appears which has added a few TPC coordinates. (D.Casper)
         In o_news.h
    OMCORR : Allow beam energy greater than 50 GeV (O.Schneider)
    OSLOWC : Input data comes from banks LXCR,LXSP for LEP 2 (O.Schneider)
    OINIRU : Call OSLOWC also for run header banks (O.Schneider)
  -----------------------------------------------------------------------------
 ! 960603 - JULIA 28.1
         In a_news.h
    AAMAIN - Increase max number of BOS banks to 3000
    ABOLDR : remove #include version.h, since we don't have correction files
             with CVS. JULRUN makes sure JULIA version of routine is picked up.
         In f_news.h
    FPIDEN : Bugfix: TPC bits in NDZ start at 10, not 8,
             Remove duplicate call to NAMIND('FRFT')     (MC).
         In l_news.h
    LBDLBA, LSELBH, LTRIGS : replace WRITE(6, by WRITE(IW(6),
                                                (H.Drevermann, Feb 96)
    LBLDBA : Enable debug print                  (P.H. Hansen, May 96)
    LBHCOR : Fix reference energy from BHAB card (P.H. Hansen, May 96)
    LBNKPR : Only print when Lcal clusters exist (P.H. Hansen, May 96)
    LCALIB : Calibration sample is now method 10
             Flexible low edges on energy histos (P.H. Hansen, May 96)
    LCBOOK, LCHIST: Histogram Bhabha, single arm and other trigs
                    Do not use dropped banks from 'E' list
                                                 (P.H. Hansen, May 96)
    LELECT : Put LIDT back on 'T' list           (P.H. Hansen, May 96)
    LGNGBX : Use X1RG bank                       (P.H. Hansen, May 96)
    LHVSTA : Use X1RG bank                       (P.H. Hansen, May 96)
    LIDCOD : Fix reference energy from BHAB card (P.H. Hansen, May 96)
    LINIRU : Flexible low edges on energy histos (P.H. Hansen, May 96)
    LPRCAL : Print also expected energy          (P.H. Hansen, May 96)
    LPRLUM : Exact Luminosity calculation (if energy calib is OK):
             #bhabhas = method 10 with delta_phi>150 with HVs on)
             #background = (( -"-      delta_phi<30   -"-       ) -
                            (MC method 10  -"-      ))*
                           (singles combinations with delta_phi>150)/
                           (  -"-                     delta_phi<30)*
             lumi = (#babhas - #background)/((sigma from BHAB card*
                    (correction factor from LBHCOR))
             Nicer end-of-run print, also for print level 2
                                                 (P.H. Hansen, May 96)
    LSELBA : Fix reference energy from BHAB card
             Count combinations of single arm triggers without weights
             Drop cut on summed energy to gain statistics
                                                 (P.H. Hansen, May 96)
    LSINGL : check that HV is on for single arm triggers
             allow only one Lcal cluster
                                                 (P.H. Hansen, May 96)
    LTGBIT : Install a default 1996 trigger bit assignment
                                                 (P.H. Hansen, May 96)
    LTRIGS : Form combinations every 10 single arm trigger
                                                 (P.H. Hansen, May 96)
    LUPACR : Replace obsolete trigger banks by X1RG and X1TT
                                                 (P.H. Hansen, May 96)
         In r_news.h
    RWRUNH : RUNE added to the C list (P.Comas, Mar 96) 
         In v_news.h
    Changes to VDET alignment smearing routines to work with new VDET geometry
    (M.Thulasidas)
    Affects:
      - VDALSG, VDGTXL, VDSIGM, VDWSDX, VDWSMR
    New Routines:
      - VDINCP, VDJACB, VDRTAN
    Changes to MonteCarlo stream, to take care of efficiencies properly
    (M.Thulasidas)
    Affects:
      - VPREDA, VDMCEF
    New routine:
      - VDFSUP (replaces VDMCEF95)
    Rewrite fix for cabling errors using new bank VCAB (P.Bright-Thomas)
    Affects:
      - VDECOD, VINIRU
  * corr file 280.01
         In *CD -> E_NEWS
    E4FNEC : protect against divide by A(1)=0.   (D.Pallin, Mar 96)
    ECGFLW : protect against bad MonteCarlo data (M.Cattaneo, Mar 96)
    EPADCL : protect against bad MonteCarlo data (M.Cattaneo, Mar 96)
  -----------------------------------------------------------------------------
 ! 960305 - JULIA 28.0
         In *CD -> V_NEWS
    New clustering algorithm for low theta tracks : wafers 2 and 3 of
               1st layer; wafer 3 of 2nd layer (A. Bonissent, Jan 96)
    We exploit the fact that we know approximately the cluster size
       (nstrips) and pulse height.
    Affected : cluster finding and cluster splitting, subroutines :
     - RFORMA : define format for new bank VPHN
     - VDECOD : creat bank VPHN; declare variables types for implicit
               none
     - VDXYZT : declare variables types for implicit none; switch to
               low theta cluster separation when necessary
     - VRECLU : declare variables types for implicit none; switch to
               low theta cluster separation when necessary
     - VSEPAR : declare variables types for implicit none
       New subroutines :
     - VRECLT : find clusters in the low theta region (Z view)
     - VCLBNK : Put clusters in banks
     - VSEPLT : Split clusters in the low theta region (Z view)
     VBSPOT,VDSTCH : cosmetic changes to move to cvs: integer declara-
            tion no longer needed for HAC parameters (F.Ranjard, Feb 96)
         In *CD -> E_NEWS
    EIDEDX : call TPDHYP('WIRE', instead of TIDHYP. (FLR)
    ECSW94,ECBOOK,ELECID : opening "'" should have a closing "'" within
            the same line for cvs (F. Ranjard, Feb 96)
         In *CD -> F_NEWS
    FPIDEN : call TPDHYP('WIRE', instead of TIDHYP (FLR).
         In *CD -> L_NEWS
    LBDLBA, LSELBH, LTRIGS : replace WRITE(6, by WRITE(IW(6),
                            (H.Drevermann, Feb 96)
         In *CD -> U_NEWS
    UFITMS : replace WRITE(6, by WRITE(IW(6), (H.Drevermann, Feb 96)
         In *CD -> H_NEWS
    HPRANA,HPRANP,HPRDIG,HRCPAT,HTUBFI : opening "'" should have a
        closing "'" within the same line for cvs (F. Ranjard, Feb 96)
         In *CD -> P_NEWS
    PRYFIT : cosmetic changes to move to cvs (F. Ranjard, Feb 96)
         In *CD -> S_NEWS
    SICLUS,SIPREDA : opening "'" should have a closing "'" within
            the same line for cvs (F. Ranjard, Feb 96)
  * corr file 279.1
    ALGTWA : fix number of wagons for some fills (B. Bloch, Nov 95)
         In *CD -> C_NEWS
    CFPNMP, CRCJOB, CTHCLU : replace WRITE(6, by WRITE(IW(6),
                            (H. Drevermann, Feb 96)
    CTKCHG : opening "'" should have a closing "'" within the same
            line for cvs (F. Ranjard, Feb 96)
  * corr file 279.1
    CASHET : remove comments after *CA for LIGHT (P. Comas, Nov 95)
         In *CD -> I_NEWS
    IFIND1,IFIND2,IGETTI,IMATCH,IREOPD,ITBOOK,ITCTRK,ITLNK1,ITLNK2,
    ITRECF,ITRECI,ITREE,ITRKCI : opening "'" should have a closing "'"
         within the same line for cvs (F. Ranjard, Feb 96)
  * corr file 279.2
    IENANG, IPHCOR : avoid use of NLINK (O.Callot, Dec 95)
    IFITP  : optimize code as CHIELI always .ge.0 (O.Callot, Dec 95)
    IFIND1,IFIND2,IGICHA,IPREDA,ITCREC,ITRAK : call ALTIME only if ITTI
            card used (O.Callot, Dec 95)
    ITTIME : common modified to include logical IFITTI (O.Callot, Dec 95)
         In *CD -> M_NEWS
    MUASS,MUTEST : opening "'" should have a closing "'" within the same
            the same line for cvs (F. Ranjard, Feb 96)
    MUNEWR : change LOUTRL and LDEBRL to IW(6) instead of 6 (P.Comas,
            Feb 96)
  * corr file 279.2
    MUSLCM : bug which rejected 2% of the hits in the middle angle muon
            chambers fixed (A.Venturi, Dec 95)
         In *CD -> R_NEWS
    RINCND,RIPAS0,RMONII : opening "'" should have a closing "'" within
            the same line for cvs (F. Ranjard, Feb 96)
    RINJOB : change LOUTRL to IW(6) instead of 6 (P. Comas, Feb 96)
  * corr file 279.2
    AAMAIN : double size of BOS array from 1 to 2 Mw (O.Callot, Dec 95)
    RDETEC : set time measurement flags: for ITC, presence of ITTI
            (O.Callot, Dec 95)
    RNXMOD : call ALTIME only if MXTI card used (O.Callot, Dec 95)
    RSHRIN : avoid use of LENOCC (O.Callot, Dec 95)
         In *CD -> T_NEWS
    TFITHL : correct documentation: XF,YF,WF double precision (P.Rensing,
            Jan 96)
    TVDVEL : avoid dividing by zero when just one event is processed
            (M.Cattaneo, I.Tomalin, Feb 96)
  * corr file 279.2
    TPDELS : bug that made track 1 lose its pad dE/dx info fixed (D.Casper,
            Dec 95)
    TPCREC,PADDEDX : call ALTIME only if TPTI card used (O. Callot, Dec 96)
    TPCT0  : aesthetic changes required by LIGHT (P.Comas, Jan 96)
  * corr file 279.1
    TPADFX : remove comments after *CA for LIGHT (P. Comas, Nov 95)
  -----------------------------------------------------------------------------
 ! 951116 - JULIA 27.9
         In *CD -> A_NEWS
    make several cosmetic changes in several sets to move easily to CVS
    (F. Ranjard, Nov 95)
         In *CD -> V_NEWS
    VDRCUN : never produce hot channels for new Vdet (A. Bonissent,
            Nov 95)
  * corr file 278.3
    VRECON : change number of channels (A. Bonissent, Nov 95)
    VDECOD : make max. number of channels in z view, useful
            for wraparound cluster (A. Bonissent, Nov 95)
    VINIRU : offset of online channels is diffent for old and
            new VDET (A. Bonissent, Nov 95)
    VMKR95 : initialize package which handles bonding maps
            (A. Bonissent, Nov 95)
    VDSM95 : handling of the nominal bonding scheme (A. Bonissent,
            Nov 95)
    VMGCRL : decode wafer number, apply channel to strip mapping and
            fill relation from data channel to readout strip
            (A. Bonissent, Nov 95)
    VTRSUP : transform electronic channel number from Galeph
            into data channel (A. Bonissent, Nov 95)
  * corr file 278.2
    VDMCEF95 : suppress hits in dummy faces in Oct 95 installation of
              new VDET. Supersedes routine of last correction file (A.
              Bonissent, Oct 95)
    VHOTIN   : control usage of VHOT bank with a data card VNHT and
              protection against VHOT inconsistency (A. Bonissent, Oct95)
    VDSM95   : protect for nonsense in VHOT (A. Bonissent, Oct 95)
    VINIRU   : initialization of beam position finding moved to RINIRUN
              (S.Wasserbaech, Nov 95)
  * corr file 278.1
    VDMCEF95 : new routine for MC efficiency of new  Vdet (A. Bonissent
              Oct 95)
    VRECLU   : fix a bug in clustering (only for new Vdet) (A. Bonissent
              Oct 95)
    ALCBJJ, ALLRJJ : comdecks dropped (S. Wasserbaech, Oct 95)
    ALPBJJ, VBSCOM : comdecks modified (S. Wasserbaech, Oct 95)
    ALRPJJ, VBPCJJ : comdecks added (S. Wasserbaech, Oct 95)
    VBSPOT   : huge bug fixed : number of VDET z hits was not correctly
              calculated (S. Wasserbaech, Oct 95)
    VBMFIT, VBSCLR, VBSINR, VCBFIT : change from to ALLR and ALCB to ALRP
              and VBPC; allow tau-tau rejection and VDET hit definition to
              be switchable for LEP1 and LEP2, little protection for LEP2
              against cosmics, better handling of failures in VCBFIT, add
              features to allow JULIA routines to be used in ALPHA without
              modification (S. Wasserbaech, Oct 95)
    VDNOIS : move DATA statement just before BMACRO to allow compilation in
            Linox (P. Comas, Oct 95)
         In *CD -> T_NEWS
    TPDXJJ, TPADCL, TPLSJJ, TPXSJJ, TP1XJJ, PTPXJJ :
             new comdecks added for pad dE/dx (D. Casper, Nov 95)
    TPADDX : store subcluster pulseheights in TPDX for measurement
            of pad dE/dx (D. Casper, Nov 95)
    TCQGS3 : compute coordinate charge assuming Gaussian, based on
            TCOGS3 (D. Casper, Nov 95)
    TPDELS : create TPXS bank of truncated means for pad dE/dx
            (D. Casper, Nov 95)
    TFITKF : dummy routine to replace TFITKF (D. Casper, Oct 95)
    TWIREZ : dummy routine to replace TWIREZ (D. Casper, Oct 95)
    FTPCER : get wire correction flag (D. Casper, Jun 95)
    TMONIT, TPTIME, TSTATE : pad dE/dx variables added
                            (D. Casper, Nov 95)
    TACCMN, TCOALG, TCOOR, TCOORT: modified to allow inclusion of
                                  pad dE/dx (D. Casper, Jun 95)
    TERPAR : new argument added for the eventual implementation of
            Landau correction for TPC coordinates (D. Casper, Nov 95)
    TINIJO : add pad dE/dx monitoring (D. Casper, Nov 95)
    TKSGDP : add pad dE/dx info (D. Casper, Nov 95)
    TPAKTX : add pad dE/dx banks (D. Casper, Nov 95)
    TPCREC : calculate dE/dx from pad pulses, refit after corrections
            and remove filtered hits from cord list (D. Casper, Nov 95)
    TPRSUM : add pad dE/dx statistics (D. Casper, Nov 95)
    TRNCON : read pad dE/dx constants, book histos (D. Casper, Oct 95)
    TSAWIR : support for pad dE/dx in TCOALG (D. Casper, Jun 95)
  * corr file 278.4
    TSUMVD : new routine to fill TSVD bank with VDET z residuals
            w.r.t. TPC tracks (I. Tomalin, Nov 95)
    TPCRUN : add call to TVDVEL (I. Tomalin, Nov 95)
    TVDVEL : new routine to create TVVD bank and fill it with TPC drift
            velocity calculated using VDET residuals (I. Tomalin, Nov 95)
    TVVDJJ : new comdeck added (I. Tomalin, Nov 95)
  * corr file 278.1
    TFLNK2 : protect against straight tracks (I. Tomalin, Oct 95)
    TRKELS, TWIRES : move DATA statement just before BMACRO to allow
            compilation in Linox (P. Comas, Oct 95)
         In *CD -> R_NEWS
    RCPAS0 : for VDET95, avoid messing around with VHOT and TOHV
            (A. Bonissent, Nov 95)
    RPOTCL : on popular request , for SICAL or LCAL only triggers,
            keep as well banks PCOB,PCRL,EWHE (B. Bloch, Nov 95)
    RFORMA : define format new pad dE/dx banks: PTPX, TPDX, TPXS,
            TPLS (P. Comas, Nov 95)
    RDEFIO : add pad dE/dx bank PTPX to the POT (P. Comas, Nov 95)
  * corr file 278.4
    RGETDV : make 'ONL' option always equivalent to PASS0 (I. Tomalin,
            Nov 95)
    RCPAS0 : interpret new TLAS bank correctly when creating PASS0
            cards (I. Tomalin, Nov 95)
    RFJCON : write error on TPC drift velocity to JCON bank using
            TLAS if TDPV is missing (I.Tomalin, Nov 95)
    RINJOB : add TVVD, TDPV and TLAS banks to run summary bank list
            (the latter two maybe temporarily) (I.Tomalin, Nov 95)
    RECONS : add call to TSUMVD (I. Tomalin, Nov 95)
  * corr file 278.2
    RINRUN : initialize beam position finding (S. Wasserbaech, Nov 95)
    RCLRUN : always close beam position stuff at the end of the run
            (S. Wasserbaech, Nov 95)
  * corr file 278.1
    RECEVT : process VDET regardless the number of tracks if not in
            LEP1 (P.Comas, Oct 95)
         In *CD -> E_NEWS
  * corr file 278.1
    ECSW1093 : move DATA statement just before BMACRO to allow
              compilation in Linox (P. Comas, Oct 95)
         In *CD -> S_NEWS
    SILUAD : automatise the energy dependence of the Lumi x-section
            (B. Bloch, Nov 95)
    SIEVST : pick up a better curve from the Data Base if available
            (E. Lancon, Nov 95)
    SIINIRU: get SHLD bank from Data Base (B. Bloch, Nov 95)
    SHLDJJ : new comdeck added (B. Bloch, Nov 95)
  * corr file 278.2
    SICAL modifications for the high energy run and 95 reprocessing
    SECAJJ, SIBXJJ : new comdecks added (B. Bloch, Nov 95)
    SIEVST : new routine: returns the energy at a given time along
            the Hold timing curve (E. Lancon, Nov 95)
    SIJUKE : new routine: decode juke box configuration (E. Lancon,
            Nov 95)
    SIGTWA : decode SICAL Hold number from SILH or SCHU bank (B. Bloch,
            Nov 95)
    ALGTWA : for the 140 Gev , SICAL will be set with one Hold except
            for 4 runs (B. Bloch, Nov 95)
    SIINIRU: get from Data base SECB and SIBX banks (B. Bloch, Nov 95)
    SILUMI : in Lumi anlysis of 1995 consider only in-time clusters
            (B. Bloch, Nov 95)
    SIPREDA: correct energy of SICAL in physics triggers according to
            bunch number (B. Bloch, Nov 95)
         In *CD -> L_NEWS
  * corr file 278.3
    LBHCOR : check whether we are on the Z (P. Hansen, Nov 95)
    LPRLUM : scale background by ratio of bhabhas with HV on and
            and total bhabha count (P. Hansen, Nov 95)
  -----------------------------------------------------------------------------
 ! 951009 - JULIA 27.8
         In *CD -> H_NEWS
    HT0CJJ : new common deck added (A.Messineo, Aug 95)
    HTOWCA, HCATOW, HRDCAL: Barrel and endcap normalization
                           per wagon (A.Messineo, Aug 95)
    FTRACK, MUCUTS : protect to avoid overflow in PIBE2 (P.Comas, Aug 95)
         In *CD -> U_NEWS
    UFITMS : rearrange DASIN argument to avoid crash (P.Comas, Sep 95)
         In *CD -> I_NEWS
    INSECT : Add test for intersection. Also tighten sin(A) test to
            not allow angles too near 90 deg (J.Sedgbeer, Aug 95)
         In *CD -> F_NEWS
    FITALL, FREFIT : replace references to obsolete UFTTRK by UFTTRA
               (G. Taylor, Sep 95)
         In *CD -> R_NEWS
    RLOOPR : Filter out TPC laser events writing only the EVEH
            (P.Comas, Aug 95)
    RFORMA : format of new VDET banks VCSG, VWRL, VDMR, VDGC
            (P.Comas, Sep 95)
    RDEFIO : new VDET banks VWRL, VDMR, VDGC to POT (P.Comas, Sep 95)
  * corr file 277.2
    RDEFIO : new MC bank X1TP to POT (P.Comas, July 95)
    RCJSUM : add as many rows as wagons in a train and fill them
            (P.Comas, Jul 95)
    BMSUMCO : common modified to have BMSUM information per wagon
           (P.Comas, Jul 95)
    BMSUM : have the information per wagon in a train (P.Comas
           Jul 95)
         In *CD -> S_NEWS
    ALGTWA : The 95 scan is done with 3 wagons (B.Bloch, P.Comas, Aug 95)
  * corr file 277.2
    ALGTWA : integer function to get the number of Sical wagons per train
    SIINIRU: use ALGTWA instead of RQBUNC
    SIPRLUM: use ALGTWA instead of RQBUNC
    SILUAD : fix the statistical error on Lumi when bunch train operation
         In *CD -> T_NEWS
  * corr file 277.2
    TRNCON : call RERROR if no TSOR bank is present (I. Tomalin,
            Jun 95)
         In *CD -> V_NEWS
    VUMCTR, VDMCTR : change the corrections given by A.B in 277.1 by
                    those from G.Taylor (Aug 1995)
    VHOTIN : Put VHOT on the C list, so it isn't dropped
            (A. Bonissent, Aug 95)
    VDPINH : new routine to simulate peculiar readout channels in MC
            (G. Taylor, Aug 95)
    VDCHST : new function to map electronic readout channel to physi-
            cal readout strip (G. Taylor, Aug 95)
    VDSTCH : new function inverse to the previous (G. Taylor, Aug 95)
    VDMPIN,VINIRU,VDGTHT,VTRUTH: modified for the new MC treatment
            of delta rays (G. Taylor, Aug 95)
    VDGCJJ,VDMRJJ,VWRLJJ : new common decks (A. Bonissent, Sep 95)
    VCSGJJ,VREGJJ : common decks modified (A. Bonissent, Sep 95)
    VDMJLN : SAVE statement added (P. Rensing, Sep 95)
    VDSM95,VTRSUP,VMKR90,VMKR95,VMGCRL : new routines to handle new
            VDET and allow a different treatment of old Vdet (A. Boni-
            ssent, Sep 95)
    VDECOD,VDMPIN,VRECLU,VDXYZT,VSPXYZ,VCRHOT,VHOTIN,
    VDNOIS,VTRUTH,VCALCM,VCMEAN,VDBGCL,VDSMAP,VINIRU
    All routines modified to addapt to the different treatment for old
    and new Vdet (A. Bonissent, Sep 95)
  * corr file 277.2
    VCBFIT : protect RSINV against an error return (P.Comas)
    VMGNJJ : hac parameters modified (A.Bonissent)
    VDMPIN : use changed VMGN modified to contain also first and last
            channel in a region (A.Bonissent)
  * corr file 277.1
    VUMCTR, VDMCTR : correction to process GALEPH events made with old
                     vdet geometry package (A.Bonissent)
         In *CD -> E_NEWS
  * corr file 277.3
    ECFIBT : PWEI bank corrected for calibration and change fatal
            error by warning error when EWDI does not exist
            (M.N.Minard, Aug 95)
    ECFILS : change fatal error by warning error when EWDI does not
            exist (M.N.Minard, Aug 95)
    ECHEDC : bug fix when applying calibration (M.N. Minard, Aug 95)
  -----------------------------------------------------------------------------
 ! 950530 - JULIA 27.7
         In *CD -> V_NEWS
    VHOTOF, VCALCM, VCMEAN, VCRHOT, VDBOOK, VDCRUN, VDECOD, VDHIST, VDLINK,
    VDMPIN, VDNOIS, VDRCUN, VDXYZT, VDSMAP, VHINIT, VHOTIN, VINIJO, VINIRU,
    VLCPOS, VPREDA, VPRPOT, VPRSUM, VRECLU, VRECON, VREPOS, VSEPAR, VSLOWC,
    VPRTNC, VDFLGS,
    All decks purged and rewritten (Vdet prepare data).
    - Forget about peculiarities for 1990 Vdet data
    - Use geometry package to obtain information about Vdet topology
    - Redesign and clarify the code
            (D. Brown, A. Bonissent, M. Thulasidas, April 1995)
    VDISMR : Check VDHT bank is there (M. Thulasidas, May 95)
  * corr file 276.1
    VBSPOT : Use ABS on d0 and z0 cuts; remove call to VDAMB
            (S.Wasserbaech, Apr 95)
    VBMFIT : Use existing first-event-in-chunk number when
            NEWROW = .FALSE. (S.Wasserbaech, Apr 95)
    VBSCLR : Do not create a new row if the first row is not
            yet filled (S.Wasserbaech, Apr 95)
    VCBFIT : Take beam size from ALLR instead of data statement
            (S.Wasserbaech, Apr 95)
    VBSINR : Always clear the work banks (number of rows = 0)
            Get ALLR from daf (S.Wasserbaech, Apr 95)
    ALLRJJ : Comdeck added to be used in VCBFIT
            (S.Wasserbaech, Apr 95)
         In *CD -> T_NEWS
    TPCBUN : Improved (I. Tomalin, May 95)
    TPCT0N : Improved to reduce sensitivity to V0's (I. Tomalin,
            May 95)
  * corr file 276.4
    TPCBUN : new routine to determine TPC bunch number and set the
            quality flag (M.Girone, I.Tomalin, Apr 95)
    TPCT0N : modified from TPCT0 to include error on DT  (M.Girone,
            I.Tomalin, Apr 95)
    TPCREC : calculate TPC bunch number (I.Tomalin, Apr 95)
    TPREDA : correct T0 for bunch trains (I.Tomalin, Apr 95)
    TRNCON,TPCCON : added TVOFS0 and TPCCLK to common TPCCON to cope
            with bunch trains (I.Tomalin, Apr 95)
         In *CD -> S_NEWS
  * corr file 276.1
    SIPREDA: Allow reprocessing from POT to POT when SIDI not available
             apply overall energy scale factor in calibration mode only
    SILHCR : Allow reprocessing from POT to POT
    SILUMI : Allow reprocessing from POT to POT
         In *CD -> L_NEWS
    LBUNCA : new routine for bunch-to-bunch calibration in LCAL
            (P.Hansen, Apr 95)
    LPREMC : bunch-to-bunch corrections for bunch trains
            (P.Hansen, Apr 95)
         In *CD -> E_NEWS
  * corr file 276.4
    EDWIJJ,PWEIJJ : new common decks added (M.N. Minard, May 95)
    EWDIFP : addapt to bunch trains and use of PWEI
                   (M.N. Minard, Apr 95)
    ECERAS,CPADWR : use of PWEI (M.N. Minard, Apr 95)
    ECFILS : check the Pastis configuration - 1995 and call ECFIBT
            (M.N. Minard, Apr 95)
    EPADCL,EWIRCL,ETDIFP,ECHEDC,ECHICA : addapt to bunch trains
                                 (M.N. Minard, Apr 95)
    ECFIBT : new routine for wires banks analysis in bunch trains
            (M.N. Minard, Apr 95)
    EFIXI94: artificially built EKLS bank of zero length to put to
            zero the number of killed channels (M.N.Minard, Apr 1994)
         In *CD -> R_NEWS
    RCJSUM : improve PASS0 drift velocity calculation (I.Tomalin,
            May 95)
    RDEFIO : new banks HLOD to POT (P.Comas, May 95)
  * corr file 276.4
    RWJUBW : new routine to store bunch number identification used for
            reconstruction in EVEH (P.Comas, Apr 95)
    RCJSUM : only sum up t0 for events where bunch number is certain.
            (I.Tomalin, May 95)
    RDEFIO : new banks PWEI and LPAS to POT (P.Comas, May 95)
    RFORMA : format of new bank PWEI (P.Comas, May 95)
    RINRUN : add call to RWJUBW (bunch number used for reconstruction)
            (P.Comas, Apr 95)
    RLOOPR : add call to RWJUBW (bunch number used for reconstruction)
            (P.Comas, Apr 95)
    RMONIT,MINHEA : addapt to use PWEI (M.N.Minard, Apr 95)
  -----------------------------------------------------------------------
 ! 950410 - JULIA 27.6
         In *CD -> V_NEWS
    VDLINK : Call VDMCTR to compress Monte Carlo truth info
            (A.Bonissent, Mar 95)
    VDMCTR,VTRUTH,VUMCTR : Compress Monte Carlo truth info
            (A.Bonissent, Mar 95)
    VDALIN,VDALXY,VDALZT,VDALSG,VDGTHT,VDGTMV,VDGTXL,VDOSMR,VDRNDM,
    VDSIGM,VDTAN,VDWSDX,VDWSMR,VDGAUS : New treatment of alignment
    errors for 1994 Monte Carlo production  (M.Thulasiadas, Mar 95).
    VDMCEF : Take out position smearing (M.Thulasiadas, Mar 95).
    VPREDA : Call VDISMR for smearing (M.Thulasiadas, Mar 95).
    VDISMR : Set up appropriate smearing scheme (M.Thulasiadas, Mar 95).
  * corr file 275.3
    VBSPOT : avoid taus to measure the beam spot (S.Wasserbaech).
         In *CD -> E_NEWS
    EFIXI94: artificially built EKLS bank of zero length to put to
            zero the number of killed channels (M.N.Minard, Apr 1994)
  * corr file 275.4
    ECCLUS : ESDA internal storey bank used in clusterisation is dropped
            when cluster bank is dropped (M.N. Minard, Feb 1995)
         In *CD -> R_NEWS
    RFORMA,RDEFIO: add VDFK,VUFK to output list (A.Bonissent,
                  M.Thulasiadas, Mar 95)
  * corr file 275.5
    RDEFPO : call LUPACR when LCAL .and. SATR are required. If one is
             missing the name-indices are not defined (F.Ranjard, Feb 95)
  * corr file 275.4
    RDEFPO : reverse order of processing: first LCAL, after SICAL
            (B. Bloch, P. Comas, Feb 1995)
  * corr file 275.3
    RDEFIO : replace old GAMPEX bank PGPC by the new one PGAC (M.N. Minard,
            (Nov 1994)
    RFORMA : format of new Ecal banks EAGC, PGAC (M.N. Minard, Oct 1994)
         In *CD -> S_NEWS
  * corr file 275.4
    SIPREDA: Process next pad in case of 'Invalid SIDI Address' (B.Bloch,
            Feb 1995)
         In *CD -> T_NEWS
  * corr file 275.5
    TCODRV : drop work banks at the end (D.Casper, Feb 95)
         In *CD -> M_NEWS
  * corr file 275.5
    MPREDG: correction for bad cabling in first runs of 1994 data,
           from 25000 to 25895 (P.Campana, Feb 95)
  ------------------------------------------------------------------------
 ! 941019 - JULIA 27.5
         In *CD -> C_NEWS
    CDANG : restrict COMN1 to [-1.,1.] to avoid precision problems
           (P. Comas, 18-OCT-1994)
    CTRPAR : avoid division by zero: no need to step in the helix if
            STEP = 0  (A. Bonissant,P. Comas, 29-SEP-1994)
         In *CD -> L_NEWS
    LESTIM : prevent division by zero (P. Hansen)
         In *CD -> E_NEWS
    EAGCJJ : new common deck added (M.N. Minard, Oct 1994)
    EGETDS : for 94 running drop EKLS EKPL wrong on the header (same)
    EPREDA : in case of raw data from run range 1994 (<25854)
            swap gain map of endcap A (same)
    EFIXI94: new subroutine to drop EKLS EKPL banks (same)
    ECSW94 : new subroutine to swap gain for ETDI, active only on 1994
            raw data run<25894 (same)
         In *CD -> G_NEWS
    GASTEER : Build PGID and PGPC (Bulos+Gampex) bank
             (M.N. Minard, Oct 1994)
         In *CD -> R_NEWS
    RFORMA : format of new Ecal banks EAGC, PGAC (M.N. Minard, Oct 1994)
  * corr file 274.1
    RFJCON : remove call to TDEDXV. Fill JCON bank with /TMONIT/GAINTM.
         In *CD -> M_NEWS
  * corr file 274.1
    MUASS: allow to have the MUEX banks in the data even
           if there is no hit in the muon chambers (A.Venturi).
         In *CD -> T_NEWS
  * corr file 274.2
    TOERJJ : update HAC parameters (G. Ganis)
    TCPTST : fill TOER bank extended with 5 more words (G. Ganis)
    TSAWTK : protect code to prevent JULIA crashes in '93 MC production
             on ALPHAs (C. Georgiopoulos)
         In *CD -> V_NEWS
  * corr file 274.3
    VBSINR : create working bank only once (E.Lancon).
         In *CD -> I_NEWS
  * corr file 274.3
    INSECT : protect against square root of negative value (P.Comas).
         In *CD -> R_NEWS
  * corr file 274.5
    see comment on 274.4
  * corr file 274.4
    RLOOPR : only the EVEH of events with DAQ error as evtype (998)
             is passed on to the POT. These events are not recons-
             tructed.
             The original correction on JULIA 274.3 passed the whole
             event without any processing. This final one was JULIA
             274.4 on FALCON but on the other computers JULIA 274.4
             was released with another correction (TRNCON) while I
             (P.Comas) was away.
             corr file 274.5 will contain both final corrections to
             RLOOPR and TRNCON.
         In *CD -> T_NEWS
  * corr file 274.5
    see comment on 274.4
  * corr file 274.4
    TRNCON : wire pedestal is set to 0 in absence of TCLB or TSIM bank
             for runs >= 28834. From now on wire pedestals are substracted
             online. Pad pedestals are set to 4. TCLB bank does not
             contain wire pedestals since run 28834 and must be ignored.
             JULIA 274.4 contained a first version of this change and in
             FALCON, JULIA 274.4 contained a correction to RLOOPR. To
             avoid confusions, both are released as 274.5 to avoid mixture
             of versions.
   ---------------------------------------------------------------------------
 ! 940520 - JULIA 27.4
         In *CD -> X_NEWS
    XPTENB : use of X1RG instead of XTOP dropped in the readout upgrade
    X1TT, X1RG, X1HI : HAC parameters of new trigger banks added as common decks
         In *CD -> L_NEWS
    LPRLUM : use of X1TT instead of XTOP dropped in the readout upgrade
    LSELBA : use of X1RG and X1TT instead of XTOP dropped in the readout
            upgrade
         In *CD -> R_NEWS
    RINJOB : replace JTDX by JHDX in SUMLIS summary output list.
    RMONIT : remove call to TDXMON,Fill the dE/Dx word of the MONE bank
             with a constant 1.0
    RECEVT : remove call to TDXMON, everything is done in TACCMN
  * corr file 273.2
    RFORMA,RDEFIO: add D4CD bank to output list (G.Taylor).
                   remove SOR new trigger banks put by error in
                   corr file # 1
  * corr file 273.1
    RDEFIO: add new trigger banks needed to output list.
         In *CD -> S_NEWS
  * corr file 273.3
    SILUAD : Take into account the downscaling factor of the coincidence
             trigger when computing the preliminary Luminosity
  * corr file 273.1
    SICAOK: fix usage of new trigger banks X1RG, X1TT, X1HI
    SILHCR: adapt to new trigger banks
         In *CD -> E_NEWS
  * corr file 273.1
    EQRUNQ : changes due to new ECAL banks (May 1994)
    EFERRR : changes due to new ECAL banks (May 1994)
    EPREDA : changes due to new ECAL banks (May 1994)
    EAUTOP : new subroutine to decode banks EHWI and EHPA and
            summarize (condense) into arrays NAUTO and NAUTOW
    ECXMOD : (new) decode the EHPA data word and convert into a module
            number
         In *CD -> J_NEWS
    JTDXJJ : is obsolete
    JHDXJJ : is introduced to replace JTDXJJ
         In *CD -> T_NEWS
    TMONIT : add 36 words in the common block GAINTM(LTSECT)
    TACCMN : get Sector to Sector calibration information ...
             and store it in TMONIT (Z.Feng)
             fill one histogram per sector
             Store this tracks dE/dX value into the monitoring
             common blocks (TMONIT) if this track is a Mip.(Z.Feng)
             fill one histogram
    TDXMON : obsolete deck, purge it.
    TINIRU : reset /TMONIT/ DEDX_CALibration counters at start of
             run.
    TPCRUN : remove fit of DEDX,
             book, give a format and fill JHDX bank.
             JHDX has LTSECT+1 rows, 1 row per sector plus 1 row for
             the overall gain. The number of columns is the number of
             bins of the histograms.
    TRNCON : remove call to TDEDXV.
  -----------------------------------------------------------------------------
 ! 940426 - JULIA 27.3
         In *CD -> T_NEWS
    TCPTST - handle new TOER error bank (G.Ganis).
         In *CD -> O_NEWS
    OMREAD - allow for 1-8 bunches instead of 1-4 (R.Forty).
         In *CD -> R_NEWS
    RFORMA,RINJOB: remove XSGE, XSHI, XSSC trigger banks.
    RINRUN: remove call to XTRSIN.
    RPOTCL: remove call to XTRSEV.
    RCLRUN: remove call to XTRSFI.
         In *CD -> X_NEWS
    X1NAMC : remove XSGE, XSHI, XSSC name-indices.
    X1DCRB,XTUNPK,XTRSIN,XTRSEV,XTRSFI : are purged.
         In *CD -> R_NEWS
  * corr file 272.1
    RDEFIO : write VDTD on POT as it was in previous versions.
         In *CD -> T_NEWS
  * corr file 272.1 modified in 272.2
    TRNCON : with MC data when TPCSIM version # is > 217
             use the true T0 from T0GL, do not set it to 0.
  * corr file 272.2
    TRNCON : set T0=0. for TPCSIM version number < 218
    TFITTK : requires at least 3 coords. (I.Tomalin)
    TOVRLP : remove bug (I.Tomalin)
         In *CD -> S_NEWS
  * corr file 272.3
    SICLUS: apply new cluster correction instead of old one.
    SILUMI: use planes 3 and 4 for loose side selection as for tight side
    SICLC2: new routine
         In *CD -> V_NEWS
  * corr file 272.4
    VDMCEF : remove double correction which created wrong ALEPH
             Z-coordinate pertubating DALI, the local Z-coordinate
             was correct (M.Thulasidas).
  -----------------------------------------------------------------------------
 ! 940111 - JULIA 27.2
         In *CD -> A_NEWS
    AAMAIN - remove CRAY flag
             open JULIACARDS file if it exists
         In *CD -> C_NEWS
    CINIJO - set POT bank name-indices even no output file is required
         In *CD -> E_NEWS
  * corr file 271.8
    ERCUPI : initialize ICOR=0 which means returns from ERCUPR
             without correcting ETDI energies.
    ERCUPR : returns immediately when ICOR=0
    ESWPST : returns immediately if MC data
  * corr file 271.7
    ECSW1093 : new routine to fix ETDI swapping in end-cap for runs
               22793-22880.
    EPREDA   : call ECSW1093.
  * corr file 271.6
    ECTRAP : protection against invalid storey address.
  * corr file 271.5
    ECLONGI : new stuff.
         In *CD -> H_NEWS
  * corr file 271.6
    HMROAD : add protection.
  * corr file 271.1
    HCBHIS : HBPRO was called with a wrong number of arguments
         In *CD -> R_NEWS
  * corr file 271.9
    RFORMA : set JCON format to 48 columns.
  * corr file 271.8
    RINRUN : in case of '92 MC prod, drop EZTH and get it
             back from ADBSCONS.
  * corr file 271.6
    JCONJJ : extend JCON bank to 48 columns
    RFJCON : add de/dx constants.
  * corr file 271.2
    RWRUNH : bug when handling JCAR bank
  * corr file 271.1
    RDCARD,RDEFIO,RINJOB,RLOOPR : use BANKAL FMT
    RINJOB : VDTD is obsolete , remove this correction later on.
    JCONJJ : extend JCON bank to 13 columns
    RWREVT : suppress writing to moni file when not on VAX
             remove this correction in 271.9
    RFORMA : reset HLTU and JCON formats
    RFJCON : add TPC clock frequency and pressure.
         In *CD -> S_NEWS
  * corr file 271.4
    SIPVOI : array of energies in 9 pads in 5 first layers.
  * corr file 271.1
    SILHCR : Keep integrated SICAL scalers content in SILH
    SILUMI : Make Luminosity energy cuts depend upon CMS energy
    SIBOOK : HBPRO was called with a wrong number of arguments
         In *CD -> T_NEWS
    TFCAND - get track parameter errors from the diagonal of the
             covariance matrix.
    TCLDMP, TPRPOJ - enlarge formats.
    TPCRUN : return if MC data
  * corr file 271.6
    TPCRUN : expand fit interval.
         In *CD -> V_NEWS
  * corr file 271.6
    VBSINR : do not create a new working bank for each run.
  * corr file 271.1
    VDMCDEF : call rannor instead of norran
  -----------------------------------------------------------------------------
 ! 911108 - JULIA 2.58
 ..............................................................................
                Julia 2.58 correction file 01 is now installed on
                         ALWS, VXCERN, IBM, CRAY, FALCON
                                  W A R N I N G
           ***** This version requires ALEPHLIB 133 and DAF 161 *****
                                  W A R N I N G
 Compared to julia 257 correction file 02, changes are :
         o The SICAL is now in JULIA.
         o GAMPEC  is now  called,  result  is  stored in EGPC
           bank. To turn on  GAMPEC one must  provide in julia
           data cards a card called : GAMP.
 +++++++++++++++++++++++++++++++ New  Decks   ++++++++++++++++++++++++++++++++++
     SIBOOK, SIHIST, SIPREDA, SIINIJO, SIINIRU, SISLOWC, SICREC,
     SICRPOT, SIPRSUM, SICRUN
                 Dummy SICAL routines
     GAMBNK      Fill EGPC bank (result of GAMPEC)
 +++++++++++++++++++++++++++++++ Purged Decks ++++++++++++++++++++++++++++++++++
     RECEV2, GDECJJ
 +++++++++++++++++++++++++++++ Modifications in ++++++++++++++++++++++++++++++++
  ITC --------------------------------------------------------------------------
     ICRCCO      use function IRESRP to set the r-phi resolution in ICCO bank
     IREFIN      "     "       "    "    "  "    "        "      "   "   "
  ECAL -------------------------------------------------------------------------
     E4COSZ      Track momemtum added in routines arguments
     EIDENT      Call to E4COSZ modified
     ELONGI      Modification of longitudinal electron estimator for monte-carlo
                 events.
  SKELETON ---------------------------------------------------------------------
     RPARAC, RNXMOD
                 GAMPEC added
     RECOSN      Call to GAMBNK added
     RINJOB      BOS memory set to 750.000 for CRAY jobs
     RDEFIO      EGPC and SIDI banks added to output
     RECEVT      VDET laser triggers are now reconstructed
     RFLAGS, RPARAC, RNXMOD, RECEVT, RPREDA, RBKHIS, RDETEC, RHSEVT, RINJOB,
     RINRUN, RSMJOB, RUNKNO, RCLRUN, RDEFPO
                 SICAL routines are called is 'SICA' is found in the PROC data
                 card
 ..............................................................................
 11-NOV-1991 ..................................................................
 ..............................................................................
                Julia 2.58 correction file 02 is now installed on
                             ALWS, VXCERN, IBM, CRAY
     This version will be installed today on FALCON and used for the
 reprocessing.
 +++++++++++++++++++++++++++++ Modifications in ++++++++++++++++++++++++++++++++
  BOM  ----------------------------------------------------------------------
     OMREAD      one print statement removed
  LCAL ----------------------------------------------------------------------
     LINIJO, LPRLUM
                 Some protections added against undefined variables
  SKELETON ------------------------------------------------------------------
     RINJOB      BOS array size change to 650.000 for cray jobs
     RNXMOD      One format changed
 ..............................................................................
 18-NOV-1991 ..................................................................
 ..............................................................................
                Julia 2.58 correction file 03 is now installed on
                       ALWS, VXCERN, IBM, CRAY and FALCON
     This  version  together with  Alephlib  13.3 and  Database  version 162
     (released today) is installed on  FALCON and will be used for the FINAL
     reprocessing of 1991 data.
 +++++++++++++++++++++++++++++ Modifications in ++++++++++++++++++++++++++++++++
  BOM  ----------------------------------------------------------------------
     OMBREC      Content of BOME bank has been changed, new DDL follows
  MUON ----------------------------------------------------------------------
     MUSLCO      small correction of alignment of the second layer of muon
                 chambers.
  TPC  ----------------------------------------------------------------------
     TFILTJ      packing factor for TPC coordinates changed (go back to last year
                 values)
 ..............................................................................
 04-DEC-1991 ..................................................................
 ..............................................................................
                Julia 2.58 correction file 04 is now installed on
                             ALWS, VXCERN, IBM, CRAY
 +++++++++++++++++++++++++++++ Modifications in ++++++++++++++++++++++++++++++++
  MUON ----------------------------------------------------------------------
     HMROAD      Correction for muon id in overlap for M.C.
  ECAL ----------------------------------------------------------------------
     ETDIFP, ECHEDC
                 Corrections for POT->POT reprocessing
  TPC  ----------------------------------------------------------------------
     TFILTJ      Length of PTUN incorrect (never used in fact)
 ..............................................................................
 11-DEC-1991 ..................................................................
 ..............................................................................
                Julia 2.58 correction file 05 is now installed on
                             ALWS, VXCERN, IBM, CRAY
 +++++++++++++++++++++++++++++ Modifications in ++++++++++++++++++++++++++++++++
  TPC  ----------------------------------------------------------------------
     TCOOR, TCOORT, TSAWIR, TWINCO
                         Call to TFICOR (alephlib routine) to correct coordinates
                         for residual field distortions (short in field cage for
                         '91 September runs).
  SKELETON ------------------------------------------------------------------
     RINJOB      BOS array size set to 600.000 for CRAY.
 ! 02-MAR-1992 2.59
 ..............................................................................
                Julia 2.29 correction file 04 is now installed on
                         ALWS, VXCERN, IBM, CRAY, FALCON
     Compared to julia 258 changes are :
             o Julia steering routines for I/O hev been modified to use the
               standard aleph I/O package from the alephlib. Julia can now read
               EDIRs with the standard BOS.
             o SAVE statements have been added in every routine
             o main modifications have been made in view of POT-POT reprocessing.
             o the bookkeeping option have been disabled.
             o This version will be used for the DST-DST reprocessing of 1990
               data.
 +++++++++++++++++++++++++++++++ New  Decks   ++++++++++++++++++++++++++++++++++
     ECHICA      Common deck to save ECAL calibration constant fromprevious
                 processing in case of POT-POT reprocessing
     LCSAVE      Save LCAL info. from PECO and PEPT in LPSV and LPES in case of
                 POT-POT reprocessing
     ITCREP      Steering routine for ITC reconstruction for POT-POT reprocessing
     ICFTOI      Convert FRFT type banks to ITFT type track banks
     ISHUFF      Shuffle/Update FRFT type banks from ITFT type track banks
 +++++++++++++++++++++++++++++++ Purged Decks ++++++++++++++++++++++++++++++++++
     RLOOPF
 +++++++++++++++++++++++++++++ Modifications in ++++++++++++++++++++++++++++++++
  VDET -------------------------------------------------------------------------
     VDECOD      mods for APOLLO
     VCALCM      "   "   "
  ITC --------------------------------------------------------------------------
     IINIRU      If missing dbase banks then fatal error
     IPREDA      Remove obsolete code for old MC data
  TPC  -------------------------------------------------------------------------
     TRHLX2      mods for APOLLO
     TISLND      "   "   "
     THTROW      "   "   "
     TPPADD      "   "   "
     UFITMS      "   "   "
  LCAL -------------------------------------------------------------------------
     LTGTYP      mods for APOLLO
  ECAL -------------------------------------------------------------------------
     ECERAS      Drop ECAL POT input banks and call LCSAVE in case of POT-POT
                 reprocessing
     ECHEDC      mods for POT-POT reprocessing
     ETDIFP      "   "   "   "
     EWDIFP      "   "   "   "
     ELECID      EIDT not created if there is no tracks in the event
     EPADCL      some protection if routine is called before run initialisation
     EHIS        HBOOK arguments updated
     ETRDEV      mods for APOLLO
     EROAD       "   "   "
  CALO -------------------------------------------------------------------------
     CPOTLC      Use LPES and LPSV to fill POT banks in case of POT-POT
                 reprocessing
     CDANG       clean up code
     COSLST      "   "   "
     CPTCOM      "   "   "
  HCAL -------------------------------------------------------------------------
     HPRANP      some protections added
     HROAD       mods for APOLLO
  VERTEX -----------------------------------------------------------------------
     YFMAIN      use (FRFT,FRTL) instead of (TGFT,TGTL)
     YFVERT      "   "   "   "
  SKELETON ---------------------------------------------------------------------
     RCJSUM      mods for POT-POT reprocessing
     RCLRUN      "   "   "   "
     RDEFPO      "   "   "   "
     RECEVT      "   "   "   "
     RINRUN      "   "   "   "
     RINJOB      "   "   "   "
     RREVHE      "   "   "   "
     RDETEC      BCAL and EFLO were forgotten
     RDEFIO      one argument added to routine (return code),
                 DST output option identical to POT
     RLOOPR      Routine rewritten to call now standard aleph I/O routines
     RDOJOB      Do not call anymore RLOOPF
     RECONS      mods for new I/O package
     RUNKNO      "   "   "   "
     RWREVT      "   "   "   "
     RWRUNH      "   "   "   "
     RLUNIT      "   "   "   "
     RNXMOD      clean-up of code
 ..............................................................................
 11-MAR-1992 ..................................................................
 ..............................................................................
                Julia 2.59 correction file 05 is now installed on
                         ALWS, VXCERN, IBM, CRAY, FALCON
 +++++++++++++++++++++++++++++ Modifications in ++++++++++++++++++++++++++++++++
  TPC  ----------------------------------------------------------------------
     FINIJO      remove BLIST call
  CALO ----------------------------------------------------------------------
     CINIJO      remove BLIST call
  LCAL ----------------------------------------------------------------------
     LBINDX      remove BLIST call
     LPREDA      add BLIST call
  STAR ----------------------------------------------------------------------
     SRINBS      remove BLIST call
     SPREDA      add BLIST call
  HCAL ----------------------------------------------------------------------
     HINIJO      remove BLIST call
     HPREDA      modifications for POT-POT reprocessing
  MUON ----------------------------------------------------------------------
     MINIJO      remove BLIST call
     MPREDA      add BLIST call
  SKELETON ------------------------------------------------------------------
     RWRUNH      mods for POT-POT reprocessing
     RLOOPR      Do not unpack HCAL in case of POT-POT reprocessing
 ! 17-MAR-1992 2.60
 ..............................................................................
                         Julia 2.60 is now installed on
                         ALWS, VXCERN, IBM, CRAY, FALCON
                                  W A R N I N G
        ***** This version requires ALEPHLIB >= 136 and DAF >= 165 *****
                                  W A R N I N G
 Compared to julia 259 correction file 05, changes are :
         o Simplification of julia data cards, only 2 cards are needed in most
           cases : simply FILI and FILO, all the defaults are in (VFIT, GAMP,
           etc..).
           To disable old VFIT option use NVFI card
                          GAMP            NGAM
                          EWTH            NEWT
                          ESCA            NESC
         o This is the prototype version of julia for 1992 running (PASS0 is
           included, new TPC banks can be handled)
 +++++++++++++++++++++++++++++++ New  Decks   ++++++++++++++++++++++++++++++++++
     EGAEST      Built photon normalised estimator bank
     EGACST      Initialisation banks used in photon estimator normalisation
     RGETDV      Get TPC drift velocity
     RWTDPV      Write TDPV bank in PASS0 summary file
     RDCARD      read and decode data cards
 +++++++++++++++++++++++++++++ Modifications in ++++++++++++++++++++++++++++++++
  VDET -------------------------------------------------------------------------
     VLCPOS      new definition of sum pulseheight
  TPC --------------------------------------------------------------------------
     TCPTST      handle new banks TE1R,TANF,TWNF,TSIR
     TPKILL      handle the TSIR and TSDI banks
     TPREDA      "   "   "
     TTRUNK      "   "   "
     TWIRES      "   "   "
     TPCT0       use alephlib routine TPDVEL to load drift velocity
     TRNCON      "   "   "
  CALO -------------------------------------------------------------------------
     CNIGHB      do not consider noisy hcal cluster
     FTRACK      obsolete code removed
  ECAL -------------------------------------------------------------------------
     CALREC      call EGAEST
     EINIRU      call EGACST
     GAMBNK      Built EGPR bank (list of storey of gampec row)
  HCAL -------------------------------------------------------------------------
     HTUBFI      call HFBAHI and HFENHI from alephlib
     HPRDIG      produce new HLTU bank (MC true long. coor. hit)
     HMROAD      improved treatment of HCAl barrel/endcap overlap
     HTRACK      fix for precision problem in track extrapolation on IBM
  SKELETON ---------------------------------------------------------------------
     RDEFIO      EGPR, EGNE, HLTU banks added to output
     RCLRUN      mods for PASS0
     RECEVT      "   "   "
     RFJCON      call TPDVEL alephlb routine to get TPC drift velocity
     RINJOB      mods for PASS0, call RDCARD, RERROR init. called after RDETEC
     RINRUN      call RGETDV
     RDETEC      mods for new julia defaults (VFIT , GAMP on by default)
 ..............................................................................
 14-APR-1992 ..................................................................
 ..............................................................................
                Julia 2.60 correction file 04 is now installed on
                         ALWS, VXCERN, IBM, CRAY, FALCON
 +++++++++++++++++++++++++++++ Modifications in ++++++++++++++++++++++++++++++++
  TPC  ----------------------------------------------------------------------
         TLASJJ      updated
         TRNCON      call RGETDV
  CALO ----------------------------------------------------------------------
         CALREC      egaest called at wrong place
  LCAL ----------------------------------------------------------------------
         LINIRU      mods for loading 1992 alignment
  ECAL ----------------------------------------------------------------------
         EPADCL      Return after decoding EPRS if is run not initialized
         EGAEST      one undefined variable
  HCAL ----------------------------------------------------------------------
         HPRDIG      undefined variable
         HMROAD      take into account big notch of barrel 6,7 not sim. in galeph
  VDET ----------------------------------------------------------------------
         VINIRU, VDXYZT, VRECON
                     mods for loading 1992  daf banks
  SKELETON ------------------------------------------------------------------
         RCLRUN      small mod.
         RUNKNO      accumulate stat for 'slow control' records
         RFORMA      some SICAL formats added, TLAS format modified
         RPREDA      small mod.
         RCLJOB      call abwend
         RINRUN      remove call to rgetdv, add call to ripas0
         RWTDPV      writte JPAS bank to pass0 summary file
         RECONS      small mod.
         RINJOB      reduce hbook array size for cray
         RWRUNH      JPAS added to run header
 ..............................................................................
 24-APR-1992 ..................................................................
 ..............................................................................
                Julia 2.60 correction file 07 is now installed on
                         ALWS, VXCERN, IBM, CRAY, FALCON
 +++++++++++++++++++++++++++++ Modifications in ++++++++++++++++++++++++++++++++
  TPC  ----------------------------------------------------------------------
         TPCT0       error code not properly defined
         TPRSUM      one format statement was wrong
  ECAL ----------------------------------------------------------------------
         EGACST      protection against multiplication of too big numbers
         EGAEST      one variable undefined , some protection added
  SKELETON ------------------------------------------------------------------
         RDCARD      bug fixed for multiple READ data card
         RWTDPV      some formats changed
 ! 18-MAY-1992 2.61
 ..............................................................................
                         Julia 2.61 is now installed on
                         ALWS, VXCERN, IBM, CRAY, FALCON
 +++++++++++++++++++++++++++++ Modifications in ++++++++++++++++++++++++++++++++
  BOM -----------------------------------------------------------------------
     OMBPOS  one sign changed
  ITC  ----------------------------------------------------------------------
     ITCREP  do not call mc-recons matching in case of pot-pot reprocessing
  VDET ----------------------------------------------------------------------
     VINIRU  fix for miss cabling in first run of '92
     VDSMAP  "   "   "   "
  TPC  ----------------------------------------------------------------------
     TPREDA  one SAVE statement added
     TRKFND  some protections added
  CALO ----------------------------------------------------------------------
     CALREC  call to EGAEST miss-placed
  ECAL ----------------------------------------------------------------------
     EGAEST  some protections added
  LCAL ----------------------------------------------------------------------
     LOLERR  mod for filling LOLE error flag
     LUPACR  mod for filling LUPA information word
  SKELETON ------------------------------------------------------------------
                Julia 2.61 correction file 02 is now installed on
                         ALWS, VXCERN, IBM, CRAY, FALCON
 +++++++++++++++++++++++++++++ Modifications in ++++++++++++++++++++++++++++++++
  TPC  ----------------------------------------------------------------------
     FPIDEN      some protections added
     FITWRI      "   "   "   "
  CALO ----------------------------------------------------------------------
     CPOTCR      some protections added
  VDET ----------------------------------------------------------------------
     VINIRU      wrong logic for 1992
  SKELETON ------------------------------------------------------------------
     RGETDV      one bug corrected (affect PASS0 only)
     MNHEA       use FRFT instead of PFRF
                Julia 2.61 correction file 04 is now installed on
                         ALWS, VXCERN, IBM, CRAY, FALCON
     To simplify installation on Unix machines, the '\' character has been
 replaced by '&' as a line delimiter for the RERROR routine.
 +++++++++++++++++++++++++++++ Modifications in ++++++++++++++++++++++++++++++++
  CALO ----------------------------------------------------------------------
     CPOTLC  update PCOB, PCRL in case of POT-POT repro.
  HCAL ----------------------------------------------------------------------
     HCALRD  Load properly HxEC banks
  ECAL ----------------------------------------------------------------------
     ECCLUS  One comment modifed
     ECTEMP  Two calls to RERROR removed
  SKELETON ------------------------------------------------------------------
     RCLJOB  remove call to BKENJO (Bookkeeping option removed from Julia)
     RLOOPR  drop LDST bank for 1991
     RDETEC  Integer compression is now the default (COMP 'INTE' card no more
             needed) GARB card no more needed it is the default, use NGAR card to
             switch it off.
                Julia 2.61 correction file 06 is now installed on
                             ALWS, VXCERN, IBM, CRAY
 +++++++++++++++++++++++++++++ Modifications in ++++++++++++++++++++++++++++++++
  TPC  ----------------------------------------------------------------------
     TCOTHR  invisible characters removed
  HCAL ----------------------------------------------------------------------
     HTRACK  removal of machine dependent statement
  MUON ----------------------------------------------------------------------
     MPREDM  modification for muon chambers under the leg in MC
  BCAL ----------------------------------------------------------------------
     BCPACK  non initialized variables
  SKELETON ------------------------------------------------------------------
     MINHEA  mistyping corrected
     RDCARD, RDEFIO
             POT and FILO card are totaly equivalent
 ! 2-SEP-1992  2.62
                         Julia 2.62 is now installed on
                             ALWS, VXCERN, IBM, CRAY
     o All the SAVE statements (except explicit ones) have been removed.
     o reorganization of the  HISTORIAN library. The  librairy is divided in sets
       corresponding to decks  and common decks  starting with the same letter (T
       for TPC for example). Sets start with a NEWS deck (T_NEWS for example) and
       end by an END deck (T_END for example).
     o the SICAL is really in (steering routines were dummy before)
     o new MUID bank written to the output
 +++++++++++++++++++++++++++++++ PURGED Decks ++++++++++++++++++++++++++++++++++
     RWBKRU      Bookkeeping routine
 ++++++++++++++++++++++++++++++++ NEW Decks ++++++++++++++++++++++++++++++++++++
     VERSION     contains JULIA version and correction file number
     ABOLDR      called at end of run before reading new run record, it calls
                 RCLRUN
     MUNEWR      Initialises muon id part, for use outside of the julia context
     TSIRDP      Dump the TSIR, TSLE, and TSDI banks
     ICASWT      function to witch dead storey address in End-caps
 SICAL routines :
     SILSUM      Build energy sums in roads of 2 phi pad width for 3 radius bins
     SILVOI      Build list of neighbours used in Energy sums for Luminosity cuts
     SINAMX      Set Scal name indices
     SIBKPR      Print Scal output banks
     SICLCO      Cluster position correction in Sical
     SICLUS      Clustering in Scal
     SIDAMP      Expand addresses of a dead Amplex of address IAD into NPA
                 addresse
     SIECOR      For cluster # ICLU in bank SCLS returns the calibration
                 corrected
     SILIST      Check if address IAD is among first NROW rows of bank SPDA
     SISWAP      Unswap some cables
     SISTAT      SICAL Accumulate job statistics
 +++++++++++++++++++++++++++++ Modifications in ++++++++++++++++++++++++++++++++
  VDET ----------------------------------------------------------------------
     VDRCUN      Overwrite the control flags if reprocessing
     VINIRU      remove duplicated statements
  TPC  ----------------------------------------------------------------------
     FREFIT      modification for DST-DST reprocessing :
                 set number of VDET points to 0 since FREFIT produces only FRFT
                 0!
     Corrections for dE/dx variations with respect to angles and drift lengths
     due to threshold. Count number of wires which dont fire but should have and
     modify the truncated mean for this effect.
     TFTWTB      include null wire hits
     TKSGDP      Use pulse length banks
     TRDWP2      Return Length of pulse above threshold
     TRKELS      sided truncated mean
     TRKWRA      make list of dead wires for TFTWTB
     TWIRES      handle pulse length banks
     TRKELS      use projected track length rather than track length
  CALO ----------------------------------------------------------------------
     CPADWR      print statement removed
  ECAL ----------------------------------------------------------------------
     EGETDS      call ICASWT to switch dead storey addresses
  HCAL ----------------------------------------------------------------------
     HMROAD      minor modification
  MUON ----------------------------------------------------------------------
     MUASS       some protections for use outside julia
     MUTEST      use MUEX rather than TREX bank to associate hit-tracks
  SICAL ---------------------------------------------------------------------
     SIBOOK,SIHIST
                 Book and fill histos.
     SIINIJO     Initialize Job
     SIINIRU     Init.   run
     SIPREDA     prepare data before reconstruction
     SIPRSUM     print end of job summary
  SKELETON ------------------------------------------------------------------
     RWREVT      Drop POT banks if no output is requested
     RDEFIO      MUID bank added to output
     RECEVT      - call HRHTUB and MRMHIT (HCAL and muon chambers efficiency map
                 for MC events)
                 - call MUIDO, global hcal+mu-chambers for inal muon ID and
                 shadowing treatement
                 - for DST-DST reprocessing with VDET :
                 use FRFT and not TGFT since TGFT is not produce in that case
     RPARAC, RNXMOD
                 remove timing estimate of RWBKRU, implemement timing of MUIDO
     RCLRUN      write end of job summary banks only when running on falcon,
                 list of banks : 'RUNRLEHILUMILBAKLVHIJSUMXSGEXSHIXSSC'
     RLOOPR      minor modification due to use of ABOLDR from now on
     RWRUNH      minor modification for DST-DST reprocessing outside FALCON
                Julia 2.62 correction file 03 is now installed on
                         ALWS, VXCERN, IBM, CRAY, FALCON
                      !!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
                             THIS IS A TEST VERSION
                                   IT REQUIRES
                                 ALEPHLIB >= 140
                                   DAF >= 170
                      !!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
 SICAL Clusters are included in PECO/P... banks as for LCAL clusters.
 PECO region code for SICAL clusters is 256 (192 for LCAL).
 +++++++++++++++++++++++++++++ Modifications in ++++++++++++++++++++++++++++++++
  TPC  ----------------------------------------------------------------------
     TFLNKS      bug fixed
     TRNCON      access TPC T0 through GTT0GL alephlib function
     TCOOR, TCOORT, TSAWIR, TWINCO
                 call alephlib routines TFICOR, TCORES to correct for
                 shorts on TPC field cage
  LCAL ----------------------------------------------------------------------
     XPTENB      From now on LCAL wire trigger is used instead of pad trigger
  SICAL ---------------------------------------------------------------------
     SICRPOT     extend PECO/PCOB/PCRL  with Sical clusters region code is 256
     SIGACO      take calibration constants from Data Base
     SIGTDP      handle dead pad information even if missing
     SIPREDA     protect against missing dead pad information
     SIVOIS      fix to treat MC data correctly
  SKELETON ------------------------------------------------------------------
     RWREVT      Drop E list is no julia output is requested
     RMONII      two variables not declared
     RFJCON      access TPC T0 through GTT0GL alephlib function
                Julia 2.62 correction file 08 is now installed on
                         ALWS, VXCERN, IBM, CRAY, FALCON
                      !!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
                              THIS VERSION REQUIRES
                                 ALEPHLIB >= 140
                                   DAF >= 170
                      !!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
 Compare to correction file # 3, changes are :
 +++++++++++++++++++++++++++++ Modifications in ++++++++++++++++++++++++++++++++
  TPC  ----------------------------------------------------------------------
     TFTWTB      small bug corrected
     TRKWRA      "   "   "   "
  HCAL ----------------------------------------------------------------------
     HPRDIG      minor correction
  MUON ----------------------------------------------------------------------
     MINIJO      obsolete code removed
  LCAL ----------------------------------------------------------------------
     LACCEP, LIDCOD, LOLERR, LPRLUM, LTGBIT, LTGBIT
                 New method 10 to compute luminisoty stay clear of Sical shadow
  VERTEX --------------------------------------------------------------------
     YFVERT      some protections added
  SKELETON ------------------------------------------------------------------
     RPASS0, RECONS, RIPAS0, RWTDPV
                 mods for PASS0
 ! 07-OCT-1992  2.63
                         Julia 2.63 is now installed on
                             ALWS, VXCERN, IBM, CRAY
 !!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
                             THIS IS A TEST VERSION
                                   IT REQUIRES
                                 ALEPHLIB >= 141
                                   DAF >= 171
 !!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
 +++++++++++++++++++++++++++++++ PURGED Decks ++++++++++++++++++++++++++++++++++
     ABMAIN
 ++++++++++++++++++++++++++++++++ NEW Decks ++++++++++++++++++++++++++++++++++++
     ALBITW      get # of bits in a machine word
     ESCDEF      Ecal Small Defect Correction
     ECPLM       Ecal correction for wrong plane killed
 +++++++++++++++++++++++++++++ Modifications in ++++++++++++++++++++++++++++++++
  VDET ----------------------------------------------------------------------
     VDMCEF      mods for inefficiency simulation in Monte-Carlo
  TPC  ----------------------------------------------------------------------
     THTROW      one undefinied variable
  MUON ----------------------------------------------------------------------
     MINIJO      PCUTMA (cutoff momentum for track association to mu-ch)
                 decreased from 3 to 2.2 GeV
  ECAL ----------------------------------------------------------------------
     EINIRU      call to ESCDEF added
     EPREDA      call to ECPLM  added
     ETHRES      correct for eventual coherent shift of wire energies
     EGETDS, EINIRU, EGACST,E4COSZ
                 use GTDBBK common deck to access run header / daf
                 setup dep. banks
  SICAL ---------------------------------------------------------------------
     SIGTDP      small modification
  SKELETON ------------------------------------------------------------------
     AAMAIN      contains code from purged routine ABMAIN,
                 BOS initialised,
                 open data cards
     RDCARD, RINJOB
                 code moved to AAMAIN
 ! 22-OCT-1992  2.64
                         Julia 2.64 is now installed on
                             ALWS, VXCERN, IBM, CRAY
 +++++++++++++++++++++++++++++++ PURGED Decks ++++++++++++++++++++++++++++++++++
     RWBKIN      initialisation of bookkeeping (obsolete option)
 +++++++++++++++++++++++++++++ Modifications in ++++++++++++++++++++++++++++++++
  MUON ----------------------------------------------------------------------
     MPREDG      obsolete code removed
  ECAL ----------------------------------------------------------------------
     E4COSZ,EGETDS,EINIRU
                 Modification to access data base banks
     ELONGI      modification to electron longitudinal estimator in end-cap
     ECFILS      check is DAQ error
  SKELETON ------------------------------------------------------------------
     RREVHE      use parameter statement
                Julia 2.64 correction ile # 7 is now installed on
                       ALWS, VXCERN, IBM, CRAY, SHIFT, CSF
     This is the version which will be used for the 92 Monte-Carlo production
     together with data base 175.
 +++++++++++++++++++++++++++++ Modifications in ++++++++++++++++++++++++++++++++
  VDET ----------------------------------------------------------------------
     VDMCEF      handle dead channels
     VINIRU      correction for VDET timing problem in early 92 runs
  TPC ----------------------------------------------------------------------
     TRNCON      mods for new TPCSIM
     TPKILL      idem
  LCAL ----------------------------------------------------------------------
     LUPACR      RTABL should have been ITABL, protection if LOCL not filled
  ECAL ----------------------------------------------------------------------
     ECPLM       minor modification
     ELONGI      modification for Rl computation in MC
     E4COSZ      one uninitialized variable
  SICAL ---------------------------------------------------------------------
     SIGTDP      Add protection against bad addresses from SDPD
     SISWAP      Unswap two cables in a range of runs [ 17537, 17618 ]
                Julia 2.64 correction file # 8 is now installed on
                       ALWS, VXCERN, IBM, CRAY, SHIFT, CSF
              This is the version which will be used together with
                                alephlib 144 and
                                daf      177
                        for the reprocessing of 91 data.
 +++++++++++++++++++++++++++++ Modifications in ++++++++++++++++++++++++++++++++
  TPC -----------------------------------------------------------------------
         Two types of correction :
                 -   Make the code backward compatible, constants are loaded from
                     the new database bank TC7X (Data and MC).
                 -   Two bug fixed in treatement of MC dE/dx. Agreement with data
                     should be better now.
     TCDUMP      Small correction
     TFTWTB      Database control of constants
     TPKILL      Fix bug
     TRDWP2      Fix bug such that LMPH REALLY is returned
     TRKELS      Database control such that old algorithm still works
     TRKWRA      Database control of constants
     TRNCON      Load TC7X from daf
                Julia 2.64 correction file # 9 is now installed on
                       ALWS, VXCERN, IBM, CRAY, SHIFT, CSF
 +++++++++++++++++++++++++++++ Modifications in ++++++++++++++++++++++++++++++++
  TPC -----------------------------------------------------------------------
     TRNCON      Bug fix for multi-runs julia processing mod
 ! 8-APR-1993    2.65
                     Julia 2.65 corr. 07 is now installed on
                CERNVM, ALWS, ALPHA, VXCERN, DECS, SHIFT and CSF
     o   This version will be used for 93 data processing.
     o   There will shortly be a new version : 270 identical to 265 but with the
         HISTORIAN library resequenced!
     o   WARNING this version requires :
             Alephlib >= 15.1    ,   DAF >= 180
     o   Compared to JULIA 264.09, changes are :
     New features :
         -   PASS0 produces VDET hot chanels bank list (VHOT)
         -   FRFT 0 is swapped to FRFT 3 after tracking ==> all code called after
             tracking will now use FRFT 2 by default!!!.
         -   Beam Spot is now computed inside JULIA, result is stored in
             end-of-run bank ALPB
         -   new photon banks PGPC and PGID are produced (old ones EGID, EGPC
             dropped)
         -   PECO bank NR = 1 produced (angles corrected by event vertex
             position)
         -   New variable FMCRUN in RCURNT common deck, .true. if MC run is being
             processed ==> standard definition of MC run in JULIA to avoid the
             run number 2000 border definition ( .LT. or .LE. ????), routines
             with special sequences for MC have been modified to use FMCRUN.
 +++++++++++++++++++++++++++++++ PURGED Decks ++++++++++++++++++++++++++++++++++
     Reshuffling of JULIA steering, following decks are purged :
     RWTDPV, RDBSUM, REJOBC, EHIS, RDJINI, RLOOPC, RECEV2, RDOJOB, REDIRC,
     MINHEA, FIDHEA, RDEFMI
 +++++++++++++++++++++++++++++++ NEW Decks +++++++++++++++++++++++++++++++++++++
     RCPAS0      Write TDPV and VHOT banks in PASS0 summary file
     RZEJOB      Zero statistics arrays which count inside the JOB
     EFBOOK      replace EHIS (Booking of histograms for mask analysis)
     VDCRUN      VDET end of job printout was in fact an end-of-run routine, call
                 VCRHOT to produce hot chanels list
     LPHIST      set of parameter of lcal energy histograms
     SIEPCR      Return SICAL PAD ENERGY with all corrections
     SIESUM      For cluster # ICLU in bank SCLS returns the Cluster energy as
     SIFSUM      For cluster # ICLU in bank SCLS returns the Cluster energy per
     SILHCR      Create and fill the SILH banks
     SILUMI      Apply Lumi cuts and compute Luminosity in SICAL, fill SLUM
     SIPRLUM     SICAL LUMI  Summary
     SIPSUM      For cluster # ICLU in bank SCLS returns the Cluster energy per
     SIPVOI      For pad indices IR,IP,IM find array of 9 pads in first 5 layers
     SILUAD      Fill bank SILUM by increasing counts
     SICAOK      Checks HV bits and Trigger enabled for Sical analysis
     STRIGF      Return trigger type for current event
     STMASK      Return trigger masks for current run
     GAPECO      Built PECO bank NR=1 for modified Energy,Vertex
     GASTEER     Steering for photon
     VBSCOM      Constants for Beam Spot computation
     VBSPOT      Measure the beamspot using the ALEPH VDET
     VBMFIT      Beamspot position fit
     VCBFIT      Close form beamspot fit
     VDETOK      simple XVDEOK to be used in beam pot package
     VBSINR      Initialise Beam Spot position computation for the run
     VBSCLR      End of Run Beam Spot position computation, close bank
 +++++++++++++++++++++++++++++ Modifications in ++++++++++++++++++++++++++++++++
  VDET ----------------------------------------------------------------------
     VDRCUN      Set only final P.H. and Hot chanels for PASS0 mode
     VINIRU      get DB banks depending on setup code through ALGTDB instead of
                 MDARD
                 call VBSINR
  TPC  ----------------------------------------------------------------------
     TPRSUM      make it shorter
     TFITHL      save statement added to make some compiler happy.
  TRACKING ------------------------------------------------------------------
     FTRACK      one protection added for LOG10
     TCOOR       protection added
  MUON ----------------------------------------------------------------------
     MPREDG      Bad cabling in MA6B (in A162 bus#3 inverted with bus#14 only for
                 strips 0-95)
  LCAL ----------------------------------------------------------------------
     LPRLUM      make it shorter!!
     LGNGBX      make use of FMCRUN variable
     LCALIB, LINIRU, LPRCAL, LPRLUM
                 make use of LPHIST common deck
     LINIRU      montecarlo - use AGETDB instead of MDARD to get LALI
     LTRACK, LTRACE, LIDCOD, LCHIST, LUPACR
                 protection added if SATR not present
  SATR ----------------------------------------------------------------------
     SRDEAD      remove obsolete code to allow some banks to be dropped from daf
  ECAL ----------------------------------------------------------------------
     ECFILS      one printout suppressed in case of SICAL only triggers
     ERCUPI      cosmetics
     E4OVRL      protection added
     GAPECO      protection added
     ICASWT      Dead pad addresses are no more swapped in end-cap
  SICAL ---------------------------------------------------------------------
     SIBKPR      Print SILH and SILU banks
     SIBOOK      Histos added
     SICLCO      Z of cluster added as argument
     SICLUS      correct for pad center coordinate, get partial Energy sums
     SICREC      call luminosity computation
     SICRPOT     drop some banks in case of SICAL only triggers
     SICRUN      call SIPRLUM
     SIECOR      correct energies
     SIGACO      protection added
     SIHIST      histos filled
     SIINIJO     call SINAMX
     SIINIRU     get Calibration constants, reset lumi stat., book SLUM bank
     SILSUM      uses 5  Doublets stacks depth
     SILVOI      "       "           "       "
     SIPREDA     apply calibration
     SISWAP      swapped cables handling
  HCAL ----------------------------------------------------------------------
     HCALRD      printout shorter
  V0 ------------------------------------------------------------------------
     YMFV0S      documentation added
  SKELETON ------------------------------------------------------------------
     AAMAIN      remove calls to obsolete routines
     RCURNT      add LOGICAL variable FMCRUN to common deck (.true. if MC
                 processing), add RENLEN  = LEP c.m. Energy in GeV variable
     RFLAGS      add LOGICAL variables FREPRO, FPASS0 to common deck (.true. for
                 POT-POT reprocessing and PASS0 mode respectively)
     RLUNIT      add PASLIS  variable : list of banks written out by pass0
     RPASS0      variable NHOTBF added to common (number of VDET hot chanels
                 found in previous PASS0 run)
     RBKHIS      call EFBOOK instead of EHIS
     RDCARD      decoding DEBU card
     RDEFPO      cosmetics
     RDETEC      switch on VDET by defaults for PASS0 mode
     RECEVT      Swap FRFT 0 <-> FRFT 3 after tracking and back at the end of
                 reconstruction !!!! this means ALL code called after tracking
                 will now use FRFT 2 instead of FRFT 0 !!!!
                 call VBSPOT accumulate statistics for Beam Spot position
                 computation
                 process VDET if random trigger (trigger bit 31 set)
     RECONS      call GASTEER for new photon banks PGPC and PGID
     RERROR      routine autoinitialized but still backward compatible
     RFORMA      add definition of new produced banks
     RINCND      some modification in start of run printout
     RINJOB      mods for new PASS0
     RINRUN      "   "   "   "      + prinout mods + VBSINR called
     RIPAS0      Get pass0 constants from PASC daf bank
     RLOOPR      cosmetics
     RMONII,RMONIT   cosmetics
     RNXMOD      handle new module GASTEER and VBSPOT
     RPREDA      prepare EFLOW stage only if EFLOW requested
     RPRSTA      new printout formats
     RPRSUM      "       "       "
     RREVHE      use FREPRO variable, create JEDS bank
     RTITLE      call ALMACH alephlib routine to get computer name
     RWREVT      drop E list if no output is requested
     RPOTCL      Dropping detector banks for Sical only triggers
     RCLRUN      call VBSCLR
     RCJSUM      add date and time of processing in JSUM bank
                     Julia 2.65 corr. 15 is now installed
 This is the version currently running on FALCON
 +++++++++++++++++++++++++++++ Modifications in ++++++++++++++++++++++++++++++++
  SCAL ----------------------------------------------------------------------
     SILUMI      minor mod
  LCAL ----------------------------------------------------------------------
     LGTBIT      changes due to new trigger bit definition
     LINIRU      create LEHI, LUMI, LBak, LVHI, LONL with nr = run number
  TPC -----------------------------------------------------------------------
     FPIDEN      Replace explicit link to FRFT 0 by NAMIND
  VDET ----------------------------------------------------------------------
  SKELETON ------------------------------------------------------------------
     RFORMA      new formats defined
     RIPAS0      swap previous VHOT bank to write it out if not enough event
                 at end of run
     RDEFIO      remove call to RFORMA put it in RINRUN
     RINJOB      ADD RLEP to SUMLIS
     RINRUN      Add call to RFORMA
     RCPAS0      If VHOT is Empty (Not enough events drop it and restore previous
                 one)
     RWREVT      write out properly compressed banks
     RLOOPR      write our run records which come in middle of events
     RDEFIO      open the file for monitoring if requested
     RCJSUM      Define Lumi coincidence as LCAL before 93 , Sical from 93 on
     RMONIT      Add protection against crazy PYFR bank
                     Julia 2.65 corr. 20 is now installed
 This is the version currently running on FALCON
 This will be the last correction file for this julia version.
 +++++++++++++++++++++++++++++ Modifications in ++++++++++++++++++++++++++++++++
  SCAL ----------------------------------------------------------------------
     SICLUS      Minor modification
     SIPREDA     Protection against invalid SIDI addresses
     SILUMI      Minor modification
  TPC -----------------------------------------------------------------------
     TRKELS      make code backward compatible
  VDET ----------------------------------------------------------------------
     VPREDA      do not call VDMOIS on laser events
     VTRLAS      New function to flag laser events
  SKELETON ------------------------------------------------------------------
     RINRUN      One format modified
     ABOLDR      Make sure that julia version of the routine is used and not the
                 alephlib one
     RECEVT      use VTRLAS
     CPOTLC      mod for multi run mode
     RCLRUN      "   "   "       "   "
 ! 13-JUL-1993    2.70
                     Julia 2.70 corr. 00 is now installed on
                CERNVM, ALWS, ALPHA, VXCERN, DECS, SHIFT and CSF
     This version  is identical to  julia 265.20. The  HISTORIAN library has
     been resequencent. All forthcoming  corrections for Julia must refer to
     this library.
 ! 15-SEP-1993    2.71
                     Julia 2.70 corr. 03 is now installed
               ALWS, VXCERN, AXAL, CERNVM, SHIFT, CSF and FALCON
                                 W A R N I N G
                         alephlib 154 and database 182
                          released today are required
                                 W A R N I N G
 +++++++++++++++++++++++++++++    New Decks     ++++++++++++++++++++++++++++++++
  TPC -----------------------------------------------------------------------
     TPADFX      synchronize TPAD and TPDI bank when one hit is missing in the
                 TPAD bank but not in the TPDI bank.
     TPCRUN      Run summary from TPC reconstruction,
                 produces JTRE and JTDX banks
 +++++++++++++++++++++++++++++ Modifications in ++++++++++++++++++++++++++++++++
  VDET ----------------------------------------------------------------------
     VCBFIT      protection against negative sqrt
  HCAL ----------------------------------------------------------------------
     HDGPOT      RERROR was called with wrong number of arguments
  IPC -----------------------------------------------------------------------
     IPHCOR      Use alephlib func. IDDIST for calc. of drift-distance.
  TPC -----------------------------------------------------------------------
     TFTWTB      Suppress error message for the channel which is used for the t0
                 measurement
     TPREDA      call TPADFX
     TACCMN      Accumulate TPC monitoring information,
                 compute raw dE/dx per sector
     TDXMON      compute RI instead of RI/RI_exp
     TPRSUM      some printout modified
     TRNCON      Load TDXC (dE/dx monitoring constants) bank from daf
  TRIGGER -------------------------------------------------------------------
     XTRSFI      drop XSGE, XSHI, XSSC before creating them
  SKELETON ------------------------------------------------------------------
     RCLRUN      call TPCRUN
     RINJOB      add JTRE and JTDX to list of banks written to SUMR file
     RFORMA      add JTRE and JTDX format definition
     RINRUN      drop JEDS before creating it
     RECEVT      call TDXMON to compute mean dE/dx per mip for the event
                     Julia 2.70 corr. 07 is now installed
               ALWS, VXCERN, AXAL, CERNVM, SHIFT, CSF and FALCON
 +++++++++++++++++++++++++++++ Modifications in ++++++++++++++++++++++++++++++++
  VDET ----------------------------------------------------------------------
     VCBFIT      protection against negative SQRT
  TPC -----------------------------------------------------------------------
     TPRFX       cleanup to make Unix fsplit working
     TPCRUN      produce JTDX bank
                 restrict dE/dx fit to the FWHM interval around maximum
     TRNCON      Load TDXC bank from daf
     TSTATE      common rename to TPCSTA to make shift9 happy
  ECAL ----------------------------------------------------------------------
     ECHEDC      mods for POT-POT reprocessing
  SKELETON ------------------------------------------------------------------
     RDCARD      minor mod.
     RLOOPR      write out slow control records only if one run record has been
                 read in
     RCLRUN      mod for POT-POT reprocessing
     ALTIME      use TIMEL instead of TIMEX which does not work on AXPs
                         Julia 2.71 is now installed on
                CERNVM, ALWS, ALPHA, VXCERN, DECS, SHIFT and CSF
     o   This version will be used for 93 data RE-processing.
     o   WARNING this version requires :
             Alephlib >= 15.5    ,   DAF >= 184
     o   Compared to JULIA 270.07, changes are :
 +++++++++++++++++++++++++++++++ NEW Decks +++++++++++++++++++++++++++++++++++++
     SIDVOI,SIDSUM,SIDCOR
                 new routines for SiCAL dead pad energy correction
     TWRRDP      Dump TPC raw and reduced wire data for sector SLOT
     TRDWP3      Reduce TPC wire pulses not handled by the TPP
 +++++++++++++++++++++++++++++ Modifications in ++++++++++++++++++++++++++++++++
  VDET ----------------------------------------------------------------------
     VINIRU      Load VDSM daf Bank
     VDMCEF      hit position smearing for MC
  TPC  ----------------------------------------------------------------------
     TACCMN, TDXMON	
                 Call TDEDXV alephlib routine to load dE/dx calib. const.
                 TC2X is not used any more
     All of the following changes were necessary to overcome the bias in
     dE/dx caused by tracks being close together.
     TWIRCT      add some extra parameters
     TCDUMP      call to TWRRDP added
     TFTWTB      get rid of TWPU and add DZNLTW
     TKSGDP      use TWRF instead of TWPU
     TRNCON      Load TC7X and TWTC bank, add DZNLTW cut to TC7X
     TWIRES      split double peaked pulses and add reference bank TWRF
                 Obsolete TWPU bank removed.
  ECAL ----------------------------------------------------------------------
     ECLAMP       save work bank indices in common
  SICAL ---------------------------------------------------------------------
     SICLUS      introduce dead pads energy correction to cluster attributes
     SIEPCR,SIECOR
                 introduce some extra correction to Energy calibration
     SIPREDA     force Energy calibration to be applied for REAL DATA
     SIINIRU     load dead pad energy correction constants from Dbase
     SIGTDP      force loading of dead pad list from Data Base
  SKELETON ------------------------------------------------------------------
     RDCARD      mod for multi pot-pot repro.
     RECEVT      Force VDET reconstruction if VREC data card is found
                 (---> this is for Rick and for single particles)

2 A_

  >>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>
    CKEY 
     1st entry in A-set
     ! JULIA 308
        AAMAIN : Change TIMEST value to get better timing resolution (O.Callot)
    
     ! JULIA 305
        AJMMCL : fix variable type inconsistencies in function calls,
                 for Linux                            (A.Waananen)
    
     ! JULIA 303 correction file 7
        ALGTWA : Run 29977 also had bunch trains                 (M.Cattaneo)
    
     ! JULIA 302 (Tracking upgrade)
        AAMAIN : Increase length of IW array to 3M words (from 2M) (D.Casper)
        
     ! JULIA 281
       AAMAIN - Increase max number of BOS banks to 3000
       ABOLDR - remove include version.h, since we don't have correction files
                with CVS. JULRUN makes sure JULIA version of routine is picked up.
    
     ! JULIA 279
       make several cosmetic changes in several sets to move easily to CVS
       (F. Ranjard, Nov 95)
    
     ! JULIA 272
       AAMAIN - remove CRAY flag
                open JULIACARDS file if it exists
    
  <<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<
     AAMAIN     Top level reconstruction program routine
     ABOLDR     Routine called at end of run by abrsel before reading next run rec
     AJMMCL     Perform jet finding
     ALGTWA     Get number of wagons from whatever reliable source of information
     ALMMCL     Evaluate jet multiplicities based on the scaled invariant mass
     ALTIME     Pseudo timex for falcon
     AULPOL     Intersection of a line with a 12-side poligonal surface

3 AAMAIN
         PROGRAM AAMAIN
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Top level reconstruction program routine
   
     Author       J. Bunn
   
     Modified     S. Orteu      25-FEB-1987
     Modified     O.Callot      14-SEP-1998
              Change TIMEST value to get better timing resolution (was 99999999)
   
 
3 ABOLDR
         SUBROUTINE ABOLDR ( IRUN )
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Routine called at end of run by abrsel before reading next run rec
   
      Author   :- E. Lancon             28-AUG-1992
      Modified :- E. Lancon              7-JUN-1993
          Common Deck VERSION MUST be there, this routine should be called
          and not the alephlib routine. With VERSION it will be in the
          correction file and loaded before the alephlib routine.
      Modified :- M. Cattaneo           31-MAY-1996
          VERSION removed, since we no longer have correction files with cvs.
   
      Inputs:
           - IRUN           I/  Run Number
   
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
              ABOLDR                                                               
                   |----  RCLRUNRETURN                        External             
   
 
3 AJMMCL
         SUBROUTINE AJMMCL(YCUT,EVIS,NJETS)
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Perform jet finding
       Author  : M.N Minard       10/02/91
        Input   : YCUT     Ycut valuee (M/EVIS)**2
                  EVIS     Visible energy
                           Evis=0 ,computed from the input
                           particle energy
        Output  : NJETS    Number of reconstructed jets
        ACTBUF common used
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   EFAXE                                                                           
        |---- AJMMCL                                                               
                   |----  WBANK                               External             
                   |----  QFMMCL                                                   
                   |----  WDROP                               External             
                   |----  QGMMCL                                                   
                   |----  KTBOF                               External             
                   |----  QTBOX                               External             
                   |----  QTBOY                               External             
                   |----  QTBOZ                               External             
                   |----  QTBOE                               External             
   
 
3 ALGTWA
         INTEGER FUNCTION ALGTWA(IRUN)
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Get number of wagons from whatever reliable source of information
       This routine should eventually go to the ALEPHLIB
   
     Author : B. Bloch -Devaux  25 October 1994- October 1995
     Modified M.Cattaneo        18 July 1997
         Run 29977 also had bunch trains (but was DUCK for SiCAL)
   
     Input  :  IRUN Run number
   
     Output :  ALGTWA  = unmber of wagons in the train
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   SIINIRU                                                                         
   SILUAD                                                                          
   SIPRLUM                                                                         
        |---- ALGTWA.                                                              
   
 
3 ALMMCL
         SUBROUTINE ALMMCL(YCUT,EVIST,ETHR,KTBO)
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
     Author   : M.N Minard     31-JAN-1990
                transformed from QGMMCL from ALPHA
     Description
     ===========
   Evaluate jet multiplicities based on the scaled invariant mass
      squared algorithm
      from momentum vectors stored iN QCTBUF.INC
    input   : YCUT            ycut value ( (M/EVIST)**2 )
              EVIST           visible energy
                              (if EVIST=0., it is computed from the
                               input particle energies)
              N               # of particles           (from LUJETS)
              P (I,(1,2,3,4)) four momentum (i=1,N)    ( "     "   )
    output  :
              P (N+J,(1,2,3,4)four  momentum of jet j (j=1,NJET)(LUJETS)
              K(N+I,1)       jet # of particle i     (i=1,N)
              KTBO        -1  input  error (N/EVIST) (in   LUJETS)
                          -2  error from individ. track
                          -3  too many jets
                         NJET # of jets (normal return)
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
              ALMMCL                                                               
                   |----  VZERO                               External             
                   |----  SQRT                                External             
                   |----  ABS                                 External             
                   |----  SIGN                                External             
   
 
3 ALTIME
         SUBROUTINE ALTIME (TIME)
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Pseudo timex for falcon
   
      Modified :- E. Lancon             31-AUG-1993
             To use TIMEL (TIMEX does not work on the AXP)
   
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   AAMAIN                                                                          
   IFIND1                                                                          
   IFIND2                                                                          
   IGICHA                                                                          
   IPREDA                                                                          
   ITCREC                                                                          
   ITRAK                                                                           
   RCJSUM                                                                          
   RCLJOB                                                                          
   RCLRUN                                                                          
   RECONS                                                                          
   RHSEVT                                                                          
   RINRUN                                                                          
   RMONIT                                                                          
   RNXMOD                                                                          
   RREVHE                                                                          
   TPCREC                                                                          
   TPREDA                                                                          
        |---- ALTIME                                                               
                   |----  TIMEL                               External             
   
 
3 AULPOL
         SUBROUTINE AULPOL(RAD,ZMAX,PHI1,PAR,PAREX,ICODE)
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Intersection of a line with a 12-side poligonal surface
    G. Capon  25-sep-87
   
      Input variables : RAD = internally tangent radius
                        ZMAX = max Z value
                        PHI1 = phi for first vertex above x-axis
                        PAR  = x,y,z dx/ds,dy/ds,dz/ds
   
      Output          : PAREX = x,y,z,dx/ds,dy/ds,dz/ds at intersection p
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   FTRACK                                                                          
        |---- AULPOL                                                               
                   |----  ABS                                 External             
                   |----  COS                                 External             
                   |----  SIN                                 External             
                   |----  SIGN                                External             
                   |----  UCOPY                               External             
   

2 B_

  >>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>
    CKEY 
     1st entry in B_set
     * 981109 corr file 308.3
        BCALJU : New - Create BCPO (BCAL POT bank) (P.Morawitz,G.Merino,M.Cattaneo)
        BCAREC : Obsolete. Will be removed from library in JULIA 309
        BCFILE : New - Translate BCAL raw data from ADC to Module mapping
                                                   (P.Morawitz,G.Merino,M.Cattaneo)
        BCGETE : New - Read in BCAL raw data event (P.Morawitz,G.Merino,M.Cattaneo)
    
     ! JULIA 305
        BCAREC : New - Create and fill BLCT bank  (G.Boix, I.C.Park, M.Cattaneo)
  <<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<
     BCALJU     Create bcpo (bcal pot bank)
     BCCRUN     Close   run for bcal
     BCFILE     Translate bcal raw data from adc to module mapping
     BCGETE     Read in bcal raw data event
     BCPACK     This subroutine reduces the length of the bcal banks bptr and bhit
     BINIJO     Initialize job for bcal
     BINIRU     Initialize run for bcal
     BMSUM      Accumulate data to determine beam position
     BPREDA     Handle bcal data
     BPRSUM     Print summary for bcal
     BSLOWC     Handle slow control for bcal

3 BCALJU
         SUBROUTINE BCALJU(IER)
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Create bcpo (bcal pot bank)
       Author:  Peter Morawitz, 6.11.98
                Code from Gonzalo Merino incorporated into JULIA framework
       Modified:Marco Cattaneo, 9.11.98
                Cleaned up for JULIA
       Purpose: Extract information from the raw data banks BHIT and BPTR and
                store it in the POT bank BCPO, for use in the BCAL++ offline
                calibration.
                Up to 100/9 Bcal events per ALEPH event are written to BCPO.
       IER = 0  splendid
       IER = 1  database not initialised
       IER = 2  no BOS bank space ... should go home
       IER = 3  BPTR bank found without corresponding BHIT bank
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   RECEVT                                                                          
        |---- BCALJU                                                               
                   |----  ABRUEV                              External             
                   |----  BCINIT                                                   
                   |----  NAMIND                              External             
                   |----  IW                                  External             
                   |----  RERROR                                                   
                   |----  BDROP                               External             
                   |----  AUBOS                               External             
                   |----  BCGETE                                                   
                   |----  IBITS                               External             
                   |----  BLIST                               External             
   
 
3 BCCRUN
         SUBROUTINE BCCRUN
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Close   run for bcal
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   RCLRUN                                                                          
        |---- BCCRUN.                                                              
   
 
3 BCFILE
         SUBROUTINE BCFILE(adc,iPmt,iApd,iSil)
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Translate bcal raw data from adc to module mapping
       Author:  Peter Morawitz, 6.11.98
                Code from Gonzalo Merino incorporated into JULIA framework
       Modified Marco Cattaneo, 9.11.98
                Cleaned up for JULIA
       Adapted from online subroutine fill_energy(adc,iPmt,iApd,iSil)
       ENTRY BCINIT( irun, iret ) is called once per run to initialise map.
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   BCGETE                                                                          
        |---- BCFILE                                                               
                   |----  RERROR                                                   
                   |----  INT                                 External             
                   |----  MOD                                 External             
                   |----  PAD_CODE                            External             
                   |----  WAFER_CODE                          External             
                   |----  MOD_CODE                            External             
                   |----  AGETDB                              External             
                   |----  NAMIND                              External             
   
 
3 BCGETE
         SUBROUTINE BCGETE(kbptr,kbhit,iev,itrmask,iPmt,iApd,iRmx,iPhmx)
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Read in bcal raw data event
       Author:  Peter Morawitz, 6.11.98
                Code from Gonzalo Merino incorporated into JULIA framework
       Modified:Marco Cattaneo, 9.11.98
                Cleaned up for JULIA
       Purpose: AUX routine called from BCALJU, reads in the BCAL event,
                derived from online routine:
                get_bcal_lumi_event(iev,itrmask,iPmt,iApd,iRmx,iPhmx)
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   BCALJU                                                                          
        |---- BCGETE                                                               
                   |----  VZERO                               External             
                   |----  IW                                  External             
                   |----  IBITS                               External             
                   |----  INT                                 External             
                   |----  BCFILE                                                   
   
 
3 BCPACK
         SUBROUTINE BCPACK
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   This subroutine reduces the length of the bcal banks bptr and bhit
          The individual silicon strip hits from the BHIT bank are
          suppressed. Instead 4 new hits are created with the centroid
          given by the individual silicon strips.
          Furthermore, the 'single' triggers are 'prescaled' by a factor
          given by the variable NEWMAX, which is set to 100.
          These two changes should reduce the BCAL information by a
          factor of 20 or so.
          E. Fernandez     6-Dec-89
          MODIFICATIONS:   13-JUN-90    by  J.A. Perlas
                           Consider new Trigger Mask types in
                           the new DAQ implementation.
                           28-AUG-91    by  E. Fernandez
                           Protect against inexistent banks.
                           Report exeeding no. of counts with
                           error reporting subroutine.
       Common /BCADCS/ used to exchange information between
       the BCPACK and CENTRD subroutines.
       TRMASK: is the BCAL trigger mask
       CENTRO: (1-4) centroid of shower in BCAL monitors 1-4
       ADCSUM: (1-4) tot ADCSUM in BCAL monitors 1-4
       ADCDAT: (180) ADC in channels 1-180 of BCAL
       ADCSCI: ADC for scintillators in monitors 1-4 channels 1-5
       ADCSIL: ADC for sil strips    in monitors 1-4 channels 1-40
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   RPOTCL                                                                          
        |---- BCPACK                                                               
                   |----  NAMIND                              External             
                   |----  IBITS                               External             
                   |----  MOD                                 External             
                   |----  RERROR                                                   
                   |----  FLOAT                               External             
                   |----  CENTRD                                                   
                   |----  NINT                                External             
                   |----  AUBOS                               External             
                   |----  BDROP                               External             
   
 
3 BINIJO
         SUBROUTINE BINIJO
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Initialize job for bcal
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   RINJOB                                                                          
        |---- BINIJO.                                                              
   
 
3 BINIRU
         SUBROUTINE BINIRU
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Initialize run for bcal
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   RINRUN                                                                          
        |---- BINIRU                                                               
                   |----  NAMIND                              External             
   
 
3 BMSUM
         SUBROUTINE BMSUM
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Accumulate data to determine beam position
   
   
      Author   : T. Burnett
      Last Update: 13 Sep 1991
      Last Update: 16 Jun 1995
      Modified by S. Wasserbaech: use VDET-fitted tracks;
          save sums separately for tracks with and without
          VDET r-phi coordinates.  The A and B ends are
          no longer separated.
      Modified by P. Comas: have the same information
          per wagon in a train to fill the extended
          JSUM bank.
   
      Inputs:
           -  JSUM : vertex info
           -  FRFT, FRTL : fit tracks
           -  VDCO : Vdet coordinates
   
      Outputs:
           -  BSUM : accumulate info, 10 words for each category
                     (with and without VDET);
                     assume zero initially
           -  BSUMBU : just the same per bunch
   
      Libraries required:
   
      Description
      ===========
      Gathers information for a d0-vs-phi fit to determine the
      average beam position
   
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   RWREVT                                                                          
        |---- BMSUM                                                                
                   |----  NAMIND                              External             
                   |----  NLINK                               External             
                   |----  GTSTUP                              External             
                   |----  ABS                                 External             
                   |----  SQRT                                External             
                   |----  SIN                                 External             
                   |----  COS                                 External             
                   |----  BTEST                               External             
                   |----  RQBUNC                              External             
   
 
3 BPREDA
         SUBROUTINE BPREDA
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Handle bcal data
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   RPREDA                                                                          
        |---- BPREDA.                                                              
   
 
3 BPRSUM
         SUBROUTINE BPRSUM
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Print summary for bcal
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   RSMJOB                                                                          
        |---- BPRSUM.                                                              
   
 
3 BSLOWC
         SUBROUTINE BSLOWC
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Handle slow control for bcal
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   RUNKNO                                                                          
        |---- BSLOWC.                                                              
   

2 C_

  >>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>
    CKEY 
     1st entry in C_SET
    
     ! JULIA 305
        CRCHRL : fix variable type inconsistencies in function calls,
                 for Linux                                           (A.Waananen)
    
     ! JULIA 280
       CFPNMP, CRCJOB, CTHCLU : replace WRITE(6, by WRITE(IW(6),
                               (H. Drevermann, Feb 96)
       CTKCHG : opening "'" should have a closing "'" within the same
               line for cvs (F. Ranjard, Feb 96)
    
     * corr file 279.1
       CASHET : remove comments after *CA for LIGHT (P. Comas, Nov 95)
     ! JULIA 279
    
     ! JULIA 275
       CDANG : restrict COMN1 to [-1.,1.] to avoid precision problems
              (P. Comas, 18-OCT-1994)
       CTRPAR : avoid division by zero: no need to step in the helix if
               STEP = 0  (A. Bonissant,P. Comas, 29-SEP-1994)
     ! JULIA 272
       CINIJO : define POT name-indices even when no output file is required
    
  <<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<
     CABOOK     Book histograms for calorimeter process
     CALREC     Perform ecal and hcal analysis
     CALREL     Finds relation between any 2 chrl rows
     CALREP     Replace calobj isupp by irep in bank
     CALSUP     Suppress element isupp in bank at index kbank
     CASHET     Associate hc, ec and tpc
     CASMP      Assoc. hc and tpc mip
     CASNEU     Assoc. neutral ec and
     CASNMP     Assoc. hc, ec and tpc nomip
     CCLORL     Close trk-ecob-hclu relation
     CCTRMI     Find if track is mip at ec exit (exact)
     CCUTPE     Make cuts on ec-hc association
     CDANG      Compute distance between two polygons  with respect to direction v1
     CDTHS      Compute track-hstorey distance
     CEGCLU     Get ecob assoc. with track itr (true association)
     CENCCH     Compute residual energy in charged ecob
     CENCNE     Compute residual energy in charged ecob
     CESCLU     Navigate from ijk to ecobject(s)
     CEXCOB     Extended calob reconstruction
     CEXHIS     Extended calob hist filling
     CFPASS     Det. tpc-hc assoc. param.
     CFPMIP     Det. tpc-hc assoc. param.
     CFPNMP     Det. tpc-hc assoc. param.
     CGRUNC     Get run conditions for calrec
     CHCLU      Compute residual energy in hclu
     CHGCLU     Go from trk to  hclu (true)
     CHSCLU     Go from hcstorey to hclu
     CINIJO     Initialise job for calo process
     CINIRL     Initialize tpc to hcal relation banks
     CINPAR     Create cpar bank
     CINSRL     Inserts a trk-clus relation  (tpc-hcal)
     CISGAM     Say if an ecob is gamma
     CISHIT     See if hstorey is hit
     CLUDIS     Compute  ecob-hclu distance with respect to direction of track itr
     CMONI      Summ pcpa energies
     CNIGHB     Loop on neighbours of point xpt in hstorey
     COSLST     Make list of cosines          between hcal and ecal faces
     CPADWR     Create & fill prpw banks
     CPARAD     Add one calorimeter particle in bank cpar
     CPOTCR     Create bank for pot output
     CPOTEH     Create banks for pot output
     CPOTLC     Add lcal to peob and pept banks
     CPTCOM     See if faces have a common point
     CRCALO     Create calorimeter object bank
     CRCHRL     Create calob chrl relation bank
     CRCJOB     Close job for calorimeter process
     CRCPAR     Create and fill cpar bank
     CRHCLU     Find recons hcal cluster type
     CTHCLU     Find true hcal cluster type
     CTKCHG     Find charge of primary particle connected with track itrk
     CTRMIP     Find if track is mip particle    (recons)
     CTRPAR     Find the expected contribution of the track to the calobject
     CTRTOC     Go from trk to ecob & hclu
     CVRIFY     Verify hcal-tpc association

3 CABOOK
         SUBROUTINE CABOOK
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   
   Book histograms for calorimeter process
   
     AUTHOR   : A. BONISSENT  870831
   
   
     BANKS :
       INPUT   : NONE
       OUTPUT  : NONE
       CREATED : NONE
   
   
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   RBKHIS                                                                          
        |---- CABOOK                                                               
                   |----  HBOOK2                              External             
                   |----  HBOOK1                              External             
                   |----  HTABLE                              External             
   
 
3 CALREC
         SUBROUTINE CALREC
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Perform ecal and hcal analysis
      Modified :- E. Lancon             17-MAR-1992
           add call to EGAEST
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   RECEVT                                                                          
        |---- CALREC                                                               
                   |----  RNXMOD                                                   
                   |----  ECFCLU                                                   
                   |----  ECRMIP                                                   
                   |----  ELECID                                                   
                   |----  ECGMIX                                                   
                   |----  ECFOBJ                                                   
                   |----  ECPRIN                                                   
                   |----  HDPREC                                                   
                   |----  ECHCGL                                                   
                   |----  RERROR                                                   
   
 
3 CALREL
         SUBROUTINE CALREL (IREF,NREF,IREL,NREL)
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Finds relation between any 2 chrl rows
   
       Authors : M.N. Minard , M. Pepe       16/03/89
      INPUT:
   -    IREF = Column number in CHRL for which you want
   -           to test whether relation exists
   -    NREF = Element number in column for which you
   -           test relation
   -    IREL = Column number in CHRL of wanted relation
   -   OUTPUT:
   -    NREL = First relation number found
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   CPOTEH                                                                          
   CPOTLC                                                                          
        |---- CALREL                                                               
                   |----  NAMIND                              External             
   
 
3 CALREP
         SUBROUTINE CALREP(ISUPP,IREP,KBANK,L)
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Replace calobj isupp by irep in bank
   
   
   
     BANKS :
       INPUT   : BANK
       OUTPUT  : BANK
       CREATED : NONE
   
      isupp   = number of the ecob to suppress
      irep    = number by which isupp will be replaced
      kbank   = index of the bank which has relations with the ecob bank
      l       = offset of the colums which carries the relation
   
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   CRCALO                                                                          
        |---- CALREP.                                                              
   
 
3 CALSUP
         SUBROUTINE CALSUP(ISUPP,KBANK)
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Suppress element isupp in bank at index kbank
   
   
   
     BANKS :
       INPUT   : BANK
       OUTPUT  : BANK
       CREATED : NONE
   
      isupp   = number of the line to suppress
      kbank   = index of the bank which has relations with the ecob bank
   
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   CRCALO                                                                          
        |---- CALSUP                                                               
                   |----  UCOPY                               External             
   
 
3 CASHET
         SUBROUTINE CASHET(IER)
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   
   Associate hc, ec and tpc
   
     AUTHOR   : A. BONISSENT  870505
     MODIFIED : A. BONISSENT  901206
   
   
     BANKS :
       INPUT   : ETP1,EFET
       OUTPUT  : NONE
       CREATED : NONE
   
   
   
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   ECHCGL                                                                          
        |---- CASHET                                                               
                   |----  CINIRL                                                   
                   |----  NAMIND                              External             
                   |----  WBANK                               External             
                   |----  CTRMIP                                                   
                   |----  CASNMP                                                   
                   |----  CASMP                                                    
                   |----  CASNEU                                                   
                   |----  CCLORL                                                   
                   |----  WDROP                               External             
                   |----  RERROR                                                   
   
 
3 CASMP
         SUBROUTINE CASMP(ITR,IFND)
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   
   Assoc. hc and tpc mip
   
     AUTHOR   : A. BONISSENT  870911
     MODIFIED : A. BONISSENT  901206
   
   
     BANKS :
       INPUT   : TREX
       OUTPUT  : NONE
       CREATED : NONE
   
      itr = track number
   
   
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   CASHET                                                                          
        |---- CASMP                                                                
                   |----  NLINK                               External             
                   |----  IABS                                External             
                   |----  PT                                  External             
                   |----  HFNDTW                              External             
                   |----  CISHIT                                                   
                   |----  CINSRL                                                   
                   |----  CNIGHB                                                   
   
 
3 CASNEU
         SUBROUTINE CASNEU
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   
   Assoc. neutral ec and
   
     AUTHOR   : A. BONISSENT  880315
   
   
     BANKS :
       INPUT   : ECOB,HCLU
       OUTPUT  : NONE
       CREATED : NONE
   
   
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   CASHET                                                                          
        |---- CASNEU                                                               
                   |----  NLINK                               External             
                   |----  CISGAM                                                   
                   |----  SIN                                 External             
                   |----  COS                                 External             
                   |----  CLUDIS                                                   
                   |----  CCUTPE                                                   
                   |----  CINSRL                                                   
   
 
3 CASNMP
         SUBROUTINE CASNMP(ITR,IFND)
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   
   Assoc. hc, ec and tpc nomip
   
     AUTHOR   : A. BONISSENT  870911
     MODIFIED : A. BONISSENT  901206
   
   
     BANKS :
       INPUT   : ETCK,HCLU
       OUTPUT  : NONE
       CREATED : NONE
   
      itr = track number
   
   
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   CASHET                                                                          
        |---- CASNMP                                                               
                   |----  CLUDIS                                                   
                   |----  SIN                                 External             
                   |----  CCUTPE                                                   
                   |----  CINSRL                                                   
   
 
3 CCLORL
         SUBROUTINE CCLORL(XRL3)
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   
   Close trk-ecob-hclu relation
   
   
     AUTHOR   : A. BONISSENT  870615
   
     BANKS :
       INPUT   : XRL3
       OUTPUT  : XRL3
       CREATED : NONE
   
   
      UPDATE THE LENGTH OF CLUSTER-TRACK RELATIONS BANK FROM
      ITS ORIGINAL MAXIMUM LENGTH TO ITS ACTUAL LENGTH
   
        INPUT  = NUMBER OF RELATIONS
        OUTPUT = SIZE OF XRL3 BANK
   
   
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   CASHET                                                                          
        |---- CCLORL                                                               
                   |----  NLINK                               External             
                   |----  AUBOS                               External             
   
 
3 CCTRMI
         SUBROUTINE CCTRMI(ITR,IFMIP)
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   
   Find if track is mip at ec exit (exact)
   
     AUTHOR   : A. BONISSENT  870831
   
   
     BANKS :
       INPUT   : KINE,VERT
       OUTPUT  : NONE
       CREATED : NONE
   
      ITR     : Geant track number (should be a primary track)
      IFMIP   : 1 if track is MIP
                0 if track is not MIP
   
   
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   CFPASS                                                                          
   CTHCLU                                                                          
        |---- CCTRMI                                                               
                   |----  NLINK                               External             
                   |----  EX3IJK                                                   
   
 
3 CCUTPE
         SUBROUTINE CCUTPE(DIST,PT,EHCLU,IASSO)
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   
   Make cuts on ec-hc association
   
     AUTHOR   : A. BONISSENT  870831
   
   
     BANKS :
       INPUT   : NONE
       OUTPUT  : NONE
       CREATED : NONE
   
      DIST : Angular distance
      PT      : transverse momentum
      EHCLU   : Energy of the hcal cluster
      IASSO   : Output, 1 if association is good, 0 else
   
   
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   CASNEU                                                                          
   CASNMP                                                                          
        |---- CCUTPE.                                                              
   
 
3 CDANG
         SUBROUTINE CDANG(X1,X2,V1,ANGL,IFENC)
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   
   Compute distance between two polygons  with respect to direction v1
   
     AUTHOR   : A. BONISSENT  870831
   
   
     BANKS :
       INPUT   : NONE
       OUTPUT  : NONE
       CREATED : NONE
   
      X1     : track number
      X2     : Table of EcObs
      V1     : Direction of reference
      ANGLE  : Output (radians)
      IFENC  : 1 if Hcal polygon is in endcap
   
     MODIFICATIONS :
           P. COMAS (18-OCT-1994)
              Restrict COMN1 to [-1.,1.] to avoid precision problems
   
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   CLUDIS                                                                          
        |---- CDANG                                                                
                   |----  COSLST                                                   
                   |----  ACOS                                External             
                   |----  CPTCOM                                                   
                   |----  ABS                                 External             
                   |----  SIGN                                External             
                   |----  FORMAT                              External             
   
 
3 CDTHS
         SUBROUTINE CDTHS(TXX,TRTF,IKSCK,NPTS,ISTH,DIST)
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   
   Compute track-hstorey distance
     for one mip track
   
     AUTHOR   : A. BONISSENT  871023
   
   
     BANKS :
       INPUT   : HSTO
       OUTPUT  : NONE
       CREATED : NONE
   
      Txx   = coordinates along extrapolated track (X,Y,Z)
      Trtf  = coordinates along extrapolated track (R,T,FI,Rms)
      Isth  = hcal storey number
      dist  = distance/sigma multiple scattering
   
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   CFPMIP                                                                          
        |---- CDTHS                                                                
                   |----  SQRT                                External             
                   |----  HUSRAN                              External             
                   |----  AMIN1                               External             
                   |----  ABS                                 External             
                   |----  SIGN                                External             
                   |----  SIN                                 External             
   
 
3 CEGCLU
         SUBROUTINE CEGCLU(ITR,IECO,NECO,MXCLU,IER)
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   
   Get ecob assoc. with track itr (true association)
   
     AUTHOR   : A. BONISSENT  870831
   
   
     BANKS :
       INPUT   : ETTD
       OUTPUT  : NONE
       CREATED : NONE
   
      ITR  : Geant track number
      Ieco : Table of EcObs
      Neco : Number ob Ecobs
   
   
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   CTRTOC                                                                          
        |---- CEGCLU                                                               
                   |----  NLINK                               External             
                   |----  CESCLU                                                   
   
 
3 CENCCH
         SUBROUTINE CENCCH(IECOB,ICHYP,ERES,IRES,IER)
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   
   Compute residual energy in charged ecob
   
     AUTHOR   : D. PALLIN     881221
   
   
     BANKS :
       INPUT   : ECLU
       OUTPUT  : CPAR (via cparad)
       CREATED : NONE
   
      Iecob   = Ecobject number (input)
      Ichyp   = CalHyp number   (input)
      IRES    = 0 IF NO RESIDUAL ENERGY (OUTPUT)
      Eres(4) = Residual energy (output)
      Ier     = Return code (0=OK)
   
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   CRCPAR                                                                          
        |---- CENCCH                                                               
                   |----  CPARAD                                                   
                   |----  COS                                 External             
                   |----  SIN                                 External             
   
 
3 CENCNE
         SUBROUTINE CENCNE(IECOB,ICHYP,ERES,IRES,IER)
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   
   Compute residual energy in charged ecob
   
     AUTHOR   :  J BADIER     881216
   
   
     BANKS :
       INPUT   : ECOB , EHYP , EPAR
       OUTPUT  : CPAR (via cparad)
       CREATED : NONE
   
      Iecob  = Ecobject number (input)
      Ichyp  = CalHyp number   (input)
      Eres(4)= Residual energy (output)
      Ires   = 0 : there was no residual energy; # 0 else
      Ier    = Return code (0=OK)
   
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   CRCPAR                                                                          
        |---- CENCNE                                                               
                   |----  COS                                 External             
                   |----  SIN                                 External             
                   |----  CPARAD                                                   
   
 
3 CESCLU
         SUBROUTINE CESCLU(I,J,K,IECO,NECO,MXCLU,IER)
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   
   Navigate from ijk to ecobject(s)
   
     AUTHOR   : A. BONISSENT  870831
   
   
     BANKS :
       INPUT   : EBOS,ESDA
       OUTPUT  : NONE
       CREATED : NONE
   
      I,J,K   : Storey Address
      IECO    : Table of EcObs
      NECO    : Number of Ecobs
   
   
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   CEGCLU                                                                          
        |---- CESCLU.                                                              
   
 
3 CEXCOB
         SUBROUTINE CEXCOB(NSPN0)
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   
   Extended calob reconstruction
   
    Author :  R. TENCHINI      880506
   
    Version 1.0  880506
   
    Input   HSPH FAMILY OF BANKS, CRL3 CCT1 BANKS
    Output  CEXT BANK
   
    NSPTT0=Number  of superpatterns
   
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   ECHCGL                                                                          
        |---- CEXCOB                                                               
                   |----  NAMIND                              External             
                   |----  RERROR                                                   
                   |----  NLINK                               External             
                   |----  WBANK                               External             
                   |----  UCOPY                               External             
                   |----  MOD                                 External             
                   |----  AUBOS                               External             
                   |----  NPRNT                               External             
                   |----  WDROP                               External             
   
 
3 CEXHIS
         SUBROUTINE CEXHIS
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   
   Extended calob hist filling
   
    AUTHOR :  R. TENCHINI      880511
   
    Version 1.0  880506
   
    INPUT   CEXT BANK
   
    NSPTT0=Number  of superpatterns
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   ECHCGL                                                                          
        |---- CEXHIS                                                               
                   |----  NLINK                               External             
                   |----  REPORT                                                   
                   |----  NAMIND                              External             
                   |----  MOD                                 External             
                   |----  HFILL                               External             
                   |----  FLOAT                               External             
   
 
3 CFPASS
         SUBROUTINE CFPASS(IER)
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   
   Det. tpc-hc assoc. param.
   
     AUTHOR   : A. BONISSENT  870831
   
   
     BANKS :
       INPUT   : ETP1,EFET,ECOB,ETCK
       OUTPUT  : NONE
       CREATED : NONE
   
   
   
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   ECHCGL                                                                          
        |---- CFPASS                                                               
                   |----  CTRTOC                                                   
                   |----  CCTRMI                                                   
                   |----  CFPMIP                                                   
                   |----  CFPNMP                                                   
                   |----  RERROR                                                   
   
 
3 CFPMIP
         SUBROUTINE CFPMIP(ITR,ICLUH,NCLUH)
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   
   Det. tpc-hc assoc. param.
     for one nomip track
   
     AUTHOR   : A. BONISSENT  870911
   
   
     BANKS :
       INPUT   : NONE
       OUTPUT  : NONE
       CREATED : NONE
   
      Itr   = track number
      Ieco  = list of ecobjects in which track has deposited energy
      Neco  = number of ecob
      Icluh = list of Hclusters in which track has deposited energy
      Ncluh = number of hclu
   
   
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   CFPASS                                                                          
        |---- CFPMIP                                                               
                   |----  NLINK                               External             
                   |----  IABS                                External             
                   |----  XX                                  External             
                   |----  SQRT                                External             
                   |----  ACOS                                External             
                   |----  ATAN2                               External             
                   |----  HFNDTW                              External             
                   |----  CDTHS                                                    
                   |----  AMIN1                               External             
                   |----  HFILL                               External             
   
 
3 CFPNMP
         SUBROUTINE CFPNMP(ITR,IECO,NECO,ICLUH,NCLUH)
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   
   Det. tpc-hc assoc. param.
     for one nomip track
   
     AUTHOR   : A. BONISSENT  870831
   
   
     BANKS :
       INPUT   : ETCK,HCLU
       OUTPUT  : NONE
       CREATED : NONE
   
      Itr   = track number
      Ieco  = list of ecobjects in which track has deposited energy
      Neco  = number of ecob
      Icluh = list of Hclusters in which track has deposited energy
      Ncluh = number of hclu
   
   
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   CFPASS                                                                          
        |---- CFPNMP                                                               
                   |----  CLUDIS                                                   
                   |----  SIN                                 External             
                   |----  HFILL                               External             
   
 
3 CGRUNC
         SUBROUTINE CGRUNC
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   
   Get run conditions for calrec
   
     AUTHOR   : A. BONISSENT  870505
   
   
     BANKS :
       INPUT   : COPT
       OUTPUT  : NONE
       CREATED : NONE
   
   
   
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   CINIJO                                                                          
        |---- CGRUNC                                                               
                   |----  MDARD                               External             
                   |----  JHISRF                              External             
   
 
3 CHCLU
         SUBROUTINE CHCLU(IHCLU,ICHYP,ERES,IRES,IER)
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   
   Compute residual energy in hclu
   
     AUTHOR   : A. BONISSENT  881216
     Modified : A. BONISSENT  881216
                  Skip noisy clusters
   
     BANKS :
       INPUT   : HCLU
       OUTPUT  : CPAR (via cparad)
       CREATED : NONE
   
      Ihclu  = hcluject number (input)
      Ichyp  = CalHyp number   (input)
      Eres(4)= Residual energy (output)
      Ires   = 0 : there was no residual energy; # 0 else
      Ier    = Return code (0=OK)
   
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   CRCPAR                                                                          
        |---- CHCLU                                                                
                   |----  SIN                                 External             
                   |----  COS                                 External             
   
 
3 CHGCLU
         SUBROUTINE CHGCLU(ITR,ICLUH,NCLUH,MXCLU,IER)
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   
   Go from trk to  hclu (true)
   
     AUTHOR   : A. BONISSENT  870831
   
   
     BANKS :
       INPUT   : HTTD,HTHT
       OUTPUT  : NONE
       CREATED : NONE
   
      Itr     : track number
      ICLUH   : Table of HCLUS
      NCLUH   : Number of HCLUS
   
   
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   CTRTOC                                                                          
        |---- CHGCLU                                                               
                   |----  NLINK                               External             
                   |----  CHSCLU                                                   
   
 
3 CHSCLU
         SUBROUTINE CHSCLU(ITWA,ICLUH)
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   
   Go from hcstorey to hclu
   
     AUTHOR   : A. BONISSENT  870831
   
   
     BANKS :
       INPUT   : KINE,VERT
       OUTPUT  : NONE
       CREATED : NONE
   
      ITWA    : Hcal tower address (encoded)
      ICLUH   : Hcal cluster number to which tower belongs
   
   
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   CHGCLU                                                                          
        |---- CHSCLU.                                                              
   
 
3 CINIJO
         SUBROUTINE CINIJO
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   
   Initialise job for calo process
      set up bank formats and name indices
   
     AUTHOR   : A. BONISSENT  870831
   
   
       OUTPUT  : NONE
     BANKS :
       INPUT   : NONE
       CREATED : NONE
   
   
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   RINJOB                                                                          
        |---- CINIJO                                                               
                   |----  NAMIND                              External             
                   |----  CGRUNC                                                   
   
 
3 CINIRL
         SUBROUTINE CINIRL(IER)
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   
   Initialize tpc to hcal relation banks
   
     AUTHOR   : A. BONISSENT  870610
   
   
     BANKS :
       INPUT   : ETP1,HCLU
       OUTPUT  : NONE
       CREATED : CCT1,CTC2,CRL3
   
    CCT1 IS FOR CLUSTERS TOWARDS TRACKS (CLTR)
    CTC2 IS FOR TRACKS TOWARDS CLUSTERS (TRCL)
    CRL3 IS FOR THE RELATIONS BETWEEN CLUSTERS AND TRACKS (RLCT)
       ( Clusters are Hcal)
            NO INPUT
             CCT1  : FROM CLUSTERS TO TRACKS (CLTR)
                     POINTER TO FIRST RELATION FOR EACH CLUSTER
             CTC2  : FROM TRACKS TO CLUSTERS (TRCL)
                     POINTER TO FIRST RELATION FAR EACH TRACK
             CRL3  : RELATIONS BETWEEN CLUSTERS AND TRACKS (RLCT)
                     CREATED WITH MAX SIZE : NCLU*NTRAKS RELATIONS
   
    ********************************************************************
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   CASHET                                                                          
        |---- CINIRL                                                               
                   |----  AUBOS                               External             
                   |----  BLIST                               External             
                   |----  RERROR                                                   
                   |----  NDROP                               External             
   
 
3 CINPAR
         SUBROUTINE CINPAR(IER)
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   
   Create cpar bank
   
     AUTHOR   : A. BONISSENT  881216
   
   
     BANKS :
       INPUT   : CALO
       CREATED : CPAR
   
      Ier  = Return code (0=OK)
   
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   CRCPAR                                                                          
        |---- CINPAR                                                               
                   |----  AUBOS                               External             
                   |----  BLIST                               External             
   
 
3 CINSRL
         SUBROUTINE CINSRL(IDTPC,IHCAL,PT,IECOB)
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   
   Inserts a trk-clus relation  (tpc-hcal)
   
   
     AUTHOR   : A. BONISSENT  870615
   
   
     BANKS :
       INPUT   : NONE
       OUTPUT  : CCT1,CTC2,CRL3,COCR
       CREATED : NONE
   
     CCT1  = POINTER TO HCLU RELATION BANK
           1 WORD PER CLUSTER : ADDRESS OF FIRST
             RELATION FOR THIS CLUSTER)
           PARALLEL TO HCLU BANK
   
     CTC2  = POINTER TO TRACK RELATION BANK
           1 WORD PER TRACK : ADDRESS OF FIRST RELATION FOR THIS TRACK)
           PARALLEL TO TRACK BANK
   
     COCR  = POINTER TO ECOB RELATION
           1 WORD PER ECOB : ADDRESS OF FIRST RELATION FOR THIS ECOB)
           PARALLEL TO ECOB BANK
   
     CRL3  = POINTER TO RELATION BANK BETWEEN TRACKS AND CLUSTERS (RLCT)
           5 WORDS PER RELATION :
   
             WORD 1 = TRACK NUMBER
             WORD 2 = CLUSTER NUMBER
             WORD 3 = POINTER TO NEXT RELATION FOR CLUSTER (0 IF LAST)
                      TRANSVERSE MOMENTUM
                      ECAL CLUSTER NUMBER (0 IF NONE)
             NO POINTER TO NEXT TRACK (SEQUENTIAL ORDER IN TRACKS)
   
   
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   CASMP                                                                           
   CASNEU                                                                          
   CASNMP                                                                          
   CNIGHB                                                                          
        |---- CINSRL.                                                              
   
 
3 CISGAM
         SUBROUTINE CISGAM(IEC,IFGAM)
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   
   Say if an ecob is gamma
   
     TEMPORARY
   
   
     BANKS :
       INPUT   :
       OUTPUT  :
       CREATED :
   
      iec   = ecob number
      ifgam = 0 if not gamma
   
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   CASNEU                                                                          
        |---- CISGAM.                                                              
   
 
3 CISHIT
         SUBROUTINE CISHIT(IFI,JT,KS,IHCLU)
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   
   See if hstorey is hit
   
     AUTHOR   : A. BONISSENT  871023
   
   
     BANKS :
       INPUT   : HSDA
       OUTPUT  : NONE
       CREATED : NONE
   
      ifi      = phi     (input)
      jt       = theta   (input)
      kc       = stack   (input)
   
      ihclu    = hcluster number, 0 if not hit  (output)
   
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   CASMP                                                                           
        |---- CISHIT.                                                              
   
 
3 CLUDIS
         SUBROUTINE CLUDIS(V1,IECOB,IHCL,DIST)
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   
   Compute  ecob-hclu distance with respect to direction of track itr
   
     AUTHOR   : A. BONISSENT  870831
   
   
     BANKS :
       INPUT   : ECOB,EBOS,ESDA,HSDA,ESTO,HSTO,ETP1
       OUTPUT  : NONE
       CREATED : NONE
   
      Itr     : track number
      IECOB   : Ecob number
      IHCL    : Hclu number
      DIST    : angular distance (radians)
   
   
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   CASNEU                                                                          
   CASNMP                                                                          
   CFPNMP                                                                          
        |---- CLUDIS                                                               
                   |----  CDANG                                                    
   
 
3 CMONI
         SUBROUTINE CMONI(EPPOS,EPTOT)
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   
   Summ pcpa energies
   
     AUTHOR   : A. BONISSENT  900130
   
   
     BANKS :
       INPUT   : PCPA
       OUTPUT  : NONE
       CREATED : NONE
      EPPOS and EPTOT are the sums of neutral calorimeter particles :
   
      EPPOS = Sum of energies of particles when energy is >0
      EPTOT = Sum of energies of all particles
   
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   RMONIT                                                                          
        |---- CMONI                                                                
                   |----  NLINK                               External             
   
 
3 CNIGHB
         SUBROUTINE CNIGHB(XPT,RMS,JT,IFI,KS,ITR,IECOB,IFND)
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   
   Loop on neighbours of point xpt in hstorey
   
     AUTHOR   : A. BONISSENT  871023
     MODIFIED : A. BONISSENT  901206
   
   
     BANKS :
       INPUT   : HSTO,HSDA
       OUTPUT  : NONE
       CREATED : NONE
   
      xpt(3)   = coordinates point (X,Y,Z)
      rms      = multiple scattering
      jt       = theta
      ifi      = phi
      ks       = stack
   
   
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   CASMP                                                                           
        |---- CNIGHB                                                               
                   |----  HSRCR                               External             
                   |----  CENT                                External             
                   |----  HUSRAN                              External             
                   |----  SQRT                                External             
                   |----  ACOS                                External             
                   |----  ATAN2                               External             
                   |----  AMIN1                               External             
                   |----  ABS                                 External             
                   |----  SIGN                                External             
                   |----  SIN                                 External             
                   |----  CINSRL                                                   
   
 
3 COSLST
         SUBROUTINE COSLST(X1,X2,V1,COSA,NP)
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   
   Make list of cosines          between hcal and ecal faces
   
     AUTHOR   : A. BONISSENT  870831
   
   
     BANKS :
       INPUT   : NONE
       OUTPUT  : NONE
       CREATED : NONE
   
      X1,X2   : Coordinates of the corners of the two faces
      V1      : Direction cosines of the reference idrection
      COSA    : Table of Cosines
      NP      : Number of corners in tables X1 and X2
   
   
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   CDANG                                                                           
        |---- COSLST                                                               
                   |----  SQRT                                External             
   
 
3 CPADWR
         SUBROUTINE CPADWR (IERR)
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Create & fill prpw banks
   -
   -     Author  : M.N. Minard                 26/08/89
   -     Relation Between PECO  & Module #
        Banks Created PRPW
        Banks used PECO , PEST , ETDI , PEWI
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   RDEFPO                                                                          
        |---- CPADWR                                                               
                   |----  NAMIND                              External             
                   |----  AUBOS                               External             
                   |----  BLIST                               External             
                   |----  VZERO                               External             
                   |----  IBITS                               External             
                   |----  ECSCMD                                                   
                   |----  FLOAT                               External             
                   |----  AUBPRS                              External             
                   |----  REPORT                                                   
                   |----  RERROR                                                   
   
 
3 CPARAD
         SUBROUTINE CPARAD(ICHY,IEHY,IHHY,IPHY,NATUR,E,TH,FI,R1,R2,IER)
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   
   Add one calorimeter particle in bank cpar
   
     AUTHOR   : A. BONISSENT  881216
   
   
     BANKS :
       INPUT   : NONE
       OUTPUT  : CPAR                                                   *CFPASS11
       CREATED : NONE
   
      Ichy   =  cal hypothesis number
      Iehy   =  ecob hypothesis number
      Ihhy   =  Hc hypothesis number
      Iphy   =  Pattern hypothesis number
      Nature =  Hypothesis nature
      E      =  Partricle energy
      FI     =  Phi
      TH     =  Theta
      R1     =  R1 estimator
      R2     =  R2 estimator
      Ier    =  Return code, 0=OK
   
   
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   CENCCH                                                                          
   CENCNE                                                                          
   CRCPAR                                                                          
        |---- CPARAD                                                               
                   |----  AUBOS                               External             
                   |----  RERROR                                                   
   
 
3 CPOTCR
         SUBROUTINE CPOTCR(IER)
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Create bank for pot output
   
      Author :  JP Albanese   20 06 88
      Modified: C Benchouk Aug. 89,Jan.90
   
          Banks :
           Input : ESDA,ECOB,CALO,EHYP,EPAR,EBOS,COCR...
           Output: PCOB,PCRL,PCHY,PCPA,PEOB,PEHYP,PEST,PKST
   
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   RDEFPO                                                                          
        |---- CPOTCR                                                               
                   |----  NDROP                               External             
                   |----  NLINK                               External             
                   |----  AUBOS                               External             
                   |----  UCOPY                               External             
                   |----  IF                                  External             
   
 
3 CPOTEH
         SUBROUTINE CPOTEH(IER)
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Create banks for pot output
   
      Authors:  M.N.Minard, M.Pepe
   
          Banks  :
           Input : ECLU,ECOB,HCLU,EHYP
           Output: PECO,PHCO,PEPT
   
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   RDEFPO                                                                          
        |---- CPOTEH                                                               
                   |----  NDROP                               External             
                   |----  NAMIND                              External             
                   |----  AUBOS                               External             
                   |----  BLIST                               External             
                   |----  CALREL                                                   
   
 
3 CPOTLC
         SUBROUTINE CPOTLC
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Add lcal to peob and pept banks
   
      Authors  :  M.N.Minard, M.Pepe
      Input    : LCLU LOBJ PECO PEPT CHRL CALO
      Output   : PECO PEPT CHRL CALO
   
      Modified :- M.N. Minard              9-DEC-1991
             Use LPES and LPSV to fill banks in case of POT->POT repro.
      Modified :- E. Lancon             23-JUN-1992
             In case of POT->POT repro. PCRL and PCOB should also be
             mofified! this should have been done in LCRPOT for
             normal processing.
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   RDEFPO                                                                          
        |---- CPOTLC                                                               
                   |----  NAMIND                              External             
                   |----  AUBOS                               External             
                   |----  BLIST                               External             
                   |----  UCOPY                               External             
                   |----  CALREL                                                   
                   |----  PRTABL                              External             
   
 
3 CPTCOM
         SUBROUTINE CPTCOM(V1,XEC,XHC,IPTC)
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   
   See if faces have a common point
    in the direction of v1
   
     AUTHOR   : A. BONISSENT  870831
   
   
     BANKS :
       INPUT   : KINE,VERT
       OUTPUT  : NONE
       CREATED : NONE
   
      V1      : Reference direction
      XEC,XHC : Ecal and Hcal faces
      IPTC    : Output, 1 if there is a common point, 0 else
   
   
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   CDANG                                                                           
        |---- CPTCOM.                                                              
   
 
3 CRCALO
         SUBROUTINE CRCALO(IER)
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   
   Create calorimeter object bank
   
   
   
     BANKS :
       INPUT   :
       OUTPUT  :
       CREATED :
   
      ier   = Return code ( 0 if normal)
   
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   ECHCGL                                                                          
        |---- CRCALO                                                               
                   |----  AUBOS                               External             
                   |----  BLIST                               External             
                   |----  MIN0                                External             
                   |----  MAX0                                External             
                   |----  CALREP                                                   
                   |----  CALSUP                                                   
   
 
3 CRCHRL
         SUBROUTINE CRCHRL(NSPNH)
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   
   Create calob chrl relation bank
    Author: R.Tenchini           881129
   
    NSPNH = H Superpattern Number
    INPUT Banks : CRL3, HSPH, COCR
    OUTPUT Banks : CHRL
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   ECHCGL                                                                          
        |---- CRCHRL                                                               
                   |----  NLINK                               External             
                   |----  WBANK                               External             
                   |----  MOD                                 External             
                   |----  RERROR                                                   
                   |----  AUBOS                               External             
                   |----  UCOPY                               External             
                   |----  WDROP                               External             
                   |----  BGARB                               External             
                   |----  WGARB                               External             
   
 
3 CRCJOB
         SUBROUTINE CRCJOB
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   
   Close job for calorimeter process
   
   
     AUTHOR   : A. BONISSENT  870615
   
   
   
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   USCJOB                                                                          
        |---- CRCJOB                                                               
                   |----  FLOAT                               External             
                   |----  HOPERA                              External             
   
 
3 CRCPAR
         SUBROUTINE CRCPAR
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   
   Create and fill cpar bank
   
     AUTHOR   : A. BONISSENT  881216
     MODIFIED : A. BONISSENT  901206
   
   
     BANKS :
       INPUT   : CALO
       OUTPUT  : CPAR (via cparad)
       CREATED : CPAR (via cinpar)
   
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
              CRCPAR                                                               
                   |----  NLINK                               External             
                   |----  CINPAR                                                   
                   |----  UINDXS                              External             
                   |----  AUBOS                               External             
                   |----  BLIST                               External             
                   |----  IF                                  External             
                   |----  RERROR                                                   
                   |----  CENCCH                                                   
                   |----  CENCNE                                                   
                   |----  CHCLU                                                    
                   |----  CTRPAR                                                   
                   |----  TRA                                 External             
                   |----  SQRT                                External             
                   |----  ATAN2                               External             
                   |----  CPARAD                                                   
                   |----  CONTINUECALLWDROP                   External             
                   |----  WDROP                               External             
   
 
3 CRHCLU
         SUBROUTINE CRHCLU(ICLUH,IREHC)
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   
   Find recons hcal cluster type
   
   
     AUTHOR   : A. BONISSENT  870615
   
     ICLUH  = Hcal cluster number
     IREHC = type :
                1 : neutral
                2 : charged, mip
                3 : charged, nomip
   
     BANKS :
       INPUT   : HCLU,HTDT
       OUTPUT  : NONE
       CREATED : NONE
   
   
   
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   CVRIFY                                                                          
        |---- CRHCLU                                                               
                   |----  CTRMIP                                                   
   
 
3 CTHCLU
         SUBROUTINE CTHCLU(ICLUH,ITRHC,IER)
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   
   Find true hcal cluster type
   
   
     AUTHOR   : A. BONISSENT  870615
   
     ICLUH  = Hcal cluster number
     ITRHC = type :
                1 : neutral
                2 : charged, mip
                3 : charged, nomip
      IER = return code 0 : normal
   
     BANKS :
       INPUT   : HCLU,HTDT
       OUTPUT  : NONE
       CREATED : NONE
   
   
   
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   CVRIFY                                                                          
        |---- CTHCLU                                                               
                   |----  NLINK                               External             
                   |----  CTKCHG                                                   
                   |----  CCTRMI                                                   
                   |----  RERROR                                                   
   
 
3 CTKCHG
         SUBROUTINE CTKCHG(ITRK,ITRKL,ICHG,IER)
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   
   Find charge of primary particle connected with track itrk
   
   
     AUTHOR   : A. BONISSENT  870615
   
     Itrk  = Track number in geant (primary or secondary)
     Itrkl = Track number of the primary track
     Ichg  = charge of the primary
     IER  = return code  0 : normal
   
     BANKS :
       INPUT   : KINE,VERT,PART
       OUTPUT  : NONE
       CREATED : NONE
   
   
   
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   CTHCLU                                                                          
        |---- CTKCHG                                                               
                   |----  NLINK                               External             
                   |----  ESLCT                                                    
                   |----  RERROR                                                   
   
 
3 CTRMIP
         SUBROUTINE CTRMIP(ITR,IFMIP)
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   
   Find if track is mip particle    (recons)
   
     AUTHOR   : A. BONISSENT  870505
   
   
     BANKS :
       INPUT   : ecob,etck
       OUTPUT  : NONE
       CREATED : NONE
   
          Say that track is MIP
            get ecob associated with track itr
      loop :  on hypetheses for this ecob
            if hypothesis is mip then
                   track is mip; exit
                endif
            endif
       endloop
            if all hypotheses have been scanned, and mip was not found,
            track is not MIP
   
   
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   CASHET                                                                          
   CRHCLU                                                                          
        |---- CTRMIP.                                                              
   
 
3 CTRPAR
         SUBROUTINE CTRPAR(ITR,RBARY,ETRL)
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   
   Find the expected contribution of the track to the calobject
   
     AUTHOR   : A. BONISSENT  901206
   
   
     BANKS :
       INPUT   : NONE
       OUTPUT  : NONE
       CREATED : NONE
   
     MODIFICATIONS :
           A. BONISSENT, P. COMAS (29-SEP-1994)
              Avoid division by zero: no need to step in the helix if
              STEP = 0
   
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   CRCPAR                                                                          
        |---- CTRPAR                                                               
                   |----  NAMIND                              External             
                   |----  UFITQL                              External             
                   |----  EINITK                                                   
                   |----  SQRT                                External             
                   |----  EINHLX                                                   
                   |----  EHLIX                                                    
   
 
3 CTRTOC
         SUBROUTINE CTRTOC(ITR,IECO,NECO,ICLUH,NCLUH,MXCLU,IER)
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   
   Go from trk to ecob & hclu
   
     AUTHOR   : A. BONISSENT  870831
   
   
     BANKS :
       INPUT   : KINE,VERT
       OUTPUT  : NONE
       CREATED : NONE
   
      Itr     : track number
      IECO    : Table of EcObs
      NECO    : Number of Ecobs
      ICLUH   : Table of HCLUS
      NCLUH   : Number of HCLUS
   
   
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   CFPASS                                                                          
        |---- CTRTOC                                                               
                   |----  NLINK                               External             
                   |----  CEGCLU                                                   
                   |----  CHGCLU                                                   
   
 
3 CVRIFY
         SUBROUTINE CVRIFY
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   
   Verify hcal-tpc association
   
   
     AUTHOR   : A. BONISSENT  870615
   
     BANKS :
       INPUT   : XRL3
       OUTPUT  : XRL3
       CREATED : NONE
   
   
   
   
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   ECHCGL                                                                          
        |---- CVRIFY                                                               
                   |----  CTHCLU                                                   
                   |----  CRHCLU                                                   
                   |----  HFILL                               External             
   

2 E_

  >>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>
    CKEY 
     1st entry in E_set
     * corr file 310.1
        EFIXI99: Drop run header bank EDDB at start of 1999 (M.-N.Minard)
    
     ! JULIA 310
        EFOLMK,ESVETO : Increase energy cut to 250 GeV  (M.-N.Minard)
    
     * corr file 308.02
        EPRTPC : Protect against divide by zero (M.Cattaneo)
    
     ! JULIA 307
        ECSW94 : EXIT JULIA if EAGC cards are missing when required
                 (1994 raw data, run range 25000-25893)                (M.Cattaneo)
    
     * corr file 305.02
        ECLAMP : Rescale cut to effective threshold. Affects MC only (M.N.Minard)
        ECMOD  : Bug fix for overlap region (G.Taylor)
    
     ! JULIA 305
        EINIRU : Remove 'Temporary' (since before 1993!) call to EFIX  (M.Cattaneo)
        EFIX   : DELETED from library (was supposed to be temporary fix pending
                 Alephlib fix, and did not have intended effect)       (M.Cattaneo)
        ETHRES : Rename 'LOCAL' common for work bank indices to 
                 something more unique (CMETHR)                        (M.Cattaneo)
        E4BARY,E4FDIJ,EFIJOB : fix variable type inconsistencies in 
                               function calls, for Linux               (A.Waananen)
    
     * corr file 304.01
        EBOXHI : Remove CALL from function references, for Linux. (A.Waananen)
    
     * corr file 303.06
        EPRTPC : Comment call to UFITQL (results are never used!!) (M.Cattaneo)
    
     ! JULIA 302 (Tracking upgrade)
        EPRTPC : Extrapolate to ECAL from outermost TPC coordinate. (D.Casper)
                 Do not extrapolate incoming tracks of kink.
                 Can be disabled with ENKF card.
    
     * corr file 283.01
       ECCLUS : Change level of error 1 from Fatal to Warning
    
     ! JULIA 282
       EGETDS : Replace LENOCC by LNBLNK (M.Cattaneo, July 1996)
    
     * corr file 280.01
       E4FNEC : protect against divide by A(1)=0.   (D.Pallin, Mar 96)
       ECGFLW : protect against bad MonteCarlo data (M.Cattaneo, Mar 96)
       EPADCL : protect against bad MonteCarlo data (M.Cattaneo, Mar 96)
    
     ! JULIA 280
    
       EIDEDX : call TPDHYP('WIRE', instead of TIDHYP. (FLR)
       ECSW94,ECBOOK,ELECID : opening "'" should have a closing "'" within
               the same line for cvs (F. Ranjard, Feb 96)
     ! JULIA 279
    
     * corr file 278.1
       ECSW1093 : move DATA statement just before BMACRO to allow
                 compilation in Linox (P. Comas, Oct 95)
     ! JULIA 278
    
     * corr file 277.3
       ECFIBT : PWEI bank corrected for calibration and change fatal
               error by warning error when EWDI does not exist
               (M.N.Minard, Aug 95)
       ECFILS : change fatal error by warning error when EWDI does not
               exist (M.N.Minard, Aug 95)
       ECHEDC : bug fix when applying calibration (M.N. Minard, Aug 95)
     ! JULIA 277
     * corr file 276.4
       EDWIJJ,PWEIJJ : new common decks added (M.N. Minard, May 95)
       EWDIFP : addapt to bunch trains and use of PWEI
                      (M.N. Minard, Apr 95)
       ECERAS,CPADWR : use of PWEI (M.N. Minard, Apr 95)
       ECFILS : check the Pastis configuration - 1995 and call ECFIBT
               (M.N. Minard, Apr 95)
       EPADCL,EWIRCL,ETDIFP,ECHEDC,ECHICA : addapt to bunch trains
                                    (M.N. Minard, Apr 95)
       ECFIBT : new routine for wires banks analysis in bunch trains
               (M.N. Minard, Apr 95)
     ! JULIA 276
       EFIXI94: artificially built EKLS bank of zero length to put to
               zero the number of killed channels (M.N.Minard, Apr 1994)
    
     * corr file 275.4
       ECCLUS : ESDA internal storey bank used in clusterisation is dropped
               when cluster bank is dropped (M.N. Minard, Feb 1995)
     ! JULIA 275
       EAGCJJ : new common deck added (M.N. Minard, Oct 1994)
       EGETDS : for 94 running drop EKLS EKPL wrong on the header (same)
       EPREDA : in case of raw data from run range 1994 (<25854)
               swap gain map of endcap A (same)
       EFIXI94: new subroutine to drop EKLS EKPL banks (same)
       ECSW94 : new subroutine to swap gain for ETDI, active only on 1994
               raw data run<25894 (same)
     ! JULIA 274
     * corr file 273.1
       EQRUNQ : changes due to new ECAL banks (May 1994)
       EFERRR : changes due to new ECAL banks (May 1994)
       EPREDA : changes due to new ECAL banks (May 1994)
       EAUTOP : new subroutine to decode banks EHWI and EHPA and
               summarize (condense) into arrays NAUTO and NAUTOW
       ECXMOD : (new) decode the EHPA data word and convert into a module
               number
     ! JULIA 273
     ! JULIA 272
     * corr file 271.8
       ERCUPI : initialize ICOR=0 which means returns from ERCUPR
                without correcting ETDI energies.
       ERCUPR : returns immediately when ICOR=0
       ESWPST : returns immediately if MC data
     * corr file 271.7
       ECSW1093 : new routine to fix ETDI swapping in end-cap for runs
                  22793-22880.
       EPREDA   : call ECSW1093.
     * corr file 271.6
       ECTRAP : protection against invalid storey address.
     * corr file 271.5
       ECLONGI : new stuff.
  <<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<
     E1BPEI     Fill peid words in one byte
     E2BPEI     Fill peid words in two bytes
     E3BPEI     Fill peid words in one byte
     E4BARY     Job for r2 estimator calculation
     E4COSZ     Routine to calculate zero suppression for e-id
     E4DEAD     Look if there is dead storeys in the 2x2 storeys used in electron
     E4DEIJ     R2 estimator : give i jk of 3x4 storeys
     E4FDIJ     R2 estimator give i j k for 3x4 storeys centered on track extrapol
     E4FIDE     Fill   e4de bank
     E4FIND     R2 estimator calculation : give 3x4 centered storeys
     E4FNEC     R2 estimator : stop extrapolation for endcaps
     E4FRAC     R2 estimator give stack number k in reel relative to first or last
     E4GTBR     R2 estimator : stop extrapolation at barrel corners
     E4GTPL     R2 estimator : give equation of plans of module imo of subcomp. is
     E4GTSO     Electron identification : get storeys geometrical parameters
     E4GTST     R2 estimator : fill e4pal common of 3x4 storeys
     E4GTTW     R2 estimator : get towers (i1 j1) (i1 j2) (i2 j1) (i2 j2)
     E4INDI     R2 estimator : reorder i j indices of 2 storeys
     E4LEA1     Modified version of routine ecleak  (for electron id)
     E4OVRL     Calculate energy correction in overlap
     E4PAL      R2 estimator :  calculate energy correction in overlap
     E4R1R2     R2 estimator give ijk for storeys in r1 r2 overlaping region of en
     E4R2R3     R2 estimator give ijk for storeys in r2 r3 overlaping region of en
     E4R3R4     R2 estimator give ijk for storeys in r3 r4 overlaping region of en
     E4RADC     Angle entre ligne de vol "photon" et drte extraplolee
     E4RES2     R2 estimator : give intersection of plan with extrapolated track
     E4RES3     R2 estimator : give intersection of plan with extrapolated track
     E4TSTL     R2 estimator : check if extrapolation out of ecal
     E4XYZ0     R2 estimator : give x y z extrapolation on the first plane of ecal
     EAUTOP     Decode banks ehwi and ehpa and summarize (condense) into
     EBEGID     Built photon bank egid
     EBOXKI     Kill ecal box
     ECALIG     Steering routine to select candidates clusters for alignement purp
     ECBLDA     Give value to ecal constants
     ECBOBA     Book gammas ecal histograms
     ECBOOK     Book ecal histograms
     ECCAOB     Create charged em calorimeter object
     ECCHKB     Check if any bad  channel was considered among esda bank
     ECCLCO     Close ecobject banks
     ECCLUS     Perform topological association of connected ec_storeys in 2 dimensi
     ECDAMP     Compute amplificator number
     ECDEBG     Print bos bank contents after processing
     ECDETE     Determinant calculation
     ECDIGI     Find storey where point is
     ECENER     Energy per stack in the 2x2 storeys close to the charged track
     ECERAS     Erase ecal e-flow pot bank when reprocessing is done from pot
     ECFCLU     Find assigned clusters (ie clusters + tracks association )
     ECFIBT     Wires banks analysis
     ECFILS     Wires banks analysis
     ECFMIP     Routine to tag cluster created by minimum ionising particle
     ECFOBJ     Steering routine to analyze reconstructed clusters
     ECGFLW     Correction for energy dependance due to gaz flow
     ECGMIX     Search for embedded gammas in charged eclusters
     ECHARG     Check if a cluster is 'charged'
     ECHCGL     Perform ec hc global analysis
     ECHEDC     Create eche bank to transmit calibration used to pot
     ECHIBA     Fill gammas ecal histograms
     ECHIST     Fills ecal histograms
     ECHTAG     Tags track quality
     ECINIT     Transform storey encoding for clustrization
     ECINRV     Definition of  "rose des vents" irosev   ***  (28/9/84)
     ECLAMP     Clean ecal looking to amplificator noise
     ECLANA     Routine for electron identification build eiga bank and fill eidt
     ECLEIB     Close eidt bank
     ECLGEO     Geometrical stacks parameters.
     ECLOPE     Computes the the angle between charged track and inner face
     ECLORL     Close trk-cluster relation
     ECLOST     Compute correction to total ecobject energy
     ECLTAG     Tags neutral clusters to remove fake ones
     ECLTRK     Associate clusters to tracks
     ECLTYP     Books and fills bank to set cluster type
     ECLUAR     Create eclu and fill iarray(6144) with hit towers
     ECMESP     Merge/split topological clusters
     ECMOD      Determine ecal module number for a give row and column
     ECMOPL     Correct the ecal thickness by incoming angle(barrel or endcap
     ECNCOB     Fill neutral ecobject banks
     ECOBNK     Create ecobject banks
     ECOENT     Compute correction to total ecobject energy
     ECOIDP     Initialize identification parameter and
     ECOS       Given a storey energy in ecal, it creates the corresponding
     ECPAD      Reads the ecalpadgaincorrection file in sequential mode
     ECPASR     Showers parameters initialisation.
     ECPLM      Ecal correction for wrong plane killed
     ECPRIN     Fill ecpric common to gather ecal statistics
     ECPRLO     Computes the beta/alpha and 1/alpha parameters of the em shower
     ECRCOB     Fill ecobject banks
     ECRE4D     Create e4de bank
     ECREIB     Create eidt bank
     ECRMIP     Look for minimum ionizing particle
     ECRNDX     Create ec name indices      for banks
     ECRPEI     Create and fill peid bk
     ECRTR      Calculates storeys crossed by extrapolated track
     ECRUNQ     Storey cleaning and autopeds info to pot
     ECSCMD     Determine ecal module number for a give row and column
     ECST       Steering for mask analysis
     ECSUPP     Flag 'noisy' ecal clusters
     ECSW1093   Fix etdi swapping in end-cap for runs 22793 - 22880
     ECSW94     Swap gain for etdi
     ECTEMP     Creates temporary banks ecte and hcte where the
     ECTHRE     Set global threshold on cluster energy
     ECTOPO     Looks for the ecal region where is the charged cluster
     ECTPC      Create tpc tracks
     ECTRAP     Extrapolates tracks in ecal
     ECTREA     Choose to use track or cluster in electron case
     ECXMOD     Decode the ehpa data word and convert into a module number
     EDISAL     Compute distance for alignement (sum,x,y,z) in ecal
     EDLIST     Check same storey not twice in dead list
     EFAXE      For the different fits calculates the total energy
     EFBOOK     Booking of histograms for mask analysis
     EFERRR     Filter errr bank from on-line
     EFICLP     To compute cluster parameters as defined in 'eclu'
     EFICV      Find creation vertex
     EFIECP     Computes the position of sensitive planes hit (in x0 unit)
     EFIEIB     Fill eidt bank
     EFIJOB     Initialize  energyflow  job
     EFIXI94    Drop run header ekls ekpl bank
     EFLCST     Get e-fow constants from d-base
     EFOLMK     Built efol bank for e-flow results
     EFPARD     Read parameters for t0 calculaton from bos cards or data base
     EFTIEL     Search electron identified corresponding to cluster
     EGACST     Initialisation banks used in photon estimator normalisation
     EGAEST     Built photon normalised estimator bank
     EGETDS     Get dead storey information from the dbase   (eddb bank)
     EGFCST     Get correction constant for gas flow, read ecgf bank
     EGTTKS     Get access to tracks
     EHCFLO     Give weight to pad energy for energy flow
     EHLIX      Get next point on helix
     EHREG      To create weighted p-vectors for energy-flow calculation
     EIDEDX     Get r5 estimator for electron identification
     EIDENT     Main routine  for electron identification
     EIEFFL     Job for  estimators calculation
     EINHLX     Initialize helix parameters
     EINIJO     Initialisation of ecal job
     EINIRL     Initialize etp rel banks
     EINIRU     Initialise run for ecal
     EINITK     Init. trk
     EINSRL     Inserts a trk-clus relation
     EIPARD     Read parameters for electron-id from bos cards or data base
     EITHR      Return on-line roc threshold in kev for tower iteta,iphi,istack
     EKNEWB     Kill ecal  barrel box
     EKNEWE     Kill ecal  endcap box
     ELECID     Steering routine for electron identification
     ELONGI     Steering routine to compute the r3 and r4 electron identificators
     EMFILL     Fills emsk bank with minimum ionizing particle
     EMSKEI     Event initialization
     EMSKEV     Steering routine for mask analysis
     EMSKF      Updates content of emsk bank with new energy in mask
     EMSKI      Initializes parameters used in mask algorithm
     EMSKJI     Job initialization
     EMSKMU     Calculates expected energy lost by muons in ecal and hcal
     ENFMSK     Fills name common ecnmsk
     ENIGHB     Find clusters near a storey
     ENOISE     Monitor subroutine to identify noisy or shifted channels
     ENPROX     Determines whether cluster is in road
     ENSTAT     Returns noise status of tower address iad
     EPADCL     Cleans etdi bank using information from background lcal triggers
     EPATRN     Give ecal pattern for frid bank
     EPCALO     Propagate tracks to ecal      entry
     EPCHG      Propagate charged tracks
     EPNEU      Propagete neutral tracks
     EPREDA     Prepare ecal data
     EPROBA     Give electron hypothesis from ecal analysis
     EPRSTO     Create bank esto
     EPRSUM     Print ecal summary statistics
     EPRTPC     Prepare tpc trks for ecal extrap.
     ERCUPI     Initialisation for bug fix on storeys gains corrected for missing wire
     ERCUPR     Correct etdi  energies for bug in gains related to missing wires
     ERESET     Reset  array of storeys
     EROAD      Calculates energy inside road in ecal
     ESCDEF     Ecal small defect correction
     ESCOUN     Count number of nonzero ecal storeys in esda
     ESFIL      Calculate energy from ecal wire
     ESLAS      Select tracks for ecobject association
     ESLCT      Select tracks
     ESLCTF     Select tracks
     ESLOWC     Handle slow control for ecal
     ESTAG      Gives number of tracks related to cluster
     ESVETO     Veto spark event for e-flow
     ESWPST     Correct etdi  energies fors swapped stack cables in barrel mod 6
     ETDIFP     Recalculate uncorrected raw energy etdi ewhe
     ETHRES     Cleans etdi,ewdi banks if module energy from wires is below threshold
     ETRDEV     Test transverse shower developpement
     EWDIFP     Built ewdi from pot
     EWIRCL     Cleans ewdi using info on known bugs and apply absolute calibration
     EX3IJK     If point x in ecal gets iph,jth,st..

3 E1BPEI
         SUBROUTINE E1BPEI(ENT,ISO)
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Fill peid words in one byte
   
     AUTHOR   : D. PALLIN
     MODIFIED :
   
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   ECRPEI                                                                          
        |---- E1BPEI                                                               
                   |----  NINT                                External             
                   |----  IABS                                External             
   
 
3 E2BPEI
         SUBROUTINE E2BPEI(ENT,ISO)
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Fill peid words in two bytes
   
     AUTHOR   : D. PALLIN
     MODIFIED :
   
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   ECRPEI                                                                          
        |---- E2BPEI                                                               
                   |----  NINT                                External             
   
 
3 E3BPEI
         SUBROUTINE E3BPEI(ENT,ISO)
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Fill peid words in one byte
   
     AUTHOR   : D. PALLIN
     MODIFIED :
   
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   ECRPEI                                                                          
        |---- E3BPEI                                                               
                   |----  NINT                                External             
   
 
3 E4BARY
         SUBROUTINE E4BARY
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Job for r2 estimator calculation
   
       AUTHOR  : D. PALLIN
       MODIFIED:
   
         GIVE 3X4 STOREYS CENTERED ON CLUSTER BARYCENTER
   
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   E4PAL                                                                           
        |---- E4BARY                                                               
                   |----  SIN                                 External             
                   |----  COS                                 External             
                   |----  EFNCRS                              External             
                   |----  E4DEIJ                                                   
                   |----  E4GTTW                                                   
   
 
3 E4COSZ
         SUBROUTINE E4COSZ(E4CLU,P4,TETIFL,XE4100,CORZ)
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Routine to calculate zero suppression for e-id
                                   Author : M.N Minard
                                   Date   : 22/10/91
       E4CLU     Input : Energy in 4 central tower
       TETIFL    Input : Theta index of cluster
       XE4100    Output: Expected fraction in 4 tower
       CORZ      Output: Correction fator for zer suppression
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   EIDENT                                                                          
        |---- E4COSZ                                                               
                   |----  NAMIND                              External             
                   |----  ABRUEV                              External             
                   |----  GTSTUP                              External             
                   |----  ALGTDB                              External             
                   |----  JUNIDB                              External             
                   |----  UCOPY                               External             
   
 
3 E4DEAD
         SUBROUTINE E4DEAD(JTRAK,ICOL1,ICOL2,JROW1,JROW2,KSTAK)
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Look if there is dead storeys in the 2x2 storeys used in electron
   
     AUTHOR : D. PALLIN
   
     JTRAK : INDEX OF TRACK IN FRFT BANK
     ICOL, JROW : TETA AND PHI FOR SELECTED STOREYS
     KSTAK : STACK OF SELECTED STOREYS
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   E4GTST                                                                          
        |---- E4DEAD                                                               
                   |----  NAMIND                              External             
   
 
3 E4DEIJ
         SUBROUTINE E4DEIJ(IFLAG,IBAR,COLI,ROWJ)
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   R2 estimator : give i jk of 3x4 storeys
   
       AUTHOR  : D. PALLIN
       MODIFIED:
   
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   E4BARY                                                                          
   E4FDIJ                                                                          
        |---- E4DEIJ                                                               
                   |----  E4INDI                                                   
                   |----  E4R3R4                                                   
                   |----  E4R2R3                                                   
   
 
3 E4FDIJ
         SUBROUTINE E4FDIJ
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   R2 estimator give i j k for 3x4 storeys centered on track extrapol
   
       AUTHOR  : D. PALLIN
       MODIFIED:
   
   
   
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   E4FIND                                                                          
        |---- E4FDIJ                                                               
                   |----  NTOW                                External             
                   |----  XTOW                                External             
                   |----  EFNCRS                              External             
                   |----  INT                                 External             
                   |----  E4DEIJ                                                   
                   |----  E4GTST                                                   
   
 
3 E4FIDE
         SUBROUTINE E4FIDE
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Fill   e4de bank
   
       AUTHOR  : D. PALLIN
       MODIFIED:
   
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   E4PAL                                                                           
        |---- E4FIDE                                                               
                   |----  NAMIND                              External             
   
 
3 E4FIND
         SUBROUTINE E4FIND(IERR)
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   R2 estimator calculation : give 3x4 centered storeys
   
       AUTHOR  : D. PALLIN
       MODIFIED:
   
   
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   E4PAL                                                                           
        |---- E4FIND                                                               
                   |----  VZERO                               External             
                   |----  E4XYZ0                                                   
                   |----  RERROR                                                   
                   |----  EFNDSC                              External             
                   |----  EFNDMD                              External             
                   |----  FLOAT                               External             
                   |----  FRACST                                                   
                   |----  E4GTPL                                                   
                   |----  E4GTBR                                                   
                   |----  E4RES3                                                   
                   |----  E4TSTL                                                   
                   |----  E4FNEC                                                   
                   |----  E4FDIJ                                                   
   
 
3 E4FNEC
         SUBROUTINE E4FNEC
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   R2 estimator : stop extrapolation for endcaps
   
       AUTHOR  : D. PALLIN
       MODIFIED:
   
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   E4FIND                                                                          
        |---- E4FNEC                                                               
                   |----  SQRT                                External             
                   |----  A                                   External             
                   |----  XTOW                                External             
                   |----  ABS                                 External             
   
 
3 E4FRAC
         FUNCTION FRACST(K,I)
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   R2 estimator give stack number k in reel relative to first or last
   
       AUTHOR  : D. PALLIN
       MODIFIED:
   
   
 
3 E4GTBR
         SUBROUTINE E4GTBR(A3,B3,C3,D3)
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   R2 estimator : stop extrapolation at barrel corners
   
       AUTHOR  : D. PALLIN
       MODIFIED:
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   E4FIND                                                                          
        |---- E4GTBR.                                                              
   
 
3 E4GTPL
         SUBROUTINE E4GTPL(A3,B3,C3,D3,ISUB,IMO,STA)
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   R2 estimator : give equation of plans of module imo of subcomp. is
   
       AUTHOR  : D. PALLIN
       MODIFIED:
         this routine will be modified soon
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   E4FIND                                                                          
        |---- E4GTPL                                                               
                   |----  FLOAT                               External             
                   |----  ESRPT                               External             
                   |----  E4RES2                                                   
   
 
3 E4GTSO
         SUBROUTINE E4GTSO(ISTO,RESTIX,RESTIY,RESTIZ)
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Electron identification : get storeys geometrical parameters
   
       AUTHOR  : D. PALLIN
       MODIFIED:
   
         ISTO :ROW NUMBER OF THE STOREY IN BK ESDA
         REXCO REYCO REZCO X YZ CORNER VALUES
         RESTIX RESTIY RESTIZ XYZ FACES CENTER
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   E4GTST                                                                          
        |---- E4GTSO                                                               
                   |----  ESRCR                               External             
                   |----  CF                                  External             
   
 
3 E4GTST
         SUBROUTINE E4GTST(ICOL1,ICOL2,JROW1,JROW2,KSTAK)
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   R2 estimator : fill e4pal common of 3x4 storeys
   
       AUTHOR  : D. PALLIN
       MODIFIED:
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   E4FDIJ                                                                          
   E4GTTW                                                                          
        |---- E4GTST                                                               
                   |----  E4DEAD                                                   
                   |----  E4GTSO                                                   
   
 
3 E4GTTW
         SUBROUTINE E4GTTW(I1,I2,J1,J2)
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   R2 estimator : get towers (i1 j1) (i1 j2) (i2 j1) (i2 j2)
   
       AUTHOR  : D. PALLIN
       MODIFIED:
   
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   E4BARY                                                                          
        |---- E4GTTW                                                               
                   |----  E4GTST                                                   
   
 
3 E4INDI
         SUBROUTINE E4INDI(R,J1,J2)
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   R2 estimator : reorder i j indices of 2 storeys
   
       AUTHOR  : D. PALLIN
       MODIFIED:
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   E4DEIJ                                                                          
        |---- E4INDI                                                               
                   |----  INT                                 External             
   
 
3 E4LEA1
         SUBROUTINE E4LEA1(NUST,INDX,ESTO,ITVLP,EVLP,IVLP,COEFF)
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Modified version of routine ecleak  (for electron id)
      AUTHOR   : D. PALLIN     07/07/90
   
    Overlap correction to the cluster energy.
   
      Input       NUST    NUMBER OF STOREYS OF THE CLUSTER ICLN.
                  INDX(1,IST) Theta index of the storey IST.
                  INDX(2,IST) Phi index of the storey IST.
                  INDX(3,IST) Stack number of the storey IST.
                  ESTO(IST)   Raw content of the storey IST.
                              IST = 1 , NUST
                  COEFF       Correction to overlap radiation length
                              due to charged track curvature
      Output    : EVLP    Estimated energy in the 5 theta overlap.
                  ITVLP   Teta index of storeys in the overlap.
                  IVLP    Number of storeys in the overlap.
   
      BANKS :
        INPUT   : EGVP
        OUTPUT  : NONE
   
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   E4OVRL                                                                          
        |---- E4LEA1                                                               
                   |----  VLP                                 External             
                   |----  NAMIND                              External             
                   |----  MOD                                 External             
                   |----  ABS                                 External             
   
 
3 E4OVRL
         SUBROUTINE E4OVRL(ICLE,IT,NTR,R3ES,R4ES,IOFL)
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Calculate energy correction in overlap
   
       AUTHOR  : D. PALLIN   07/07/90
       MODIFIED:
   
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
              E4OVRL                                                               
                   |----  E4CLU                               External             
                   |----  JSTO                                External             
                   |----  KSTO                                External             
                   |----  ESTO                                External             
                   |----  E4RADC                                                   
                   |----  E4LEA1                                                   
                   |----  XTOW                                External             
                   |----  SQRT                                External             
                   |----  ATAN2                               External             
                   |----  EBSLIM                              External             
                   |----  EFNCRS                              External             
                   |----  RADX                                External             
                   |----  LOG                                 External             
                   |----  INT                                 External             
                   |----  ECT                                 External             
                   |----  FLOAT                               External             
                   |----  VZERO                               External             
                   |----  ALOG                                External             
                   |----  PROLOT                                                   
   
 
3 E4PAL
         SUBROUTINE E4PAL(ICLE,ITRCE,NTR,IERR)
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   R2 estimator :  calculate energy correction in overlap
   
   
       AUTHOR  : D. PALLIN
       MODIFIED:
   
         GIVE 3X4 CENTERED STOREYS OF CLUSTER ICLE ,OF TRACK ITRTE
         REFERED AS NUMBER ITRCE IN CLUSTER ASSOCIATION
        IERR=0 OK
        IER=-1 AUHCYL CANT DO EXTRAPOLATION
        IER=-2 E4XYZ0 CANT DO EXTRAPOLATION
        IER=-3 E4XYZ0 CANT DO EXTRAPOLATION
        IER=1  SELECTION OF STOREYS FAILED IN THE OVERLAP
        IER=2  SELECTION OF STOREYS WITH CLUSTER BARYCENTER
        IER=3  NO STOREYS SELECTED
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   EIDENT                                                                          
        |---- E4PAL                                                                
                   |----  VZERO                               External             
                   |----  E4BARY                                                   
                   |----  E4FIND                                                   
                   |----  E4FIDE                                                   
   
 
3 E4R1R2
         SUBROUTINE E4R1R2(ROWJ,COLI,JROW1,JROW3,JROW4,ICOL1,ICOL2,
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
        &ICOL3,ICOL4,IFLAG)
   R2 estimator give ijk for storeys in r1 r2 overlaping region of en
   
       AUTHOR  : D. PALLIN
       MODIFIED:
   
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
              E4R1R2                                                               
                   |----  INT                                 External             
                   |----  MOD                                 External             
                   |----  FLOAT                               External             
   
 
3 E4R2R3
         SUBROUTINE E4R2R3(ROWJ,COLI,JROW3,JROW4,ICOL1,ICOL2,ICOL3
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
        &,ICOL4)
   R2 estimator give ijk for storeys in r2 r3 overlaping region of en
   
       AUTHOR  : D. PALLIN
       MODIFIED:
   
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   E4DEIJ                                                                          
        |---- E4R2R3                                                               
                   |----  INT                                 External             
   
 
3 E4R3R4
         SUBROUTINE E4R3R4(ROWJ,COLI,JROW3,JROW4,ICOL1,ICOL2,ICOL3
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
        &,ICOL4)
   R2 estimator give ijk for storeys in r3 r4 overlaping region of en
   
       AUTHOR  : D. PALLIN
       MODIFIED:
   
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   E4DEIJ                                                                          
        |---- E4R3R4                                                               
                   |----  INT                                 External             
   
 
3 E4RADC
         SUBROUTINE E4RADC(COEFF)
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Angle entre ligne de vol "photon" et drte extraplolee
      Author   :- E. PALLIN
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   E4OVRL                                                                          
        |---- E4RADC                                                               
                   |----  XTOW                                External             
                   |----  SQRT                                External             
                   |----  DROITE                              External             
   
 
3 E4RES2
         SUBROUTINE E4RES2(XX,YY,A,B,C,IERROR)
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   R2 estimator : give intersection of plan with extrapolated track
         JOB FOR R2 ESTIMATOR CALCULATION
   
       AUTHOR  : D. PALLIN
       MODIFIED:
   
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   E4GTPL                                                                          
        |---- E4RES2.                                                              
   
 
3 E4RES3
         SUBROUTINE E4RES3(A,B,C,D,X,Y,Z,IERROR)
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   R2 estimator : give intersection of plan with extrapolated track
   
       AUTHOR  : D. PALLIN
       MODIFIED:
   
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   E4FIND                                                                          
        |---- E4RES3                                                               
                   |----  ECDETE                                                   
   
 
3 E4TSTL
         SUBROUTINE E4TSTL(IGOT)
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   R2 estimator : check if extrapolation out of ecal
   
       AUTHOR  : D. PALLIN
       MODIFIED:
   
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   E4FIND                                                                          
        |---- E4TSTL                                                               
                   |----  EFNDSC                              External             
                   |----  EFNDMD                              External             
                   |----  ABS                                 External             
                   |----  MOD                                 External             
                   |----  FLOAT                               External             
                   |----  FRACST                                                   
   
 
3 E4XYZ0
         SUBROUTINE E4XYZ0(PAREX,IERR)
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   R2 estimator : give x y z extrapolation on the first plane of ecal
   
       AUTHOR  : D. PALLIN
       MODIFIED:
   
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   E4FIND                                                                          
        |---- E4XYZ0                                                               
                   |----  AUHCYL                              External             
                   |----  EFNCRS                              External             
                   |----  ESRPT                               External             
                   |----  ABS                                 External             
                   |----  SQRT                                External             
                   |----  RERROR                                                   
   
 
3 EAUTOP
         SUBROUTINE EAUTOP ( NAUTO , NAUTOW )
  ------------------------------------------------------------------------------
    CKEY E_SET EHWI EHPA RUNQ
  ------------------------------------------------------------------------------
   Decode banks ehwi and ehpa and summarize (condense) into
       arrays NAUTO and NAUTOW. These arrays are subsequently packed
       into bank ECRQ with the routine ECRUNQ.
   
        Lee F. Thompson. 29th April 1994.
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   EPREDA                                                                          
        |---- EAUTOP                                                               
                   |----  NAMIND                              External             
                   |----  ECXMOD                                                   
                   |----  RERROR                                                   
                   |----  IBITS                               External             
   
 
3 EBEGID
         SUBROUTINE EBEGID
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Built photon bank egid
   
      Author  : J.Badier                    14/07/90
      Modified: C.Goy                       18/12/90
                 Call Bulos
      Modified :- E. Lancon              4-MAR-1991
                 Modify region flag definition
      Modified :- E. Lancon             15-MAY-1991
                 Make it works with both ECLU and PECO
   
      Bank created  EGID
      Banks used ECLU ECT1 ERL3
      Call to EBNEUT  CLMOMS (ALEPHLIB)
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
              EBEGID                                                               
                   |----  NDROP                               External             
                   |----  NAMIND                              External             
                   |----  AUBOS                               External             
                   |----  EBNEUT                              External             
                   |----  CLMOMS                              External             
                   |----  EBHAHA                              External             
                   |----  EBGAGA                              External             
                   |----  AUBPRS                              External             
   
 
3 EBOXKI
         SUBROUTINE EBOXKI
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Kill ecal box
   
                    Author M.N Minard
                           5/06/90
        Bank created EDKB
        Bank used EBOK
        Called from EGETDS
        Calls to EKNEWB , EKNEWE
        Reference ALGTDB
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   EGETDS                                                                          
        |---- EBOXKI                                                               
                   |----  NDROP                               External             
                   |----  NAMIND                              External             
                   |----  ALGTDB                              External             
                   |----  EKNEWB                                                   
                   |----  EKNEWE                                                   
   
 
3 ECALIG
         SUBROUTINE ECALIG
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Steering routine to select candidates clusters for alignement purp
   
     AUTHOR   : J.P. ALBANESE
   
     BANKS :
       INPUT   : ECLU
       CREATED : NONE
   
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   ECFOBJ                                                                          
        |---- ECALIG                                                               
                   |----  EDISAL                                                   
   
 
3 ECBLDA
         SUBROUTINE ECBLDA
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Give value to ecal constants
   
     AUTHOR   : A. BONISSENT  860615
     MODIFIED : A. BONISSENT  861108
   
     BANKS :
       INPUT   : NONE
       OUTPUT  : NONE
       CREATED : NONE
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   EINIRU                                                                          
        |---- ECBLDA                                                               
                   |----  ALGTDB                              External             
                   |----  NAMIND                              External             
                   |----  VZERO                               External             
                   |----  RERROR                                                   
   
 
3 ECBOBA
         SUBROUTINE ECBOBA
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Book gammas ecal histograms
   
      Called if histogramm flag = 4
      Histo. number 4400 to 4499
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   ECBOOK                                                                          
        |---- ECBOBA                                                               
                   |----  HBOOK1                              External             
                   |----  HBOOK2                              External             
                   |----  HBPRO                               External             
   
 
3 ECBOOK
         SUBROUTINE ECBOOK
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Book ecal histograms
      Book hitograms to verify
         the behaviour of ecal recons
   
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   RBKHIS                                                                          
        |---- ECBOOK                                                               
                   |----  HBOOK2                              External             
                   |----  HBOOK1                              External             
                   |----  JHISRF                              External             
                   |----  ECBOBA                                                   
   
 
3 ECCAOB
         SUBROUTINE ECCAOB (ICL,IER)
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Create charged em calorimeter object
   
   
     AUTHOR   : J.P. ALBANESE
     MODIFIED : F. ETIENNE      87/08/27
   
     BANKS :
       INPUT   : ECLU,ECT1,ERL3,ETP1
       OUTPUT  : NONE
       CREATED : NONE
   
     OUTPUT:
            IER = 0 O.K.
                  1 PROBLEM WITH ECOB CREATION
   
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   ECFOBJ                                                                          
        |---- ECCAOB                                                               
                   |----  ECOIDP                                                   
                   |----  ECRCOB                                                   
                   |----  ECOENT                                                   
   
 
3 ECCHKB
         SUBROUTINE ECCHKB
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   
   Check if any bad  channel was considered among esda bank
   
     AUTHOR  :  C. BENCHOUK 890529
     MODIFIED:
   
     BANKS:
       INPUT  : ESDA,ESDB
       OUTPUT : NONE
       CREATED: NONE
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   ECCLUS                                                                          
        |---- ECCHKB                                                               
                   |----  NLINK                               External             
   
 
3 ECCLCO
         SUBROUTINE ECCLCO
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   
   Close ecobject banks
   
     Adjust the size of each bank to the data which it contains
   
     AUTHOR   : A. BONISSENT  870819
   
     BANKS :
       INPUT   : ECOB,EBOS,EHYP,EPAR
       OUTPUT  : ECOB,EBOS,EHYP,EPAR
       CREATED : NONE
   
   
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
              ECCLCO                                                               
                   |----  AUBOS                               External             
   
 
3 ECCLUS
         SUBROUTINE ECCLUS(IER)
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   
   Perform topological association of connected ec_storeys in 2 dimensi
    INTO  AN ARRAY(IARRAY(6144)) SIMULATING THE ECCAL AND THRU INDIRECT
    TO FIND NEIGBHORING STOREYS (IROSEV(25000)).THE ENCODED ADDRESS (ADD)
    "IROSEV" (IROSE) ARE STORED IN THE ESDA  BANK (JESDIO ,JESDDI)
    THE ALGORITHM SIMULATE RECURSIVITY.
   
    CHECK FOR DEAD STOREYS WHICH ARE CONNECTED TO A CLUSTER AND
    RESCUE THEM.
   
     AUTHOR  :    JP ALBANESE APRIL_17TH_1986
     MODIFIED:    JP ALBANESE,A BONISSENT NOVEMBER_1986
     MODIFIED:    C. BENCHOUK 890529
        INPUT  :'ESDA','EDST','ECLU'
        OUPUT  :NONE
        CREATED:NONE
   
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   ECFCLU                                                                          
        |---- ECCLUS                                                               
                   |----  ECLUAR                                                   
                   |----  ECCHKB                                                   
                   |----  RERROR                                                   
                   |----  NDROP                               External             
                   |----  IDRRAY                              External             
                   |----  AUBOS                               External             
   
 
3 ECDAMP
         SUBROUTINE ECDAMP (ITOW,NAMP)
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Compute amplificator number
   
                          AUTHOR : M.N MINARD 25.11.90
   
       Input  ITOW : Tower number
       Output NAMP : amplificator number
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   ECLAMP                                                                          
        |---- ECDAMP                                                               
                   |----  IBITS                               External             
                   |----  MOD                                 External             
   
 
3 ECDEBG
         SUBROUTINE ECDEBG
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Print bos bank contents after processing
   
           INPUT ESDA,ECLU,ETP1,EFET,ECT1/2/3
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   ECFCLU                                                                          
        |---- ECDEBG                                                               
                   |----  NPRNT                               External             
   
 
3 ECDETE
         FUNCTION ECDETE(A,B,C)
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Determinant calculation
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   E4RES3                                                                          
        |---- ECDETE.                                                              
   
 
3 ECDIGI
         SUBROUTINE ECDIGI(XXX,IFLAG,ISTAD,IROSE)
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   
   Find storey where point is
   
   
     AUTHOR   : J.P. ALBANESE 860615
     MODIFIED : A. BONISSENT  861108
   
   
     BANKS :
       INPUT   : NONE
       OUTPUT  : NONE
       CREATED : NONE
   
       ECDIGI
       INPUT  : XXX(3): POSITION OF TRACK POINT
   
       OUTPUT : IFLAG :
                       2  IF IN ECAL
                       #2 IF OUT OF ECAL
                ISTAD
   
    -FIND GIVEN X,Y,Z IN ABSOLUTE COORDINATES,THE IJK STOREY_ADDRES
   
     TRANSFORM IT INTO ENCODED ADDRESS
            BY CALLING THE NORMAL ENCODING ROUTINE
   
   
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   ECLTRK                                                                          
   ECRTR                                                                           
        |---- ECDIGI                                                               
                   |----  EX3IJK                                                   
                   |----  RERROR                                                   
                   |----  ECINIT                                                   
   
 
3 ECENER
         SUBROUTINE ECENER(IT,ICLN)
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Energy per stack in the 2x2 storeys close to the charged track
   
     AUTHOR : A. FALVARD
     MODIFIED :
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   ELONGI                                                                          
        |---- ECENER                                                               
                   |----  VZERO                               External             
                   |----  NLINK                               External             
                   |----  KSTO                                External             
                   |----  ESTO                                External             
   
 
3 ECERAS
         SUBROUTINE ECERAS
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Erase ecal e-flow pot bank when reprocessing is done from pot
      Recalculate uncorrected raw energy ETDI EWHE
      Recreate EWDI bank
   
      Author  : M.N. Minard                 08/01/91
   
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   EPREDA                                                                          
        |---- ECERAS                                                               
                   |----  NAMIND                              External             
                   |----  LCSAVE                                                   
                   |----  BDROP                               External             
                   |----  EWDIFP                                                   
                   |----  ETDIFP                                                   
   
 
3 ECFCLU
         SUBROUTINE ECFCLU(IER)
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   
   Find assigned clusters (ie clusters + tracks association )
        STEERING ROUTINE
        CALL PRINTING OF BANKS FOR DEBUG (ECDEBG)
        CLEAR CLUSTER ARRAY AFTER PROCESSING (ERESET)
   
   
          IER = return code ( 0 if normal)
   
   
   
   
    ECLUSTER COMMONS
       KEWLOC = POINTER TO WORK BANK FOR SECOND LEVEL ARRAY
       NINDEB( 4110) = NUMBER OF DIFFERENT ROSEVE_CASES
       IROSEV(21900) = ARRAY CONTAINING OFFSET OF NEIGBOUR STOREYS
       IARRAY( 6144) = ARRAY IMAGE OF ONE ECAL SLICE STOREYS
       IDRRAY( 6144) = ARRAY IMAGE OF ONE ECAL SLICE (DEAD STOREYS)
       ENELOW = LOWER THRESHOLD FOR CLUSTERS
       ENHIGH = HIGH  THRESHOLD FOR CLUSTERS
       ECGTHR = TOTAL THRESHOLD FOR CLUSTERS
       ENDEAD = DEFAULT ENERGY GIVEN TO DEAD STOREYS
   
   
         COMMON/ECLUST/KEWLOC,IARRAY(6144),IROSEV(21900),NINDEB(4110),
        +             IDRRAY(6144),ENHIGH,ENELOW,ECGTHR,ENDEAD
         PARAMETER (JULVD=1,JULIT=2,JULTP=3,JULEC=4,JULLC=5)
         PARAMETER (JULSA=6,JULHC=7,JULMU=8,JULCA=9,JULSK=10)
         PARAMETER (JULYR=11,JULYT=12,JULEF=13,JULBC=14,JULFA=15
        +           ,JULBO=16,JULSI=17)
         PARAMETER (MODEND=0,MODREA=1,MODPRV=2,MODPRI=3,MODPRT=4)
         PARAMETER (MODPRE=5,MODPRL=6,MODPRS=7,MODPRH=8,MODPRM=9)
         PARAMETER (MODTPT=10,MODTPW=11,MODDEX=12,MODITC=13 ,MODVDE=14)
         PARAMETER (MODFIT=15,MODFTR=16,MODECL=17,MODMIP=18,MODEID=19)
         PARAMETER (MODFEO=20,MODFEP=21,MODHCL=22,MODHDP=23,MODEHG=24)
         PARAMETER (MODMUF=25,MODMUA=26,MODLCA=27,MODSAT=28,MODLTR=29)
         PARAMETER (MODPID=30,MODYMA=31,MODYTO=32,MODYV0=33,MODHIS=34)
         PARAMETER (MODPOT=35,MODBSP=36,MODWRI=37)
         PARAMETER (MODCOM=38,MODBCA=39,MODMUO=40,MODMON=41,MODENF=42)
         PARAMETER (MODGAM=43,MODEDI=44,MODGMX=45)
         PARAMETER (MODSUM=46,MODBOM=47)
         PARAMETER (MODPSI=48,MODSIC=49,MODGMP=50)
         PARAMETER (MODVTP=51,MODKNK=52,MODNUC=53)
         PARAMETER (LASTMO=53)
         CHARACTER*33 RNTXTM  (LASTMO)
         CHARACTER*8  RNTXTS  (LASTMO)
         INTEGER RNCALL (LASTMO)
         REAL    RNTIME (LASTMO)
   ----> Title of Modules
         DATA RNTXTM(1 )/'Reading records..................'/
         DATA RNTXTM(2 )/'Prepare data VDET................'/
         DATA RNTXTM(3 )/'Prepare data ITC.................'/
         DATA RNTXTM(4 )/'Prepare data TPC.................'/
         DATA RNTXTM(5 )/'Prepare data ECAL................'/
         DATA RNTXTM(6 )/'Prepare data LCAL................'/
         DATA RNTXTM(7 )/'Prepare data SATR................'/
         DATA RNTXTM(8 )/'Prepare data HCAL................'/
         DATA RNTXTM(9 )/'Prepare data MUON................'/
         DATA RNTXTM(10)/'TPC track finding................'/
         DATA RNTXTM(11)/'TPC wire association.............'/
         DATA RNTXTM(12)/'dE/dx calculation................'/
         DATA RNTXTM(13)/'ITC reconstruction...............'/
         DATA RNTXTM(14)/'VDET reconstruction..............'/
         DATA RNTXTM(15)/'Global fit VDET,ITC,TPC..........'/
         DATA RNTXTM(16)/'Extrapolate track ECAL,Coil,Hcal.'/
         DATA RNTXTM(17)/'Find ECAL clusters...............'/
         DATA RNTXTM(18)/'Minimum ionizing in ECAL.........'/
         DATA RNTXTM(19)/'Electron identification..........'/
         DATA RNTXTM(20)/'ECAL cluster analysis............'/
         DATA RNTXTM(21)/'ECAL statistics..................'/
         DATA RNTXTM(22)/'Find HCAL clusters...............'/
         DATA RNTXTM(23)/'HCAL digital pattern analysis....'/
         DATA RNTXTM(24)/'ECAL - HCAL global analysis......'/
         DATA RNTXTM(25)/'HCAL muon finding................'/
         DATA RNTXTM(26)/'MUON-hit - track association.....'/
         DATA RNTXTM(27)/'LCAL reconstruction..............'/
         DATA RNTXTM(28)/'SATR reconstruction..............'/
         DATA RNTXTM(29)/'Luminosity track-cluster assoc...'/
         DATA RNTXTM(30)/'Particle identification summary..'/
         DATA RNTXTM(31)/'Main vertex finding (Mermikides).'/
         DATA RNTXTM(32)/'Topology reconstruction..........'/
         DATA RNTXTM(33)/'V0 reconstruction................'/
         DATA RNTXTM(34)/'Histogramming....................'/
         DATA RNTXTM(35)/'Build pot banks..................'/
         DATA RNTXTM(36)/'Beam Spot Position...............'/
         DATA RNTXTM(37)/'Write event......................'/
         DATA RNTXTM(38)/'Compress data....................'/
         DATA RNTXTM(39)/'BCAL reconstruction..............'/
         DATA RNTXTM(40)/'MUON HCAL + Chambers association.'/
         DATA RNTXTM(41)/'Monitoring.......................'/
         DATA RNTXTM(42)/'Energy Flow......................'/
         DATA RNTXTM(43)/'ECAL Photon identification.......'/
         DATA RNTXTM(44)/'EDIR Class Word..................'/
         DATA RNTXTM(45)/'Gammas in charged clusters.......'/
         DATA RNTXTM(46)/'Summary File.....................'/
         DATA RNTXTM(47)/'BOM Calculate Beam Parameters....'/
         DATA RNTXTM(48)/'SICAL prepare data...............'/
         DATA RNTXTM(49)/'SICAL reconstruction.............'/
         DATA RNTXTM(50)/'GAMPEC + mod PECO + BULOS........'/
         DATA RNTXTM(51)/'Track preselection for VDET......'/
         DATA RNTXTM(52)/'Kink search......................'/
         DATA RNTXTM(53)/'Nuclear interaction search.......'/
   ----> Name of Modules
         DATA RNTXTS(1 )/'RLOOPR'/
         DATA RNTXTS(2 )/'VPREDA'/
         DATA RNTXTS(3 )/'IPREDA'/
         DATA RNTXTS(4 )/'TPREDA'/
         DATA RNTXTS(5 )/'EPREDA'/
         DATA RNTXTS(6 )/'LPREDA'/
         DATA RNTXTS(7 )/'SPREDA'/
         DATA RNTXTS(8 )/'HPREDA'/
         DATA RNTXTS(9 )/'MPREDA'/
         DATA RNTXTS(10)/'TPCREC'/
         DATA RNTXTS(11)/'TRKWIR'/
         DATA RNTXTS(12)/'TRKELS'/
         DATA RNTXTS(13)/'ITCREC'/
         DATA RNTXTS(14)/'VDLINK'/
         DATA RNTXTS(15)/'FITALL'/
         DATA RNTXTS(16)/'FTRACK'/
         DATA RNTXTS(17)/'ECFCLU'/
         DATA RNTXTS(18)/'ECRMIP'/
         DATA RNTXTS(19)/'ELECID'/
         DATA RNTXTS(20)/'ECFOBJ'/
         DATA RNTXTS(21)/'ECPRIN'/
         DATA RNTXTS(22)/'HCFCLU'/
         DATA RNTXTS(23)/'HDPREC'/
         DATA RNTXTS(24)/'ECHCGL'/
         DATA RNTXTS(25)/'HMFIND'/
         DATA RNTXTS(26)/'MUASS '/
         DATA RNTXTS(27)/'LCAREC'/
         DATA RNTXTS(28)/'SATREC'/
         DATA RNTXTS(29)/'LTRACK'/
         DATA RNTXTS(30)/'FPIDEN'/
         DATA RNTXTS(31)/'YFMAIN'/
         DATA RNTXTS(32)/'YTOPOL'/
         DATA RNTXTS(33)/'YMFV0S'/
         DATA RNTXTS(34)/'RHSEVT'/
         DATA RNTXTS(35)/'RDEFPO'/
         DATA RNTXTS(36)/'VBSPOT'/
         DATA RNTXTS(37)/'RWREVT'/
         DATA RNTXTS(38)/'CMPLIS'/
         DATA RNTXTS(39)/'BPREDA'/
         DATA RNTXTS(40)/'MUIDO '/
         DATA RNTXTS(41)/'RMONIT'/
         DATA RNTXTS(42)/'EMSKEV'/
         DATA RNTXTS(43)/'EBEGID'/
         DATA RNTXTS(44)/'ALCLASW'/
         DATA RNTXTS(45)/'ECGMIX'/
         DATA RNTXTS(46)/'RCJSUM'/
         DATA RNTXTS(47)/'OMBREC'/
         DATA RNTXTS(48)/'SIPREDA'/
         DATA RNTXTS(49)/'SICREC'/
         DATA RNTXTS(50)/'GASTEER'/
         DATA RNTXTS(51)/'VTRPRE'/
         DATA RNTXTS(52)/'KINKS'/
         DATA RNTXTS(53)/'NUCVTX'/
   
   -------> PARAMETERS GLOBAL OVER PROGRAM
    Parameters
   -------------------
      =  1, VDET    identifier
      =  2, ITC     identifier
      =  3, TPC     identifier
      =  4, ECAL    identifier
      =  5, LCAL    identifier
   A   =  6, SATR    identifier
      =  7, HCAL    identifier
      =  8, MUON    identifier
   A   =  9, CALO    identifier
      = 10, SKEL    identifier
      = 11, YREC    identifier
      = 12, YTOP    identifier
      = 13, EFLO    identifier
   BC   = 14, BCAL    identifier
   A   = 15, FALCON  identifier
   BO   = 16, BOM     identifier
      = 17, SICAL   identifier
    identifiers USED IN RNXMOD
                 = 0   NOMODULE -used to close a module
   ASTMO              = 53  Largest module number
     (LASTMO)    = Text describing the Modules
     (LASTMO)    = Subroutine name of the Module
   ALL  (LASTMO)    = Number of call to the Module
     (LASTMO)    = Time spent in the Module
   
    FLAGS
         INTEGER JDBDRF,JHISRF,JPRSRF,JPRERF,MDET, IDEBBC, IDEBTC
         LOGICAL FDEBRF,FDETRF,FREPRO,FPASS0
         PARAMETER (MDET=17)
         PARAMETER (NCHDET=4)
         CHARACTER*(NCHDET) TNAMRD
         COMMON /RFLAGS/FDEBRF,FDETRF(MDET),FREPRO,FPASS0,JDBDRF(MDET),
        &        JHISRF(MDET),JPRSRF(MDET),JPRERF(MDET),JCMORF,
        &        JEBIRF(2),JFBIRF(2),TNAMRD(MDET), IDEBBC, IDEBTC
   
       = Number of detectors
     = Number of characters for detector names
   BRF  = .true. if general debug requested
    = array of logical flags: type of reconstruction
         1 - VDET
         2 - ITC
         3 - TPC
         4 - ECAL            (SEE PARAMETERS JULXX IN RPARAC)
         5 - LCAL
         6 - SATR
         7 - HCAL
         8 - MUON
         9 - CALO
        10 - SKEL
        11 - YREC
        12 - YTOP
        13 - EFLO
        14 - BCAL
        15 - FALCON
        16 - BOM
        17 - SICAL
     = True if POT-POT reprocessing
   ASS0  = True if PASS0 mode
   BDRFi = array of integers: debug level for detectors
    = array of integers: histogram level for detectors
    = Debug levels for start of JOB printing per detector
    = Debug levels for end of JOB printing per detector
    = current module - set in RNXMOD
   BIRF = Bit map of non fatal errors (1 bit per module)
   BIRF = Bit map of fatal errors (1 bit per module)
   -------> DETECTOR NAMES
   AMRDi  = Detector name for detector i (numbering as FDETRF)
    IDEBBC = First evt to debug
    IDEBTC = Last evt to debug
   
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   CALREC                                                                          
        |---- ECFCLU                                                               
                   |----  ECCLUS                                                   
                   |----  ECMESP                                                   
                   |----  EFICLP                                                   
                   |----  ECTHRE                                                   
                   |----  ECTPC                                                    
                   |----  ECLTRK                                                   
                   |----  ECDEBG                                                   
                   |----  ERESET                                                   
   
 
3 ECFIBT
         SUBROUTINE ECFIBT
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Wires banks analysis
   
      Authors : M.N Minard            10-04-95
   
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   ECFILS                                                                          
        |---- ECFIBT                                                               
                   |----  RQBUNC                              External             
                   |----  NAMIND                              External             
                   |----  AUBOS                               External             
                   |----  LACO                                External             
                   |----  BLIST                               External             
                   |----  FLOAT                               External             
                   |----  NINT                                External             
   
 
3 ECFILS
         SUBROUTINE ECFILS
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Wires banks analysis
   
      AUTHORS : B. MICHEL, D. PALLIN  25-05-89
      REVISED : 01-09-89
      Modified : 03-04-95  M.N Minard
   
      ECFIBT called for 1995 and above
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   EPREDA                                                                          
        |---- ECFILS                                                               
                   |----  ECFIBT                                                   
                   |----  NAMIND                              External             
                   |----  AUBOS                               External             
                   |----  LACO                                External             
                   |----  BLIST                               External             
                   |----  FLOAT                               External             
                   |----  NINT                                External             
   
 
3 ECFMIP
         SUBROUTINE ECFMIP
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Routine to tag cluster created by minimum ionising particle
     Compares the energy in each stack with that expected for a
     MIP and calculates a Chisqd.
     Takes into account the angle and energy dependence.
     Works for all particles of momentum > 0.5 GeV.
         IFLAMP = 1 FOR A MINION
   
       Author : R. Edgecock   870604
       MODIFIED :D PALLIN 881222
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   ECRMIP                                                                          
        |---- ECFMIP                                                               
                   |----  SIN                                 External             
                   |----  COS                                 External             
                   |----  EFNDSC                              External             
                   |----  AMOD                                External             
                   |----  ABS                                 External             
   
 
3 ECFOBJ
         SUBROUTINE ECFOBJ
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Steering routine to analyze reconstructed clusters
   
     AUTHOR   : J.P. ALBANESE
     MODIFIED : F. ETIENNE      87/08/27
   
     BANKS :
       INPUT   : ECLU
       OUTPUT  : ECOB
       CREATED : NONE
   
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   CALREC                                                                          
        |---- ECFOBJ                                                               
                   |----  ECOBNK                                                   
                   |----  IF                                  External             
                   |----  ESLAS                                                    
                   |----  ECNCOB                                                   
                   |----  ECCAOB                                                   
                   |----  ECALIG                                                   
                   |----  JHISRF                              External             
                   |----  ECCLCORETURNCALLRERROR              External             
   
 
3 ECGFLW
         SUBROUTINE ECGFLW ( IADD, CORGFL )
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Correction for energy dependance due to gaz flow
   
      Author   :- M.N. Minard                      19-SEP-1991
   
      Inputs:
           - iadd          I/  Tower address in ETDI
   
      Outputs:
           - CORGFL        R/  Correction factor for theta dependance of
                               absolute calibration in barrel
   
                               = 1. for end Caps
       Bank used : ECGF
   
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   EPREDA                                                                          
        |---- ECGFLW                                                               
                   |----  NAMIND                              External             
                   |----  IBITS                               External             
                   |----  EMDTOW                              External             
                   |----  FLOAT                               External             
   
 
3 ECGMIX
         SUBROUTINE ECGMIX
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   
   Search for embedded gammas in charged eclusters
   
     AUTHOR   : A. BONISSENT  901206
   
   
     BANKS :
       INPUT   : ECLU,ECT1,ERL3,EIDT
       OUTPUT  : EGMX
       CREATED : EGMX
   
   
   
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   CALREC                                                                          
        |---- ECGMIX                                                               
                   |----  AUBOS                               External             
                   |----  BLIST                               External             
                   |----  IF                                  External             
                   |----  ESLAS                                                    
                   |----  SQRT                                External             
                   |----  EBNEUT                              External             
                   |----  SIN                                 External             
                   |----  COS                                 External             
                   |----  ACOS                                External             
                   |----  ATAN2                               External             
                   |----  AUBPRS                              External             
                   |----  RERROR                                                   
                   |----  NDROP                               External             
   
 
3 ECHARG
         SUBROUTINE ECHARG(ICL,ICHR)
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Check if a cluster is 'charged'
   
     AUTHOR   : D. PALLIN
     MODIFIED :
   
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   ELECID                                                                          
        |---- ECHARG                                                               
                   |----  IF                                  External             
                   |----  ESLAS                                                    
   
 
3 ECHCGL
         SUBROUTINE ECHCGL
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   
   Perform ec hc global analysis
   
     AUTHOR   : A. BONISSENT  870831
   
   
     BANKS :
       INPUT   : NONE
       OUTPUT  : NONE
       CREATED : NONE
   
   
   
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   CALREC                                                                          
        |---- ECHCGL                                                               
                   |----  NLINK                               External             
                   |----  EPRSTO                                                   
                   |----  CFPASS                                                   
                   |----  HDSPRE                                                   
                   |----  CASHET                                                   
                   |----  CVRIFY                                                   
                   |----  CRCALO                                                   
                   |----  JHISRF                              External             
                   |----  CEXCOB                                                   
                   |----  CEXHIS                                                   
                   |----  CRCHRL                                                   
                   |----  CRCPARRETURNCONTINUE                External             
                   |----  RERROR                                                   
   
 
3 ECHEDC
         SUBROUTINE ECHEDC
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Create eche bank to transmit calibration used to pot
       Create EHGF bank to transmit calibaration to POT
                   Author  M.N Minard
                           5/06/90
                   Mod    16/09/91
        Bank created ECHE , EHGF
        Bank used ECCA  , ECGF
        Called from EINIRU
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   EINIRU                                                                          
        |---- ECHEDC                                                               
                   |----  NAMIND                              External             
                   |----  UCOPY                               External             
                   |----  AUBOS                               External             
                   |----  BLIST                               External             
   
 
3 ECHIBA
         SUBROUTINE ECHIBA
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   
   Fill gammas ecal histograms
      Called if histogramm flag = 4
      Histo. number 4400 to 4499
   
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   ECHIST                                                                          
        |---- ECHIBA                                                               
                   |----  HFILL                               External             
   
 
3 ECHIST
         SUBROUTINE ECHIST
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Fills ecal histograms
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   RHSEVT                                                                          
        |---- ECHIST                                                               
                   |----  HFILL                               External             
                   |----  FLOAT                               External             
                   |----  ECHIBA                                                   
   
 
3 ECHTAG
           SUBROUTINE ECHTAG ( NETP1 , ITAG , TPAR )
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Tags track quality
   
       Authors : M.N. Minard , M. Pepe       26/02/89
       Modified: M.N  Minard                 04/01/91
   
    Input       NETP1 = Track number
    Output      ITAG  = 1 Good track from vertex
                        3 Good track from secondary V0
                        101 or 103 too low momentum
                        others not a good track
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   ECST                                                                            
   FLOWFI                                                                          
   FLOWTR                                                                          
        |---- ECHTAG                                                               
                   |----  NAMIND                              External             
                   |----  RERROR                                                   
                   |----  FLOAT                               External             
                   |----  ABS                                 External             
                   |----  UFITQL                              External             
                   |----  HFILL                               External             
   
 
3 ECINIT
         SUBROUTINE ECINIT(INEW,JNEW,KNEW,IORG,NDIRC)
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   
   Transform storey encoding for clustrization
   
         FUNCTIONAL DESCRIPTION:
          TRANSFORM NEW ECAL ENCODING INTO OLD ECAL ENCODING
          THEN COMPUTE POINTER INTO ARRAY MAPPING THE ECAL
          (IORG) AND STARTING ADDRESS FOR EACH STOREY_IROSEV(NDIRC).
   
   
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   ECDIGI                                                                          
   EGETDS                                                                          
   EPREDA                                                                          
        |---- ECINIT                                                               
                   |----  INT                                 External             
   
 
3 ECINRV
         SUBROUTINE ECINRV
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   
   Definition of  "rose des vents" irosev   ***  (28/9/84)
   
   
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   EINIJO                                                                          
        |---- ECINRV                                                               
                   |----  VZERO                               External             
                   |----  INT                                 External             
                   |----  ABS                                 External             
   
 
3 ECLAMP
         SUBROUTINE ECLAMP
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Clean ecal looking to amplificator noise
   
                          AUTHOR : M.N MINARD 25.11.90
     Modified: M.N.Minard 971218
           Rescale cut to effective threshold. Affects MonteCarlo only
   
       Bank used EWHE , ETDI
       Bank of killed channels done  ETKC
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   EPREDA                                                                          
        |---- ECLAMP                                                               
                   |----  VZERO                               External             
                   |----  WBANK                               External             
                   |----  EBTZTH                              External             
                   |----  IBITS                               External             
                   |----  ECSCMD                                                   
                   |----  FLOAT                               External             
                   |----  NAMIND                              External             
                   |----  AMIN1                               External             
                   |----  ECDAMP                                                   
                   |----  BKTOW                               External             
                   |----  MOD                                 External             
                   |----  WDROP                               External             
                   |----  AUBOS                               External             
                   |----  BLIST                               External             
                   |----  UCOPY                               External             
                   |----  AUBPRS                              External             
                   |----  RERROR                                                   
   
 
3 ECLANA
         SUBROUTINE ECLANA(KCL,KCT)
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Routine for electron identification build eiga bank and fill eidt
   
     AUTHOR   : D. PALLIN
     MODIFIED :
   
     BANKS :
       INPUT   : NONE
       OUTPUT  : EIGA
   
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
              ECLANA                                                               
                   |----  ECLOST                                                   
                   |----  SQRT                                External             
   
 
3 ECLEIB
         SUBROUTINE ECLEIB
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Close eidt bank
     AUTHOR   : D. PALLIN
     MODIFIED :
   
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   ELECID                                                                          
        |---- ECLEIB                                                               
                   |----  AUBOS                               External             
   
 
3 ECLGEO
         SUBROUTINE ECLGEO
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Geometrical stacks parameters.
     Called one time by run to fill / EZLUGE /.
   
     AUTHOR   : J.Badier  22/02/88
   
     BANKS :
       INPUT   : NONE
       OUTPUT  : NONE
       CREATED : NONE
   
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   EINIRU                                                                          
        |---- ECLGEO                                                               
                   |----  ESRPT                               External             
                   |----  SQRT                                External             
                   |----  COS                                 External             
                   |----  SIN                                 External             
   
 
3 ECLOPE
         SUBROUTINE ECLOPE(I,CX,CY,CZ)
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Computes the the angle between charged track and inner face
     OF THE ECAL MODULE
   
     AUTHOR : A. FALVARD
     MODIFIED:
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   ELONGI                                                                          
        |---- ECLOPE.                                                              
   
 
3 ECLORL
         SUBROUTINE ECLORL
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   
   Close trk-cluster relation
   
   
     AUTHOR   : A. BONISSENT  860615
     MODIFIED : A. BONISSENT  861108
   
     BANKS :
       INPUT   : ERL3
       OUTPUT  : ERL3
       CREATED : NONE
   
   
      UPDATE THE LENGTH OF CLUSTER-TRACK RELATIONS BANK FROM
      ITS ORIGINAL MAXIMUM LENGTH TO ITS ACTUAL LENGTH
   
        INPUT  = NUMBER OF RELATIONS
        OUTPUT = SIZE OF RLCT BANK
   
   
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
              ECLORL                                                               
                   |----  AUBOS                               External             
   
 
3 ECLOST
         SUBROUTINE ECLOST(ICLU,ECLOSS,IER)
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Compute correction to total ecobject energy
        AUTHOR :D PALLIN
          MODIFIED : JP Albanese ---> use of j Badier routines (5/1/90)
      Modified :- E. Lancon             23-OCT-1991
             This routine is called by :
                 ECOENT : for analysis of charged clusters
                 ECLANA : for analysis of electrons
             Replace call to EBLEAK by call to ECLEAK with charge = 1
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   ECLANA                                                                          
   ECOENT                                                                          
        |---- ECLOST                                                               
                   |----  ECLEAK                              External             
                   |----  EBCOCL                              External             
   
 
3 ECLTAG
         SUBROUTINE ECLTAG ( ICL , IGOO , ICH)
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Tags neutral clusters to remove fake ones
   
       Authors : M.N. Minard , M. Pepe       26/02/89
   
     Input : Icl cluster number
     Output: Igoo = 1 accepted neutral cluster
                  = 0 not accepted neutral cluster
             Ich  = number of charged tracks linked to cluster
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   ECLTYP                                                                          
        |---- ECLTAG                                                               
                   |----  ESTAG                                                    
   
 
3 ECLTRK
         SUBROUTINE ECLTRK(IER)
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   
   Associate clusters to tracks
   
     AUTHOR   : J.P. ALBANESE 860615
     MODIFIED : A. BONISSENT  861108
   
   
     BANKS :
       INPUT   : NONE
       OUTPUT  : EFET
       CREATED : NONE
   
    PERFORM ASSOCIATION BETWEEN TPC_TRACKS AND EC_CLUSTERS;
                         ACTIONS>>>
     GET TRACKS
     LOOP ON TRACKS
       INITIALIZE TRACK FOR EXTRAPOLATION
       LOOP ON EXTRAPOLATION STEPS
          EXTRAPOLATE TRACK TO NEXT POINT (CALL EHLIX)
          FIND STOREY IN WICH POINTS LAY (CALL ECDIGI)
          FIND CLUSTERS NEARBY WITH AN ALGORITHM SIMILAR TO CLUSTERING
                       (CALL NEIGHB)
       ENDLOOP
      UPDATE TRACK-CLUSTER RELATIONSHIP (EINSRL)
     ENDDOLOOP
   1
   
          IER = return code ( 0 if normal)
   
   
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   ECFCLU                                                                          
        |---- ECLTRK                                                               
                   |----  EINIRL                                                   
                   |----  EGTTKS                                                   
                   |----  EINITK                                                   
                   |----  XXM                                 External             
                   |----  EINHLX                                                   
                   |----  EHLIX                                                    
                   |----  ECDIGI                                                   
                   |----  ENIGHB                                                   
                   |----  CALLEHLIX                           External             
                   |----  ECLORLCONTINUE                      External             
   
 
3 ECLTYP
         SUBROUTINE ECLTYP
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Books and fills bank to set cluster type
   -
   -    Authors : M.N. Minard , M. Pepe       26/02/89
   -    Modified: M.N  Minard                 04/01/91
   -
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   ECST                                                                            
        |---- ECLTYP                                                               
                   |----  AUBOS                               External             
                   |----  BLIST                               External             
                   |----  NAMIND                              External             
                   |----  ECLTAG                                                   
   
 
3 ECLUAR
         SUBROUTINE ECLUAR(IER)
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   
   Create eclu and fill iarray(6144) with hit towers
     (PART OF THE PREVIOUS ECCLUS ROUTINE)
   
     AUTHOR  :  J.P. ALBANESE
     MODIFIED:  C. BENCHOUK 890529
   
     BANKS:
       INPUT  : ESDA
       OUTPUT : ECLU
       CREATED: ECLU
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   ECCLUS                                                                          
        |---- ECLUAR                                                               
                   |----  AUBOS                               External             
                   |----  WBANK                               External             
                   |----  NDROP                               External             
                   |----  RERROR                                                   
   
 
3 ECMESP
         SUBROUTINE ECMESP
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   
   Merge/split topological clusters
    MERGE AND SPLIT TOPOLOGICAL CLUSTERS ACCORDING TO DATABASE DEAD
    CHANNELS OR GEOMETRY INFORMATIONS SPECIFIC TO A RUN CONDITION.
   
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   ECFCLU                                                                          
        |---- ECMESP.                                                              
   
 
3 ECMOD
         SUBROUTINE ECMOD(I,J,IMOD)
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   
   Determine ecal module number for a give row and column
             1-12 MODULES FROM ENDCAP1
            13-24 MODULES FROM BARREL
            25-36 MODULES FROM ENCAP2
   
    Modified: G.Taylor  971217  Bug fix for overlap region
   
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   EGETDS                                                                          
   EPREDA                                                                          
   ICASWT                                                                          
        |---- ECMOD .                                                              
   
 
3 ECMOPL
         SUBROUTINE ECMOPL(IT,CX,CY,CZ)
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Correct the ecal thickness by incoming angle(barrel or endcap
     BUT NOT OVERLAP)
   
     AUTHOR : A. FALVARD
     MODIFIED:
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   ELONGI                                                                          
        |---- ECMOPL                                                               
                   |----  DROITE                              External             
   
 
3 ECNCOB
         SUBROUTINE ECNCOB(ICL,IER)
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   
   Fill neutral ecobject banks
        IER .NE. 0 : Abend without banks filling.
     One ecobject is created for each eccluster
     Information is obtained from ENEUTW,ENPART commons.
     AUTHOR   : A. BONISSENT  870819
                J. Badier     880422
                J. Badier     881128
                J. Badier     891114
     BANKS :
       INPUT   : ECOB,ECLU,ESDA,EBOS
       OUTPUT  : ECOB,EHYP,EPAR
       CREATED : NONE
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   ECFOBJ                                                                          
        |---- ECNCOB                                                               
                   |----  AUBOS                               External             
                   |----  EBNEUT                              External             
                   |----  RERROR                                                   
                   |----  NDROP                               External             
   
 
3 ECOBNK
         SUBROUTINE ECOBNK(IER)
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   
   Create ecobject banks
   
     AUTHOR   : A. BONISSENT  870819
   
     BANKS :
       INPUT   : ECLU,ESDA,ETP1
       OUTPUT  : NONE
       CREATED : ECOB,ETCK,EBOS,EHYP,EPAR
   
       Return code =IER  normal : 0
   
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   ECFOBJ                                                                          
        |---- ECOBNK                                                               
                   |----  AUBOS                               External             
                   |----  BLIST                               External             
                   |----  IFIX                                External             
                   |----  FLOAT                               External             
                   |----  RERROR                                                   
                   |----  NDROP                               External             
   
 
3 ECOENT
         SUBROUTINE ECOENT(IER)
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Compute correction to total ecobject energy
        AUTHOR :JP Albanese
        MODIFIED : D PALLIN
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   ECCAOB                                                                          
        |---- ECOENT                                                               
                   |----  ECLOST                                                   
                   |----  EBPREP                              External             
                   |----  EBCLAP                              External             
   
 
3 ECOIDP
         SUBROUTINE ECOIDP(ICLUS)
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Initialize identification parameter and
    FILL COMMON EANCLU  FOR SUBSEQUENT CLUSTER ANALYSIS
   
     AUTHOR   : J.P. ALBANESE
     MODIFIED : F. ETIENNE      87/08/27
   
     BANKS :
       INPUT   : ESDA,ECLU,ECT1
       OUTPUT  : NONE
       CREATED : NONE
   
   
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   ECCAOB                                                                          
        |---- ECOIDP                                                               
                   |----  VZERO                               External             
                   |----  IUCOMP                              External             
                   |----  RERROR                                                   
                   |----  VSUM                                External             
                   |----  SIN                                 External             
                   |----  COS                                 External             
   
 
3 ECOS
         SUBROUTINE ECOS ( EN,IPHI,ITHE,IST,EVECT)
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Given a storey energy in ecal, it creates the corresponding
    energy vector
   -
   -    Authors : M.N. Minard , M. Pepe       26/02/89
   -
    Input : EN     storey energy
            IPHI   column index of storey
            ITHE   row index of storey
            IST    stack #
    Output: EVECT  energy vector
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   EROAD                                                                           
        |---- ECOS                                                                 
                   |----  NAMIND                              External             
                   |----  ESRBC                               External             
                   |----  SQRT                                External             
   
 
3 ECPAD
         SUBROUTINE ECPAD (LUN,IER)
  ------------------------------------------------------------------------------
    CKEY ECAL DBASE / JULIA USER
  ------------------------------------------------------------------------------
   - B.Bloch   January 1990  as courtesy from F. Ranjard
   Reads the ecalpadgaincorrection file in sequential mode
    opens the file in sequential mode on unit LUN
   - Input  : LUN    / I     = logical unit for ECAL file
   - Output : IER    / I     = error code rom AOPEN
                               0 means OK
   - Calls  :  AOPEN,ACDARG,AWERRC              from ALEPHLIB
               BREAD                            from BOS
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   ERCUPI                                                                          
        |---- ECPAD                                                                
                   |----  AGTFIL                              External             
                   |----  BREAD                               External             
   
 
3 ECPASR
         SUBROUTINE ECPASR
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Showers parameters initialisation.
   
     AUTHOR   : J.Badier 16/03/87
   
     BANKS :
       INPUT   : NONE
       OUTPUT  : NONE
       CREATED : NONE
   
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   EINIRU                                                                          
        |---- ECPASR.                                                              
   
 
3 ECPLM
         SUBROUTINE ECPLM(IMOD,ISTA,EWEI)
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Ecal correction for wrong plane killed
   
    AUTHOR : M.N MINARD 30-09-92
   
        Uses EWKW bank
        Input : IMOD  Module number
        Input : ISTA  Stack  number
        Output: EWEI correction factor
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   EPREDA                                                                          
        |---- ECPLM                                                                
                   |----  NAMIND                              External             
                   |----  FLOAT                               External             
   
 
3 ECPRIN
         SUBROUTINE ECPRIN
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Fill ecpric common to gather ecal statistics
       to be printed at end of job.
   
      Modified :- E. Lancon              4-JUN-1991
                 Add Number of electron, photons per events, wire energy
                 statistics
   
     Called By : CALREC
   
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   CALREC                                                                          
        |---- ECPRIN                                                               
                   |----  NAMIND                              External             
                   |----  FLOAT                               External             
   
 
3 ECPRLO
         SUBROUTINE ECPRLO(BSASTA,USASTA)
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Computes the beta/alpha and 1/alpha parameters of the em shower
   
     AUTHOR : A. FALVARD
     MODIFIED:
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   ELONGI                                                                          
        |---- ECPRLO                                                               
                   |----  ESTACK                              External             
                   |----  ALOG10                              External             
                   |----  ALOG                                External             
                   |----  VZERO                               External             
                   |----  ECPLAN                              External             
                   |----  RERROR                                                   
                   |----  PROLOT                                                   
   
 
3 ECRCOB
         SUBROUTINE ECRCOB(IER)
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   
   Fill ecobject banks
   
     temporary, one ecobject is created for each eccluster
   
     AUTHOR   : A. BONISSENT  870819
     MODIFIED : D. PALLIN     88/12/19
   
     BANKS :
       INPUT   : NONE
       OUTPUT  : NONE
       CREATED : NONE
   
   
   
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   ECCAOB                                                                          
        |---- ECRCOB                                                               
                   |----  AUBOS                               External             
                   |----  ECLSEA                              External             
                   |----  ESLAS                                                    
                   |----  NAMIND                              External             
                   |----  RERROR                                                   
                   |----  NDROP                               External             
   
 
3 ECRE4D
         SUBROUTINE ECRE4D(IER)
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Create e4de bank
       AUTHOR  : D. PALLIN
       MODIFIED:
   
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   ELECID                                                                          
        |---- ECRE4D                                                               
                   |----  NAMIND                              External             
                   |----  AUBOS                               External             
                   |----  BLIST                               External             
                   |----  NDROP                               External             
   
 
3 ECREIB
         SUBROUTINE ECREIB(IER)
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Create eidt bank
       AUTHOR  : D. PALLIN
       MODIFIED:
   
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   ELECID                                                                          
        |---- ECREIB                                                               
                   |----  NAMIND                              External             
                   |----  AUBOS                               External             
                   |----  BLIST                               External             
                   |----  RERROR                                                   
                   |----  NDROP                               External             
   
 
3 ECRMIP
         SUBROUTINE ECRMIP
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Look for minimum ionizing particle
   
     AUTHOR   : J.P. ALBANESE
     MODIFIED : F. ETIENNE      87/08/27
     MODIFIED : D. PALLIN       88/12/19
   
     BANKS :
       INPUT   : ECLU,ECT1,ERL3,ETP1
       OUTPUT  : NONE
       CREATED :
   
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   CALREC                                                                          
        |---- ECRMIP                                                               
                   |----  NAMIND                              External             
                   |----  AUBOS                               External             
                   |----  BLIST                               External             
                   |----  VZERO                               External             
                   |----  ECFMIP                                                   
                   |----  RERROR                                                   
                   |----  NDROP                               External             
   
 
3 ECRNDX
         SUBROUTINE ECRNDX
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   
   Create ec name indices      for banks
   
   
     AUTHOR   : A. BONISSENT  861001
     MODIFIED : A. BONISSENT  861108
   
     BANKS :
       INPUT   : NONE
       OUTPUT  : NONE
       CREATED : NONE
   
   
   
   
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   EINIJO                                                                          
        |---- ECRNDX                                                               
                   |----  NAMIND                              External             
   
 
3 ECRPEI
         SUBROUTINE ECRPEI
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Create and fill peid bk
   
     AUTHOR   : D. PALLIN
     MODIFIED :
   
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
              ECRPEI                                                               
                   |----  AUBOS                               External             
                   |----  BLIST                               External             
                   |----  E1BPEI                                                   
                   |----  E2BPEI                                                   
                   |----  E3BPEI                                                   
                   |----  RERROR                                                   
   
 
3 ECRTR
         SUBROUTINE ECRTR ( NETP1 , ISTAC )
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Calculates storeys crossed by extrapolated track
   -
   -    Authors : M.N. Minard , M. Pepe       26/02/89
   -
   -    Input  :   NETP1        = Track number
   -    Output :   ISTAC ( 1 )  = Number of storeys crossed for the stack
   -                      2->5  = Encoded storey address
   -
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   ECTRAP                                                                          
        |---- ECRTR                                                                
                   |----  VZERO                               External             
                   |----  EINITK                                                   
                   |----  EINHLX                                                   
                   |----  EHLIX                                                    
                   |----  ECDIGI                                                   
   
 
3 ECRUNQ
         SUBROUTINE ECRUNQ ( NCL1 , NCL2 , NAUTO )
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Storey cleaning and autopeds info to pot
        Bank output ECRQ
   
        Lee F. Thompson. 23rd April 1990.
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   EPREDA                                                                          
        |---- ECRUNQ                                                               
                   |----  NDROP                               External             
                   |----  AUBOS                               External             
                   |----  BLIST                               External             
                   |----  RERROR                                                   
                   |----  ISHFT                               External             
                   |----  AUBPRS                              External             
   
 
3 ECSCMD
         SUBROUTINE ECSCMD(I,J,IMOD,ISC)
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   
   Determine ecal module number for a give row and column
               I = PHI NUMBER
               J = TETA NUMBER
       IMOD  1-12 MODULES
       ISC = 1 ENDCAP 1
             2 BARREL
             3 ENCAP 2
   
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   CPADWR                                                                          
   ECLAMP                                                                          
   ECSUPP                                                                          
   ECSW1093                                                                        
   ETDIFP                                                                          
        |---- ECSCMD.                                                              
   
 
3 ECST
         SUBROUTINE ECST (IER)
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Steering for mask analysis
        Creates POT banks PMSK and PRTM
   -
   -     Authors : M.N. Minard , M. Pepe       26/02/89
   -     Modified: M.N  Minard                 04/01/91
   -     Modified: F.Ranjard                   06/06/91
        to add some protections when creating banks
   -     Creates temporary bank EMSK
   -     Creates temporary bank ECTY to tag electromagnetic cluster type
   -     For each track  calculates energy in road
   -     Fills  EMSK , PRTM  banks
   -     Output : IER = 0  all banks available for analysis
   -              ELSE     some banks are missing
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   EMSKEV                                                                          
        |---- ECST                                                                 
                   |----  NAMIND                              External             
                   |----  ECLTYP                                                   
                   |----  ECTEMP                                                   
                   |----  AUBOS                               External             
                   |----  BLIST                               External             
                   |----  VZERO                               External             
                   |----  IF                                  External             
                   |----  ECHTAG                                                   
                   |----  MOD                                 External             
                   |----  ECTRAP                                                   
                   |----  ECTREA                                                   
                   |----  EMSKMU                                                   
                   |----  EMFILL                                                   
                   |----  EROAD                                                    
                   |----  UCOPY                               External             
                   |----  EMSKF                                                    
                   |----  ENPROX                                                   
                   |----  HROAD                                                    
                   |----  PMSKFI                                                   
                   |----  AUBPRS                              External             
   
 
3 ECSUPP
         SUBROUTINE ECSUPP ( IECLU , ISUP )
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Flag 'noisy' ecal clusters
     Author:   M.N.Minard   18.9.89
     Output:
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   FLOWFI                                                                          
        |---- ECSUPP                                                               
                   |----  VZERO                               External             
                   |----  NAMIND                              External             
                   |----  ECSCMD                                                   
                   |----  FLOAT                               External             
                   |----  ABS                                 External             
   
 
3 ECSW1093
         SUBROUTINE ECSW1093
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Fix etdi swapping in end-cap for runs 22793 - 22880
   
      Author   :- M.N. Minard              29-NOV-1993
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   EPREDA                                                                          
        |---- ECSW1093                                                             
                   |----  NAMIND                              External             
                   |----  CHAINT                              External             
                   |----  IBITS                               External             
                   |----  ECSCMD                                                   
                   |----  ISHFT                               External             
   
 
3 ECSW94
         SUBROUTINE ECSW94
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   -
   -    M.N Minard  7/7/94
   -    Active only on 1994 raw data Run<25894
   Swap gain for etdi
       Input Bank ETDI , used GECA
       Bank modified ETDI
   
       Modified M.Cattaneo 980424
             EXIT JULIA if EAGC bank is missing when required
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   EPREDA                                                                          
        |---- ECSW94                                                               
                   |----  NAMIND                              External             
                   |----  CHAINT                              External             
                   |----  UCOPY                               External             
                   |----  ALTELL                              External             
                   |----  IBITS                               External             
                   |----  FLOAT                               External             
                   |----  INT                                 External             
   
 
3 ECTEMP
         SUBROUTINE ECTEMP
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Creates temporary banks ecte and hcte where the
       energies subtracted from each storeys are kept
   -
   -     Authors : M.N. Minard , M. Pepe       26/02/89
   -     Modified: M.N  Minard                 04/01/91
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   ECST                                                                            
        |---- ECTEMP                                                               
                   |----  NAMIND                              External             
                   |----  AUBOS                               External             
                   |----  BLIST                               External             
                   |----  RERROR                                                   
   
 
3 ECTHRE
         SUBROUTINE ECTHRE
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   
   Set global threshold on cluster energy
         INPUT :'ECLU'
         OUTPUT:'ECLU'(MODIFIED)
         LOOP ON CLUSTERS
           CANCEL POINTER TO STOREYS(SET TO 0)
   
   
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   ECFCLU                                                                          
        |---- ECTHRE.                                                              
   
 
3 ECTOPO
         SUBROUTINE ECTOPO(IT)
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Looks for the ecal region where is the charged cluster
   
       AUTHOR : A. FALVARD
       MODIFIED:
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   ELONGI                                                                          
        |---- ECTOPO                                                               
                   |----  ESRPT                               External             
                   |----  FLOAT                               External             
                   |----  JSTO                                External             
                   |----  EFNDMD                              External             
   
 
3 ECTPC
         SUBROUTINE ECTPC(IER)
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   
   Create tpc tracks
   
   
     AUTHOR   : A. BONISSENT  861128
     MODIFIED : DENIS COURVOISIER  890324
   
     CREATE FAKED TPC TRACKS FROM THE TRUE MONTE CARLO DATA    ,
       FOR EXTRAPOLATION IN ECAL
   
      STEERING ,  CALLS :
                EFICV GETS PARTICLE AT ITS CREATION VERTEX
                EPNEU  PROPAGATES NEUTRALS AT TPC EXIT
                EPCHG PROPAGATES CHARGED
   
     BANKS :
       INPUT   : NONE
       OUTPUT  : NONE
       CREATED : NONE
   
       INPUT  : NONE
   
       OUTPUT : NONE
   
   
          IER = return code ( 0 if normal)
   
   
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   ECFCLU                                                                          
        |---- ECTPC                                                                
                   |----  RERROR                                                   
                   |----  EPRTPC                                                   
                   |----  NLINK                               External             
                   |----  EFICV                                                    
                   |----  EPCHG                                                    
                   |----  EPNEU                                                    
                   |----  EPCALO                                                   
   
 
3 ECTRAP
         SUBROUTINE ECTRAP(NETP1,XTRAP,ITRAP,XDER)
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Extrapolates tracks in ecal
   -
   -     Authors : M.N. Minard , M. Pepe       26/02/89
   -
    : NETP1          = ETP1 element of track to extrapolate
    XTRAP(3,5)     = x,y,z coordinates of extrapolated point
                            in each stack
           ITRAP(1,5)     = number of storeys crossed by track per stack
           ITRAP(I=2-5,5) = packed cell address of extrapolated
                            points per stack
           XDER (3,5)     = cosine directors of extrapolated track
                            in each stack
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   ECST                                                                            
        |---- ECTRAP                                                               
                   |----  VZERO                               External             
                   |----  EX3IJK                                                   
                   |----  EINTST                              External             
                   |----  UCOPY                               External             
                   |----  SQRT                                External             
                   |----  VSCALE                              External             
                   |----  ESRBC                               External             
                   |----  ABS                                 External             
                   |----  AUHCYL                              External             
                   |----  RERROR                                                   
                   |----  ECRTR                                                    
                   |----  AULCYL                              External             
                   |----  HFNDTW                              External             
   
 
3 ECTREA
         SUBROUTINE ECTREA  (NETP1 , ICL, ITYPC)
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Choose to use track or cluster in electron case
   -    NETP1 : Track #
   -    ICL   : Cluster #
   -    ITYPC : =1 electron
   -            =11 electron from track
   -
   -     Author  : M.N. Minard                 04/01/91
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   ECST                                                                            
        |---- ECTREA                                                               
                   |----  NAMIND                              External             
                   |----  SQRT                                External             
                   |----  ABS                                 External             
                   |----  VZERO                               External             
   
 
3 ECXMOD
         INTEGER FUNCTION ECXMOD ( IWORD )
  ------------------------------------------------------------------------------
    CKEY E_SET EHPA ECAL MODULE
  ------------------------------------------------------------------------------
   Decode the ehpa data word and convert into a module number
   
        Lee F. Thompson. 29th April 1994.
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   EAUTOP                                                                          
        |---- ECXMOD                                                               
                   |----  IBITS                               External             
   
 
3 EDISAL
         SUBROUTINE EDISAL(IDTPC)
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   
   Compute distance for alignement (sum,x,y,z) in ecal
    Create histograms of distance for each module(36)
     and may create auxiliary storage file to modify
     alignement correction matrix.
    Author : JP Albanese
   
   
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   ECALIG                                                                          
        |---- EDISAL                                                               
                   |----  SQRT                                External             
                   |----  XYZBEA                              External             
                   |----  ABS                                 External             
                   |----  HFILL                               External             
   
 
3 EDLIST
          SUBROUTINE EDLIST ( JVAL,IVAL,KVAL,ID0,IOK)
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Check same storey not twice in dead list
        Author M.N Minard          12.04.90
        Input : Jval Theta row index
                Ival Phi row index
                Kval Stack number
                ID0  # elements in EDST
        Output: IOK = 0 Non existing storey
                    = 1 Existing storey
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   EGETDS                                                                          
        |---- EDLIST                                                               
                   |----  NAMIND                              External             
   
 
3 EFAXE
          SUBROUTINE EFAXE (IERR)
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   For the different fits calculates the total energy
      and performs the jet algorithms
   -
   -   Authors : M.N. Minard , M. Pepe       10/05/89
   -   Modified: M.N  Minard                 04/01/91
   -           : M.N Minard                  28/02/91
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   EMSKEV                                                                          
        |---- EFAXE                                                                
                   |----  VZERO                               External             
                   |----  NLINK                               External             
                   |----  ESFIL                                                    
                   |----  ESVETO                                                   
                   |----  EFOLMK                                                   
                   |----  ALTHRU                              External             
                   |----  AJMMCL                                                   
                   |----  AUBOS                               External             
                   |----  HFILL                               External             
                   |----  VRECNF                              External             
                   |----  SQRT                                External             
                   |----  VDOTN                               External             
                   |----  ACOS                                External             
                   |----  ABS                                 External             
                   |----  FLOAT                               External             
                   |----  RERROR                                                   
   
 
3 EFBOOK
         SUBROUTINE EFBOOK
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Booking of histograms for mask analysis
   -
   -    Authors : M.N. Minard , M. Pepe       26/02/89
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   RBKHIS                                                                          
        |---- EFBOOK                                                               
                   |----  HBOOK1                              External             
                   |----  HBOOK2                              External             
   
 
3 EFERRR
         SUBROUTINE EFERRR (NAUTO)
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Filter errr bank from on-line
       Bank input ERRR
       Bank output ERRF
                          AUTHOR M.N.MINARD 14-3-90
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   EPREDA                                                                          
        |---- EFERRR                                                               
                   |----  NDROP                               External             
                   |----  NAMIND                              External             
                   |----  AUBOS                               External             
                   |----  BLIST                               External             
                   |----  RERROR                                                   
                   |----  MODROC                                                   
                   |----  UCOPY                               External             
                   |----  AUBPRS                              External             
   
 
3 EFICLP
         SUBROUTINE EFICLP
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   
   To compute cluster parameters as defined in 'eclu'
            INPUT:'ESDA','ECLU'
            OUPUT:'ECLU'(MODIFIED)
              COMPUTE E,R,THETA,FI
              FOR CLUSTER AND PER LEVEL
   
   
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   ECFCLU                                                                          
        |---- EFICLP                                                               
                   |----  VZERO                               External             
                   |----  ESRBC                               External             
                   |----  SQRT                                External             
                   |----  ATAN2                               External             
   
 
3 EFICV
         SUBROUTINE EFICV(IER)
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   
   Find creation vertex
   
   
     AUTHOR   : A. BONISSENT  861128
     MODIFIED : DENIS COURVOISIER  890418
   
   
     BANKS :
       INPUT   : KINE,FKIN,PART,ETP1
       OUTPUT  : ETP1
       CREATED : ETP1
   
       INPUT  : NONE
       OUTPUT : NONE
   
      GET NUMBER OF TRACKS IN EVENT
      CREATE ETP1 BANK WITH CORRECT SIZE
      DO FOR ALL TRACKS :
         GET KINEMATIC DATA AT CREATION VERTEX
         FIND IF TRACK IS RELEVANT FOR ECAL EXTRAPOLATION
         FILL ONE LINE IN ETP1 BANK
       ENDDO
       ETP1 BANK IS NOW FILLED WITH INFORMATIONS AT VERTEX OF CREATION
   
   
          IER = return code ( 0 if normal)
   
   
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   ECTPC                                                                           
        |---- EFICV                                                                
                   |----  NAMIND                              External             
                   |----  NLINK                               External             
                   |----  AUBOS                               External             
                   |----  BLIST                               External             
                   |----  VZERO                               External             
                   |----  ESLCT                                                    
                   |----  ESLCTF                                                   
                   |----  SQRT                                External             
                   |----  RERROR                                                   
   
 
3 EFIECP
         SUBROUTINE EFIECP
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Computes the position of sensitive planes hit (in x0 unit)
   
     AUTHOR: A. FALVARD
     MODIFIED :
   
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   EINIRU                                                                          
        |---- EFIECP                                                               
                   |----  NAMIND                              External             
   
 
3 EFIEIB
         SUBROUTINE EFIEIB(NTR,ICLN)
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Fill eidt bank
       AUTHOR  : D. PALLIN
       MODIFIED:
   
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   EIDENT                                                                          
        |---- EFIEIB.                                                              
   
 
3 EFIJOB
         SUBROUTINE EFIJOB
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Initialize  energyflow  job
   
      Author   :- M.N. Minard
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   RINJOB                                                                          
        |---- EFIJOB                                                               
                   |----  JUNIDB                              External             
                   |----  MDARD                               External             
                   |----  RERROR                                                   
                   |----  EMSKJI                                                   
   
 
3 EFIXI94
         SUBROUTINE EFIXI94
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Drop run header ekls ekpl bank
       M.N Minard                    9-10-94
       M.N Minard              mod  24-03-95
       M.N Minard              mod  10-11-99
           To drop run header bank EDDB at start of 1999
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   EGETDS                                                                          
        |---- EFIXI94                                                              
                   |----  BDROP                               External             
                   |----  AUBOS                               External             
   
 
3 EFLCST
         SUBROUTINE EFLCST
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   
   Get e-fow constants from d-base
     Read EFCA & EHDS banks
   
     Author  :  M.N Minard  900110
   
     BANKS:
       INPUT  : EFCA , EHDS
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   EINIRU                                                                          
        |---- EFLCST                                                               
                   |----  ALGTDB                              External             
                   |----  RERROR                                                   
   
 
3 EFOLMK
         SUBROUTINE EFOLMK  (IFIT ,ESUMW , IER  )
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Built efol bank for e-flow results
       Fill input common to ALTHRU for jet
   -    IFIT Input =1 Calo , 2 =E-Flow
   -    ESUMW Input Wire energy
   -    IER   Output error code =1 no jet to preform
   -                            -1 Jet array too small
   -                            -2 EFOL bank not lifted
   -    Bank created EFOL
   -    Bank used CHRL
   -
   -     Author  : M.N. Minard                 04/01/91
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   EFAXE                                                                           
        |---- EFOLMK                                                               
                   |----  NDROP                               External             
                   |----  AUBOS                               External             
                   |----  BLIST                               External             
                   |----  MOD                                 External             
                   |----  WCAL                                                     
                   |----  UCOPY                               External             
                   |----  NAMIND                              External             
                   |----  EFTIEL                                                   
                   |----  PVFILL                                                   
                   |----  RERROR                                                   
   
 
3 EFPARD
         SUBROUTINE EFPARD
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Read parameters for t0 calculaton from bos cards or data base
     AUTHOR : D. PALLIN             10/10/89
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   EINIRU                                                                          
        |---- EFPARD                                                               
                   |----  MDARD                               External             
                   |----  ALGTDB                              External             
                   |----  NAMIND                              External             
                   |----  RERROR                                                   
   
 
3 EFTIEL
         SUBROUTINE EFTIEL ( ICL , ITR )
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Search electron identified corresponding to cluster
       in E-Flow analysis
   -    ICL Input Ecal cluster
   -    ITR Output Track #
   -
   -     Author  : M.N. Minard                 04/01/91
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   EFOLMK                                                                          
        |---- EFTIEL                                                               
                   |----  NAMIND                              External             
   
 
3 EGACST
         SUBROUTINE EGACST (IER)
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Initialisation banks used in photon estimator normalisation
   
        Author                             M.N Minard 10/02/92
        Modified: F.Ranjard 06/10/92
                  call GTDBBK to get MC or Run banks
   
       Output :  IER     /I    0 : all banks loaded
                               1 : some banks missing
   
       Banks used EF4N , EW1N , EW2N , EL1N , EL2N , EGTE
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   EINIRU                                                                          
        |---- EGACST                                                               
                   |----  NAMIND                              External             
                   |----  ABRUEV                              External             
                   |----  GTSTUP                              External             
                   |----  ALGTDB                              External             
                   |----  JUNIDB                              External             
   
 
3 EGAEST
         SUBROUTINE EGAEST
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Built photon normalised estimator bank
        Author                             M.N Minard 10/02/92
   
      Bank created  EGNE
      Banks used ECLU ECT1 ERL3
      Data base banks used EF4N , EW1N , EW2N , EL1N , EL2N
      call to EF4NOR , EW1NOR , EW2NOR , EL1NOR , EL2NOR
      Call to EBNEUT  CLMOMS (ALEPHLIB)
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
              EGAEST                                                               
                   |----  NAMIND                              External             
                   |----  NDROP                               External             
                   |----  AUBOS                               External             
                   |----  EBNEUT                              External             
                   |----  ENOL12                              External             
                   |----  ENOF4                               External             
                   |----  CLMOMS                              External             
                   |----  ENOW12                              External             
                   |----  AUBPRS                              External             
                   |----  CONTINUERETURNCALLRERROR            External             
   
 
3 EGETDS
         SUBROUTINE EGETDS
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   
   Get dead storey information from the dbase   (eddb bank)
     AND CREATE EDST BANK
   
     AUTHOR  :  C. BENCHOUK 890529
     MODIFIED:  JP ALBANESE 890915
      Modified :- E. Lancon              4-DEC-1990
      Modified :- E. Lancon              7-OCT-1992
        Use GTDBBK common deck to access run header/ daf setup dep. banks
   
     BANKS:
       INPUT  : EDDB , EKLS , EGLO
       OUTPUT : EDST
       CREATED: EDST
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   EINIRU                                                                          
        |---- EGETDS                                                               
                   |----  VZERO                               External             
                   |----  EFIXI94                                                  
                   |----  NAMIND                              External             
                   |----  LNBLNK                              External             
                   |----  ABRUEV                              External             
                   |----  GTSTUP                              External             
                   |----  ALGTDB                              External             
                   |----  JUNIDB                              External             
                   |----  AUBOS                               External             
                   |----  NLINK                               External             
                   |----  ICASWT                                                   
                   |----  IBITS                               External             
                   |----  ECINIT                                                   
                   |----  ECMOD                                                    
                   |----  IDRRAY                              External             
                   |----  EBOXKI                                                   
                   |----  EDLIST                                                   
                   |----  AUBPRS                              External             
   
 
3 EGFCST
         SUBROUTINE EGFCST
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   
   Get correction constant for gas flow, read ecgf bank
   
     Author  :  M.N Minard  910915
   
     BANKS:
       INPUT  : ECGF
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   EINIRU                                                                          
        |---- EGFCST                                                               
                   |----  ALGTDB                              External             
                   |----  RERROR                                                   
   
 
3 EGTTKS
         SUBROUTINE EGTTKS(NTRAK,IER)
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   
   Get access to tracks
   
   
     AUTHOR   : A. BONISSENT  860615
     MODIFIED : A. BONISSENT  861108
   
   
     BANKS :
       INPUT   : ETP1
       OUTPUT  : EFET
       CREATED : EFET
   
        SUBROUTINE EGTTKS (GET TRACKS)
        LINK TO BOS BANK ETP1 (LAST TPC POINT)
        GET NUMBER OF TRACKS
        GET NUMBER OF WORDS PER TRACK
        CREATE BANK EFET FOR ECAL EXIT POINTS OF EXTRAPOLATED TRKS
   
   
          IER = return code ( 0 if normal)
   
   
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   ECLTRK                                                                          
        |---- EGTTKS                                                               
                   |----  AUBOS                               External             
                   |----  BLIST                               External             
                   |----  LBKLIW                              External             
   
 
3 EHCFLO
            SUBROUTINE EHCFLO ( IFLAG , IHSDA , WEIG)
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Give weight to pad energy for energy flow
   -   Authors : M.N. Minard , M. Pepe       10/01/90
   -       IFLAG =  0 Initialisation phase
   -             =  1 look for pad weight
   -       IHSDA =  Hcal storey number to use
   -       WEIG  =  Weigth to apply on Pad energy
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   FLOWFI                                                                          
        |---- EHCFLO                                                               
                   |----  NAMIND                              External             
                   |----  VZERO                               External             
                   |----  UCOPY                               External             
                   |----  IBITS                               External             
   
 
3 EHLIX
         SUBROUTINE EHLIX(X)
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   
   Get next point on helix
   
   
     AUTHOR   : A. BONISSENT  860615
     MODIFIED : A. BONISSENT  861108
   
   
     BANKS :
       INPUT   : NONE
       OUTPUT  : NONE
       CREATED : NONE
   
       SUBROUTINE EHLIX
         X(8) = NEXT POINT ON HELIX X,Y,Z,U,V,W,P,CHARGE
   
   
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   CTRPAR                                                                          
   ECLTRK                                                                          
   ECRTR                                                                           
   EPCALO                                                                          
   EPCHG                                                                           
        |---- EHLIX                                                                
                   |----  SNGL                                External             
   
 
3 EHREG
         SUBROUTINE EHREG(  X , IREG)
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   To create weighted p-vectors for energy-flow calculation
   -
   -   Authors : M.N. Minard , M. Pepe       10/01/90
   -   Input : X       element P-vector
      Output: Ireg    E-Flow region number for hcal
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
              EHREG                                                                
                   |----  NAMIND                              External             
                   |----  SQRT                                External             
                   |----  ATAN2                               External             
   
 
3 EIDEDX
         SUBROUTINE EIDEDX(NTR,REST)
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Get r5 estimator for electron identification
   
     AUTHOR   : D. PALLIN
     MODIFIED : F.Ranjard - 951201
                call TPDHYP('WIRE', instead of TIDHYP
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   EIDENT                                                                          
        |---- EIDEDX                                                               
                   |----  TPDHYP                              External             
   
 
3 EIDENT
         SUBROUTINE EIDENT(ICLN,NTR,IT)
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Main routine  for electron identification
       AUTHOR  : D. PALLIN
      Modified :- E. Lancon             27-SEP-1991
                   Do not do elec_id if track not extrapolable to ecal
       MODIFIED:
   
         JOB FOR R1 R2 R2 R3 R4 R5 ESTIMATORS CALCULATION
             AND HYPOTHESIS
         ICLN: NUMERO CLUSTER ; NTR: NUMERO TRACK TPC ; IT: CLUSTER TRACK
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   ELECID                                                                          
        |---- EIDENT                                                               
                   |----  EIPARD                                                   
                   |----  NAMIND                              External             
                   |----  RERROR                                                   
                   |----  ABS                                 External             
                   |----  COS                                 External             
                   |----  SIN                                 External             
                   |----  SQRT                                External             
                   |----  E4PAL                                                    
                   |----  INT                                 External             
                   |----  E4CLU                               External             
                   |----  E4COSZ                                                   
                   |----  ECLEAK                              External             
                   |----  KSTO                                External             
                   |----  ESTO                                External             
                   |----  XSTO                                External             
                   |----  YSTO                                External             
                   |----  ZSTO                                External             
                   |----  EIDEDX                                                   
                   |----  R5ESTI                              External             
                   |----  R3ESTI                              External             
                   |----  EIEFFL                                                   
                   |----  R4ESTI                              External             
                   |----  EFIEIB                                                   
                   |----  JHISRF                              External             
                   |----  HFILL                               External             
   
 
3 EIEFFL
         SUBROUTINE EIEFFL(IFIDU)
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Job for  estimators calculation
   
       AUTHOR  : D. PALLIN
       MODIFIED:
   
         CHECK QUALITY OF ESTIMATORS
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   EIDENT                                                                          
        |---- EIEFFL                                                               
                   |----  INT                                 External             
   
 
3 EINHLX
         SUBROUTINE EINHLX(STEP,IFILD,X)
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   
   Initialize helix parameters
   
     AUTHOR   : A. BONISSENT  861108
   
   
     BANKS :
       INPUT   : NONE
       OUTPUT  : NONE
       CREATED : NONE
   
   
       INPUT :
                  STEP  = STEP SIZE
                  X(8)  = LAST TPC POINT (LATER,CURRENT POINT)
   
       OUTPUT : NONE
   
   
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   CTRPAR                                                                          
   ECLTRK                                                                          
   ECRTR                                                                           
        |---- EINHLX                                                               
                   |----  DBLE                                External             
                   |----  FLOAT                               External             
                   |----  DSQRT                               External             
                   |----  ABS                                 External             
                   |----  SNGL                                External             
                   |----  DSIN                                External             
   
 
3 EINIJO
         SUBROUTINE EINIJO
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Initialisation of ecal job
   
        SET ECAL BANK INDICES:ESDA,ECLU,ECT1/2/3,ETP1/2
                      FORMATS
        INITIALIZE GEOMETRY
   
    Called by: RINJOB
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   RINJOB                                                                          
        |---- EINIJO                                                               
                   |----  ECRNDX                                                   
                   |----  ECINRV                                                   
                   |----  EBINIT                              External             
                   |----  RERROR                                                   
   
 
3 EINIRL
         SUBROUTINE EINIRL(IER)
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   
   Initialize etp rel banks
   
     AUTHOR   : A. BONISSENT  860615
     MODIFIED : A. BONISSENT  861108
   
   
     BANKS :
       INPUT   : ETP1,ECLU
       OUTPUT  : NONE
       CREATED : ECT1,ETC2,ERL3
   
    ECT1 IS FOR CLUSTERS TOWARDS TRACKS (CLTR)
    ETC2 IS FOR TRACKS TOWARDS CLUSTERS (TRCL)
    ERL3 IS FOR THE RELATIONS BETWEEN CLUSTERS AND TRACKS (RLCT)
            NO INPUT
             ECT1  : FROM CLUSTERS TO TRACKS (CLTR)
                     POINTER TO FIRST RELATION FOR EACH CLUSTER
             ETC2  : FROM TRACKS TO CLUSTERS (TRCL)
                     POINTER TO FIRST RELATION FAR EACH TRACK
             ERL3  : RELATIONS BETWEEN CLUSTERS AND TRACKS (RLCT)
                     CREATED WITH MAX SIZE : NCLU*NTRAKS RELATIONS
   
   
          IER = return code ( 0 if normal)
   
    ********************************************************************
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   ECLTRK                                                                          
        |---- EINIRL                                                               
                   |----  AUBOS                               External             
                   |----  BLIST                               External             
                   |----  RERROR                                                   
                   |----  NDROP                               External             
   
 
3 EINIRU
         SUBROUTINE EINIRU
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   
   Initialise run for ecal
   
     AUTHOR   : A. BONISSENT  871023
      Modified :- E. Lancon             17-MAR-1992
           add call to EGACST
      Modified :- M.Cattaneo            06-NOV-1997
           Remove 'Temporary' (since before 1993...) call to EFIX
   
   
     BANKS :
       INPUT   : NONE
       OUTPUT  : NONE
       CREATED : NONE
   
   
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   RINRUN                                                                          
        |---- EINIRU                                                               
                   |----  ECBLDA                                                   
                   |----  ERDDAF                              External             
                   |----  ECDFRD                              External             
                   |----  ECPASR                                                   
                   |----  ECLGEO                                                   
                   |----  EFIECP                                                   
                   |----  ESCDEF                                                   
                   |----  EGETDS                                                   
                   |----  NAMIND                              External             
                   |----  ALGTDB                              External             
                   |----  RERROR                                                   
                   |----  EGFCST                                                   
                   |----  EFLCST                                                   
                   |----  EGACST                                                   
                   |----  ERCUPI                                                   
                   |----  ABRUEV                              External             
                   |----  GTSTUP                              External             
                   |----  JUNIDB                              External             
                   |----  MDARD                               External             
                   |----  ECHEDC                                                   
                   |----  EFPARD                                                   
   
 
3 EINITK
         SUBROUTINE EINITK(IDTPC,IFLAG,X)
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   
   Init. trk
   
   
     AUTHOR   : A. BONISSENT  860615
     MODIFIED : A. BONISSENT  861108
   
   
     BANKS :
       INPUT   : ETP1,EFET (TPC TRACKS)
       OUTPUT  : NONE
       CREATED : NONE
   
       SUBROUTINE EINITK (INITIALIZE A TRACK
   
       INPUT :
                  IDTPC = TRACK NUMBER
                  IFLAG = 1 : TRACK SHOULD BE EXTRAPOLATED
                        = 0 : -----------NOT BE -----------
   
   
       OUTPUT :    X(8)  = LAST TPC POINT
   
   
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   CTRPAR                                                                          
   ECLTRK                                                                          
   ECRTR                                                                           
        |---- EINITK.                                                              
   
 
3 EINSRL
         SUBROUTINE EINSRL(IDTPC,ICCL)
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   
   Inserts a trk-clus relation
   
   
     AUTHOR   : A. BONISSENT  860615
     MODIFIED : A. BONISSENT  861108
   
   
     BANKS :
       INPUT   : NONE
       OUTPUT  : ECT1,ETC2,ERL3
       CREATED : NONE
   
     ECT1  = POINTER TO CLUSTERS RELATION BANK (CLTR)
           1 WORD PER CLUSTER : ADDRESS OF FIRST
             RELATION FOR THIS CLUSTER)
     ETC2  = POINTER TO TRACK RELATION BANK (TRCL)
           1 WORD PER TRACK : ADDRESS OF FIRST RELATION FOR THIS TRACK)
     ERL3  = POINTER TO RELATION BANK BETWEEN TRACKS AND CLUSTERS (RLCT)
           3 WORDS PER RELATION :
             WORD 1 = TRACK NUMBER
             WORD 2 = CLUSTER NUMBER
             WORD 3 = POINTER TO NEXT RELATION FOR CLUSTER (0 IF LAST)
             NO POINTER TO NEXT TRACK (SEQUENTIAL ORDER IN TRACKS)
   
   
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   ENIGHB                                                                          
        |---- EINSRL.                                                              
   
 
3 EIPARD
         SUBROUTINE EIPARD
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Read parameters for electron-id from bos cards or data base
     AUTHOR : A. FALVARD             26/07/89
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   EIDENT                                                                          
        |---- EIPARD                                                               
                   |----  NAMIND                              External             
                   |----  MDARD                               External             
   
 
3 EITHR
         INTEGER FUNCTION EITHR(IT,IP,IS)
  ------------------------------------------------------------------------------
    CKEY ECAL THRESHOLD   / JULIA  USER
  ------------------------------------------------------------------------------
   Return on-line roc threshold in kev for tower iteta,iphi,istack
     B.Bloch-Devaux January 90
    Structure : FUNCTION
               External references: EBTZTH  ( ALEPHLIB)
               Comdecks references:none
    Input : IT  / Integer  = theta index of tower
            IP  / Integer  = phi   index of tower
            IS  / Integer  = stack index of tower
    Output : EITHR / Integer  = threshold value in Kev
    Banks  : none
    Action : returns on-line ROC threshold used for this  storey
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   ERCUPR                                                                          
   ESWPST                                                                          
        |---- EITHR                                                                
                   |----  EBTZTH                              External             
                   |----  NINT                                External             
   
 
3 EKNEWB
         SUBROUTINE EKNEWB (IBOX)
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Kill ecal  barrel box
                   Author M.N Minard
                          5/06/90
       Input IBOX : Box number
       Bank created EDKB
       Bank used EBOK
       Called from EBOXKI
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   EBOXKI                                                                          
        |---- EKNEWB                                                               
                   |----  MOD                                 External             
                   |----  NAMIND                              External             
                   |----  AUBOS                               External             
   
 
3 EKNEWE
         SUBROUTINE EKNEWE (IBOX,ISC)
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Kill ecal  endcap box
                   Author M.N Minard
                          5/06/90
       Input IBOX : Box number
             ISC  : Subcomponent #
       Bank created EDKB
       Bank used EBOK
       Called from EBOXKI
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   EBOXKI                                                                          
        |---- EKNEWE                                                               
                   |----  UCOPY                               External             
                   |----  NAMIND                              External             
                   |----  AUBOS                               External             
   
 
3 ELECID
         SUBROUTINE ELECID
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Steering routine for electron identification
   
     AUTHOR   : D. PALLIN
     MODIFIED :
   
     BANKS :
       INPUT   : ECLU,ECT1,ERL3
       OUTPUT  : EIDT
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   CALREC                                                                          
        |---- ELECID                                                               
                   |----  NAMIND                              External             
                   |----  ECREIB                                                   
                   |----  ECRE4D                                                   
                   |----  ECHARG                                                   
                   |----  F                                   External             
                   |----  ESLAS                                                    
                   |----  EIDENT                                                   
                   |----  ECLEIB                                                   
   
 
3 ELONGI
         SUBROUTINE ELONGI(ICLN,ITR,IT,R3ES,R4ES)
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Steering routine to compute the r3 and r4 electron identificators
   
      AUTHOR: A. FALVARD
      MODIFIED:
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
              ELONGI                                                               
                   |----  ECTOPO                                                   
                   |----  ECLOPE                                                   
                   |----  ECMOPL                                                   
                   |----  ECENER                                                   
                   |----  ECPRLO                                                   
                   |----  ALOG10                              External             
                   |----  ALOG                                External             
                   |----  SQRT                                External             
                   |----  NAMIND                              External             
   
 
3 EMFILL
         SUBROUTINE EMFILL(IEMSK,EMIN,DCOST,ITRAC)
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Fills emsk bank with minimum ionizing particle
   -
   -    Authors : M.N. Minard , M. Pepe       26/02/89
   -
   -    Input: IEMSK      track index
   -           EMIN (5)   estimated min ionizing energy per stack
   -           DCOST(3,5) direction cosines of extrapolated track/stack
   -           ITRAC      number & addresses of crossed cells
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   ECST                                                                            
        |---- EMFILL                                                               
                   |----  NAMIND                              External             
                   |----  VZERO                               External             
                   |----  CHAINT                              External             
                   |----  AUBOS                               External             
                   |----  SQRT                                External             
                   |----  ATAN2                               External             
   
 
3 EMSKEI
         SUBROUTINE EMSKEI
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Event initialization
   -
   -    Authors : M.N. Minard , M. Pepe       26/02/89
   -
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   RPREDA                                                                          
        |---- EMSKEI                                                               
                   |----  VZERO                               External             
   
 
3 EMSKEV
         SUBROUTINE EMSKEV
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Steering routine for mask analysis
   -
   -    Authors : M.N. Minard , M. Pepe       26/02/89
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   RECEVT                                                                          
        |---- EMSKEV                                                               
                   |----  ECST                                                     
                   |----  FLOWFI                                                   
                   |----  EFAXE                                                    
   
 
3 EMSKF
         SUBROUTINE EMSKF ( VIN,VSUM )
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Updates content of emsk bank with new energy in mask
   -
   -    Authors : M.N. Minard , M. Pepe       26/02/89
   -
   -    Input : VIN  = E,THE,PHI from EMSK bank
   -            VSUM = new energy in mask (Ex,Ey,Ez components)
   -    Output: VIN  = updated E, THE, PHI
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   ECST                                                                            
   HROAD                                                                           
        |---- EMSKF                                                                
                   |----  COS                                 External             
                   |----  SQRT                                External             
                   |----  SIN                                 External             
                   |----  ATAN2                               External             
   
 
3 EMSKI
         SUBROUTINE EMSKI
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Initializes parameters used in mask algorithm
   -    Authors : M.N. Minard , M. Pepe       26/02/89
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   EMSKJI                                                                          
        |---- EMSKI .                                                              
   
 
3 EMSKJI
         SUBROUTINE EMSKJI
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Job initialization
   -
   -    Authors : M.N. Minard , M. Pepe       26/02/89
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   EFIJOB                                                                          
        |---- EMSKJI                                                               
                   |----  EMSKI                                                    
                   |----  ENFMSK                                                   
                   |----  AINJET                              External             
   
 
3 EMSKMU
         SUBROUTINE EMSKMU( NETP1, EXTRAP, EMIP, IMUON)
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Calculates expected energy lost by muons in ecal and hcal
   -
   -    Authors : M.N. Minard , M. Pepe       26/02/89
   -
   - If muon is identified, calculates energy to be removed (EMIP)
   - in the three ECAL stacks and in HCAL else EMIP = 0
   - Input : NETP1       Track index
   -         EXTRAP      Extrapolation point in the 5 stacks
   - OUTPUT: EMIP(1-5)   Expected energy lost by the muon in the 5 stacks
   -         IMUON  = 1  Muon candidate found
                     0  Not a muon candidate
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   ECST                                                                            
        |---- EMSKMU                                                               
                   |----  NAMIND                              External             
                   |----  VZERO                               External             
                   |----  NLINK                               External             
                   |----  RERROR                                                   
                   |----  SQRT                                External             
                   |----  ATAN2                               External             
                   |----  COS                                 External             
                   |----  SIN                                 External             
                   |----  ABS                                 External             
                   |----  SIGN                                External             
                   |----  ACOS                                External             
                   |----  TAN                                 External             
                   |----  FLOAT                               External             
                   |----  EFNDSC                              External             
                   |----  AMOD                                External             
                   |----  EXP                                 External             
   
 
3 ENFMSK
         SUBROUTINE ENFMSK
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Fills name common ecnmsk
   -    Authors : M.N. Minard , M. Pepe       26/02/89
   -
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   EMSKJI                                                                          
        |---- ENFMSK                                                               
                   |----  NAMIND                              External             
   
 
3 ENIGHB
         SUBROUTINE ENIGHB(NPT,IROSE,IDTPC)
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   
   Find clusters near a storey
   
   
     AUTHOR   : J.P. ALBANESE 860615
     MODIFIED : A. BONISSENT  861108
     MODIFIED : A. BONISSENT  870109 : NEW ENCODING OF THE ROSEVE
   
   
     BANKS :
       INPUT   : NONE
       OUTPUT  : NONE
       CREATED : NONE
   
             ENIGHB
   
    TO TEST CONTENT OF A STOREY IN THE ARRAY MAP AND
    TO FIND THE NEIGBOUR STOREY OF A GIVEN ONE (NPT,IROSE)
         ACTION>>>
     USE CLUSTERING ALGORITHM (RECURSIVE SEARCH) BUT STOP AT FIRST LEVEL
      OF TREE SCANNING
    EACH CLUSTER FOUND, CALL EINSRL TO CREATE RELATION WITH TRACK
   
         INPUT : NPT   = STOREY ADDRESS IN ARRAY,
                 IROSE = LOCAL GEOMETRY INDEX,
                 IDTPC = TRACK NUMBER
   
         OUTPUT : NONE
   
   
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   ECLTRK                                                                          
        |---- ENIGHB                                                               
                   |----  EINSRL                                                   
   
 
3 ENOISE
         SUBROUTINE ENOISE
  ------------------------------------------------------------------------------
    CKEY ECAL CLEAN / JULIA USER
  ------------------------------------------------------------------------------
   Monitor subroutine to identify noisy or shifted channels
          B. Bloch    September 89
    Structure : SUBROUTINE
             External references:WBANK,WDROP(BOS77)
                                 UCOPY (CERNLIB)
             Comdecks references:BCS,BMACRO
   - Input  : none
   - Output : none
   - Banks  : input  - JDETDI (NEV) work banks
              output - JNWORK       work bank with all ETDI banks ,
                                    dropped at the end
                     - JFWORK       work bank of means and sigmas (7 col)
                                    IAD(teta,phi),Means(1:3),Sigmas(1:3)
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   EPADCL                                                                          
        |---- ENOISE                                                               
                   |----  WBANK                               External             
                   |----  UCOPY                               External             
                   |----  SORTIQ                              External             
                   |----  WDROP                               External             
                   |----  SQRT                                External             
                   |----  CALLWDROP                           External             
   
 
3 ENPROX
         SUBROUTINE ENPROX(ICL,VEXTR,IGOO)
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Determines whether cluster is in road
   -
   -     Authors : M.N. Minard , M. Pepe       26/02/89
   -
      Input
        ICL : Cluster number
        VEXTR (1->3) : Extrapolation coordinates in stack 2 of Ecal
      Output
        IGOO : 0  Cluster ICL  not in track road
               1  Cluster in track road
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   ECST                                                                            
        |---- ENPROX                                                               
                   |----  COS                                 External             
                   |----  SIN                                 External             
                   |----  VDOTN                               External             
                   |----  ACOS                                External             
                   |----  SQRT                                External             
   
 
3 ENSTAT
         SUBROUTINE ENSTAT(IAD,IFL,IMEA)
  ------------------------------------------------------------------------------
    CKEY ECAL CLEAN / JULIA USER
  ------------------------------------------------------------------------------
   Returns noise status of tower address iad
          B. Bloch    January 90
    Structure : SUBROUTINE
             External references:LOCTAB    (ALEPHLIB)
             Comdecks references:BCS,BMACRO
   - Input  : IAD    = tower address ( theta,phi packed as in ETDI)
   - Output : IFL(3) = Stack Status flag : 0    ok
                                           1   noisy ,to be reset
                                           2   offset ,to be shifted
              IMEA(3)= Offset value  for each stack if needed (Kev)
   - Banks  : input  - JFWORK       work bank of means and sigmas
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   EPADCL                                                                          
        |---- ENSTAT                                                               
                   |----  LOCTAB                              External             
                   |----  NINT                                External             
                   |----  ABS                                 External             
   
 
3 EPADCL
         SUBROUTINE EPADCL
  ------------------------------------------------------------------------------
    CKEY ECAL CLEAN  / JULIA   USER
  ------------------------------------------------------------------------------
   Cleans etdi bank using information from background lcal triggers
    B. Bloch -Devaux  December ,1989
    Structure : SUBROUTINE
             External references:NAMIND,WBANK,BKTOW,BKFRW,WDROP(BOS77)
                                 UCOPY,VZERO (CERNLIB)
                                 EMDTOW      (ALEPHLIB)
                                 RTRIGF,ENOISE,EITHR,ENSTAT(This Library)
             Comdecks references:BCS,BMACRO,ECCAJJ,RCURNT
    Input : none
    Output : none
    Banks  : input  - ETDI
             output - JDETDI(10) work bank for ETDI from LCA triggers
                      JNETDI     (work bank dropped at the end)
                      ETDI after clean up and correction for absolute
                           calibration from ECCA bank
    Action : builds list of noisy or shifted storeys from LCAL triggers
             and update ETDI bank accordingly
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   EPREDA                                                                          
   ESLOWC                                                                          
        |---- EPADCL                                                               
                   |----  RQBUNC                              External             
                   |----  VZERO                               External             
                   |----  NAMIND                              External             
                   |----  NLINK                               External             
                   |----  BKTOW                               External             
                   |----  RTRIGF                                                   
                   |----  WDROP                               External             
                   |----  WBANK                               External             
                   |----  ENOISE                                                   
                   |----  IBITS                               External             
                   |----  RERROR                                                   
                   |----  EMDTOW                              External             
                   |----  ENSTAT                                                   
                   |----  NINT                                External             
                   |----  UCOPY                               External             
                   |----  BKFRW                               External             
   
 
3 EPATRN
         SUBROUTINE EPATRN(IFRF,I1,I2,I3,I4,I5,I6)
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Give ecal pattern for frid bank
    AUTHOR : D. PALLIN
    INPUT :  IFRF INDEX OF TRACK IN FRFT BANK
    OUTPUT:  I1-I3   = BIT PATTERN FOR STACK1-3. =1 IF HIT
             I4-I6   = BIT PATTERN FOR STACK1-3 DEAD CHANNELS. =0 IF DEAD
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   FCFRID                                                                          
        |---- EPATRN                                                               
                   |----  NAMIND                              External             
   
 
3 EPCALO
         SUBROUTINE EPCALO
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   
   Propagate tracks to ecal      entry
   
     AUTHOR   : A. EALET  870224
   
   
     BANKS :
       INPUT   : ETP1
       OUTPUT  : ETP1
       CREATED : NONE
   
   
       INPUT :
                  STEP  = STEP SIZE
                  X(8)  = LAST TPC POINT (LATER,CURRENT POINT)
   
       OUTPUT :
                  X(8)  =ECAL ENTRY POINT
   
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   ECTPC                                                                           
        |---- EPCALO                                                               
                   |----  DBLE                                External             
                   |----  DSQRT                               External             
                   |----  SQRT                                External             
                   |----  SNGL                                External             
                   |----  ABS                                 External             
                   |----  ACOS                                External             
                   |----  SIGN                                External             
                   |----  AMIN1                               External             
                   |----  SIN                                 External             
                   |----  EHLIX                                                    
   
 
3 EPCHG
         SUBROUTINE EPCHG
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   
   Propagate charged tracks
   
   
     AUTHOR   : A. BONISSENT  861128
   
   
     BANKS :
       INPUT   : TPTE,ETP1
       OUTPUT  : ETP1
       CREATED : NONE
   
       INPUT  : NONE
   
       OUTPUT : NONE
     FOR ALL TRACKS :
         FIND LAST TRACK ELEMENT
         INITIALISE HELIX EXTRAPOLATION
         MAKE HELIX EXTRAPOLATION
         FILL  ONE LINE IN ETP1 BANK
   
   
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   ECTPC                                                                           
        |---- EPCHG                                                                
                   |----  NLINK                               External             
                   |----  RERROR                                                   
                   |----  DBLE                                External             
                   |----  DSQRT                               External             
                   |----  DSIN                                External             
                   |----  EHLIX                                                    
                   |----  SNGL                                External             
                   |----  ABS                                 External             
                   |----  SQRT                                External             
   
 
3 EPNEU
         SUBROUTINE EPNEU
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   
   Propagete neutral tracks
   
   
     AUTHOR   : A. BONISSENT  861128
   
   
     BANKS :
       INPUT   : ETP1
       OUTPUT  : ETP1
       CREATED : NONE
   
      DO FOR ALL TRACKS
         IF NEUTRAL TRACK THEN
            GET X,Y,Z,PX,PY,PZ
            COMPUTE INTERSECTION WITH CYLINDER
            REPLACE OLD X,Y,Z BY NEW ONES
         ENDIF
       ENDDO
   
   
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   ECTPC                                                                           
        |---- EPNEU                                                                
                   |----  SIGN                                External             
                   |----  SQRT                                External             
                   |----  AMIN1                               External             
   
 
3 EPREDA
         SUBROUTINE EPREDA
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   
   Prepare ecal data
        INPUT: 'ETDI','ECMC'
        OUPUT: 'ESDA'
        CREATED : 'ESDA'
        FUNCTIONAL DESCRIPTION:
                CLEAN UP LAST EVENT BANKS
                TRANSFORM STOREY BANK ,Insert online corrections
   
   
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   RPREDA                                                                          
        |---- EPREDA                                                               
                   |----  VZERO                               External             
                   |----  ECSW94                                                   
                   |----  ECERAS                                                   
                   |----  EFERRR                                                   
                   |----  ECSW1093                                                 
                   |----  ESCOUN                                                   
                   |----  ERCUPR                                                   
                   |----  ESWPST                                                   
                   |----  EPADCL                                                   
                   |----  ECLAMP                                                   
                   |----  EWIRCL                                                   
                   |----  ECFILS                                                   
                   |----  ETHRES                                                   
                   |----  NAMIND                              External             
                   |----  EAUTOP                                                   
                   |----  ECRUNQ                                                   
                   |----  BLIST                               External             
                   |----  AUBOS                               External             
                   |----  ECGFLW                                                   
                   |----  FLOAT                               External             
                   |----  IBITS                               External             
                   |----  INT                                 External             
                   |----  ECINIT                                                   
                   |----  ECMOD                                                    
                   |----  ECPLM                                                    
                   |----  RERROR                                                   
                   |----  BDROP                               External             
   
 
3 EPROBA
         SUBROUTINE EPROBA(IFRF,IFLAG)
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Give electron hypothesis from ecal analysis
    AUTHOR : D. PALLIN
    INPUT :  IFRF INDEX OF TRACK IN FRFT BANK
    OUTPUT:  IFLAG   =1 IF ELECTRON , 0 IF NOT
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   FCFRID                                                                          
        |---- EPROBA                                                               
                   |----  NAMIND                              External             
   
 
3 EPRSTO
         SUBROUTINE EPRSTO (IER)
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   
   Create bank esto
   
   
     AUTHOR   : A. BONISSENT  870420
   
     IER = RETURN CODE , 0=OK
   
     BANKS :
       INPUT   : ESDA
       OUTPUT  : ESTO
       CREATED : ESTO
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   ECHCGL                                                                          
        |---- EPRSTO                                                               
                   |----  AUBOS                               External             
                   |----  BLIST                               External             
                   |----  ESRCR                               External             
                   |----  CF                                  External             
                   |----  ESRBC                               External             
                   |----  RERROR                                                   
                   |----  NDROP                               External             
   
 
3 EPRSUM
         SUBROUTINE EPRSUM
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Print ecal summary statistics
        for events processed NRUNRS(4)
        Author:  JP.Albanese 01-06-87
   
        called by : RPRSUM
        calls     : none
   
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   RSMJOB                                                                          
        |---- EPRSUM                                                               
                   |----  FLOAT                               External             
                   |----  EVNTESFORMAT                        External             
                   |----  OUR                                 External             
   
 
3 EPRTPC
         SUBROUTINE EPRTPC(IER)
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Prepare tpc trks for ecal extrap.
   
     AUTHOR   : A. BONISSENT  870125
   
   
     BANKS :
       INPUT   : FRFT
       OUTPUT  : ETP1
       CREATED : ETP1
   
    CHANGES HELIX PARAMETRISATION FROM TPC TO ECAL DESCRIPTION
   
     MODIFIED : D.Casper 960605  Use extrapolation from outermost
                                 coordinate, as calculated by UFECAL
                                 and stored in the bank TRIK.  This
                                 feature can be turned off by giving
                                 an ENKF card, in which case the old
                                 values, extrapolating from the origin,
                                 will be used.
                D.Casper 960609  Do not extrapolate incoming tracks of
                                 a kink.
              M.Cattaneo 970716  Comment call to UFITQL (results are
                                 never used!!)
              M.Cattaneo 981014  Protect against divide by zero
   
          IER = return code ( 0 if normal)
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   ECTPC                                                                           
        |---- EPRTPC                                                               
                   |----  NAMIND                              External             
                   |----  AUBOS                               External             
                   |----  TTLOOP                                                   
                   |----  SQRT                                External             
                   |----  UNEWDP                              External             
                   |----  SIGN                                External             
                   |----  ACOS                                External             
                   |----  SIN                                 External             
                   |----  COS                                 External             
                   |----  ABS                                 External             
                   |----  AMIN1                               External             
                   |----  FLOAT                               External             
                   |----  NLINK                               External             
                   |----  UCOPY                               External             
                   |----  RERROR                                                   
                   |----  BLIST                               External             
   
 
3 ERCUPI
         SUBROUTINE ERCUPI(KRUN)
  ------------------------------------------------------------------------------
    CKEY ECAL CLEAN /  JULIA USER
  ------------------------------------------------------------------------------
   Initialisation for bug fix on storeys gains corrected for missing wire
    B.Bloch-Devaux October 1989
    Structure : SUBROUTINE
                External references:NAMIND(BOS77)
                                    ECPAD(This lib )
                Comdecks references:BCS,BMACRO
    Input : KRUN  = Run number
    Output : none
    Banks  : input  -  EWRG
    It builds a table of correction factors for storeys in EC barrel
    from bank EWRG content
    This is valid for run 4001 to 4838 ,otherwise array is set to 1.
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   EINIRU                                                                          
        |---- ERCUPI                                                               
                   |----  NAMIND                              External             
                   |----  ECPAD                                                    
                   |----  IBITS                               External             
   
 
3 ERCUPR
         SUBROUTINE ERCUPR
  ------------------------------------------------------------------------------
    CKEY  ECAL  CLEAN  /  JULIA  USER
  ------------------------------------------------------------------------------
   Correct etdi  energies for bug in gains related to missing wires
                              B.Bloch-Devaux    25/10/89
    Structure : SUBROUTINE
                External references:NAMIND,WBANK,BKFRW,WDROP(BOS77)
                                    UCOPY(CERNLIB)
                                    EITHR (This lib)
                Comdecks references:BCS,BMACRO
    Input : none
    Output : none
    Banks  : input  -  ETDI
             output - JDETDI (work bank dropped at the end)
    Action : removes from ETDI  addresses from storeys below
            threshold after gain correction
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   EPREDA                                                                          
        |---- ERCUPR                                                               
                   |----  NAMIND                              External             
                   |----  EITHR                                                    
                   |----  WBANK                               External             
                   |----  IBITS                               External             
                   |----  FLOAT                               External             
                   |----  IFIX                                External             
                   |----  UCOPY                               External             
                   |----  BKFRW                               External             
                   |----  WDROP                               External             
   
 
3 ERESET
         SUBROUTINE ERESET
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   
   Reset  array of storeys
   
       CLEAR IARRAY(6144)  AND WORK BANK USED FOR CLUSTERING
     AUTHOR   : A. BONISSENT  861108
   
   
     BANKS :
       INPUT   : NONE
       OUTPUT  : NONE
       CREATED : NONE
   
   
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   ECFCLU                                                                          
        |---- ERESET                                                               
                   |----  VZERO                               External             
                   |----  WDROP                               External             
   
 
3 EROAD
         SUBROUTINE EROAD ( NESDA , PMOM , VEXTR , ITRACK , ER )
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Calculates energy inside road in ecal
       Fills temporary working bank ECTE
   -
   -     Authors : M.N. Minard , M. Pepe       26/02/89
   -
   - Input :  NESDA          = Relative address for storey in ESDA bank
   -          PMOM           = Track momemtum measured by TPC
   -          VEXTR (1->3)   = Extrapolated point in stack
   -          ITRACK(1)      = Nb. of storeys crossed by track in stack
   -          ITRACK(2->5)   = Address of storey crossed by track
   - Output   ER (1->3)      = Energy vector to be removed in inner region
   -             (4->6)      =   "      "     "  "    "     " outer "
   -             (7)         = Energy of storey crossed by track
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   ECST                                                                            
        |---- EROAD                                                                
                   |----  VZERO                               External             
                   |----  ESRBC                               External             
                   |----  VDOTN                               External             
                   |----  ABS                                 External             
                   |----  SIGN                                External             
                   |----  ACOS                                External             
                   |----  SIN                                 External             
                   |----  SQRT                                External             
                   |----  NAMIND                              External             
                   |----  RERROR                                                   
                   |----  ECOS                                                     
                   |----  UCOPY                               External             
   
 
3 ESCDEF
         SUBROUTINE ESCDEF
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Ecal small defect correction
   
    AUTHOR : M.N MINARD 30-09-92
   
   
        Contant read from DB
        ECDF , EWKW
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   EINIRU                                                                          
        |---- ESCDEF                                                               
                   |----  NAMIND                              External             
                   |----  ALGTDB                              External             
   
 
3 ESCOUN
         SUBROUTINE ESCOUN(NSTOR,NSMOD)
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Count number of nonzero ecal storeys in esda
     Author:   J.Knobloch    18.9.89
     Output:  NSTOR   Number of nonzero storeys
              NSMOD   Number of non-zero storeys / module
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   EPREDA                                                                          
        |---- ESCOUN                                                               
                   |----  VZERO                               External             
                   |----  IBITS                               External             
                   |----  EMDTOW                              External             
   
 
3 ESFIL
         SUBROUTINE ESFIL  (IERR,EFLOW)
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Calculate energy from ecal wire
   -
   -   Authors : M.N. Minard , M. Pepe       02/10/89
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   EFAXE                                                                           
        |---- ESFIL                                                                
                   |----  NAMIND                              External             
                   |----  MOD                                 External             
                   |----  FLOAT                               External             
   
 
3 ESLAS
         SUBROUTINE ESLAS(ICLC,NTK,IKEPT)
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   
   Select tracks for ecobject association
   
     One track can be associated to several EcClusters;
     we want only one EcObject per track.
   
      Action : select only the first cluster for each track
               This will be the last one in the chain, since
               it starts from the end
   
     AUTHOR   : A. BONISSENT  870819
   
     BANKS :
       INPUT   : ETC2,ERL3
       OUTPUT  : NONE
       CREATED : NONE
   
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   ECFOBJ                                                                          
   ECGMIX                                                                          
   ECHARG                                                                          
   ECRCOB                                                                          
   ELECID                                                                          
        |---- ESLAS .                                                              
   
 
3 ESLCT
         SUBROUTINE ESLCT(XXX,NVERT,KKINE,IFLAG)
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   
   Select tracks
   
   
     AUTHOR   : A. BONISSENT  861128
   
   
     BANKS :
       INPUT   : KINE,VRTX
       OUTPUT  : NONE
       CREATED : NONE
   
       INPUT  : NVERT = NUMBER OF VERTICES ON TRACK
                KKINE = POINTER TO KINE BANK
   
       OUTPUT : XXX(3,2) = COORDINATES OF FIRST AND LAST VERTEX
                IFLAG : SEE BELOW
   
         IF ONLY ONE VERTEX THEN
             IF IT IS IN TPC VOLUME THEN
                IFLAG=1
             ELSE
                IFLAG=0
         ELSE
             IF ALL VERTICES IN TPC VOLUME THEN
                 IFLAG=0
             ELSE
                 IFLAG=1
             ENDIF
         ENDIF
   
   
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   CTKCHG                                                                          
   EFICV                                                                           
        |---- ESLCT                                                                
                   |----  NLINK                               External             
                   |----  SQRT                                External             
                   |----  ABS                                 External             
   
 
3 ESLCTF
         SUBROUTINE ESLCTF (XXX,NOTRAC,IFLAG)
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   
   Select tracks
   
   
     AUTHOR   : ALAIN BONISSENT/DENIS COURVOISIER
     MODIFIED : DENIS COURVOISIER   89/03/24
   
     BANKS :
       INPUT   : FKIN,FVER
       OUTPUT  : NONE
       CREATED : NONE
   
       INPUT  :  NOTRAC= FKIN TRACK NUMBER
   
       OUTPUT : XXX(3,2) = COORDINATES OF FIRST AND LAST VERTEX
                IFLAG : SEE BELOW
   
        IF FIRST VERTEX IN TPC (ECAL-10 CM) AND LAST VERTEX IN ECAL THEN
            IFLAG= 1
        ELSE
            IFLAG= 0
        ENDIF
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   EFICV                                                                           
        |---- ESLCTF                                                               
                   |----  VZERO                               External             
                   |----  NLINK                               External             
                   |----  SQRT                                External             
                   |----  ABS                                 External             
                   |----  RERROR                                                   
   
 
3 ESLOWC
         SUBROUTINE ESLOWC
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Handle slow control for ecal
    CONTROL TEMPORARILY USED FOR ECAL PRESCAN
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   RUNKNO                                                                          
        |---- ESLOWC                                                               
                   |----  NAMIND                              External             
                   |----  EPADCL                                                   
   
 
3 ESTAG
         SUBROUTINE ESTAG (  NERL3 , IGOO)
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Gives number of tracks related to cluster
   -
   -    Authors : M.N. Minard , M. Pepe       26/02/89
   -
   -    Input  : NERL3 1st relation to cluster in ERL3
   -    Output : IGOO = number of tracks related to this cluster
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   ECLTAG                                                                          
        |---- ESTAG                                                                
                   |----  ABS                                 External             
   
 
3 ESVETO
         SUBROUTINE ESVETO ( EWSUM , JERR)
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Veto spark event for e-flow
       Author : M.N.Minard  9-5-90
       Input : EWSUM wire energy
       Output: JERR = 0 not a spark event
                    = 1 spark event detected
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   EFAXE                                                                           
        |---- ESVETO                                                               
                   |----  NAMIND                              External             
                   |----  VZERO                               External             
                   |----  FLOAT                               External             
                   |----  IBITS                               External             
                   |----  EMDTOW                              External             
                   |----  RERROR                                                   
   
 
3 ESWPST
         SUBROUTINE ESWPST
  ------------------------------------------------------------------------------
    CKEY  ECAL  CLEAN  /  JULIA  USER
  ------------------------------------------------------------------------------
   Correct etdi  energies fors swapped stack cables in barrel mod 6
    Valid only for real data ( run # > 2000)
                              B.Bloch-Devaux    5/02/90
    Structure : SUBROUTINE
                External references:NAMIND,WBANK,BKFRW,WDROP(BOS77)
                                    UCOPY,VZERO(CERNLIB)
                                    EITHR (This lib)
                Comdecks references:BCS,BMACRO
    Input : none
    Output : none
    Banks  : input  -  ETDI
             output - JDETDI (work bank dropped at the end)
    Action : swap back stacks which were so and update zero suppression
             in Barrel #6 , for iphi=161 to 176
                            stack 1 : itetha 131 swapped with itheta 133
                                      itheta 132 swapped with itheta 134
                            stack 2 : itheta 123 swapped with itheta 125
                                      itheta 124 swapped with itheta 126
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   EPREDA                                                                          
        |---- ESWPST                                                               
                   |----  NAMIND                              External             
                   |----  EITHR                                                    
                   |----  WBANK                               External             
                   |----  VZERO                               External             
                   |----  IBITS                               External             
                   |----  UCOPY                               External             
                   |----  ISHFT                               External             
                   |----  BKFRW                               External             
                   |----  WDROP                               External             
   
 
3 ETDIFP
         SUBROUTINE ETDIFP
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Recalculate uncorrected raw energy etdi ewhe
   -
   -   Author  : M.N. Minard                 14/07/90
   -
   -   Bank modified ETDI EWHE
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   ECERAS                                                                          
        |---- ETDIFP                                                               
                   |----  RQBUNC                              External             
                   |----  NAMIND                              External             
                   |----  IBITS                               External             
                   |----  EMDTOW                              External             
                   |----  ECSCMD                                                   
                   |----  FLOAT                               External             
   
 
3 ETHRES
         SUBROUTINE ETHRES
  ------------------------------------------------------------------------------
    CKEY ECAL CLEAN  / USER
  ------------------------------------------------------------------------------
   Cleans etdi,ewdi banks if module energy from wires is below threshold
    B. Bloch -Devaux  October 25,1989
    Modified: M.Cattaneo 06/11/1997
       Rename 'LOCAL' common for work bank indices to something more unique
   
    Structure : SUBROUTINE
                External references:NAMIND,WBANK,WDROP,BKFRW(BOS77)
                                    UCOPY(CERNLIB)
                                    EMDTOW(ALEPHLIB)
                Comdecks references:BCS,BMACRO
    Input : none
    Output : none
    Banks  : input  - EWDI, ETDI
                      EWTH (data cards)
             output - JDETDI (work bank dropped at the end)
                    - JDEWDI (work bank dropped at the end)
    Action : removes from ETDI and EWDI addresses in modules below thresh
             except for random triggers ( no pad suppression )
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   EPREDA                                                                          
        |---- ETHRES                                                               
                   |----  NAMIND                              External             
                   |----  REAL                                External             
                   |----  RTRIGF                                                   
                   |----  WBANK                               External             
                   |----  UCOPY                               External             
                   |----  BKFRW                               External             
                   |----  WDROP                               External             
                   |----  IBITS                               External             
                   |----  RERROR                                                   
                   |----  EMDTOW                              External             
   
 
3 ETRDEV
         SUBROUTINE ETRDEV ( ICL , IELEM )
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Test transverse shower developpement
   -     Author  : M.N. Minard  M.Pepe         29/08/89
        Input     ICL  cluster row
        Output    IELEM = 0 , electromagnetic transverse shape
                        = 1 , non electromagnetic shape
        Banks used ECLU , ESDA
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
              ETRDEV                                                               
                   |----  NAMIND                              External             
                   |----  COS                                 External             
                   |----  SIN                                 External             
                   |----  ESRBC                               External             
                   |----  SQRT                                External             
                   |----  VDOTN                               External             
                   |----  ABS                                 External             
                   |----  SIGN                                External             
                   |----  ACOS                                External             
   
 
3 EWDIFP
         SUBROUTINE EWDIFP
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Built ewdi from pot
   -
   -   Author  : M.N. Minard                 14/07/90
   -
   -   Bank created  EWDI
   -   Banks used PEWI ECHE ECMC
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   ECERAS                                                                          
        |---- EWDIFP                                                               
                   |----  RQBUNC                              External             
                   |----  NAMIND                              External             
                   |----  AUBOS                               External             
                   |----  FLOAT                               External             
                   |----  NINT                                External             
                   |----  RERROR                                                   
   
 
3 EWIRCL
         SUBROUTINE EWIRCL
  ------------------------------------------------------------------------------
    CKEY ECAL CLEAN WIRE  / JULIA  USER
  ------------------------------------------------------------------------------
   Cleans ewdi using info on known bugs and apply absolute calibration
    B. Bloch -Devaux  December ,1989
    Structure : SUBROUTINE
               External references:NAMIND,WBANK,BKTOW,BKFRW,WDROP(BOS77)
                                   UCOPY,VZERO (CERNLIB)
                                   WIRJUL            (This Library)
               Comdecks references:BCS,BMACRO,RCURNT,ECCAJJ
    Input : none
    Output : none
    Banks  : input  - EWDI,EWHE,ECCA
             output - JDEWDI (work bank dropped at the end)
                      EWDI and EWHE after clean up and absolute
                          calibration from ECCA bank
    Action : corrects wire energies and pastis infos for known bugs in
             in particular run ranges.
             Apply absolute calibration to wire info (EWDI,EWHE)
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   EPREDA                                                                          
        |---- EWIRCL                                                               
                   |----  NAMIND                              External             
                   |----  RQBUNC                              External             
                   |----  RERROR                                                   
                   |----  BDROP                               External             
                   |----  WIRJUL                                                   
                   |----  NINT                                External             
                   |----  MOD                                 External             
                   |----  UCOPY                               External             
                   |----  VZERO                               External             
   
 
3 EX3IJK
         SUBROUTINE EX3IJK(X,IPH,JTH,ST,RG,IFLAG,SC,MD)
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   If point x in ecal gets iph,jth,st..
       ?                                                         ?
                                         modified 25/03/88 by H.Videau
    the subcomponent SC and module MD containing the point X
    if the point X is in the sensitive region of the module.
    IFLAG.
    the row, column, stack and region of the module containing X
        INPUT       X(3)   point
        OUTPUT      IPH    column number. phi
                    JTH    row number   . theta
                    ST     stack number
                    RG     region number
                    IFLAG    0  point inside ECAL
                             1  in the dead region of the overlap
                             2  in the sensitive region
                             3  in the endcap hole
                             4  outside ECAL
                    SC     subcomponent number
                    MD     module number
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   CCTRMI                                                                          
   ECDIGI                                                                          
   ECTRAP                                                                          
        |---- EX3IJK                                                               
                   |----  EFNDTW                              External             
                   |----  ETZSMD                              External             
                   |----  ECRWRG                              External             
                   |----  RERROR                                                   
   

2 F_

  >>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>
    CKEY 
     1st entry in F_set
     * corr file 309.02
        FCFRID : Set particle probabilities to 0.0 if they are smaller than 1.E-30
                                                                      (M.Cattaneo)
        FLV0DX : Call TPDHYP instead of obsolete TIDHYP (M.Cattaneo)
    
     ! JULIA 305
        FPIDEN : Obsolete, replaced by FCFRID                         (M.Cattaneo)
        FCFRID : Same as FPIDEN, but with option to do bit patterns for
                 tracks only. Reaccess FRFT if garbage collection occurs 
                 when creating FRID                          (D.Casper,M.Cattaneo)
    
     * corr file 304.01
        FITALL,FREFIT:Remove CALL from function references, for Linux. (A.Waananen)
    
     ! JULIA 303
        FITALL : Bug fix: KENKF was always 0 (not initialised)         (D.Casper)
    
     ! JULIA 302 (Tracking upgrade)
        FDETCO : Find DET coord. number for coord. on track            (F.Ranjard)
                 (replaces FITCOR,FTPCOR,FVDCOR,TTGCLR by D.Casper)
        FITALL : Call new Kalman filter
                 Remove filtered coords. from coordinates list         (D.Casper)
                 Call FDETCO,FRMHIT                                    (F.Ranjard)
        FITWRI : Create packed POT bank PFXT from FXTR                 (D.Casper)
        FLNGV0 : New. Select V0 decaying into the TPC volume           (P.Spagnolo)
                 Create high purity YLV0 bank for e.g. DALI            (D.Casper)
        FLV0DX : New. Calculate the dE/dX of track ITK assuming 
                 Proton, Electron and Pion                             (D.Casper)
        FPMOVE : Redef. track params. relative to a new point in space (D.Brown)
                 Use PI,TWOPI from alcons.h                            (F.Ranjard)
        FRMHIT : Remove DET hits contained in LIST from track ITRK     (F.Ranjard)
                 (replaces FRMITH,FRMTPH,FRMVDH,TRMHIT by D.Casper)
        FTPCER : Return without error if TPCO 1 already exists         (D.Casper)
        FTRACK : Don't extrapolate tracks from a kink                  (D.Casper)
                 
     ! JULIA 284
       FITALL : Fix bug which can result in losing association to ECAL cluster for
                track following a curling track in the track list 
                (A.Venturi 10/10/96)
    
     * corr file 281.01
       FITALL : Fix bug which can result in overwriting BOS when an
                ITC track appears which has added a few TPC coordinates. (D.Casper)
    
     ! JULIA 281
       FPIDEN : Bugfix: TPC bits in NDZ start at 10, not 8,
                Remove duplicate call to NAMIND('FRFT')     (MC).
    
     ! JULIA 280
       FPIDEN : call TPDHYP('WIRE', instead of TIDHYP (FLR).
    
     ! JULIA 278
       FITALL, FREFIT : replace references to obsolete UFTTRK by UFTTRA
                  (G. Taylor, Sep 95)
    
  <<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<
     FAWIAN     De/dx analysis of fasgal output
     FCFRID     Fills bank frid containing bit patterns for tracks and calorimeters
     FDETCO     Find det coordinate number for coordinate at radius rco on track itk
     FFIELD     Compute magnetic field at position pos =(x,y,z) in region irgn
     FIDHEA     Fills dhea bank for quantities relative to e-flow
     FIDROT     Rotate vector
     FINIRU     Initialise global track fit stuff
     FITALL     Global fit of vdet, itc and tpc
     FITWRI     Creation of pot banks pfrf pfrt pfxt from julia banks frft frtl fxtr
     FKINK      Find kink in an itc-tpc track
     FKKPAR     Compare the helix parameters of the two halfs of an itc-tpc track
     FLNGV0     Select v0 decaying into the tpc volume
     FLOWEH     Calculate energy of event when e-flow is not performed
     FLOWFI     Steering routine for energy-flow calculation
     FLOWTR     Calculate track energy
     FLV0DX     Calculate the de/dx of track itk assuming proton, electron and pion
     FMUID      Find probability density function for pi,k,mu using mu-chamber.
     FPIDEN     Fills bank frid containing bit patterns for tracks and calorimeters
     FPMOVE     Re-define the track parameters relative to a new point in space.
     FREFIT     Refit existing tracks (for dst-->dst reprocessing in julia)
     FRMHIT     Remove ndel det hits contained in list from track itrk
     FTPCER     Recalculate the tpc coordinate errors for all coordinates
     FTRACK     Extrapolate tpc track through ecal, coil, hcal

3 FAWIAN
         SUBROUTINE FAWIAN
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   De/dx analysis of fasgal output
    - 881215
    TFXS,TGMA,TMTL
    TEXS
    program considers all TGFT (TGMA is parallel) tracks, gets which
    Carlo tracks they are related to in TGMA and TMTL.  Monte Carlo
    related to only one track will be considered further.  Then loop
    TFXS and find if the Monte Carlo tracks relate to an entry in
     If so choose the track with the most number of shared hits.
    an entry in TEXS if there are enough wire samples on the track.
    that the sector number and drift distance in TEXS will be meaningless
    the sector always being one and drift distance always being 0.
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   TPCREC                                                                          
        |---- FAWIAN                                                               
                   |----  NAMIND                              External             
                   |----  ALBOS                               External             
                   |----  INT                                 External             
                   |----  FLOAT                               External             
                   |----  AUBPRS                              External             
   
 
3 FCFRID
         SUBROUTINE FCFRID(IOPT)
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Fills bank frid containing bit patterns for tracks and calorimeters
    and particle ID.
   
    This routine supercedes FPIDEN. It has identical behaviour to FPIDEN
    when called with IOPT = 1
   
    Input: IOPT I*4 Steering option
                     = 2             FRID contains bit patterns for tracks only
                     = anything else Default behaviour
   
      Author of original FPIDEN: Lluis Garrido  (1988)
                Modified: R. Johnson  19-6-90
      Modified :- E. Lancon             26-MAY-1993
           Replace explicit link to FRFT 0 by NAMIND
                 - F.Ranjard              1-DEC-1995
            call TPDHYP('WIRE', instead of TIDHYP
                 - M.Cattaneo            31-MAY-1996
            Bugfix: TPC bits in NDZ start at 10, not 8
            Remove duplicate call to NAMIND('FRFT')
      Modified :- M.Cattaneo, D.Casper   06-NOV-1996
            Add steering option 2, for intermediate use by SECVTX search
            Reaccess FRFT if garbage collection occurs when creating FRID
      Modified :- M.Cattaneo             27-MAY-1999
            Set particle probabilities to 0.0 if they are smaller than 1.E-30
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   FPIDEN                                                                          
   RECEVT                                                                          
        |---- FCFRID                                                               
                   |----  NAMIND                              External             
                   |----  BDROP                               External             
                   |----  AUBOS                               External             
                   |----  NLINK                               External             
                   |----  SBIT1                               External             
                   |----  ABS                                 External             
                   |----  VCKTRK                                                   
                   |----  ITKITC                              External             
                   |----  FLGITC                              External             
                   |----  THTROW                                                   
                   |----  THTFLG                              External             
                   |----  EPATRN                                                   
                   |----  EPROBA                                                   
                   |----  TPDHYP                              External             
                   |----  EXP                                 External             
                   |----  SQRT                                External             
                   |----  FKINK                                                    
                   |----  UFITQL                              External             
   
 
3 FDETCO
         SUBROUTINE FDETCO(DET,RCO,ITK,ICOOR)
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Find det coordinate number for coordinate at radius rco on track itk
   - F.Ranjard from D.Casper - 970218
   - Input  :  DET   / A = detector 'TP','VD', 'IT' or 'TG'
               RCO   / R = radius
               ITK   / I = track #
   - Output :  ICOOR / I = coordinate #
   
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   FITALL                                                                          
   TFITKF                                                                          
        |---- FDETCO                                                               
                   |----  NAMIND                              External             
                   |----  RERROR                                                   
                   |----  ABS                                 External             
   
 
3 FFIELD
         SUBROUTINE FFIELD(POS,IRGN,B)
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Compute magnetic field at position pos =(x,y,z) in region irgn
    field components are returned in B(3)
   -  Author : D. DECAMP ,  may 87
         modified may 1988 to introduce better parametrisation
         modified july 89 for use Julia mag field FIELRC - G. Capon
   -  Structure : SUBROUTINE
                  User Entry Name : FFIELD
                  External References: none
                  Comdecks referenced : none
   -  Usage   : CALL FFIELD(POS,IRGN,B)
   -  Input   : POS(1-3)=x , y , z of spatial position
                IRGN   = region # ( in the range 1 to 11) as defined
                         by Jack Steinberger ( see aleph 87-65 )
   -  Output  : B(1-3) = Bx,By,Bz in KGauss at this position
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   HTRACK                                                                          
        |---- FFIELD                                                               
                   |----  SQRT                                External             
                   |----  ABS                                 External             
                   |----  MAX                                 External             
                   |----  SIGN                                External             
   
 
3 FIDHEA
         SUBROUTINE FIDHEA
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Fills dhea bank for quantities relative to e-flow
       Authors: M.N.Minard M.Pepe        12/05/89
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   RDEFMI                                                                          
        |---- FIDHEA                                                               
                   |----  NAMIND                              External             
                   |----  AUBOS                               External             
                   |----  BLIST                               External             
                   |----  FLOWTR                                                   
                   |----  FLOWEH                                                   
                   |----  UCOPY                               External             
                   |----  VRECNF                              External             
                   |----  ACOS                                External             
                   |----  SQRT                                External             
                   |----  ATAN2                               External             
                   |----  RERROR                                                   
                   |----  FIDROT                                                   
   
 
3 FIDROT
         SUBROUTINE FIDROT(TVEC , THE , PHI )
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Rotate vector
             TVEC: Vector to rotate
             THE : Teta angle of rotation
             PHI : Phi angle of rotation
       Author M.N.Minard
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   FIDHEA                                                                          
        |---- FIDROT                                                               
                   |----  COS                                 External             
                   |----  SIN                                 External             
   
 
3 FINIRU
         SUBROUTINE FINIRU
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Initialise global track fit stuff
     Author         L. Garrido    10-may-1988
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   RINRUN                                                                          
        |---- FINIRU                                                               
                   |----  AUBOS                               External             
   
 
3 FITALL
         SUBROUTINE FITALL(NROUT,LKAL)
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Global fit of vdet, itc and tpc
    Input:   NROUT     /I       NR of the output FRFT bank
                                0= ITC + TPC fit
                                1= ITC + TPC + VDET
             LKAL      /L       .TRUE. to use KALMAN filter
     Author         L. Garrido    10-may-1988
     Modified       R. Johnson    12-dec-1989 to use KALMAN filter
     Modified       R. Johnson    21-Jan-1991 to add NROUT and LKAL
                                  arguments
                    D. Casper     04-Dec-1995 to remove filtered coords
                                  from coordinate lists.
                    F.Ranjard     19-Feb-1997 to call FDETCO,FRMHIT
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   RECEVT                                                                          
        |---- FITALL                                                               
                   |----  NAMIND                              External             
                   |----  NDROP                               External             
                   |----  NLINK                               External             
                   |----  AUBOS                               External             
                   |----  UCOPY                               External             
                   |----  VZERO                               External             
                   |----  RERROR                                                   
                   |----  UFECAL                              External             
                   |----  BDROP                               External             
                   |----  UFDALI                              External             
                   |----  FDETCO                                                   
                   |----  SNGL                                External             
                   |----  FRMHIT                                                   
                   |----  UFITMS                                                   
                   |----  BLIST                               External             
                   |----  AUBPRS                              External             
                   |----  IABS                                External             
   
 
3 FITWRI
         SUBROUTINE FITWRI
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Creation of pot banks pfrf pfrt pfxt from julia banks frft frtl fxtr
     Author         L. Garrido    10-may-1988
     Modified       R. Johnson    25-oct-1990
     Modified       R. Johnson    21-jan-1991 to handle more than one
                                  FRFT bank (with different NR)
     Modified       R. Johnson    06-aug-1991 to call FPKCM
     Modified       D. Casper     01-dec-1995 pack FXTR -> PFXT
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   RDEFPO                                                                          
        |---- FITWRI                                                               
                   |----  NAMIND                              External             
                   |----  BDROP                               External             
                   |----  RERROR                                                   
                   |----  AUBOS                               External             
                   |----  NLINK                               External             
                   |----  IF                                  External             
                   |----  UCOPY                               External             
                   |----  FPKCM                               External             
                   |----  INT                                 External             
                   |----  BLIST                               External             
                   |----  AUBPRS                              External             
   
 
3 FKINK
         SUBROUTINE FKINK(ITRCK,PROPA,IFAIL)
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Find kink in an itc-tpc track
   
       AUTHOR        :- GEORG STIMPFL 88/8/08
   
       =  =  =  =  =  =  =  =  =  =  =  =  =  =  =  =  =  =  =  =  =  =
   
       INPUT  : ITRCK = track number in FRFT bank
   
       OUTPUT : PROPA = Probability that the parameters of the two
                        track halves are the same
                        (i.e. probability to have no kink)
                IFAIL = error flag
                        0 ... everything okay
                        1 ... missing input banks
                        2 ... number of coordinates outside limits
   
       Requires at least 10 coordinates (ITC & TPC)
   
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   FCFRID                                                                          
        |---- FKINK                                                                
                   |----  NAMIND                              External             
                   |----  FKKPAR                                                   
   
 
3 FKKPAR
         SUBROUTINE FKKPAR(NPTIT,NPTTP,LISTI,LISTT,PROCH,PROPA,IFAIL)
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   -----************************************************************-----
   Compare the helix parameters of the two halfs of an itc-tpc track
   
       AUTHOR        :- GEORG STIMPFL 88/8/08
   
       =  =  =  =  =  =  =  =  =  =  =  =  =  =  =  =  =  =  =  =  =  =
   
       INPUT  : NPTIT = number of ITC coordinates
                NPTTP = number of TPC coordinates
                LISTI = list of ITC coordinates
                LISTT = list of TPC coordinates
   
       OUTPUT : PROCH = probability to have no kink using chi**2 test
                PROPA = probability to have no kink using parameter test
                IFAIL = error flag (=0 if everything was okay)
   
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   FKINK                                                                           
        |---- FKKPAR                                                               
                   |----  UFITMS                                                   
                   |----  PROB                                External             
                   |----  UNEWDP                              External             
                   |----  SMINV                               External             
                   |----  SMAV                                External             
   
 
3 FLNGV0
         SUBROUTINE FLNGV0
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Select v0 decaying into the tpc volume
     Author P.Spagnolo 2/5/95
         DESCRIPTION
         ============
    This package calls YMFV0V and selects the long V0's decaying into
    the TPC volume. As output a flag in bank FXTR is given, in order to
    separate long and short V0's and avoid the wrong association of VDET
    hits.
    To use this package:
      a) data base must be opened
      b) frft,frtl,pyer,eveh must be present ( make unpacking
         tp,it,fi )
      c) yv1c bank (that contains cuts for v0 selection)
         must be present on data base or given by data cards
         if you want change the cuts for v0 analysis.
      d) fvcl,ficl,ftcl,vdco,itco,tpco must be present
         only if you check the number of coordinates
         before the reconstructed vertex
         ( make unpacking tp,it,fi)
         To understand cuts look the ddl of yv1c bank
         (-> sbank yv1c)
       Beware that the different cuts used in different period
       of Aleph data taking (89-90 91-92 93...) are sumarized
       by the different NR of the yv1c bank. So on the data base
       the yv1c is present with 3 different value for NR
       Modified by D.Casper for Julia 302 to create a YLV0 bank
       containing high-purity V0 candidates for DALI display or
       other offline use.
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   RVDPRE                                                                          
        |---- FLNGV0                                                               
                   |----  NAMIND                              External             
                   |----  BDROP                               External             
                   |----  YMFV0V                              External             
                   |----  RERROR                                                   
                   |----  AUBOS                               External             
                   |----  BLIST                               External             
                   |----  SQRT                                External             
                   |----  ABS                                 External             
                   |----  XMLA                                External             
                   |----  XMAL                                External             
                   |----  XMGA                                External             
                   |----  XMK0                                External             
                   |----  YCHIV2                              External             
                   |----  FPMOVE                                                   
                   |----  FLV0DX                                                   
                   |----  UCOPY                               External             
                   |----  AUBPRS                              External             
   
 
3 FLOWEH
         SUBROUTINE FLOWEH (EFLOW)
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Calculate energy of event when e-flow is not performed
   -
   -   Authors : M.N. Minard , M. Pepe       15/09/89
   -
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   FIDHEA                                                                          
        |---- FLOWEH                                                               
                   |----  NAMIND                              External             
                   |----  VZERO                               External             
                   |----  MOD                                 External             
                   |----  FLOAT                               External             
   
 
3 FLOWFI
         SUBROUTINE FLOWFI(IERR)
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Steering routine for energy-flow calculation
   -
   -   Authors : M.N. Minard , M. Pepe       10/05/89
   -   Modified: M.N  Minard                 04/01/91
   -
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   EMSKEV                                                                          
        |---- FLOWFI                                                               
                   |----  NAMIND                              External             
                   |----  VZERO                               External             
                   |----  ECHTAG                                                   
                   |----  MOD                                 External             
                   |----  SIGN                                External             
                   |----  COS                                 External             
                   |----  SIN                                 External             
                   |----  SQRT                                External             
                   |----  ECSUPP                                                   
                   |----  ESRBC                               External             
                   |----  EHCFLO                                                   
                   |----  HSRCR                               External             
                   |----  FLOAT                               External             
   
 
3 FLOWTR
         SUBROUTINE FLOWTR(XTRACK)
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Calculate track energy
   -
   -   Authors : M.N. Minard , M. Pepe       15/09/89
   -
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   FIDHEA                                                                          
        |---- FLOWTR                                                               
                   |----  NAMIND                              External             
                   |----  ECHTAG                                                   
                   |----  SIGN                                External             
                   |----  COS                                 External             
                   |----  SIN                                 External             
                   |----  SQRT                                External             
   
 
3 FLV0DX
         SUBROUTINE FLV0DX(ITK,QCHARGE,BFIELD,CHI)
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Calculate the de/dx of track itk assuming proton, electron and pion
       ITK    : Track number
       QCHARGE: charge of ITK track
       BFIELD : magnetic field in the TPC
       CHI(3) : dE/dX pull of ITK assuming Proton, Electron, Pion
       Modified:  M.Cattaneo 30-JUL-1999 Call TPDHYP instead of obsolete TIDHYP
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   FLNGV0                                                                          
        |---- FLV0DX                                                               
                   |----  TPDHYP                              External             
   
 
3 FMUID
         SUBROUTINE FMUID(ITK,PRPI,PRK,PRMU,IFLAG)
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Find probability density function for pi,k,mu using mu-chamber.
   
      Author   :- John Hilgart          13-FEB-1989
   
      Inputs: ITK track no. in FRFT
   
               PDF :== "probability density function"
      Outputs: PRPI  PDF for pi hypothesis
               PRK   PDF for kaon hypothesis
               PRMU  PDF for mu hypothesis
               IFLAG = 0 if mu chamber information was available for track
   
      Description The algorithm will be described in tedious detail in
      =========== a future ALEPH note by Hilgart and Simopoulou.
   A1PI,A2PI, etc. give the 4 parameters for the pion probability dens
    in the mu chambers, similarly,
   A1K,A2K, etc. for the kaons
    XLAYR array has distance ratio cutoffs used in JULIA
    gives punch-through probabilites for pi's, k's, and mu's measured
      at a few energies
   ASS gives the relative probability of associating to 1 or 2 mu layers
    for the different particles at the different energies.
    delineates the momentum intervals appropriate to the PUNCH array.
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
              FMUID                                                                
                   |----  XASS                                External             
                   |----  EXP                                 External             
                   |----  NAMIND                              External             
                   |----  ABS                                 External             
                   |----  SQRT                                External             
                   |----  PINT                                External             
   
 
3 FPIDEN
         SUBROUTINE FPIDEN
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Fills bank frid containing bit patterns for tracks and calorimeters
    and particle ID.
   
    This routine is now obsolete and here only for backward compatibility
    Call FCFRID(1) directly
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
              FPIDEN                                                               
                   |----  FCFRID                                                   
   
 
3 FPMOVE
         SUBROUTINE FPMOVE(POINT,TPAR)
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Re-define the track parameters relative to a new point in space.
    Author                                             Dave Brown 4-9-93
   
         IMPLICIT NONE
    Inputs; point in space, track parameters
         REAL POINT(3),TPAR(5)
    Outputs;
        TPAR  updated
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   FLNGV0                                                                          
        |---- FPMOVE                                                               
                   |----  COS                                 External             
                   |----  SIN                                 External             
                   |----  ATAN2                               External             
                   |----  ABS                                 External             
                   |----  NINT                                External             
   
 
3 FREFIT
         SUBROUTINE FREFIT(IRET)
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Refit existing tracks (for dst-->dst reprocessing in julia)
   
      Author   :- Robert P. Johnson     17-OCT-1990
   
      Inputs:  Banks FRFT, FRTL, FTCL, FICL, FVCL  with NR=0
               (Note, the above banks are dropped on output)
               Bank TPCO with NR=0
               Banks ICCO, VDCO coordinate banks
   
      Outputs: Banks FRFT, FRTL, FTCL, FICL, FVCL  with NR=1
               (These banks contain the newly fitted tracks)
               Bank TPCO with NR=1 with errors recalculated
               IRET       /I      Return code
                                  0= everything OK
                                  1= input banks not found
                                  2= no room in BOS for output banks
                                  3= input banks are not consistant
   
      Libraries required: ALEPHLIB
   
      Description
      ===========
      Tracks are fit to coordinates in TPCO, ICCO and VDCO using the
      coordinate lists in FTCL, FICL, and FVCL (NR=0).  The helix
      parameters in FRFT NR=0 are used as starting points for the fit.
      The results are place in FRFT NR=1.  Likewise, the new coordinate
      lists (which for now at least are the same as the old) are output
      in banks with NR=1.  If a track fails the fit, then the old fit
      values simply are copied to the output banks.
      Modified :- E. Lancon             26-AUG-1992
           Set number of VDET points to 0 in FRTL
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   RECEVT                                                                          
        |---- FREFIT                                                               
                   |----  NAMIND                              External             
                   |----  NLINK                               External             
                   |----  FTPCER                                                   
                   |----  NDROP                               External             
                   |----  AUBOS                               External             
                   |----  RERROR                                                   
                   |----  UFITMS                                                   
                   |----  IABS                                External             
                   |----  BDROP                               External             
   
 
3 FRMHIT
         SUBROUTINE FRMHIT(DET,ITRK,NDEL,LIST)
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Remove ndel det hits contained in list from track itrk
     Uses DET banks FRTL and F*CL
   
         Created: 23-OCT-1995    D.Casper
   
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   FITALL                                                                          
   TFITKF                                                                          
        |---- FRMHIT                                                               
                   |----  NAMIND                              External             
                   |----  RERROR                                                   
                   |----  ABS                                 External             
                   |----  UCOPY                               External             
   
 
3 FTPCER
         SUBROUTINE FTPCER(IRET)
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Recalculate the tpc coordinate errors for all coordinates
              R. Johnson    19-OCT-1990
    Modified: D. Casper     12-Jun-1995  Get wire correction flag
                            07-Jun-1996  Return without error if TPCO 1
                                         already exists
    Input:     Bank TPCO with NR=0   Old coordinate bank (gets dropped)
               Bank PCOI with info on coordinates
               Bank FRFT with track helix parameters
               Banks FRTL and FTCL with pointers from track to coordinates
    Output:    IRET      /I        Return code.  0=all OK
               Bank TPCO with NR=1   Coordinates with new errors
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   FREFIT                                                                          
        |---- FTPCER                                                               
                   |----  NAMIND                              External             
                   |----  NLINK                               External             
                   |----  RERROR                                                   
                   |----  NDROP                               External             
                   |----  MSWAP                               External             
                   |----  TFILPA                                                   
                   |----  TERPAR                                                   
   
 
3 FTRACK
           SUBROUTINE FTRACK
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Extrapolate tpc track through ecal, coil, hcal
   
     G.Capon                              28-Aug-87
   
   
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   MUREDO                                                                          
   RECEVT                                                                          
        |---- FTRACK                                                               
                   |----  BLIST                               External             
                   |----  NAMIND                              External             
                   |----  HINIRU                                                   
                   |----  UNEWDP                              External             
                   |----  ABS                                 External             
                   |----  ATAN2                               External             
                   |----  SIN                                 External             
                   |----  COS                                 External             
                   |----  SIGN                                External             
                   |----  AUHCYL                              External             
                   |----  UCOPY                               External             
                   |----  SQRT                                External             
                   |----  FLOAT                               External             
                   |----  VDIST                               External             
                   |----  ALOG                                External             
                   |----  AULPOL                                                   
                   |----  HTRACK                                                   
                   |----  AUBOS                               External             
                   |----  RERROR                                                   
                   |----  NINT                                External             
                   |----  VZERO                               External             
   

2 G_

  >>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>
    CKEY 
     1st entry in G_set
     ! JULIA 305
        GASTEER : fix variable type inconsistencies in function calls, 
                  for Linux                                           (A.Waananen)
    
     ! JULIA 283
       GAPECO  : create PECO NR=1 bank also when PECO NR=0 has zero rows 
                 (P.Janot, 24/9/96)
    
     ! JULIA 275
       GASTEER : Build PGID and PGPC (Bulos+Gampex) bank
                (M.N. Minard, Oct 1994)
  <<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<
     GAMBNK     Build egpc bank (result of gampec)
     GAPECO     Build peco bank nr=1 for modified energy,vertex
     GASTEER    Steering for photon

3 GAMBNK
         SUBROUTINE GAMBNK
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Build egpc bank (result of gampec)
       M.N. Minard 17/3/92 Built EGPR bank (list of storey of gampec row)
   
      Author   :- E. Lancon              6-NOV-1991
                  MN Minard        mod  10-FEB-1992
   
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
              GAMBNK                                                               
                   |----  NAMIND                              External             
                   |----  MDARD                               External             
                   |----  NDROP                               External             
                   |----  AUBOS                               External             
                   |----  GAMPEK                              External             
                   |----  INT                                 External             
                   |----  AUBPRS                              External             
                   |----  RERROR                                                   
   
 
3 GAPECO
         SUBROUTINE GAPECO(IER)
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Build peco bank nr=1 for modified energy,vertex
   
      Author   :- MN Minard             27-JAN-1993
      Modified :- P.Janot               24-SEP-1996
                  Create PECO NR=1 also when PECO NR=0 has zero length
   
      IER = 1 Not enough space to built PECO
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   GASTEER                                                                         
        |---- GAPECO                                                               
                   |----  NAMIND                              External             
                   |----  EVTVER                              External             
                   |----  NDROP                               External             
                   |----  AUBOS                               External             
                   |----  UCOPY                               External             
                   |----  GVERCR                              External             
                   |----  COS                                 External             
                   |----  SIN                                 External             
                   |----  SQRT                                External             
                   |----  ATAN2                               External             
   
 
3 GASTEER
         SUBROUTINE GASTEER
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Steering for photon
   
      Author   :- M.N. Minard            7-APR-1993
                  Mod 10.10.94
   
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   RECONS                                                                          
        |---- GASTEER                                                              
                   |----  GAPECO                                                   
                   |----  GAPGID                              External             
                   |----  GAPGAC                              External             
   

2 H_

  >>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>
    CKEY 
     1st entry in H_set
     ! JULIA 312
        HMROAD : Fixed bug affecing MUID in last layer of endcaps (A.Sciaba')
    
     * corr file 307.1
        HCORFC : NEW. HCAL tower energy correction for the bug that was 
                 present on the online software in 1996, 1997 and early 1998 data
                                                                       (A.Sciaba)
        HPRANA : Add call to HCORFC                                    (A.Sciaba)
    
     ! JULIA 305
        HCCONS.H : COMMON block is also defined in Alephlib with longer
                   length. COPYed Alephlib definition to JULIA        (M.Cattaneo)
        HCLCRA : fix variable type inconsistencies in function calls, 
                 for Linux                                            (A.Waananen)
    
     ! JULIA 304
        HVMASK : Get database from LRGEOM rather than LRCONS (A.Sciaba')
    
     * corr file 303.4
        HVMASK : Get run number with ABRUEV rather than from rcurnt.h  (A.Sciaba)
    
     ! JULIA 303
       HCMASK.H New - COMMON containing MASKHV array            (A.Sciaba)
       HINIRU : Add call to HVMASK                              (A.Sciaba)
       HVMASK : New - Fills MASKHV with HV masking information from HSSR 
                      Slow Control bank                         (A.Sciaba)
       HMROAD : Take into account info in MASKHV when calculating expected
                number of hits in HCAL                          (A.Sciaba)
     
     ! JULIA 280
       HPRANA,HPRANP,HPRDIG,HRCPAT,HTUBFI : opening "'" should have a
           closing "'" within the same line for cvs (F. Ranjard, Feb 96)
    
     ! JULIA 279
    
     ! JULIA 278
       HT0CJJ : new common deck added (A.Messineo, Aug 95)
       HTOWCA, HCATOW, HRDCAL: Barrel and endcap normalization
                              per wagon (A.Messineo, Aug 95)
       FTRACK, MUCUTS : protect to avoid overflow in PIBE2 (P.Comas, Aug 95)
    
     ! JULIA 272
     * corr file 271.6
       HMROAD : add protection.
     * corr file 271.1
       HCBHIS : HBPRO was called with a wrong number of arguments
  <<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<
     HCALIB     Single tower calibraton of hcal
     HCALRD     Reading of hcal calibration constants from daf
     HCATOW     Hcal towers calibration (intermodule and time dependence)
     HCBHIS     Book hcal histograms
     HCFCLU     Form hcal clusters
     HCHIST     Fill hcal histograms
     HCLCRA     Fill region code in hclu
     HCLTST     Test storey connection
     HCLUFI     Fill hclu bank
     HCORFC     Hcal tower energy correction for the bug that was
     HCOS       Given a storey energy in hcal, it creates the corresponding
     HCSIMM     Given the theta, phi address of an hcal tower (ith0, iph0),
     HDGDEB     Digital pattern debugging
     HDGFIL     Digital pattern histograms
     HDGPOT     Create hcal digital patterns pot
     HDGSUM     Digital pattern statistics
     HDPREC     Pattern reconstruction
     HDSPRE     Superpattern and excob reconstruction
     HFLNOI     Steering routine for noise flagging (analog readout)
     HINIJO     Initialise the hcal job
     HINIRU     Initialise the hcal run
     HMENER     Associates hcal energy to muon candidate tracks
     HMFIND     Looks for muons in hcal
     HMROAD     Road around extrapolated track
     HNOISE     Generate a lookup table (noicod) for noisy hcal
     HNOISY     Tells if an hcal tower is noisy by looking in noicod.
     HPATCO     Fills the hpco bank
     HPHNOI     Test if an element of phco contains a fraction
     HPLINK     Function to link cluster
     HPRANA     Prepare hcal analog data
     HPRANP     Prepare hcal analog data for pot reprocessing
     HPRDIG     Prepare hcal digital data
     HPREDA     Prepare hcal data (steering routine)
     HPRPOT     Prepare p.o.t. banks for hcal
     HPRSUM     Print run statistics for hcal
     HPRUNC     Get run conditions for hdprec
     HRCOMP     Compact the hpco bank
     HRCPAT     Finds digital patterns
     HRDCAL     Read calibrations form data base
     HROAD      Calculates energy in road for hcal
     HSLINK     Function to connect clusters to patterns
     HSLOWC     Handle slow control for hcal
     HSPARE     Superpattern reconstruction
     HSPTRE     Superpattern reconstruction
     HSTOFI     Fill hsto bank
     HTRACK     Full tracking routine for tracks in hcal
     HTUBFI     Fill htub bank
     HTWCR      I,j,k to tower corners conversion
     HVMASK     Reads the hv masks for hcal from the hssr slow control bank

3 HCALIB
         SUBROUTINE HCALIB(IPOTG)
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   
   Single tower calibraton of hcal
     Changes the contents of bank hsda
     Author: F. Ligabue    11/14/88
             modified R.Tenchini
     IPOTG = 0 running on raw data
             1 running on POT
     Input banks: HSDA, H1EC, H2EC, H3EC, H4EC
     Output banks: HSDA
     Called by HPRANA
     Calls HCALIB
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   HPRANA                                                                          
   HPRANP                                                                          
        |---- HCALIB                                                               
                   |----  NLINK                               External             
                   |----  RERROR                                                   
                   |----  WBANK                               External             
                   |----  HCSIMM                                                   
                   |----  NAMIND                              External             
   
 
3 HCALRD
         SUBROUTINE HCALRD
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   
   Reading of hcal calibration constants from daf
   
     AUTHORS  :  R. Tenchini             890126
   
   
     BANKS :
       INPUT   : H1EC,H2EC,H3EC,H4EC
       OUTPUT  : NONE
       CREATED : NONE
   
   
   
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   HINIRU                                                                          
        |---- HCALRD                                                               
                   |----  GTSTUP                              External             
                   |----  NAMIND                              External             
                   |----  ALGTDB                              External             
                   |----  PRTABL                              External             
   
 
3 HCATOW
         REAL FUNCTION HCATOW (ITHETA, IPHI)
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   
   Hcal towers calibration (intermodule and time dependence)
   
       Authors : R.Tenchini
                 S.Wasserbaech
                     10.3.90
   
       Mod     : A.Messineo
                     19.7.95
   
       Input:
           ITHETA  (I)     theta index of tower
           IPHI    (I)     phi index of tower
   
       Output:
           HCATOW  (R)     correction factor
   
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   HPRANA                                                                          
        |---- HCATOW                                                               
                   |----  RQBUNC                              External             
                   |----  HFNDMD                              External             
   
 
3 HCBHIS
         SUBROUTINE HCBHIS
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Book hcal histograms
            called by RBKHIS
               G.Capon   date : 870114
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   RBKHIS                                                                          
        |---- HCBHIS                                                               
                   |----  HBOOK1                              External             
                   |----  HTABLE                              External             
                   |----  HBPRO                               External             
                   |----  HBOOK2                              External             
                   |----  HIDOPT                              External             
   
 
3 HCFCLU
         SUBROUTINE HCFCLU(NHCLU)
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Form hcal clusters
        G.Capon               date : 861001
          output : NHCLU = number of Hcal clusters
          called by CALREC
                           fills temporary bank HCSR
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   RECEVT                                                                          
        |---- HCFCLU                                                               
                   |----  AUBOS                               External             
                   |----  RERROR                                                   
                   |----  WBANK                               External             
                   |----  HCLTST                                                   
                   |----  WDROP                               External             
                   |----  HCLUFI                                                   
                   |----  HCLCRA                                                   
                   |----  PRTABL                              External             
   
 
3 HCHIST
         SUBROUTINE HCHIST
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Fill hcal histograms
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   RHSEVT                                                                          
        |---- HCHIST.                                                              
   
 
3 HCLCRA
         SUBROUTINE HCLCRA
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Fill region code in hclu
        R.Tenchini            date : 890510
        INPUT BANKS: HCLU, HSTO, HSDA
        called by HCFCLU
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   HCFCLU                                                                          
        |---- HCLCRA                                                               
                   |----  EMPACT                              External             
                   |----  EFNDTW                              External             
                   |----  RERROR                                                   
   
 
3 HCLTST
         FUNCTION HCLTST(IT1,JF1,NR1,IT2,JF2,NR2)
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Test storey connection
   
         G.Capon   date : 861001  , revised 20-jun-1990
         function to test the connection between two storeys
         if the two storeys are connected  HCLTST is GE.0.
         criterion : at least a contact between storey corners
         input : IT1,JF1,NP1 = indices Itheta, Iphi, Nregion for storey 1
                 IT2,JF2,NP2 = indices Itheta, Iphi, Nregion for storey 2
           called by HCFCLU
   
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   HCFCLU                                                                          
        |---- HCLTST                                                               
                   |----  IABS                                External             
   
 
3 HCLUFI
         SUBROUTINE HCLUFI(NHCLU)
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Fill hclu bank
        G.Capon               date : 861001
        input : NHCLU = number of Hcal clusters
        called by HCFCLU
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   HCFCLU                                                                          
        |---- HCLUFI                                                               
                   |----  AUBOS                               External             
                   |----  RERROR                                                   
                   |----  HFILL                               External             
                   |----  JHISRF                              External             
                   |----  FLOAT                               External             
                   |----  SQRT                                External             
                   |----  HUSRAN                              External             
                   |----  PROXIM                              External             
                   |----  NDROP                               External             
                   |----  WDROP                               External             
   
 
3 HCORFC
         REAL FUNCTION HCORFC(ENE,ITH,IPH)
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   
   Hcal tower energy correction for the bug that was
     present on the online software in 1996, 1997 and
     early 1998 data
     Author: A. Sciaba`     27/05/98
     Input: R  ENE    tower energy
            I  ITH    tower theta index
            I  IPH    tower phi index
     Input banks: HNGR, HCCV
     Called by HPRANA
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   HPRANA                                                                          
        |---- HCORFC                                                               
                   |----  MDARD                               External             
                   |----  NAMIND                              External             
                   |----  RERROR                                                   
                   |----  MOD                                 External             
                   |----  REAL                                External             
                   |----  INT                                 External             
   
 
3 HCOS
         SUBROUTINE HCOS ( EN,IPHI,ITHE,IST,EVECT)
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Given a storey energy in hcal, it creates the corresponding
    energy vector
   -
   -    Authors : M.N. Minard , M. Pepe       26/02/89
   -
    Input : EN     storey energy
            IPHI   column index of storey
            ITHE   row index of storey
            IST    stack #
    Output: EVECT  energy vector
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   HROAD                                                                           
        |---- HCOS                                                                 
                   |----  NAMIND                              External             
                   |----  HSRCR                               External             
                   |----  FLOAT                               External             
                   |----  SQRT                                External             
   
 
3 HCSIMM
         SUBROUTINE HCSIMM (ITH0, IPH0, ITH1, IPH1, IRGN)
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   
   Given the theta, phi address of an hcal tower (ith0, iph0),
     yields the theta phi address of a tower which by symmetry
     has the same calibration constant (ITH1, IPH1)
     Author: F. Ligabue 11/14/88
     Numbers used in this routine are taken from Aleph Note
     "Hadron Calorimeter Description in GALEPH"
      region 1   ITH0: 1-4,    59-62   IPH0: 1-24    end-cap
      region 2   ITH0: 5-10,   53-58   IPH0: 1-48    end-cap
      region 3   ITH0: 11-17   46,52   IPH0: 1-96    overlap region
      region 4   ITH0: 18-45           IPH0: 1-96    barrel
      region 1   ITH1: 1-4           IPH1: 1-4       end-cap
      region 2   ITH1: 5-10          IPH1: 1-8       end-cap
      region 3   ITH1: 11-17         IPH1: 1-16      overlap region
      region 4   ITH1: 18-31         IPH1: 1-16      barrel
      region i   ITH1: ithmi - itmai
     Input banks:  H1EC, H2EC, H3EC, H4EC
     Called by HCALIB
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   HCALIB                                                                          
        |---- HCSIMM                                                               
                   |----  INT                                 External             
                   |----  FLOAT                               External             
                   |----  MOD                                 External             
   
 
3 HDGDEB
         SUBROUTINE HDGDEB
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   
   Digital pattern debugging
   
    AUTHOR :  G. Bagliesi      880511
   
    VERSION 1.1  890126
   
    INPUT   HPCO HTUB
   
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   HDPREC                                                                          
        |---- HDGDEB                                                               
                   |----  NLINK                               External             
                   |----  PRTABL                              External             
   
 
3 HDGFIL
         SUBROUTINE HDGFIL
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   
   Digital pattern histograms
   
    AUTHOR :  G. Bagliesi      880511
   
    VERSION 1.1  890126
   
    INPUT   HPCO HCLU ECLU
   
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   HDPREC                                                                          
        |---- HDGFIL                                                               
                   |----  NLINK                               External             
                   |----  HFILL                               External             
                   |----  FLOAT                               External             
   
 
3 HDGPOT
         SUBROUTINE HDGPOT
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   
   Create hcal digital patterns pot
    Author: R.Tenchini           041188
   
    INPUT Banks : HPCO, HPDS
    OUTPUT Banks : PPOB, PPDS
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   RDEFPO                                                                          
        |---- HDGPOT                                                               
                   |----  NLINK                               External             
                   |----  AUBOS                               External             
                   |----  RERROR                                                   
   
 
3 HDGSUM
         SUBROUTINE HDGSUM
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   
   Digital pattern statistics
   
    AUTHOR :  R. Tenchini      890126
   
    INPUT   HPCO
   
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   HDPREC                                                                          
        |---- HDGSUM                                                               
                   |----  NLINK                               External             
   
 
3 HDPREC
         SUBROUTINE HDPREC
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   
   Pattern reconstruction
   
    AUTHOR  : G. BAGLIESI  871116
   
   
    VERSION 1.0
   
   
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   CALREC                                                                          
        |---- HDPREC                                                               
                   |----  HRCPAT                                                   
                   |----  HPATCO                                                   
                   |----  HRCOMP                                                   
                   |----  HDGSUM                                                   
                   |----  HDGFIL                                                   
                   |----  JHISRF                              External             
                   |----  HDGDEB                                                   
   
 
3 HDSPRE
         SUBROUTINE HDSPRE
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   
   Superpattern and excob reconstruction
    (EXCOB NOW MOVED TO ECHCGL)
    AUTHOR  : G. BAGLIESI, R. TENCHINI 881005
   
   
    VERSION 1.0
   
   
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   ECHCGL                                                                          
        |---- HDSPRE                                                               
                   |----  HSPARE                                                   
                   |----  HSPTRE                                                   
                   |----  HFLNOI                                                   
   
 
3 HFLNOI
         SUBROUTINE HFLNOI(NSPN0)
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   
   Steering routine for noise flagging (analog readout)
   
    Author  : R. Tenchini 040190
   
    Version 1.2
   
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   HDSPRE                                                                          
        |---- HFLNOI                                                               
                   |----  HNOISE                                                   
                   |----  NLINK                               External             
                   |----  HPHNOI                                                   
                   |----  MOD                                 External             
                   |----  IOR                                 External             
                   |----  HNOISY                                                   
                   |----  HFILL                               External             
                   |----  JHISRF                              External             
   
 
3 HINIJO
         SUBROUTINE HINIJO
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Initialise the hcal job
   
    Author G.Capon
   
    Modified  - Version 1.1 R.Tenchini 890126
   
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   RINJOB                                                                          
        |---- HINIJO                                                               
                   |----  NAMIND                              External             
                   |----  HPRUNC                                                   
                   |----  MDARD                               External             
                   |----  REPORT                                                   
   
 
3 HINIRU
         SUBROUTINE HINIRU
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Initialise the hcal run
    G.Capon
    Modified by A. Sciaba` on February 1997:
        added call to HVMASK
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   FTRACK                                                                          
   MUNEWR                                                                          
   RINRUN                                                                          
        |---- HINIRU                                                               
                   |----  HRDDAF                              External             
                   |----  RERROR                                                   
                   |----  HCPRGE                              External             
                   |----  NLINK                               External             
                   |----  HCALRD                                                   
                   |----  HRDCAL                                                   
                   |----  HGETJU                              External             
                   |----  NAMIND                              External             
                   |----  ALGTDB                              External             
                   |----  IBSET                               External             
                   |----  HVMASK                                                   
   
 
3 HMENER
         SUBROUTINE HMENER(ITRAC,ECLU)
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Associates hcal energy to muon candidate tracks
   
         Author:         F.Bossi -LNF- 4/88
   
         Input:          ITRAC =  Track nb.
         Output:         ECLU  =  Associated energy
   
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   HMFIND                                                                          
        |---- HMENER                                                               
                   |----  COS                                 External             
                   |----  NLINK                               External             
                   |----  FLOAT                               External             
                   |----  SQRT                                External             
                   |----  NAMIND                              External             
                   |----  SIN                                 External             
   
 
3 HMFIND
         SUBROUTINE HMFIND
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Looks for muons in hcal
   
       Author:    F.Bossi -LNF-   3/88
   
       Description:
                  This routine looks if TPC tracks are
                  associated to muon-like (i.e. penetrating,
                  minimum ionizing) particles. A preliminary
                  identification test is done and the bank
                  HMAD is filled.
   
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   MUREDO                                                                          
   RECEVT                                                                          
        |---- HMFIND                                                               
                   |----  NAMIND                              External             
                   |----  NLINK                               External             
                   |----  AUBOS                               External             
                   |----  RERROR                                                   
                   |----  ABS                                 External             
                   |----  ATAN2                               External             
                   |----  SIN                                 External             
                   |----  HMROAD                                                   
                   |----  HFILL                               External             
                   |----  JHISRF                              External             
                   |----  FLOAT                               External             
                   |----  HMENER                                                   
                   |----  NDROP                               External             
   
 
3 HMROAD
         SUBROUTINE HMROAD(ITRAC,NFPL,NEXP,NENF,NFLT,MHLT,IGFL,IEBM,ITBM)
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Road around extrapolated track
   
        Author:    F.Bossi -LNF-  3/88
                    revised march 1991 (bank HROA added) - G. Capon
                    revised march 1992 (better overlap descr.)-A.Venturi
                    revised february 1997 (HV masks used) - A. Sciaba`
                    revised 2000-02-02 - A.Sciaba`:
                        Fixed bug affecting MUID in last layer of endcaps
   
        Input:     ITRAC   : Track number
        Output:    NFPL    : Numb. of fired planes in the road
                   NEXP    : Numb. of expected fired planes in the road
                   NFLT    : Numb. of fired planes among last ten
                   MHLT    : Numb. of clusters in the last ten
                             planes in the road.
                   IGFL    : Geometry flag
                           = 0  track in active zone
                           = 1  dead zone between two barrel modules
                           = 2  dead zone between two endcap modules
                           = 3  barrel module notch
                           = 4  endcap module spacer
                           = 5  not active zone of tube
                           = 6  first plane in thin endcap
                           = 7  masked digital chain
                           = 8  masked HV channel
                           = -1 error condition
                   IEBM    : Expected bit map
                   ITBM    : True bit map
                           = each bit is 1 if the corrisponding Hcal
                             plane is fired (ITBM), or is expected to
                             be fired (IEBM); otherwise is set to 0.
   
          Description:
                      A road is opened around the extrapolated
                      track; its width is ROADWD times the multiple
                      scattering r.m.s. + 3. ( for mesurament errors and
                      misalignments ). The output variables are calculated
                      and account is taken if the particle is
                      expected to be near a dead zone
   
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   HMFIND                                                                          
        |---- HMROAD                                                               
                   |----  AUBOS                               External             
                   |----  RERROR                                                   
                   |----  NAMIND                              External             
                   |----  NLINK                               External             
                   |----  ATAN2                               External             
                   |----  FLOAT                               External             
                   |----  VZERO                               External             
                   |----  IABS                                External             
                   |----  SIN                                 External             
                   |----  COS                                 External             
                   |----  ABS                                 External             
                   |----  HFILL                               External             
                   |----  JHISRF                              External             
                   |----  NINT                                External             
   
 
3 HNOISE
         SUBROUTINE HNOISE
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   
   Generate a lookup table (noicod) for noisy hcal
    towers.  See HNOISY for definition of NOICOD.
    NNOISE is filled with the number of noise objects
    found in the event.
    This routine should be called once per event.
    The tower information is taken from the HSDA bank.
   
    Author: S.Wasserbaech        061289
   
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   HFLNOI                                                                          
        |---- HNOISE                                                               
                   |----  UFILL                               External             
                   |----  NLINK                               External             
                   |----  UZERO                               External             
                   |----  MOD                                 External             
   
 
3 HNOISY
         INTEGER FUNCTION HNOISY(ITHE,IPHI)
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   
   Tells if an hcal tower is noisy by looking in noicod.
    Call HNOISE first (once per event) to fill NOICOD.
    Author: S. Wasserbaech       061289
   
    Input:
      ITHE = Theta index
      IPHI = Phi index
   
    Output:
    HNOISY = -1  no hit in this tower;
              0  good hit;
            999  ithe and/or iphi out of range.
           else  noise found in this tower; the set
                 bits indicate the noise type, as
                 defined in HNOISE.  Type i corresponds
                 to bit (i-1) (bit numbering as in BTEST),
                 where i=1,2,...,5.  At most two bits will
                 be set: one for the barrel (Type 1, 2,
                 or 3) and one for the endcaps (Type 4
                 or 5).
   
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   HFLNOI                                                                          
        |---- HNOISY.                                                              
   
 
3 HPATCO
         SUBROUTINE HPATCO(NPATT)
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   
   Fills the hpco bank
   
    Author  : G. BAGLIESI  880202
   
    VERSION 1.0
   
    INPUT   HTPA, HTUB BANKS
    OUTPUT  HPCO, HPDS BANKS
   
    NPAT0=Number  of patterns
   
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   HDPREC                                                                          
        |---- HPATCO                                                               
                   |----  NAMIND                              External             
                   |----  RERROR                                                   
                   |----  BLIST                               External             
                   |----  AUBOS                               External             
                   |----  HCLARA                              External             
                   |----  FLOAT                               External             
                   |----  INT                                 External             
                   |----  WBANK                               External             
                   |----  MOD                                 External             
                   |----  HCLAWI                              External             
                   |----  BKFRW                               External             
                   |----  SQRT                                External             
                   |----  ATAN                                External             
                   |----  ABS                                 External             
                   |----  WDROP                               External             
   
 
3 HPHNOI
         LOGICAL FUNCTION HPHNOI(IROW,FRAC)
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   
   Test if an element of phco contains a fraction
    of noisy towers greater than FRAC
   
    Author: R.Tenchini           901130
   
    IROW  = row in HCLU bank
    FRAC  = cut on fraction of noisy towers.
   
   
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   HFLNOI                                                                          
        |---- HPHNOI                                                               
                   |----  NLINK                               External             
                   |----  NAMIND                              External             
                   |----  IBITS                               External             
                   |----  FLOAT                               External             
   
 
3 HPLINK
         LOGICAL FUNCTION HPLINK(IS10,IM10,L10,X10,W10,
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
        +                        IS20,IM20,L20,X20,W20)
   
   Function to link cluster
   
    Author  : G. BAGLIESI  880128
   
    VERSION 1.0
   
    HPLINK=.TRUE.  ->   CLUSTER LINKED
    HPLINK=.FALSE. ->   CLUSTER NOT LINKED
   
   
    Two CLUSTERS are linked if their distance is less than 10.5 CM
    on the same LAYER or less than 3.5 on different LAYERS
   
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
              HPLINK                                                               
                   |----  ABS                                 External             
                   |----  MIN                                 External             
                   |----  MAX                                 External             
                   |----  MOD                                 External             
                   |----  HCLAWI                              External             
   
 
3 HPRANA
         SUBROUTINE HPRANA(NHVST)
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Prepare hcal analog data
        G.Capon               date : 861001
        modified R.Tenchini
        modified A.Sciaba`           980527
         fill HSDA bank
         output : NHVST = number of valid storeys
                        (over threshold KTHRE)
         called by HPREDA
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   HPREDA                                                                          
        |---- HPRANA                                                               
                   |----  NLINK                               External             
                   |----  AUBOS                               External             
                   |----  RERROR                                                   
                   |----  NAMIND                              External             
                   |----  IBITS                               External             
                   |----  HINTST                              External             
                   |----  HFNDMD                              External             
                   |----  IAND                                External             
                   |----  FLOAT                               External             
                   |----  HCORFC                                                   
                   |----  HCATOW                                                   
                   |----  HSTOFI                                                   
                   |----  NDROP                               External             
                   |----  HCALIB                                                   
   
 
3 HPRANP
         SUBROUTINE HPRANP
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Prepare hcal analog data for pot reprocessing
        R.Tenchini           date : 890720
         fill HSDA bank and call HSTOFI
   
   
         called by HPREDA
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   HPREDA                                                                          
        |---- HPRANP                                                               
                   |----  NLINK                               External             
                   |----  AUBOS                               External             
                   |----  RERROR                                                   
                   |----  HNREG                               External             
                   |----  HINTST                              External             
                   |----  HFNDMD                              External             
                   |----  HSTOFI                                                   
                   |----  HCALIB                                                   
   
 
3 HPRDIG
         SUBROUTINE HPRDIG(NHTUB)
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Prepare hcal digital data
        G.Capon               date : 861001
              output : NHTUB = number of fired tubes in Hcal
        called by HPREDA
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   HPREDA                                                                          
        |---- HPRDIG                                                               
                   |----  HFILL                               External             
                   |----  JHISRF                              External             
                   |----  FLOAT                               External             
                   |----  NAMIND                              External             
                   |----  AUBOS                               External             
                   |----  RERROR                                                   
                   |----  NLINK                               External             
                   |----  IBITS                               External             
                   |----  BTEST                               External             
                   |----  HTUBFI                                                   
   
 
3 HPREDA
         SUBROUTINE HPREDA
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Prepare hcal data (steering routine)
        G.Capon               date : 861001
        Modified R.Tenchini 890720 to reprocess the POT
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   RPREDA                                                                          
        |---- HPREDA                                                               
                   |----  NAMIND                              External             
                   |----  BLIST                               External             
                   |----  NLINK                               External             
                   |----  BDROP                               External             
                   |----  HPRANP                                                   
                   |----  HPRANA                                                   
                   |----  HPRDIG                                                   
                   |----  PRTABL                              External             
   
 
3 HPRPOT
         SUBROUTINE HPRPOT
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Prepare p.o.t. banks for hcal
   
    G.Capon                         4-jan-1989
   
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   RDEFPO                                                                          
        |---- HPRPOT                                                               
                   |----  NLINK                               External             
                   |----  AUBOS                               External             
                   |----  RERROR                                                   
   
 
3 HPRSUM
         SUBROUTINE HPRSUM
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Print run statistics for hcal
     G.Capon     25-aug-87
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   RSMJOB                                                                          
        |---- HPRSUM                                                               
                   |----  FLOAT                               External             
   
 
3 HPRUNC
         SUBROUTINE HPRUNC
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   
   Get run conditions for hdprec
   
     AUTHORS  :  G. BAGLIESI, A. GIASSI
   
     MODIFIED R.TENCHINI 890126
   
     BANKS :
       INPUT   : HDRC
       OUTPUT  : NONE
       CREATED : NONE
   
   
   
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   HINIJO                                                                          
        |---- HPRUNC                                                               
                   |----  NAMIND                              External             
                   |----  MDARD                               External             
   
 
3 HRCOMP
         SUBROUTINE HRCOMP
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   
   Compact the hpco bank
   
    Author  : G. BAGLIESI  880415
   
    VERSION 1.0
   
    Input   HPCO BANK
    Output  HPCO compacted bank
   
   
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   HDPREC                                                                          
        |---- HRCOMP                                                               
                   |----  NLINK                               External             
                   |----  WBANK                               External             
                   |----  RERROR                                                   
                   |----  COS                                 External             
                   |----  SIN                                 External             
                   |----  SQRT                                External             
                   |----  BKFRW                               External             
                   |----  WDROP                               External             
   
 
3 HRCPAT
         SUBROUTINE HRCPAT(NPAT0)
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   
   Finds digital patterns
   
    Author  : G. BAGLIESI   880119
   
    VERSION 1.0
   
    Input   HTUB BANK
    Output  HTPA FAMILY OF BANKS
   
    NPAT0=NUMBER  OF PATTERNS
   
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   HDPREC                                                                          
        |---- HRCPAT                                                               
                   |----  NLINK                               External             
                   |----  REPORT                                                   
                   |----  WBANK                               External             
                   |----  INTSOR                              External             
                   |----  BLIST                               External             
                   |----  MOD                                 External             
                   |----  AUBOS                               External             
                   |----  RERROR                                                   
                   |----  WDROP                               External             
   
 
3 HRDCAL
         SUBROUTINE HRDCAL
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   
   Read calibrations form data base
    This reads Intermodule calibrations and time dependence
      Author: R.Tenchini  10.3.90
   
       Mod     : A.Messineo
                     19.7.95
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   HINIRU                                                                          
        |---- HRDCAL                                                               
                   |----  ALGTDB                              External             
                   |----  NAMIND                              External             
   
 
3 HROAD
         SUBROUTINE HROAD( PMOM , VEXTR , ITRACK , NETP1 ,XCOS)
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Calculates energy in road for hcal
       Fills bank HCTE
   -
   -     Authors : M.N. Minard , M. Pepe       26/02/89
   -     Modified: M.N  Minard                 04/01/91
   -
   - Input:  PMOM              = Particle momentum
   -         VEXTR (1--> 3)    = Extrapolated coordinates in HCAL
   -         ITRACK ( 1--> 5 ) = Address of cell crossed by extrapolation
   -         NETP1             = Track # to extrapolate
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   ECST                                                                            
        |---- HROAD                                                                
                   |----  NAMIND                              External             
                   |----  RERROR                                                   
                   |----  VZERO                               External             
                   |----  HSRCR                               External             
                   |----  FLOAT                               External             
                   |----  VDOTN                               External             
                   |----  ABS                                 External             
                   |----  SIGN                                External             
                   |----  ACOS                                External             
                   |----  SIN                                 External             
                   |----  SQRT                                External             
                   |----  AUBOS                               External             
                   |----  HCOS                                                     
                   |----  UCOPY                               External             
                   |----  EMSKF                                                    
   
 
3 HSLINK
         LOGICAL FUNCTION HSLINK(IDIR1,COR1A,COR2A,IDIR2,COR1B,COR2B)
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   
   Function to connect clusters to patterns
   
    Author  : G. BAGLIESI  880323
   
    VERSION 1.0
   
    HSLINK=.TRUE.  ->   patterns linked
    HSLINK=.FALSE. ->   patterns not linked
    IDIR = STRIP DIRECTION INDEX (HCAL)
    IDIR = 20  (ECAL)
    IDIR = 30  (HCAL TOWER)
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   HSPARE                                                                          
        |---- HSLINK                                                               
                   |----  COS                                 External             
                   |----  TAN                                 External             
                   |----  SIN                                 External             
   
 
3 HSLOWC
         SUBROUTINE HSLOWC
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Handle slow control for hcal
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   RUNKNO                                                                          
        |---- HSLOWC.                                                              
   
 
3 HSPARE
         SUBROUTINE HSPARE(NSPN0,ICLU)
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   
   Superpattern reconstruction
   
    Authors : G. BAGLIESI
              R. TENCHINI    880408
   
    VERSION 1.0  880408
   
    Input   HPCO (ECLU OR HCLU) BANKS
    Output  HSPX FAMILY OF BANKS (HSPE for Eclusters
                                  HSPH for Hclusters)
   
    NSPN0=Number  of superpatterns
    ICLU =1 E SUPERPATTERN (connected with Eclusters)
    ICLU =2 H SUPERPATTERN (connected with Hclusters)
   
    Each HSPA contains the superpattern elements
    coded as 10000 + address in HPCO for TUBE PATTERNS,
          as 20000 + address in ECLU for ECLU CLUSTERS,
    and   as 30000 + address in HCLU for HCLU CLUSTERS
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   HDSPRE                                                                          
        |---- HSPARE                                                               
                   |----  NLINK                               External             
                   |----  WBANK                               External             
                   |----  HSLINK                                                   
                   |----  MOD                                 External             
                   |----  IBSET                               External             
                   |----  IAND                                External             
                   |----  NUMBIT                              External             
                   |----  BTEST                               External             
                   |----  AUBOS                               External             
                   |----  RERROR                                                   
                   |----  UCOPY                               External             
                   |----  NPRNT                               External             
                   |----  WDROP                               External             
   
 
3 HSPTRE
         SUBROUTINE HSPTRE(NSPN0)
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   
   Superpattern reconstruction
   
    Author :  R. TENCHINI      880408
   
    Version 1.0  880408
   
    INPUT   HSPE FAMILY OF BANKS, HPCO ECLU ECT1 BANKS
    Output  HSPT BANK
   
    NSPTT0=Number  of superpatterns
   
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   HDSPRE                                                                          
        |---- HSPTRE                                                               
                   |----  AUBOS                               External             
                   |----  RERROR                                                   
                   |----  NLINK                               External             
                   |----  MOD                                 External             
   
 
3 HSTOFI
         SUBROUTINE HSTOFI(KHSTO)
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Fill hsto bank
        G.Capon               date : 861001
             bank HSTO contains coordinates of storey corners
             input/output : KHSTO pointer to bank HSTO
             called by HPRANA
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   HPRANA                                                                          
   HPRANP                                                                          
        |---- HSTOFI                                                               
                   |----  NLINK                               External             
                   |----  VZERO                               External             
                   |----  REPORT                                                   
                   |----  HSRCR                               External             
                   |----  HTWCR                                                    
   
 
3 HTRACK
           SUBROUTINE HTRACK(IBON,IDEON,ATIN,IFAIL,NVETT,ATFRA)
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Full tracking routine for tracks in hcal
   
    P.Campana - LNF - Version 3.2           121287
   
    GeV cm kG ns ALEPH coord. frame -
    Parametriz. of the field - FFIELD called at entrance region
   
    IBON = 1 field active   IDEON = 1 dE/dx active
    ATIN(8)  input  vector:  x y z px py pz Rms Q
    ATFRA(9,NSTEP+4)  out :  x y z px py pz Rms #reg&mod #lay
    Regions : 0=air, 1500=ecal, 2500=coil, 31xx-36xx=hcal
    Regions in hcal x1xx=barrel     x2xx=notch     x3xx=back e.c.
                    x4xx=front e.c. x5xx=air zone  x6xx=coil
    Mod.# for end caps refers to the mod.# of the barrel facing it
    Negative sign refers to the z direction
   
    Tracking of particles with p>1 GeV entering HCAL, followed
    up to pcut=0.15 GeV
    IFAIL=1 ok, =2 p<pthr, =3 spiral, =4 p<pcut, =5 parall. to slabs
   
    With respect to 3.1: Variable end cap radius, Energy loss correct
    in reg #6, Positive and *100 numbering of regions and modules
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   FTRACK                                                                          
        |---- HTRACK                                                               
                   |----  ATAN2                               External             
                   |----  COS                                 External             
                   |----  SIN                                 External             
                   |----  FMINIT                              External             
                   |----  SQRT                                External             
                   |----  ABS                                 External             
                   |----  FMREGN                              External             
                   |----  FFIELD                                                   
                   |----  FLOAT                               External             
                   |----  SIGN                                External             
                   |----  NINT                                External             
   
 
3 HTUBFI
         SUBROUTINE HTUBFI(KHTUB,NHTUB)
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Fill htub bank
        G.Capon               date : 861001
        output : NHTUB = number of hits in Hcal tubes
        called by HPRDIG
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   HPRDIG                                                                          
        |---- HTUBFI                                                               
                   |----  HFBAHI                              External             
                   |----  HFENHI                              External             
                   |----  RERROR                                                   
   
 
3 HTWCR
           SUBROUTINE HTWCR(SYSTM,IT,JF,LHPOI,CORNR)
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   I,j,k to tower corners conversion
   
         G.Capon                april 89
      Subroutine to compute coordinates of storey corners
        from storey indices IT,JF,NR
    input :
            SYSTM : reference system (not used up to now)
              IT  : theta index of storey
              JF  : phi     "        "
             LHPOI: number of storey points (=8 in general case)
    output:
        CORNR(3,K): x,y,z coord of corner K (K=1,LHPOI) in Aleph syst
   
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   HSTOFI                                                                          
        |---- HTWCR                                                                
                   |----  IHCREG                              External             
                   |----  HCTHUL                              External             
                   |----  FLOAT                               External             
                   |----  SIN                                 External             
                   |----  COS                                 External             
                   |----  TAN                                 External             
   
 
3 HVMASK
         SUBROUTINE HVMASK
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Reads the hv masks for hcal from the hssr slow control bank
   
       Author      :- A. Sciaba`  9-APR-1997
       Modified    :- M.Cattaneo 23-MAY-1997
                 Test JHSSR and not NHSSR for existence of HSSR....
       Modified    :- A. Sciaba`  2-JUL-1997
                 Get run number with ABRUEV rather than from rcurnt.h
       Modified    :- A. Sciaba`  6-AUG-1997
                 Get database from LRGEOM rather than LRCONS
   
       Libraries required: none
   
       Description
       ===========
       This routine reads the HSSR bank, which cointains the voltage of
       every HV channel in HCAL and mu-chambers or the value -3 if a
       channel is masked.
       It uses the HVBA, HVEA and HVEB database banks to find the
       correspondence to the HCAL planes and to store in the
       MASKHV(36,37) matrix the masking information.
       The first index in MASKHV is the submodule number (1-24 barrel,
       25-30 Endcap A, 31-36 Endcap B) and the second index is the plane
       number in case of the barrel (1-23); for the endcaps, it is
       the plane number in the range (1-7), in the range (8-22)
       is the first part of the planes (8-22) and in (23-37) is the
       second part of the planes (8-22).
   
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   HINIRU                                                                          
        |---- HVMASK                                                               
                   |----  ABRUEV                              External             
                   |----  NAMIND                              External             
                   |----  ALGTDB                              External             
                   |----  RERROR                                                   
   

2 I_

  >>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>
    CKEY 
    
     1st entry in I_set
     ! JULIA 305
        ITEXTN : fix variable type inconsistencies in function calls, 
                 for Linux                                            (A.Waananen)
    
     ! JULIA 302 (Tracking upgrade)
        IREFIN : Don't drop old ICCO, to keep valid coordinates (D.Casper)
        ITCINF.H Increase JRESMX from 80 to 200                 (D.Casper)
    
     ! JULIA 280
       IFIND1,IFIND2,IGETTI,IMATCH,IREOPD,ITBOOK,ITCTRK,ITLNK1,ITLNK2,
       ITRECF,ITRECI,ITREE,ITRKCI : opening "'" should have a closing "'"
            within the same line for cvs (F. Ranjard, Feb 96)
    
     * corr file 279.2
       IENANG, IPHCOR : avoid use of NLINK (O.Callot, Dec 95)
       IFITP  : optimize code as CHIELI always .ge.0 (O.Callot, Dec 95)
       IFIND1,IFIND2,IGICHA,IPREDA,ITCREC,ITRAK : call ALTIME only if ITTI
               card used (O.Callot, Dec 95)
       ITTIME : common modified to include logical IFITTI (O.Callot, Dec 95)
     ! JULIA 279
    
     ! JULIA 278
       INSECT : Add test for intersection. Also tighten sin(A) test to
               not allow angles too near 90 deg (J.Sedgbeer, Aug 95)
    
     ! JULIA 275
    
     * corr file 274.3
       INSECT : protect against square root of negative value (P.Comas).
     ! JULIA 274
    
  <<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<
     IASIGN     Fill /itcinf/ common with information to analyse the itc
     IATTMA     This program relates julia to true mc tracks in the itc and tpc.
     IBNKIN     Initialise itc name indices and bank formats.
     ICASWT     Switch dead storey address in end-caps
     ICFTOI     Convert frft type banks to itft type track banks.
     ICLIMB     Climb up the tree via interconnecting links.
     ICRCCO     Create corrected coord. bank
     IDEADW     Simulate dead wires/channels in monte carlo data
     IDIGPR     Print idig bank.
     IENANG     Itc: calculate angle through cell.
     IFIND1     Find paths in trees
     IFIND2     Find paths in trees
     IFITP      Fit found paths.
     IFTRAK     Finalise itc tracking
     IGETTI     Decide in which order to try extending the tpc tracks.
     IGETTP     See if tpc track intpc is a good candidate for extension and if it
     IGICHA     Get itc chain from tpc track parameters.
     IHELER     Calculate errors in coordinates on a helix.
     IINIJO     Initialise the itc job
     IINIRU     Initialise the itc run
     IINTRK     Initialise constants and parameters needed for itc tracking.
     IMATCH     Match up unextended tpc with itc stand-alone tracks.
     INIGAP     Set up itc gap common
     INSECT     Intersect tpc track with itc layer.
     INTRAK     Itc tracking prog. initialisation
     IPAKDI     Pack itc digits. for pot output.
     IPDSTI     Itc prepare data statistics initialise
     IPHCOR     Apply drift-time correction to phi value.
     IPREDA     Prepare itc data.
     IPRSUM     Print run statistics for itc
     IPSTAT     Itc prepare data statistics and histograms.
     IREFIN     Refine/improve itc tracks.
     IREOPD     Reorder the packed digits.(pidi) according to tracks (ficl).
     ISAVE      Save path in tree.
     ISHUFF     Shuffle/update frft type banks from itft type track banks.
     ISHUFL     Shuffle coord. lists due to reassignments
     ISLOWC     Handle slow control for itc
     ISRCH      Search itc coordinates in specified road.
     ITBOOK     Book itc histograms
     ITCCUT     Make cuts on itc points to be included on tracks.
     ITCOPR     Print itco bank number num.
     ITCREC     Itc reconstruction. steering routine.
     ITCREP     Dst-dst reprocessing : itc reconstruction. steering routine.
     ITCTPC     Itc-tpc tracking - steering.
     ITCTRK     Itc tracking - steering.
     ITCXNG     Compute track crossings of the itc sense wire planes.
     ITERR      Calculate tracking error in rphi
     ITEXTN     Associate lone tpc coordinates with existing itc tracks
     ITHIST     Itc histograms.
     ITIDY1     Ensure that a tpc point is assigned to only one itc track
     ITIDY2     Only one tpc point with a given r-coord can be added to an itc track
     ITLNK1     Itc: form links.
     ITLNK2     Itc: search for links
     ITPCAN     Initialise bank iexc used by subroutine itextn
     ITRAK      Itc tracking prog.
     ITRECF     Finalise itc-tpc tracking
     ITRECI     Itc reconstruction initialisation.
     ITREE      Itc: form tree
     ITRKCI     Fills commons with cuts used in itc tracking.
     ITRKEQ     Calculate z and phi coords of a helical track at radius r.
     ITRKZR     Calculate r as a function of z for a helix.
     ITRMCA     Associate julia itc tracks with true mc tracks.

3 IASIGN
         SUBROUTINE IASIGN(SIGMAX, ADJCUT, ITK, VV0, IER)
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Fill /itcinf/ common with information to analyse the itc
   
       Author  :  W. B. Atwood  2-Oct-89
       Modified:  J.Sedgbeer 16/01/90 Rules etc.
       Modified:  J.Carr  12/2/91 various changes
   
      Input:
        SIGMAX /R4 : Max. allowed No. of sigmas for inclusions of hits
                                                    on tracks
        ADJCUT /R4 : Fraction of cell beyond which to include next cell
        ITK    /I4 : number of track in bank (ITFT)
        VV0(5) /R  : track params as 1st 5 in ITFT.
        need common /BCS/ for BOS banks.
        need common /ITWICC/ for ITC geom.
   
    IMPORTANT: If you wish to use this subroutine, then at the beginning
               of each run, you must call the ALEPHLIB routine, IRDDAF,
               to fill commons with the ITC geometry etc.
   
               ALSO: YOU MUST ZERO NTKITC from COMMON/ITCINF/ before
                     calling IASIGN!!!!
      Output:
        IER    /I  : Error flag: = 0 if O.K., =1 otherwise
        see common/ITCINF/
   
      calls     : ITCXNG, IUDOCA, UTSWCO, ITROTN
   
      Libraries required: BOS
   
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   IREFIN                                                                          
        |---- IASIGN                                                               
                   |----  NAMIND                              External             
                   |----  NLINK                               External             
                   |----  ITCXNG                                                   
                   |----  CLWITC                              External             
                   |----  HTXITC                              External             
                   |----  ITERR                                                    
                   |----  AMIN1                               External             
                   |----  ABS                                 External             
                   |----  UTSWCO                              External             
                   |----  ITROTN                              External             
                   |----  AMOD                                External             
                   |----  ICDRIF                              External             
                   |----  SIN                                 External             
                   |----  COS                                 External             
                   |----  IUDOCA                              External             
                   |----  DCAITC                              External             
                   |----  AMAX1                               External             
                   |----  FLOAT                               External             
                   |----  RERROR                                                   
   
 
3 IATTMA
         SUBROUTINE IATTMA(IERR)
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   This program relates julia to true mc tracks in the itc and tpc.
   
       Author     :- I. Tomalin    89/03/14
   
       Input:
         commons:       /BCS/
         parameters:    IPJTJJ,IRJTJJ,TGMAJJ,TMTLJJ,FPOIJJ
                        PITMJJ,PASLJJ
   
       Output:
            I/   IERR = 0 if new banks produced.
                      = 1 if the input banks did not make sense.
                      = 2 if there was insufficient BOS space.
   
       called by : ITCREC
       calls     : none
   
       Libraries required: BOS
   
    Link to all the required banks.
    Create the PITM and PASL banks.
    Loop over the ITC-TPC tracks.
      First find those FKIN tracks associated in the TPC and start filling
      the PITM and PASL banks.
      Then find those associated in the ITC and continue filling the new
      banks. (Exactly how depending on whether or not the FKIN tracks was
      also found in the TPC).
    End Loop
    Loop over the ITC stand-alone tracks.
      Finish filling the PITM and PASL banks.
    End Loop
    Compress the PASL bank.
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   RECEVT                                                                          
        |---- IATTMA                                                               
                   |----  NLINK                               External             
                   |----  AUBOS                               External             
                   |----  BDROP                               External             
                   |----  RERROR                                                   
                   |----  BLIST                               External             
   
 
3 IBNKIN
         SUBROUTINE IBNKIN
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Initialise itc name indices and bank formats.
   
       Author       : J. Sedgbeer  87/03/05
       Modified     : I. Tomalin   88/08/25
       Last Modified: J. Sedgbeer  90/01/31
   
      Input:  none
   
      Output:
        common /ITNAMC/   pointers to ITC banks.
   
      called by : IINIJO
      calls     : none
   
      libraries:  BOS
   
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   IINIJO                                                                          
        |---- IBNKIN                                                               
                   |----  NAMIND                              External             
   
 
3 ICASWT
         INTEGER FUNCTION ICASWT(IADD,IRUNC)
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Switch dead storey address in end-caps
   
      Author   :- M.N. Minard                3-SEP-1992
   
        IADD  = original encoded address from EDDB
        IRUNC = Run number of the current run
       Current event and event numbers
         LOGICAL INIRUC, FMCRUN
         INTEGER IRUNRC,IEVTRC,ISQNRC
         REAL RENLEP
         COMMON /RCURNT/IRUNRC,IEVTRC,ISQNRC, INIRUC, FMCRUN, RENLEP
   
     = The current run number
     = The current TRIGGER number (the event number on tape)
     = The number of the event counted from the start
     = .TRUE. if run has been initialised
     = .TRUE. if MC run
     = LEP c.m. Energy in GeV
   
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   EGETDS                                                                          
        |---- ICASWT                                                               
                   |----  IBITS                               External             
                   |----  ECMOD                                                    
   
 
3 ICFTOI
         SUBROUTINE ICFTOI(IDEB,IER)
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Convert frft type banks to itft type track banks.
   
    Author  : J.Sedgbeer  01/02/92
    Modified :- E. Lancon             14-FEB-1992
          Set NTMIN to 0, so that the number of tracks before and after
          is identical
   
      Input:
        IDEB  /I   : Debug flag; =0 for none, .GT.0 for lots.
        commons    : /BCS/    for BOS banks
        params     :  FRFTJJ,FRTLJJ,FICLJJ,FTCLJJ
                      ITFTJJ,IGTLJJ,IGCLJJ,TGTLJJ,TGCLJJ
   
      Output:
        IER   /I   : Error flag = 0  O.K.
                                = 1  Missing FRFT and/or FRTL.
                                = 2  Missing FICL and FTCL
                                     (must have one or both of these)
                                = 3  Inconsistent banks.
                                = 4  Not enough BOS space.
        BOS banks  : ITFT,IGTL,IGCL,TGTL,TGCL numbers 1 and 2
   
    Given banks FRFT, FRTL, FICL and FTCL this routine makes
    the banks ITFT, IGTL, IGCL, TGTL and TGCL (numbers 1 and 2)
    The TPC-ITC tracks from FRFT are put into ITFT bank number 1
    and the other tracks are put into ITFT number 2. The coord.
    lists in FRTL,FICL and FTCL are similarly split into IGTL,IGCL,
    TGTL and TGCL numbers 1 and 2.
    The split between TPC-ITC tracks and the rest is based on the
    TPC-ITC tracks always having at least NTMIN=3 TPC hits
    and appearing first in the list of tracks in FRFT, i.e. before
    the other tracks.
   
    ***  N.B. **
    Any VDET info. is ignored, i.e. VDET info. in FRTL
    and FVCL is not used to make VGTL and VGCL.
   
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   ITCREP                                                                          
        |---- ICFTOI                                                               
                   |----  NAMIND                              External             
                   |----  FORMAT                              External             
                   |----  AUBOS                               External             
                   |----  NLINK                               External             
                   |----  UCOPY                               External             
                   |----  BLIST                               External             
                   |----  BDROP                               External             
   
 
3 ICLIMB
         SUBROUTINE ICLIMB(ILNK,MODE)
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Climb up the tree via interconnecting links.
   
       Author      :- J. Sedgbeer 88/04/15
       Modified    :- I. Tomalin  89/06/07
   
      Input:
       ILNK    /I  : Link number
       MODE    /I  : = 1 if in TPC track extension phase.
                     = 2 if in ITC stand alone phase.
            commons: /BCS/, /ITRKPA/, /ITGAPC/, /IWBNKT/
   
      Output: None
   
      called by : IFIND1 and IFIND2
      calls     : ISAVE
   
      Libraries required: none
   
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   IFIND1                                                                          
   IFIND2                                                                          
        |---- ICLIMB                                                               
                   |----  NUMISS                              External             
                   |----  ISAVE                                                    
                   |----  MIN                                 External             
   
 
3 ICRCCO
         SUBROUTINE ICRCCO
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Create corrected coord. bank
   
      Author     :-  J.Sedgbeer 16/01/90
      Modified   :-  J.Sedgbeer 24/10/91 Use function IRESRP to set r-phi
                                         resolution in ICCO
      Input:
        need commons /BCS/    for BOS banks
             params: ICCOJJ
                     ITCOJJ
                     ITFTJJ
                     IGTLJJ
   
      Output: ICCO
   
      called by : ITCREC
      calls     : none
   
      Libraries required: BOS
   
     Description: Use track trajectories (ITFT 1&2) to make corrected
     coords. - these are stored in bank ICCO. ICCO used by UFTTRK
     track fitting routine. Note that only coords. associated with
     tracks can be corrected. Also, only coords. on the first arc
     of the track are corrected (i.e. not coords. on further spirals).
   
    Check for ITCO and ITFT etc banks
    Loop over track banks (ITFT(1) and ITFT(2))
      Set pointers
      Loop over tracks with ITC coords in 1st arc
        Get track crossing angle and z at each ITC layer (UTCXNG)
        Loop over coords. on track
          Get sense wire coord (UTSWCO)
          Correct for alignment (ITROTN)
          Get the drift distance and hence coord.
          Fill ICCO
        Endloop
      Endloop
    Endloop
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   ITCREC                                                                          
        |---- ICRCCO                                                               
                   |----  NAMIND                              External             
                   |----  NLINK                               External             
                   |----  AUBOS                               External             
                   |----  BLIST                               External             
                   |----  UTKXNG                              External             
                   |----  IABS                                External             
                   |----  MOD                                 External             
                   |----  UTSWCO                              External             
                   |----  ITROTN                              External             
                   |----  ICDRIF                              External             
                   |----  AMOD                                External             
                   |----  IRESRP                              External             
                   |----  FORMAT                              External             
   
 
3 IDEADW
         SUBROUTINE IDEADW
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Simulate dead wires/channels in monte carlo data
   
      Author          :-  J. Sedgbeer  89/06/05
      Modified        :-  J. Sedgbeer  89/07/28
      Modified        :-  J.Sedgbeer 90/05/23 Allow for IHIT M.C. Bank
      Modified        :-  J.Sedgbeer 91/01/07 Ensure IWST bank exists.
   
      Input:
                   INOZ     bank (card)
       params.:    IWSTJJ   for IWST bank
                   IDIGJP   for IDIG bank
                   ITHTJJ   for ITHT bank
                   IHITJJ   for IHIT bank
                   IDHRJJ   for IDHR bank
                   ALCONS
       commons:    /BCS/    for banks  IWST, IDIG, ITHT, IDHR
                   /RCURNT/ for run number
   
      Output:      Modified IDIG bank
   
      calls     : AGETDB (Alephlib)
   
      libraries:  BOS,CERNLIB
   
      Description:
    Simulate dead wires/channels in Monte Carlo data.
    If INOZ card exists then kill all Z digitisings in ITC.
    Get wire status bank IWST. Use this to adjust/kill some digitisings
    to simulate real data.
    If no valid bank then no dead wire map assumed.
   
    Get IDIG bank - if missing return
    Get IHIT (or ITHT) and IDHR banks - if missing return
                                           (assures Monte carlo)
    If INOZ bank (card) exists then
      Loop over all digits in IDIG
        Kill Z digitising
      Endloop
    endif
    Get IWST bank.
    If no IWST bank then return
    Loop over dead wires in IWST
      Loop over digits in IDIG
        if wire number matches then adjust contents of IDIG
      endloop
    endloop
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   IPREDA                                                                          
        |---- IDEADW                                                               
                   |----  NAMIND                              External             
                   |----  NLINK                               External             
                   |----  MVBITS                              External             
                   |----  IBITS                               External             
                   |----  IFIX                                External             
   
 
3 IDIGPR
         SUBROUTINE IDIGPR
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Print idig bank.
   
       Author     :- J. Sedgbeer   89/04/11
       Modified   :-
   
       Input:
         commons:     /BCS/  for bank IDIG
                      /RCURNT/
   
       calls:      none
   
       Libraries required: BOS
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   IPREDA                                                                          
        |---- IDIGPR                                                               
                   |----  NAMIND                              External             
                   |----  RERROR                                                   
                   |----  IBITS                               External             
                   |----  IZDIGFORMAT                         External             
                   |----  IZDI2FORMAT                         External             
   
 
3 IENANG
         SUBROUTINE IENANG(IH,IA,JH,JA,ENI,ENJ)
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Itc: calculate angle through cell.
   
       Author      :- J. Sedgbeer 88/03/29
       Modified    :- I. Tomalin  89/02/28
   
      Input:
         IH    /I  : Coord number (row) in ITCO
         IA    /I  : Ambiguity : 0 => -ve, -1 => +ve
         JH    /I  : Coord number (row) in ITCO
         JA    /I  : Ambiguity : 0 => -ve, -1 => +ve
   
    N.B. If coord. JH lies outside coord IH, then this subroutine will
    assume that the track is going outwards and give ENI and ENJ approx 0.
    However, if this is not the case, then it will assume that it is going
    inwards, and will produce ENI and ENJ approx pi.
   
         commons:     /BCS/
                      /ITNAMC/
         params.:     ALCONS,ITCOJJ
   
      Output:
         ENI   /R  : Angle at which line IH-JH crosses layer IH
         ENJ   /R  : Angle at which line IH-JH crosses layer JH
   
      calls:  None
   
      Libraries required: none
   
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   IFITP                                                                           
   ITLNK2                                                                          
        |---- IENANG                                                               
                   |----  NAMIND                              External             
                   |----  COS                                 External             
                   |----  SIN                                 External             
                   |----  SQRT                                External             
                   |----  MOD                                 External             
                   |----  ACOS                                External             
   
 
3 IFIND1
         SUBROUTINE IFIND1(ITRY,IDTPC,SPIRAL)
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Find paths in trees
   
       Author      :- J. Sedgbeer 88/04/14
       Modified    :- J. Sedgbeer 88/05/09
       Modified    :- I. Tomalin  89/06/07
   
      Input:
         ITRY   /I : Type of search flag
         commons:     /BCS/
                      /ITRKPA/
                      /ITGAPC/
                      /IWBNKT/
   
      Output:
         commons:     /IPATHC/ initialse no. of paths to zero
                      /ITTIME/ CPU time taken by IFITP
   
      called by : ITRAK
      calls     : ICLIMB,IFITP
   
      Libraries required: none
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   IGICHA                                                                          
        |---- IFIND1                                                               
                   |----  ICLIMB                                                   
                   |----  ALTIME                                                   
                   |----  IFITP                                                    
   
 
3 IFIND2
         SUBROUTINE IFIND2(ITRY)
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Find paths in trees
   
       Author      :- J. Sedgbeer 88/04/14
       Modified    :- J. Sedgbeer 88/05/09
       Modified    :- I. Tomalin  89/02/28
   
      Input:
         ITRY   /I : Type of search flag
         commons:     /BCS/
                      /ITRKPA/
                      /ITGAPC/
                      /IWBNKT/
   
      Output:
         commons:     /IPATHC/ initialse no. of paths to zero
                      /ITTIME/ CPU time taken by IFITP
   
      called by : ITRAK
      calls     : ICLIMB,IFITP
   
      Libraries required: none
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   ITRAK                                                                           
        |---- IFIND2                                                               
                   |----  MIN                                 External             
                   |----  ICLIMB                                                   
                   |----  ALTIME                                                   
                   |----  IFITP                                                    
   
 
3 IFITP
         SUBROUTINE IFITP(ITRY,MODE,SPIRAL,IDTPC,IER)
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Fit found paths.
   
       Author      :- J. Sedgbeer 88/04/25
       Modified    :- J. Sedgbeer 88/05/09
       Modified    :- I. Tomalin  89/09/01
       Modified    :- J.Sedgbeer  91/09/10 If MODE=1 and 1st arc then fit
                                  with TPC points.
   
      Input:
         ITRY   /I : Type of search flag
         MODE   /I : = 1 if in TPC track extension phase.
                     = 2 if in ITC stand alone phase.
         SPIRAL /L : =FALSE if one is studying the 1st arc of a track.
                     =TRUE otherwise (N.B. spiralling tracks can have
                        many arcs/orbits).
         IDTPC  /I : If MODE=1, then IDTPC is the no. in the TGFT bank
                      of the TPC track being extended.
                     If MODE=2, then it is a dummy variable.
         commons:     /BCS/
                      /IPATHC/
                      /ITRKPA/
                      /IWBNKT/
                      /ITRKCC/
                      /UFITCB/
         params.:     ITFTJJ,IGTLJJ,ITCOJJ
   
      Output:
         IER    /I : Error flag   = 0 if one or more tracks were found
                                  = 1 if no tracks were found
                                  = 2 if there were problems with banks
   
      called by : IGICHA and IFIND2
      calls     : IENANG, IPHCOR, UFITMS
   
      Libraries required: BOS
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   IFIND1                                                                          
   IFIND2                                                                          
        |---- IFITP                                                                
                   |----  NAMIND                              External             
                   |----  NLINK                               External             
                   |----  RERROR                                                   
                   |----  AUBOS                               External             
                   |----  FORMAT                              External             
                   |----  ABS                                 External             
                   |----  IENANG                                                   
                   |----  IPHCOR                                                   
                   |----  UFITMS                                                   
                   |----  ASIN                                External             
                   |----  MAX                                 External             
                   |----  PROB                                External             
                   |----  CLMINI                              External             
   
 
3 IFTRAK
         SUBROUTINE IFTRAK
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Finalise itc tracking
   
       Author      :- J. Sedgbeer 87/04/22
       Modified    :- I. Tomalin  88/11/17
   
      Input:
        need common: /BCS/,/ITRKCC/,/IWBNKT/
             params: IGTLJJ,ITFTJJ
   
      Output:
         finalised banks ITFT#2, IGCL#2, IGTL#2
   
      called by : ITCTRK
      calls     : None
   
      Libraries required: BOS,CERNLIB
   
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
              IFTRAK                                                               
                   |----  NLINK                               External             
                   |----  AUBOS                               External             
                   |----  FORMAT                              External             
                   |----  BLIST                               External             
                   |----  WDROP                               External             
   
 
3 IGETTI
         SUBROUTINE IGETTI(IER)
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Decide in which order to try extending the tpc tracks.
   
       Author      :- J. Sedgbeer 87/02/09
       Modified    :- J. Sedgbeer 88/06/20
       Modified    :- I. Tomalin  89/02/28
   
      Input:
        need commons /BCS/ for TGFT,TPCO,TGTL,TGCL banks
             params.  TGFTJJ
   
      Output:
              /IWBNKT/ Contains pointer to IWTPCP work bank.
           IER   /I  : IER = 0 if everything is O.K.
                       IER = 1 if insufficient BOS space.
   
      called by : ITCTPC
      calls     : SORTZV
   
      Libraries required: CERNLIB
   
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   ITCTPC                                                                          
        |---- IGETTI                                                               
                   |----  NAMIND                              External             
                   |----  WDROP                               External             
                   |----  RERROR                                                   
                   |----  WBANK                               External             
                   |----  ABS                                 External             
                   |----  SORTZV                              External             
                   |----  FORMAT                              External             
   
 
3 IGETTP
         SUBROUTINE IGETTP(INTPC,SPIRAL,PAR,COV,OUT,DSPIR,IGOOD,MORE)
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   See if tpc track intpc is a good candidate for extension and if it
      is then store the helix parameters decribing it.
   
       Author      :- J. Sedgbeer 87/02/09
       Modified    :- J. Sedgbeer 87/10/30
       Modified    :- I. Tomalin  89/02/28
       Modified    :- D. Cinabro  91/05/29
   
      Input:
        - INTPC  /I4  : number of track in TGFT bank
        - SPIRAL /L4  : =FALSE if one is studying the 1st arc of a track.
                        =TRUE otherwise (N.B. spiralling tracks can have
                           many arcs/orbits).
        need commons /BCS/    for TGFT bank
             params  ALCONS
                     TGFTJJ
                     TARCJJ
                     TGTLJJ
                     TPCOJJ
   
      Output:
        - PARi   /R4  : TPC track parameters
                        i=1,6  sig*r0,tanl,phi0,d0,z0,TPC track no.
        - COVi   /R4  : TPC track covariance matrix (as in TGFT bank).
        - OUT    /L4  : .TRUE. if particle moved outwards though the
                        detector along the current arc.
        - DSPIR  /R4  : Approximately, this is the path length which
                        the particle has traversed.
        - IGOOD  /L4  : .TRUE. if this TPC track is a good candidate for
                        extension
        - MORE   /L4  : .TRUE. if there remain further arcs of this
                         track to be explored.
   
      called by : ITCTPC
      calls     : none
   
      Libraries required: CERNLIB
   
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   ITCTPC                                                                          
        |---- IGETTP                                                               
                   |----  NAMIND                              External             
                   |----  NLINK                               External             
                   |----  ABS                                 External             
   
 
3 IGICHA
         SUBROUTINE IGICHA(PAR,COV,SPIRAL,OUT,DSPIR)
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Get itc chain from tpc track parameters.
   
       Author      :- J. Sedgbeer 87/02/09
       Modified    :- J. Sedgbeer 88/05/09
       Modified    :- I. Tomalin  89/06/07
   
      Input:
        PARi   /R4 : TPC track parameters.
                    i=1,6 (sig*r0,tanl,phi0,d0,z0,TPC track no.)
        COVi   /R4 : TPC track covariance matrix (as in TGFT bank).
        SPIRAL /L4 : =FALSE if one is studying the 1st arc of a track.
                     =TRUE otherwise (N.B. spiralling tracks can have
                       many arcs/orbits).
        OUT    /L4  : .TRUE. if particle moved outwards though the
                        detector along the current arc.
        DSPIR  /R4  : Approximately, this is the path length which
                        the particle has traversed.
            commons: /BCS/
                     /ITRKPA/ tracking consts.
                     /ITRKCC/ scattering radius between ITC and TPC.
                     /IWBNKT/ pointers to work banks.
            params.:  ALCONS
   
      Output:
           commons:  /IROADC/
                     /ITTIME/
   
      called by : ITCTPC
   
      calls :  INSECT   Intersection of TPC track with ITC layer
               ISRCH    search ITC coords.
               ITLNK1   form links
               ITREE    form tree
               IFIND1   find paths
               IFITP    fit paths
   
      Libraries required: none
   
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   ITCTPC                                                                          
        |---- IGICHA                                                               
                   |----  ABS                                 External             
                   |----  ASIN                                External             
                   |----  MOD                                 External             
                   |----  SQRT                                External             
                   |----  MIN                                 External             
                   |----  COS                                 External             
                   |----  VZERO                               External             
                   |----  ALTIME                                                   
                   |----  INSECT                                                   
                   |----  ISRCH                                                    
                   |----  FORMAT                              External             
                   |----  ITLNK1                                                   
                   |----  ITREE                                                    
                   |----  INT                                 External             
                   |----  IFIND1                                                   
                   |----  WDROP                               External             
   
 
3 IHELER
         SUBROUTINE IHELER (RINV,TL,P0,D0,Z0,CM,
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
        +                   R,PHI,Z,ZERR,PHERR,IFLAG)
   Calculate errors in coordinates on a helix.
   
       Author                M J Phillips with J Sedgbeer    01-Jan-1991
   
       Input             (  RINV       inverse radius of curvature
                         (  TL         tan (lambda) = tan (dip angle)
            usual        (  P0         phi-zero
             track       (  D0         d-zero
              parameters (  Z0         z-zero
                            CM(15)     Covariance matrix
   
                                              RINV  TL  P0  D0  Z0
                                             ----------------------
                                       RINV     1    2   4   7  11
                                       TL            3   5   8  12
                                       P0                6   9  13
                                       D0                   10  14
                                       Z0                       15
   
                            R          ) Coordinates of point on track.
                            PHI        ) NB There is no check that this
                            Z          ) point actually lies on the
                                         specified helix
   
       Output               ZERR       Error in z-coordinate
                            PHERR      Error in phi-coordinate
                            IFLAG = 0  Successful
                                    1  Unsuccessful
   
       Description
       ===========
       The errors of a point on a helix are calculated, as a function
       of the coordinates of that point, the parameters of the track,
       and the errors in those parameters.
   
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   ITEXTN                                                                          
        |---- IHELER                                                               
                   |----  SQRT                                External             
                   |----  ABS                                 External             
   
 
3 IINIJO
         SUBROUTINE IINIJO
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Initialise the itc job
   
      Author     :-  J. Sedgbeer  87/03/02
      Modified   :-  I. Tomalin   88/08/25
      Modified   :-  J. Sedgbeer  90/01/06 Set up ITC options as TINIJO
      Modified   :-  J. Sedgbeer  91/01/07 Correct write format.
   
      Input:
          common       /BCS/
   
      Output:
          common:     /ITTIME/ initialise timing information.
                      /IFLAGS/ ITC tracking options
   
      called by : RINJOB
   
      calls : IBNKIN      ITC Bos bank initialisation.
              IPDSTI      ITC Prepare Data Statistics Initialisation.
   
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   RINJOB                                                                          
        |---- IINIJO                                                               
                   |----  IBNKIN                                                   
                   |----  NAMIND                              External             
                   |----  CHAINT                              External             
                   |----  IPDSTI                                                   
   
 
3 IINIRU
         SUBROUTINE IINIRU
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Initialise the itc run
   
      Author          :-  J. Sedgbeer  87/03/02
      Modified        :-  J. Sedgbeer  90/01/04 Mod. RERROR calls.
      Modified        :-  J. Sedgbeer  92/01/30 Mod. RERROR calls.
   
      Input:  /RCURNT/ for run number
   
      Output: none
   
      called by : RINRUN
   
      calls : IRDDAF (Alephlib)    Set up ITC constants for 'prepare data
              IPRDAF (Alephlib)    Print ITC 'prepare data' consts.
              IINTRK               Initialise ITC tracking constants
              ITRKCI               Initialise ITC tracking commons
   
     Description
     -----------
    Initialise constants and parameters needed in reconstruction program.
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   RINRUN                                                                          
        |---- IINIRU                                                               
                   |----  IRDDAF                              External             
                   |----  RERROR                                                   
                   |----  IPRDAF                              External             
                   |----  IINTRK                                                   
                   |----  ITRKCICONTINUE                      External             
   
 
3 IINTRK
         SUBROUTINE IINTRK
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Initialise constants and parameters needed for itc tracking.
   
       Author      :- J. Sedgbeer 87/02/09
       Modified    :- I. Tomalin  88/08/25
       Modified    :- J. Sedgbeer 90/01/17 Get consts. for 'refine' stage
                                           Change ALGTDB to AGETDB
       Modified    :- J. Carr 91/02/18 Change contstants for refin
     Input:
        commons:  /RCONDS/  (for FIELRC)
                  /RCURNT/  for current run number
                  /BCS/
        banks  :  ITKP from 'DB'
        params.:  ITKPJJ  for ITKP bank
   
      Output:
        fill common /ITRKCC/
                    /IASIGC/
   
      called by : IINIRU
      calls     : AGETDB (Alephlib)
   
      libraries:  BOS
   
      Description:
    Set up constants and parameters needed in the reconstruction program.
    Get data from direct access file (filled from D.B.).
    Input cards may be used to override the values in the d.a. file.
   
    IINTRK
    Check validity of ITKP bank - AGETDB
    If no ITKP bank then
       Fatal report
    Endif
    If first time or ITKP bank has changed then
       get values from ITKP bank.
    Endif
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   IINIRU                                                                          
        |---- IINTRK                                                               
                   |----  ILIVEW                              External             
                   |----  AGETDB                              External             
                   |----  RERROR                                                   
                   |----  NAMIND                              External             
                   |----  ABS                                 External             
                   |----  LOG10                               External             
                   |----  SQRT                                External             
   
 
3 IMATCH
         SUBROUTINE IMATCH
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Match up unextended tpc with itc stand-alone tracks.
   
       Authors     :- L. Garrido, I. Tomalin  89/05/01
       Modified    :- I. Tomalin  89/09/01
   
      Input:
        need common:/BCS/
                    /ITRKCC/
                    /ITRKPA/ for tracking cuts
                    /UFITCB/
             params: ALCONS,IGTLJJ,TGTLJJ,ITFTJJ,TGFTJJ,ITCOJJ
   
      Output:
         Modification of banks ITFT, IGTL and IGCL (no.'s 1 and 2)
   
      called by : ITCREC
      calls     : UFITMS
   
      Libraries required: BOS,CERNLIB
   
    Loop over all unextended TPC tracks
      Loop over all ITC stand-alone tracks
        Apply cuts:
        Phis at scatt. radius, RSCAIT, must differ by less than DELMIN.
        CHI**2 of comparison of helix params must be less than CHI2PM.
        Do a simple fit (IOPT=1) to the combined track.
        CHI**2 of fit must be less than CHI2T1.
        If track pair is O.K. then store it in IMATIW work bank.
      End Loop
    End loop
    If two or more matches have a track in common, then eliminate all but
    the best match from the IMATIW bank.
    Loop over the matches in the IMATIW bank.
      Do a proper fit (IOPT=4) to the combined track.
      CHI**2 of final fit must be less than CHI2T4.
      Store it, updating the ITFT, IGTL and IGTL banks.
    End loop
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   ITCREC                                                                          
        |---- IMATCH                                                               
                   |----  NLINK                               External             
                   |----  WDROP                               External             
                   |----  RERROR                                                   
                   |----  WBANK                               External             
                   |----  UCOPY                               External             
                   |----  SQRT                                External             
                   |----  ABS                                 External             
                   |----  ASIN                                External             
                   |----  MOD                                 External             
                   |----  UFITMS                                                   
                   |----  AUBOS                               External             
   
 
3 INIGAP
         SUBROUTINE INIGAP
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Set up itc gap common
   
       Author      :- J. Sedgbeer 88/03/29
       Modified    :- I. Tomalin  89/02/28
   
      Input:
   
      Output: common /ITGAPC/
   
      called by : ITRKCI
      calls     : None
   
      Libraries required: none
   
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   ITRKCI                                                                          
        |---- INIGAP.                                                              
   
 
3 INSECT
         SUBROUTINE INSECT(ITRY,LAYER,PAR,COV,TPHIS,THSCT,XPAR,ROAD,IWWIN,
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
        +IER)
   Intersect tpc track with itc layer.
   
       Author      :- J. Sedgbeer 87/02/09
       Modified    :- J. Sedgbeer 88/06/22
       Modified    :- I. Tomalin  89/09/01
       Modified    :- P. Comas    94/08/18
       Modified    :- J.Sedgbeer  95/08/10 Add test for intersection.
                      Also tighten sin(A) test to not allow angles too
                      near 90 deg.
   
      Input:
        ITRY   /I  : Type of search flag
        LAYER  /I4 : ITC layer number
        PARi   /R4 : TPC track parameters (sig*r0,tanl,phi0,d0,z0)
        COVi   /R4 : TPC Covariance matrix (as in TGFT bank)
        TPHIS  /R4 : Phi of TPC track at intersection with scatt. radius
        THSCT  /R4 : r.m.s. scat. angle of TPC track (proj. into r-phi)
        need commons /ITWICC/ for ITC geom.
                     /ITRKCC/ for tracking params and constants.
                     /IRESOL/ for resolution.
                     /ITRKER/ for tracking param.
        need  ALCONS  for pi etc.
   
      Output:
        XPARi  /R4 : i=1  phi of  intersection
                     i=2  z of intersection
                     i=3  angle of track thro cell
        ROADi  /R4 : i=1  1 sigma uncertainty in XPAR(1) (cm)
                     i=2  1 sigma uncertainty in XPAR(2) (cm)
        IWWINi /I4 : i=1  lower bound of wire numbers inside road
                     i=2  upper bound of wire numbers inside road
        IER    /I4 : error flag   = 0  O.K.
                                  = 1 no intersection
   
      called by : IGICHA
      calls     : none
   
      Libraries required: none
   
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   IGICHA                                                                          
        |---- INSECT                                                               
                   |----  ABS                                 External             
                   |----  ASIN                                External             
                   |----  MOD                                 External             
                   |----  SQRT                                External             
                   |----  MIN                                 External             
                   |----  ITROTN                              External             
                   |----  TAN                                 External             
                   |----  MAX                                 External             
                   |----  FLOAT                               External             
                   |----  PHWRIT                              External             
                   |----  AMOD                                External             
                   |----  INT                                 External             
   
 
3 INTRAK
         SUBROUTINE INTRAK(IER)
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Itc tracking prog. initialisation
   
       Author      :- J. Sedgbeer 88/03/29
       Modified    :- J. Sedgbeer 88/05/09  Part moved to start of job.
       Modified    :- I. Tomalin  88/11/17
   
      Input:
         commons:     /BCS/
         params.:     ITCOJJ,ITFTJJ,IGTLJJ
   
      Output:
         IER   /I  : Error flag: = 0 if O.K.,
                                 = 1 if no ITCO bank,
                                 = 2 if insufficient BOS space.
         commons:     /IWBNKT/   Set pointers to work banks used
   
      called by : ITCTRK
      calls     : none
   
      Libraries required: BOS, Alephlib
   
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   ITCTRK                                                                          
        |---- INTRAK                                                               
                   |----  NLINK                               External             
                   |----  AUBOS                               External             
                   |----  RERROR                                                   
                   |----  WDROP                               External             
   
 
3 IPAKDI
         SUBROUTINE IPAKDI(IER)
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Pack itc digits. for pot output.
   
       Author     :- I. Tomalin
       Modified   :- J. Sedgbeer   89/02/10   Separated out from IPREDA.
       Modified   :- J. Sedgbeer   89/04/11
       Modified   :- J. Sedgbeer 91/09/10 Remove obsolete setting of bit
                     31 (last bit) in PIDI.
       Input:
         commons:       /BCS/  for banks  IDIG - ITC digitisings
                                     and  IDCR - Digit-to-Coord relation
                        /RCURNT/ run and event number.
         parameters:    PIDIJJ
                        IDIGJP
   
       Output:
         IER   /I     : error flag:  = 0 if all O.K.
                                     = 1 if missing or empty input banks
                                     = 2 if not enough BOS space
         PIDI bank      packed ITC digitisings.
   
       called by : IPREDA
       calls     : AUBOS
   
       Libraries required: BOS
   
    IPAKDI: Create ITC packed digitisings bank PIDI for POT output.
    N.B. : Only 'good' digits are packed, i.e. only digits which have
    a corresponding coordinate in the ITCO bank. The IDCR bank is
    used to check for the existence of a coord.
    Hence, the PIDI bank is in 1-to-1 correspondence with the ITCO bank
    not with the IDIG bank.
   
    Get IDIG bank and IDCR bank
    Loop over digitisings
      If Digit has a corresponding Coord. then
        Store in PIDI bank
      Endif
    End Loop
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   IPREDA                                                                          
        |---- IPAKDI                                                               
                   |----  NAMIND                              External             
                   |----  AUBOS                               External             
                   |----  RERROR                                                   
   
 
3 IPDSTI
         SUBROUTINE IPDSTI
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Itc prepare data statistics initialise
   
      Author     :-  J. Sedgbeer  88/05/09
      Modified   :-
   
      Input:  none
   
      Output:  common: /IPDSTC/ prepare data stats. common initialised
   
      called by : IINIJO
      calls     : none
   
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   IINIJO                                                                          
        |---- IPDSTI.                                                              
   
 
3 IPHCOR
         REAL FUNCTION IPHCOR(IC,IAMB,ENANG,DTCOR)
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Apply drift-time correction to phi value.
   
       Author      :- J. Sedgbeer 87/02/09
       Modified    :- I. Tomalin  89/08/17
       Modified    :- J. Sedgbeer 89/10/14 Use Fine-tune d-t corrs.(IEDD)
       Modified    :- J. Sedgbeer 89/11/02
       Modified    :- J. Sedgbeer 93/07/01 Use func. IDDIST for
                                           calc. of drift-distance.
   
      Input:
         IC   /I  :  Coord number in ITCO bank
         IAMB /I  :  Ambiguity in ITCO bank:
                      =  0 => use parameter offset JITCP2
                      = -1 => use     "       "    JITCP1
         ENANG/R  :  entrance angle of track segment
         DTCOR/R  :  drift time in ITCO bank to be increased by DTCOR
        commons: /BCS/
                 /ITWICC/ ITC wire geom.
        params : ITCOJJ
                 IEDDJJ
                 ALCONS
   
      Output:
         IPHCOR /R : Corrected phi value
   
      calls:   IDDIST (Alephlib)
      Libraries required: none
   
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   IFITP                                                                           
   ISRCH                                                                           
   ITLNK2                                                                          
        |---- IPHCOR                                                               
                   |----  NAMIND                              External             
                   |----  IDDIST                              External             
                   |----  CELWIT                              External             
                   |----  ABS                                 External             
                   |----  MAX                                 External             
                   |----  COS                                 External             
   
 
3 IPREDA
         SUBROUTINE IPREDA
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Prepare itc data.
   
       Author          :- J. Sedgbeer
       Modified        :- I. Tomalin    88/08/25
       Modified        :- J. Sedgbeer   89/04/11
       Modified        :- J. Sedgbeer   89/06/05
       Modified        :- J. Sedgbeer   90/01/04 Add IFCO bank to list.
                                                 Tidy write statements.
       Modified        :- J. Sedgbeer   92/01/30 Remove obsolete code
                                     (fixes for very old MC; IFCO bank)
       Input:
         commons:       /BCS/    for bank IDIG
                        /RCURNT/ run and event number
   
       Output:
                        /ITTIME/ CPU time taken by IPREDA
   
       called by : RPREDA
       calls     : ICRCOO (Alephlib) Create ITC coords from digis.
                   ITCOPR            Print ITC coords.
                   IPAKDI            Pack digits for POT output.
                   IPSTAT            Prepare data statistics and histos.
                   IDEADW            Simulate dead wires/channels
   
       Libraries required: BOS, CERNLIB
   
    Prepare ITC data: Make coords from digitisings using Alephlib
    ITC routines ICRCOO etc.
   
    Check for IDIG bank
    If IDIG bank exists then
      If Galeph data then simulate dead wires/channels
      Create coordinates (ITCO and IDCR) from IDIG
      Add banks to BOS lists
      Create packed digis. bank PIDI for POT
    Endif
    Stats. and histos. for prepare data
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   RPREDA                                                                          
        |---- IPREDA                                                               
                   |----  ALTIME                                                   
                   |----  NAMIND                              External             
                   |----  IDEADW                                                   
                   |----  ICRCOO                              External             
                   |----  BLIST                               External             
                   |----  IEVTRCFORMAT                        External             
                   |----  IDIGPR                                                   
                   |----  ITCOPR                                                   
                   |----  IPAKDI                                                   
                   |----  RERROR                                                   
   
 
3 IPRSUM
         SUBROUTINE IPRSUM
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Print run statistics for itc
   
      Author     :-  J. Sedgbeer  88/05/09
      Modified   :-  I. Tomalin   88/08/25 to print out timing info.
      Modified   :-  J.Sedgbeer + I.Tomalin   89/06/05
   
      Input:   commons: /IPDSTC/ prepare data stats.
                        /ITTIME/ timing information.
   
      Output:  none.
   
      called by : RSMJOB
      calls     : none
   
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   RSMJOB                                                                          
        |---- IPRSUM                                                               
                   |----  FLOAT                               External             
   
 
3 IPSTAT
         SUBROUTINE IPSTAT
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Itc prepare data statistics and histograms.
   
       Author       :- J. Sedgbeer   89/02/06
       Last Modified:- J. Sedgbeer   89/06/05
   
       Input:
         commons:       /BCS/ => banks IDIG and ITCO
                        /RCURNT/  run and event number
         params.:       IDIGJP
   
       Output:
         commons:       /IPDSTC/ Prepare data statistics updated.
   
       calls     : none
   
       Libraries required: BOS,CERNLIB
   
    IPSTAT.  ITC prepare statistics - update common /IPDSTC/.
       Histograms for the IDIG bank (Done here and not in ITHIST
       as the raw data banks are dropped after the prepare data phase.
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
              IPSTAT                                                               
                   |----  NAMIND                              External             
                   |----  FLOAT                               External             
                   |----  HFILL                               External             
                   |----  JHISRF                              External             
                   |----  IBITS                               External             
   
 
3 IREFIN
         SUBROUTINE IREFIN
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Refine/improve itc tracks.
   
      Author     :- W.Atwood, J.Sedgbeer 15/01/90
      Modified   :- J.Sedgbeer  25/04/90 Check Phi in range 0-2pi in ICCO
                     + Bug fix: explicitly test track number in loop 210
      Modified   :- J.Sedgbeer 09/05/90 Protect against divide checks.
      Modified   :- J.Carr     13/2/91 Various changes
      Modified   :- J.Sedgbeer 21/10/91 Bug fix. Set Xhit,Yhit even for
                                        very small DOCAs.
      Modified   :-  J.Sedgbeer 24/10/91 Use function IRESRP to set r-phi
                                         resolution in ICCO
      Modified   :- D.Casper 29/06/96 don't drop old ICCO, to keep valid
                                      coordinates
   
      Input:
        need commons /BCS/    for BOS banks
                     /ITCINF/ coord. reassignment info.
                     /IASIGC/ cuts for reassignment
             params: ICCOJJ
                     ICTRJJ
                     ITCOJJ
                     IGTLJJ
                     ALCONS
   
      Output: updataed coord. lists, IGTL and IGCL, and ICCO bank.
   
      called by : ITCREC
      calls     : IASIGN - fill /ITCINF/
                  ISHUFL - shuffle coord. lists
   
      Libraries required: BOS
   
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   ITCREC                                                                          
   ITCREP                                                                          
        |---- IREFIN                                                               
                   |----  NAMIND                              External             
                   |----  NLINK                               External             
                   |----  ILATCH                              External             
                   |----  IASIGN                                                   
                   |----  AUBOS                               External             
                   |----  BLIST                               External             
                   |----  ITCCUT                                                   
                   |----  NGHITC                              External             
                   |----  ITKITC                              External             
                   |----  ICOITC                              External             
                   |----  FLGITC                              External             
                   |----  ABS                                 External             
                   |----  RSFITC                              External             
                   |----  DERITC                              External             
                   |----  SIGN                                External             
                   |----  DDSITC                              External             
                   |----  FORMAT                              External             
                   |----  ISHUFL                                                   
                   |----  DCAITC                              External             
                   |----  SIN                                 External             
                   |----  FIWITC                              External             
                   |----  COS                                 External             
                   |----  HTXITC                              External             
                   |----  WRXITC                              External             
                   |----  SQRT                                External             
                   |----  ATAN2                               External             
                   |----  AMOD                                External             
                   |----  HTDITC                              External             
                   |----  AUARCM                              External             
                   |----  IRESRP                              External             
                   |----  NDROP                               External             
   
 
3 IREOPD
         SUBROUTINE IREOPD(IERR)
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Reorder the packed digits.(pidi) according to tracks (ficl).
   
       Author     :- I. Tomalin    88/08/25
       Modified   :- J. Sedgbeer   89/04/11  Cosmetic changes.
       Modified   :- I. Tomalin    89/06/01
   
       Input:
         commons:       /BCS/    for banks  PIDI and FICL
                        /RCURNT/ run and event number
   
       Output:
         reordered PIDI bank
         IERR  /I  : error flag:
                        IERR = 0 if everything was O.K.
                        IERR = 1 insufficient space in the BOS array.
                                   Hence PIDI bank not reordered.
                        IERR = 2 if the FICL or PIDI banks did not exist.
   
    Reorder the packed digits. bank (PIDI) so that instead of being
    ordered according to increasing wire number, it is ordered according
    to which hits have been assigned to which tracks (as given by the
    FICL bank).
    The routine IPAKDI is used to create the PIDI bank from the ITDI bank
   
     Check that the FICL and PIDI banks exist.
     Loop over the associated coordinates in the FICL bank.
       Find the corresponding coordinate numbers in the ITCO (PIDI) banks
       Use this to fill the new PIDI bank (adding coord. ambiguity info.)
       Note which digitisings are associated with tracks.
     End Loop
     Loop over digits in PIDI bank looking for unassociated ones.
       Place these at the end of the new PIDI bank
     End Loop
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   RDEFPO                                                                          
        |---- IREOPD                                                               
                   |----  NLINK                               External             
                   |----  WDROP                               External             
                   |----  RERROR                                                   
                   |----  WBANK                               External             
                   |----  ABS                                 External             
                   |----  IBSET                               External             
                   |----  BKFRW                               External             
   
 
3 ISAVE
         SUBROUTINE ISAVE(NLINK,LLINK,MODE)
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Save path in tree.
   
       Author      :- J. Sedgbeer 88/04/14
       Modified    :- I. Tomalin  89/06/07
   
      Input:
        NLINK    /I : No. of links in path
        LLINK(i) /I : List of links in path i=1,NLINK
   
      Output:
         commons:     /IPATHC/
   
      called by : ICLIMB
      calls     : none
   
      Libraries required: none
   
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   ICLIMB                                                                          
        |---- ISAVE .                                                              
   
 
3 ISHUFF
         SUBROUTINE ISHUFF(IDEB,IER)
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Shuffle/update frft type banks from itft type track banks.
   
    Author  : J.Sedgbeer  03/02/92
    Modified:
   
      Input:
        IDEB   /I : Debug flag; =0 for none, >0 for lots.
        commons   : /BCS/    for BOS banks
        params    :  FRFTJJ,FRTLJJ,FICLJJ,FTCLJJ,FVCLJJ
                     ITFTJJ,IGTLJJ,IGCLJJ,TGTLJJ,TGCLJJ
   
      Output:
        IER   /I  : Error flag
                     = 0  O.K.
                     = 1  Missing or empty input banks. Fxxx unchanged.
                     = 2  more rows in ITFT than FRFT!! Fxxx unchanged.
                     = 3  Not enough BOS space. Fxxx banks partially
                          changed therefore drop Fxxx banks before
                          exiting.
        Updated Banks  FRFT, FRTL, FICL, FTCL, FVCL
   
    ISHUFF:
    -------
    Update FRFT,FRTL,FICL,FTCL and FVCL banks using info. in
    ITFT, IGTL, IGCL, TGTL and TGCL bank numbers 1 and 2.
    ITFT type track banks are NOT dropped before exiting as they
    may be used in subsequent routines.
   
    ***  N.B. **
    This is NOT a general routine: the updating is very
    specific and is based on the assumption that the ITC coord.
    assignments may have changed, i.e. the tracks (ITFT type)
    have been passed through the IREFIN module of the ITC tracking.
    Hence, it is assumed that:
    - The number of TPC-ITC tracks (ITFT#1) has not changed and
      their track parameters, TPC and VDET coords. are also unchanged,
      i.e. only the ITC coord. assignment may have changed. Hence:
        FRTL must be updated from IGTL#1
        FICL must be updated from IGCL#1
   
    - If the total number of tracks (ITFT#1+ITFT#2) is unchanged
      (i.e. equal to the number of tracks in FRFT) then the track
      parameters, TPC and VDET coords. of all tracks are unchanged
      (i.e. only the ITC coord. assignment may have changed). Hence:
        FRTL must be updated from IGTL#2
        FICL must be updated from IGCL#2
   
    - If the total number of tracks ITFT(#1+#2) is less than FRFT
      then some ITFT#2 (so called ITC alone) tracks have been
      lost due to reassignment of ITC coords. In this case the
      track parameters and all coord. assignments (TPC,VDET and ITC)
      must be updated from ITFT#2, IGTL#2,IGCL#2, TGTL#2,TGCL#2, i.e.:
        FRFT must be updated from ITFT#2
        FRTL  "    "    "      "  IGTL#2 and TGTL#2
        FICL  "    "    "      "  IGCL#2
        FTCL  "    "    "      "  TGCL#2
      *** N.B. **
      Also, as there is no stored VDET info. for the ITFT#2
      tracks the VDET info cannot be updated and must therefore
      be set to zero, i.e. in FRTL and FVCL the VDET coords. on
      ITC-alone tracks must be removed.
   
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   ITCREP                                                                          
        |---- ISHUFF                                                               
                   |----  NAMIND                              External             
                   |----  NLINK                               External             
                   |----  FORMAT                              External             
                   |----  AUBOS                               External             
                   |----  UCOPY                               External             
                   |----  VZERO                               External             
                   |----  BDROP                               External             
   
 
3 ISHUFL
         SUBROUTINE ISHUFL(NTKITC,ITKITC,NCOMIN,NSPMIN,IER)
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Shuffle coord. lists due to reassignments
   
      Author     :- J.Sedgbeer  15/01/90
      Modified   :- J.Sedgbeer 07/01/91 Protect against very long
                                        spiralling tracks
   
      Input:
        NCOMIN(2) /I : Min. no. of coords allowed on 1st arc for
                       1) ITC-TPC tracks (ITFT#1) and 2) ITFT#2 tracks
        NSPMIN(2) /I : Min. no. of coords allowed on following spiral for
                       1) ITC-TPC tracks (ITFT#1) and 2) ITFT#2 tracks
   
        need commons /BCS/    for BOS banks
             params.  IGTLJJ
                      ICTRJJ
                      ITFTJJ
                      TGTLJJ
                      TPCOJJ
   
      Output: updated IGTL,IGCL lists.
        IER   /I : Error flag:  0 = O.K.
                                1 = I/P banks missing or no BOS space
                                    (all IGTL and IGCL banks unchanged)
                               -1 = No space to extend IGCL#2. Drop all
                                    banks #2.
   
      called by : IREFIN
      calls     : none
   
      Libraries required: BOS
   
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   IREFIN                                                                          
        |---- ISHUFL                                                               
                   |----  NAMIND                              External             
                   |----  NLINK                               External             
                   |----  WBANK                               External             
                   |----  ISIGN                               External             
                   |----  FORMAT                              External             
                   |----  IABS                                External             
                   |----  AUBOS                               External             
                   |----  UCOPY                               External             
                   |----  RERROR                                                   
                   |----  NDROP                               External             
                   |----  IF                                  External             
                   |----  CALLWDROP                           External             
                   |----  WDROP                               External             
   
 
3 ISLOWC
         SUBROUTINE ISLOWC
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Handle slow control for itc
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   RUNKNO                                                                          
        |---- ISLOWC.                                                              
   
 
3 ISRCH
         SUBROUTINE ISRCH(ITRY,ITYP,IL,XPAR,ROAD,IWWIN,PAR,OUT,DSPIR)
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Search itc coordinates in specified road.
   
       Author      :- J. Sedgbeer 87/02/09
       Modified    :- J. Sedgbeer 88/05/09
       Modified    :- I. Tomalin  89/09/01
       Modified    :- I. Tomalin  90/01/19
   
      Input:
       ITRY  /I : Type of search flag
       ITYP  /I : Search type:
                            = 1 closest hit only.
                            = 2 all hits in road (max NMAX) Test r-phi
       IL     /I : ITC layer number
       XPARi  /R4: phi, z and angle of intersection
       ROADi  /R4: 1 sigma uncertainties on XPAR(1) and XPAR(2)
       IWWINi /I4: wire numbers bounding the road
       PARi   /R4: TPC track parameters.
                   i=1,6 (sig*r0,tanl,phi0,d0,z0,TPC track no.)
       OUT    /L4  : .TRUE. if particle moved outwards though the
                        detector along the current arc.
       DSPIR  /R4  : Approximately, this is the path length which
                        the particle has traversed.
       need commons /BCS/ for ITCO and work banks
                    /ITWICC/ for ITC geometry
                    /IWBNKT/ for pointers to work banks
                    /ITRKPA/ for tracking constants
                    /ITRKER/ for tracking const.
            params.  ALCONS
                     ITCOJJ
   
      Output:
         Fills common /IROADC/ with information about coordinates inside
         the road in layer IL.
   
      called by : IGICHA
      calls real function IPHCOR for drift-time correction
   
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   IGICHA                                                                          
        |---- ISRCH                                                                
                   |----  NLINK                               External             
                   |----  ABS                                 External             
                   |----  SQRT                                External             
                   |----  IPHCOR                                                   
                   |----  MOD                                 External             
                   |----  MAX                                 External             
                   |----  COS                                 External             
                   |----  ZFACIT                              External             
   
 
3 ITBOOK
         SUBROUTINE ITBOOK
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Book itc histograms
   
      Author       :- J. Sedgbeer    87/03/02
      Modified     :- J. Sedgbeer    88/05/05
      Modified     :- J. Sedgbeer + I. Tomalin  89/06/05
   
      called by : RBKHIS
      calls     : none
   
      libraries:  HBOOK
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   RBKHIS                                                                          
        |---- ITBOOK                                                               
                   |----  JHISRF                              External             
                   |----  HBOOK1                              External             
   
 
3 ITCCUT
         SUBROUTINE ITCCUT
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Make cuts on itc points to be included on tracks.
   
      Author     :- J. Carr   11/02/91
   
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   IREFIN                                                                          
        |---- ITCCUT                                                               
                   |----  NHTITC                              External             
                   |----  NDHITC                              External             
                   |----  FLGITC                              External             
                   |----  RSFITC                              External             
                   |----  RMNITC                              External             
                   |----  DERITC                              External             
                   |----  ABS                                 External             
                   |----  NLINK                               External             
                   |----  AUBOS                               External             
                   |----  BLIST                               External             
                   |----  ICOITC                              External             
                   |----  TERITC                              External             
                   |----  NDROP                               External             
                   |----  RERROR                                                   
   
 
3 ITCOPR
         SUBROUTINE ITCOPR(NUM)
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Print itco bank number num.
   
       Author     :- J. Sedgbeer   87/03/02
       Modified   :- J. Sedgbeer   88/05/05
       Modified   :- I. Tomalin    88/11/17
   
       Input:
         NUM /I4 : Number of ITCO bank to be printed
         ITCO bank of ITC coordinates
         need commons     /BCS/  BOS
                          /RCURNT/
              parameters  ITCOJJ   parameters for ITCO bank
   
       Output:
   
       calls:    none
   
       Libraries required: BOS
   
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   IPREDA                                                                          
        |---- ITCOPR                                                               
                   |----  NLINK                               External             
                   |----  RERROR                                                   
   
 
3 ITCREC
         SUBROUTINE ITCREC
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Itc reconstruction. steering routine.
   
       Author      :- J. Sedgbeer 87/02/09
       Modified    :- J. Sedgbeer 88/06/22
       Modified    :- I. Tomalin  89/02/28
       Modified    :- J. Sedgbeer 90/01/06
   
      Input:
         commons:     /BCS/
                      /ITRKPA/ for tracking cuts
                      /RCURNT/ for run and event number
                      /IFLAGS/ for tracking options
   
      Output:
         commons:     /ITTIME/
   
      called by : RECEVT
   
      calls :
        ITRECI  Initialise ITC-TPC tracking
        ITCTPC  Find ITC tracks by extending existing TPC tracks
        ITRECF  Finalise ITC-TPC tracking
        ITCTRK  ITC stand-alone tracking
        IMATCH  Match unextended TPC and ITC stand-alone tracks
        ITDCOR  Create ITDR and ITDL banks
        ITRMCA  Associate the JULIA ITC tracks with the true MC ones
   
      Libraries required: none
   
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   RECEVT                                                                          
        |---- ITCREC                                                               
                   |----  ALTIME                                                   
                   |----  ITRECI                                                   
                   |----  ITCTPC                                                   
                   |----  ITRECF                                                   
                   |----  ITCTRK                                                   
                   |----  IMATCH                                                   
                   |----  ITEXTN                                                   
                   |----  ICRCCO                                                   
                   |----  IREFIN                                                   
                   |----  ITDCOR                              External             
                   |----  BLIST                               External             
                   |----  ITRMCA                                                   
   
 
3 ITCREP
         SUBROUTINE ITCREP
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Dst-dst reprocessing : itc reconstruction. steering routine.
   
       Author      :- J. Sedgbeer 92/02/06
   
      Input:
         commons:     /BCS/
   
      Output:
         commons:     /ITTIME/
   
      called by : RECEVT
   
      calls :
        ICFTOI  Convert FRFT type banks to ITFT type track banks
        IREFIN  Refine/improve ITC tracks
        ISHUFF  Shuffle/Update FRFT type banks from ITFT type track banks
        ITDCOR  Create ITC Track to Digits correlation banks (ALEPHLIB)
        ITRMCA  Associate the JULIA ITC tracks with the true MC ones
   
      Libraries required: none
   
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   RECEVT                                                                          
        |---- ITCREP                                                               
                   |----  ICFTOI                                                   
                   |----  IREFIN                                                   
                   |----  ISHUFF                                                   
                   |----  RERROR                                                   
   
 
3 ITCTPC
         SUBROUTINE ITCTPC
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Itc-tpc tracking - steering.
   
       Author      :- J. Sedgbeer 87/02/09
       Modified    :- J. Sedgbeer 88/06/22
       Modified    :- I. Tomalin  88/11/17
   
      Input:
          /BCS/ and /IWBNKT/ for work bank IWTPCP
   
      Output: None
   
      called by : ITCREC
   
      calls :  IGETTI - Get TPC tracks initialisation
               IGETTP - Get TPC track parameters
               IGICHA - Get ITC chain ICHA
   
      Libraries required: none
   
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   ITCREC                                                                          
        |---- ITCTPC                                                               
                   |----  IGETTI                                                   
                   |----  IGETTP                                                   
                   |----  IGICHA                                                   
   
 
3 ITCTRK
         SUBROUTINE ITCTRK
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Itc tracking - steering.
   
       Author      :- J. Sedgbeer 88/03/19
       Modified    :- I. Tomalin  88/11/17
   
      Input: None
   
      Output: None
   
      called by : ITCREC
   
      calls : INTRAK, ITRAK, IFTRAK
   
      Libraries required: none
   
    ITCTRK: ITC stand alone tracking based on a "link and tree" method.
            See H.Kowalski and D.G.Cassel  DESY 80/107 (1980)
   
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   ITCREC                                                                          
        |---- ITCTRK                                                               
                   |----  INTRAK                                                   
                   |----  RERROR                                                   
                   |----  ITRAK                                                    
                   |----  IFTRAKCONTINUE                      External             
   
 
3 ITCXNG
         SUBROUTINE ITCXNG(VV0,CLWNUM,XTK,TTK,DFN)
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Compute track crossings of the itc sense wire planes.
    This routine has some similarity to IXHITS by I. Tomalin.
   
       Author  :  W. B. Atwood  14-Oct-89
       Modified:  J.Sedgbeer    16/01/90  Rules. etc.
   
      Input:
        VV0(5) /R : Track params 1/r,tanL,phi0,d0,z0
        commons:    /ITWICC/ for ITC geom.
   
    IMPORTANT: If you wish to use this subroutine, then at the beginning
               of each run, you must call the ALEPHLIB routine, IRDDAF,
               to fill commons with the ITC geometry etc.
   
      Output:
        CLWNUM /I4 : Array of ITC wire numbers for each of the 8
                     ITC planes. A zero entry indicates no crossing
        XTK    /R4 : Array of space points for each crossing.
                     (dimension... (3,8))
        TTK    /R4 : Array of direction cosines.. for each XTK
        DFN    /R4 : Array of scaled (-1,1) drift distances expected
   
      calls     : none
   
      Libraries required: BOS
   
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   IASIGN                                                                          
        |---- ITCXNG                                                               
                   |----  SQRT                                External             
                   |----  ABS                                 External             
                   |----  ASIN                                External             
                   |----  COS                                 External             
                   |----  SIN                                 External             
                   |----  SIGN                                External             
                   |----  FLOAT                               External             
                   |----  PHWRIT                              External             
                   |----  AMOD                                External             
                   |----  INT                                 External             
                   |----  UTSWCO                              External             
                   |----  ITROTN                              External             
   
 
3 ITERR
         SUBROUTINE ITERR (R,ITK,RPHERR,IFLAG)
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Calculate tracking error in rphi
   
       Author  J Carr stolen
               from IHELER of  M J Phillips with J Sedgbeer    01-Jan-1991
   
       Input                R          radius to calculate error
                            ITK        track number
   
       Output               RPHERR     Error in rphi-coordinate at r=RIN
                            IFLAG = 0  Successful
                                    1  Unsuccessful
   
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   IASIGN                                                                          
        |---- ITERR                                                                
                   |----  NLINK                               External             
                   |----  ABS                                 External             
                   |----  SQRT                                External             
   
 
3 ITEXTN
         SUBROUTINE ITEXTN
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Associate lone tpc coordinates with existing itc tracks
   
       Authors            M J Phillips with J Sedgbeer        15-Jan-1991
       Based on work by   L Garrido, L Vitale and J Sedgbeer  05-Sep-1989
   
       Input variables    None
       Output variables   None
   
       Description
       ===========
       This routine associates lone TPC points in the low-angle region
       with existing reconstructed ITC tracks.
       Scan through existing ITC-only tracks.
       IF low angle with respect to beam axis THEN flag as selected.
       Scan through lone TPC points.
       IF in low-angle region THEN flag as selected.
       Each ITC track is extrapolated into the TPC, and those lone TPC
       points within its (suitably-defined) vicinity are identified.
       We then try to refit the ITC points on the original track together
       with the new TPC coordinates.
       If the match is good enough, the points are added onto the track,
       with the further condition that if we are only left with one TPC
       point, then it must lie in the first pad-row.
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   ITCREC                                                                          
        |---- ITEXTN                                                               
                   |----  NLINK                               External             
                   |----  ITPCAN                                                   
                   |----  BDROP                               External             
                   |----  AUBOS                               External             
                   |----  BLIST                               External             
                   |----  ITRKZR                                                   
                   |----  ITRKEQ                                                   
                   |----  SQRT                                External             
                   |----  IHELER                                                   
                   |----  ITIDY1                                                   
                   |----  ITIDY2                                                   
                   |----  UFITMS                                                   
                   |----  RERROR                                                   
   
 
3 ITHIST
         SUBROUTINE ITHIST
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Itc histograms.
   
       Author     :- J. Sedgbeer   87/11/06
       Modified   :- J. Sedgbeer   88/05/09
       Modified   :- I. Tomalin    89/02/28
   
       Input:
         commons:       /BCS/    for ITC banks
                         => ITCO,ITDR,IGTL,IPJT,IRJT
                        /IWBNKT/ pointers to work banks for ITC tracking
         parameters:    ITCOJJ   parameters for ITCO bank
                        IGTLJJ   parameters for IGTL bank
                        IPJTJJ   parameters for IPJT bank
                        IRJTJJ   parameters for IRJT bank
   
       Output:   histograms.
   
       called by : RHSEVT
   
       calls     : none
   
       Libraries required: BOS, HBOOK
   
    Histograms for ITC coordinates
      Get ITCO bank
      histogram # coordinates per event
                coord. Phi values
                coord. Z values
      Get ITDR bank
    Loop over the two sets of histograms for ITC tracking. The first set
    being for tracks obtained by extending the TPC ones. The second set
    being for tracks found using only the ITC.
    Histograms for ITC-TPC tracking
      Get appropriate IGTL bank (number 1 or 2)
      histogram # JULIA ITC tracks of this type
                # of coords per track
      Get appropriate IPJT bank (number 1 or 2)
      Get appropriate IRJT bank (number 1 or 2)
      histogram fraction of hits on each JULIA ITC track which were
                  shared with its closest true MC track.
                fraction of hits on each true MC track which were
                  shared with its closest JULIA ITC track.
    End Loop
    Histograms for ITC tracking - MC truth information
      histogram # true tracks in ITC (with > 0 digitisings)
                # digitisings/track
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   RHSEVT                                                                          
        |---- ITHIST                                                               
                   |----  JHISRF                              External             
                   |----  NLINK                               External             
                   |----  HFILL                               External             
                   |----  FLOAT                               External             
   
 
3 ITIDY1
         SUBROUTINE ITIDY1 (CUT1,IFLAG)
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Ensure that a tpc point is assigned to only one itc track
   
       Author         M J Phillips with J Sedgbeer       01-Jan-1991
   
       Input          CUT1        Maximum acceptable value of a
                                  entry in bank IDSQ for a good
                                  track-point combination
       Output         IFLAG = 0   Successful
                              1   No IDSQ bank found
                              2   No TPC points
                              3   No ITC tracks
   
       Description
       ===========
       Each TPC point must be associated with no more than one ITC
       track. The bank IDSQ is amended if this is not the case.
   
       The bank IDSQ (which contains the quantity DSQD for each point-
       track combination) is scanned. We ensure that each (TPC) point
       is only (preliminarily) assigned to one (ITC) track, by increasing
       DSQD of any other point-track combinations (which currently have
       DSQD < CUT1) by an amount CUT1.
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   ITEXTN                                                                          
        |---- ITIDY1                                                               
                   |----  NLINK                               External             
   
 
3 ITIDY2
         SUBROUTINE ITIDY2 (CUT1,IFLAG)
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Only one tpc point with a given r-coord can be added to an itc track
   
       Author         M J Phillips with J Sedgbeer      01-Jan-1991
   
       Input          CUT1        Maximum acceptable value of an
                                  entry in bank IDSQ for a good
                                  track-point combination
       Output         IFLAG = 0   Successful
                              1   No IDSQ bank present
                              2   No TPC points
                              3   No ITC tracks
                              4   No TPCO bank
   
       Description
       ===========
       Look at the set of TPC points which are candidates for adding onto
       an ITC track. If more than one point has the same r-coordinate, then
       keep only the point with the lowest DSQD entry in the bank IDSQ.
       For a given track, the entry, DSQD, for all track-point combinations
       apart from the best (i.e. smallest) one, is increased by an
       amount CUT1.
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   ITEXTN                                                                          
        |---- ITIDY2                                                               
                   |----  NLINK                               External             
   
 
3 ITLNK1
         SUBROUTINE ITLNK1(ITRY,TCURV,TCUER,TPHIS,ERPHI,IER)
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Itc: form links.
   
       Author      :- J. Sedgbeer 88/03/29
       Modified    :- I. Tomalin  89/09/01
   
      Input:
        ITRY   /I  and   TCURV /R  :
          Link curvatures have to be compatible with TCURV (the curvature
          of the TPC track), to within errors determined by ITRY.
        TCUER  /R  :
          The 1 sigma error**2 upon TCURV.
        TPHIS  /R  :
          The TPC track intersects the scattering radius at an azimuthal
          angle of TPHIS with respect to the origin.
        ERPHI  /R  :
          This is the 1 sigma uncertainty upon TPHIS.
         commons:     /ITRKCC/
                      /ITRKPA/
                      /ITRKER/
                      /ITGAPC/
                      /IROADC/
                      /ITWICC/
         params:       ITCOJJ
   
      Output:
         IER    /I : Error flag : IER = 0
         IER = 1 if link search incomplete due to work bank problems etc.
         commons:     /BCS/,/IWBNKT/
         work bank:   ILNKIW
   
      called by : IGICHA
      calls     : none
   
      Libraries required: none
   
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   IGICHA                                                                          
        |---- ITLNK1                                                               
                   |----  NLINK                               External             
                   |----  ABS                                 External             
                   |----  COS                                 External             
                   |----  SQRT                                External             
                   |----  SIN                                 External             
                   |----  WBANK                               External             
                   |----  RERROR                                                   
   
 
3 ITLNK2
         SUBROUTINE ITLNK2(ITRY,IER)
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Itc: search for links
   
       Author      :- I. Tomalin  88/08/25
       Modified    :- I. Tomalin  89/02/28
       Modified    :- I. Tomalin  90/01/19
       Modified    :- J.Sedgbeer  91/02/21 Fix EXTPH for 0-2pi cross-over
       Modified    :- J.Sedgbeer  91/09/10 curvature calc. - better for
                                           low p tracks.
      Input:
         ITRY /I : Search type: ITRY = 1 -> high Pt (tight cuts)
                                ITRY = 3 -> down to low Pt (loose cuts)
         commons:     /BCS/
                      /IWBNKT/
                      /ITRKPA/
                      /ITRKER/
                      /ITGAPC/
                      /ITWICC/
         params.:     /ALCONS/
                      /ITCOJJ/
      Output:
         IER  /I : Error flag:  IER = 0 if all O.K.
                                IER = 1 if there were too many links.
         work bank:   ILNKIW
   
      called by : ITRAK
      calls     : IENANG and IPHCOR
   
      Libraries required: none
   
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   ITRAK                                                                           
        |---- ITLNK2                                                               
                   |----  WDROP                               External             
                   |----  RERROR                                                   
                   |----  WBANK                               External             
                   |----  NLINK                               External             
                   |----  MOD                                 External             
                   |----  ITROTN                              External             
                   |----  MIN                                 External             
                   |----  FLOAT                               External             
                   |----  PHWRIT                              External             
                   |----  AMOD                                External             
                   |----  INT                                 External             
                   |----  ZFACIT                              External             
                   |----  IENANG                                                   
                   |----  IPHCOR                                                   
                   |----  SIN                                 External             
   
 
3 ITPCAN
         SUBROUTINE ITPCAN (THCUT,NTPT,NTCAN,IFLAG)
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Initialise bank iexc used by subroutine itextn
   
       Author              M J Phillips with J Sedgbeer    15-Jan-1991
   
       Input variables     THCUT      Value of theta below which a
                                      "low angle point" must lie
       Output variables    NTPT       Total number of TPC points
                           NTCAN      Number of TPC points which are
                                      candidates
                           IFLAG = 0  Successful
                                   1  No TPCO bank found
                                   2  No TPC points in TPCO bank
                                   3  No room for new bank
   
       Description
       ===========
       A bank IEXC is created which flags those TPC points which are
       candidates for adding to extended ITC tracks.
       In order to be a candidate, each TPC point must
             (i)   lie within a low-angle cone
       and   (ii)  be currently unassociated with an existing TPC track.
       The IEXC bank has a one-to-one correspondance with the TPCO
       bank. If a TPCO point is a candidate, then the bank IEXC will
       contain a "1", otherwise it will contain a "0".
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   ITEXTN                                                                          
        |---- ITPCAN                                                               
                   |----  NLINK                               External             
                   |----  BDROP                               External             
                   |----  AUBOS                               External             
                   |----  BLIST                               External             
                   |----  ABS                                 External             
                   |----  TAN                                 External             
   
 
3 ITRAK
         SUBROUTINE ITRAK
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Itc tracking prog.
   
       Author      :- J. Sedgbeer 88/03/29
       Modified    :- J. Sedgbeer 88/05/09
       Modified    :- I. Tomalin  88/08/25
   
      Input:
         commons:     /IWBNKT/, /BCS/
      Output:
         commons:     /ITTIME/
   
      called by : ITCTRK
      calls     : ITLNK2,ITREE,IFIND2
   
      Libraries required: none
   
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   ITCTRK                                                                          
        |---- ITRAK                                                                
                   |----  ALTIME                                                   
                   |----  ITLNK2                                                   
                   |----  ITREE                                                    
                   |----  IFIND2                                                   
   
 
3 ITRECF
         SUBROUTINE ITRECF
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Finalise itc-tpc tracking
   
       Author      :- J. Sedgbeer 87/02/09
       Modified    :- J. Sedgbeer 88/06/22
       Modified    :- I. Tomalin  89/09/01
   
      Input:
        need common:/BCS/
                    /ITNAMC/
                    /TPNAMC/
                    /IWBNKT/
                    /ITRKCC/
             params: ITCOJJ,IGTLJJ,TGTLJJ,ITFTJJ,TGFTJJ
   
      Output:
         finalised banks IGCL#1, IGTL#1, ITFT#1
   
      called by : ITCREC
      calls     : UFITMS
   
      Libraries required: BOS,CERNLIB
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   ITCREC                                                                          
        |---- ITRECF                                                               
                   |----  NLINK                               External             
                   |----  AUBOS                               External             
                   |----  WDROP                               External             
                   |----  RERROR                                                   
                   |----  BKTOW                               External             
                   |----  VZERO                               External             
                   |----  FORMAT                              External             
                   |----  UFITMS                                                   
                   |----  ABS                                 External             
                   |----  PROB                                External             
   
 
3 ITRECI
         SUBROUTINE ITRECI(IER)
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Itc reconstruction initialisation.
   
       Author      :- J. Sedgbeer 87/02/09
       Modified    :- J. Sedgbeer 88/06/20
       Modified    :- I. Tomalin  88/11/17
   
      Input:
        need commons /ITNAMC/ for NAITCO etc.
                     /ITWICC/ for ITC geom.
                     /BCS/    for ITCO bank etc.
                     /IWBNKT/ for pointers to work banks
                     /RCURNT/ for run and event number
             params.  ITCOJJ
                      ITFTJJ
                      IGTLJJ
   
      Output:
       IER /I4 : Error flag = 0 if O.K.
                            = 1 if no ITCO(0) bank
                            = 2 if no TGFT bank
                            = 3 if no ITCO(0) and no TGFT bank
                            = 4 No space to create banks
        fill common /IWBNKT/ with ITC work bank pointers for tracking
        create IUCOIW and IWHTIW banks
        create ITFT, IGTL AND IGCL banks
   
      called by : ITCREC
      calls     : none
   
      Libraries required: BOS
   
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   ITCREC                                                                          
        |---- ITRECI                                                               
                   |----  NLINK                               External             
                   |----  NAMIND                              External             
                   |----  AUBOS                               External             
                   |----  UCOPY                               External             
                   |----  WDROP                               External             
                   |----  RERROR                                                   
                   |----  WBANK                               External             
                   |----  MOD                                 External             
                   |----  NDROP                               External             
                   |----  BLIST                               External             
   
 
3 ITREE
         SUBROUTINE ITREE(ITRY,MODE,IERR)
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Itc: form tree
   
       Author      :- J. Sedgbeer 88/03/29
       Modified    :- I. Tomalin  89/02/28
   
      Input:
        ITRY   /I : Search type flag.
        MODE   /I : = 1 if in TPC track extension phase.
                    = 2 if in ITC stand alone phase.
         commons:     /BCS/
                      /ITGAPC/
                      /ITRKER/
                      /IWBNKT/
   
      Output:
         IERR  /I : IERR = 0 if ITREE ran correctly.
                    IERR = 1 if no elementary trees were found.
                    IERR = 2 if a more serious problem occured.
         commons:     /IWBNKT/
         work banks:  INNXIW,IOFNIW,INXLIW
   
      called by : IGICHA and ITRAK
      calls     : none
   
      Libraries required: none
   
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   IGICHA                                                                          
   ITRAK                                                                           
        |---- ITREE                                                                
                   |----  NLINK                               External             
                   |----  WDROP                               External             
                   |----  RERROR                                                   
                   |----  WBANK                               External             
                   |----  CCRVIT                              External             
                   |----  ABS                                 External             
   
 
3 ITRKCI
         SUBROUTINE ITRKCI
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Fills commons with cuts used in itc tracking.
   
       Author      :- J. Sedgbeer 88/05/09
       Modified    :- I. Tomalin  89/06/02
       Modified    :- J. Sedgbeer 89/07/28
       Modified    :- J. Sedgbeer 90/01/06
   
      Input:
         commons:     /ITWICC/  ITC geometry
                      /ITRKCC/  ITC resolution
         params:       ICUTJJ   ITC track finding cuts
   
      Output:
         commons:     /ITRKER/   fill with default values
                      /ITRKPA/             "
   
      called by : IINIRU
      calls     : INIGAP,AGETDB
   
      Libraries required: ALEPHLIB
   
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
              ITRKCI                                                               
                   |----  INIGAP                                                   
                   |----  SQRT                                External             
                   |----  AGETDB                              External             
                   |----  NAMIND                              External             
                   |----  RERROR                                                   
                   |----  MAX                                 External             
                   |----  MIN                                 External             
   
 
3 ITRKEQ
         SUBROUTINE ITRKEQ (R,RI,TL,P0,D0,Z0,Z,PH,IFLAG)
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Calculate z and phi coords of a helical track at radius r.
   
       Author               M J Phillips with J Sedgbeer       01-Jan-1991
   
       Input                R          r-coordinate of track
                         (  RI         inverse radius of curvature
            usual        (  TL         tan (lambda) = tan (dip angle)
             track       (  P0         phi-zero
              parameters (  D0         d-zero
                         (  Z0         z-zero
   
       Output               Z          z-coordinate of track
                            PH         phi-coordinate of track
                                       in range 0 to 2*PI
                            IFLAG = 0  Successful
                                    1  Unsuccessful
   
       Description
       ===========
       Returns z and phi coords of a helical track at radius r.
       Only first half of first loop of helix is considered.
       Track is parametrised by the usual (RI,TL,P0,D0,Z0).
   
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   ITEXTN                                                                          
        |---- ITRKEQ                                                               
                   |----  ABS                                 External             
                   |----  ASIN                                External             
                   |----  SQRT                                External             
   
 
3 ITRKZR
         SUBROUTINE ITRKZR (Z,RI,TL,P0,D0,Z0,R)
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Calculate r as a function of z for a helix.
   
       Author               M J Phillips with J Sedgbeer      01-Jan-1991
   
       Input                Z          z-coordinate
                         (  RI         inverse radius of curvature
            usual        (  TL         tan (lambda) = tan (dip angle)
             track       (  P0         phi-zero
              parameters (  D0         d-zero
                         (  Z0         z-zero
       Output               R          r-coordinate of helix
   
       Description
       ===========
       Subroutine calculates r as a function of z for a helix
       parametrised by (RI,TL,P0,D0,Z0). If subroutine fails for any
       reason, a negative value of r (-1.0) is returned to indicate this.
   
       Equation used is
                 (    2                 4        2 (  RI           ) )
        R = SQRT (  D0  + (1-D0*RI) *  ---  * SIN  ( ---- * (Z-Z0) ) )
                 (                    RI*RI        ( 2*TL          ) )
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   ITEXTN                                                                          
        |---- ITRKZR                                                               
                   |----  ABS                                 External             
                   |----  SIN                                 External             
                   |----  SQRT                                External             
   
 
3 ITRMCA
         SUBROUTINE ITRMCA
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Associate julia itc tracks with true mc tracks.
   
       Author     :- I. Tomalin    88/06/24
       Modified   :- J. Sedgbeer   89/08/28
       Modified   :- I. Tomalin    90/05/24 (To use IHIT instead of ITHT)
   
       Input:
         commons:       /BCS/
                         => ITDR,ITCO,IDCR,IDHR,ITHT,IGTL,IGCL
                        /RCURNT/ run and event number
                        /ITNAMC/ pointers to ITC banks
                        /IWBNKT/ pointers to work banks for ITC tracking
         parameters:    ITCOJJ   parameters for ITCO bank
                        IGTLJJ   parameters for IGTL bank
                        IDHRJJ   parameters for IDHR bank
                        ITHTJJ   parameters for ITHT bank
                        IHITJJ   parameters for IHIT bank
                        IPJTJJ   parameters for IPJT bank
                        IRJTJJ   parameters for IRJT bank
   
       Output:   IPJT and IRJT banks.
   
       called by : ITCREC
       calls     : none
   
       Libraries required: BOS
   
    Find the total # of true MC tracks which caused hits in the ITC
    Create ISHRIW work bank
    Create a work bank ICDRIW, containing coordinate to digit
      relationship (i.e. effectively invert the IDCR bank)
    Loop over the two different type of JULIA ITC tracks. (The first type
    being those tracks which were found by extending the TPC ones. The
    second type being those tracks which were found using only the ITC).
      Find the total # of JULIA ITC tracks of this type
      Create appropriate IPJT bank (# 1 or 2) and the IRJTIW work bank
      Loop over the ITC JULIA tracks
        Loop over all the coordinates on each track
          For each of these, find the offset in the ITCO bank and hence
           obtain the corresponding offset in the ITDI bank
          Find the true MC tracks which caused each digitisation
          Temporarily store this information in the ISHRIW work bank
        End Loop
        Fill the IPJT bank and the IRJTIW work bank
      End Loop
      Create the appropriate IRJT bank (# 1 or 2)
      Copy the IRJTIW work bank into the IRJT bank
    End Loop
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   ITCREC                                                                          
        |---- ITRMCA                                                               
                   |----  NLINK                               External             
                   |----  WBANK                               External             
                   |----  AUBOS                               External             
                   |----  VZERO                               External             
                   |----  ABS                                 External             
                   |----  UCOPY                               External             
                   |----  WDROP                               External             
                   |----  RERROR                                                   
                   |----  BLIST                               External             
   

2 L_

  >>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>
    CKEY 
     1st entry in lcal set
     ! JULIA 312
        LHVSTA, LPRLUM, LSELBH : Calculate luminosity taking into account
                 mini-ramp.                                       (P.Hansen) 
    
     ! JULIA 310
        LBHCOR : Double precision fixes for Linux       (D.Smith)
    
     ! corr file 308.3
        LPREMC : Remove offline pedestal follower after run 45000 (P.Hansen)
    
     ! corr file 305.1
        LHVSTA : use XLUMOK from ALEPHLIB (version>306)  (B.Bloch)
    
     ! JULIA 305
        LENLIS,LSELBA : fix variable type inconsistencies in 
                        function calls, for Linux                  (A.Waananen)
        LUPACR : Store X1RG, XTPB, XTCN, SFTR name indices locally (M.Cattaneo)
        LUPAIN : Suppress filling of x1namc COMMON due to clash with
                 Alephlib in definition of same common             (M.Cattaneo)
    
     ! JULIA 304
        LPREMC : Resurrection of dead wires at storey 2/3 interface corrected,
                 Storey energy redistributed in case of dead wires
                 Suppress negative energies                          (P.Hansen)
        LPRLUM : Compensate for dead module in early 1997 running    (P.Hansen)
    
     ! corr file 303.7
        LINIRU : Enable taking LDST from start of run record (P.Hansen,M.Cattaneo)
    
     ! corr file 303.4
        LIDCOD : Bug - ref. energy for method<9, run>40000 was wrong (P.Hansen)
        LSELBH : Bug - ref. energy for method<9, run>40000 was wrong (P.Hansen)
    
     ! corr file 303.3
       LCNAMC.H Add name index for BHZ0 bank                 (P.H.Hansen)
       LBHCOR : Use BHZ0 bank for LEP1 runs during LEP2 era  (P.H.Hansen)
       LBINDX : Initialize name index for BHZ0 bank          (P.H.Hansen)
       LIDCOD : Use BHZ0 bank for LEP1 runs during LEP2 era  (P.H.Hansen)
       LINIRU : Get BHZ0 bank from database                  (M.Cattaneo)
       LPRLUM : Use BHZ0 bank for LEP1 runs during LEP2 era  (P.H.Hansen)
    
     ! JULIA 285
       LUPACR : Reinstate filling of trigger enable mask in LUPA (M.Cattaneo Jan96)
    
     ! JULIA 282
       LINIRU : Force picking up of LDST bank from database (F.Ranjard, July 96)
    
     ! corr file 281.3
       LOLERR : Fix cut against "sparks" at LEP 2 energy (P.H.Hansen July 96)
    
     ! corr file 281.2
       LHVSTA : Make same event selection as XLUMOK for lumi. (P.H.Hansen July 96)
    
     ! JULIA 281
       LBDLBA, LSELBH, LTRIGS : replace WRITE(6, by WRITE(IW(6),
                                                   (H.Drevermann, Feb 96)
       LBLDBA : Enable debug print                  (P.H. Hansen, May 96)
       LBHCOR : Fix reference energy from BHAB card (P.H. Hansen, May 96)
       LBNKPR : Only print when Lcal clusters exist (P.H. Hansen, May 96)
       LCALIB : Calibration sample is now method 10
                Flexible low edges on energy histos (P.H. Hansen, May 96)
       LCBOOK, LCHIST: Histogram Bhabha, single arm and other trigs
                       Do not use dropped banks from 'E' list
                                                    (P.H. Hansen, May 96)
       LELECT : Put LIDT back on 'T' list           (P.H. Hansen, May 96)
       LGNGBX : Use X1RG bank                       (P.H. Hansen, May 96)
       LHVSTA : Use X1RG bank                       (P.H. Hansen, May 96)
       LIDCOD : Fix reference energy from BHAB card (P.H. Hansen, May 96)
       LINIRU : Flexible low edges on energy histos (P.H. Hansen, May 96)
       LPRCAL : Print also expected energy          (P.H. Hansen, May 96)
       LPRLUM : Exact Luminosity calculation (if energy calib is OK):
                #bhabhas = method 10 with delta_phi>150 with HVs on)
                #background = (( -"-      delta_phi<30   -"-       ) -
                               (MC method 10  -"-      ))*
                              (singles combinations with delta_phi>150)/
                              (  -"-                     delta_phi<30)*
                lumi = (#babhas - #background)/((sigma from BHAB card*
                       (correction factor from LBHCOR))
                Nicer end-of-run print, also for print level 2
                                                    (P.H. Hansen, May 96)
       LSELBA : Fix reference energy from BHAB card
                Count combinations of single arm triggers without weights
                Drop cut on summed energy to gain statistics
                                                    (P.H. Hansen, May 96)
       LSINGL : check that HV is on for single arm triggers
                allow only one Lcal cluster
                                                    (P.H. Hansen, May 96)
       LTGBIT : Install a default 1996 trigger bit assignment
                                                    (P.H. Hansen, May 96)
       LTRIGS : Form combinations every 10 single arm trigger
                                                    (P.H. Hansen, May 96)
       LUPACR : Replace obsolete trigger banks by X1RG and X1TT
                                                    (P.H. Hansen, May 96)
     ! JULIA 279
    
     ! corr file 278.3
       LBHCOR : check whether we are on the Z (P. Hansen, Nov 95)
       LPRLUM : scale background by ratio of bhabhas with HV on and
               and total bhabha count (P. Hansen, Nov 95)
     ! JULIA 278
    
     ! corr file 276.1
       LBUNCA : new routine for bunch-to-bunch calibration in LCAL
               (P.Hansen, Apr 95)
       LPREMC : bunch-to-bunch corrections for bunch trains
               (P.Hansen, Apr 95)
     ! JULIA 276
    
     ! JULIA 275
       LESTIM : prevent division by zero (P. Hansen)
    
     ! corr file 273.1
       LPRLUM : use of X1TT instead of XTOP dropped in the readout upgrade
       LSELBA : use of X1RG and X1TT instead of XTOP dropped in the readout
               upgrade
  <<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<
     LACCEP     Tests whether an lcal cluster is inside or outside a region
     LASYM      This routine finds the energy of the triplet of two first storeys
     LBHAB      Luminosity measurement
     LBHCOR     Interpolates electroweak correction to bhabha cross section and
     LBINDX     Set lcal name indices and printing formats
     LBLDBA     Build background events from single arm trigger events.
     LBNKPR     Print lcal output banks
     LBUNCA     Lcal bunch-to-bunch calibration
     LCALIB     Get the energy calibrations
     LCAREC     Controls lcal pattern recognition
     LCBOOK     Book lcal histograms
     LCHIST     Fill lcal histograms
     LCLUST     Clustering in lcal
     LCLUTW     Find central towers in a cluster
     LCORRC     Correct lcal cluster attributes
     LCPAXY     Find coordinates of lcal tower
     LCRPOT     Create lcal pot banks
     LCSAVE     Save peco, pept lcal info in lpsv and lpes in case of repro.
     LDIRTW     Extrapolate track to lcal reference plane
     LELECT     Construct luminosity electron candidates
     LENLIS     Determine the total data content of banks in list
     LESTIM     Find shower shape estimators
     LFOURC     Find central towers
     LGNGBX     Extracts the number of gbx's since the last aleph readout.
     LHVSTA     Check the high voltage status bits
     LIDCOD     Set acceptance code and quality flag
     LINIJO     Initialisation of lcal job
     LINIRU     Lcal run initialisation
     LOLERR     Check for online errors
     LPRCAL     Print energy calibration
     LPREDA     Prepare lcal data
     LPREMC     Prepare lcal data
     LPREPO     Unpack lcal pot banks
     LPRERW     Prepare lcal raw data
     LPRLUM     Calculate and print luminosity for this run
     LPRSUM     Print general event statistics
     LSELBA     Selection of bhabha background
     LSELBH     Bhabha selection algorithm
     LSINGL     Store single arm triggers
     LSLOWC     Handle slow control for lcal
     LSTATI     Accumulate job statistics
     LSUMAM     Find summing amplifier
     LTGBIT     Author   :-  j.wear               23-mar-1990
     LTGTYP     Author   :-  j.wear               21-mar-1990
     LTRACE     Connect lumi tracks with clusters
     LTRACK     Connect lumi tracks with clusters
     LTRIGS     Count trigger types and background
     LUPACR     Create and fill the lupa bank
     LUPAIN     Lupa initialization

3 LACCEP
         SUBROUTINE LACCEP(METH,IADDR,REJFL)
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Tests whether an lcal cluster is inside or outside a region
   
      Author   :- Peter H. Hansen        1-APR-1989
      Modified :- P.H.Hansen            18-DEC-1989
      Inputs: IADDR            Address of central tower
           -  METH             Method number
           -  'LSDA'           Storey data
           -  'LMAP'           Address-to-Storey data Look-up Table
           -  'LACC'           Table of boundary towers
   
      Outputs: REJFL        Logical reject flag
           -   IADDR        Nonet centroid tower
   
      Libraries required: CERNLIB, BOS
   
      Description
      ===========
      The routine tests whether an Lcal cluster is inside
      or outside a region bounded by pad boundaries.
      It is required that the triplet of first storeys on the
      good side of the boundary contains more energy than
      the triplet on the bad side.
      Depending on the method number, one of two regions
      are considered: one leaving a margin of at least
      half a pad width to the acceptance edge (METH=5,8), and
      one separated by more than a full pad from the edge (6,9).
      Methods 8 and 9 checks whether the nonet centroid is
      inside the METH 5 (6) acceptance table.
      If METH=7, we require instead that the most energetic
      tower in the cluster is inside the Method 5 boundary.
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   LIDCOD                                                                          
   LUPACR                                                                          
        |---- LACCEP                                                               
                   |----  MOD                                 External             
                   |----  LFIDUC                                                   
                   |----  VZERO                               External             
   
 
3 LASYM
         SUBROUTINE LASYM(IADDR,AX,AY)
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   This routine finds the energy of the triplet of two first storeys
   
      Author   :- Peter H. Hansen        1-APR-1990
      Modified :  H. Meinhard            10-Apr-1990
   
      Inputs: IADDR            Address of central tower
           -  'LSDA'           Storey data
           -  'LMAP'           Address-to-Storey data Look-up Table
           -  'LACC'           Table of boundary towers
   
      Outputs: AX,AY           Energy assymetries used for Method 5
                               Ax,AY > 0
           -
   
      Libraries required: CERNLIB, BOS
   
      Description
      ===========
      This routine finds the energy of the triplet of two first storeys
      on the good side of the boundary minus the energy of the triplet
      on the bad side.
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   LUPACR                                                                          
        |---- LASYM                                                                
                   |----  MOD                                 External             
                   |----  AUBOS                               External             
                   |----  VZERO                               External             
                   |----  AMAX1                               External             
   
 
3 LBHAB
         SUBROUTINE LBHAB
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Luminosity measurement
   
      Author   : P. H. Hansen  890101
      Modified : P. H. Hansen  890701, 910801
   
        Input  :  ITYPE           Trigger type
                      1 : exclusive single low
                      2 : exclusive single high
                      3 : exclusive single very high
                      4 : exclusive low-low
                      5 : high-low
                 'LIDT'           Electron candidate clusters
                 'LIFL'           Selection flags for electron candidates
        Output : 'LUMI'           Bhabha event statistics
                 'LSIN'           Single arm trigger storage
      Description :
      ===========
      Update trigger statistics
      IF (Itype<=2) Store single event
      IF (Itype>=3) Update Bhabha statistics
      Update histograms LEHI and LVHI
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   LTRACK                                                                          
        |---- LBHAB                                                                
                   |----  LTRIGS                                                   
                   |----  LSINGL                                                   
                   |----  LSELBH                                                   
                   |----  LCALIBCONTINUE                      External             
   
 
3 LBHCOR
         SUBROUTINE LBHCOR(FACT)
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Interpolates electroweak correction to bhabha cross section and
       performs energy scaling according to formula from J.D.Hansen
       This expression is used by line shape fitters at present.
       Modified : J.Wear   900315
       Modified : P.Hansen 951102
       Modified : P.Hansen 960501 New MC reference energies
       Modified : P.Hansen 970616 Use BHZ0 bank for Z0 runs from 1996
       Modified : D.Smith  991027 Double precision fixes for Linux
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   LPRLUM                                                                          
        |---- LBHCOR                                                               
                   |----  DBLE                                External             
                   |----  JPRERF                              External             
   
 
3 LBINDX
         SUBROUTINE LBINDX
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Set lcal name indices and printing formats
   
      Author   : P. H. Hansen  870401
      Modified : P. H. Hansen  890102
      Modified : H. Meinhard   16-Mar-1990
      Modified : H. Meinhard   24-Apr-1991
      Modified : P. H. Hansen  16-Jun-1997  Add BHZ0 bank index
   
      Description :
      ===========
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   LINIJO                                                                          
        |---- LBINDX                                                               
                   |----  NAMIND                              External             
   
 
3 LBLDBA
         SUBROUTINE LBLDBA
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Build background events from single arm trigger events.
   
      Author   : P. H. Hansen   890810
    Modified   : J. Wear        891109
                 Allows background selection to be conveniently done at
                 end-of-run (or any time).
    Modified   : P. H. Hansen   960501   enable debug print
   
      Input    : 'LSIN'          single arm storage bank
      Output   : 'LBAK','LONL'   Fake Bhabha event statistics
      Calls    : routine LSELBA
   
      Description :
      ===========
      Loops over single rows of LSIN bank and passes combinations to
      background selection routine.
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   LPRLUM                                                                          
        |---- LBLDBA                                                               
                   |----  LSELBA                                                   
                   |----  NDROP                               External             
   
 
3 LBNKPR
         SUBROUTINE LBNKPR
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Print lcal output banks
   
      Author   : P. H. Hansen  870401
      Modified : P. H. Hansen  890102
      Modified : P. H. Hansen  960501 Only print when there are clusters
   
        Input  :
                 'LSDA','LPDA',LCLU'
   
        Description :
        ===========
        Print Lcal banks in nice "grafics" format
        IF level 4 THEN
           Dump all output banks
        IF level 3 THEN
           Print cluster storeys as viewed from the origin
           Print wire energies of each storey
        IF level 2 THEN
           Print a line per cluster over threshold
        IF level 1 THEN
           Print number of clusters and total energy
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   LCAREC                                                                          
        |---- LBNKPR                                                               
                   |----  MOD                                 External             
                   |----  PRTABL                              External             
                   |----  WBANK                               External             
                   |----  VZERO                               External             
                   |----  INT                                 External             
                   |----  WDROP                               External             
   
 
3 LBUNCA
         SUBROUTINE LBUNCA(SCORR,WCORR)
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Lcal bunch-to-bunch calibration
   
      Author   : P. H. Hansen  950401
   
        Input   : SCORR(4) Storey energy correction factor
                  WCORR(4) Wire energy correction factor
        Output  : SCORR(4) Modified factor
                  WCORR(4) Modified factor
   
        Description :
        ===========
        Changes the correction factor for each Lcal module
        depending on wagon number and wagon separation.
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   LPREMC                                                                          
        |---- LBUNCA                                                               
                   |----  RQBUNC                              External             
   
 
3 LCALIB
         SUBROUTINE LCALIB
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Get the energy calibrations
   
      Author   : F. Bird     890711
      Modified : P.H. Hansen 892111
      Modified : P.H. Hansen 960501 Method 10 selection cuts
      Input    : LIDT LCLU LSDA LPDA
      Output   : LEHI: col 1 2 ....... NBINS NBINS+1 NBINS+2
                       row
                         1 Estoreys module 1  BINSI   ELOW
                         2 Ewires   module 1  BINSI   ELOW
                         .
                         .
                         7 Estoreys module 4  BINSI   ELOW
                         8 Ewires   module 4  BINSI   ELOW
                 LVHI: col 1 2 ........NBINX NBINX+1 NBINX+2
                       row
                         1 (X1+X2)/2 modu 1+4 BINSX   XLOW
                         2 (Y1+Y2)/2 modu 1+4 BINSX   XLOW
                         3 (X1+X2)/2 modu 2+3 BINSX   XLOW
                         4 (Y1+Y2)/2 modu 2+3 BINSX   XLOW
   
   
      Description :
      ===========
      Select fully contained Bhabha events
      Histogram the cluster energies in LEHI
      Histogram the vertex positions in LVHI
   
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
              LCALIB                                                               
                   |----  MOD                                 External             
                   |----  FLOAT                               External             
                   |----  INT                                 External             
                   |----  COS                                 External             
                   |----  TAN                                 External             
                   |----  SIN                                 External             
                   |----  ABS                                 External             
                   |----  AMIN1                               External             
   
 
3 LCAREC
         SUBROUTINE LCAREC
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Controls lcal pattern recognition
    Author   : P. H. Hansen   880315
   
      Description:
      ============
      Call clustering routine
      Call electron identification routine
      Call debug routine on request
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   RECEVT                                                                          
        |---- LCAREC                                                               
                   |----  LCLUST                                                   
                   |----  LBNKPR                                                   
                   |----  LELECTCONTINUE                      External             
   
 
3 LCBOOK
         SUBROUTINE LCBOOK
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Book lcal histograms
   
      Author   : P. H. Hansen  880315
      Modified : P. H. Hansen  890102
      Modified : P. H. Hansen  960501
      Description :
      ===========
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   RBKHIS                                                                          
        |---- LCBOOK                                                               
                   |----  HBOOK1                              External             
                   |----  HBOOK2                              External             
   
 
3 LCHIST
         SUBROUTINE LCHIST
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Fill lcal histograms
   
      Author   : P. H. Hansen  880307
      Modified : P. H. Hansen  890102
      Modified : H. Meinhard   05-Mar-1990
      Modified : P. H. Hansen  960501
   
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   RHSEVT                                                                          
        |---- LCHIST                                                               
                   |----  MOD                                 External             
                   |----  VZERO                               External             
                   |----  HF1                                 External             
                   |----  AMAX1                               External             
                   |----  COS                                 External             
                   |----  SIN                                 External             
                   |----  ABS                                 External             
                   |----  AMIN1                               External             
                   |----  VDOT                                External             
                   |----  ACOS                                External             
                   |----  TAN                                 External             
                   |----  FLOAT                               External             
                   |----  HFILL                               External             
                   |----  HF2                                 External             
   
 
3 LCLUST
         SUBROUTINE LCLUST
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Clustering in lcal
   
      Author   : P. H. Hansen  870401
      Modified : P. H. Hansen  880315  890102 910801
   
      Input : 'LSDA'
      Ouput : 'LCLU','LMAP'
   
      Description:
      ===========
        A cluster consists of towers (=3 storeys).
        A tower can join a cluster if it contains at least one
        storey with energy larger than low threshold and sharing a common
        side, edge or corner with another such storey in the cluster.
        A cluster must include at least one storey above high threshold.
        Finally the clusters below a cluster energy threshold
        are suppressed.
        No clustering across module boundaries.
        Create a tower map LMAP:
           IW(KLMAP + LMHLEN + tower_address) = LSDA row number
        DO for all storey_data
           IF the tower is not already used
           THEN apply high threshold condition on tower
                Initialise attributes of a cluster
                Fill storey_data,cluster relations
                DO for all neighbour towers
                   IF the tower may join the cluster
                   THEN update cluster attributes
                        Fill storey_data,cluster relations
                        Start a new loop over neighbours
                   ENDIF
                ENDDO
                Resume parent loop, if not finished
           ENDIF
        ENDDO
        Create LCLU
        Apply an energy cut on each cluster
        Rewrite storey_data,cluster relation
        Normalise cluster attributes
        Copy cluster attributes into LCLU
        Shrink LCLU to actual size
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   LCAREC                                                                          
        |---- LCLUST                                                               
                   |----  MOD                                 External             
                   |----  VZERO                               External             
                   |----  AUBOS                               External             
                   |----  BLIST                               External             
                   |----  LCPAXY                                                   
                   |----  UCOPY                               External             
                   |----  VSCALE                              External             
                   |----  AMAX1                               External             
                   |----  SQRT                                External             
                   |----  ACOS                                External             
                   |----  ATAN2                               External             
   
 
3 LCLUTW
         SUBROUTINE LCLUTW(THETA,PHI,IADDR,DIST,ENE4,ENE9)
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Find central towers in a cluster
   
      Author   : P. H. Hansen   890101
      Input    : THETA, PHI    barycenter direction (raw)
      Output   : IADDR         barycenter tower address
                 DIST(2)       Hor/Ver distance from inner edge (signed)
                 ENE4(3)       Storey energies of the four central towers
                 ENE9(3)       Storey energies of the nine central towers
   
      Description :
      ===========
         Extrapolate to reference plane (average shower max)
         Find distance to Lcal acceptance
         Find the corresponding tower address
         Find the surrounding towers
         Calculate barycenter from 3x3 towers and correct theta and phi
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   LELECT                                                                          
        |---- LCLUTW                                                               
                   |----  SIN                                 External             
                   |----  COS                                 External             
                   |----  ABS                                 External             
                   |----  MIN0                                External             
                   |----  INT                                 External             
                   |----  MAX0                                External             
                   |----  FLOAT                               External             
                   |----  SIGN                                External             
                   |----  LFOURC                                                   
                   |----  ATAN2                               External             
                   |----  ATAN                                External             
                   |----  SQRT                                External             
   
 
3 LCORRC
         SUBROUTINE LCORRC(IADDR,DIST,XOLD,EOLD,XYZ,ECLU,XLOC)
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Correct lcal cluster attributes
   
      Author   : P. H. Hansen   880801
      Modified : H. Meinhard    24-Apr-1991 : XLOC output added
      Input    : DIST           Distances from edges
                 EOLD           LCLU cluster energy
                 XOLD           LCLU cluster barycenter
                 IADDR          Central tower address
      Output   : ECLU           Corrected cluster energy
                 XYZ            Corrected cluster centroid position
                 DIST           Corrected distance to acceptance edge
                 XLOCi          Local cluster coordinates with all correc-
                                tions but misalignment
   
      Description :
      ===========
      Correct position for finite cell size effect
      Extrapolate position to observed longitudinal barycenter.
      Use the wire energy when |Ewir-Eclus| < 3sigma
      Correct position and energy for the most probable leakages
      Finally make alignment corrections
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   LELECT                                                                          
        |---- LCORRC                                                               
                   |----  MOD                                 External             
                   |----  UCOPY                               External             
                   |----  ABS                                 External             
                   |----  FLOAT                               External             
                   |----  SIGN                                External             
                   |----  AMAX1                               External             
                   |----  AMIN1                               External             
   
 
3 LCPAXY
         SUBROUTINE LCPAXY(IADDR,XYZ)
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Find coordinates of lcal tower
   
      Author   : P. H. Hansen  870801
   
        Input  :
               - IADDR      : Tower address
                 'LLAY','LMTY','LSLO'
   
        Output :
               - XYZ(3)   : ALEPH coordinates assuming no misalignment
   
        Description :
        ===========
        Find coordinates of an LCAL tower at plane number NDEPLC
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   LCLUST                                                                          
        |---- LCPAXY                                                               
                   |----  MOD                                 External             
                   |----  UCOPY                               External             
                   |----  SIGN                                External             
                   |----  FLOAT                               External             
   
 
3 LCRPOT
         SUBROUTINE LCRPOT
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Create lcal pot banks
   
      Author   : P. H. Hansen   880801
      Modified : H. Meinhard    24-Apr-1991
      Input    : 'LSDA' 'LPDA' 'LCLU' 'LOBJ' 'LIDT'
      Output   : 'PLSD' 'PLPD'
                 'PCOB' 'PCPA' 'PCHY' 'PCRL'
                 'PEOB' 'PEHY' 'PEOT'
      Created  : 'PLSD' 'PLPD'
   
      Description :
      ===========
      Create or expand packed banks for POT
      Zero suppression is applied:
       PLSD row filled if any storey with E > 50 MeV
       PLPD row filled for planes with E > 10 MeV
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   RDEFPO                                                                          
        |---- LCRPOT                                                               
                   |----  NAMIND                              External             
                   |----  AUBOS                               External             
                   |----  BLIST                               External             
                   |----  BDROP                               External             
                   |----  NINT                                External             
                   |----  AMAX1                               External             
                   |----  AMIN1                               External             
                   |----  PRTABL                              External             
   
 
3 LCSAVE
         SUBROUTINE LCSAVE
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Save peco, pept lcal info in lpsv and lpes in case of repro.
   
      Authors   :  M.N.Minard
      Input     :  PECO PEPT
      Output    :  LPSV LPES
      Called by :  ECERAS
   
    In Case Of Reprocessing :
         Copy LCAL info from banks PECO and PEPT into banks LPSV and LPES
         this banks will be copied into PECO and PEPT at the end of julia
         when POT banks are made.
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   ECERAS                                                                          
        |---- LCSAVE                                                               
                   |----  NAMIND                              External             
                   |----  BLIST                               External             
                   |----  AUBOS                               External             
                   |----  UCOPY                               External             
   
 
3 LDIRTW
         SUBROUTINE LDIRTW(THETA,PHI,IADDR,DIST)
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Extrapolate track to lcal reference plane
   
      Author   : P. H. Hansen   880418
      Input    : THETA, PHI    track direction
      Output   : IADDR         tower address
                 DIST(2)       Hor/Ver distance from inner edge (signed)
   
      Description :
      ===========
         Extrapolate to reference plane (average shower max)
         Make alignment corrections and find local coordinates
         Test if these are inside the Lcal acceptance + 1cm
         Find the corresponding tower address
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   LTRACE                                                                          
        |---- LDIRTW                                                               
                   |----  SIN                                 External             
                   |----  COS                                 External             
                   |----  SIGN                                External             
                   |----  ABS                                 External             
                   |----  MIN0                                External             
                   |----  INT                                 External             
                   |----  MAX0                                External             
   
 
3 LELECT
         SUBROUTINE LELECT
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Construct luminosity electron candidates
   
      Author   : P. H. Hansen   881201
      Modified : H. Meinhard    24-Apr-1991
      Modified : P. Hansen      01-Aug-1991
      Modified : P. Hansen      01-May-1996 LIDT back on 'T' list
      Input    : 'LSDA' 'LCLU' 'LSIN' 'LMAP'
      Output   : 'LIDT' 'LONL' 'LOCL'
      Created  : 'LIDT' 'LOCL'
   
      Description :
      ===========
        Create cluster bank LOBJ in parallel with LCLU
        Create electron identification bank LIDT and bank LOCL for local
        coordinates
        For each cluster
          find central towers
          find R estimators
          correct barycenter and energy for geometrical effects
          fill attributes of LOBJ
          If (Eclus > 3 GeV) fill a new LIDT row
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
              LELECT                                                               
                   |----  AUBOS                               External             
                   |----  BLIST                               External             
                   |----  LCLUTW                                                   
                   |----  LESTIM                                                   
                   |----  COS                                 External             
                   |----  SIN                                 External             
                   |----  LCORRC                                                   
                   |----  VMOD                                External             
                   |----  ACOS                                External             
                   |----  ATAN2                               External             
                   |----  AMAX1                               External             
                   |----  UCOPY                               External             
                   |----  PRTABL                              External             
                   |----  LSTATI                                                   
   
 
3 LENLIS
         INTEGER FUNCTION LENLIS(LIST)
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Determine the total data content of banks in list
       INPUT LIST character string e.g. 'E'
       OUTPUT LENLIS total length in words
            J.Knobloch 20-10-89
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   RCJSUM                                                                          
   RLOOPR                                                                          
   RWREVT                                                                          
        |---- LENLIS                                                               
                   |----  NLIST                               External             
                   |----  NAMIND                              External             
   
 
3 LESTIM
         SUBROUTINE LESTIM(IADDR,ECLUS,ENE4,ENE9,R)
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Find shower shape estimators
   
      Author   : P. H. Hansen   890101
      Input    : ECLUS          Cluster energy
                 ENE4           Energy of 4 towers closest to barycenter
                 ENE9           Energy of tower nonet
                 IADDR          Address of central tower
      Output   : R(1)           (a-a(expect))/da       (storey centers)
                 R(2)           (b-b(expect))/db       (storey centers)
                 R(3)           (a-a(expect))/da       (wire planes)
                 R(4)           (b-b(expect))/db       (wire planes)
                                where a = (<s**2>-<s>**2)/<s>**2
                                and   b = 1./<s>
                 R(5)           (E4/E-E4/E(expect))/d(E4/E)
                 R(6)           (E9/E-E9/E(expect))/d(E9/E)
   
      Modified : P.H. Hansen, P. Comas (29-SEP-1994)
                Protect SAV, SAV2 to avoid division by zero in rare
                coincidences for low energy clusters
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   LELECT                                                                          
        |---- LESTIM                                                               
                   |----  MOD                                 External             
                   |----  VZERO                               External             
                   |----  ALOG                                External             
                   |----  SQRT                                External             
                   |----  AMAX1                               External             
   
 
3 LFOURC
         SUBROUTINE LFOURC(XPAD,YPAD,IADDR,ENE4,ENE9)
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Find central towers
   
      Author   : P. H. Hansen   890101
      Modified : P. H. Hansen   890701
      Input    : IADDR          Address of central (or hit) tower
                 XPAD,YPAD      Barycenter in pad coordinates
                                for the cluster
      Output   : ENE4(3)        Storey energies in the four central tower
                 ENE9(3)        Storey energies in the nine central tower
                 XPAD,YPAD      Barycenter in pad coordinates
                                for the nonet
   
      Description :
      ===========
        Find the storey energies of closest four towers
        Find the storey energies of closest nonet
        Find nonet center in pad coordinates
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   LCLUTW                                                                          
        |---- LFOURC                                                               
                   |----  VZERO                               External             
   
 
3 LGNGBX
         SUBROUTINE LGNGBX(NGBX)
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Extracts the number of gbx's since the last aleph readout.
    Author :  J.Wear  89/11/02
    Modified :  P.H.Hansen  89/11/20
    Modified :  P.H.Hansen  960501 Use X1RG bank
    Input : none
    Output: NGBX
             = number of gated bunch crossings since the last readout
               divided by 1024
             = 100 if X1SC bank doesn't exist AND
               4534 < run < 5314 (XTCN wrong)
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   LTRIGS                                                                          
   LUPACR                                                                          
   SILHCR                                                                          
        |---- LGNGBX                                                               
                   |----  NAMIND                              External             
                   |----  CHAINT                              External             
                   |----  RERROR                                                   
   
 
3 LHVSTA
         SUBROUTINE LHVSTA(ITYPE)
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Check the high voltage status bits
   
      Author   : P. H. Hansen  891017
      Modified : J. Wear       891119
                 J. Wear       900322  ! Added physics trigger check
      Modified : P. H. Hansen  960501  ! Use X1RG bank
      Modified : B. Bloch      9711    ! use XLUMOK from ALEPHLIB
      Modified : B. Bloch      0003    ! new XLUM2K logical
                               Output:
                                         ITYPE=0 Nothing turned on
                                         ITYPE=1 LCAL HV on, trigs enabled
                                                 no LOLE error
                                         ITYPE=2 standard xlumok, false
                                                 during mini ramp
                                         ITYPE=3 standard xlumok, but
                                                 tolerating mini ramp
   
   
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   LSELBH                                                                          
   LSINGL                                                                          
        |---- LHVSTA                                                               
                   |----  XLUMOK                              External             
                   |----  LLUMOK                              External             
                   |----  XLUM2K                              External             
   
 
3 LIDCOD
         SUBROUTINE LIDCOD
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Set acceptance code and quality flag
   
      Author   : P. H. Hansen  890101
      Modified : H. Meinhard   05-Mar-1990
      Modified : P. H. Hansen  01-May-1996 Fix reference MC energy
      Modified : P. H. Hansen  16-Jun-1997 Use BHZ0 bank for Z0 runs from 1996
      Modified : P. H. Hansen  24-Jun-1997 Fix reference energy of methods < 9
   
        Input  : 'LIDT'           Lumi electron candidate bank
                 'SFTR'           Lumi track bank
                 'BHAB'           Cuts from data cards
        Output :
                 'LIDT'  IFlag    Track Quality flag
                                  bit0:    track or patch
                                  bit1:    track
                                  bit2:    SATR region
                 'LIFL'  K1rg     Flag for small fiducial area
                                  bit0-32: cuts 1-32
                 'LIFL'  K2rg     Flag for large fiducial area
                                  bit0-32: cuts 1-32
                 'LIFL'  KHrg     Flag for high energy threshold
                                  bit0-32: cuts 1-32
                 'LIFL'  KLrg     Flag for low energy threshold
                                  bit0-32: cuts 1-32
   
      Description :
      ===========
      Encode quality flag in LIDT
      Encode Bhabha acceptance code LIFL
      Six different acceptance definitions are considered:
         1) Tracks used to determine accepted fraction
            in SATR region. Cluster centroid used outside.
         2) Track required on small side
            Either track or cluster is used on the other side.
         3) Track required on both sides.
         4) Cluster centroid used on both sides.
         5) Pad boundaries used on small side.
         6) Restricted version of 5)
      The definitions are chosen according to the
      Method number and the track quality flag in bank BHAB.
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   LTRACK                                                                          
        |---- LIDCOD                                                               
                   |----  MOD                                 External             
                   |----  AUBOS                               External             
                   |----  BLIST                               External             
                   |----  NAMIND                              External             
                   |----  MIN0                                External             
                   |----  TAN                                 External             
                   |----  COS                                 External             
                   |----  SIN                                 External             
                   |----  ATAN                                External             
                   |----  SQRT                                External             
                   |----  ABS                                 External             
                   |----  BTEST                               External             
                   |----  ATAN2                               External             
                   |----  LACCEP                                                   
   
 
3 LINIJO
         SUBROUTINE LINIJO
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Initialisation of lcal job
   
      Author   : P. H. Hansen  870401
      Modified : P. H. Hansen  880315
      Modified : H. Meinhard   14-Mar-1990   LUPA initialization added
   
      Description :
      ===========
      Set name indices for Lcal banks
      Set bank formats for printing
      Reset reconstruction job statistics
      Initialize the LUPA stuff
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   RINJOB                                                                          
        |---- LINIJO                                                               
                   |----  LBINDX                                                   
                   |----  AUBOS                               External             
                   |----  VZERO                               External             
                   |----  LUPAIN                                                   
   
 
3 LINIRU
         SUBROUTINE LINIRU
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Lcal run initialisation
   
      Author   : P. H. Hansen  880307
      modified : F.Ranjard     920330
                 get the LALI bank:
                 montecarlo -from run header or data cards or DB using
                 the setup code
                 real data  -from data cards or DB using the run number
                 F.Ranjard     930416
                 montecarlo - use AGETDB instead of MDARD to get LALI
   
      Modified :- E. Lancon             17-MAY-1993
           create LEHI, LUMI, LBak, LVHI, LONL with nr = run number
      Modified :- M. Cattaneo           16-JUN-1997
           get BHZ0 bank from database
      Modified :- P.Hansen, M. Cattaneo 17-JUL-1997
           Enable taking LDST from start of run record
   
      Input    : none
      Output   :
                 LCRE bank (constants used in cluster reconstruction)
                 LMTY bank (constants describing a LCAL module type)
                 LSLO bank (position of a LCAL module)
                 LALI bank (alignment corrections)
                 LRWG bank (constants specific for a row of towers)
                 LLAY bank (constants specific for a wire plane)
                 BHAB bank (Cuts for Bhabha event selection)
                 BHZ0 bank (Cuts for Bhabha event selection)
                 LECA bank (Lcal energy calibration)
                 LDST bank (Lcal dead storey list)
                 LDWP bank (Lcal dead wire plane list)
   
                 LUMI bank (luminosity run statistics)
                 LBAK bank (luminosity background statistics)
                 LONL bank (trigger statistics)
                 LEHI Bbank (energy histograms)
                 LVHI Bbank (vertex histograms)
      Description :
      ===========
      Read geometry and constant banks from DAF
      Temporary quick fixes of data base banks
      Reset luminosity, background and trigger statistics bank
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   RINRUN                                                                          
        |---- LINIRU                                                               
                   |----  NAMIND                              External             
                   |----  GTSTUP                              External             
                   |----  AGETDB                              External             
                   |----  REPORT                                                   
                   |----  ALGTDB                              External             
                   |----  VZERO                               External             
                   |----  AUBOS                               External             
                   |----  FLOAT                               External             
                   |----  INT                                 External             
   
 
3 LOLERR
         SUBROUTINE LOLERR(IERR)
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Check for online errors
   
      Author   : P. H. Hansen  890905
   
        Input   : 'LWDI' 'LTDI' 'LDWP' 'LDST' 'LOLE'
        Output  :  IERR (=0 if OK)
                  'LOLE'
   
        Description :
        ===========
        Check if LOLE bank exists - otherwise we have a problem
        Check for Fastbus errors
        Check for Missing marker channels (every 32nd always read)
        Check for HV trips and current exeeding limit
          *** 7/5/92 Current trips happen to often. I stop setting
          ***        the global error bit because of this
        Check for sparks (or events following a spark):
         IF
            (  >7.5 GeV in one plane AND
               >80% of the energy in that plane)
            OR < -1 GeV on the analog wiresum in a module
            OR < -4 GeV in a storey layer
            OR > 60 GeV in a storey layer
         THEN store plane address in LOLE
        (cells that are put dead via the banks LDST and LDWP
         are disregarded in the spark check)
        In case of any error set IERR = -1 and report
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   LPREMC                                                                          
        |---- LOLERR                                                               
                   |----  MOD                                 External             
                   |----  NAMIND                              External             
                   |----  AUBOS                               External             
                   |----  RERROR                                                   
                   |----  FLOAT                               External             
                   |----  VZERO                               External             
   
 
3 LPRCAL
         SUBROUTINE LPRCAL
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Print energy calibration
   
      Author : P.H. Hansen 891210
      Input    : LEHI,LVHI
      Output   : Calibration print
   
      Description :
      ===========
      Calculate and print mean and rms of energy calibration
      and vertex histograms.
   
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   LPRLUM                                                                          
        |---- LPRCAL                                                               
                   |----  FLOAT                               External             
                   |----  AMAX1                               External             
                   |----  SQRT                                External             
   
 
3 LPREDA
         SUBROUTINE LPREDA
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Prepare lcal data
   
      Author   : P. H. Hansen  880801
   
        Input   : 'LTDI' 'LWDI'        ( if Monte Carlo input)
        Input   : 'PLSD' 'PLPD' 'PLOB' ( if POT input)
        Input   : 'LAR2'               ( if Test Beam input)
        Output  : 'LSDA' 'LPDA' ('LOBJ')
        Created : 'LSDA' 'LPDA' ('LOBJ')
   
        Description :
        ===========
          Transform raw data banks into
          prepared data banks.
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   RPREDA                                                                          
        |---- LPREDA                                                               
                   |----  BLIST                               External             
                   |----  LPREMC                                                   
                   |----  LPREPO                                                   
                   |----  NLINK                               External             
                   |----  LPRERW                                                   
   
 
3 LPREMC
         SUBROUTINE LPREMC
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Prepare lcal data
   
      Author   : P. H. Hansen  870401
      Modified : P. H. Hansen  890905
      Modified : P. H. Hansen  970801
      (Ressurrection of dead wires at storey 2/3 interface corrected,
       Storey energy redistributed in case of dead wires)
      (Suppression of negative energies)
      Modified : P. H. Hansen  981111
        Remove offline pedestal follower after run 45000
   
        Input   : 'LTDI' 'LWDI' 'LECA' 'LDST' 'LDWP' 'LOLE'
        Output  : 'LSDA' 'LPDA' 'LOLE'
        Created : 'LSDA' 'LPDA'
   
        Description :
        ===========
        Check for online errors (Fastbus errors, HV trip, Sparks)
        Repair LWDI formatting errors during pilot run
        Subtract pedestals measured in a previous event
        Fill LSDA with calibrated Storey Data LTDI
        Fill LPDA with calibrated Wire Data LWDI
        Assign to dead storey channels the storey energy fraction
        measured in the other storeys.
        Assign to dead planes the average energy of the neighbours.
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   LPREDA                                                                          
        |---- LPREMC                                                               
                   |----  MOD                                 External             
                   |----  VZERO                               External             
                   |----  LOLERR                                                   
                   |----  LBUNCA                                                   
                   |----  AUBOS                               External             
                   |----  BLIST                               External             
                   |----  FLOAT                               External             
                   |----  MAX                                 External             
                   |----  LSUMAM                                                   
                   |----  AMAX1                               External             
   
 
3 LPREPO
         SUBROUTINE LPREPO
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Unpack lcal pot banks
   
      Author   : P. H. Hansen   880801
      Input    : 'PLSD' 'PLPD'
      Output   : 'LSDA' 'LPDA'
      Created  : 'LSDA' 'LPDA'
   
      Description :
      ===========
      Use POT banks to recreate standard input for Lcal reconstruction
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   LPREDA                                                                          
        |---- LPREPO                                                               
                   |----  AUBOS                               External             
                   |----  BLIST                               External             
                   |----  FLOAT                               External             
                   |----  VZERO                               External             
   
 
3 LPRERW
         SUBROUTINE LPRERW
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Prepare lcal raw data
   
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   LPREDA                                                                          
        |---- LPRERW.                                                              
   
 
3 LPRLUM
         SUBROUTINE LPRLUM
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Calculate and print luminosity for this run
   
     Author       :- P.H.Hansen 89/01/01
     Modified     :- J. Wear and P. H. Hansen   89/11/19
                   - J. Wear 90/02/09
                   - P.H.Hansen 92/02/19
     Modified     : P. Comas      940502
              Use of X1TT instead of XTOP dropped in the readout upgrade.
     Modified     : P.H.Hansen    960501
              Print only Method 10. Background estimate is #events with
              dphi<20deg - corrected for the possible anisotropy of the
              the single arm combinations recorded in LBAK. If not
              enough method 10 events in LBAK use method 4.
     Modified : P. H. Hansen  16-Jun-1997 Use BHZ0 bank for Z0 runs from 1996
     Modified : P. H. Hansen  11-Aug-1997 Compensate for dead module in early
                                          1997 running
     Modified : P. H. Hansen  15-March-2000 Fill new row (11th) in LUMI
                                            with Lumi including miniramp
   
     Input:       'LUMI' 'BHAB'  'LBAK' 'LONL'
   
     Description:
     ============
     Do final background update for this run
     Print energy and vertex summary
     Print summary of lumi triggers for this run
     For each method
        Print selection criteria
        Print numbers of events surviving successive cuts
        Print corresponding numbers of fake events
        Calculate background contribution
        Calculate luminosity and its statistical error
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   RCLRUN                                                                          
        |---- LPRLUM                                                               
                   |----  LBLDBA                                                   
                   |----  NDROP                               External             
                   |----  LPRCAL                                                   
                   |----  JPRERF                              External             
                   |----  NAMIND                              External             
                   |----  LBHCOR                                                   
                   |----  SQRT                                External             
                   |----  MAX                                 External             
   
 
3 LPRSUM
         SUBROUTINE LPRSUM
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Print general event statistics
   
     Author       :- P.H.Hansen 89/01/02
   
     Input:       'LSTA'
   
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   RSMJOB                                                                          
        |---- LPRSUM                                                               
                   |----  NAMIND                              External             
   
 
3 LSELBA
         SUBROUTINE LSELBA(IA,IB)
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Selection of bhabha background
   
      Author   : P. H. Hansen  890701
    Modified   : J. Wear       891119
    Modified   : P. Comas      940502
    Modified   : P. H. Hansen  950401
    Modified   : P. H. Hansen  960501
      Ignore scalefactors. Drop cut on summed energy (to gain stat)
   
        Input  :  IA,IB           row numbers in LSIN
                  'LSIN'          single arm storage bank
                  'BHAB'          Bhabha selection criteria
        Output :  'LBAK'          Fake Bhabha event statistics
      Description :
      ===========
         Decide which side has the smaller fiducial area.
         For each requested measurement method require successively:
            At least one cluster over high threshold.
            Both clusters over low threshold.
            Both clusters be contained in their proper fiducial areas.
            Coplanarity.
         Update a counter in LBAK after each passed cut.
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   LBLDBA                                                                          
        |---- LSELBA                                                               
                   |----  NAMIND                              External             
                   |----  ABS                                 External             
                   |----  AMIN1                               External             
                   |----  RNDM                                External             
                   |----  BTEST                               External             
   
 
3 LSELBH
         SUBROUTINE LSELBH(ITYPE)
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Bhabha selection algorithm
   
      Author   : P. H. Hansen  890701
      Modified :- E. Lancon             10-APR-1991
                       Use ALTRIG to Access Trigger bits
      Modified : P. H. Hansen           01-MAY-1996
                       Improved debug print. Fix reference energy.
      Modified : P. H. Hansen           24-JUN-1997
                       Fix SFRAC for methods < 9
   
   
        Input  :  ITYPE           Trigger type:
                                  2: HI SINGLE Trigger
                                  3: VH SINGLE Trigger
                                  4: LOW-LOW Trigger
                                  5: HIGH-LOW Trigger
                 'BHAB'           Bhabha selection criteria
        Output : 'LUMI'           Selected Bhabha event statistics
      Description :
      ===========
         Decide which side has the smaller fiducial area.
         For each requested measurement method require succesively:
            At least one cluster over high threshold.
            Both clusters over low threshold.
            Coplanarity.
            Both clusters be contained in their proper fiducial areas.
         Update a counter in LUMI after each passed cut.
         In SATR region count events with tracks
            and events with tracks in the fiducial area.
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   LBHAB                                                                           
        |---- LSELBH                                                               
                   |----  NAMIND                              External             
                   |----  ABS                                 External             
                   |----  AMIN1                               External             
                   |----  MOD                                 External             
                   |----  BTEST                               External             
                   |----  LHVSTA                                                   
                   |----  ALTRIG                              External             
                   |----  LTGBIT                                                   
   
 
3 LSINGL
         SUBROUTINE LSINGL(ITYPE)
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Store single arm triggers
   
      Author   : P. H. Hansen  890701
      Modified : P. H. Hansen  960501
          (restrict to one-cluster evts, check LCAL HV)
   
        Input  : ITYPE            Trigger type:
                                  1: Exclusive single low threshold
                                  2: Exclusive single high threshold
                 'LIDT'           Lumi electron candidate bank
                 'LIFL'           Lumi track bank
        Output :
                 'LSIN'           Singles storage
   
      Description :
      ===========
      Book or expand singles bank if needed
      Find highest energy cluster
      Transfer the relevant attributes to singles bank
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   LBHAB                                                                           
        |---- LSINGL                                                               
                   |----  LHVSTA                                                   
                   |----  AUBOS                               External             
   
 
3 LSLOWC
         SUBROUTINE LSLOWC
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Handle slow control for lcal
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   RUNKNO                                                                          
        |---- LSLOWC.                                                              
   
 
3 LSTATI
         SUBROUTINE LSTATI
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Accumulate job statistics
   
      Author   : P. H. Hansen  890101
   
        Input  : 'LOBJ'           cluster bank
                 'LPDA'           wire bank
        Output : 'LSTA'           Job statistics
   
      Description :
      ===========
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   LELECT                                                                          
        |---- LSTATI.                                                              
   
 
3 LSUMAM
         INTEGER FUNCTION LSUMAM(IPAD)
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Find summing amplifier
      Author :      P.H.Hansen - 891010
      Input  : IPAD    = Tower address
      Output : LSUMAM  = Amplifier No. [1,48]
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   LPREMC                                                                          
        |---- LSUMAM                                                               
                   |----  MOD                                 External             
   
 
3 LTGBIT
         SUBROUTINE LTGBIT(IRUN,TLTYP,LTBIT,LTORW,NTBIT,IFAIL)
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Author   :-  j.wear               23-mar-1990
      Mods     :-  J.Wear               20-JUN-1990
                          CRAY compatible, Hardwired all lumi-bits for
                          protection -- this should go to a database and
                          forget reading the trigger banks.
      Mods     :-  P.H.Hansen           01-MAY-1996
                          New hardwired periods
   
      Inputs: IRUN -- run number
             TLTYP -- Character string describing a LCAL trigger type
                      The five Luminosity trigger types are
                      LO_SING, HI_SING, VH_SING, LO_COIN, HI_COIN .
   
      Outputs: LTBIT(5) :contains bit assignments of TLTYP trigger type
           -   LTORW(5) :contains source of trigger
           -             (Tower=0, Wire=1, SATR=2)
               NTBIT    :contains the number of bits assigned to TLTYP
               IFAIL    : = 1, if XTBN is corrupt, use hardwired values
                          = 2, if incorrect input
   
      Description  There are five basic types of LCAL triggers whose
      ===========  composition and names change from run period to run
                   period.  This routine maps the types of the triggers
      to the corresponding bits in the trigger mask (returns up to five
      separate bits for a trigger type to cover redundant triggers, extra
      values have bit settings of -1).  It also checks the actual trigger
      name to decide whether this is tower-, wire-, or SATR-based.
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   LSELBH                                                                          
   LTGTYP                                                                          
        |---- LTGBIT                                                               
                   |----  VZERO                               External             
                   |----  NAMIND                              External             
                   |----  CHAINT                              External             
                   |----  NDFBT                               External             
   
 
3 LTGTYP
         SUBROUTINE LTGTYP(IRUN,MASK,XLTRG)
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Author   :-  j.wear               21-mar-1990
   
      Inputs:  IRUN -- run number
           -   MASK -- fired trigger mask (either L1,L2,L2*enable mask)
   
      Outputs: XLTRG(5) -- logical array containing which type of Lumi
                           triggers have fired. (either wire or tower)
               ITYPE=1     : single low threshold
                    =2     : single high threshold
                    =3     : single very high threshold
                    =4     : low-threshold coincidence
                    =5     : high-threshold coincidence
   
      Libraries required:
   
      Description  This routine begs to have more readable code.  Will
      ===========  be upgraded when Trigger code is available in ALEPHLIB
   
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   LTRIGS                                                                          
        |---- LTGTYP                                                               
                   |----  LTGBIT                                                   
   
 
3 LTRACE
         SUBROUTINE LTRACE
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Connect lumi tracks with clusters
   
      Author   : P. H. Hansen   890101
      Modified : H. Meinhard    05-Mar-1990
      Input    : 'SFTR' 'LSDA' 'LCLU'
      Output   : 'LTRK'
      Created  : 'LTRK'
   
      Description :
      ===========
        Create a temporary bank LTRK.
        Create electron candidate bank LIDT
        For each SFTR track
          find the tower and cluster being hit
          fill the CHarge column of LCLU
          fill LTRK row with
               2.  LCLU row
               3.  LSDA row
               4.  dist to cluster
             5-6.  dist to edges
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   LTRACK                                                                          
        |---- LTRACE                                                               
                   |----  NAMIND                              External             
                   |----  AUBOS                               External             
                   |----  TAN                                 External             
                   |----  COS                                 External             
                   |----  SIN                                 External             
                   |----  ATAN                                External             
                   |----  SQRT                                External             
                   |----  ATAN2                               External             
                   |----  LDIRTW                                                   
                   |----  UCOPY                               External             
                   |----  PRTABL                              External             
   
 
3 LTRACK
         SUBROUTINE LTRACK
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Connect lumi tracks with clusters
   
      Author   : P. H. Hansen   891215
      Modified : H. Meinhard    05-Mar-1990
      Input    : 'SFTR' 'LOBJ' 'LIDT'
      Output   : 'LIDT'
   
      Description :
      ===========
        Connect lumi tracks with clusters (create and fill LTRK)
        For each cluster
          find the closest track
          store LIDT <--> SFTR relation
        Create and fill LIFL
        Do Bhabha analysis
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   RECEVT                                                                          
        |---- LTRACK                                                               
                   |----  NAMIND                              External             
                   |----  LTRACE                                                   
                   |----  NDROP                               External             
                   |----  LIDCOD                                                   
                   |----  PRTABL                              External             
                   |----  LBHAB                                                    
   
 
3 LTRIGS
         SUBROUTINE LTRIGS(ITYPE)
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Count trigger types and background
   
      Author   : P. H. Hansen  890701
    Modified   : J. Wear       891119  Count GBX's from trigger scalar ba
    Modified   : E. Lancon     10-APR-1991  Use ALTRIG to Trigger bits
    Modified   : P. H. Hansen  01-MAY-1996  Update backgr every 10 single
   
        Input  : 'X1SC'           Trigger info -- GBX count since last ev
                 'XTEB'/'XTRB'    Trigger bit mask from level 1
                 'XTCN'           Trigger info -- GBX count (incorrect)
                 'LSIN'           Singles storage
   
        Output :  ITYPE=0         : Non-lumi
                       =1         : exclusive single low
                       =2         : exclusive single high
                       =3         : exclusive single very high
                       =4         : exclusive low-low
                       =5         : high-low
                 'LONL'           Lcal Online trigger statistics
                 'LBAK'           Beamgas background to Bhabhas
      Description :
      ===========
      Classify and count trigger types
      IF (not Monte Carlo) THEN
          Count GBX and RANDOM
          Decide if time is up for background estimate
      ELSE
          Count events
          Decide if time is up for background estimate
      ENDIF
      IF (time is up) THEN
          Update background statistics -- call LBLDBA
          Reset GBX and RANDOM counters
          Reset singles storage
      ENDIF
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   LBHAB                                                                           
        |---- LTRIGS                                                               
                   |----  ALTRIG                              External             
                   |----  LTGTYP                                                   
                   |----  LGNGBX                                                   
                   |----  FLOAT                               External             
                   |----  LBLDBACONTINUE                      External             
   
 
3 LUPACR
         SUBROUTINE LUPACR(IER)
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Create and fill the lupa bank
   
       Author:     H. Meinhard       16-Mar-1990
       Modified:   P. Hansen         04-Apr-1990  (1)
       Modified:   H. Meinhard       10-Apr-1990  (2)
       Modified:   H. Meinhard       27-Aug-1990  (3)
       Modified :- E. Lancon             10-APR-1991
                         Use ALTRIG to access Trigger bits
       Modified:   H. Meinhard       24-Apr-1991  (5)
       Modified:   H. Meinhard       30-Apr-1991  (6)
       Modified:   H. Meinhard       09-Aug-1991  (7)
                         Create LUPA for MC regardless of trigger pattern
       Modified:   P. Hansen         01-Aug-1991  (7)
                      Remove the NDROP('LMAP',0)
       Modified:   P. Hansen         01-MAY-1996  (8)
                      Replace refs to obsolete banks XTCN and XTOP
                      by refs to X1RG and X1TT
       Modified:   M. Cattaneo       17-JAN-1997  (9)
                      Reinstate filling of trigger enable mask in LUPA
       Modified:   M. Cattaneo       06-NOV-1997  (10)
                      Store X1RG, XTPB, XTCN, SFTR name indices locally
   
       Input:      - banks 'LCLU','LIDT','LIFL','LOLE','LUMI','LOCL'
                           'PLPD','PLSD','PSCO','SFTR','XTBP','XTCN',
                           'XTOP'
                     from data base: 'LCRE'
       Output:     - IER       /I    error flag:
                                     0 = no error
                                     1 = some input bank missing
                                     2 = no space for new bank
                                     -1= LUPA not created
                   - bank 'LUPA'
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   RDEFPO                                                                          
        |---- LUPACR                                                               
                   |----  MOD                                 External             
                   |----  NAMIND                              External             
                   |----  RTRIGF                                                   
                   |----  AUBOS                               External             
                   |----  LGNGBX                                                   
                   |----  CHAINT                              External             
                   |----  ALTRIG                              External             
                   |----  BTEST                               External             
                   |----  REAL                                External             
                   |----  VZERO                               External             
                   |----  INT                                 External             
                   |----  MVBITS                              External             
                   |----  TAN                                 External             
                   |----  COS                                 External             
                   |----  SIN                                 External             
                   |----  LASYM                                                    
                   |----  FLOAT                               External             
                   |----  LACCEP                                                   
                   |----  PROB                                External             
   
 
3 LUPAIN
         SUBROUTINE LUPAIN
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Lupa initialization
   
       Author:     H. Meinhard       14-Mar-1990
       Modified:   M. Cattaneo       06-Nov-1997
                   Suppress filling of x1namc COMMON due to clash with
                   Alephlib in definition of same common
   
       Description
       ===========
       Fill common LUPACM
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   LINIJO                                                                          
        |---- LUPAIN                                                               
                   |----  VZERO                               External             
                   |----  MOD                                 External             
                   |----  NINT                                External             
   

2 M_

  >>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>
    CKEY 
     1st entry in M_set
     * corr file 307.1
        MPREDG : If max no. of hits reached, fill MHIT up to max no. of hits
                 rather than return empty MHIT                         (G.Bagliesi)
    
     ! JULIA 285
        MUREDO - Moved to Julia library from Alephlib (version 216) because it 
                 calls Julia routines (A.Waananen 5/12/96, M.Cattaneo 19/02/97)
    
     ! JULIA 284
       MPREDG : Ignore bits 8-11 in data from new Astros (G.Bagliesi 9-10-96)
    
     ! JULIA 280
       MUASS,MUTEST : opening "'" should have a closing "'" within the same
               the same line for cvs (F. Ranjard, Feb 96)
       MUNEWR : change LOUTRL and LDEBRL to IW(6) instead of 6 (P.Comas,
               Feb 96)
    
     * corr file 279.2
       MUSLCM : bug which rejected 2% of the hits in the middle angle muon
               chambers fixed (A.Venturi, Dec 95)
     ! JULIA 279
    
     * corr file 275.5
       MPREDG: correction for bad cabling in first runs of 1994 data,
              from 25000 to 25895 (P.Campana, Feb 95)
     ! JULIA 275
     * corr file 274.1
       MUASS: allow to have the MUEX banks in the data even
              if there is no hit in the muon chambers (A.Venturi).
    
  <<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<
     MGINIG     Initialise muon reconstruction with new data base
     MINHEA     Fill header bank dhea for mini-dst.
     MINIJO     Initialise the muon job
     MINIRU     Initialise the muon run
     MODROC     Calculate ecal module number from roc and adc
     MPREDA     Prepare muon data
     MPREDG     Steering routine for muon hit data decoding with new data base
     MPREDM     Steering routine for muon hit data
     MPRSUM     Print run statistics for muon
     MSLOWC     Handle slow control for muon
     MUALCM     Transformation from slot coord. to aleph m.r.s.
     MUALCO     Transformation from slot coord. to aleph m.r.s.
     MUASS      Associate extrapolated tpc track to muon hits
     MUBOOK     Booking of muon detector histograms
     MUCOMP     Compare reconstructed muon-hits with truth
     MUCUTS     Coeffic for muon assoc.dist.and scatt.angle.
     MUHIST     Fill muon histograms
     MUHITG     Provides from mhit bank all useful hit info (new db)
     MUHITS     Provides from mhit bank cartesian coordinates of hits
     MUKINE     Search kine bank associated to current tpc track
     MUNEWR     Initialises muon id part, for use outside of the julia context
     MUREDO     Authors   :- g.taylor
     MUSLCM     Subroutine transforming from raw data to slot coordinate system
     MUSLCO     Subroutine transforming from raw data to slot coordinate system
     MUTEST     Test mu-hits within mult. scatt. cuts

3 MGINIG
            SUBROUTINE MGINIG(LRGEO,IRUNR,IERR,NEWNR)
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Initialise muon reconstruction with new data base
   
      Author   :- P.Campana    890608
      Modified :- P.Campana    910530 Corr. for 2 layer
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   MINIRU                                                                          
   MUNEWR                                                                          
        |---- MGINIG                                                               
                   |----  ALGTDB                              External             
                   |----  NAMIND                              External             
   
 
3 MINHEA
         SUBROUTINE MINHEA
  ------------------------------------------------------------------------------
    CKEY MDST /INTERNAL
  ------------------------------------------------------------------------------
   Fill header bank dhea for mini-dst.
       Author: Stephen Haywood      22-Jan-90
       Input  : PYER,FRFT,YV0V,PEWI banks
       Output : DHEA bank
       The energy flow information is filled by calling FIDHEA later.
       If this routine is not called, the information will be zero.
       FIDHEA is written by Minard and Pepe and lives in Julia.
       Also the ALEPHLIB routine ALFIEL is called to obtain the B-field.
       UFITQL is called to identify good tracks.
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   RDEFMI                                                                          
        |---- MINHEA                                                               
                   |----  AUBOS                               External             
                   |----  NLINK                               External             
                   |----  UFITQL                              External             
                   |----  ALFIEL                              External             
                   |----  FLOAT                               External             
                   |----  NINT                                External             
   
 
3 MINIJO
         SUBROUTINE MINIJO
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Initialise the muon job
    G. Capon    13-aug-87
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   MUNEWR                                                                          
   RINJOB                                                                          
        |---- MINIJO                                                               
                   |----  NAMIND                              External             
   
 
3 MINIRU
         SUBROUTINE MINIRU
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Initialise the muon run
    G.Capon
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   RINRUN                                                                          
        |---- MINIRU                                                               
                   |----  MGINIG                                                   
                   |----  RERROR                                                   
   
 
3 MODROC
         INTEGER FUNCTION MODROC ( IROC , IADC )
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Calculate ecal module number from roc and adc
   
        Lee F. Thompson. 23rd April 1990.
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   EFERRR                                                                          
        |---- MODROC.                                                              
   
 
3 MPREDA
         SUBROUTINE MPREDA
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Prepare muon data
   
      F.Bossi/G.Capon/D.Kuhn             861107
   
      Modified    by   R.Xu              871029
   
      Input:  - Banks MUDI    : raw data from mu-chamber
                                (Barrel, Middle-angle and Endcaps)
    Output:   bank MHIT
   
    variables used :
     ISUBC      : subcomp # (1=endcaps,2=midangle,3=barrel)
     NSLOT      : slot #    (1,24 barrel; 25,62 midangle; 63,78 endcap)
     LAYER      : streamer tubes layer in a slot =1,2
     XX,YY      : Coordinates of strips clusters in local module system
     RHO,THETA,PHI: Rho, Theta and Phi of hit in ALEPH - system
   
   
      Description
      ===========
      Digitisings of strip clusters from hits in Mu-chambers are
      converted to polar coordinates in the ALEPH-system
   
   
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
              MPREDA                                                               
                   |----  BLIST                               External             
                   |----  JHISRF                              External             
                   |----  AUBOS                               External             
                   |----  RERROR                                                   
                   |----  NLINK                               External             
                   |----  MXYLOC                              External             
                   |----  MBAPOL                              External             
                   |----  MMAPOL                              External             
                   |----  MENPOL                              External             
                   |----  MBSPOL                              External             
                   |----  HFILL                               External             
                   |----  NDROP                               External             
                   |----  PRTABL                              External             
                   |----  MUCOMP                                                   
   
 
3 MPREDG
            SUBROUTINE MPREDG
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Steering routine for muon hit data decoding with new data base
   
    P.Campana    890608
    P.Campana    910530 Corr. for 2 layer
    G.Bagliesi   961009 Ignore bits 8-11 in data from new Astros
   
    Input:  MUDG raw data bank
    Output: MHIT ALEPH coord. hits bank
   
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   MUREDO                                                                          
   RPREDA                                                                          
        |---- MPREDG                                                               
                   |----  NAMIND                              External             
                   |----  ALGTDB                              External             
                   |----  RERROR                                                   
                   |----  NLINK                               External             
                   |----  JHISRF                              External             
                   |----  BDROP                               External             
                   |----  AUBOS                               External             
                   |----  CHAINT                              External             
                   |----  SQRT                                External             
                   |----  ATAN2                               External             
                   |----  IBITS                               External             
                   |----  VZERO                               External             
                   |----  PAN                                 External             
                   |----  MBNAST                              External             
                   |----  MBTAST                              External             
                   |----  MENAST                              External             
                   |----  METAST                              External             
                   |----  MANAST                              External             
                   |----  MATAST                              External             
                   |----  MAOFBU                              External             
                   |----  MAOAST                              External             
                   |----  MBUPBU                              External             
                   |----  HFILL                               External             
                   |----  FLOAT                               External             
                   |----  MUSLCO                                                   
                   |----  MUALCO                                                   
                   |----  ALECOFORMAT                         External             
                   |----  NDROP                               External             
                   |----  NPRNT                               External             
                   |----  MUCOMP                                                   
   
 
3 MPREDM
            SUBROUTINE MPREDM
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Steering routine for muon hit data
    decoding with new data base (MonteCarlo data only)
   
    P.Campana    891128
   
    Input:  MUDG raw data bank
    Output: MHIT ALEPH coord. hits bank
   
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   MUREDO                                                                          
   RPREDA                                                                          
        |---- MPREDM                                                               
                   |----  JHISRF                              External             
                   |----  NLINK                               External             
                   |----  RERROR                                                   
                   |----  BDROP                               External             
                   |----  AUBOS                               External             
                   |----  NAMIND                              External             
                   |----  CHAINT                              External             
                   |----  SQRT                                External             
                   |----  ATAN2                               External             
                   |----  PAN                                 External             
                   |----  IBITS                               External             
                   |----  MBNAST                              External             
                   |----  MBTAST                              External             
                   |----  MENAST                              External             
                   |----  METAST                              External             
                   |----  MANAST                              External             
                   |----  MATAST                              External             
                   |----  MAOFBU                              External             
                   |----  MAOAST                              External             
                   |----  MBUPBU                              External             
                   |----  HFILL                               External             
                   |----  FLOAT                               External             
                   |----  MUSLCM                                                   
                   |----  MUALCM                                                   
                   |----  ALECOFORMAT                         External             
                   |----  NDROP                               External             
                   |----  NPRNT                               External             
                   |----  MUCOMP                                                   
   
 
3 MPRSUM
         SUBROUTINE MPRSUM
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Print run statistics for muon
      G.Capon 13-aug-87
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   RSMJOB                                                                          
        |---- MPRSUM.                                                              
   
 
3 MSLOWC
         SUBROUTINE MSLOWC
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Handle slow control for muon
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   RUNKNO                                                                          
        |---- MSLOWC.                                                              
   
 
3 MUALCM
           SUBROUTINE MUALCM(IEL,SLTCO,ALECO)
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Transformation from slot coord. to aleph m.r.s.
   
    P.Campana    890608
   
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   MPREDM                                                                          
        |---- MUALCM                                                               
                   |----  BRBOXG                              External             
                   |----  MBPNT2                              External             
                   |----  FLOAT                               External             
                   |----  BDELTC                              External             
                   |----  BERREC                              External             
                   |----  ATAN2                               External             
                   |----  COS                                 External             
                   |----  BZBOXG                              External             
                   |----  BZETAC                              External             
                   |----  SQRT                                External             
                   |----  ACOS                                External             
                   |----  MEPNTY                              External             
                   |----  EYYBOX                              External             
                   |----  EXXBOX                              External             
                   |----  EXXXXC                              External             
                   |----  EYYYYC                              External             
                   |----  EZETAC                              External             
                   |----  ASIN                                External             
                   |----  MAVOLU                              External             
                   |----  ARRBOX                              External             
                   |----  MAPNTY                              External             
                   |----  ADELTC                              External             
                   |----  AERREC                              External             
                   |----  AZETAC                              External             
   
 
3 MUALCO
           SUBROUTINE MUALCO(IEL,SLTCO,ALECO)
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Transformation from slot coord. to aleph m.r.s.
   
    P.Campana    890608
    P.Campana    910530 Corr. for 2 layer
   
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   MPREDG                                                                          
        |---- MUALCO                                                               
                   |----  MBPNT2                              External             
                   |----  BRBOXG                              External             
                   |----  BZBOXG                              External             
                   |----  FLOAT                               External             
                   |----  BDELTC                              External             
                   |----  BERREC                              External             
                   |----  ATAN2                               External             
                   |----  COS                                 External             
                   |----  BZETAC                              External             
                   |----  SQRT                                External             
                   |----  ACOS                                External             
                   |----  MEPNTY                              External             
                   |----  EYYBOX                              External             
                   |----  EXXBOX                              External             
                   |----  EXXXXC                              External             
                   |----  EYYYYC                              External             
                   |----  EZETAC                              External             
                   |----  ASIN                                External             
                   |----  MAVOLU                              External             
                   |----  ARRBOX                              External             
                   |----  MAPNTY                              External             
                   |----  ADELTC                              External             
                   |----  AERREC                              External             
                   |----  AZETAC                              External             
   
 
3 MUASS
           SUBROUTINE MUASS
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Associate extrapolated tpc track to muon hits
   
     G.Capon, M.Dreucci        28-May-87
   
   
          steering routine : calls Muhits, Mucuts, Mutest, Mukine
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   MUREDO                                                                          
   RECEVT                                                                          
        |---- MUASS                                                                
                   |----  NAMIND                              External             
                   |----  AUBOS                               External             
                   |----  RERROR                                                   
                   |----  MUHITG                                                   
                   |----  NLINK                               External             
                   |----  SQRT                                External             
                   |----  MUCUTS                                                   
                   |----  UCOPY                               External             
                   |----  PRTABL                              External             
                   |----  MUTEST                                                   
                   |----  MUKINE                                                   
                   |----  WDROP                               External             
                   |----  NDROP                               External             
   
 
3 MUBOOK
         SUBROUTINE MUBOOK
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Booking of muon detector histograms
    G.Capon               20-oct-1987
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   RBKHIS                                                                          
        |---- MUBOOK                                                               
                   |----  HBOOK1                              External             
                   |----  JHISRF                              External             
                   |----  HBOOK2                              External             
                   |----  HIDOPT                              External             
   
 
3 MUCOMP
           SUBROUTINE MUCOMP
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Compare reconstructed muon-hits with truth
   
      F.Bossi/G.Capon/D.Kuhn             861107
   
     called by MPREDA
   
    this routine uses straight tracks to check Galeph and Julia
    muon geometry routines. called only if muon hist flag is ge 2
   
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   MPREDA                                                                          
   MPREDG                                                                          
   MPREDM                                                                          
        |---- MUCOMP                                                               
                   |----  NLINK                               External             
                   |----  ATAN2                               External             
                   |----  SQRT                                External             
                   |----  ACOS                                External             
                   |----  HFILL                               External             
                   |----  SIN                                 External             
                   |----  COS                                 External             
                   |----  FLOAT                               External             
   
 
3 MUCUTS
           SUBROUTINE MUCUTS(ITRAC,C0,C1,C2)
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Coeffic for muon assoc.dist.and scatt.angle.
   
       G.Capon                   9-Oct-87
   
          Input   : ITRAC = track #
          Output _ :  coefficients C0,C1,C2 used in routine MUTEST
                      to compute radial and angular acceptance cuts
                     (according to mult. scatt.) for muon hits.
                       C2 = <Theta-projected **2> at Hcal exit
   
      local variables :  RADL (IG)  =  Radiation length
            IG=1,2,3 for Ecal, Coil, Hcal average medium
   
   
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   MUASS                                                                           
        |---- MUCUTS                                                               
                   |----  VZERO                               External             
                   |----  NLINK                               External             
                   |----  SQRT                                External             
                   |----  LOG10                               External             
   
 
3 MUHIST
         SUBROUTINE MUHIST
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Fill muon histograms
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   RHSEVT                                                                          
        |---- MUHIST.                                                              
   
 
3 MUHITG
         SUBROUTINE MUHITG
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Provides from mhit bank all useful hit info (new db)
   
    P.Campana  170589
   
        Output_: Work bank index IWBANK :
   
          RW(2+IWBANK+1)= X-hit..........Aleph-system
          RW(2+IWBANK+2)= Y-hit..........Aleph-system
          RW(2+IWBANK+3)= Z-hit..........Aleph-system
          IW(2+IWBANK+4)= IE (=1 for Int chambers, =2 for Ext chambers)
          IW(2+IWBANK+5)= ISUBC
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   MUASS                                                                           
        |---- MUHITG                                                               
                   |----  WBANK                               External             
                   |----  SIN                                 External             
                   |----  COS                                 External             
                   |----  RERROR                                                   
   
 
3 MUHITS
         SUBROUTINE MUHITS
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Provides from mhit bank cartesian coordinates of hits
   
    G.Capon,M.Dreucci       28-May-87
       input : bank MHIT
        Output_: Work bank index IWBANK :
   
          RW(2+IWBANK+1)= X-hit..........Aleph-system
          RW(2+IWBANK+2)= Y-hit..........Aleph-system
          RW(2+IWBANK+3)= Z-hit..........Aleph-system
          IW(2+IWBANK+4)= IE (=1 for Int chambers, =2 for Ext chambers)
          IW(2+IWBANK+5)= ISUBC
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
              MUHITS                                                               
                   |----  WBANK                               External             
                   |----  SIN                                 External             
                   |----  COS                                 External             
                   |----  RERROR                                                   
   
 
3 MUKINE
         SUBROUTINE MUKINE (ICALL,IASS,ITRAC)
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Search kine bank associated to current tpc track
   
         G.Capon, M.Dreucci                                    28-May-87
   
        This routine looks for Galeph info on the track
        (particle type, if primary or secondary, if prompt
         muon was not associated)
   
    input : ICALL =1 (Hcal association), =2 (Mu chambers association)
            IASS  = 0/1 track is : not associated/associated
            ITRAC : track index in FRFT bank
    output : none (only debugging printout)
   
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   MUASS                                                                           
        |---- MUKINE                                                               
                   |----  NLINK                               External             
                   |----  NAMIND                              External             
                   |----  ABS                                 External             
                   |----  COS                                 External             
                   |----  SIN                                 External             
                   |----  SQRT                                External             
   
 
3 MUNEWR
         SUBROUTINE MUNEWR
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Initialises muon id part, for use outside of the julia context
       Should be called at the start of each run.
   
   
      Author   :- G.Taylor       15-May-1992
   
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
              MUNEWR                                                               
                   |----  RERROR                                                   
                   |----  ALFIEL                              External             
                   |----  JUNIDB                              External             
                   |----  ABRUEV                              External             
                   |----  NBANK                               External             
                   |----  HINIRU                                                   
                   |----  MGINIG                                                   
                   |----  MINIJO                                                   
   
 
3 MUREDO
         SUBROUTINE MUREDO(IER)
  ------------------------------------------------------------------------------
    CKEY MUONID MUON RERUN / INTERNAL
  ------------------------------------------------------------------------------
   Authors   :- g.taylor
   
      This routine can be called to rerun the muon identification part
      of JULIA outside the context of JULIA. Must call MUNEWR every time
      a new run is encountered.
   
              IER /I = Error flag
                     = 0 ok
                     = 2 bad run for hcal digital pattern
                     > 10  problem in hrhtub
                     > 100 problem in mrmhit
                     > 1000 problem in muido
   
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
              MUREDO                                                               
                   |----  ABRUEV                              External             
                   |----  HDODGY                              External             
                   |----  BDROP                               External             
                   |----  HRHTUB                              External             
                   |----  FTRACK                                                   
                   |----  HMFIND                                                   
                   |----  MPREDM                                                   
                   |----  MPREDG                                                   
                   |----  MRMHIT                              External             
                   |----  MUASS                                                    
                   |----  MUIDO                               External             
                   |----  BLIST                               External             
   
 
3 MUSLCM
             SUBROUTINE MUSLCM(IEL,SLTCO,IOK)
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Subroutine transforming from raw data to slot coordinate system
   
    P.Campana    890608
   
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   MPREDM                                                                          
        |---- MUSLCM                                                               
                   |----  MBLOBU                              External             
                   |----  MBPNT2                              External             
                   |----  MBNSXT                              External             
                   |----  BTOFFS                              External             
                   |----  FLOAT                               External             
                   |----  BPIT16                              External             
                   |----  MBNSY1                              External             
                   |----  BRTOOT                              External             
                   |----  BZTOOT                              External             
                   |----  BRBOXG                              External             
                   |----  BZBOXG                              External             
                   |----  MEPNTY                              External             
                   |----  MELOBU                              External             
                   |----  MENXST                              External             
                   |----  EXSTOF                              External             
                   |----  EXSTOC                              External             
                   |----  EPIT16                              External             
                   |----  MENYST                              External             
                   |----  EYSTOF                              External             
                   |----  EYSTOC                              External             
                   |----  MALOBU                              External             
                   |----  MADZFL                              External             
                   |----  MANXST                              External             
                   |----  MAPNTY                              External             
                   |----  AXOFFS                              External             
                   |----  MANYST                              External             
                   |----  AYLEOF                              External             
   
 
3 MUSLCO
             SUBROUTINE MUSLCO(IEL,SLTCO,IOK)
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Subroutine transforming from raw data to slot coordinate system
   
    P.Campana    890608
    P.Campana    910530 Corr. for 2 layer
   
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   MPREDG                                                                          
        |---- MUSLCO                                                               
                   |----  MBLOBU                              External             
                   |----  MBPNT2                              External             
                   |----  MBNSXT                              External             
                   |----  BTOFFS                              External             
                   |----  FLOAT                               External             
                   |----  BPIT16                              External             
                   |----  MBNSY1                              External             
                   |----  BRTOOT                              External             
                   |----  BZTOOT                              External             
                   |----  BRBOXG                              External             
                   |----  BZBOXG                              External             
                   |----  MEPNTY                              External             
                   |----  MELOBU                              External             
                   |----  MENXST                              External             
                   |----  EXSTOF                              External             
                   |----  EXSTOC                              External             
                   |----  EPIT16                              External             
                   |----  MENYST                              External             
                   |----  EYSTOF                              External             
                   |----  EYSTOC                              External             
                   |----  MALOBU                              External             
                   |----  MADZFL                              External             
                   |----  MANXST                              External             
                   |----  MAPNTY                              External             
                   |----  AXOFFS                              External             
                   |----  MANYST                              External             
                   |----  AYLEOF                              External             
   
 
3 MUTEST
         SUBROUTINE MUTEST (ITRAC,C0,C1,C2,IASS)
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Test mu-hits within mult. scatt. cuts
   
      G.Capon, M.Dreucci        28-May-87
     input banks : MHIT     output banks : MCAD
   
      Input _ :    ITRAC  =  Track no.
                C0,C1,C2  =  coefficients to compute radial cuts DCUT
                             and angular cut ACUT
       Output :    IASS   =  Flag : 0 = track not assoc.
                                    1 = track assoc.
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   MUASS                                                                           
        |---- MUTEST                                                               
                   |----  NLINK                               External             
                   |----  SQRT                                External             
                   |----  VZERO                               External             
                   |----  AUBOS                               External             
                   |----  RERROR                                                   
                   |----  HFILL                               External             
                   |----  PROB                                External             
                   |----  ABS                                 External             
                   |----  ACOS                                External             
                   |----  SIN                                 External             
   

2 O_

  >>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>
    CKEY 
     1st entry in O_set
     ! JULIA 313
        OCBPRE : Double precision fixes for Linux       (D.Smith)
    
     * corr file 305.01
        OBSPOT : Call xvdeok instead of VDETOK (Needs Alephlib>306) (M.Cattaneo)
    
     ! JULIA 304
        OLSPOT : Remove apostrophes from strings passed to RERROR (D.Casper)
    
     * corr file 284.01
        OLSPOD : Minor bug fix (O.Schneider, November 1996)
        OLSPOT : Minor bug fix (O.Schneider, November 1996)
    
     * corr file 283.01
        Replace specific intrinsic functions with generic intrinsic functions
        obspot.F,ocbpre.F,ogtblq.F,olspod.F,olspot.F,olspou.F
    
     ! JULIA 283
       Upgraded OLSPOT to perform the alignment of the BOMs on a
       run-by-run basis; OLSPOT now makes a beam spot fit (using all the tracks
       in the run) with respect to the BOM+QS0 estimate. A new routine 
       OBSPOT, which is a modified copy of VBSPOT, is called by OLSPOT to do 
       that job. (O.Schneider, September 1996)
         olspot.F updated
         olspou.F updated
         olspod.F updated
         obsinr.F new: modified copy of vbsinr.F
         obspot.F new: modified copy of vbspot.F
         obsclr.F new: modified copy of vbsclr.F
         obmfit.F new: modified copy of vbmfit.F
         ocbfit.F new: modified copy of vcbfit.F
         obscom.h new: modified copy of vbscom.h
         ocbpre.F new: called in ocbfit.F to compute new track parameters
         ogtblq.F new: called in ocbpre.F to get unaligned BOM+QS0 position
    
     ! JULIA 282
       OLSPOD, OLSPOT, OLSPOU : New routines to get beam spot from LEP boms
                                (O.Schneider, June 1996)
    
     ! corr file 281.1
       OMCORR : Allow beam energy greater than 50 GeV (O.Schneider)
       OSLOWC : Input data comes from banks LXCR,LXSP for LEP 2 (O.Schneider)
       OINIRU : Call OSLOWC also for run header banks (O.Schneider)
    
     ! JULIA 273
       OMREAD - allow for 1-8 bunches instead of 1-4 (R.Forty).
    
  <<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<
     OBMFIT     Beamspot position fit
     OBSCLR     End of run beam spot position computation, close bank
     OBSINR     Initialise beam spot position computation for the run
     OBSPOT     Measure the beamspot using the lep boms
     OCBFIT     Close form beamspot fit
     OCBPRE     Modified : d.smith 991027 double precision fixes for linux
     OGTBLQ     Get the bom+qs0 beam position stored in blqp bank
     OINIJO     Bom : job initialisation
     OINIRU     Initialisation for bom analysis
     OLSPOD     Get data to put in a row of bank blqp
     OLSPOT     Create run header bank blqp and
     OLSPOU     Store data in bank blqp
     OMBOOK     Bom : book histograms
     OMBOPT     Calculate optics matrices
     OMBOUT     Output results of bom analysis
     OMBPOS     Calculate beam position and current at bom pickup
     OMBREC     Calculate beam parameters using bom data
     OMCORR     Calculate bom corrector magnet deflections
     OMCRUN     Bom : close run
     OMDATA     Fill common from data base for bom analysis
     OMGAIN     Update relative gains for each bom electrode pair
     OMHIST     Bom : histogram event
     OMIPOS     Calculate beam position and angle at the ip using the bom position
     OMREAD     Read bom data from banks
     OPRSUM     Bom : summarize the runs that have been processed
     OSLOWC     Read bom slow control record

3 OBMFIT
         SUBROUTINE OBMFIT (NEWROW)
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
      ==========================
      modified version of VBMFIT, O.Schneider, Sept 1996
   Beamspot position fit
   
      Author   :- D. Brwon                   8-APR-1993
     First written by G. Redlinger
   
      Bug fix: Steve Wasserbaech, April 1995
      Use existing first-event-in-chunk number when NEWROW = .FALSE.
      Modified: SW, 18 October 1995
      Switch to VBPC; introduce track deweighting in first iteration;
      protect against failure in VCBFIT.
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   OBSCLR                                                                          
   OBSPOT                                                                          
        |---- OBMFIT                                                               
                   |----  NAMIND                              External             
                   |----  OCBFIT                                                   
                   |----  WBANK                               External             
                   |----  NINT                                External             
                   |----  RERROR                                                   
   
 
3 OBSCLR
         SUBROUTINE OBSCLR
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
      ==========================
      modified version of VBSCLR, O.Schneider, Sept 1996
   End of run beam spot position computation, close bank
   
      Author   :- E. Lancon             29-APR-1993
   
      Bux fix: Steve Wasserbaech, April 1995
      Do not create a new row if the first row is not yet filled
      Modified: SW, 18 October 1995
      Switch to VBPC; introduce VBSP card.
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   OLSPOT                                                                          
        |---- OBSCLR                                                               
                   |----  NAMIND                              External             
                   |----  OBMFIT                                                   
   
 
3 OBSINR
         SUBROUTINE OBSINR
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
      ==========================
      modified version of VBSINR, O.Schneider, Sept 1996
   Initialise beam spot position computation for the run
   
      Author   :- E. Lancon             29-APR-1993
      Modified :- E. Lancon             24-JUN-1994
           Create working bank only once
      Modified: Steve Wasserbaech, April 1995
      Always clear the work banks (number of rows = 0)
      Get ALLR from daf
      Modified: SW, 18 October 1995
      Switch to ALRP and VBPC; introduce VBSP card.
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
              OBSINR                                                               
                   |----  NAMIND                              External             
                   |----  WBANK                               External             
                   |----  INTCHA                              External             
                   |----  JUNIDB                              External             
                   |----  MDARD                               External             
                   |----  ALLEP1                              External             
                   |----  GTSTUP                              External             
                   |----  WDROP                               External             
                   |----  RERROR                                                   
   
 
3 OBSPOT
         SUBROUTINE OBSPOT
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
      ==========================
      modified version of VBSPOT, O.Schneider, Sept 1996
   Measure the beamspot using the lep boms
   
      Author   :- Dave Brown, George Redlinger           8-APR-1993
   
      Modified :- Steve Wasserbaech
          Nov 1994: Avoid taus to measure the beam spot
          Apr 1995: Use ABS on d0 and z0 cuts; remove call to VDAMB
      Modified: SW, 18 October 1995
      Fix an unbelievable ancient bug in inline function NW;
      switch to VBPC; introduce VBSP card; allow FRFT 0 if no VDET
      hits are required; allow tautau rejection and VDET hit
      definition to be switchable with VBPC; add some features
      to facilitate use in Alpha.
   
      Modified :- M.Cattaneo 97/12/05
         Call xvdeok instead of VDETOK
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   OLSPOT                                                                          
        |---- OBSPOT                                                               
                   |----  MIN                                 External             
                   |----  IAND                                External             
                   |----  ISHFT                               External             
                   |----  NAMIND                              External             
                   |----  XVDEOK                              External             
                   |----  NLINK                               External             
                   |----  VDHITS                              External             
                   |----  COS                                 External             
                   |----  SIN                                 External             
                   |----  ABS                                 External             
                   |----  ALFIEL                              External             
                   |----  SQRT                                External             
                   |----  WBANK                               External             
                   |----  ISIGN                               External             
                   |----  OBMFIT                                                   
                   |----  RERROR                                                   
   
 
3 OCBFIT
         SUBROUTINE OCBFIT (BP, BPVEC, BPERR)
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Close form beamspot fit
   
   
      Inputs:
           - BP(2)           R   Input Beam Position
   
      Outputs:
           - BPVEC(2)        R   Output Beam Position
           _ BPERR(2)        R   Output Beam Position Error
   
      Author   :- D. Brown               8-APR-1993
   
      Modified: Steve Wasserbaech, April 1995
      Take beam size from ALLR instead of data statement
      Modified: Pere Comas, July 1995
      Protect RSINV against an error return
      Modified: SW, 18 October 1995
      Take beam size from VBSCOM; allow customized chunks; return
      zeros in case of failure.
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   OBMFIT                                                                          
        |---- OCBFIT                                                               
                   |----  VZERO                               External             
                   |----  MOD                                 External             
                   |----  OCBPRE                                                   
                   |----  AMAX1                               External             
                   |----  SIN                                 External             
                   |----  COS                                 External             
                   |----  RSINV                               External             
                   |----  SQRT                                External             
                   |----  MAX                                 External             
   
 
3 OCBPRE
   
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
         SUBROUTINE OCBPRE(IEVT,PAR,ERR)
       Olivier Schneider, CERN-PPE/ALE, Aug 19, 1996
   Modified : d.smith 991027 double precision fixes for linux
       Modify transverse parameters of a track in event IEVT
       to refer to a new origin defined as the BOM+QS0 beam spot position.
   
       Input:   IEVT = event number
       ------   PAR  = vector of track parameters in transverse plane
                             PAR(1) = PAR(JIR) = 1 / curvature
                             PAR(2) = PAR(JP0) = phi_0
                             PAR(3) = PAR(JD0) = d_0
                ERR  = error matrix on PAR;
                       triangular matrix stored in the following order:
                                                 1
                                                 2 3
                                                 4 5 6
                       i.e.  ERR(1) = cov(JIR,JIR)
                             ERR(2) = cov(JIR,JP0)
                             ERR(3) = cov(JP0,JP0)
                             ERR(4) = cov(JIR,JD0)
                             ERR(5) = cov(JP0,JD0)
                             ERR(6) = cov(JD0,JD0)
   
       Output:  IEVT     = 0 if an error occurred (<0 otherwise)
       -------  PAR(JP0) = value    of phi_0  with respect to new origin
                PAR(JD0) = value    of d_0    with respect to new origin
                ERR(6)   = variance of d_0    with respect to new origin
   
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   OCBFIT                                                                          
        |---- OCBPRE                                                               
                   |----  DBLE                                External             
                   |----  MAX0                                External             
                   |----  MIN0                                External             
                   |----  OGTBLQ                                                   
                   |----  RERROR                                                   
                   |----  DSIN                                External             
                   |----  DCOS                                External             
                   |----  DSQRT                               External             
                   |----  ISIGN                               External             
                   |----  SNGL                                External             
   
 
3 OGTBLQ
   
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
         INTEGER FUNCTION OGTBLQ(IRUN,IEVT,BLQPOS,BLQERR)
   
       Olivier Schneider, CERN-PPE/ALE, Aug 22, 1996
   Get the bom+qs0 beam position stored in blqp bank
       for run IRUN and event IEVENT.
   
       Input:   IRUN = run number
       ------   IEVT = event number
   
       Output:  BLQPOS(1) = x coordinate of beam position (cm)
       -------  BLQPOS(1) = y coordinate of beam position (cm)
                BLQERR(1) = error on BLQPOS(1)
                BLQERR(2) = error on BLQPOS(2)
   
       Function value: error code with the following meaning:
       ---------------   0 means OK
                         1 means "unaligned" data is returned
                         2 means "unaligned" data without QS0 correction
                        -1 means bad input arguments
                        -2 means missing BLQP bank for run IRUN
                        -3 means no valid data for event IEVT in BLQP bank
   
                      N.B: a negative fuction value indicates a fatal
                           error; in that case the components of BLQPOS
                           are set to 0. and those of BLQERR to -1.)
   
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   OCBPRE                                                                          
        |---- OGTBLQ                                                               
                   |----  NLINK                               External             
                   |----  UZERO                               External             
   
 
3 OINIJO
         SUBROUTINE OINIJO
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Bom : job initialisation
   
      Author   :- E. Lancon             12-AUG-1991
   
         Set Init. Flags to .FALSE.
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   RINJOB                                                                          
        |---- OINIJO.                                                              
   
 
3 OINIRU
         SUBROUTINE OINIRU
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Initialisation for bom analysis
   
      Author:  R.W.Forty  23-May-91
   
    June 17, 1996: O. Schneider: call routine OSLOWC to look in the run
                                 header for banks that are normally found
                                 in slow control records.
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   OMBREC                                                                          
   RINRUN                                                                          
        |---- OINIRU                                                               
                   |----  NAMIND                              External             
                   |----  OMDATA                                                   
                   |----  OMBOPT                                                   
                   |----  OSLOWCRETURN                        External             
   
 
3 OLSPOD
         SUBROUTINE OLSPOD(ISTAT,BOM,QS0,CBITS,CUTS,DEBUG,LUNIT)
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Get data to put in a row of bank blqp
   
      Output arguments: ISTAT = integer status flags
                        BOM   = array for LEP BOM data
                        QS0   = array for QS0 data
   
      Input  arguments: CBITS = control bits
                                   bits 00-15 for LEP BOM data
                                   bits 16-31 for QS0 data
                        CUTS  = array of real numbers (cuts)
                        DEBUG = logical (.TRUE. means debugging "ON")
                        LUNIT = unit for debug printout
   
      Author:  O. Schneider
   
      History: 07-JUN-1996 first version for private tests
               20-JUN-1996 incorporated in test version of JULIA
               19-JUL-1996 incorporated in JULIA 282
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   OLSPOU                                                                          
        |---- OLSPOD                                                               
                   |----  NAMIND                              External             
                   |----  UZERO                               External             
                   |----  IBITS                               External             
                   |----  RERROR                                                   
                   |----  MOD                                 External             
                   |----  MIN0                                External             
                   |----  MAX0                                External             
                   |----  BTEST                               External             
                   |----  IBSET                               External             
                   |----  ISTATFORMAT                         External             
                   |----  QS0FORMAT                           External             
   
 
3 OLSPOT
         SUBROUTINE OLSPOT(IFLAG)
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Create run header bank blqp and
       store beam spot positions from LEP BOM data
       and QS0 position measurements in bank BLQP
   
      Input argument:  IFLAG= 0 for event and slow control record processing
      --------------   IFLAG= 1 for end of run processing
                       IFLAG= 2 for end of job processing
   
      Notes:  1. This routine should not be called at run initialization by
                 JULIA or ALPHA. It will detect itself a change of run number
                 when processing a call with IFLAG=0. This is because slow
                 control records can appear between run records and the first
                 event record in a run. Since the run initialization (in JULIA
                 and ALPHA) is performed only when the first event record is
                 encountered one would miss any such slow control records ...
   
              2. The end_of_run call with IFLAG=1 should be done from
                 routine ABOLDR and at the end of the job.
   
              3. The behaviour of this routine can be changed with card OLSP:
                   OLSP -1     ---> routine OLSPOT becomes a dummy routine
                   OLSP +1     ---> routine OLSPOT write a lot of debug output
                   OLSP +1 34  ---> routine OLSPOT write a lot of debug output
                                     on logical unit 34
   
              4. The cuts and control flags are taken from bank BLQC;
                 this bank is read from the database, unless card BLQC -1/
                 is provided; if no BLQC bank is found, a default BLQC bank
                 is created.
   
      Author:  O. Schneider
   
      History: 07-JUN-1996 first version for private tests
               20-JUN-1996 incorporated in test version of JULIA after
                            adding call to AUBPRS;
               19-JUL-1996 incorporated in JULIA 282 after fixing bug
                            when counting good mini-chunks;
               22-AUG-1996 modified to run OBSPOT and save the BOM "alignement"
                            in first row of BLQP; allow DUMRUN to become
                            .FALSE. after is was set to .TRUE. (needed
                            to run the code in ALPHA when there is a
                            special record before the run  record, leading
                            to DUMRUN=.TRUE. because the run number is zero)
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   RCLRUN                                                                          
   RECONS                                                                          
   RSMJOB                                                                          
   RUNKNO                                                                          
        |---- OLSPOT                                                               
                   |----  NAMIND                              External             
                   |----  WBANK                               External             
                   |----  INTCHA                              External             
                   |----  RERROR                                                   
                   |----  BDROP                               External             
                   |----  AUBOS                               External             
                   |----  ALSECS                              External             
                   |----  OBSINRCONTINUE                      External             
                   |----  OBSPOT                                                   
                   |----  MOD                                 External             
                   |----  CHAINT                              External             
                   |----  MAX0                                External             
                   |----  OLSPOU                                                   
                   |----  NINT                                External             
                   |----  FLOAT                               External             
                   |----  NPRNT                               External             
                   |----  AUBPRS                              External             
                   |----  OBSCLR                                                   
                   |----  WDROP                               External             
                   |----  IOR                                 External             
                   |----  IAND                                External             
                   |----  UZERO                               External             
                   |----  CALLRERROR                          External             
   
 
3 OLSPOU
         SUBROUTINE OLSPOU(KBLQP,KWORK,LLXIP,LBOMQ,SECS,DEBUG,LUNIT)
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Store data in bank blqp
   
      Input arguments:  KBLQP = index of BLQP bank
                        KWORK = index of work bank
                        LLXIP = .TRUE. if LXIP data can be used
                        LBOMQ = .TRUE. if BOMQ data can be used
                        SECS  = integer time of current slow control record
                        DEBUG = logical (.TRUE. means debugging "ON")
                        LUNIT = unit for debug printout
   
      Author:  O. Schneider
   
      History: 07-JUN-1996 first version for private tests
               20-JUN-1996 incorporated in test version of JULIA
               19-JUL-1996 incorporated in JULIA 282 after fixing a bug
                            (an empty line was not necessarily added if
                             no row existed yet in BLQP)
               22-AUG-1996 modified to run OBSPOT and save teh QS0 correction
                            factors in first row of BLQP; error message
                            'Database bank BLQC not found' temporarily disabled
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   OLSPOT                                                                          
        |---- OLSPOU                                                               
                   |----  NAMIND                              External             
                   |----  AGETDB                              External             
                   |----  BDROP                               External             
                   |----  AUBOS                               External             
                   |----  RERROR                                                   
                   |----  IABS                                External             
                   |----  IAND                                External             
                   |----  OLSPOD                                                   
   
 
3 OMBOOK
         SUBROUTINE OMBOOK
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Bom : book histograms
   
      Author   :- E. Lancon             12-AUG-1991
   
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   RBKHIS                                                                          
        |---- OMBOOK.                                                              
   
 
3 OMBOPT
         SUBROUTINE OMBOPT
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Calculate optics matrices
   
      Author:  R.W.Forty  23-May-91
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   OINIRU                                                                          
        |---- OMBOPT                                                               
                   |----  UCOPY                               External             
                   |----  RINV                                External             
                   |----  RMMLT                               External             
   
 
3 OMBOUT
         SUBROUTINE OMBOUT (XIPB, IBUNB, BCURB, GRATB, IER)
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Output results of bom analysis
   
      Author:  R.W.Forty  23-May-91
      Modified by : J. Nash 8-May-91 Changed IW to RW in appropriate plac
      Input:  XIPB  = Array containing the positions and angles at the IP
                      (x, x', y, y') for each beam
              IBUNB = Bunch id for each beam
              BCURB = Beam current at each BOM for each beam
              GRATB = Gain ratio of each pair of electrodes for each beam
              IER   = 0  OK
                    < 0  Fatal error in BOM analysis
                    > 0  Non-fatal data quality error flag
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   OMBREC                                                                          
        |---- OMBOUT                                                               
                   |----  AUBOS                               External             
   
 
3 OMBPOS
         SUBROUTINE OMBPOS (DAT, PEDS, GAIN, XYBOM, BCUR, IRET)
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Calculate beam position and current at bom pickup
   
      Author:  R.W.Forty  23-May-91
   
      Input:  DAT   = Raw data for each electrode
              PEDS  = Pedestals for each electrode
              GAIN  = Relative gain for electrode pairs
      Output: XYBOM = 4-component vector containing the positions
                      at the BOM pickups: (xA, xB, yA, yB)
              BCUR  = Beam current at each BOM (in ADC counts)
              IRET  = 0  OK
                   >< 0  Error
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   OMBREC                                                                          
        |---- OMBPOS                                                               
                   |----  MOD                                 External             
                   |----  ABS                                 External             
   
 
3 OMBREC
         SUBROUTINE OMBREC
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Calculate beam parameters using bom data
   
      Author:  R.W.Forty  23-May-91
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   RECEVT                                                                          
        |---- OMBREC                                                               
                   |----  OINIRU                                                   
                   |----  OMCORR                                                   
                   |----  OMREAD                                                   
                   |----  OMGAIN                                                   
                   |----  OMBPOS                                                   
                   |----  OMIPOS                                                   
                   |----  XIP                                 External             
                   |----  GRAT                                External             
                   |----  BCUR                                External             
                   |----  OMBOUT                                                   
   
 
3 OMCORR
         SUBROUTINE OMCORR
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Calculate bom corrector magnet deflections
   
      Author:  R.W.Forty  16-Oct-91
    7, 1996: O. Schneider: Increase LEP beam energy upper limit from
                               50 GeV to 110 GeV
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   OMBREC                                                                          
        |---- OMCORR                                                               
                   |----  NAMIND                              External             
                   |----  RERROR                                                   
                   |----  ALELEP                              External             
                   |----  IADCOR                              External             
                   |----  CURCOR                              External             
                   |----  CALCOR                              External             
                   |----  INT                                 External             
   
 
3 OMCRUN
         SUBROUTINE OMCRUN
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Bom : close run
   
      Author   :- E. Lancon             12-AUG-1991
   
         Set Init. Flags to .FALSE.
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   RCLRUN                                                                          
        |---- OMCRUN.                                                              
   
 
3 OMDATA
         SUBROUTINE OMDATA
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Fill common from data base for bom analysis
   
      Author:  R.W.Forty  23-May-91
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   OINIRU                                                                          
        |---- OMDATA                                                               
                   |----  NAMIND                              External             
                   |----  AGETDB                              External             
   
 
3 OMGAIN
         SUBROUTINE OMGAIN (IDPA, DAT, PEDS, CALI, GAIN, GRAT, IRET)
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Update relative gains for each bom electrode pair
   
      Author:  R.W.Forty  23-May-91
   
      Input:  DAT   = Raw signals for each electrode
              PEDS  = Pedestals for each electrode
              CALI  = Calibration signal for each electrode
              IDPA  = 1  e+
                      2  e-
      Output: GAIN  = Relative gain for the 4 electrode pairs
              GRAT  = Gain ratio from calibration pulses for each
                      electrode pair
              IRET  = 0  OK
                   >< 0  Error
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   OMBREC                                                                          
        |---- OMGAIN                                                               
                   |----  ABS                                 External             
                   |----  GAINA0                              External             
   
 
3 OMHIST
         SUBROUTINE OMHIST
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Bom : histogram event
   
      Author   :- E. Lancon             12-AUG-1991
   
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   RHSEVT                                                                          
        |---- OMHIST.                                                              
   
 
3 OMIPOS
         SUBROUTINE OMIPOS (IDPA, XYBOM, XIP, IRET)
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Calculate beam position and angle at the ip using the bom position
   
      Author:  R.W.Forty  23-May-91
               based on code from W.Kozanecki
   
      Input:  XYBOM = 4-component vector of x and y positions
                      read by BOMs: (xA, xB, yA, yB)
              IDPA  = 1  e+
                      2  e-
      Output: XIP   = 4-component vector containing the positions
                      and angles at the IP: (x, x', y, y')
              IRET  = 0  OK
                   >< 0  Error
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   OMBREC                                                                          
        |---- OMIPOS                                                               
                   |----  VZERO                               External             
                   |----  DEFCOR                              External             
                   |----  IXYCOR                              External             
                   |----  RMMLT                               External             
                   |----  AMCIOP                              External             
                   |----  RCBOPT                              External             
                   |----  UCOPY                               External             
                   |----  ZMOPTI                              External             
                   |----  REQN                                External             
   
 
3 OMREAD
         SUBROUTINE OMREAD (IDPA, IDBU, DAT, SIG, PEDS, CALI, IRET)
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Read bom data from banks
   
      Author:  R.W.Forty  23-May-91
      Modified by : J. Nash 8-2-91  Fixed e- and e+ (e- is first in BOMR)
      Input:  IDPA  = 1  e+
                      2  e-
      Output: IDBU  = Bunch id (1-8)
              DAT   = Raw signals for each electrode
              SIG   = Sigma (rms) of raw data measurement
              PEDS  = Pedestals for each electrode
              CALI  = Calibration signal for each electrode
              IRET  = 0  OK
                   >< 0  Error
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   OMBREC                                                                          
        |---- OMREAD                                                               
                   |----  NAMIND                              External             
                   |----  FLOAT                               External             
   
 
3 OPRSUM
         SUBROUTINE OPRSUM
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Bom : summarize the runs that have been processed
   
      Author   :- E. Lancon             12-AUG-1991
   
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   RSMJOB                                                                          
        |---- OPRSUM.                                                              
   
 
3 OSLOWC
         SUBROUTINE OSLOWC
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Read bom slow control record
   
      Author:  R.W.Forty  16-Oct-91
    14, 1996: O. Schneider: Since 1996, the BOMC bank is not produced
                                anymore !! Instead the LEP information is
                                stored in the LXCR and LXSP banks.
                                This routine modified to also take the
                                data from LXCR and LXSP banks.
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   RUNKNO                                                                          
        |---- OSLOWC                                                               
                   |----  NAMIND                              External             
                   |----  FLOAT                               External             
                   |----  ALSTIN                              External             
   

2 P_

  >>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>
    CKEY 
     1st entry in P_set
     ! JULIA 280
       PRYFIT : cosmetic changes to move to cvs (F. Ranjard, Feb 96)
  <<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<
     PMSKFI     Books & fills pmsk bank
     PROLOT     Longitudinal profile of an e.m. shower induced by electron
     PRYFIT     Print out contents of vertex fit banks
     PVFILL     To create weighted p-vectors for energy-flow calculation

3 PMSKFI
         SUBROUTINE PMSKFI
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Books & fills pmsk bank
   -
   -    Authors : M.N. Minard , M. Pepe       26/02/89
   -
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   ECST                                                                            
        |---- PMSKFI                                                               
                   |----  NAMIND                              External             
                   |----  RERROR                                                   
                   |----  AUBOS                               External             
                   |----  BLIST                               External             
                   |----  SIN                                 External             
                   |----  COS                                 External             
                   |----  UCOPY                               External             
                   |----  SQRT                                External             
                   |----  ATAN2                               External             
   
 
3 PROLOT
         FUNCTION PROLOT(T,ALPHA,BETA,B)
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Longitudinal profile of an e.m. shower induced by electron
   
     AUTHOR : A. FALVARD
     MODIFIED:
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   E4OVRL                                                                          
   ECPRLO                                                                          
        |---- PROLOT                                                               
                   |----  GAMMA                               External             
   
 
3 PRYFIT
         SUBROUTINE PRYFIT
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Print out contents of vertex fit banks
       Author: M. Mermikides 9 Sept 1987
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
              PRYFIT.                                                              
   
 
3 PVFILL
         SUBROUTINE PVFILL ( IFIT , PVEC , WEIGHT , IRANG, ISTOP )
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   To create weighted p-vectors for energy-flow calculation
   -
   -   Authors : M.N. Minard , M. Pepe       10/05/89
   -   INPUT : IFIT    type of fit
   -           PVEC    unweighted P-vector
   -           WEIGHT  weighting coefficient
   -   OUTPUT: IRANG   cell range in lujets common
   -           ISTOP   =1 JETSET array too small
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   EFOLMK                                                                          
        |---- PVFILL.                                                              
   

2 Q_

  >>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>
    CKEY 
     1st entry in Q_set
  <<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<
     QFMMCL     Evaluate jet multiplicities based on the scaled invariant mass
     QGMMCL     Evaluate jet multiplicities based on the scaled invariant mass

3 QFMMCL
         SUBROUTINE QFMMCL( YCUT, EVIST, MASMAT, PP, LENM , KTBI
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
        & ,QTBIX,QTBIY,QTBIZ,QTBIE,KTBIT
        & ,KTBOF,KTBO,QTBOX,QTBOY,QTBOZ,QTBOE,QTBOR,KTBIMX,KTBOMX)
   Evaluate jet multiplicities based on the scaled invariant mass
      squared algorithm using BOS work bank
      from momentum vectors stored in QCTBUF.INC
     New      : C. Bowdery      9-OCT-1990  Faster algortihm than QGMMCL
     Modified : M.N Minard     20-Feb-1990
     Description
     ===========
    input   : YCUT            ycut value ( (M/EVIST)**2 )
              EVIST           visible energy
                              (if EVIST=0., it is computed from the
                               input particle energies)
              MASMAT          (empty) invariant mass**2 square matrix
              PP              (empty) matrix for temporary particle usag
              LENM            dimension of MASMAT and PP matrices
              KTBI            # of particles           (from QCTBUF)
              QTBIX,Y,Z,E(i)  four momentum (i=1,KTBI) ( "     "   )
    output  :
              QTBOX,Y,Z,E(j)  four  momentum of jet j (j=1,NJET)
              KTBOF(i)        jet # of particle i     (i=1,KTBI)
              KTBO        -1  input  error (KTBI/EVIST) (in   QCTBUF)
                          -2  error from individ. track
                          -3  too many jets
                         NJET # of jets (normal return)
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   AJMMCL                                                                          
        |---- QFMMCL                                                               
                   |----  SQRT                                External             
                   |----  JIF                                 External             
   
 
3 QGMMCL
         SUBROUTINE QGMMCL(YCUT,EVIST,KTBI,QTBIX,QTBIY,QTBIZ,QTBIE,KTBIT
  ------------------------------------------------------------------------------
    CKEY JETS /INTERNAL
  ------------------------------------------------------------------------------
        & ,KTBOF,KTBO,QTBOX,QTBOY,QTBOZ,QTBOE,QTBOR,KTBIMX,KTBOMX,PP)
   Evaluate jet multiplicities based on the scaled invariant mass
      squared algorithm
      from momentum vectors stored iN QCTBUF.INC
     Author   : P. Perez       28-MAR-1989
     Modified : C. Bowdery      4-DEC-1990   Prevent infinite loops
                M.N Minard     20-FEB-1990
     Description
     ===========
    input   : YCUT            ycut value ( (M/EVIST)**2 )
              EVIST           visible energy
                              (if EVIST=0., it is computed from the
                               input particle energies)
              KTBI            # of particles           (from QCTBUF)
              QTBIX,Y,Z,E(i)  four momentum (i=1,KTBI) ( "     "   )
    output  :
              QTBOX,Y,Z,E(j)  four  momentum of jet j (j=1,NJET)
              KTBOF(i)        jet # of particle i     (i=1,KTBI)
              KTBO        -1  input  error (KTBI/EVIST) (in   QCTBUF)
                          -2  error from individ. track
                          -3  too many jets
                         NJET # of jets (normal return)
       KTBI : Number of input vectors (max : KTBIMX).
       QTBIX/Y/Z/E : Input vectors (filled contiguously without unused v
                     The vectors 1 to KTBI must NOT be modified.
       KTBIT : Input vector ident. used for bookkeeping in the calling r
       KTBO  : Number of output vectors (max : KBTOMX).
       QTBOX/Y/Z/E : Output vector(s).
       QTBOR : Scalar output result(s).
       KTBOF : If several output vectors are calculated and every input
               associated to exactly one of them : Output vector number
               the input vector is associated to. Otherwise : Dont't car
    a severe error condition is detected : Set KTBO to a non-positive
    may serve as error flag. Set QTBOR to a non-physical value (or
    zeros into the appropriate number of output vectors. Do not writ
   
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   AJMMCL                                                                          
        |---- QGMMCL                                                               
                   |----  SQRT                                External             
                   |----  ABS                                 External             
                   |----  SIGN                                External             
   

2 R_

  >>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>
    CKEY 
     1st entry in R_set
     ! JULIA 312
        RINCND : Remove initialisation of ENERRC LEP energy            (M.Cattaneo)
        RINRUN : Use GETLEP to initialise ENERRC and RENLEP LEP energy (M.Cattaneo)
    
     ! JULIA 311
        RCJSUM : y2k fix to JSUM date                  (M.Cattaneo)
        RCPAS0 : Fix IDAT and format statement for y2k (M.Cattaneo)
        RINJOB : STOP if DB<300 or Alephlib<314        (F.Ranjard)
        RINCND : Fix format statement for y2k          (F.Ranjard) 
    
     ! JULIA 310
        RMONIT : Increase max PMOM to 150 GeV           (M.Cattaneo)
    
     * corr file 309.1
        RFJCON : Use clock frequency in Hz from TSOR bank (exists from run 49394)
                                                                (W.Wiedenmann)
    
     ! JULIA 309
        RDEFIO : Add banks KWGT,SIID,BLUM to POT                (M.Cattaneo)
        RFORMA : Define SIID format                             (B.Bloch)
        RPOTCL : Drop BLUM from POT for all but random triggers (M.Cattaneo)
    
     * corr file 308.6
        RECEVT : Remove TPC hit smearing (A.Bonissent)
    
     * corr file 308.3
        RDEFIO : New bank BCPO to POT, remove BLCT (can be made from BCPO)
                                                          (M.Cattaneo,P.Morawitz)
        RECEVT : Replace call to BCAREC (obsolete) with call to BCALJU (M.Cattaneo)
    
     * corr file 308.1
        RECEVT : Bug fix: VDYEAR was declared as LOGICAL (A.Waananen)
    
     ! JULIA 308
        RLOOPR : Modify format statement (M.Cattaneo)
    
     * corr file 307.4
        RLOOPR : Print also the processing time of the previous event (M.Cattaneo)
    
     * corr file 307.3
        RECEVT : Change defaults for VGLOB. If VDYEAR < 95, VGLOB is
                 default, otherwise not. Steering card VGLO forces VGLOB on
                 NVGL forces VGLOB off                             (M.Cattaneo)
    
     * corr file 306.3
        RDEFIO : New bank BCHG to POT     (M.Cattaneo)
    
     * corr file 306.2
        RDEFIO : Banks FSHO, KMAR, KWTK to POT (M.Cattaneo)
    
     ! JULIA 306
        RECEVT : Move TPC hit smearing to after track fit and
                 refit tracks with smeared hits (MonteCarlo only)  (A.Bonissent)
    
     * corr file 305.2
        RECEVT : Add TPC hit smearing (M.Thulasidas)
    
     * corr file 305.1
        RLOOPR : Fix format statement when event length > 1Mbyte (M.Cattaneo)
        RREVHE : Use xlumok from Alephlib (version>306)          (B.Bloch)
    
     ! JULIA 305
        RDEFIO : New bank BLCT to POT     (M.Cattaneo)
        RECEVT : Call BCAL reconstruction (M.Cattaneo)
                 Create track hit bit patters for secondary vtx. search (D.Casper)
        RLOOPR,RPRSUM,RREVEH,RUNKNO,RWREVT: fix variable type 
                 inconsistencies in function calls, for Linux         (A.Waananen)
                   
     * corr file 304.1
        RTLSUM,RWRUNH:Remove CALL from function references, for Linux. (A.Waananen)
    
     ! JULIA 304
        RDEFIO : Add YSMO to POT                      (D.Casper)
        RFORMA : Add YSMO, correct YKNK,YSVT formats  (D.Casper)
    
     * corr file 303.5
        RINCND : Protect against zero magnetic field: Set FIELRC to 0.0001
                 if ALFIEL returns 0., produce a "fatal" error        (M.Cattaneo)
    
     * corr file 303.2
        RECEVT : Bug fix - RDMIN was called with SEED=0. every time!  (M.Cattaneo)
     
     * corr file 303.1
        RECEVT : Add call to RDMIN to initialise RANNOR (and RNDM) random
                 numbers once per event.                              (F.Ranjard)
    
     ! JULIA 303
        RCPAS0, RIPAS0 : If PVGG card present, PASS0 drift velocity is taken
                 from VDET/gamma-gamma for all runs taken with new VDET 
                 (and not just LEP2 runs)                              (I.Tomalin)
        RDEFIO : Add new banks BCSC,BCSL,BCTR to output list          (M.Cattaneo)
        RDETEC : In PASS0 mode, force YNSV,YNLV,YNKF,TNPX,ENKF,VNSL   (M.Cattaneo)
                 In PASS0 mode, switch on use of TPC wires by default (I.Tomalin) 
        RECEVT : Call VDET global pattern recognition if VGLO card found (D.Casper)
                 Moved call to TSUMVD from RECONS to RECEVT           (I.Tomalin)
        RECONS : Moved call to TSUMVD from RECONS to RECEVT           (I.Tomalin)
    
    
     * corr file 302.5
        RVDPRE : Protect against garbage collection in called routines (F.Ranjard)
    
     * corr file 302.2
        RDEFIO : Add KXME (Kingal output) to POT      (B.Bloch)
        RFORMA : Add KXME format                      (M.Cattaneo)
    
     * corr file 302.1
        RDEFIO : Add LCRA (LCAL scintillator raw data) to POT      (M.Cattaneo)
        RFORMA : Add LCRA, VDTD formats                            (M.Cattaneo)
    
     ! JULIA 302 (Tracking upgrade)
        RDEFIO : Tracking upgrade banks added to output list       (D.Casper)
        RECEVT : Call new modules VTRPRE, KINKS, NUCVTX (M.Cattaneo,D.Casper)
        RFORMA : Add PFXT,TRIK,TWZA,TWZZ,VGHC,VGXC,YKNK,YLV0,YNLI,
                 YNVH,YS0L,YSTL,YSTC,YSTV,YSVT,YSVX,YSCL formats   (D.Casper)
        RVDPRE : New. Steer VDET track preselection                (M.Cattaneo)
        RPARAC.H Added modules VTRPRE, KINKS, NUCVTX               (M.Cattaneo)
        
     * corr file 285.1
        RDEFIO : Add PHMH to output list (P.Bright-Thomas 4/3/97)
                     
     ! JULIA 285
        RFORMA : Add VSPL bank (A.Bonissent, Dec96)
    
     * corr file 284.1
        RCPAS0 : ALLEP1 declared as logical, not integer (A.Waanenen 16/10/96)
        RIPAS0 : ALLEP1 declared as logical, not integer (A.Waanenen 16/10/96)
    
     ! JULIA 284
        RIPAS0 : Detects if PVGG card is being used. (I.Tomalin 9/10/96)
        RCPAS0 : Fill's PASS0 banks with drift velocity from VDET + 
                 gamma-gamma events if requested by PVGG card.(I.Tomalin 9/10/96)
    
     * corr file 283.1
       REPORT : Change message for non-fatal errors (M.Cattaneo 7 October 1996)
    
     ! JULIA 282
       RLUNIT.H : Increase size of output bank list to 200 banks 
                  (M.Cattaneo, July 96, requested by D.Casper)
       RCLRUN : Add call to OLSPOT (M.Cattaneo, June 1996)
       RECONS : Add call to OLSPOT (M.Cattaneo, June 1996)
       RFORMA : Add format for BLQP bank (M.Cattaneo, June 1996)
       RINJOB : Add BLQP to SUMLIS (M.Cattaneo, June 1996)
       RLTOCH : Replace LENOCC by LNBLNK (M.Cattaneo, July 1996)
       RSMJOB : Add call to OLSPOT (M.Cattaneo, June 1996)
       RUNKNO : Add call to OLSPOT (M.Cattaneo, June 1996)
    
     * corr file 281.2
       RERROR : Fix bug: error was not reported on autoinitialising first call 
                (M.Cattaneo, June 96)
    
     ! JULIA 281
       RWRUNH : RUNE added to the C list (P.Comas, Mar 96) 
    
     ! JULIA 280
       RINCND,RIPAS0,RMONII : opening "'" should have a closing "'" within
               the same line for cvs (F. Ranjard, Feb 96)
       RINJOB : change LOUTRL to IW(6) instead of 6 (P. Comas, Feb 96)
    
     * corr file 279.2
       AAMAIN : double size of BOS array from 1 to 2 Mw (O.Callot, Dec 95)
       RDETEC : set time measurement flags: for ITC, presence of ITTI
               (O.Callot, Dec 95)
       RNXMOD : call ALTIME only if MXTI card used (O.Callot, Dec 95)
       RSHRIN : avoid use of LENOCC (O.Callot, Dec 95)
     ! JULIA 279
       RCPAS0 : for VDET95, avoid messing around with VHOT and TOHV
               (A. Bonissent, Nov 95)
       RPOTCL : on popular request , for SICAL or LCAL only triggers,
               keep as well banks PCOB,PCRL,EWHE (B. Bloch, Nov 95)
       RFORMA : define format new pad dE/dx banks: PTPX, TPDX, TPXS,
               TPLS (P. Comas, Nov 95)
       RDEFIO : add pad dE/dx bank PTPX to the POT (P. Comas, Nov 95)
    
     * corr file 278.4
       RGETDV : make 'ONL' option always equivalent to PASS0 (I. Tomalin,
               Nov 95)
       RCPAS0 : interpret new TLAS bank correctly when creating PASS0
               cards (I. Tomalin, Nov 95)
       RFJCON : write error on TPC drift velocity to JCON bank using
               TLAS if TDPV is missing (I.Tomalin, Nov 95)
       RINJOB : add TVVD, TDPV and TLAS banks to run summary bank list
               (the latter two maybe temporarily) (I.Tomalin, Nov 95)
       RECONS : add call to TSUMVD (I. Tomalin, Nov 95)
     * corr file 278.2
       RINRUN : initialize beam position finding (S. Wasserbaech, Nov 95)
       RCLRUN : always close beam position stuff at the end of the run
               (S. Wasserbaech, Nov 95)
     * corr file 278.1
       RECEVT : process VDET regardless the number of tracks if not in
               LEP1 (P.Comas, Oct 95)
     ! JULIA 278
       RLOOPR : Filter out TPC laser events writing only the EVEH
               (P.Comas, Aug 95)
       RFORMA : format of new VDET banks VCSG, VWRL, VDMR, VDGC
               (P.Comas, Sep 95)
       RDEFIO : new VDET banks VWRL, VDMR, VDGC to POT (P.Comas, Sep 95)
    
     * corr file 277.2
       RDEFIO : new MC bank X1TP to POT (P.Comas, July 95)
       RCJSUM : add as many rows as wagons in a train and fill them
               (P.Comas, Jul 95)
       BMSUMCO : common modified to have BMSUM information per wagon
              (P.Comas, Jul 95)
       BMSUM : have the information per wagon in a train (P.Comas
              Jul 95)
     ! JULIA 277
       RCJSUM : improve PASS0 drift velocity calculation (I.Tomalin,
               May 95)
       RDEFIO : new banks HLOD to POT (P.Comas, May 95)
    
     * corr file 276.4
       RWJUBW : new routine to store bunch number identification used for
               reconstruction in EVEH (P.Comas, Apr 95)
       RCJSUM : only sum up t0 for events where bunch number is certain.
               (I.Tomalin, May 95)
       RDEFIO : new banks PWEI and LPAS to POT (P.Comas, May 95)
       RFORMA : format of new bank PWEI (P.Comas, May 95)
       RINRUN : add call to RWJUBW (bunch number used for reconstruction)
               (P.Comas, Apr 95)
       RLOOPR : add call to RWJUBW (bunch number used for reconstruction)
               (P.Comas, Apr 95)
       RMONIT,MINHEA : addapt to use PWEI (M.N.Minard, Apr 95)
     ! JULIA 276
       RFORMA,RDEFIO: add VDFK,VUFK to output list (A.Bonissent,
                     M.Thulasiadas, Mar 95)
    
     * corr file 275.5
       RDEFPO : call LUPACR when LCAL .and. SATR are required. If one is
                missing the name-indices are not defined (F.Ranjard, Feb 95)
     * corr file 275.4
       RDEFPO : reverse order of processing: first LCAL, after SICAL
               (B. Bloch, P. Comas, Feb 1995)
     * corr file 275.3
       RDEFIO : replace old GAMPEX bank PGPC by the new one PGAC (M.N. Minard,
               (Nov 1994)
     ! JULIA 275
       RFORMA : format of new Ecal banks EAGC, PGAC (M.N. Minard, Oct 1994)
    
     * corr file 274.5
       see comment on 274.4
     * corr file 274.4
       RLOOPR : only the EVEH of events with DAQ error as evtype (998)
                is passed on to the POT. These events are not recons-
                tructed.
                The original correction on JULIA 274.3 passed the whole
                event without any processing. This final one was JULIA
                274.4 on FALCON but on the other computers JULIA 274.4
                was released with another correction (TRNCON) while I
                (P.Comas) was away.
                corr file 274.5 will contain both final corrections to
                RLOOPR and TRNCON.
     * corr file 274.1
       RFJCON : remove call to TDEDXV. Fill JCON bank with /TMONIT/GAINTM.
     ! JULIA 274
       RINJOB : replace JTDX by JHDX in SUMLIS summary output list.
       RMONIT : remove call to TDXMON,Fill the dE/Dx word of the MONE bank
                with a constant 1.0
       RECEVT : remove call to TDXMON, everything is done in TACCMN
    
     * corr file 273.2
       RFORMA,RDEFIO: add D4CD bank to output list (G.Taylor).
                      remove SOR new trigger banks put by error in
                      corr file # 1
     * corr file 273.1
       RDEFIO: add new trigger banks needed to output list.
     ! JULIA 273
       RFORMA,RINJOB: remove XSGE, XSHI, XSSC trigger banks.
       RINRUN: remove call to XTRSIN.
       RPOTCL: remove call to XTRSEV.
       RCLRUN: remove call to XTRSFI.
       RDEFIO: add new trigger banks to output list
       RLOOPR: call XTCNCR before RECONS to create XTCN bank from
               X1RG bank.
    
     * corr file 272.1
       RDEFIO : write VDTD on POT as it was in previous versions.
     ! JULIA 272
    
     * corr file 271.9
       RFORMA : set JCON format to 48 columns.
     * corr file 271.8
       RINRUN : in case of '92 MC prod, drop EZTH and get it
                back from ADBSCONS.
     * corr file 271.6
       JCONJJ : extend JCON bank to 48 columns
       RFJCON : add de/dx constants.
     * corr file 271.2
       RWRUNH : bug when handling JCAR bank
     * corr file 271.1
       RDCARD,RDEFIO,RINJOB,RLOOPR : use BANKAL FMT
       RINJOB : VDTD is obsolete , remove this correction later on.
       JCONJJ : extend JCON bank to 13 columns
       RWREVT : suppress writing to moni file when not on VAX
                remove this correction in 271.9
       RFORMA : reset HLTU and JCON formats
       RFJCON : add TPC clock frequency and pressure.
  <<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<
     RBKHIS     The histograms are booked here.
     RCJSUM     Create and fill jsum bank
     RCLEAN     Delete some input banks according to data card remi
     RCLJOB     Close the reconstruction job
     RCLRUN     Close this run
     RCPAS0     Write tdpv bank in pass0 summary file
     RDCARD     Read julia data cards
     RDEFIO     Define formats for input and output files
     RDEFMI     Module to steer production of mini-dst dhea bank
     RDEFPO     Make pot banks
     RDETEC     Set selected detectors
     RECEVT     Process a single event through the reconstruction
     RECONS     Prepare and reconstruct an event
     REJECT     Decide what to do with misplaced events
     REPORT     Central error reporting routine
     RERROR     Julia error reporting routine
     RFALCR     Close run if running on falcon 1
     RFALEE     Falcon routine at end of event
     RFALIE     Initialize event if running on falcon 1
     RFALIJ     Initialize job if running on falcon 1
     RFALIR     Initialize run if running on falcon 1
     RFALPD     Called after prepare data  if running on falcon 1
     RFJCON     Fill jcon (julia constants) bank
     RFORMA     Define formats for bos banks in julia
     RGETDV     Get tpc drift velocity
     RHBOOK     Book histograms for the skeleton
     RHSEVT     Histogram this event
     RINCND     Initialise conditions for all the detector  (magnetic field)
     RINJOB     Initialise the job
     RINRUN     Initialise the run
     RIPAS0     Initialize pass0 conditions
     RLOOPR     Loop on records
     RLTOCH     Move bos bank names from list list into character string
     RLUTRF     Return luminosity coincidence trigger mask and hv mask for run krun
     RMONII     Initialization routine for monitoring
     RMONIT     Write file for monitoring
     RNXMOD     Analyse a module.-called before julia modules
     RPERRS     Print summary of non fatal errors
     RPNAMB     Print size of named banks created or deleted since
     RPOTCL     Clean up the pot before output
     RPREDA     Prepare raw data by subdetector
     RPRSTA     Print statistics for this run
     RPRSUM     Write out summary information
     RREVHE     Create reconstruction event header
     RSHRIN     Move bos bank names from list list into character string
     RSMJOB     Detectors job summary
     RTITLE     Print title :program name and version and computer type
     RTLSUM     Summarize rtlo banks in rtls on error
     RTMASK     Return trigger masks for current run
     RTRIGF     Return trigger type for current event
     RUNKNO     Handle records which are not event and not run (most likely slowco
     RVDPRE     Steer vdet track preselection
     RWJUBW     Store bunch number identification used for reconstruction in eveh
     RWREVT     Write the reconstructed event to output streams
     RWRUNH     Write run record to output streams
     RZEJOB     Zero statistics arrays which count inside the job
     RZERGL     Block data and zero of arrays
     RZERUN     Zero statistics arrays which count inside each run

3 RBKHIS
         SUBROUTINE RBKHIS
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   The histograms are booked here.
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   RINJOB                                                                          
        |---- RBKHIS                                                               
                   |----  VDBOOK                                                   
                   |----  JHISRF                              External             
                   |----  ECBOOK                                                   
                   |----  CABOOK                                                   
                   |----  HCBHIS                                                   
                   |----  ITBOOK                                                   
                   |----  MUBOOK                                                   
                   |----  TPBOOK                                                   
                   |----  LCBOOK                                                   
                   |----  SABOOK                                                   
                   |----  SIBOOK                                                   
                   |----  YYBOOK                                                   
                   |----  RHBOOK                                                   
                   |----  OMBOOK                                                   
                   |----  EFBOOK                                                   
                   |----  USBOOK                                                   
   
 
3 RCJSUM
         SUBROUTINE RCJSUM
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Create and fill jsum bank
   
     Author       J. Knobloch 14-NOV-1989
   
      Modified :- E. Lancon             18-SEP-1991
           DO not call BMSUM anymore, use result stored in BSUMCO
      Modified :- B. Bloch-Devaux       25-MAY-1993
           Define Lumi coincidence as LCAL before 93 , Sical from 93 on
      Modified :- I. Tomalin             9-MAY-1995
           Improve PASS0 drift velocity calculation: Only sum t0 for
           events where bunch number is certain, and call TPCT0N
           instead of TPCT0.
      Modified :- P. Comas              13-JUN-1995
           Add as many rows as wagons in a train and fill them.
           The information per bunch will be used to get the beam
           spot parameters per wagon.
      Modified :- M.Cattaneo             8-DEC-1999
           y2k fix to JSUM date
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   RWREVT                                                                          
        |---- RCJSUM                                                               
                   |----  RQBUNC                              External             
                   |----  NAMIND                              External             
                   |----  AUBOS                               External             
                   |----  RERROR                                                   
                   |----  DATIME                              External             
                   |----  MOD                                 External             
                   |----  ABS                                 External             
                   |----  RLUTRF                                                   
                   |----  IAND                                External             
                   |----  LENLIS                                                   
                   |----  ALTIME                                                   
                   |----  TPCT0N                                                   
   
 
3 RCLEAN
         SUBROUTINE RCLEAN
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Delete some input banks according to data card remi
                                                   (REMove form Input)
   
     Author        S. Orteu             19-JAN-1988
   
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   RECONS                                                                          
        |---- RCLEAN                                                               
                   |----  NAMIND                              External             
                   |----  CHAINT                              External             
                   |----  BDROP                               External             
   
 
3 RCLJOB
         SUBROUTINE RCLJOB
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Close the reconstruction job
   
      Author        J. Bunn
   
      Modified      S. Orteu      9-FEB-1987
   
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   AAMAIN                                                                          
        |---- RCLJOB                                                               
                   |----  USCJOB                                                   
                   |----  RSMJOB                                                   
                   |----  BOSTA                               External             
                   |----  JPRERF                              External             
                   |----  ABWEND                              External             
                   |----  ACLOSE                              External             
                   |----  ALTIME                                                   
   
 
3 RCLRUN
         SUBROUTINE RCLRUN
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Close this run
   
     Created by   J. Bunn
   
     Modified by  S. Orteu               Date  19-JAN-1987
      Modified :- E. Lancon             30-AUG-1993
               write SUMR banks with nr = run_number
                  F. Ranjard            25-APR-1994
               remove call to XTRSFI
                  M. Cattaneo              JUN-1996
               add call to BMSPOT
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   RLOOPR                                                                          
        |---- RCLRUN                                                               
                   |----  TPCRUN                                                   
                   |----  USCRUN                                                   
                   |----  BCCRUN                                                   
                   |----  OMCRUN                                                   
                   |----  SICRUN                                                   
                   |----  VDCRUN                                                   
                   |----  VBSCLR                                                   
                   |----  OLSPOT                                                   
                   |----  RFALCR                                                   
                   |----  LPRLUM                                                   
                   |----  FLOAT                               External             
                   |----  NINT                                External             
                   |----  NAMIND                              External             
                   |----  BDROP                               External             
                   |----  BLIST                               External             
                   |----  LNBLNK                              External             
                   |----  NLIST                               External             
                   |----  ACDARG                              External             
                   |----  AOPENW                              External             
                   |----  BWRITE                              External             
                   |----  JOUTRL                              External             
                   |----  ABWSEL                              External             
                   |----  RCPAS0                                                   
                   |----  ALTIME                                                   
                   |----  RPRSTA                                                   
   
 
3 RCPAS0
         SUBROUTINE RCPAS0
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Write tdpv bank in pass0 summary file
   
      Author   :- E. Lancon             25-FEB-1992
      Modified  :- I. Tomalin           7-NOV-1995
                  Use TLAS bank correctly.
      Modified  :- A. Bonissent         10-NOV-1995
                  For VDET95, avoid messing around with VHOT and TOHV.
      Modified  :- I. Tomalin           26-JUN-1996
                  If using new VDET and requested by PVGG card,
                  PASS0 will take V_d from VDET/gamma-gamma.
      Modified  :- M. Cattaneo           8-DEC-1999
                  Fix IDAT and format statement for y2k
   
      Description
      ===========
         Open The PASS0 summary file, defined by the PAS0 data card.
         Check that TDPV exists on input.
           Determine V_d using laser, Delta(t0) and VDET/gamma-gamma.
           Find hot channels in VDET.
           Write PASS0 conditions and results to JPAS bank.
           If at high energy and requested by PVGG card then
             Create TDPV using VDET/gamma-gamma events.
           Else
             Create TDPV using Delta(t0).
           Endif
           If too few events for above, then create TDPV from TLAS.
           If laser shot too old, then just fill TDPV from reference run.
         Write TDPV on PAS0 summary file.
         If a new TPDV bank is created the previous one is dropped.
   
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   RCLRUN                                                                          
        |---- RCPAS0                                                               
                   |----  ALSUMGT                             External             
                   |----  BDROP                               External             
                   |----  BLIST                               External             
                   |----  ALVERS                              External             
                   |----  ADBVER                              External             
                   |----  DATIME                              External             
                   |----  MOD                                 External             
                   |----  MALREC                              External             
                   |----  AGTFIL                              External             
                   |----  GTSTUP                              External             
                   |----  NAMIND                              External             
                   |----  VIPAS0                              External             
                   |----  RERROR                                                   
                   |----  FLOAT                               External             
                   |----  SQRT                                External             
                   |----  ABS                                 External             
                   |----  NLINK                               External             
                   |----  VDYEAR                              External             
                   |----  BSWAP                               External             
                   |----  AUBOS                               External             
                   |----  NDROP                               External             
                   |----  LNBLNK                              External             
                   |----  BWRITE                              External             
                   |----  ACLOSE                              External             
   
 
3 RDCARD
         SUBROUTINE RDCARD  (IERD)
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Read julia data cards
   
      Author   :- E. Lancon             10-MAR-1992
   
      Inputs:
           - None
   
      Outputs:
           - IERD         I/      0 = OK
                                  else NOT OK
   
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   RINJOB                                                                          
        |---- RDCARD                                                               
                   |----  MRESET                              External             
                   |----  BREADC                              External             
                   |----  NAMIND                              External             
                   |----  BCALLC                              External             
                   |----  BSWAP                               External             
                   |----  AGTFIL                              External             
                   |----  ABS                                 External             
                   |----  RDEFIO                                                   
   
 
3 RDEFIO
         SUBROUTINE RDEFIO (IERIO)
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Define formats for input and output files
   
     Author        S. Orteu        18-MAR-1987
     Modified      J.Knobloch      15-DEC-1988
      Modified :- E. Lancon              7-MAR-1991
                 Remove the MINI option
     Modified      J.Sedgbeer      01-MAR-1991 Add IXTR bank to POT.
     Modified      J.Sedgbeer      25-SEP-1991 Add IZDB bank to POT.
      Modified :- E. Lancon             27-JAN-1992
                 Remove the DST option
                 Do not open output file anymore, done by ABRSEL (alephli
                 Add IERIO as argument
   
      Outputs:
           -   IERIO           I/    Error Return Code
                                     0 = No error
                                     1 = Invalid Output Option
                                     3 = Too Many Output Banks
   
      Modified :- E. Lancon             17-MAY-1993
           remove call to RFORMA put it in RINRUN
      Modified :- E. Lancon             20_SEP-1993
           call ALFMT to defined format for required output banks
      Modified :- P. Comas            4-MAY-1994
           Add new (due to the change in the readout) trigger banks
           to the POT
      Modified :- P. Comas            2-MAY-1995
           New banks PWEI and LPAS to POT
      Modified :- P. Comas           29-MAY-1995
           New bank HLOD to POT
      Modified :- P. Comas           27-JUL-1995
           New MC bank X1IP to POT
      Modified :- P. Comas           15-NOV-1995
           New bank PTPX for pad dE/dx to POT
      Modified :- D. Casper           4-FEB-1997
           Tracking upgrade banks to POT
      Modified :- M.Cattaneo         19-MAR-1997
           New bank LCRA to POT
      Modified :- B.Bloch-Devaux     20-MAR-1997
           New bank KXME to POT
      Modified :- M.Cattaneo         13-MAY-1997
           New banks BCSC,BCSL,BCTR to POT
      Modified :- D.Casper           17-JUL-1997
           New bank YSMO to POT
      Modified :- M.Cattaneo         06-NOV-1997
           New bank BLCT to POT
      Modified :- M.Cattaneo         01-APR-1998
           Banks FSHO, KMAR, KWTK to POT
      Modified :- M.Cattaneo         17-APR-1998
           New bank BCHG to POT
      Modified :- M.Cattaneo         09-NOV-1998
           New bank BCPO to POT, remove BLCT (can be made from BCPO)
      Modified :- M.Cattaneo         23-APR-1999
           New banks KWGT,SIID to POT, also BLUM to POT on random triggers
    Total: 163 banks on OUTLIS
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   RDCARD                                                                          
        |---- RDEFIO                                                               
                   |----  NAMIND                              External             
                   |----  CHAINT                              External             
                   |----  LNBLNK                              External             
                   |----  BANK                                External             
                   |----  SORCHA                              External             
                   |----  ALFMT                               External             
                   |----  RMONIIRETURN                        External             
   
 
3 RDEFMI
         SUBROUTINE RDEFMI
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Module to steer production of mini-dst dhea bank
   
       Author:    S. Haywood 17/05/88
       Modified:  S. Haywood 07/06/89
      Modified :- E. Lancon              7-MAR-1991
                 Mini banks are now written by the MINI package,
                 keep only DHEA.
   
       Called by RECONS.
   
       All subroutines in this module use the BOS library and
       the ALEPHLIB.
   
    Description
    -----------
       The routines to create DHEA bank (MINHEA and FIDHEA)
       are called in turn
   
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   RECONS                                                                          
        |---- RDEFMI                                                               
                   |----  MINHEA                                                   
                   |----  FIDHEA                                                   
   
 
3 RDEFPO
         SUBROUTINE RDEFPO
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Make pot banks
      Created by Juergen Knobloch       8-JUL-1988
      Modified by F.Ranjard            17-FEB-1995
                  call LUPACR when LCAL .and. SATR are required.
                  if not name-indices are not all set.
   
      Purpose   : STEERING ROUTINE TO CREATE POT BANKS
      Inputs    :
      Outputs   :
   
      Called by : RECONS
      Calls     : CPOTCR,TJTOP,FITWRI,HPRPOT
   
      Modified  : B.Bloch, P.Comas     7-FEB-1995
                 First LCAL has to be processed and after SICAL: even-
                 tually, PECO is created by LCAL and used by SICAL
   
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   RECONS                                                                          
        |---- RDEFPO                                                               
                   |----  VPRPOT                                                   
                   |----  IREOPD                                                   
                   |----  TJTOP                                                    
                   |----  FITWRI                                                   
                   |----  CPOTCR                                                   
                   |----  CPOTEH                                                   
                   |----  CPADWR                                                   
                   |----  PHCHIC                              External             
                   |----  HPRPOT                                                   
                   |----  HDGPOT                                                   
                   |----  LCRPOT                                                   
                   |----  SPRPOT                                                   
                   |----  LUPACR                                                   
                   |----  CPOTLC                                                   
                   |----  NAMIND                              External             
                   |----  SICRPOT                                                  
                   |----  PECHIC                              External             
   
 
3 RDETEC
         SUBROUTINE RDETEC
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Set selected detectors
   
     Author S. Orteu              Date :  13-JAN-1987
     Modified J.Knobloch          Date :  31-JUL-1989
     Modified M.Cattaneo          Date :  15-MAY-1996
       Switch off tracking upgrade refinements in PASS0,
       by forcing YNSV,YNLV,YNKF,TNPX,ENKF,VNSL
     Modified I.Tomalin           Date :  16-MAY-1996
       Switch on use of TPC wires in PASS0.
   
   
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   RINJOB                                                                          
        |---- RDETEC                                                               
                   |----  NLINK                               External             
                   |----  CHAINT                              External             
                   |----  NDROP                               External             
                   |----  NAMIND                              External             
                   |----  AUBOS                               External             
                   |----  INTCHA                              External             
   
 
3 RECEVT
         SUBROUTINE RECEVT(IREJ)
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Process a single event through the reconstruction
      Modified :- E. Lancon             14-JUN-1991
                 process the VDET (VPREDA and VDLINK) only is at least 2
                 TPC tracks
      Modified :- P. Coyle              24-OCT-1991
                 keep if a VDET laser event (trigger bit 21 set)
                 and LASER was working (>=run 11869)
      Modified :- E. Lancon              8-NOV-1991
                 SICAL added
      Modified :- E. Lancon              7-Apr-1993
                 Swap FRFT 0 <-> FRFT 3 after tracking and back
                 at the end of reconstruction
      Modified :- D. Rousseau            23-APR-1993
                process VDET if random trigger (trigger bit 31 set)
      Modified :- E. Lancon             13-SEP-1993
                process VDET if VREC data card is present
                - F.Ranjard             10-May-1994
                remove call to TDXMON
      Modified :- P. Comas              24-Oct-1995
                process VDET regardless the number of tracks if not in LEP1
      Modified :- D.Casper              09-06-1996
                - D.Casper              05-03-1997
                - M.Cattaneo            05-03-1997
                Add modules VTRPRE (preselection of tracks for VDET patrec)
                            KINKS  (kink search)
                            NUCVTX (nuclear interaction search)
      Modified :- D.Casper              15-05-1997
                Call VDET global pattern recognition if VGLO card found
      Modified :- I.Tomalin             15-05-1997
                moved call to TSUMVD from RECONS to RECEVT
      Modified :- D.Casper,M.Cattaneo    6-11-1997
                Create track hit bit patters for secondary vertex search
                Call BCAL reconstruction
      Modified :- Manoj Thulasidas      16-12-1997
                Add TPC hit smearing
      Modified :- Alain Bonissent       23-02-1998
                Move TPC hit smearing to after track fit, and refit tracks
      Modified :- Marco Cattaneo        08-07-1998
                Call VGLOB by default for old VDET
      Modified :- Anders Waananen       28-09-1998
                Bug fix: VDYEAR was declared as LOGICAL
      Modified :- Marco Cattaneo        09-11-1998
                Replace call to BCAREC (obsolete) with call to BCALJU
      Modified :- Alain Bonissent       01-12-1998
                Remove TPC hit smearing
   
     Output   IREJ = 0      Event OK
                   <>0      Event rejected
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   RECONS                                                                          
        |---- RECEVT                                                               
                   |----  NAMIND                              External             
                   |----  VDYEAR                              External             
                   |----  ABRUEV                              External             
                   |----  ALLEP1                              External             
                   |----  FLOAT                               External             
                   |----  RDMIN                               External             
                   |----  RNXMOD                                                   
                   |----  TPCREC                                                   
                   |----  ITCREP                                                   
                   |----  RERROR                                                   
                   |----  ITCREC                                                   
                   |----  FITALL                                                   
                   |----  FREFIT                                                   
                   |----  IATTMA                                                   
                   |----  RVDPRE                                                   
                   |----  ABS                                 External             
                   |----  ALTRIG                              External             
                   |----  VTRLAS                              External             
                   |----  VPREDA                                                   
                   |----  IBSET                               External             
                   |----  VGLINK                                                   
                   |----  VDLINK                                                   
                   |----  TSUMVD                                                   
                   |----  MSWAP                               External             
                   |----  FCFRID                                                   
                   |----  YKSRCH                                                   
                   |----  YSVRTX                              External             
                   |----  FTRACK                                                   
                   |----  HCFCLU                                                   
                   |----  HRHTUB                              External             
                   |----  HMFIND                                                   
                   |----  MRMHIT                              External             
                   |----  MUASS                                                    
                   |----  MUIDO                               External             
                   |----  CALREC                                                   
                   |----  SICREC                                                   
                   |----  LCAREC                                                   
                   |----  BCALJU                                                   
                   |----  SATREC                                                   
                   |----  LTRACK                                                   
                   |----  YFMAIN                                                   
                   |----  YTOPOL                              External             
                   |----  YTOPRT                              External             
                   |----  YMFV0S                                                   
                   |----  EMSKEV                                                   
                   |----  OMBREC                                                   
   
 
3 RECONS
         SUBROUTINE RECONS
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Prepare and reconstruct an event
   
      Author   :- J. Bunn
      Modified :- S. Orteu              25-FEB-1987
      Modified :- E. Lancon             24-FEB-1993
      Modified :- I. Tomalin            15-AUG-1995 - Call TSUMVD.
      Modified :- M. Cattaneo              JUN-1996 - Call BMSPOT
      Modified :- I.Tomalin             15-MAY-1997
                moved call to TSUMVD from RECONS to RECEVT
   
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   RLOOPR                                                                          
        |---- RECONS                                                               
                   |----  ALTIME                                                   
                   |----  AUBLIS                              External             
                   |----  NAMIND                              External             
                   |----  FYKINE                              External             
                   |----  USIEVT                                                   
                   |----  RFALIE                                                   
                   |----  IGTLEN                              External             
                   |----  RCLEAN                                                   
                   |----  RPREDA                                                   
                   |----  RECEVT                                                   
                   |----  RNXMOD                                                   
                   |----  RDEFPO                                                   
                   |----  RDEFMI                                                   
                   |----  GASTEER                                                  
                   |----  RREVHE                                                   
                   |----  VBSPOT                                                   
                   |----  OLSPOT                                                   
                   |----  RMONIT                                                   
                   |----  RWREVT                                                   
                   |----  RHSEVT                                                   
                   |----  RFALEE                                                   
                   |----  BDROP                               External             
   
 
3 REJECT
         SUBROUTINE REJECT(NUMRU,NUMEV)
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Decide what to do with misplaced events
      Author S.Orteu       16-DEC-1987
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   RLOOPR                                                                          
        |---- REJECT.                                                              
   
 
3 REPORT
         SUBROUTINE REPORT(CALID,MSG,ITRAP)
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Central error reporting routine
   
       Author:  R. Johnson     21/4/87
   
       Input:
           - CALID:  Character string of any length giving the name
                     of the program module which is calling REPORT.
           - MSG:    Character string of any length for the message
                     giving details of what error has occured.
                     Ampersands (&) should separate individual lines.
                     Lines longer than 125 characters will be truncated.
                     This message should neither give the program name
                     nor the run nor event numbers nor whether the
                     error is fatal, as all that will be printed anyway.
           - ITRAP:  An integer set to zero if the error is to be
                     nonfatal or set to 1 for a fatal error.
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   CEXHIS                                                                          
   CPADWR                                                                          
   HINIJO                                                                          
   HRCPAT                                                                          
   HSTOFI                                                                          
   LINIRU                                                                          
   TINIRU                                                                          
   TISFIL                                                                          
   TPRFIN                                                                          
   TRNCON                                                                          
   YFVERT                                                                          
   YMFV0S                                                                          
        |---- REPORT                                                               
                   |----  LEN                                 External             
                   |----  MIN                                 External             
   
 
3 RERROR
         SUBROUTINE RERROR(CALID,MNI,MSG)
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Julia error reporting routine
    derived from TPC error reporting routine TREPRT
   
       Author:  R. Johnson     23/11/87
       Modified:J.Knobloch     10/10/88
       Modified:J.Knobloch     15/12/88
       Modified:J.Knobloch     22/05/89
       Modified :- E. Lancon             24-FEB-1993
          routine autoinitialized but still backward compatible
       Modified:M.Cattaneo     21/06/96
          Fix bug: error was not reported on autoinitialising first call
   
       Input:
           - CALID:  Character string giving the name
                     of the program module which is calling RERROR.
                     This should be no longer than 6 characters.
           - MNI:    Integer error code (unique for given CALID).
                     entered negative for fatal error
           - MSG:    Character string of any length for the message
                     giving details of what error has occured.
                     Ampersands (&) should separate individual lines.
                     Lines longer than 125 characters will be truncated.
                     This message should neither give the program name
                     nor the run nor event numbers, as all that will
                     be printed anyway.
   
       Description
       ===========
       This routine is used within the JULIA offline code to report
       non-fatal run-time errors.  For each unique error code, MN,
       the associated message will be printed a limited number of
       times.  The message also is saved, and a count is kept of the
       total number of times that the error is reported during the
       job.  These results then are summarized at the end of the
       job by RPERRS.  Note that the statistics and error messages
       are saved in the BOS common IW in banks RREP. The number of
       times an error is printed can be set by a data card
       ERRP nprint
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   BCALJU                                                                          
   BCFILE                                                                          
   BCINIT                                                                          
   BCPACK                                                                          
   CALREC                                                                          
   CASHET                                                                          
   CEXCOB                                                                          
   CFPASS                                                                          
   CINIRL                                                                          
   CPADWR                                                                          
   CPARAD                                                                          
   CRCHRL                                                                          
   CRCPAR                                                                          
   CTHCLU                                                                          
   CTKCHG                                                                          
   E4FIND                                                                          
   E4XYZ0                                                                          
   EAUTOP                                                                          
   ECBLDA                                                                          
   ECCLUS                                                                          
   ECDIGI                                                                          
   ECGMIX                                                                          
   ECHCGL                                                                          
   ECHTAG                                                                          
   ECLAMP                                                                          
   ECLUAR                                                                          
   ECNCOB                                                                          
   ECOBNK                                                                          
   ECOIDP                                                                          
   ECPRLO                                                                          
   ECRCOB                                                                          
   ECREIB                                                                          
   ECRMIP                                                                          
   ECRPEI                                                                          
   ECRUNQ                                                                          
   ECTEMP                                                                          
   ECTPC                                                                           
   ECTRAP                                                                          
   EFAXE                                                                           
   EFERRR                                                                          
   EFICV                                                                           
   EFIJOB                                                                          
   EFLCST                                                                          
   EFOLMK                                                                          
   EFPARD                                                                          
   EGFCST                                                                          
   EIDENT                                                                          
   EINIJO                                                                          
   EINIRL                                                                          
   EINIRU                                                                          
   EMSKMU                                                                          
   EPADCL                                                                          
   EPCHG                                                                           
   EPREDA                                                                          
   EPRSTO                                                                          
   EPRTPC                                                                          
   EROAD                                                                           
   ESLCTF                                                                          
   ESVETO                                                                          
   ETHRES                                                                          
   EWDIFP                                                                          
   EWIRCL                                                                          
   EX3IJK                                                                          
   FDETCO                                                                          
   FIDHEA                                                                          
   FITALL                                                                          
   FITWRI                                                                          
   FLNGV0                                                                          
   FREFIT                                                                          
   FRMHIT                                                                          
   FTPCER                                                                          
   FTRACK                                                                          
   GAMBNK                                                                          
   HCALIB                                                                          
   HCFCLU                                                                          
   HCLCRA                                                                          
   HCLUFI                                                                          
   HCORFC                                                                          
   HDGPOT                                                                          
   HINIRU                                                                          
   HMFIND                                                                          
   HMROAD                                                                          
   HPATCO                                                                          
   HPRANA                                                                          
   HPRANP                                                                          
   HPRDIG                                                                          
   HPRPOT                                                                          
   HRCOMP                                                                          
   HRCPAT                                                                          
   HROAD                                                                           
   HSPARE                                                                          
   HSPTRE                                                                          
   HTUBFI                                                                          
   HVMASK                                                                          
   IASIGN                                                                          
   IATTMA                                                                          
   IDIGPR                                                                          
   IFITP                                                                           
   IGETTI                                                                          
   IINIRU                                                                          
   IINTRK                                                                          
   IMATCH                                                                          
   INTRAK                                                                          
   IPAKDI                                                                          
   IPREDA                                                                          
   IREOPD                                                                          
   ISHUFL                                                                          
   ITCCUT                                                                          
   ITCOPR                                                                          
   ITCREP                                                                          
   ITCTRK                                                                          
   ITEXTN                                                                          
   ITLNK1                                                                          
   ITLNK2                                                                          
   ITRECF                                                                          
   ITRECI                                                                          
   ITREE                                                                           
   ITRKCI                                                                          
   ITRMCA                                                                          
   LGNGBX                                                                          
   LOLERR                                                                          
   MINIRU                                                                          
   MPREDA                                                                          
   MPREDG                                                                          
   MPREDM                                                                          
   MUASS                                                                           
   MUHITG                                                                          
   MUHITS                                                                          
   MUNEWR                                                                          
   MUTEST                                                                          
   OBMFIT                                                                          
   OBSINR                                                                          
   OBSPOT                                                                          
   OCBPRE                                                                          
   OLSPOD                                                                          
   OLSPOT                                                                          
   OLSPOU                                                                          
   OMCORR                                                                          
   PMSKFI                                                                          
   RCJSUM                                                                          
   RCPAS0                                                                          
   RECEVT                                                                          
   RFJCON                                                                          
   RGETDV                                                                          
   RINCND                                                                          
   RMONIT                                                                          
   RNXMOD                                                                          
   RTMASK                                                                          
   RWRUNH                                                                          
   SACOCR                                                                          
   SIINIJO                                                                         
   SIINIRU                                                                         
   SIPREDA                                                                         
   SPREMC                                                                          
   SPRPOT                                                                          
   SRADDR                                                                          
   SRBFTR                                                                          
   SRBTRK                                                                          
   SRCLUS                                                                          
   SRCONS                                                                          
   SRCOOR                                                                          
   SRCUTS                                                                          
   SRDBLE                                                                          
   SREALD                                                                          
   SRFIT2                                                                          
   SRFITF                                                                          
   SRFTRK                                                                          
   SRGEOM                                                                          
   SRPATC                                                                          
   SRSELO                                                                          
   SRUPAR                                                                          
   SRWPA2                                                                          
   SRWPAR                                                                          
   TATWIN                                                                          
   TCLCOR                                                                          
   TCLPAT                                                                          
   TCLSNG                                                                          
   TCLUST                                                                          
   TCOALG                                                                          
   TCOBIN                                                                          
   TCODRV                                                                          
   TCOORT                                                                          
   TCSHF1                                                                          
   TCSHFT                                                                          
   TERPAR                                                                          
   TFCAND                                                                          
   TFCHEK                                                                          
   TFITHL                                                                          
   TFTHED                                                                          
   TFTHEC                                                                          
   TFITKF                                                                          
   TFITTK                                                                          
   TFLNK2                                                                          
   TFLNKS                                                                          
   TFTHEL                                                                          
   TFTPAD                                                                          
   TFTWTB                                                                          
   THPADD                                                                          
   TINIRU                                                                          
   TISLND                                                                          
   TLINIT                                                                          
   TLOVFL                                                                          
   TMAGNT                                                                          
   TOVRLP                                                                          
   TPADDX                                                                          
   TPADFX                                                                          
   TPADS                                                                           
   TPARAB                                                                          
   TPCREC                                                                          
   TPDELS                                                                          
   TPDIAG                                                                          
   TPDTHR                                                                          
   TPK1CO                                                                          
   TPKILL                                                                          
   TPLANA                                                                          
   TPREDA                                                                          
   TPRFX                                                                           
   TPRLST                                                                          
   TRDWP1                                                                          
   TRDWP3                                                                          
   TREFIT                                                                          
   TRKELS                                                                          
   TRKFND                                                                          
   TRKWRA                                                                          
   TRNCON                                                                          
   TRSLNK                                                                          
   TSACHA                                                                          
   TSACLU                                                                          
   TSACOR                                                                          
   TSAPAT                                                                          
   TSATRK                                                                          
   TSAWIR                                                                          
   TSEQUE                                                                          
   TSMFT                                                                           
   TSUMVD                                                                          
   TTRUNK                                                                          
   TTWODX                                                                          
   TVDVEL                                                                          
   TWINCO                                                                          
   TWINDO                                                                          
   TWIRES                                                                          
   TWIREZ                                                                          
   UCTGFT                                                                          
   VBMFIT                                                                          
   VBSINR                                                                          
   VBSPOT                                                                          
   VCRHOT                                                                          
   VDALIN                                                                          
   VDALSG                                                                          
   VDCHST                                                                          
   VDECOD                                                                          
   VDGTMV                                                                          
   VDISMR                                                                          
   VDLINK                                                                          
   VDMKCE                                                                          
   VDMPIN                                                                          
   VDNOIS                                                                          
   VDOSMR                                                                          
   VDRCUN                                                                          
   VDRNDM                                                                          
   VDSM95                                                                          
   VDSMAP                                                                          
   VDSTCH                                                                          
   VDTAN                                                                           
   VDWSMR                                                                          
   VDXYZT                                                                          
   VHINIT                                                                          
   VHOTIN                                                                          
   VINIRU                                                                          
   VMGCRL                                                                          
   VMKR90                                                                          
   VMKR95                                                                          
   VPREDA                                                                          
   VADDIA                                                                          
   VDBLHT                                                                          
   VFTALL                                                                          
   VGBRAN                                                                          
   VGBRUT                                                                          
   VGCOMP                                                                          
   VGLINK                                                                          
   VGNEVT                                                                          
   VGSTOR                                                                          
   VGTCUT                                                                          
   VHITID                                                                          
   VHMAP                                                                           
   VKAERR                                                                          
   VM1TRK                                                                          
   VMCHIP                                                                          
   VMCHIS                                                                          
   VMCLLD                                                                          
   VMOVER                                                                          
   VMUPDT                                                                          
   VPKSLN                                                                          
   VSLTRK                                                                          
   YKFFIT                                                                          
   YKINIT                                                                          
   YKLDC                                                                           
   YKSRCH                                                                          
   YKVDET                                                                          
        |---- RERROR                                                               
                   |----  NAMIND                              External             
                   |----  AUBOS                               External             
                   |----  IABS                                External             
                   |----  IBSET                               External             
                   |----  INTCHA                              External             
                   |----  NLINK                               External             
                   |----  MIN                                 External             
                   |----  LEN                                 External             
   
 
3 RFALCR
         SUBROUTINE RFALCR
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Close run if running on falcon 1
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   RCLRUN                                                                          
        |---- RFALCR.                                                              
   
 
3 RFALEE
         SUBROUTINE RFALEE
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Falcon routine at end of event
       dummy for other processing
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   RECONS                                                                          
        |---- RFALEE.                                                              
   
 
3 RFALIE
         SUBROUTINE RFALIE(IREJ)
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Initialize event if running on falcon 1
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   RECONS                                                                          
        |---- RFALIE.                                                              
   
 
3 RFALIJ
         SUBROUTINE RFALIJ
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Initialize job if running on falcon 1
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   RINJOB                                                                          
        |---- RFALIJ.                                                              
   
 
3 RFALIR
         SUBROUTINE RFALIR
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Initialize run if running on falcon 1
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   RINRUN                                                                          
        |---- RFALIR.                                                              
   
 
3 RFALPD
         SUBROUTINE RFALPD(IREJ)
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Called after prepare data  if running on falcon 1
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   RPREDA                                                                          
        |---- RFALPD.                                                              
   
 
3 RFJCON
         SUBROUTINE RFJCON
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Fill jcon (julia constants) bank
   
      Author   :- E. Lancon             16-OCT-1991
   
      Modified :- E. Lancon              1-OCT-1993
           Add TPC clock frequency and pressure
      Modified :- E. Lancon              2-NOV-1993
           Add dE/dx constants
                  F.Ranjard             30-MAY-1994
           remove call to TDEDXV
           fill JCON with /TMONIT/GAINTM
      Modified :- I.Tomalin              7-NOV-1994
           Get error on Vz from TLAS if TDPV missing.
      Modified :- W.Wiedenmann           12.05.99
           Use clock frequency in Hz from TSOR bank (since 1999)
   
      Called from RINRUN
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   RINRUN                                                                          
        |---- RFJCON                                                               
                   |----  AUBOS                               External             
                   |----  RERROR                                                   
                   |----  TPDVEL                              External             
                   |----  NAMIND                              External             
                   |----  ABS                                 External             
                   |----  GTT0GL                              External             
                   |----  NINT                                External             
                   |----  GAINTM                              External             
   
 
3 RFORMA
         SUBROUTINE RFORMA
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   
   Define formats for bos banks in julia
      Author: J.Knobloch  15.3.90
      Modified by: F.Ranjard 25.4.94
                   remove XSGE, XSHI, XSSC banks
      Modified by: M.Cattaneo 20.6.96
                   add BLQP bank
      Modified by: D.Casper  17.8.97
                   add YSMO, correct YKNK,YSVT formats
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   RINRUN                                                                          
        |---- RFORMA                                                               
                   |----  BKFMT                               External             
   
 
3 RGETDV
         SUBROUTINE RGETDV
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Get tpc drift velocity
   
      Author   :- E. Lancon             25-FEB-1992
      Modified :- I. Tomalin             2-AUG-1995
                    (Make 'ONL' option exactly equivalent to PASS0).
   
      Description
      ===========
       Finds TPC drift velocity (initializes subroutine TPDVEL).
   
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   TRNCON                                                                          
        |---- RGETDV                                                               
                   |----  TPDVEL                              External             
                   |----  RERROR                                                   
   
 
3 RHBOOK
         SUBROUTINE RHBOOK
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   ++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++====
   Book histograms for the skeleton
    Author         S. Orteu       11-feb-1987
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   RBKHIS                                                                          
        |---- RHBOOK                                                               
                   |----  HBOOK1                              External             
   
 
3 RHSEVT
         SUBROUTINE RHSEVT(IREJ)
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Histogram this event
   
     Author    J. Bunn
   
     Modified  S. Orteu                  9-FEB-1987
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   RECONS                                                                          
        |---- RHSEVT                                                               
                   |----  ITHIST                                                   
                   |----  JHISRF                              External             
                   |----  TPHIST                                                   
                   |----  VDHIST                                                   
                   |----  ECHIST                                                   
                   |----  LCHIST                                                   
                   |----  SAHIST                                                   
                   |----  SIHIST                                                   
                   |----  HCHIST                                                   
                   |----  MUHIST                                                   
                   |----  OMHIST                                                   
                   |----  YYHIST                                                   
                   |----  USHIST                                                   
                   |----  ALTIME                                                   
                   |----  HFILL                               External             
                   |----  HBOOK1                              External             
                   |----  HF1                                 External             
   
 
3 RINCND
         SUBROUTINE RINCND
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Initialise conditions for all the detector  (magnetic field)
    Author      S. Orteu   9-FEB-1987
      Modified :- E. Lancon              6-MAR-1991
                 Add KAFID = IW(NAMIND('AFID')) undefined before
      Modified :- M. Cattaneo            8-JUL-1997
                 Protect against zero magnetic field:
                 Set FIELRC to 0.0001 if ALFIEL returns it as 0.0
                 Produce a "fatal" error
      Modified :- F.Ranjard              8-DEC-1999
                 Fix format statement for y2k
      Modified :- M.Cattaneo            20-MAR-2000
                 Remove initialisation of ENERRC, done in RINRUN.
    For the moment, only the magnetic field. The data is taken from the
    bank from GALEPH, but in the future it will be read from the DataBas
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   RINRUN                                                                          
        |---- RINCND                                                               
                   |----  NAMIND                              External             
                   |----  ALFIEL                              External             
                   |----  REAL                                External             
                   |----  RERROR                                                   
   
 
3 RINJOB
         SUBROUTINE RINJOB(ISJOB)
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Initialise the job
   
     Author       J. Bunn
   
     Modified     S. Orteu      25-FEB-1987
      Modified :- E. Lancon             17-MAY-1993
           ADD RLEP to SUMLIS
                  F. Ranjard            25-APR-1994
           remove XSGE, XSHI, XSSC from SUMLIS
                  F.Ranjard             16-MAY-1994
           remove JTDX from SUMLIS
           add JHDX to SUMLIS
     Modified     I. Tomalin            15-AUG-1995
           add TVVD,TLAS,TDPV to SUMLIS
     Modified     P. Comas
           change LOUTRL to IW(6) instead of 6
     Modified     M. Cattaneo           20-JUN-1996
           add BLQP to SUMLIS
     Modified     F. Ranjard            08-DEC-1999
           exit if linked with non y2k compliant Alephlib or ADBS
   
     Output
           ISJOB = Status
                 = 0 O.K.
                 = 1 No runs or tapes specified
                 = 2 Error in processing flags
   
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   AAMAIN                                                                          
        |---- RINJOB                                                               
                   |----  RTITLE                                                   
                   |----  RZEJOB                                                   
                   |----  RDCARD                                                   
                   |----  AOPDBS                              External             
                   |----  ADBVER                              External             
                   |----  ALVERS                              External             
                   |----  JUNIDB                              External             
                   |----  RDETEC                                                   
                   |----  HLIMIT                              External             
                   |----  RBKHIS                                                   
                   |----  VINIJO                                                   
                   |----  IINIJO                                                   
                   |----  TINIJO                                                   
                   |----  EINIJO                                                   
                   |----  CINIJO                                                   
                   |----  LINIJO                                                   
                   |----  SINIJO                                                   
                   |----  SIINIJO                                                  
                   |----  HINIJO                                                   
                   |----  MINIJO                                                   
                   |----  BINIJO                                                   
                   |----  OINIJO                                                   
                   |----  YINIJO                                                   
                   |----  EFIJOB                                                   
                   |----  RFALIJ                                                   
                   |----  USIJOB                                                   
   
 
3 RINRUN
         SUBROUTINE RINRUN
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Initialise the run
   
   
     Author       J. Bunn
   
     Modified     S. Orteu      25-FEB-1987
      Modified :- E. Lancon             17-MAY-1993
           Add call to RFORMA
                  F. Ranjard            25-APR-1994
           remove call to XTRSIN
                  P. Comas               2-MAY-1995
           Add call to RWJUBW (bunch number used for reconstruction)
                  M. Cattaneo           20-MAR-2000
           Use GETLEP to initialise RENLEP, set ENERRC=RENLEP
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   RLOOPR                                                                          
        |---- RINRUN                                                               
                   |----  ALTIME                                                   
                   |----  GETLEP                              External             
                   |----  NAMIND                              External             
                   |----  RFORMA                                                   
                   |----  BDROP                               External             
                   |----  GTSTUP                              External             
                   |----  ALGTDB                              External             
                   |----  BPRNT                               External             
                   |----  RIPAS0                                                   
                   |----  BSWAP                               External             
                   |----  RZERUN                                                   
                   |----  RINCND                                                   
                   |----  FYIRUN                              External             
                   |----  RWJUBW                                                   
                   |----  TNAMRD                              External             
                   |----  VINIRU                                                   
                   |----  IINIRU                                                   
                   |----  TINIRU                                                   
                   |----  FINIRU                                                   
                   |----  EINIRU                                                   
                   |----  LINIRU                                                   
                   |----  SINIRU                                                   
                   |----  SIINIRU                                                  
                   |----  HINIRU                                                   
                   |----  MINIRU                                                   
                   |----  BINIRU                                                   
                   |----  OINIRU                                                   
                   |----  YINIRU                                                   
                   |----  RFALIR                                                   
                   |----  VBSINR                                                   
                   |----  USIRUN                                                   
                   |----  RFJCON                                                   
                   |----  VZERO                               External             
                   |----  RWRUNH                                                   
   
 
3 RIPAS0
         SUBROUTINE RIPAS0
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Initialize pass0 conditions
   
      Author   :- E. Lancon              3-APR-1992
   
      Modified :- E. Lancon             17-MAY-1993
           Bswap previous VHOT bank to write it out if not enough events
           at end of run
      Modified :- I. Tomalin            15-SEP-1996
           Look for PVGG card - get V_d from VDET & gamma/gamma events option.
           Avoid deletion of VHOT for VDET II so V_d can use it.
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   RINRUN                                                                          
        |---- RIPAS0                                                               
                   |----  NAMIND                              External             
                   |----  AGETDB                              External             
                   |----  GTSTUP                              External             
                   |----  BSWAP                               External             
   
 
3 RLOOPR
         SUBROUTINE RLOOPR
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Loop on records
   
      Author        S.Orteu, J.Knobloch
      Modified      Z. Qian              15-jul-1989
      Modified:   H. Meinhard       24-Aug-1989
      Modified :- E. Lancon              5-FEB-1992
                   Use ABRSEL routine from alephlib to read events
                  F.Ranjard             28-APR-1994
                   create XTCN bank from X1RG bank
                  P.Comas               25-AUG-1994
                   Only the EVEH of events with DAQ error as evtype
                   (998) is passed on to the POT. These events are
                   not reconstructed
                  P.Comas               8-MAY-1995
                   Write bunch number used for reconstruction in EVEH
                  P.Comas               8-AUG-1996
                   Filter out TPC laser events writing only the EVEH
                  M.Cattaneo            5-DEC-1997
                   Fix format statement when event length > 1Mbyte
                  M.Cattaneo           27-JUL-1998
                   Print also processing time of previous event
                  M.Cattaneo           14-SEP-1998
                   Modify format statement
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   AAMAIN                                                                          
        |---- RLOOPR                                                               
                   |----  RNXMOD                                                   
                   |----  ABRSEL                              External             
                   |----  ABUNIT                              External             
                   |----  FLOAT                               External             
                   |----  LENLIS                                                   
                   |----  NAMIND                              External             
                   |----  RINRUN                                                   
                   |----  REJECT                                                   
                   |----  ABWSEL                              External             
                   |----  JOUTRL                              External             
                   |----  BTEST                               External             
                   |----  RSHRIN                                                   
                   |----  LNBLNK                              External             
                   |----  BDROP                               External             
                   |----  BLIST                               External             
                   |----  XTCNCR                                                   
                   |----  RWJUBW                                                   
                   |----  RECONS                                                   
                   |----  NDROP                               External             
                   |----  RUNKNO                                                   
                   |----  RCLRUN                                                   
   
 
3 RLTOCH
         SUBROUTINE RLTOCH(IW,LIST,STRING)
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Move bos bank names from list list into character string
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
              RLTOCH                                                               
                   |----  NLIST                               External             
                   |----  LNBLNK                              External             
   
 
3 RLUTRF
         SUBROUTINE RLUTRF(KRUN,MKREQ,MSKHV,MSKPC)
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Return luminosity coincidence trigger mask and hv mask for run krun
   
   
       Author:     B. Bloch-Devaux   25-May-1993
   
       Input:      - KRUN : current Run number
   
       Output:     - MKREQ mask of Lumi coincidence ( LCAL or SICAL )
                   - MSKHV mask of HV bits to be on for Lumi  meas't
                   - MSKPC ident of Luminometer for PECO clusters
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   RCJSUM                                                                          
        |---- RLUTRF                                                               
                   |----  NAMIND                              External             
                   |----  CHAINT                              External             
                   |----  IBSET                               External             
   
 
3 RMONII
         SUBROUTINE RMONII
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Initialization routine for monitoring
       J.Knobloch 31-7-89
       Modified: J. Knobloch 18-9-89
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
              RMONII                                                               
                   |----  NAMIND                              External             
                   |----  ACDARG                              External             
   
 
3 RMONIT
         SUBROUTINE RMONIT
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Write file for monitoring
       Modified:  S. Wasserbaech  17 Apr 1991
       1. Now uses PYER and PYFR instead of
       DMVE to get event vertex information.
       2. The numbers of + and - tracks are
       taken from DHEA rather than counting
       them from PFRF.  (The numbers had been
       interchanged.)
       3. The summed charged track energies
       are computed from PFRF rather than DMFT.
      Modified :- E. Lancon             29-MAY-1993
         Add protection against crazy PYFR bank
                - F.Ranjard             10-May-1994
         remove call to TDXMON
                - M.Cattaneo            27-Oct-1999
         Increase max PMOM to 150 GeV
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   RECONS                                                                          
        |---- RMONIT                                                               
                   |----  AUBOS                               External             
                   |----  NAMIND                              External             
                   |----  RERROR                                                   
                   |----  IBITS                               External             
                   |----  FLOAT                               External             
                   |----  ABS                                 External             
                   |----  ALFIEL                              External             
                   |----  SQRT                                External             
                   |----  INT                                 External             
                   |----  SIGN                                External             
                   |----  CMONI                                                    
                   |----  TIZERO                              External             
                   |----  ALTIME                                                   
                   |----  TPCT0                                                    
   
 
3 RNXMOD
         SUBROUTINE RNXMOD(MODUL,RMOD)
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Analyse a module.-called before julia modules
   
     AUTHOR   : J.Knobloch  15-March-1989
     MODIFIED : J.Knobloch  21-March-1989
   
       INPUT   : MODUL = Number of module
                         Special values:
                          MODUL=0   close previous module
                          MODUL=999 Print summary
                          MODUL=-1  End of Event
       OUTPUT  : RMOD    LOGICAL flag = .TRUE. if module to
                                        be executed
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   CALREC                                                                          
   RECEVT                                                                          
   RECONS                                                                          
   RLOOPR                                                                          
   RPREDA                                                                          
   RPRSUM                                                                          
   RREVHE                                                                          
   RUNKNO                                                                          
   RWREVT                                                                          
   TPCREC                                                                          
        |---- RNXMOD                                                               
                   |----  NAMIND                              External             
                   |----  RERROR                                                   
                   |----  BGARB                               External             
                   |----  ALTIME                                                   
                   |----  RPNAMB                                                   
   
 
3 RPERRS
         SUBROUTINE RPERRS
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Print summary of non fatal errors
    Derived from TPRSUM , filled by calls to RERROR
   
       Author:  R. Johnson     03-06-87
       Modified:J.Knobloch     10-10-88
   
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   RPRSUM                                                                          
        |---- RPERRS                                                               
                   |----  FORMAT                              External             
                   |----  NAMIND                              External             
                   |----  CHAINT                              External             
                   |----  NLINK                               External             
                   |----  MIN                                 External             
                   |----  BDROP                               External             
   
 
3 RPNAMB
         SUBROUTINE RPNAMB
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Print size of named banks created or deleted since
    last call
   
     AUTHOR   : J.Knobloch  22-March-1989
     MODIFIED :
   
       INPUT   : MODUL = Number of module
                         Special values:
                          MODUL=0  close previous module
                          MODUL=-1 Print summary
       OUTPUT  : RMOD    LOGICAL flag = .TRUE. if module to
                                        be executed
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   RNXMOD                                                                          
        |---- RPNAMB                                                               
                   |----  CHAINT                              External             
   
 
3 RPOTCL
         SUBROUTINE RPOTCL
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Clean up the pot before output
         J.Knobloch 16-OCT-1989
      Modified :- E. Lancon             14-JUN-1991
                 remove dropping of VDET banks in case of less than two g
                 tracks the code has been moved to RECEVT
                  F. Ranjard            25-APR-1994
                 remove call to XTRSEV
                  M. Cattaneo           23-APR-1999
                 drop BLUM on all but random triggers
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   RWREVT                                                                          
        |---- RPOTCL                                                               
                   |----  BCPACK                                                   
                   |----  NAMIND                              External             
                   |----  RTRIGF                                                   
                   |----  IBSET                               External             
                   |----  BDROP                               External             
                   |----  STRIGF                              External             
                   |----  RTLSUM                                                   
   
 
3 RPREDA
         SUBROUTINE RPREDA(IREJ)
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Prepare raw data by subdetector
   
     Author       J. Bunn
   
     Modified     S. Orteu    27-FEB-1987
     Modified :- E. Lancon             14-JUN-1991
                 remove VREPDA it is called by RECEVT now
   
     Output   IREJ = 0      Event OK
                   <>0      Event rejected
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   RECONS                                                                          
        |---- RPREDA                                                               
                   |----  BLIST                               External             
                   |----  RNXMOD                                                   
                   |----  IPREDA                                                   
                   |----  TPREDA                                                   
                   |----  EPREDA                                                   
                   |----  EMSKEI                                                   
                   |----  LPREDA                                                   
                   |----  SPREDA                                                   
                   |----  HPREDA                                                   
                   |----  MPREDM                                                   
                   |----  MPREDG                                                   
                   |----  BPREDA                                                   
                   |----  SIPREDA                                                  
                   |----  USPRDA                                                   
                   |----  RFALPD                                                   
   
 
3 RPRSTA
         SUBROUTINE RPRSTA(TIME)
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Print statistics for this run
   
     Author       J. Bunn
   
     Modified     S. Orteu      25-FEB-1987
      Modified :- E. Lancon             10-APR-1991   Add JSUM Printout
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   RCLRUN                                                                          
        |---- RPRSTA                                                               
                   |----  NAMIND                              External             
                   |----  ALSUMCL                             External             
   
 
3 RPRSUM
         SUBROUTINE RPRSUM
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Write out summary information
   
     Author       J. Bunn
   
     Modified     S. Orteu      25-FEB-1987
     Modified     J.Knobloch    15-Dec-1988
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   RSMJOB                                                                          
        |---- RPRSUM                                                               
                   |----  INT                                 External             
                   |----  RPERRS                                                   
                   |----  RNXMOD                                                   
                   |----  NAMIND                              External             
                   |----  ACDARG                              External             
                   |----  HROPEN                              External             
                   |----  HROUT                               External             
                   |----  HREND                               External             
                   |----  HISTDO                              External             
   
 
3 RREVHE
         SUBROUTINE RREVHE
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Create reconstruction event header
    Author: J. Knobloch 13-SEP-1989
      Modified :- E. Lancon             12-MAY-1993
               create and fill JEDS bank
      Modified : B. Bloch         November 97
               use xlumok from Alephlib
   Bank created:  REVH
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   RECONS                                                                          
        |---- RREVHE                                                               
                   |----  NAMIND                              External             
                   |----  ALTRIG                              External             
                   |----  MSWAP                               External             
                   |----  AUBOS                               External             
                   |----  IBSET                               External             
                   |----  JFBIRF                              External             
                   |----  JEBIRF                              External             
                   |----  RNXMOD                                                   
                   |----  ALCLASW                             External             
                   |----  ALSUMCL                             External             
                   |----  ALTIME                                                   
                   |----  XLUMOK                              External             
                   |----  BTEST                               External             
   
 
3 RSHRIN
         SUBROUTINE RSHRIN(IW,LIST,STRING)
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Move bos bank names from list list into character string
       FOR EXISTING BANKS ONLY
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   RLOOPR                                                                          
   RWREVT                                                                          
        |---- RSHRIN                                                               
                   |----  NLIST                               External             
                   |----  NAMIND                              External             
   
 
3 RSMJOB
         SUBROUTINE RSMJOB
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Detectors job summary
     - Modified:  M. Cattaneo              JUN-1996 - Call BMSPOT
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   RCLJOB                                                                          
        |---- RSMJOB                                                               
                   |----  JPRERF                              External             
                   |----  VPRSUM                                                   
                   |----  IPRSUM                                                   
                   |----  TPRSUM                                                   
                   |----  EPRSUM                                                   
                   |----  LPRSUM                                                   
                   |----  SPRSUM                                                   
                   |----  SIPRSUM                                                  
                   |----  HPRSUM                                                   
                   |----  MPRSUM                                                   
                   |----  BPRSUM                                                   
                   |----  OPRSUM                                                   
                   |----  YPRSUM                                                   
                   |----  OLSPOT                                                   
                   |----  RPRSUM                                                   
   
 
3 RTITLE
         SUBROUTINE RTITLE(LUN)
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Print title :program name and version and computer type
   
     Author      S. Orteu       23-JUN-1987
   
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   RINJOB                                                                          
        |---- RTITLE                                                               
                   |----  ALMACH                              External             
                   |----  ALVERS                              External             
   
 
3 RTLSUM
         INTEGER FUNCTION RTLSUM(LROCEX, IW)
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Summarize rtlo banks in rtls on error
   --
   -- inputs:
   --   LROCEX (integer)
   --     bit mask telling which readout controllers should be there
   --     usually PARAMETER (LROCEX = 8159), i.e. 1FDFhex
   --   IW(*)
   --     BOS array
   -- output:
   --   bos bank RTLS in case of inconsistent RTLO banks
   --   RTLO banks are dropped except RTLO # 0
   --
   -- description:
   -- check consistency of RTLO banks in raw data:
   --  o  are all of them there that are expected (parameter LROCEX)?
   --        the ROCs expected are specified using bits in LROCEX
   --        (bits 0..13):
   --        main EB, LVL1trigger, LV2trigger, VDET, ITC, TPC, ECAL, HCAL
   --        SATR, LCAL, BCAL, TPCA, TPCB
   --        in addition .GE. 17 pad TPPs per TPC endcap are required
   --        (note that the TPC main EB generally should NOT be there)
   --  o  do all contain the same trigger mask and event number?
   --
   --
   -- everything fine:
   --   drop all RTLO but main EB RTLO (with bank number 0)
   -- else
   --   build RTLS bank, bank number 0 and drop all RTLO banks but RTLO #
   --
   -- bank format for RTLS:
   -- ..............................................................
   --   1      i  Number of Colums = 60
   --   2      i  Number of rows = 2
   -- ..............................................................
   --    1  EM  i  trigger number main EB
   --    2  E1  i     "      "    level 1 trigger
   --    3  E2  i     "      "    level 2 trigger
   --    4  EV  i     "      "    VDET
   --    5  EI  i     "      "    ITC
   --    6  ET  i     "      "    TPC main EB
   --    7  EE  i     "      "    ECAL
   --    8  EH  i     "      "    HCAL
   --    9  ES  i     "      "    SATR
   --   10  EL  i     "      "    LCAL
   --   11  EC  i     "      "    BCAL
   --   12  EA  i     "      "    TPC side A
   --   13  EB  i     "      "    TPC side B
   -- 14-49     i     "      "    pad TPP of TPC sector # 1..36
   -- 50-60     i  reserved
   -- ..............................................................
   --   next row: ditto with trigger mask
   -- ..............................................................
   --
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   RPOTCL                                                                          
        |---- RTLSUM                                                               
                   |----  NAMIND                              External             
                   |----  IBSET                               External             
                   |----  NSWAP                               External             
                   |----  BDROP                               External             
                   |----  NBANK                               External             
                   |----  VZERO                               External             
                   |----  BLIST                               External             
                   |----  NDROP                               External             
   
 
3 RTMASK
         SUBROUTINE RTMASK(IRUN,MASKL,MASKR,MASKP,MASKS)
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Return trigger masks for current run
       INPUT:  IRUN
       OUTPUT: MASKL - Trigger mask for any LCAL trigger (incl SATR)
               MASKR - Trigger mask for random   trigger
               MASKP - Trigger mask for any physics trigger
               MASKS - Trigger mask for SATR coincidence trigger
        Author J.Knobloch 9-MAR-1990
       Modified:   H. Meinhard       23-Aug-1990  (1)
                         Add SATR trigger bit
       Modified:   H. Meinhard       04-Jul-1991  (2)
                         Obtain XTBN from data base, if necessary
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   RTRIGF                                                                          
        |---- RTMASK                                                               
                   |----  NAMIND                              External             
                   |----  RERROR                                                   
                   |----  AGETDB                              External             
                   |----  CHAINT                              External             
                   |----  IBSET                               External             
   
 
3 RTRIGF
         SUBROUTINE RTRIGF(IRUN,TLCAL,TRAND,TPHYS,TSATR,FAIL)
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Return trigger type for current event
   
       Author J.Knobloch 9-MAR-1990
       Modified:   H. Meinhard       23-Aug-1990  (1)
       Modified :- E. Lancon             10-APR-1991
                         Use ALTRIG to access Trigger bits
       Input:  IRUN
       Output: Tlcal - Trigger is any LCAL trigger (incl SATR trigger)
               TRAND - Trigger is random   trigger
               TPHYS - Trigger is any physics trigger
               TSATR - Trigger is SATR coincidence trigger
               FAIL  - no trigger info
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   EPADCL                                                                          
   ETHRES                                                                          
   LUPACR                                                                          
   RPOTCL                                                                          
   SATREC                                                                          
        |---- RTRIGF                                                               
                   |----  RTMASK                                                   
                   |----  ALTRIG                              External             
                   |----  IAND                                External             
   
 
3 RUNKNO
         SUBROUTINE RUNKNO
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Handle records which are not event and not run (most likely slowco
   
    Author          S. Orteu            20-JAN-1988
    Modified        J.Knobloch          12-SEP-1989
      Modified :- E. Lancon              4-JUN-1991
                 Write "Slow Control" Record as they come
                  M. Cattaneo              JUN-1996
                 Add call to BMSPOT
   
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   RLOOPR                                                                          
        |---- RUNKNO                                                               
                   |----  RNXMOD                                                   
                   |----  ALCLASW                             External             
                   |----  ALSUMCL                             External             
                   |----  VSLOWC                                                   
                   |----  ISLOWC                                                   
                   |----  TSLOWC                                                   
                   |----  ESLOWC                                                   
                   |----  LSLOWC                                                   
                   |----  SSLOWC                                                   
                   |----  SISLOWC                                                  
                   |----  HSLOWC                                                   
                   |----  MSLOWC                                                   
                   |----  BSLOWC                                                   
                   |----  OSLOWC                                                   
                   |----  OLSPOT                                                   
                   |----  USLOWC                                                   
                   |----  ABWSEL                              External             
                   |----  JOUTRL                              External             
                   |----  AUBLIS                              External             
   
 
3 RVDPRE
         SUBROUTINE RVDPRE(IRET)
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Steer vdet track preselection
   
      Author   :- M.Cattaneo,D.Casper             5-MAR-1997
                  Code originally in RECEVT as modified by D.Casper
                  for tracking upgrade.
   
      V0 and nuclear interaction pre-processing switched off with VNSL card
      YNKF card disables kinks
      YNLV card disables long V0's
      YNSV card disables secondary vertices
   
     Output   IRET = 0      Event OK
                   <>0      Event rejected
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   RECEVT                                                                          
        |---- RVDPRE                                                               
                   |----  NAMIND                              External             
                   |----  YTOPOL                              External             
                   |----  YFMAIN                                                   
                   |----  BDROP                               External             
                   |----  AUBOS                               External             
                   |----  BLIST                               External             
                   |----  FLNGV0                                                   
                   |----  YKSRCH                                                   
                   |----  YSVRTX                              External             
   
 
3 RWJUBW
         SUBROUTINE RWJUBW
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   - P.Comas, 27-APR-94
   Store bunch number identification used for reconstruction in eveh
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   RINRUN                                                                          
   RLOOPR                                                                          
        |---- RWJUBW                                                               
                   |----  NAMIND                              External             
                   |----  IBITS                               External             
                   |----  IOR                                 External             
                   |----  ISHFT                               External             
   
 
3 RWREVT
         SUBROUTINE RWREVT
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Write the reconstructed event to output streams
   
     Author       J. Bunn
   
     Modified by  S. Orteu   24-FEB-1987   New BOS I/O routines
      Modified :- E. Lancon             18-SEP-1991
               Get Beam position (used to fill JSUM) before  compression
               banks (Call BMSUM)
   
   
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   RECONS                                                                          
        |---- RWREVT                                                               
                   |----  RPOTCL                                                   
                   |----  BMSUM                                                    
                   |----  LNBLNK                              External             
                   |----  BLIST                               External             
                   |----  JOUTRL                              External             
                   |----  LENLIS                                                   
                   |----  RNXMOD                                                   
                   |----  CMPLIS                              External             
                   |----  RSHRIN                                                   
                   |----  ABWSEL                              External             
                   |----  NAMIND                              External             
                   |----  JFBIRF                              External             
                   |----  JEBIRF                              External             
                   |----  RCJSUM                                                   
                   |----  BDROP                               External             
                   |----  AUBLIS                              External             
   
 
3 RWRUNH
         SUBROUTINE RWRUNH
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Write run record to output streams
   
     Author       S. Orteu   5-MAR-1987
     Modified    J. Boucrot 28-MAR-1989
      Modified :- E. Lancon              9-APR-1991
                         JSUM removed From BDROP
      Modified :- E. Lancon             16-OCT-1991
                         JCON added to C list
      Modified :- E. Lancon              2-OCT-1991
                         TDVV not written to run record
      Modified :- E. Lancon             28-SEP-1993
                         Bug when handling JCAR bank
      Modified :- P. Comas              28-MAR-1996
                         RUNE added to the C list
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   RINRUN                                                                          
        |---- RWRUNH                                                               
                   |----  INT                                 External             
                   |----  NINT                                External             
                   |----  BLIST                               External             
                   |----  NAMIND                              External             
                   |----  MSWAP                               External             
                   |----  AUBOS                               External             
                   |----  RERROR                                                   
                   |----  BDROP                               External             
                   |----  AGETDB                              External             
                   |----  JOUTRL                              External             
                   |----  BKRHAW                              External             
                   |----  PRRHAH                              External             
                   |----  ABWSEL                              External             
                   |----  AUBLIS                              External             
   
 
3 RZEJOB
         SUBROUTINE RZEJOB
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Zero statistics arrays which count inside the job
   
      Author       :- J. Bunn
   
      Modified     :- S. Orteu 87/1/13
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   RINJOB                                                                          
        |---- RZEJOB                                                               
                   |----  VZERO                               External             
   
 
3 RZERGL
         SUBROUTINE RZERGL
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Block data and zero of arrays
   
      Author       :- J. Bunn
   
      Modified     :- S. Orteu 87/1/13
   
   
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
              RZERGL                                                               
                   |----  VZERO                               External             
   
 
3 RZERUN
         SUBROUTINE RZERUN
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Zero statistics arrays which count inside each run
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   RINRUN                                                                          
        |---- RZERUN                                                               
                   |----  VZERO                               External             
   

2 S_

  >>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>
    CKEY 
    
     1st entry in S_set
     ! JULIA 312
        SICAOK : uses XLUM2K instead of XLUMOK to compute Luminosity
                 whatever status has the Energy stability bit       (B.Bloch)
        SILUAD : stores two luminosities in 2000 in SLUM
                 with XLUMOK = including only Energy stability bit ON events
                 with XLUM2K = ignoring Energy stability bit
                 backward compatible for previous years/MC/Z runs.. (B.Bloch)
        SICLEAN: makes use of the Alephlib routine SIBKCL           (B.Bloch)
        SIESUM : SIFSUM moved to Alephlib                           (M.Cattaneo)
    
     ! JULIA 311
        SIPEDFX: Bug fix to correction of julia 31.0 - units are MeV, 
    		   not ADC counts                                    (B.Bloch)
    
     ! JULIA 310
        SICLUS : Apply better calibration in delayed timing mode    (B.Bloch)
        SIEPCR : Introduce bunch dependent phi modulation           (B.Bloch)
        SIINIRU: Load SCBP instead of SCPH when runnning in HE mode (B.Bloch)
        SIPEDFX: Correct wrong pedestals in runs 50118-50122        (B.Bloch) 
        SICLC2,SRFIT0,SRFIT2,SRSELO,SRUPAR : 
                 Double precision fixes for Linux                   (D.Smith)
    
     ! JULIA 309
        SICLEAN: Extend background identification to other types,
                 create and fill SIID  bank                       (B.Bloch)
        SICRPOT: Update pointer to PECO bank in SIID. 
                 All clusters are transmitted                     (B.Bloch)
        SILUMI : Update pointer to SILU bank in SIID. Only valid
                 clusters are considered to build the SILU bank   (B.Bloch)
        SICLUS : Move call to SICLEAN to the end                  (B.Bloch)
    
     * corr file 308.3
        SIPEDFX: New - Fix pedestal of specific runs          (B.Bloch)
        SIPREDA: Call SIPEDFX to fix pedestal problem if any  (B. Bloch)
    
     * corr file 307.2
        SICLEAN: NEW. Checks for quality flag of SiCAL cluster     (B.Bloch)
        SICLUS : Extend LMAXL to 400, 
                 Compute quality flag for each cluster             (B.Bloch)
        SICRPOT: Exclude from PECO/PCRL clusters identified as
                 electronic noise                                  (B.Bloch)
        SIINIRU: Load SNOI bank from database                      (B.Bloch)
        SILUMI : Skip identified electronic noise                  (B.Bloch)
        SIPREDA: Apply bunch dependent calibration also after 1997 (B.Bloch)
    
     * corr file 305.4
        SICREC : Skip if setup code is zero (< 9209)                   (M.Cattaneo)
    
     * corr file 305.2
        SIINIRU: Suppress error message for missing SECT when setup<7  (M.Cattaneo)
    
     * corr file 305.1
        SICAOK : use XLUMOK from alephlib (>306) for complete checks   (B.Bloch)
    
     ! JULIA 305
        SIBUN.H: New common block                                      (B.Bloch)
        SICLUS : In 1997 correct for time dependent gain if not 
                 already done in SIPREDA                               (B.Bloch)
        SIINIRU: Load SECT bank                                        (B.Bloch)
        SIPREDA: Apply a bunch dependant calibration for delayed 
                 timimg in 1997                                        (B.Bloch)
        SILHCR : Store XTBP,XTCN,X1SC name indices locally          (M.Cattaneo)
        STMASK,STRIGF : Deleted from Julia library. Identical routines
                        exist in Alephlib                           (M.Cattaneo)
    
     ! JULIA 304
        SIINIRU,SIINIJO : Move booking of SSTA internal bank from siiniru to
                          siinijo, to avoid problems when processing multiple
                          runs with different bunch train setups.   (M.Cattaneo)
    
     * corr file 302.2
        SIPREDA : Apply bunch train correction only to 1995 data (B.Bloch)
    
     * corr file 281.3
       SILUMI : Fix energy cuts for high energy data (B.Bloch 11-Jul-96)
    
     * corr file 281.2
       SILUMI : Add protection for new acceptance cuts (M.Cattaneo 30-Jun-96)
    
     ! JULIA 280
       SICLUS,SIPREDA : opening "'" should have a closing "'" within
               the same line for cvs (F. Ranjard, Feb 96)
    
     * corr file 279.1
       ALGTWA : fix number of wagons for some fills (B. Bloch, Nov 95)
     ! JULIA 279
       SILUAD : automatise the energy dependence of the Lumi x-section
               (B. Bloch, Nov 95)
       SIEVST : pick up a better curve from the Data Base if available
               (E. Lancon, Nov 95)
       SIINIRU: get SHLD bank from Data Base (B. Bloch, Nov 95)
       SHLDJJ : new comdeck added (B. Bloch, Nov 95)
    
     * corr file 278.2
       SICAL modifications for the high energy run and 95 reprocessing
       SECAJJ, SIBXJJ : new comdecks added (B. Bloch, Nov 95)
       SIEVST : new routine: returns the energy at a given time along
               the Hold timing curve (E. Lancon, Nov 95)
       SIJUKE : new routine: decode juke box configuration (E. Lancon,
               Nov 95)
       SIGTWA : decode SICAL Hold number from SILH or SCHU bank (B. Bloch,
               Nov 95)
       ALGTWA : for the 140 Gev , SICAL will be set with one Hold except
               for 4 runs (B. Bloch, Nov 95)
       SIINIRU: get from Data base SECB and SIBX banks (B. Bloch, Nov 95)
       SILUMI : in Lumi anlysis of 1995 consider only in-time clusters
               (B. Bloch, Nov 95)
       SIPREDA: correct energy of SICAL in physics triggers according to
               bunch number (B. Bloch, Nov 95)
     ! JULIA 278
       ALGTWA : The 95 scan is done with 3 wagons (B.Bloch, P.Comas, Aug 95)
    
     * corr file 277.2
       ALGTWA : integer function to get the number of Sical wagons per train
       SIINIRU: use ALGTWA instead of RQBUNC
       SIPRLUM: use ALGTWA instead of RQBUNC
       SILUAD : fix the statistical error on Lumi when bunch train operation
     ! JULIA 277
    
     * corr file 276.1
       SIPREDA: Allow reprocessing from POT to POT when SIDI not available
                apply overall energy scale factor in calibration mode only
       SILHCR : Allow reprocessing from POT to POT
       SILUMI : Allow reprocessing from POT to POT
       SINAMC : add SCHU namindex to common
       SIGTWA : integer function to get the current wagon number in the train
       SIINIRU: Extend length of SLUM for maximum number of bunches
       SIINIJO: Extend Statistics info to maximum number of bunches
       SILHCR : Append wagon info as 15th word in SILH
       SILUAD : Modification for Bunch train running
       SILUMI : Modification for Bunch train running
       SINAMX : Modification for Bunch train bank
       SIPRLUM: Print Luminosity summary per wagon in the train
       SIPRSUM: Print reconstruction summary per wagon in the train
       SISTAT : Cumulate reconstruction statistics per wagon in the train
     ! JULIA 276
    
     * corr file 275.4
       SIPREDA: Process next pad in case of 'Invalid SIDI Address' (B.Bloch,
               Feb 1995)
     ! JULIA 275
    
     ! JULIA 274
     * corr file 273.3
       SILUAD : Take into account the downscaling factor of the coincidence
                trigger when computing the preliminary Luminosity
     * corr file 273.1
       SICAOK: fix usage of new trigger banks X1RG, X1TT, X1HI
       SILHCR: adapt to new trigger banks
     ! JULIA 273
    
     * corr file 272.3
       SICLUS: apply new cluster correction instead of old one.
       SILUMI: use planes 3 and 4 for loose side selection as for tight side
       SICLC2: new routine
     ! JULIA 272
    
     * corr file 271.4
       SIPVOI : array of energies in 9 pads in 5 first layers.
     * corr file 271.1
       SILHCR : Keep integrated SICAL scalers content in SILH
       SILUMI : Make Luminosity energy cuts depend upon CMS energy
       SIBOOK : HBPRO was called with a wrong number of arguments
    
  <<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<
     SABOOK     Book satr histograms
     SACOCR     Create saco bank
     SACOPR     Print the saco bank
     SAHIST     Fill satr histograms
     SATREC     Top level satr reconstruction
     SCLUPR     Print the sclu bank
     SCOOPR     Print the scoo bank
     SFTRPR     Print the sftr bank
     SIBKPR     Print scal output banks
     SIBOOK     Sical histograms booking
     SICAOK     Checks hv bits and trigger enabled for sical analysis
     SICLC2     Cluster position correction in sical
     SICLCO     Cluster position correction in sical
     SICLEAN    Checks for quality flag of cluster
     SICLUS     Clustering in scal
     SICREC     Sical reconstruction
     SICRPOT    Sical create pot banks
     SICRUN     Sical run summary
     SIDAMP     Expand addresses of a dead amplex of address iad into npa addresse
     SIDCOR     Returns dead pad missing energy in cluster (sandwich method)
     SIDSUM     For pad # idead compute energy sums in cluster iclu from pads
     SIDVOI     Looks for dead neighbors in sical in 5(r) x 3 (phi) around  ipad
     SIECOR     For cluster # iclu in bank scls returns the calibration corrected
     SIEPCR     Return sical pad energy with all corrections
     SIESUM     For cluster # iclu in bank scls returns the cluster energy as
     SIEVST     Sical returns the energy at a given time along the hold timing
     SIGACO     Return pad energy corrected for calibration
     SIGTDP     Get dead pad information from the header (sdpd and skpd banks)
     SIGTWA     Get wagon number from whatever reliable source of information
     SIHIST     Fill scal histograms
     SIINIJO    Sical job initialisation
     SIINIRU    Sical run initialisation
     SIJUKE     Sical decode juke box configuration
     SILHCR     Create and fill the silh banks
     SILIST     Check if address iad is among first nrow rows of bank spda
     SILSUM     Build energy sums in roads of 2 phi pad width for 3 radius bins
     SILUAD     Fill bank silum by increasing counts in requested row im ,col icut
     SILUMI     Apply lumi cuts and compute luminosity in sical
     SILVOI     Build list of neighbours used in energy sums for luminosity cuts
     SINAMX     Set scal name indices
     SINIJO     Initialise the satr job
     SINIRU     Initialise the satr run
     SIPEDFX    Sical fix pedestal of specific runs
     SIPHMOD    Return sical final 'ad hoc' phi correction , including a possible
     SIPREDA    Sical prepare data
     SIPRLUM    Sical lumi  summary
     SIPRSUM    Sical job summary
     SIPSUM     For cluster # iclu in bank scls returns the cluster phi index
     SIPVOI     For pad indices ir,ip,im find array of 9 pads in first 5 layers
     SISLOWC    Handle slow control records for sical
     SISOL2     Solve equation a x**2 + b x + c = 0
     SISTAT     Sical accumulate job statistics
     SISWAP     Unswap some cables for runs before 14780
     SIVOIS     Looks for neighboors in sical
     SKANPR     Print the skan bank
     SPATPR     Print the spat bank
     SPREDA     Prepare satr data
     SPREMC     Preprocess mc events
     SPRPOT     Create satr pot banks
     SPRSUM     Print satr job statistics
     SR2CLU     Find clusters of 2 fired wires
     SR2PAT     Find patches of clusters
     SR3CLU     Find clusters of 3 fired wires
     SR3PAT     Find patches of clusters
     SRADDR     Fill address buffer for zone finding
     SRALIG     Perform satr alignment correction
     SRBFTR     Build the sftr bank
     SRBTRK     Build the strk bank
     SRCCOP     Copy polygon 1 to polygon 2
     SRCLIP     Clip polygon at straight line
     SRCLUS     Find clusters of fired wires
     SRCONS     Fill satr constants common block
     SRCOOR     Calculate satr coordinates
     SRCPAT     Find intersection between two polygons
     SRCUTS     Fill satr reconstruction cuts common
     SRDBLE     Try double arm fit
     SRDEAD     Simulate broken satr channels
     SRDIST     Find distance track-wire
     SRDPHB     Phi correction due to magnetic field
     SRDTRK     Compute distance between track cand.
     SREALD     Apply corrections to real data
     SRFHIS     Fit straight line to histogram
     SRFIT0     Perform straight line fit
     SRFIT2     Perform double arm straight line fit
     SRFITF     Perform track fit
     SRFLTR     Fill track cand. in track bank
     SRFTRK     Find satr tracks
     SRGEOM     Fill satr geometry common block
     SRIHIS     Interpolation in histogram
     SRINBS     Satr bank name indices
     SRINTS     Get intersection point
     SRKAND     Find track candidates
     SRLVAL     Check validity of point
     SRMSTR     Calculate a minimal spanning tree
     SRPATC     Find patches of clusters
     SRPRCN     Print the constants for this run
     SRSEL2     Select double arm fitted tracks
     SRSELK     Select track candidates
     SRSELO     Select objects
     SRSTAT     Print satr event reconstr. summary, fill statistics array
     SRSUBS     Is iarr subset of ex. patch?
     SRTDCN     Calculate electronics address of coordinate
     SRTDCR     Create raw data srtd from coordinates scoo
     SRTRCK     Find satr tracks
     SRUNCO     Compute track params not corrected for misalignment
     SRUPAR     For sides without tracks,
     SRUPAT     Find parameters of patches
     SRWIRE     Calculate wire and sector numbers
     SRWPA2     Pattern recognition for double arm fit
     SRWPAR     Find wire paralleles corresponding to patches
     SSCPCR     Create the sscp bank
     SSLOWC     Handle slow control for satr
     STRKPR     Print the strk bank
     SUPAPR     Print the supa bank
     SWP2PR     Print the swpa bank after double arm pattern recognition
     SWPAPR     Print the swpa bank

3 SABOOK
         SUBROUTINE SABOOK
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Book satr histograms
   
       Author:     H. Meinhard       09-Oct-1987
       Modified:   H. Meinhard       04-Jul-1989  (2)
   
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   RBKHIS                                                                          
        |---- SABOOK                                                               
                   |----  JHISRF                              External             
                   |----  HBOOK1                              External             
                   |----  HBOOK2                              External             
   
 
3 SACOCR
         SUBROUTINE SACOCR(IER)
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Create saco bank
   
       Author:     H. Meinhard       31-Jan-1990
   
       Output:     - IER       /I    error flag
                                     1 = no input bank found
                                     2 = no space for new bank
   
       Description
       ===========
       Create the SACO bank which is mapped 1 : 1 to the coordinates
       bank SCOO
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   SATREC                                                                          
        |---- SACOCR                                                               
                   |----  IBITS                               External             
                   |----  MOD                                 External             
                   |----  PHIBSG                              External             
                   |----  FLOAT                               External             
                   |----  AUBOS                               External             
                   |----  REAL                                External             
                   |----  XYANSA                              External             
                   |----  YZANSA                              External             
                   |----  SIN                                 External             
                   |----  COS                                 External             
                   |----  RERROR                                                   
   
 
3 SACOPR
         SUBROUTINE SACOPR(LUN)
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Print the saco bank
   
       Author:     H. Meinhard       06-Mar-1990
   
       Input:      - LUN       /I    logical unit for printout
                   - bank 'SACO'
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   SATREC                                                                          
        |---- SACOPR                                                               
                   |----  MOD                                 External             
   
 
3 SAHIST
         SUBROUTINE SAHIST
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Fill satr histograms
   
       Author:     H. Meinhard       08-Oct-1987
       Modified:   H. Meinhard       08-Oct-1989  (3)
   
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   RHSEVT                                                                          
        |---- SAHIST                                                               
                   |----  IBITS                               External             
                   |----  MOD                                 External             
                   |----  PHIBSG                              External             
                   |----  FLOAT                               External             
                   |----  HFILL                               External             
                   |----  REAL                                External             
                   |----  SRUNCO                                                   
                   |----  TAN                                 External             
                   |----  COS                                 External             
                   |----  SIN                                 External             
                   |----  PROB                                External             
                   |----  ABS                                 External             
   
 
3 SATREC
         SUBROUTINE SATREC(MODE,LCHCK)
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Top level satr reconstruction
   
       Author:     H. Meinhard       23-Mar-1987
       Modified:   H. Meinhard       24-Apr-1991  (6)
       Modified:   H. Meinhard       31-May-1991  (7)
          Calculate patches if too many wire parallels
   
       Input:      - MODE      /I    reconstruction mode:
                                     0 = normal, try first double, then
                                         single arm fits
                                     1 = double arm fits excluded
                                     2 = double arm fits only
                   - LCHCK     /L    .TRUE. = trigger and LCAL informa-
                                         tion should be checked before
                                         SATR reconstruction
                                     .FALSE. = no checks, try SATR re-
                                         construction in any case
       Created:    - banks 'SCOO' 'SFTR' 'STCP'
                     all other banks which were created in subroutines
                     called from SATREC are dropped at the end of SATREC
   
       Description
       ===========
       Steering routine for SATR event reconstruction: Find tracks from
       SATR coordinates
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   RECEVT                                                                          
        |---- SATREC                                                               
                   |----  NAMIND                              External             
                   |----  RTRIGF                                                   
                   |----  SRDPHB                                                   
                   |----  SRCLUS                                                   
                   |----  SCLUPR                                                   
                   |----  SRPATC                                                   
                   |----  SPATPR                                                   
                   |----  SACOCR                                                   
                   |----  SACOPR                                                   
                   |----  SRWPA2                                                   
                   |----  SWP2PR                                                   
                   |----  SRDBLE                                                   
                   |----  SFTRPR                                                   
                   |----  SRSEL2                                                   
                   |----  SRWPAR                                                   
                   |----  SWPAPR                                                   
                   |----  SRKAND                                                   
                   |----  SRTRCK                                                   
                   |----  SRUPAT                                                   
                   |----  SRBTRK                                                   
                   |----  SRALIG                                                   
                   |----  STRKPR                                                   
                   |----  SRBFTR                                                   
                   |----  SRSTAT                                                   
                   |----  BDROP                               External             
   
 
3 SCLUPR
         SUBROUTINE SCLUPR(LUN)
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Print the sclu bank
   
       Author:     H. Meinhard       06-Jan-1988
   
       Input:      - LUN       /I    logical unit for output
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   SATREC                                                                          
        |---- SCLUPR.                                                              
   
 
3 SCOOPR
         SUBROUTINE SCOOPR(LUN)
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Print the scoo bank
   
       Author:     H. Meinhard       10-Feb-1988
       Modified:   H. Meinhard       09-Oct-1989  (4)
   
       Input:      - LUN       / I   logical unit for output
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   SPREDA                                                                          
   SRTDCR                                                                          
        |---- SCOOPR                                                               
                   |----  IBITS                               External             
                   |----  MOD                                 External             
                   |----  PHIBSG                              External             
                   |----  FLOAT                               External             
   
 
3 SFTRPR
         SUBROUTINE SFTRPR(LUN)
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Print the sftr bank
   
       Author:     H. Meinhard       05-Mar-1990
   
       Input:      - LUN       /I    logical unit for printout
                   - banks 'SFTR','STCP'
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   SATREC                                                                          
        |---- SFTRPR                                                               
                   |----  MOD                                 External             
                   |----  PROB                                External             
   
 
3 SIBKPR
         SUBROUTINE SIBKPR
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Print scal output banks
   
      Author   : B.Bloch-Devaux 910129
   
        Input  :
                 'SPDA',SCLS'
   
        Description :
        ===========
        Print Scal banks in nice "graphics" format
        IF level 4 THEN
           Dump all output banks
        IF level 3 THEN
           Print cluster storeys
        IF level 2 THEN
           Print a line per cluster over threshold
        IF level 1 THEN
           Print number of clusters and total energy
           Print SILH and SILU banks
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   SICREC                                                                          
        |---- SIBKPR                                                               
                   |----  PRTABL                              External             
                   |----  WBANK                               External             
                   |----  VZERO                               External             
                   |----  SIDCOZ                              External             
                   |----  INT                                 External             
                   |----  WDROP                               External             
   
 
3 SIBOOK
         SUBROUTINE SIBOOK
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Sical histograms booking
   
      Book Scal histograms
   
      Author   : B.Bloch-Devaux 911029
      Book Sical histos in JULIA
   
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   RBKHIS                                                                          
        |---- SIBOOK                                                               
                   |----  HBOOK1                              External             
                   |----  HBOOK2                              External             
                   |----  HBPRO                               External             
   
 
3 SICAOK
         LOGICAL FUNCTION SICAOK(KRUN)
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Checks hv bits and trigger enabled for sical analysis
   
   
       Author:     B. Bloch-Devaux   11-May-1993
             Check X1RG if XTOP missing - April 29 , 1994
                   B. Bloch-Devaux  November 97
             use XLUMOK from alephlib for complete checks
                   B. Bloch-Devaux  March 2K
             use XLUM2K from alephlib for year >= 2000
   
       Input:      - KRUN : current Run number
   
       Output:     SICAOK is TRUE if all conditions ok
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   SILUMI                                                                          
        |---- SICAOK                                                               
                   |----  GTSTUP                              External             
                   |----  XLUM2K                              External             
   
 
3 SICLC2
         SUBROUTINE SICLC2(RACLU,PHCLU,DRA,DPH,RACOR,PHCOR)
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Cluster position correction in sical
   
      Author   :         Bertrand VALLAGE, adapted from SICLCO 25-01-94
      Modified :         D.Smith 991027 Double precision fixes for Linux
   
      Inputs:  SiCAL shower cluster radial and phi positions
               raclu = Cluster radius as from barycenter method
               phclu = Cluster Phi postion as from barycenter method
   
      Outputs: Returns positions corrected for pad curvature and
               barycenter algorithm,racor and phcor.
   
      Warning : Raclu, racor, phclu, phcor are in a referential
                perfectly centered assuming SiCAL theoretical geometry
                (assumed to get these corrections)
   
      Description: Position relative to pad's lowest edge is used
      ===========  to calculate corrections using periodic function
                   with phase shift. The abberation due to pad curvature
                   is corrected in R using 1/R**2 variation of the effect
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   SICLUS                                                                          
        |---- SICLC2                                                               
                   |----  DBLE                                External             
                   |----  DSIN                                External             
                   |----  DTANH                               External             
                   |----  REAL                                External             
                   |----  DMOD                                External             
   
 
3 SICLCO
         SUBROUTINE SICLCO(RACLU,PHCLU,ZCLU,IRD,IPH,IST)
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Cluster position correction in sical
   
      Author   :         John Rander-B.Bloch               27-JAN-1992
   
      Inputs:  SiCAL shower cluster radial and phi positions
               RACLU = Cluster radius as from barycenter method
               PHCLU = Cluster Phi postion as from barycenter method
               ZCLU  = Cluster z   postion as from barycenter method
   
      Outputs: Returns positions corrected for pad curvature and
               barycenter algorithm,RACLU and PHCLU.
               IRD,IPH,IST indices of correponding R , Phi , z bins
   
      Description: Position relative to pad's lowest edge is used
      ===========  to calculate corrections using periodic function
                   with phase shift. The abberation due to pad curvature
                   is corrected in R using 1/R**2 variation of the effect
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
              SICLCO                                                               
                   |----  NAMIND                              External             
                   |----  SIXTOI                              External             
                   |----  SIN                                 External             
   
 
3 SICLEAN
         SUBROUTINE SICLEAN(kcl,iflag)
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Checks for quality flag of cluster
   
   
       Author:     B. Bloch-Devaux   June 1998
                   modified April 99 to extend to more backgrounds types
                   modified March 2000 to use Alephlib routine SIBKCL
   
       Input:      - kcl = cluster number in SCLS, if 0 = initialisation
                   _ banks 'SCLS' from Sical clusters
       Output:
                   - iflag quality flag 0 = OK,1= oscillating,2= beam loss
                                        3=backwards,4=scraping,5=offmom
                   - creates bank SIID with flag and pointer to SCLS
                     pointers to SILU and PECO are filled later in
                     SILUMI and SICRPOT
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   SICLUS                                                                          
   SILUMI                                                                          
        |---- SICLEAN                                                              
                   |----  VZERO                               External             
                   |----  AUBOS                               External             
                   |----  SIBKCL                              External             
                   |----  IFCLU                               External             
   
 
3 SICLUS
         SUBROUTINE SICLUS
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Clustering in scal
   
      Author   : John Rander and B.Bloch-Devaux 911029
                 modified 27/10/97  B.Bloch for time dependent calib
                 modified 03/06/98  B.Bloch extend LMAXL to 400, compute
                 quality flag for each cluster
   
      Input : 'SPDA'
      Ouput : 'SCLS','SMAP'
   
      Description:
      ===========
        A cluster consists of Pads
        A pad can join a cluster if it contains energy larger than low
        threshold and sharing a common side, edge or corner with another
        such pad in the cluster.
        A cluster must include at least one pad above high threshold.
        Finally the clusters below a cluster energy threshold
        are suppressed.
        Create a pad map SMAP:
           IW(KSMAP + LMHLEN + pad_address) = SPDA row number
        DO for all pad_data
           IF the pad is not already used
           THEN apply high threshold condition on pad
                Initialise attributes of a cluster
                Fill pad_data,cluster relations
                DO for all neighbour pads
                   IF the pad may join the cluster
                   THEN update cluster attributes
                        Fill pad_data,cluster relations
                        Start a new loop over neighbours
                   ENDIF
                ENDDO
                Resume parent loop, if not finished
           ENDIF
        ENDDO
        Create SCLS
        Apply an energy cut on each cluster
        Rewrite Pad_data,cluster relation
        Normalise cluster attributes
        Correct Cluster quantities for Dead pads if any
        Compute partial energy sums for assymetries
        From 1997 correct for time dependent gain if not already done in SIPREDA
        Copy cluster attributes into SCLS
        compute quality flag for each cluster
        Shrink SCLS to actual size
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   SICREC                                                                          
        |---- SICLUS                                                               
                   |----  NDROP                               External             
                   |----  VZERO                               External             
                   |----  AUBOS                               External             
                   |----  BLIST                               External             
                   |----  SIENCZ                              External             
                   |----  SIITOR                              External             
                   |----  MOD                                 External             
                   |----  SIVOIS                                                   
                   |----  SIDCOZ                              External             
                   |----  ABS                                 External             
                   |----  SIXTOI                              External             
                   |----  SIDVOI                                                   
                   |----  SIDSUM                                                   
                   |----  SIDCOR                                                   
                   |----  GTSTUP                              External             
                   |----  DRACL                               External             
                   |----  SIPHMOD                                                  
                   |----  ATAN                                External             
                   |----  SIXTOL                              External             
                   |----  SICLC2                                                   
                   |----  SILTOX                              External             
                   |----  SIESUM                                                   
                   |----  SILVOI                                                   
                   |----  SILSUM                                                   
                   |----  SICLEAN                                                  
   
 
3 SICREC
         SUBROUTINE SICREC
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Sical reconstruction
   
    Author   : B. Bloch-Devaux 911029 ,930215
    Modified : M.Cattaneo      980226  Skip if setup code is zero (< 9209)
   
      Description:
      ============
      Call prepare luminosity routine  SILHCR
      Call clustering routine          SICLUS
      Call debug routine on request    SIBKPR
      Call Luminosity routine          SILUMI
      Call statistics routine          SISTAT
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   RECEVT                                                                          
        |---- SICREC                                                               
                   |----  GTSTUP                              External             
                   |----  SILHCR                                                   
                   |----  SICLUS                                                   
                   |----  SILUMI                                                   
                   |----  SIBKPR                                                   
                   |----  SISTATCONTINUE                      External             
   
 
3 SICRPOT
         SUBROUTINE SICRPOT
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Sical create pot banks
   
      Author   :- B. Bloch          18-SEP-1992
      modified B. Bloch  June 98 : exclude clusters identified as
                                   electronic noise
                         April 99 : rather keep all identified backgrounds
   
      Add SICAL cluster info to PECO/PCRL/PCOB  banks
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   RDEFPO                                                                          
        |---- SICRPOT                                                              
                   |----  NAMIND                              External             
                   |----  BDROP                               External             
                   |----  AUBOS                               External             
                   |----  PRTABL                              External             
   
 
3 SICRUN
         SUBROUTINE SICRUN
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Sical run summary
   
      Author   :- B. Bloch                     8-NOV-1991
   
      Print Luminosity summary
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   RCLRUN                                                                          
        |---- SICRUN                                                               
                   |----  SIPRLUMRETURN                       External             
   
 
3 SIDAMP
         SUBROUTINE SIDAMP(IAD,IADEX,NPA)
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   
   Expand addresses of a dead amplex of address iad into npa addresse
   
     AUTHOR  :  B. Bloch-Devaux   june 1992
   
       INPUT  : IAD  address of AMPLEX (14 bits ) +Amplex bit
       OUTPUT : IADEX array of expanded addresses ( 14 bits)
                NPA   size of array
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   SIGTDP                                                                          
        |---- SIDAMP.                                                              
   
 
3 SIDCOR
         REAL FUNCTION SIDCOR(ISTAK,ESUM)
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Returns dead pad missing energy in cluster (sandwich method)
   
      Author   :  B.Vallage June 93
   
      Inputs:    Dead Pad layer number ISTAK
      Outputs:   Dead Pad energy SIDCOR
      Description   Function to determine the energy of a known dead pad
      ===========   within a cluster from an exprapolation using the
                    shower shape.
                    In each of the 12 layers , a parabolic fit has been
                    established giving the Energy sum ( over 3 Phi bin )
                    in an R bin , from the corresponding Energy sums in
                    the preceeding and following layers.
     If ESUM(1) is the energy sum in previous layer ,ESUM(3) in the next
     one , and A the Asysymetry variable
               (ESUM(1)-ESUM(3))/(ESUM(1)+ESUM(3))
     then :
     ESUM(2)/(ESUM(1)+ESUM(3)) = a . A**2  + b . A  + c
         where a,b,c depends on the layer #
     SIDCOR is the missing contribution to ESUM(2)
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   SICLUS                                                                          
        |---- SIDCOR                                                               
                   |----  NAMIND                              External             
   
 
3 SIDSUM
         SUBROUTINE SIDSUM(ICLU,IDEAD,ESUM)
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   For pad # idead compute energy sums in cluster iclu from pads
    IPH-1 to IPH+1 which has the same IR , in layers IZ-1 ,IZ and IZ+1
    B. Bloch -Devaux  June  93
    Structure : SUBROUTINE
             External references:NAMIND
             Comdecks references:BCS,BMACRO,SPDAJJ,SCLSJJ
    Input : ICLU cluster number to be corrected
            IDEAD pad address
    Output : ESUM(3)  sums over 3 phi pads width in 3 z layers
    Banks  : input  - SPDA ,SMAP
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   SICLUS                                                                          
        |---- SIDSUM                                                               
                   |----  NAMIND                              External             
                   |----  VZERO                               External             
                   |----  SIDCOZ                              External             
                   |----  SIENCZ                              External             
   
 
3 SIDVOI
         SUBROUTINE SIDVOI(ICLU,IMC,IRC,JPC,KDEAD,IZDEA,NDEAD)
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Looks for dead neighbors in sical in 5(r) x 3 (phi) around  ipad
      in any z plane
     Author   :  B.Bloch-Devaux June 93
   
     Inputs:    Cluster number in SCLS : ICLU
                 SiCAL pad address IMC  Module
                                   IRC  Radial bin
                                   JPC  Phi    bin
     Outputs:   Neighboring pad addresses
                KDEAD          array of dead neighbor addresses
                               coded  as for extended raw data (14 BITS)
                IZDEA          array of dead neighbor z planes
                NDEAD          number of neighboring dead pads
   
          Pad addresses are given by stack number, phi bin and radial bin
                                    I: 1 to 12    J: 1 to 32   K: 1 to 16
                 and module number M: 1 = A side, 2= B side
      Description   Routine used in dead pad energy correction
      ===========
         Neighboring pads are defined as :
           - Same layer
           - R-2  to R+2
           - Phi-1 to Phi+1
          They must be identified as Dead pads and belong to cluster ICLU
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   SICLUS                                                                          
        |---- SIDVOI                                                               
                   |----  NAMIND                              External             
                   |----  VZERO                               External             
                   |----  SIENCZ                              External             
   
 
3 SIECOR
         SUBROUTINE SIECOR(ICLU,ECLU)
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   For cluster # iclu in bank scls returns the calibration corrected
    energy of the cluster
    B. Bloch -Devaux  June 1992  , E. Mannelli Feb 1993
    Structure : SUBROUTINE
             External references:NAMIND
             Comdecks references:BCS,BMACRO,SPDAJJ,SCLSJJ
    Input : ICLU cluster number in SCLS bank
    Output : ECLU cluster energy ( GEV) corrected for calibration
             ECLU = 0. means no update is possible
    Banks  : input  - SCLS,SPDA
    Calls  : SIEPCR to apply gain calibration to pad energies
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
              SIECOR                                                               
                   |----  NAMIND                              External             
                   |----  SIDCOZ                              External             
                   |----  SIEPCR                                                   
   
 
3 SIEPCR
         REAL FUNCTION SIEPCR(RE,MODU,IST,IPH,IRD)
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Return sical pad energy with all corrections
   
       Author E.Mannelli   February 93
       Modified B.Bloch 10/99 introduce Bunch dependent Phi modulation
       Input:  RE   pad energy in GeV
               MODU  Module ( 1 or 2)
               IST  Layer z number ( 1 to 12)
               IPH  Phi bin number ( 1 to 32)
               IRD  Rad bin number ( 1 to 16)
       Output: RE  pad energy in Gev after calibration correction( real)
       BANKS:  SCFD,(SCPH or SCBP) through SIPHMOD and SCAX, SCGA through
               call to SIGACO
       Calls : SIPHMOD,SIGACO
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   SIECOR                                                                          
   SIESUM                                                                          
   SIPREDA                                                                         
        |---- SIEPCR                                                               
                   |----  NAMIND                              External             
                   |----  FLOAT                               External             
                   |----  IABS                                External             
                   |----  ABS                                 External             
                   |----  SIPHMOD                                                  
                   |----  IFIX                                External             
                   |----  SIGACO                                                   
   
 
3 SIESUM
         SUBROUTINE SIESUM(ICLU,ECLU,IFL)
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   For cluster # iclu in bank scls returns the cluster energy as
       IFL =1  sum of pad energies  as in SPDA
       IFL =2  sum of raw energies  as in SPDA
       IFL =3  sum of raw energies  as in SPDA  applying calibration
    B. Bloch -Devaux  February 93
    Structure : SUBROUTINE
             External references:NAMIND
             Comdecks references:BCS,BMACRO,SPDAJJ,SCLSJJ
    Input : ICLU cluster number in SCLS bank
    Output : ECLU cluster energy ( GEV) corrected for calibration
             ECLU = 0. means no update is possible
    Banks  : input  - SCLS,SPDA,SMUX,SGUN
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   SICLUS                                                                          
        |---- SIESUM                                                               
                   |----  SIDCOZ                              External             
                   |----  SIEPCR                                                   
   
 
3 SIEVST
         FUNCTION SIEVST (X)
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Sical returns the energy at a given time along the hold timing
              curve
   
      Author   : E.Lancon   October 1995
      Modified B.Bloch , November 1995 , to get curve from SHLD bank
   
      Description : Compute the energy (GeV) according to the
      ===========   parametrized curve as a function of time x ( ns )
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   SIPREDA                                                                         
        |---- SIEVST                                                               
                   |----  NAMIND                              External             
   
 
3 SIGACO
         REAL FUNCTION SIGACO(IE,IM,IS,IP,IR)
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Return pad energy corrected for calibration
   
       Author B.Bloch-Devaux JUNE 92
       Input:  IE  pad energy in Mev ( integer)
               IM  Module ( 1 or 2)
               IS  Layer z number ( 1 to 12)
               IP  Phi bin number ( 1 to 32)
               IR  Rad bin number ( 1 to 16)
       Output: RE  pad energy in Mev after calibration correction( real)
       BANKS:
          INPUT  : SCAX , SCGA Gain calibration constants
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   SIEPCR                                                                          
        |---- SIGACO                                                               
                   |----  NAMIND                              External             
                   |----  CHAINT                              External             
                   |----  SISOL2                                                   
   
 
3 SIGTDP
         SUBROUTINE SIGTDP
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Get dead pad information from the header (sdpd and skpd banks)
     and create SMPD bank ( Missing pad bank)
   
     AUTHOR  :  B. Bloch-Devaux   june 1992
   
     BANKS:
       INPUT  : SDPD , SKPD
       OUTPUT : SMPD
       CREATED: SMPD
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   SIINIRU                                                                         
        |---- SIGTDP                                                               
                   |----  NDROP                               External             
                   |----  BLIST                               External             
                   |----  NAMIND                              External             
                   |----  ABRUEV                              External             
                   |----  GTSTUP                              External             
                   |----  ALGTDB                              External             
                   |----  JUNIDB                              External             
                   |----  AUBOS                               External             
                   |----  SIDAMP                                                   
                   |----  AUBPRS                              External             
                   |----  SIDCOZ                              External             
   
 
3 SIGTWA
         INTEGER FUNCTION SIGTWA(IDUM)
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Get wagon number from whatever reliable source of information
       This routine should eventually go to the ALEPHLIB
   
     Author : B. Bloch -Devaux  25 October 1994
   
     Input  :  IDUM dummy
               SILH bank
   
     Output :  SIGTWA  = wagon number in the train
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   SILUAD                                                                          
   SILUMI                                                                          
   SIPREDA                                                                         
   SISTAT                                                                          
        |---- SIGTWA                                                               
                   |----  NINT                                External             
                   |----  FLOAT                               External             
                   |----  MAX                                 External             
   
 
3 SIHIST
         SUBROUTINE SIHIST
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Fill scal histograms
   
   
      Author   : B.Bloch-Devaux 911029
   
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   RHSEVT                                                                          
        |---- SIHIST                                                               
                   |----  NAMIND                              External             
                   |----  IAND                                External             
                   |----  FLOAT                               External             
                   |----  HF1                                 External             
                   |----  HFILL                               External             
                   |----  ABS                                 External             
                   |----  COS                                 External             
                   |----  SIN                                 External             
                   |----  CALLHFILL                           External             
   
 
3 SIINIJO
         SUBROUTINE SIINIJO
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Sical job initialisation
   
      Author   : B. Bloch-Devaux 911029
                 Modified for Bunch train mode October 1994
                 Book SSTA bank (moved here from SIINIRU) M.Cattaneo Sept. 97
   
      Description :
      ===========
      Set name indices for Scal banks
      Init Lumi counters
      Reset reconstruction job statistics
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   RINJOB                                                                          
        |---- SIINIJO                                                              
                   |----  SINAMX                                                   
                   |----  VZERO                               External             
                   |----  AUBOS                               External             
                   |----  RERROR                                                   
   
 
3 SIINIRU
         SUBROUTINE SIINIRU
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Sical run initialisation
   
      Author   : B. Bloch-Devaux 911029
                 Modified for Bunch train mode October 1994
                 Modified for Bunch train mode in SCAN 95 October 1995
                 Move booking of SSTA to siinijo. M.Cattaneo September 1997
                 Modified to load SECT bank . B.Bloch November 1997
                 Modified to load SNOI bank . B.Bloch June 1998
                 Suppress error message for SECT when setup<7 M.Cattaneo 12/97
                 Load SCBP instead of SCPH when runnning in HE mode (shifted
                  timing ) B.Bloch 10/99
      Input    : none
      Output   :
                 SREC bank (constants used in cluster reconstruction)
                 SCOR bank (constants for cluster position corrections)
                 SDCO bank (constants for dead pad energy correction)
                 SBHA bank (Cuts for Bhabha event selection)
                 SECA bank (Scal energy calibration)
                 SECT bank (Scal bunch dependent gain corrections )
                 SMPD bank (Scal missing pad list)
                 SNOI bank (definition of electronic noise cluster )
                 SCAX bank ]
                 SCGA bank ] Scal Calibration constants
                 SCPH bank ]
                 SCFD bank ]
                 SIBX bank (constants to define in-time events in SCAN95)
                 SECB bank (bunch energy calibration)
                 SHLD bank (Hold timing curve parameters)
   
      Description :
      ===========
      Read geometry and constant banks from DAF
      Reset lumi statistics bank SLUM
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   RINRUN                                                                          
        |---- SIINIRU                                                              
                   |----  SIRDAF                              External             
                   |----  RERROR                                                   
                   |----  ALGTDB                              External             
                   |----  GTSTUP                              External             
                   |----  SIGTDP                                                   
                   |----  SIPRGO                              External             
                   |----  BDROP                               External             
                   |----  ALGTWA                                                   
                   |----  AUBOS                               External             
   
 
3 SIJUKE
         SUBROUTINE SIJUKE( NWAG,DELAY,DELTA)
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Sical decode juke box configuration
   
      Author   :- E. Lancon    October 1995
      Input    : SRCO bank in Run header
      Output   : NWAG  = number of Hold signals
                 DELAY = delay ( in ns) for the first Hold
                 DELTA = time ( in ns ) between 2 successive Hold's
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   SIPREDA                                                                         
        |---- SIJUKE                                                               
                   |----  NAMIND                              External             
                   |----  CHAINT                              External             
                   |----  IBITS                               External             
   
 
3 SILHCR
         SUBROUTINE SILHCR(IER)
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Create and fill the silh banks
   
       Author:     B. Bloch-Devaux   10-Feb-1993
        Adapt to new trigger banks - April 29 , 1994
        Allow reprocessing POT to POT    October 1994   B. Bloch
                 Modified for Bunch train mode October 1994
       Modified:    M.Cattaneo        06-Nov-1997
        Store XTBP,XTCN,X1SC name indices locally
   
       Input:      - banks 'SIX2'                     from Sical
                           'LOLE'                     from Lcal
                           'XTBP','XTCN','XTOP','X1SC'from Trigger
                           'XTBP','XTCN','X1TT' 'X1HI' from 1994 onwards
                     from data base:
       Output:     - IER       /I    error flag:
                                     0 = no error
                                     1 = no space for new bank
                   - bank  'SILH'
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   SICREC                                                                          
        |---- SILHCR                                                               
                   |----  NAMIND                              External             
                   |----  VZERO                               External             
                   |----  NDROP                               External             
                   |----  AUBOS                               External             
                   |----  LGNGBX                                                   
                   |----  ALTRIG                              External             
                   |----  CHAINT                              External             
                   |----  ISHFT                               External             
                   |----  IAND                                External             
   
 
3 SILIST
         INTEGER FUNCTION SILIST(IAD,NROW)
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Check if address iad is among first nrow rows of bank spda
   
       Author B.Bloch-Devaux JUNE 92
       Input:  IAD pad address ( 14 bits)
               NROW current number of rows to be searched in SPDA
       Return value : SILIST = row number if address exists
                               0 if not found
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   SIPREDA                                                                         
        |---- SILIST.                                                              
   
 
3 SILSUM
         SUBROUTINE SILSUM(NCL,IVOI,ERLUM)
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Build energy sums in roads of 2 phi pad width for 3 radius bins
      and 5  Doublets stacks depth for a given cluster
      Author   : John Rander , B.Bloch-Devaux February 92,February 93
   
      Inputs:    NCL cluster number
                 IVOI array of possible pads to be considered
      Outputs:   ERLUM(5,3) best energy sums over 5 doublet planes
                 for 3 highest radius bins
   
      Description
      ===========
         Sums are done for the two possible roads in each R bin
         over 5 possible doublets of planes
         One keeps the road  which gives the highest doublet sum in the
         central R bin.
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   SICLUS                                                                          
        |---- SILSUM                                                               
                   |----  VZERO                               External             
   
 
3 SILUAD
         REAL FUNCTION SILUAD(IM,ICUT)
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Fill bank silum by increasing counts in requested row im ,col icut
   
   
       Author:     B. Bloch-Devaux   11-May-1993
       Modified:   B. Bloch 18/05/94 take downscale factor into account
                 Modified for Bunch train mode October 1994
                 Modified to take into account energy dependence of the
                 cross-section  November 1995
                 Modified for Miniramp in 2K , March 2K:
      the first rows correspond to events excluding miniramp
      before 2000 next rows are counts per wagon
      in 2000 wagon 1 rows correspond to all events including miniramp
   
       Input:      - IM : method number [1,2]
                   - ICUT :cut number
       Output:
                   - SILUAD =  0.  OK
                   - SILUAD = -1.  Problem?
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   SILUMI                                                                          
        |---- SILUAD                                                               
                   |----  NAMIND                              External             
                   |----  ALGTWA                                                   
                   |----  FLOAT                               External             
                   |----  SIGTWA                                                   
                   |----  XLUMOK                              External             
                   |----  SQRT                                External             
   
 
3 SILUMI
         SUBROUTINE SILUMI
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Apply lumi cuts and compute luminosity in sical
   
   
       Author:     John Rander ,B. Bloch-Devaux   10-Feb-1993
                 Modified for Bunch train mode October 1994
        Allow reprocessing POT to POT    October 1994   B. Bloch
                 modified to select only intime clusters in 95 BB Oct 95
                 modified to skip identified electronic noise  BB June 98
                 and any identified background                 BB April 99
   
       Input:      - banks 'SPDA' ,'SCLS'             from Sical
                     from data base: 'SBHA'  'SIBX' to setup Lumi cuts
       Output:
                   - banks 'SILU' , 'SLUM'
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   SICREC                                                                          
        |---- SILUMI                                                               
                   |----  GTSTUP                              External             
                   |----  NAMIND                              External             
                   |----  MOD                                 External             
                   |----  NDROP                               External             
                   |----  VZERO                               External             
                   |----  SICLEAN                                                  
                   |----  AUBOS                               External             
                   |----  SIFSUM                              External             
                   |----  SIXTOI                              External             
                   |----  COS                                 External             
                   |----  SIN                                 External             
                   |----  SIZFRI                              External             
                   |----  SIGN                                External             
                   |----  ABS                                 External             
                   |----  SIPVOI                                                   
                   |----  SIGTWA                                                   
                   |----  AUBPRS                              External             
                   |----  SICAOK                                                   
                   |----  SILUAD                                                   
                   |----  SIPSUM                                                   
                   |----  IBSET                               External             
   
 
3 SILVOI
         SUBROUTINE SILVOI(IMD,IRD,IPH,IVOIS)
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Build list of neighbours used in energy sums for luminosity cuts
      Author   : John Rander , B.Bloch-Devaux February 92 ,February 93
   
      Inputs:    SiCAL pad subcomponent module(IMD),radius(IRD),phi(IPH)
      Outputs:   Neighbors   pad addresses  for radius IRD-1,IRD,IRD+1
                 for 2 phi roads ( 2 phi pads width)
                 over 5 z planes starting from 1
                 IVOI(3,10,2) array of neighbor addresses
                 coded  as for extended raw data
   
          Pad addresses are given by stack number, phi bin and radial bin
                                    I: 1 to 12    J: 1 to 32   K: 1 to 16
                 and module number M: 1 = A side, 2= B side
      Description
      ===========
         Neighboring pads are defined as :
           - doublets of Phi pads J-1,J for road 1, J,J+1 for road 2
           - z stacks 1, 2, 3 ,4 ,5
           - radial pad I-1,1,I+1 ( within 1-16 range)
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   SICLUS                                                                          
        |---- SILVOI                                                               
                   |----  VZERO                               External             
                   |----  SIENCZ                              External             
   
 
3 SINAMX
         SUBROUTINE SINAMX
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Set scal name indices
   
      Author   : B.Bloch-Devaux 910129
                 Modified for Bunch train mode October 1994
   
      Description : Call NAMIND for all relevant SICAL banks
      ===========
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   SIINIJO                                                                         
        |---- SINAMX                                                               
                   |----  NAMIND                              External             
   
 
3 SINIJO
         SUBROUTINE SINIJO
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Initialise the satr job
   
       Author:     H. Meinhard       16-Aug-1987
       Modified:   H. Meinhard       27-Jul-1988
   
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   RINJOB                                                                          
        |---- SINIJO                                                               
                   |----  SRINBS                                                   
                   |----  VZERO                               External             
   
 
3 SINIRU
         SUBROUTINE SINIRU
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Initialise the satr run
   
       Author:     H. Meinhard       19-Aug-1987
       Modified:   H. Meinhard       12-Jul-1989  (3)
   
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   RINRUN                                                                          
        |---- SINIRU                                                               
                   |----  NAMIND                              External             
                   |----  SRGEOM                                                   
                   |----  SRCONS                                                   
                   |----  SRCUTS                                                   
                   |----  SRPRCN                                                   
   
 
3 SIPEDFX
         SUBROUTINE SIPEDFX(IRUN,IOLD,INEW)
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Sical fix pedestal of specific runs
   
      Author   :- B. Bloch                    28-OCT-1998
                warning : the units are MeV  not ADC counts !!!
     - Input :  IRUN   Run number
                IOLD   current value (in MeV) of ADC channel content
     - Output : INEW   corrected value if required
   
 
3 SIPHMOD
         REAL FUNCTION SIPHMOD(MODU,IPH)
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Return sical final 'ad hoc' phi correction , including a possible
       bunch dependance
   
       Author B.Bloch 10/99
       Input:
               MODU  Module ( 1 or 2)
               IPH  Phi bin number ( 1 to 32)
       Output: correction to be applied
       BANKS:  SCPH or SCBP
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   SICLUS                                                                          
   SIEPCR                                                                          
        |---- SIPHMOD                                                              
                   |----  NAMIND                              External             
                   |----  RW                                  External             
   
 
3 SIPREDA
         SUBROUTINE SIPREDA
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Sical prepare data
   
      Author   :- B. Bloch                     8-NOV-1991
   
       Modified:   B. Bloch 18/10/94
     - Allow to start from existing SPDA bank if SIDI not available
     - Apply overall E-scale factor from SECA in calibration mode only
       Modified:   B. Bloch 24/10/95
     - Apply a bunch dependant calibration for juke box mode in 95
     - apply only (!!) to 95 juke box mode B.Bloch March 97
       Modified:   B. Bloch 27/10/97, june 98
     - Apply a bunch dependant calibration for delayed timimg for 1997 and
       later
     - Call SIPEDFX to fix pedestal problem if any B. Bloch 28/10/98
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   RPREDA                                                                          
        |---- SIPREDA                                                              
                   |----  NAMIND                              External             
                   |----  GTSTUP                              External             
                   |----  SIJUKE                                                   
                   |----  SIEVST                                                   
                   |----  ALBUNCH                             External             
                   |----  NDROP                               External             
                   |----  AUBOS                               External             
                   |----  STRIGF                              External             
                   |----  RQBUNC                              External             
                   |----  SIGTWA                                                   
                   |----  SIDCOD                              External             
                   |----  RERROR                                                   
                   |----  SISWAP                                                   
                   |----  SIPEDFX                                                  
                   |----  FLOAT                               External             
                   |----  SIEPCR                                                   
                   |----  SIENCZ                              External             
                   |----  IBITS                               External             
                   |----  SILIST                                                   
                   |----  SIDCOZ                              External             
                   |----  PRTABL                              External             
   
 
3 SIPRLUM
         SUBROUTINE SIPRLUM
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Sical lumi  summary
   
      Author   :- B. Bloch                     14/02/93
                 Modified for Bunch train mode October 1994 :
                 Print Luminosity summary per wagon in the train
   
     Input:       LUMI COUNTERS COMMON
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
              SIPRLUM                                                              
                   |----  ALGTWA                                                   
   
 
3 SIPRSUM
         SUBROUTINE SIPRSUM
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Sical job summary
   
      Author   :- B. Bloch                     24/08/92
                 Modified for Bunch train mode October 1994 :
                 Print reconstruction summary per wagon in the train
   
     Input:       'SSTA'
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   RSMJOB                                                                          
        |---- SIPRSUM                                                              
                   |----  NAMIND                              External             
   
 
3 SIPSUM
         SUBROUTINE SIPSUM(ICLU,IPHM)
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   For cluster # iclu in bank scls returns the cluster phi index
      which has the maximum energy sum over R bins in the sum of planes
      2 and 5
    B. Bloch -Devaux  April 93
    Structure : SUBROUTINE
             External references:NAMIND
             Comdecks references:BCS,BMACRO,SPDAJJ,SCLSJJ
    Input : ICLU cluster number in SCLS bank
    Output : IPHM     Phi index [1,32] with max enrgy sum over planes 2-5
    Banks  : input  - SCLS,SPDA
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   SILUMI                                                                          
        |---- SIPSUM                                                               
                   |----  VZERO                               External             
                   |----  SIDCOZ                              External             
   
 
3 SIPVOI
         SUBROUTINE SIPVOI(IR,IP,IM,EVOI)
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   For pad indices ir,ip,im find array of 9 pads in first 5 layers
    B. Bloch -Devaux  February 93
    Structure : SUBROUTINE
             Comdecks references:BCS,BMACRO,SPDAJJ,SCLSJJ
    Input : IR,IP,IM radius,phi,module index of pad
    Output : EVOI(45) Array of energies in 9 pads in 5 first layers
             ( with -Epad if pad is not associated to a cluster )
    Banks  : input  - SMAP,SPDA
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   SILUMI                                                                          
        |---- SIPVOI                                                               
                   |----  VZERO                               External             
                   |----  SIENCZ                              External             
   
 
3 SISLOWC
         SUBROUTINE SISLOWC
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Handle slow control records for sical
   
      Author   :- B. Bloch                     8-NOV-1991
   
   
 
3 SISOL2
         SUBROUTINE SISOL2(COE,X1,X2,IOK)
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Solve equation a x**2 + b x + c = 0
   
       Author B.Bloch-Devaux JUNE 92
       Input:  COE(3) coefficients of equation
       Output: X1,X2 solutions
               IOK Status flag      0 = ok 2 solutions
                                    1 = single solution
                                    2 = no solution
   
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   SIGACO                                                                          
        |---- SISOL2                                                               
                   |----  SQRT                                External             
   
 
3 SISTAT
         SUBROUTINE SISTAT
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Sical accumulate job statistics
   
      Author   :- B. Bloch                     24/08/92
                 Modified for Bunch train mode October 1994 :
                 Cumulate statistics per wagon
   
     Input:       'SPDA' , 'SCLS'
   
     Output:      'SSTA'
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
              SISTAT                                                               
                   |----  SIGTWA                                                   
                   |----  IAND                                External             
   
 
3 SISWAP
         INTEGER FUNCTION SISWAP(IMI,ISI,IPI,IRI,IMO,ISO,IPO,IRO)
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Unswap some cables for runs before 14780
     - Unswap some cables for runs in range [ 17537,17618]
   
       Author B.Bloch-Devaux JUNE 92 ,November 92
       Input:  ADDRESS components as module , layer,phi,radius
                                     IMI       ISI  IPI  IRI
       Output  ADDRESS components as module , layer,phi,radius
                                     IMO       ISO  IPO  IRO
       Return value : SISWAP = 1 if swap was done
                               0 if no swap done
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   SIPREDA                                                                         
        |---- SISWAP.                                                              
   
 
3 SIVOIS
         SUBROUTINE SIVOIS(IPAD,KVOIS,NVOIS)
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Looks for neighboors in sical
   
      Author   : John Rander , B.Bloch-Devaux November 91
   
      Inputs:    SiCAL pad address IPAD (coded as below)
      Outputs:   Neighboring pad addresses
                 NVOIS          number of neighboring pads
                 KVOIS          array of neighbor addresses
                 coded  as for extended raw data (14 BITS)
   
      Routine needs SiCAL geometry information defined by SIGEOM
          Pad addresses are given by stack number, phi bin and radial bin
                                    I: 1 to 12    J: 1 to 32   K: 1 to 16
                 and module number M: 1 = A side, 2= B side
   
      Description   Routine used in cluster finding
      ===========
         Neighboring pads are defined as either:
           - Same stack neighbors => there are typically 8 of these
           - Adjacent stack neighbors => there are typically 4 of these
                                         because of phi shifts of stacks
           - Diagonal neighbors on adjacent stacks are ignored
   
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   SICLUS                                                                          
        |---- SIVOIS                                                               
                   |----  SIDCOZ                              External             
                   |----  SIENCZ                              External             
                   |----  ISIGN                               External             
                   |----  IFIX                                External             
   
 
3 SKANPR
         SUBROUTINE SKANPR(LUN)
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Print the skan bank
   
       Author:     H. Meinhard       28-Jan-1988
       Modified:   H. Meinhard       04-Jul-1989  (1)
   
       Input:      - LUN       /I    Logical unit for output
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   SRKAND                                                                          
        |---- SKANPR                                                               
                   |----  PROB                                External             
                   |----  ATAN                                External             
                   |----  SQRT                                External             
                   |----  MOD                                 External             
                   |----  ATAN2                               External             
   
 
3 SPATPR
         SUBROUTINE SPATPR(LUN)
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Print the spat bank
   
       Author:     H. Meinhard       13-Jan-1988
   
       Input:      - LUN       /I    logical unit for output
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   SATREC                                                                          
        |---- SPATPR.                                                              
   
 
3 SPREDA
         SUBROUTINE SPREDA
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Prepare satr data
   
       Author:     H. Meinhard       04-Sep-1987
       Modified:   H. Meinhard       06-Dec-1989  (2)
   
       Description
       ===========
       Steering routine for prepare data of SATR data
       Look whether raw data contain TDC time information; if not,
       generate time information; calculate SATR coordinates from
       raw data
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   RPREDA                                                                          
        |---- SPREDA                                                               
                   |----  BLIST                               External             
                   |----  SREALD                                                   
                   |----  SPREMC                                                   
                   |----  SRCOOR                                                   
                   |----  SCOOPR                                                   
   
 
3 SPREMC
         SUBROUTINE SPREMC(IER)
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Preprocess mc events
   
       Author:     H. Meinhard       04-Sep-1987
       Modified:   H. Meinhard       28-Jun-1989 (3)
   
       Output:     - IER       /I    error flag (.ne. 0 on error)
   
       Description
       ===========
       This routine should be called if there are unprocessed raw data
       (bank SRAD or SADI), but no preprocessed data (bank SRTD). This
       will usually be the case for events from the GALEPH Monte Carlo.
       Create SRTD using pedestals and slopes given by DATA statement
       below.
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   SPREDA                                                                          
        |---- SPREMC                                                               
                   |----  IBITS                               External             
                   |----  MOD                                 External             
                   |----  PHIBSG                              External             
                   |----  FLOAT                               External             
                   |----  AUBOS                               External             
                   |----  INT                                 External             
                   |----  RERROR                                                   
   
 
3 SPRPOT
         SUBROUTINE SPRPOT(IER)
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Create satr pot banks
   
       Author:     H. Meinhard       14-Mar-1989
       Modified:   H. Meinhard       02-Mar-1990  (4)
   
       Input:      - banks SCOO, STCP
       Output:     - banks PSCO, PSPO
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   RDEFPO                                                                          
        |---- SPRPOT                                                               
                   |----  AUBOS                               External             
                   |----  INT                                 External             
                   |----  RERROR                                                   
   
 
3 SPRSUM
         SUBROUTINE SPRSUM
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Print satr job statistics
   
       Author:     H. Meinhard       09-Oct-1987
       Modified:   H. Meinhard       06-Mar-1990  (2)
   
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   RSMJOB                                                                          
        |---- SPRSUM                                                               
                   |----  REAL                                External             
                   |----  NTRKSS                              External             
   
 
3 SR2CLU
         SUBROUTINE SR2CLU(ISIDE,IORIE,IBUFF,ILA1,ILA2,N3TOT,IER)
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Find clusters of 2 fired wires
   
       Author:     H. Meinhard       15-Feb-1988
       Modified:   H. Meinhard       02-Mar-1990  (2)
   
       Input:      - ISIDE     /I    current side [1,2]
                   - IORIE     /I    current orientation [1,3]
                   - IBUFFijk  /I    buffer of addresses of coordinates
                   - ILAi      /I    layers to be looked at in orient.
                   - N3TOT     /I    number of clusters found, without
                                     actual 2-clusters [0,*]
       Output:     - IER       /I    error flag (.ne. 0 on error)
   
       Description
       ===========
       Loop over sectors, within sectors over fired wires of given side
       and orientation, look whether corresponding tubes overlap.
       If yes, check that cluster candidate is no subset of 3-cluster
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   SRCLUS                                                                          
        |---- SR2CLU                                                               
                   |----  FLOAT                               External             
                   |----  MAX                                 External             
                   |----  MIN                                 External             
   
 
3 SR2PAT
         SUBROUTINE SR2PAT(ISIDE,IOR1,IOR2,IOR3,N3TOT,IER)
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Find patches of clusters
   
       Author:     H. Meinhard       12-Jan-1988
       Modified:   H. Meinhard       02-Mar-1990  (2)
   
       Input:      - ISIDE     /I    current side [1,2]
                   - IOR1,2    /I    orientations from which clusters
                                     should be considered [1,3]
                   - IOR3      /I    orientations from which single hits
                                     should be considered [1,3]
                   - N3TOT     /I    number of patches found, without
                                     actual 2-patches [0,*]
       Output:     - IER       /I    error flag (.ne. 0 on error)
   
       Description
       ===========
       Look for patches consisting of two clusters and optionally an
       additional wire hit in the third orientation. Use this patch only
       if it is not a subset of a patch consisting of three clusters.
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   SRPATC                                                                          
        |---- SR2PAT                                                               
                   |----  IBITS                               External             
                   |----  MOD                                 External             
                   |----  PHIBSG                              External             
                   |----  FLOAT                               External             
                   |----  SIN                                 External             
                   |----  COS                                 External             
                   |----  SRCLIP                                                   
                   |----  SRCCOP                                                   
                   |----  INTSOR                              External             
                   |----  SRSUBS                                                   
   
 
3 SR3CLU
         SUBROUTINE SR3CLU(ISIDE,IORIE,IBUFF,IER)
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Find clusters of 3 fired wires
   
       Author:     H. Meinhard       05-Jan-1988
       Modified:   H. Meinhard       02-Mar-1990  (2)
   
       Input:      - ISIDE     /I    current side [1,2]
                   - IORIE     /I    current orientation [1,3]
                   - IBUFFijk  /I    buffer of addresses of coordinates
       Output:     - IER       /I    error flag (.ne. 0 on error)
   
       Description
       ===========
       loop over sectors, within sectors over fired wires of given side
       and orientation, check sector number, look whether corresponding
       tubes overlap
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   SRCLUS                                                                          
        |---- SR3CLU                                                               
                   |----  FLOAT                               External             
                   |----  MAX                                 External             
                   |----  MIN                                 External             
   
 
3 SR3PAT
         SUBROUTINE SR3PAT(ISIDE,IER)
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Find patches of clusters
   
       Author:     H. Meinhard       07-Jan-1988
       Modified:   H. Meinhard       07-Aug-1988
   
       Input:      - ISIDE     /I    current side [1,2]
       Output:     - IER       /I    error flag (.ne. 0 on error)
   
       Description
       ===========
       Loop over clusters in all three orientations and look for
       areas where the clusters overlap. Dead zones due to sector
       borders and gas channels are taken into account.
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   SRPATC                                                                          
        |---- SR3PAT                                                               
                   |----  IBITS                               External             
                   |----  MOD                                 External             
                   |----  PHIBSG                              External             
                   |----  FLOAT                               External             
                   |----  SIN                                 External             
                   |----  COS                                 External             
                   |----  SRCLIP                                                   
                   |----  SRCCOP                                                   
   
 
3 SRADDR
         SUBROUTINE SRADDR(ISIDE,IORIE,IBUFF,IER)
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Fill address buffer for zone finding
   
       Author:     H. Meinhard       04-Jun-1987
       Modified:   H. Meinhard       20-Nov-1989  (2)
   
       Input:        ISIDE       /I      current detector side (1|2)
                     IORIE       /I      current orientation ([1,3])
       Output:       IBUFFijk    /I      Address buffer, see below
                     IER         /I      error flag (.ne. 0 on error)
   
       Description
       ===========
       The addresses of all coordinates belonging to side ISIDE and
       orientation IORIE are filled into an address buffer IBUFFijk,sor-
       ted along the layer i within the orientation ([1,3]) and the sec-
       tor number j ([1,8]). Addresses are stored consecutively in k>1;
       k=1 gives the number of addresses stored for current i,j.
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   SRCLUS                                                                          
        |---- SRADDR                                                               
                   |----  VZERO                               External             
                   |----  RERROR                                                   
   
 
3 SRALIG
         SUBROUTINE SRALIG
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Perform satr alignment correction
   
       Author:     H. Meinhard       06-Apr-1988
       Modified:   H. Meinhard       07-Oct-1989  (2)
   
       Description
       ===========
       For each SATR track and each SATR patch parameter, get theta and
       phi and correct according to the alignment constants. Store new
       parameters.
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   SATREC                                                                          
        |---- SRALIG                                                               
                   |----  PHIBSG                              External             
                   |----  TAN                                 External             
                   |----  MOD                                 External             
                   |----  FLOAT                               External             
                   |----  COS                                 External             
                   |----  SIN                                 External             
                   |----  XYANSA                              External             
                   |----  YZANSA                              External             
                   |----  ZXANSA                              External             
                   |----  ATAN                                External             
                   |----  SQRT                                External             
                   |----  ATAN2                               External             
   
 
3 SRBFTR
         SUBROUTINE SRBFTR(IER)
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Build the sftr bank
   
       Author:     H. Meinhard       02-Mar-1990
       Modified:   H. Meinhard       05-Mar-1990  (1)
   
       Input:      - bank 'STRK'
       Output:     - IER       /I    error flag: 0 = no error
                                                 1 = no space for new bk
                   - bank 'SFTR'
   
       Description
       ===========
       Convert tracks being stored in bank STRK into SFTR format, fill
       SFTR bank
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   SATREC                                                                          
        |---- SRBFTR                                                               
                   |----  REAL                                External             
                   |----  AUBOS                               External             
                   |----  RERROR                                                   
   
 
3 SRBTRK
         SUBROUTINE SRBTRK(IER)
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Build the strk bank
   
       Author:     H. Meinhard       23-Jun-1988
       Modified:   H. Meinhard       03-Jul-1989  (3)
   
       Output:     - IER       /I    error flag, 0 = no error
   
       Description
       ===========
       Build the STRK bank from tracks and patches. Thus all objects
       found during SATR reconstruction are stored in the STRK bank.
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   SATREC                                                                          
        |---- SRBTRK                                                               
                   |----  BKTOW                               External             
                   |----  BDROP                               External             
                   |----  AUBOS                               External             
                   |----  WDROP                               External             
                   |----  WGARB                               External             
                   |----  RERROR                                                   
   
 
3 SRCCOP
         SUBROUTINE SRCCOP(NC1,XC1,YC1,NC2,XC2,YC2)
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Copy polygon 1 to polygon 2
   
       Author:     H. Meinhard       27-Jan-1988
   
       Input:      - NC1       /I    number of corners of old polygon
                                     [3,8]
                   - XC1i,YC1i /F    coordinates of corners of old
                                     polygon [-.1,.1]
       Output:     - NC2       /I    number of corners of new polygon
                                     [3,8]
                   - XC2i,YC2i /F    coordinates of corners of new
                                     polygon [-.1,.1]
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   SR2PAT                                                                          
   SR3PAT                                                                          
   SRWPAR                                                                          
        |---- SRCCOP.                                                              
   
 
3 SRCLIP
         SUBROUTINE SRCLIP(NC,XC,YC,R,PHI,IS)
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Clip polygon at straight line
   
       Author:     H. Meinhard       08-Jan-1988
       Modified:   H. Meinhard       31-May-1989  (2)
   
       Input:      - NC        /I    no of corners of polygon [3,8]
                   - XCi       /F    x-coordinates of corners [-.1,.1]
                   - YCi       /F    y-coordinates of corners [-.1,.1]
                   - R         /F    distance of straight line from
                                     origin [0.,.1]
                   - PHI       /F    azimuth of distance [0.,6.29]
                   - IS        /I    side to suppress [1,2]
                                     1 = beyond origin, 2 = origin incl.
       Output:     - NC        /I    no of corners of clipped pol. [3,8]
                   - XCi       /F    see above
                   - YCi       /F    see above
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   SR2PAT                                                                          
   SR3PAT                                                                          
   SRWPAR                                                                          
        |---- SRCLIP                                                               
                   |----  SRLVAL                                                   
                   |----  SRINTS                                                   
   
 
3 SRCLUS
         SUBROUTINE SRCLUS(IER)
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Find clusters of fired wires
   
       Author:     H. Meinhard       05-Jan-1988
       Modified:   H. Meinhard       06-Feb-1990  (3)
   
       Output:     - IER       /I    error flag (.ne. 0 if error)
   
       Description
       ===========
       For each sector in each orientation, look from the interaction
       point towards the fired wires and search for overlays of fired
       wires consisting of three or two fired wires. Hits in clusters
       with three fired wires are not used for clusters with two fired
       wires
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   SATREC                                                                          
        |---- SRCLUS                                                               
                   |----  SSCPCR                                                   
                   |----  AUBOS                               External             
                   |----  SRADDR                                                   
                   |----  SR3CLU                                                   
                   |----  SR2CLU                                                   
                   |----  AUBPRS                              External             
                   |----  RERROR                                                   
   
 
3 SRCONS
         SUBROUTINE SRCONS
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Fill satr constants common block
   
       Author:     H. Meinhard       19-Aug-1987
       Modified:   H. Meinhard       07-Mar-1991  (6)
       Modified:   H. Meinhard       20-Jun-1991  (7)
                         Get SPED bank from data base, if necessary
   
       Description
       ===========
       Constants describing the SATR are filled into common SCALBC.
       The constants are read from bank SCLB. If a data card SCAU is
       found, try to find the time histogram STHI and calculate a new
       x vs t from that histogram, otherwise take it from the SCLB bank.
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   SINIRU                                                                          
        |---- SRCONS                                                               
                   |----  ALGTDB                              External             
                   |----  NAMIND                              External             
                   |----  SRDEAD                                                   
                   |----  MCRSCTCRASC                         External             
                   |----  REAL                                External             
                   |----  INT                                 External             
                   |----  SORTZV                              External             
                   |----  MINIZE                              External             
                   |----  MAXIZE                              External             
                   |----  SRFHIS                                                   
                   |----  SRIHIS                                                   
                   |----  AUBOS                               External             
                   |----  RERROR                                                   
   
 
3 SRCOOR
         SUBROUTINE SRCOOR(IER)
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Calculate satr coordinates
   
       Author:     H. Meinhard       09-Mar-1987
       Modified:   H. Meinhard       02-May-1991  (5)
          Drop informations from hot channels as given by SHOT
       Modified:   H. Meinhard       31-May-1991  (6)
          Drop TDC signals with TDC overflow
   
       Output:     - IER       /I    error flag, .ne. 0 in case of error
   
       Description
       ===========
       Converts raw data and raw time information to coordinates.
       Raw data and raw time information is read from 'SRTD'
       encode electronics channel from raw data address
       convert electronics channel to wire number
       convert raw time to drift time and drift time to drift distance
       store coordinates in 'SCOO'
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   SPREDA                                                                          
        |---- SRCOOR                                                               
                   |----  IBITS                               External             
                   |----  MOD                                 External             
                   |----  PHIBSG                              External             
                   |----  FLOAT                               External             
                   |----  AUBOS                               External             
                   |----  VZERO                               External             
                   |----  REAL                                External             
                   |----  SRWIRE                                                   
                   |----  SRDIST                                                   
                   |----  AUBPRS                              External             
                   |----  RERROR                                                   
   
 
3 SRCPAT
         SUBROUTINE SRCPAT(NCOR1,XCOR1,NCOR2,XCOR2,NCOR,XCOM)
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Find intersection between two polygons
   
       Author:     H. Meinhard       26-Feb-1990
       Modified:   H. Meinhard       09-Mar-1990  (1)
   
       Input:      - NCOR1     /I    number of corners of 1st polygon
                   - XCOR1ij   /R    coordinate i of corner j of 1st pl.
                   - NCOR2     /I    number of corners of 2nd polygon
                   - XCOR2ij   /R    coordinate i of corner j of 2nd pl.
       Output:     - NCOR      /I    number of corners of itersection
                   - XCOMij    /R    coordinate i of corner j of inters.
   
       Description
       ===========
       Find the intersection between two polygons being defined by the
       number and the coordinates of their corners. The second polygon
       must be convex. NCOR2 must be at most 8 (see parameter
       statement). The routine uses a clipping algorithm (I. E.
       Sutherland, G. W. Hodgman, Communications of the ACM, Vol. 17,
       No. 1, January, 1974).
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   SRWPA2                                                                          
        |---- SRCPAT                                                               
                   |----  VZERO                               External             
                   |----  MOD                                 External             
   
 
3 SRCUTS
         SUBROUTINE SRCUTS
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Fill satr reconstruction cuts common
   
       Author:     H. Meinhard       23-Mar-1987
       Modified:   H. Meinhard       13-Mar-1990  (4)
   
       Description
       ===========
       SATR reconstruction cut parameters are filled into common block
       SRECPC.
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   SINIRU                                                                          
        |---- SRCUTS                                                               
                   |----  ALGTDB                              External             
                   |----  NAMIND                              External             
                   |----  RERROR                                                   
   
 
3 SRDBLE
         SUBROUTINE SRDBLE(IER)
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Try double arm fit
   
       Author:     H. Meinhard       06-Feb-1990
       Modified:   H. Meinhard       08-Mar-1990  (3)
   
       Input:      - bank 'SWPA'
       Output:     - IER       /I    error code:
                                     0 = no error
                                     1 = input bank(s) missing
                                     2 = no space for new bank
                                    -1 = fit unsuccessful
                   - banks 'SFTR','STCP'
   
       Description
       ===========
       For combinations of sets of wire parallels on both
       sides which are selected by subroutine SRWPA2, try to make a
       common fit using fit routine SRFIT2. If the
       fit fails, try to drop one coordinate, and repeat the fit unless
       there are less than five coordinates on one side.
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   SATREC                                                                          
        |---- SRDBLE                                                               
                   |----  AUBOS                               External             
                   |----  VZERO                               External             
                   |----  COMBI                               External             
                   |----  SRFIT2                                                   
                   |----  PROB                                External             
                   |----  MAX                                 External             
                   |----  RVCPY                               External             
                   |----  RMCPY                               External             
                   |----  PROXIM                              External             
                   |----  AUBPRS                              External             
                   |----  RERROR                                                   
   
 
3 SRDEAD
         SUBROUTINE SRDEAD
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Simulate broken satr channels
   
       Author:     H. Meinhard       31-Jul-1989
   
       Description
       ===========
       Decode data cards SBCH, SBCA, SBCR, SBHV, SBST and fill flags with
       dead channel information accordingly
       Format of input banks:
       SBCH crate_nr[1,3] card_nr[0,23] tdc_nr[0,15]
       SBCA crate_nr[1,3] card_nr[0,23]
       SBCR crate_nr[1,3]
       SBHV hv_chan_nr[0,31]
       SBST hv_chan_nr[0,31] hv_string_nr[0,3]
       Several input cards with the same name are allowed and treated in
       sequence.
   
       Modified:   H. Meinhard       08-Jan-1993
       The mechanism implemented herein has never been used. On request
       of Francoise Jacot, this routine is modified into a dummy in order
       not to refer to the banks indicated above. This allows to drop
       the subschema SatrDefects, and to free five bank names.
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   SRCONS                                                                          
        |---- SRDEAD.                                                              
   
 
3 SRDIST
         SUBROUTINE SRDIST(TIME,DIST,IER)
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Find distance track-wire
   
       Author:     H. Meinhard       09-Mar-1987
       Modified:   H. Meinhard       07-Feb-1989
       Modified:   H. Meinhard       20-Jun-1991  (2)
                         Don't touch TIME variable
   
       Input:      - TIME      /R    raw data time
       Output:     - DIST      /R    distance track - wire (in m)
                   - IER       /I    Error flag: 0 = no error,
                                     11 = Drift time or drift dist-
                                     ance out of bounds, no conver-
                                     sion possible
   
       Description
       ===========
       Convert the raw data time to drift time (taking into account the
       common stop mode of TDC's); Time offset TOFFSC is stored in
       common block SCALBC
       Convert drift time to drift distance by linear interpolation
       between two corresponding points of distance-drifttime-relation;
       relation is stored in SCALBC
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   SRCOOR                                                                          
        |---- SRDIST                                                               
                   |----  REAL                                External             
                   |----  INT                                 External             
                   |----  FLOAT                               External             
                   |----  TSPASC                              External             
   
 
3 SRDPHB
         SUBROUTINE SRDPHB
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Phi correction due to magnetic field
   
       Author:     H. Meinhard       05-Mar-1990
       Modified:   J. Knobloch       03-Jul-1990
   
       Input:      - FIELRC,ENERRC from COMMON /RCONDS/
   
       Output:     - DPHBSR in COMMON /SRECPC/
   
       Description
       ===========
       Calculate correction factor to azimuth angles due to the ALEPH
       magnetic field assuming beam energy for the electrons. Beam energy
       is taken from RCONDS
       In order to obtain the actual azimuth correction, DPHBSR must be
       multiplied with the actual z position.
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   SATREC                                                                          
        |---- SRDPHB.                                                              
   
 
3 SRDTRK
         SUBROUTINE SRDTRK(ISTAR,NTRK,DM)
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Compute distance between track cand.
   
       Author:     H. Meinhard       21-Mar-1987
       Modified:   H. Meinhard       02-Mar-1988
   
       Input:        - ISTAR       /I    number of first track candidate
                                         to be considered
                     - NTRK        /I    number of track candidates to
                                         be considered
       Output:       - DMij        /R    distance matrix
   
       Description
       ===========
       For each pair of track candidates concerned, consider the
       geometrical distance between the tracks and divide it by
       its own error found by error propagation from the covariance
       matrices of the fits.
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   SRSELO                                                                          
        |---- SRDTRK                                                               
                   |----  COS                                 External             
                   |----  SIN                                 External             
                   |----  MAX                                 External             
                   |----  SQRT                                External             
   
 
3 SREALD
         SUBROUTINE SREALD(IER)
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Apply corrections to real data
   
       Author:     H. Meinhard       12-Oct-1989
       Modified:   H. Meinhard       06-Dec-1989
       Modified:   H. Meinhard       20-Jun-1991
                   recalculate TDC times for runs 11494 ... 11592
       Modified:   H. Meinhard       02-Jul-1991
                   recalculate TDC times correctly
       Modified:   H. Meinhard       26-Aug-1991
                   cable swap in 1991 data
   
       Output:     - IER       /I    status flag
                                     0 = okay, or no raw data
                                     1 = SPED bank not found
   
       Description
       ===========
       Apply corrections to the TDC times coming from real events
       that are necessary to correct for the different crate, card, and
       TDC number configuration
   
       For Pilot run data only:
       Recalculate TDC times, and swap addresses of TDC's on side B.
       (The times specified in SRTD are calculated improperly, and have
       all to be recalculated using the SPED bank from the run header
       that contains the pedestals and slopes of the TDC's. Furthermore,
       the two connectors on the TDC cards of side B were swapped, and
       the signals must be swapped again to get proper results.)
   
       For runs 5354 ... 5488 only:
       Swap TDC cards in crate 1 from side A to side B and vice versa
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   SPREDA                                                                          
        |---- SREALD                                                               
                   |----  IBITS                               External             
                   |----  MOD                                 External             
                   |----  PHIBSG                              External             
                   |----  FLOAT                               External             
                   |----  NAMIND                              External             
                   |----  REAL                                External             
                   |----  INT                                 External             
                   |----  TCRASC                              External             
                   |----  MVBITS                              External             
                   |----  RERROR                                                   
   
 
3 SRFHIS
         SUBROUTINE SRFHIS(XHIS,YHIS,N,YLOW,YUPP,YREF,MODE,XREF,IER)
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Fit straight line to histogram
   
       Author:     H. Meinhard       27-Jun-1989
   
       Input:      - XHISn     /F    abscissas of histogram segment
                   - YHISn     /F    ordinates of histogram segment
                   - N         /I    number of channels in segment
                   - YLOW      /F    mimimum ordinate to be used in fit
                   - YUPP      /F    maximum ordinate to be used in fit
                   - YREF      /F    ordinate for which abscissa must be
                                     calculated
                   - MODE      /I    mode of histogram segment:
                                     0 = raising edge
                                     1 = falling edge
       Output:     - XREF      /F    abscissa that YREF refers to
                   - IER       /I    error code:
                                     0 = no error
                                     1 = no starting point for fit
                                     2 = not enough points for fit
                                     3 = straight line fit failed
                                     4 = mode not defined
   
       Description
       ===========
       Given a segment of a histogram that contains either a raising
       or a falling edge, fit a straight line to the subset of the
       segment that has at least YLOW entries and at most YUPP entries.
       For a given reference of the ordinate, return the abscissa that
       corresponds to that ordinate.
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   SRCONS                                                                          
        |---- SRFHIS                                                               
                   |----  LLSQ                                External             
   
 
3 SRFIT0
         SUBROUTINE SRFIT0(N,THRAW,PHRAW,SIGMA,AX,AY,CHISQ,COVXY,IER)
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Perform straight line fit
   
       Author:       H. Meinhard  21-Mar-1987
       Modified:     H. Meinhard  30-Mar-1988
       Modified:     D.Smith      991027 Double precision fixes for Linux
   
       Input:        - N           /I    number of coord. ([1,9])
                     - THRAWi      /R    tan theta of coord.
                     - PHRAWi      /R    azimuth angle of coord. centre
                     - SIGMAi      /R    error in THRAWi
       Output:       - AX          /R    x/z of fitted line
                     - AY          /R    y/z of fitted line
                     - CHISQ       /R    chisquare of fit
                     - COVXYij     /R    covariance matrix of AX, AY
                     - THRAWi      /R    difference between measured
                                         and fitted THRAW, divided by
                                         SIGMAi
                     - IER         /I    error flag: .ne. 0 if error
   
       Description
       ===========
       Fit a straight line through the origin of the coordinate system
       to measured wire paralleles given by the tangent of their polar
       angle and their azimuth angle, both with respect to the center
       point of the wire parallele.
       Internally, calculations are performed in Double Precision. If
       the determinant of the coefficient matrix is less than 1000.,
       error flag is set.
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   SRFITF                                                                          
   SRFTRK                                                                          
        |---- SRFIT0                                                               
                   |----  DBLE                                External             
                   |----  DSIN                                External             
                   |----  DCOS                                External             
                   |----  REAL                                External             
   
 
3 SRFIT2
         SUBROUTINE SRFIT2(ISACP,CHI2,XFIT,COVX,IER)
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Perform double arm straight line fit
   
       Author:     H. Meinhard       02-Feb-1990
       Modified:   H. Meinhard       28-Mar-1990  (4)
       Modified:   D.Smith     991027 Double precision fixes for Linux
   
       Input:      - ISACPi    /I    pointer to elements of bank SACO
                                     which will be used in fit; must
                                     end with 0
       Output:     - CHI2      /F    chisquare of fit
                   - XFITi     /F    vector of fitted parameters:
                                     (theta,phi,x0,y0)
                   - COVXij    /F    matrix of covariance elements
                   - IER       /I    error code: 1 = missing input banks
                                                 2 = singularity
   
       Description
       ===========
       Fit a straight line to measurements of SATR coordinates on both
       sides of the interaction point. Coordinates are taken from bank
       SACO.
       For the fit formulas, see calculation in Logbook 4, pg. 82 ff.
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   SRDBLE                                                                          
        |---- SRFIT2                                                               
                   |----  REAL                                External             
                   |----  UCOPY                               External             
                   |----  DBLE                                External             
                   |----  DRSCL                               External             
                   |----  DMMLT                               External             
                   |----  DINV                                External             
                   |----  DMMPY                               External             
                   |----  CX                                  External             
                   |----  XI                                  External             
                   |----  DVSCL                               External             
                   |----  WORK                                External             
                   |----  DVCPY                               External             
                   |----  DMMPA                               External             
                   |----  DVMUL                               External             
                   |----  BEPS                                External             
                   |----  DVMPY                               External             
                   |----  ATAN                                External             
                   |----  SQRT                                External             
                   |----  PROXIM                              External             
                   |----  ATAN2                               External             
                   |----  RERROR                                                   
   
 
3 SRFITF
         SUBROUTINE SRFITF(IER)
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Perform track fit
   
       Author:     H. Meinhard       28-Jan-1988
       Modified:   H. Meinhard       21-Feb-1989 (2)
   
       Output:     - IER       /I    error flag (0 = no error)
   
       Description
       ===========
       For every combination of wire paralleles which corresponds
       to a patch (BOS bank SWPA), perform a straight line
       fit through the origin. If the chisquare probability is too bad,
       try with less wire paralleles
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   SRKAND                                                                          
        |---- SRFITF                                                               
                   |----  IBITS                               External             
                   |----  MOD                                 External             
                   |----  PHIBSG                              External             
                   |----  FLOAT                               External             
                   |----  AUBOS                               External             
                   |----  VZERO                               External             
                   |----  COMBI                               External             
                   |----  SRFIT0                                                   
                   |----  PROB                                External             
                   |----  MAX                                 External             
                   |----  RMCPY                               External             
                   |----  UCOPY                               External             
                   |----  AUBPRS                              External             
                   |----  RERROR                                                   
   
 
3 SRFLTR
         SUBROUTINE SRFLTR(NKAN)
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Fill track cand. in track bank
   
       Author:     H. Meinhard       05-Jun-1987
       Modified:   H. Meinhard       20-Jun-1988
   
       Input:      - NKAN      /I    number of track candidate to
                                     be filled
   
       Description
       ===========
       Convert cartesian parameters of track candidates to spherical
       parameters and fill it into track bank and track to coordinates
       pointer bank
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   SRFTRK                                                                          
        |---- SRFLTR                                                               
                   |----  ATAN                                External             
                   |----  SQRT                                External             
                   |----  AMOD                                External             
                   |----  ATAN2                               External             
   
 
3 SRFTRK
         SUBROUTINE SRFTRK(IER)
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Find satr tracks
   
       Author:     H. Meinhard       09-Feb-1988
       Modified:   H. Meinhard       20-Nov-1989  (4)
   
       Output:     - IER       /I    error flag (0 = no error)
   
       Description
       ===========
       For each side, loop over the track candidates, find the best one
       (currently, this means most wire parallels, and, if there are
       several, the one with the smallest chisquare), and for the remai-
       ning candidates, remove all wire paralleles using the same hit
       as a wire parallele in the selected candidate, and redo the fit
       if necessary. Repeat this procedure until no more candidates are
       available.
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   SRTRCK                                                                          
        |---- SRFTRK                                                               
                   |----  IBITS                               External             
                   |----  MOD                                 External             
                   |----  PHIBSG                              External             
                   |----  FLOAT                               External             
                   |----  BKTOW                               External             
                   |----  INTCHA                              External             
                   |----  AUBOS                               External             
                   |----  MAX                                 External             
                   |----  SRFLTR                                                   
                   |----  SRTDCN                                                   
                   |----  SRFIT0                                                   
                   |----  AUBPRS                              External             
                   |----  WDROP                               External             
                   |----  WGARB                               External             
                   |----  RERROR                                                   
   
 
3 SRGEOM
         SUBROUTINE SRGEOM
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Fill satr geometry common block
   
       Author:     H. Meinhard       19-Aug-1987
       Modified:   H. Meinhard       29-May-1990  (3)
   
       Description
       ===========
       Constants describing the SATR geometry are filled into common
       block SGEOMC.
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   SINIRU                                                                          
        |---- SRGEOM                                                               
                   |----  ALGTDB                              External             
                   |----  NAMIND                              External             
                   |----  ABS                                 External             
                   |----  RERROR                                                   
   
 
3 SRIHIS
         SUBROUTINE SRIHIS(X0,DELX,N,YHIS,X,Y,IER)
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Interpolation in histogram
   
       Author:     H. Meinhard       27-Jun-1989
   
       Input:      - X0        /F    start value of histogram abscissa
                   - DELX      /F    step of histogram abscissa
                   - N         /I    number of histogram channels
                   - YHISn     /F    array containing channel contents
                   - X         /F    abscissa where interpolation is
                                     required
       Output:     - Y         /F    interpolated ordinate value
                   - IER       /I    error code: 0 = no error
                                                 1 = X out of range
   
       Description
       ===========
       This routine gives the interpolated histogram value for a given
       abscissa.
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   SRCONS                                                                          
        |---- SRIHIS                                                               
                   |----  REAL                                External             
                   |----  INT                                 External             
   
 
3 SRINBS
         SUBROUTINE SRINBS
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Satr bank name indices
   
       Author:     H. Meinhard       17-Aug-1987
       Modified:   H. Meinhard       02-May-1991  (7)
   
       Description
       ===========
       Set name indices and bank formats for SATR named banks, reset
       work bank indices
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   SINIJO                                                                          
        |---- SRINBS                                                               
                   |----  NAMIND                              External             
   
 
3 SRINTS
         SUBROUTINE SRINTS(X1,Y1,X2,Y2,R,PHI,XS,YS)
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Get intersection point
   
       Author:     H. Meinhard       08-Jan-1988
   
       Input:      - Xi,Yi     /F    coordinates of points delimiting
                                     the polygon edge [-.1,.1]
                   - R         /F    distance of straight line from
                                     origin [0.,.1]
                   - PHI       /F    azimuth of distance [0.,6.29]
       Output:     - XS,YS     /F    coordinates of intersection point
                                     [-.1,.1]
   
       Description
       ===========
       Determine the intersection point of a polygon edge (given by car-
       tesian coordinates) with the clipping straight line (given by
       r and phi of nearest approach to origin)
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   SRCLIP                                                                          
        |---- SRINTS                                                               
                   |----  COS                                 External             
                   |----  SIN                                 External             
                   |----  ABS                                 External             
   
 
3 SRKAND
         SUBROUTINE SRKAND(IER)
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Find track candidates
   
       Author:     H. Meinhard       04-Sep-1987
       Modified:   H. Meinhard       03-Mar-1988
   
       Output:     - IER       /I    error flag (0 = no error)
   
       Description
       ===========
       Look for track candidates performing several steps:
       - Perform first track fit and eliminate iteratively wire
         paralleles which lead to a bad chisquare probability
       - Among the track candidates being derived from one patch,
         select the best one
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   SATREC                                                                          
        |---- SRKAND                                                               
                   |----  SRFITF                                                   
                   |----  SKANPR                                                   
                   |----  SRSELK                                                   
   
 
3 SRLVAL
         LOGICAL FUNCTION SRLVAL(X,Y,R,PHI,IS)
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Check validity of point
   
       Author:     H. Meinhard       08-Jan-1988
   
       Input:      - X,Y       /F    coordinates of point to be checked
                                     [-.1,.1]
                   - R         /F    distance of clip line from origin
                                     [-.1,.1]
                   - PHI       /F    azimuth of distance [0.,6.29]
                   - IS        /I    side to suppress [1,2]
                                     1 = beyond origin, 2 = origin incl.
       Output:     - SRLVAL    /L    .TRUE. if point is kept
   
       Description
       ===========
       Check whether point (x,y) is kept while clipping at a straight
       line with distance r and distance azimuth phi
       Do this by getting the difference vector between point to be
       checked and base point of the distance on the straight line, and
       looking at the projection of the difference vector onto the
       distance direction
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   SRCLIP                                                                          
        |---- SRLVAL                                                               
                   |----  COS                                 External             
                   |----  SIN                                 External             
   
 
3 SRMSTR
         SUBROUTINE SRMSTR(DM,N,MST,IMST,CST)
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Calculate a minimal spanning tree
   
       From Communications of the ACM, April 1972, Vol. 15, Numb. 4
       Modified:     H. Meinhard         21-Mar-1987
   
       This subroutine finds a set of edges of a linear graph
       comprising a tree with minimal total edge length. The
       graph is specified as an array of inter-node edge lengths.
       The edges of the minimal spanning tree of the graph are
       placed in array MST. Execution time is proportional to
       the square of the number of nodes.
   
       Calling sequence variables are:
   
       DM    Array of inter-node edge lengths.
             DM (I, J) (1 .LE. I, J .LE. IN) is the length of
             an edge from node I to node J. If there is no
             edge from node I to node J, set DM (I, J) = 1.E10
       N     Nodes are numbered 1, 2, ..., N.
   
       MST   Array in which edge list of MST is placed. MST (1, I)
             is the original node and MST (2, I) is the terminal
             node of edge I for 1 .LE. I .LE. IMST.
       IMST  Number of edges in array MST.
       CST   Sum of edge lengths of edges of tree.
   
       Program variables:
   
       NIT   Array of nodes not yet in tree.
       NITP  number of nodes in array NIT.
       JI(I) Node of partial MST closest to node NIT (I).
       UI(I) Length of edge from NIT (I) to JI (I).
       KP    Next node to be added to array MST.
   
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   SRSELO                                                                          
        |---- SRMSTR.                                                              
   
 
3 SRPATC
         SUBROUTINE SRPATC(IER)
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Find patches of clusters
   
       Author:     H. Meinhard       06-Jan-1988
       Modified:   H. Meinhard       06-Feb-1990 (2)
   
       Output:     - IER       /I    error flag (0 = no error)
   
       Description
       ===========
       Find patches of clusters by first combining three clusters in
       different spacial orientations, then by combining two clusters
       and - eventually - a single fired wire in the third orientation
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   SATREC                                                                          
        |---- SRPATC                                                               
                   |----  AUBOS                               External             
                   |----  SR3PAT                                                   
                   |----  SR2PAT                                                   
                   |----  AUBPRS                              External             
                   |----  RERROR                                                   
   
 
3 SRPRCN
         SUBROUTINE SRPRCN
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Print the constants for this run
   
       Author:     H. Meinhard       30-Jan-1989
       Modified:   H. Meinhard       02-Mar-1990  (1)
   
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   SINIRU                                                                          
        |---- SRPRCN.                                                              
   
 
3 SRSEL2
         SUBROUTINE SRSEL2(IER)
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Select double arm fitted tracks
   
       Author:     H. Meinhard       20-Feb-1990
   
       Input:      - banks 'SFTR','STCP'
       Output:     - IER       /I    error code:
                                     0 = no error
                                     1 = input banks missing
                   - banks 'SFTR','STCP'
   
       Description
       ===========
       Select double arm fitted tracks according to number of degrees
       of freedom and chisquare such that only one pair of fitted tracks
       remains
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   SATREC                                                                          
        |---- SRSEL2                                                               
                   |----  AUBPRS                              External             
   
 
3 SRSELK
         SUBROUTINE SRSELK(IER)
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Select track candidates
   
       Author:     H. Meinhard       04-Feb-1988
       Modified:   H. Meinhard       07-Mar-1989 (2)
   
       Output:     - IER       /I    error flag (0 = no error)
   
       Description
       ===========
       Among track candidates being derived from the same patch, select
       the best one only (for the time being, 'best' means the candidate
       with most wire parallels and, if there are several, the one with
       the best chisquare, but this may be modified later on)
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   SRKAND                                                                          
        |---- SRSELK                                                               
                   |----  AUBPRS                              External             
   
 
3 SRSELO
         SUBROUTINE SRSELO(SOBJ,SOCP,SSOP,DCUT,IER)
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Select objects
   
       Author:     H. Meinhard       21-Mar-1987
       Modified:   H. Meinhard       03-Jul-1989  (5)
       Modified:   D.Smith    991027 Double precision fixes for Linux
   
       Input:      - SOBJ      /C4   name of object bank
                   - SOCP      /C4   name of bank pointing from objects
                                     to coordinates
                   - SSOP      /C4   name of bank pointing from sides to
                                     objects
                   - DCUT      /F    cut on distance measure
       Output:     - IER       /I    error flag: .ne. 0 if error
   
       Description
       ===========
       Look for objects (track candidates or patches) lying so close
       together that they must come from one original object; within such
       a group of objects belonging together, get best one (for tracks)
       or mean values (for patches) for the parameters.
       Loop over sides
         Loop over pairs of objects
           Compute distance measure for pair of objects --> SRDTRK
         End of loop over pairs of objects
         Compute minimal spanning tree for object distances
         Loop over edges of MST
           Associate both objects to a group of objects
         End of loop over MST edges
         Loop over groups of objects
           Get mean value of parameters
         End of loop over groups of objects
       End of loop over sides
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   SRTRCK                                                                          
   SRUPAT                                                                          
        |---- SRSELO                                                               
                   |----  NAMIND                              External             
                   |----  BKTOW                               External             
                   |----  INTCHA                              External             
                   |----  RERROR                                                   
                   |----  SRDTRK                                                   
                   |----  SRMSTR                                                   
                   |----  VZERO                               External             
                   |----  DBLE                                External             
                   |----  ABS                                 External             
                   |----  ATAN                                External             
                   |----  SQRT                                External             
                   |----  MOD                                 External             
                   |----  DATAN2                              External             
                   |----  REAL                                External             
                   |----  AUBPRS                              External             
                   |----  WDROP                               External             
                   |----  WGARB                               External             
   
 
3 SRSTAT
         SUBROUTINE SRSTAT(IFLAG)
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Print satr event reconstr. summary, fill statistics array
   
       Author:     H. Meinhard       17-Aug-1987
       Modified:   H. Meinhard       06-Mar-1990  (2)
   
       Input:      - IFLAG     /I    0 = normal call
                                     1 = call on error in SATREC
                   - banks 'SRTD','SCOO','SSCP','SFTR','SSCP','SSBP',
                           'SSPP','SSKP','SWPA'
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   SATREC                                                                          
        |---- SRSTAT                                                               
                   |----  IBITS                               External             
                   |----  MOD                                 External             
                   |----  PHIBSG                              External             
                   |----  FLOAT                               External             
                   |----  VZERO                               External             
                   |----  INT                                 External             
   
 
3 SRSUBS
         LOGICAL FUNCTION SRSUBS(ISIDE,N3TOT,IARR,N)
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Is iarr subset of ex. patch?
   
       Author:     H. Meinhard       13-Jan-1988
       Modified:   H. Meinhard       15-Feb-1988
   
       Input:      - ISIDE     /I    current side [1,2]
                   - N3TOT     /I    number of patches found so far,
                                     without new 2-patches [0,*]
                   - IARRi     /I    addresses of hits in patch cand.
                                     [1,*]
                   - N         /I    number of hits in patch cand. [4,7]
       Output:     - SRSUBS    /L    .true. if patch cand. is subset of
                                     3-patch
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   SR2PAT                                                                          
        |---- SRSUBS                                                               
                   |----  MIN                                 External             
   
 
3 SRTDCN
         SUBROUTINE SRTDCN(ICOOR,ICRAT,ICARD,ITDCN)
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Calculate electronics address of coordinate
   
       Author:     H. Meinhard       20-Nov-1989
       Modified:   H. Meinhard       26-Aug-1991
                   correct for miscablings etc.
   
       Input:      - ICOOR     /I    # of coordinate in SCOO
       Output:     - ICRAT     /I    crate # [1,3,-99 for error]
                   - ICARD     /I    card #  [1,24]
                   - ITDCN     /I    TDC #   [1,16]
   
       Common block SGEOMC is required.
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   SRFTRK                                                                          
   SRTDCR                                                                          
        |---- SRTDCN                                                               
                   |----  NAMIND                              External             
                   |----  REAL                                External             
                   |----  INT                                 External             
                   |----  MDORSG                              External             
                   |----  MOD                                 External             
   
 
3 SRTDCR
         SUBROUTINE SRTDCR
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Create raw data srtd from coordinates scoo
   
       Author:     H. Meinhard       20-Aug-1991
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
              SRTDCR                                                               
                   |----  BDROP                               External             
                   |----  PSCOOJ                              External             
                   |----  BLIST                               External             
                   |----  SCOOPR                                                   
                   |----  AUBOS                               External             
                   |----  SRTDCN                                                   
                   |----  MVBITS                              External             
                   |----  FLOAT                               External             
                   |----  TSPASC                              External             
                   |----  REAL                                External             
                   |----  TCRASC                              External             
                   |----  NINT                                External             
                   |----  AUBPRS                              External             
   
 
3 SRTRCK
         SUBROUTINE SRTRCK(IER)
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Find satr tracks
   
       Author:     H. Meinhard       01-Mar-1988
       Modified:   H. Meinhard       03-Mar-1988
   
       Output:     - IER       /I    error flag (0 = no error)
   
       Description
       ===========
       Look for tracks performing several steps:
       - On each side, find track candidate with best chisquare proba-
         bility, remove all used hits from other candidates, if neces-
         sary, redo fit and repeat procedure with remaining candidates
       - On each side, look whether track distance is below a minimum
         distance. If yes, tracks are too close together, find mean
         value of parameters
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   SATREC                                                                          
        |---- SRTRCK                                                               
                   |----  SRFTRK                                                   
                   |----  STRKPR                                                   
                   |----  SRSELO                                                   
   
 
3 SRUNCO
         SUBROUTINE SRUNCO(THETA,PHI,THUNC,PHUNC)
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Compute track params not corrected for misalignment
   
       Author:     H. Meinhard       05-Oct-1989
   
       Input:      - THETA     /F    corrected track theta
                   - PHI       /F    corrected track phi
       Output:     - THUNC     /F    uncorrected track theta
                   - PHUNC     /F    uncorrected track phi
   
       Description
       ===========
       Given theta and phi for a track that was already corrected for
       detector misalignment, calculate the uncorrected values in order
       to compare them with (uncorrected) coordinates.
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   SAHIST                                                                          
        |---- SRUNCO                                                               
                   |----  PHIBSG                              External             
                   |----  INT                                 External             
                   |----  MOD                                 External             
                   |----  REAL                                External             
                   |----  DBLE                                External             
                   |----  SIN                                 External             
                   |----  COS                                 External             
                   |----  XYANSA                              External             
                   |----  ZXANSA                              External             
                   |----  YZANSA                              External             
                   |----  DEQN                                External             
                   |----  ATAN                                External             
                   |----  SQRT                                External             
                   |----  ATAN2                               External             
   
 
3 SRUPAR
         SUBROUTINE SRUPAR(IER)
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   For sides without tracks,
    find parameters of clusters
   
       Author:     H. Meinhard       29-Mar-1988
       Modified:   H. Meinhard       03-Jul-1989  (2)
       Modified:   D.Smith    991027 Double precision fixes for Linux
   
       Output:     - IER       /I    error flag (0 = no error)
   
       Description
       ===========
       For each side, look whether tracks are found; if not, get para-
       meters (theta, phi) of patches and their covariance matrix
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   SRUPAT                                                                          
        |---- SRUPAR                                                               
                   |----  AUBOS                               External             
                   |----  DBLE                                External             
                   |----  ABS                                 External             
                   |----  ATAN                                External             
                   |----  SQRT                                External             
                   |----  MOD                                 External             
                   |----  DATAN2                              External             
                   |----  REAL                                External             
                   |----  AUBPRS                              External             
                   |----  RERROR                                                   
   
 
3 SRUPAT
         SUBROUTINE SRUPAT(IER)
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Find parameters of patches
    where no tracks are found
   
       Author:     H. Meinhard       29-Mar-1988
       Modified:   H. Meinhard       19-Apr-1988
   
       Output:     - IER       /I    error flag (0 = no error)
   
       Description
       ===========
       In case that at any side no track was found, get mean parameters
       of patches:
       - On each side, look whether a track was found; if not, determine
         parameters of patches (theta, phi) together with their errors;
       - Look whether distance of two patches is below a minimum
         distance. If yes, patches are too close together, find mean
         value of parameters
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   SATREC                                                                          
        |---- SRUPAT                                                               
                   |----  SRUPAR                                                   
                   |----  SUPAPR                                                   
                   |----  SRSELO                                                   
   
 
3 SRWIRE
         SUBROUTINE SRWIRE(JCRA,JCAR,JTDC,IOR,ISIDE,ILAYE,ISECT,IWIRE)
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Calculate wire and sector numbers
   
       Author:     H. Meinhard       02-Sep-1987
       Modified:   H. Meinhard       07-Mar-1991  (2)
   
       Input:        - JCRA    /I      crate number (1...3)
                     - JCAR    /I      card number (1...24)
                     - JTDC    /I      TDC number on card (1...16)
                     - IOR     /I      number of remaining ored wires
       Output:       - ISIDE   /I      side number (1...2)
                     - ILAYE   /I      layer number (1...9)
                     - ISECT   /I      sector number (1...8)
                     - IWIRE   /I      wire number (1...14)
                     - IOR     /I      number of remaining ored wires
   
       Description
       ===========
       This routine contains the mapping from electronics addresses
       (crate, card, TDC) to the wire positions (side, layer, sector,
       wire). The conversion depends on the oring mode; so some details
       of the oring modes are encoded in this routine.
       If a fired channel ores wires, IOR is set to the number of
       wires still to be described, thus indicating that this routine
       must be called once more in order to get the complete mapping
       information.
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   SRCOOR                                                                          
        |---- SRWIRE                                                               
                   |----  MDORSG                              External             
                   |----  MOD                                 External             
                   |----  KSECSG                              External             
   
 
3 SRWPA2
         SUBROUTINE SRWPA2(IER)
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Pattern recognition for double arm fit
   
       Author:     H. Meinhard       26-Feb-1990
       Modified:   H. Meinhard       08-Mar-1990  (1)
   
       Input:      - banks 'SACO','SPAT'
       Output:     - IER       /I    error code
                                     1 = missing input banks
                                     2 = no space for new bank
                                     3 = bank overflow
                   - bank 'SWPA'
   
       Description
       ===========
       For each pair of patches, correct the coordiates of the patches
       for misalignment and for magnetic field, calculate the common
       area, and look which wire parallels match this common area
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   SATREC                                                                          
        |---- SRWPA2                                                               
                   |----  REAL                                External             
                   |----  AUBOS                               External             
                   |----  SIN                                 External             
                   |----  COS                                 External             
                   |----  XYANSA                              External             
                   |----  YZANSA                              External             
                   |----  ZXANSA                              External             
                   |----  SRCPAT                                                   
                   |----  VZERO                               External             
                   |----  AUBPRS                              External             
                   |----  RERROR                                                   
   
 
3 SRWPAR
         SUBROUTINE SRWPAR(IER)
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Find wire paralleles corresponding to patches
   
       Author:     H. Meinhard       27-Jan-1988
       Modified:   H. Meinhard       27-Feb-1990  (2)
       Modified:   H. Meinhard       06-Feb-1990  (2)
   
       Output:     - IER       /I    error flag (0 = no error)
   
       Description
       ===========
       Look for correspondings between the patches (found only on
       fired tubes, i.e. without drift time information) and the wire
       paralleles which are given by the drift distance in each fired
       tube.
       - loop over all patches
         - loop over hits of patch
           - loop over wire paralleles
             - does the wire parallele correspond to the patch?
             - if yes, wire parallele becomes part of the sample
       - bottom of all loops
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   SATREC                                                                          
        |---- SRWPAR                                                               
                   |----  IBITS                               External             
                   |----  MOD                                 External             
                   |----  PHIBSG                              External             
                   |----  FLOAT                               External             
                   |----  BDROP                               External             
                   |----  AUBOS                               External             
                   |----  SRCCOP                                                   
                   |----  SRCLIP                                                   
                   |----  AUBPRS                              External             
                   |----  RERROR                                                   
   
 
3 SSCPCR
         SUBROUTINE SSCPCR(IER)
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Create the sscp bank
   
       Author:     H. Meinhard       20-Nov-1989
   
       Output:     - IER       /I    error flag (0 = no error)
   
       Description
       ===========
       Create bank SSCP, fill it with numbers derived from SCOO which
       must be present. Common block SGEOMC must also be available
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   SRCLUS                                                                          
        |---- SSCPCR                                                               
                   |----  IBITS                               External             
                   |----  MOD                                 External             
                   |----  PHIBSG                              External             
                   |----  FLOAT                               External             
                   |----  AUBOS                               External             
                   |----  VZERO                               External             
   
 
3 SSLOWC
         SUBROUTINE SSLOWC
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Handle slow control for satr
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   RUNKNO                                                                          
        |---- SSLOWC.                                                              
   
 
3 STRKPR
         SUBROUTINE STRKPR(LUN)
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Print the strk bank
   
       Author:     H. Meinhard       10-Feb-1988
       Modified:   H. Meinhard       09-Oct-1989  (3)
   
       Input:      - LUN       /I    logical unit for output
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   SATREC                                                                          
   SRTRCK                                                                          
        |---- STRKPR                                                               
                   |----  MOD                                 External             
                   |----  MIN                                 External             
                   |----  MAX                                 External             
                   |----  PROB                                External             
   
 
3 SUPAPR
         SUBROUTINE SUPAPR(LUN)
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Print the supa bank
   
       Author:     H. Meinhard       29-Mar-1988
       Modified:   H. Meinhard       04-Jul-1989  (1)
   
       Input:      - LUN       /I    logical unit for output
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   SRUPAT                                                                          
        |---- SUPAPR                                                               
                   |----  MOD                                 External             
                   |----  MIN                                 External             
                   |----  MAX                                 External             
                   |----  PROB                                External             
   
 
3 SWP2PR
         SUBROUTINE SWP2PR(LUN)
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Print the swpa bank after double arm pattern recognition
   
       Author:     H. Meinhard       06-Mar-1990
   
       Input:      - LUN       /I    logical unit for printout
                   - bank 'SWPA'
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   SATREC                                                                          
        |---- SWP2PR.                                                              
   
 
3 SWPAPR
         SUBROUTINE SWPAPR(LUN)
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Print the swpa bank
   
       Author:     H. Meinhard       27-Jan-1988
   
       Input:      - LUN       /I    Logical unit for output
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   SATREC                                                                          
        |---- SWPAPR.                                                              
   

2 T_

  >>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>
    CKEY 
     1st entry in T_set
     ! JULIA 311
        TFCAND : Kill hits on a chain if there are more than 21 pad rows 
                 in the chain, due to pattern recognition error that 
                 should never happen.....                   (M.Cattaneo)
    
     ! JULIA 310
        TFITHL,TMSHEL,TRHLX2,TWIREZ : Double precision fixes for Linux (D.Smith)
    
     * 19990518 corr file 309.1
        TRNCON : Read    clock frequency in Hz from TSOR bank (W.Wiedenmann)
        TSORDP : Display clock frequency in Hz from TSOR bank (W.Wiedenmann)
        
     ! JULIA 309
        TWIREZ : Bug fix - use IROWP instead of IROW (uninitialised variable) in 
                 definition of IROWS. Screwed up check on whether a coordinate
                 includes half-pads.                                 (D.Casper)
    
     * 981118 corr file 308.5
        TPDELS : Change value of logarithmic correction coefficient (J-Y.Nief)
    
     * 981116 corr file 308.4
        TPADDX : Bug fix - consider a large pad crossing angle (F.Palla)
    
     * 980928 corr file 308.1
        TMSHEL : Protect against divide by zero when DENOM=0.0, again (M.Cattaneo)
    
     * 980824 corr file 307.4
        The changes to TFTWTB and TRKELS fix the problem with dE/dx in the 
        reprocessing of 1991 data.
        TFTWTB : suppress missed hits if they will not be used           (D.Casper)
        TRKELS : ensure that zero charge samples remain zero after correction 
                                                                         (D.Casper)
        TTWODX : Bug fix: bank T2XS was not being extended a second time if 
                 necessary                                             (M.Cattaneo)
    
     ! JULIA 307
    
        TPREDA : Force use of unreduced wire data (raw data banks TWIR/TWDI)
                 in run range 10000-11800 (1991)          (W.Wiedenmann,M.Cattaneo)
    
     * corr file 306.1
        TWIREZ : Up to 1991 the banks (TSIR,TSDI,TSLE) 
                 were called (TRIR,TRDI,TRLE)          (W.Wiedenmann)
    
     ! JULIA 306
    
        TPSMR1 : Change the Z smearing proportional to the drift distance
                 to an average smearing. Fixes cos(theta) dependence (Thulasidas)
        TREFIT : NEW Refit frft 2 tracks after monte carlo smearing (A.Bonissent) 
        TSMFT  : NEW Steering to smear and refit frft tracks in MC  (A.Bonissent)
    
     * corr file 305.3
        TFITHL : Bug fix: Protect against arg SIN > 1.0 (M.Cattaneo)
        TFLNKS : Fix typo in "long-range" code. 
                 Select best link, not first....        (D.Casper)
        TOVRLP : Changed scale factor in ITRKSW(2) to 10000 
                 to allow for events with > 999 tracks  (I.Tomalin)
                 Prevent track candidates from winding up with more 
                 than one hit in a given padrow.        (D.Casper)
    
     * corr file 305.2
        Add TPC smearing routines for MonteCarlo
        TPDIAG : NEW Finds eigen values and vectors from cov. mat.    (Thulasidas)
        TPHSMR : NEW smears the TPCO coordinates in accordance with the 
                     database bank TPSM for Monte Carlo events        (Thulasidas)
        TPRNDM : NEW generates random vars. from eigen values/vectors (Thulasidas)
        TPSMGT : NEW Used to read TPSM bank from database             (Thulasidas)
        TPSMR1 : NEW adds the smearing vector to the TPCO coordinates (Thulasidas)
    
     * corr file 305.1
        TMSHEL : Protect against divide by zero when DENOM=0.0 (M.Cattaneo)
    
     ! JULIA 304
        TSACOR : Bug fix: NLINK was called with TPCO bank index
                 rather than name                               (A.Waananen)
        TLIPAK : fix variable type inconsistencies in function calls, 
                 for Linux                                            (A.Waananen)
    
     * corr file 304.3
        TPREDA : Correct 1997 T0 for problems (I.Tomalin)
    
     * corr file 304.2
        TPAKCO : Create PTNC even if FRTL and FTCL are missing (M.Cattaneo)
    
     * corr file 304.1
        TFITKF,TOVRLP,TSUMVD,TWIREZ :
                      Remove CALL from function references, for Linux. (A.Waananen)
    
     ! JULIA 304
        TCOOR,TCOORT,TSAWIR : Replace call to THPFDG with new routine THPCOR, 
                              to correct 1 half-pad coordinates too.   (D.Casper)
        TCSHF1 : New. Copy of TCSHFT to shift coordinates derived from 
                      sub-clusters with one, rather than two, half-pads (D.Casper)
        THPCOR : New. Copy of THPFDG to handle corrections for 
                      1 half-pad coords as well                        (D.Casper)
        TRNCON : Read TNRN from database                               (M.Cattaneo)
        TWIREZ : Protect vs. ABS(B1) .GT. RPAD                         (M.Cattaneo)
                 Do not apply Landau to coords with half-pads, since the PH
                 response is falling off at the sector edge.           (D.Casper)
    
     * corr file 303.5
        TFCHEK : New - Check TPC helix parameters for basic sanity  (D.Casper)
        TFITTK : Protect against crazy fits by calling sanity check (D.Casper)
        TFLNK2 : Protect against crazy fits by calling sanity check (D.Casper)
    
     * corr file 303.4
        TPLANA : Bug - Update IOFFS after calls to WBANK (M.Cattaneo)
    
     ! JULIA 303
        TGETQT : Restrict tan(lambda) to range +/-3                    (D.Casper)
        TJTOP  : Reverse the order of calls to TPAKCO and TFPCOI       (D.Casper)
        TPK1CO : Recalculate the coordinate errors for pad coordinates (D.Casper)
        TWIREZ : Protect vs. negative VARFIT(3)                        (D.Casper)
    
     * corr file 302.6
        TPADDX : Add protection for logarithmic correction  (J-Y.Nief,D.Casper)
        TPDELS : Add log. correction to specific ionisation (J-Y.Nief,D.Casper)
    
     * corr file 302.5
        TWIREZ : Bug fixes - protect against -ve SQRT, initialize EZPAD2 (D.Casper)
    
     * corr file 302.3
        TFILTJ : Allow errors to be packed into 2 bytes instead of 1, to allow
                 accurate refitting.  Scale factors changed accordingly. (D.Casper)
        TPK1CO : Remove requirement that errors fit into a byte, to allow
                 scale factors to change and round-off to be reduced     (D.Casper)
    
     * corr file 302.1
        TWIREZ : Use finer T0 offset correction (D.Casper)
    
     ! JULIA 302 (Tracking upgrade)
        TCOOR  : Correct z for shaping effects
                 Call new alignment routine TCRTRN instead of TCRTRA    (D.Casper)
        TCOORT : Correct subpulses for shaping effects
                 Add wire coordinates
                 Add TNLC,TNGS,TWNZ steering cards
                 Call new alignment routine TCRTRN instead of TCRTRA    (D.Casper)
        TERPAR : Treat wire-corrected coordinates
                 Replace TERN bank with TLCE                            (D.Casper)
        TFITHL : Cosmetic changes, add a protection on divide by 0      (D.Casper)
        TFITKF : Replace dummy routine                                  (D.Casper)
                 Refit TGFT tracks using Kalman filter
                 Remove hits flagged as outliers from coordinate list
                 Replace calls to TTGCLR,TRMHIT with FDETCO,FRMHIT      (F.Ranjard)
        TFLNK2 : Treatment of track candidates (2 linked tracks)
                 is now consistent with that in TFITTK                  (P.Colrain)
        TFLNKS : Protection added for DPHI > PI                         (P.Colrain)
                 Use PI,TWOPI from alcons.h                             (F.Ranjard)
        TFPCOI : Include info on Landau corrections                     (D.Casper)
        TGETQT : **BEWARE** Changed calling sequence
                 Support for shaping correction                         (D.Casper)
                 Inline code instead of calls to TSHAP1,TSHAP2          (F.Ranjard)
        TINIJO : Default for bank TWPU changed to TRUE                  (D.Casper)
        TPADDX : Improved protection on bad coordinates                 (D.Casper)
        TPCREC : Refit after corrections and removal of filtered coords
                 is now default. Switch off with TNFF card              (D.Casper)
        TRNCON : Read constants for pulse-shape correction from 
                 TSHP bank on database.                                 (D.Casper)
        TSACOR : Flag coords modified by this routine to avoid
                 correcting wire Z                                      (D.Casper)
        TSAWIR : Handle changed calling sequence of TGETQT
                 Fix grotesque bugs in field/alignment correction
                 Call new alignment routine TCRTRN instead of TCRTRA    (D.Casper)
        TSCFIL : Replace algorithm 1 with new code                      (D.Casper)
        TSHPCO.H New. Constants for correction of TPC pad pulses        (D.Casper)
        TWINCO : Handle changed calling sequence of TGETQT
                 Call new alignment routine TCRTRN instead of TCRTRA    (D.Casper)
        TWIREZ : New. Process Landau corrections and wire Z coordinates (D.Casper)
                 Inline code instead of call to TFUNL                   (F.Ranjard)
    
     * corr file 285.1
        TSUMVD : Put TSVDWB COMMON in include file   (M.Cattaneo 4/3/97)
        TVDVEL : Put TSVDWB COMMON in include file   (M.Cattaneo 4/3/97)
        TALIGN.H Removed. Duplicated in Alephlib!!   (M.Cattaneo 4/3/97)
        TSVDWB.H New. Include file for TSVDWB COMMON (M.Cattaneo 4/3/97)
                     
     ! JULIA 284
        TSUMVD : Truncated mean improved to make drift velocity calculation 
                 from VDET/gamma-gamma more reliable.
        TVDVEL : Ditto.  (I.Tomalin 09/10/96)
    
     * corr file 281.2
       TVDVEL : More protections against small statistics (M.C, I.T. July 96)
    
     ! JULIA 280
       TFITHL : correct documentation: XF,YF,WF double precision (P.Rensing,Jan 96)
       TVDVEL : avoid dividing by zero when just one event is processed
               (M.Cattaneo, I.Tomalin, Feb 96)
    
     * corr file 279.2
       TPDELS : bug that made track 1 lose its pad dE/dx info fixed (D.Casper,
               Dec 95)
       TPCREC,PADDEDX : call ALTIME only if TPTI card used (O. Callot, Dec 95)
       TPCT0  : aesthetic changes required by LIGHT (P.Comas, Jan 96)
     * corr file 279.1
       TPADFX : remove comments after *CA for LIGHT (P. Comas, Nov 95)
     ! JULIA 279
       TPDXJJ, TPADCL, TPLSJJ, TPXSJJ, TP1XJJ, PTPXJJ :
                new comdecks added for pad dE/dx (D. Casper, Nov 95)
       TPADDX : store subcluster pulseheights in TPDX for measurement
               of pad dE/dx (D. Casper, Nov 95)
       TCQGS3 : compute coordinate charge assuming Gaussian, based on
               TCOGS3 (D. Casper, Nov 95)
       TPDELS : create TPXS bank of truncated means for pad dE/dx
               (D. Casper, Nov 95)
       TFITKF : dummy routine to replace TFITKF (D. Casper, Oct 95)
       TWIREZ : dummy routine to replace TWIREZ (D. Casper, Oct 95)
       FTPCER : get wire correction flag (D. Casper, Jun 95)
       TMONIT, TPTIME, TSTATE : pad dE/dx variables added
                               (D. Casper, Nov 95)
       TACCMN, TCOALG, TCOOR, TCOORT: modified to allow inclusion of
                                     pad dE/dx (D. Casper, Jun 95)
       TERPAR : new argument added for the eventual implementation of
               Landau correction for TPC coordinates (D. Casper, Nov 95)
       TINIJO : add pad dE/dx monitoring (D. Casper, Nov 95)
       TKSGDP : add pad dE/dx info (D. Casper, Nov 95)
       TPAKTX : add pad dE/dx banks (D. Casper, Nov 95)
       TPCREC : calculate dE/dx from pad pulses, refit after corrections
               and remove filtered hits from cord list (D. Casper, Nov 95)
       TPRSUM : add pad dE/dx statistics (D. Casper, Nov 95)
       TRNCON : read pad dE/dx constants, book histos (D. Casper, Oct 95)
       TSAWIR : support for pad dE/dx in TCOALG (D. Casper, Jun 95)
    
     * corr file 278.4
       TSUMVD : new routine to fill TSVD bank with VDET z residuals
               w.r.t. TPC tracks (I. Tomalin, Nov 95)
       TPCRUN : add call to TVDVEL (I. Tomalin, Nov 95)
       TVDVEL : new routine to create TVVD bank and fill it with TPC drift
               velocity calculated using VDET residuals (I. Tomalin, Nov 95)
       TVVDJJ : new comdeck added (I. Tomalin, Nov 95)
     * corr file 278.1
       TFLNK2 : protect against straight tracks (I. Tomalin, Oct 95)
       TRKELS, TWIRES : move DATA statement just before BMACRO to allow
               compilation in Linox (P. Comas, Oct 95)
     ! JULIA 278
    
     * corr file 277.2
       TRNCON : call RERROR if no TSOR bank is present (I. Tomalin,
               Jun 95)
     ! JULIA 277
       TPCBUN : Improved (I. Tomalin, May 95)
       TPCT0N : Improved to reduce sensitivity to V0's (I. Tomalin,
               May 95)
    
     * corr file 276.4
       TPCBUN : new routine to determine TPC bunch number and set the
               quality flag (M.Girone, I.Tomalin, Apr 95)
       TPCT0N : modified from TPCT0 to include error on DT  (M.Girone,
               I.Tomalin, Apr 95)
       TPCREC : calculate TPC bunch number (I.Tomalin, Apr 95)
       TPREDA : correct T0 for bunch trains (I.Tomalin, Apr 95)
       TRNCON,TPCCON : added TVOFS0 and TPCCLK to common TPCCON to cope
               with bunch trains (I.Tomalin, Apr 95)
     ! JULIA 276
    
     * corr file 275.5
       TCODRV : drop work banks at the end (D.Casper, Feb 95)
     ! JULIA 275
     * corr file 274.5
       see comment on 274.4
     * corr file 274.4
       TRNCON : wire pedestal is set to 0 in absence of TCLB or TSIM bank
                for runs >= 28834. From now on wire pedestals are substracted
                online. Pad pedestals are set to 4. TCLB bank does not
                contain wire pedestals since run 28834 and must be ignored.
                JULIA 274.4 contained a first version of this change and in
                FALCON, JULIA 274.4 contained a correction to RLOOPR. To
                avoid confusions, both are released as 274.5 to avoid mixture
                of versions.
     * corr file 274.2
       TOERJJ : update HAC parameters (G. Ganis)
       TCPTST : fill TOER bank extended with 5 more words (G. Ganis)
       TSAWTK : protect code to prevent JULIA crashes in '93 MC production
                on ALPHAs (C. Georgiopoulos)
     ! JULIA 274
       TMONIT : add 36 words in the common block GAINTM(LTSECT)
       TACCMN : get Sector to Sector calibration information ...
                and store it in TMONIT (Z.Feng)
                fill one histogram per sector
                Store this tracks dE/dX value into the monitoring
                common blocks (TMONIT) if this track is a Mip.(Z.Feng)
                fill one histogram
       TDXMON : obsolete deck, purge it.
       TINIRU : reset /TMONIT/ DEDX_CALibration counters at start of
                run.
       TPCRUN : remove fit of DEDX,
                book, give a format and fill JHDX bank.
                JHDX has LTSECT+1 rows, 1 row per sector plus 1 row for
                the overall gain. The number of columns is the number of
                bins of the histograms.
       TRNCON : remove call to TDEDXV.
    
     ! JULIA 273
       TCPTST - handle new TOER error bank (G.Ganis).
     * corr file 272.2
       TRNCON : set T0=0. for TPCSIM version number < 218
       TFITTK : requires at least 3 coords. (I.Tomalin)
       TOVRLP : remove bug (I.Tomalin)
     * corr file 272.1 modified in 272.2
       TRNCON : with MC data when TPCSIM version # is > 217
                use the true T0 from T0GL, do not set it to 0.
    
     ! JULIA 272
       TPCRUN - return if MC data (F.Ranjard).
       TFCAND - get track parameters errors from the diagonal of the
                covariance matrix (I.Tomalin).
       TCLDMP, TPRPOJ - enlarge formats (I.Tomalin).
     * corr file 271.9
       TPCRUN : return if MC data
     * corr file 271.6
       TPCRUN : expand fit interval.
    
  <<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<
     T1FTDP     Dump bos bank t1ft
     TACCMN     Accumulate tpc monitoring information
     TARCDP     Dump contents of arc bank
     TATWIN     Add twin coordinates to track candidates
     TBCODP     Dump tpc bad coordinates (bank tbco) to iunit
     TBNKIN     Initialize tpc name indices
     TBPRNT     Print tpc sector banks
     TBVAL      Calib. from v ==> gauss
     TCALDP     Dump contents of tcal bank
     TCDUMP     Print tpc clusters
     TCHADP     Dump contents of chain bank
     TCHSUM     Chebychev sum
     TCLANA     Analyze a cluster to attempt separation into subclusters
     TCLCOR     Analyze pulses and clusters
     TCLDMP     Dump a single tpc cluster
     TCLPAT     Associate subpulses into subclusters
     TCLSNG     Quick cluster analysis
     TCLUDP     Dump bos bank tclu
     TCLUST     Store tpc clusters and pulses
     TCO4PA     Tpc coordinates finding : 2 coordinates from 4 pads
     TCOALG     Calculate r*phi position and charge of cluster.
     TCOBIN     Bin coordinates for pattern recognition
     TCODRV     Driver for tpc coordinate finding
     TCOERR     Calculate the errors on tpc pad coordinates
     TCOGS3     Tpc coordinates finding : three pads algorithm, gaussian pulse,
     TCOOR      Calculate coordinates from subclusters
     TCOORT     Calculate corrected coordinates from initial track fit and initial
     TCOTHR     Tpc coordinates finding : threshold algorithm, using two "2 pads
     TCOUL2     Tpc coordinates finding : unweighted least-squares estimation of
     TCOUL3     Tpc coordinates finding : unweighted least-squares estimation of
     TCOWA2     Tpc coordinates finding : weighted-avg of two "2 pads
     TCOWA3     Tpc coordinates finding : weighted-avg of three "2 pads
     TCOWAV     Tpc coordinates finding : weighted avg and standard-dev**2, alg (a).
     TCOWL2     Tpc coordinates finding : weighted least-squares estimation of
     TCPTST     Create bank for tpc reconstruction status
     TCQGS3     Compute coordinate charge assuming gaussian; based on tcogs3
     TCSHF1     Shifts coordinates derived from sub-clusters with one half-
     TCSHFT     Shifts coordinates derived from sub-clusters with two half-
     TERPAR     Parameterize tpc coordinate errors after the initial fit
     TFCAND     Assemble tpc chains to track candidates
     TFCHEK     Check tpc helix parameters for basic sanity
     TFILPA     Return pad and wire crossing angles of a track
     TFILTJ     Fill bank ptun with constants for packing and unpacking
     TFITHL     Fast helix fit
     TFITKF     Refit tgft tracks using kalman filter
     TFITTK     Fit tpc track candidates and produce tpc tracks
     TFLNK2     Finds links between pairs of tracks in the tpc.
     TFLNKS     Find tpc links between chains
     TFPCOI     Create bank pcoi with supplementary coordinate information
     TFTHEL     Fast fitting routine for helices
     TFTPAD     Remove garbage pulses from tpc raw pad data
     TFTWTB     Fill the twtb bank
     TGETQT     Make charge and time lists for coordinates
     TGFTDP     Dump bos bank tgft
     TGMADP     Dump banks tgma and tmtl
     THPADD     Add ph of two half pads
     THPCOR     Fudge the coordinate location in case two half pads are used
     THPFDG     Fudge the coordinate location in case two half pads are used
     THTROW     Check which tpc rows are hit by a given track
     TINIJO     Initialize job for tpc
     TINIRU     Initialize run for the tpc
     TISFIL     Fill tpc island pointers
     TISLND     Find tpc pad islands
     TJTOP      Change tpc julia banks to pot format for packing
     TKINK      Find kink in a tpc track
     TKSGDP     Dump single track
     TLCTDP     Dump tpc cluster cuts
     TLIPAK     Add on top of a list
     TMAGNT     Tpc90 b-field
     TMSHEL     Fast fitting routine for scattered helices in the tpc
     TNHLFP     Calculate the number of halfpads in a sub cluster
     TOVRLP     Resolve tpc track overlaps in pad coordinates
     TPADDX     Store subcluster pulseheights in tpdx bank for measurement of pad
     TPADFX     Purpose: synchronize tpad and tpdi bank when
     TPADPO     Returns position of pad ipad in row irow of sector  isec
     TPADPR     Pad cluster pat. recognition
     TPADS      Reconstruct pad clusters
     TPAKBC     Transfer the tbco bank to the ptbc bank
     TPAKCO     Produce the ptnc bank from tpco
     TPAKTA     Pack tpc track-mc association for production output tape
     TPAKTX     Transfer the texs,t2xs,tpxs banks to the ptex,pt2x,ptpx banks
     TPARAB     Parabolic fit of peak of a subpulse
     TPBOOK     Book tpc histograms
     TPCBUN     Determine the tpc bunch number and set the quality flag
     TPCREC     Steering for tpc reconstruction
     TPCRUN     Run summary from tpc reconstruction
     TPCT0      Tpc t0 monitoring
     TPCT0N     Tpc t0 monitoring
     TPDELS     Create tpxs bank of truncated means for pad de/dx
     TPDIAG     Tpdiag diagonalizes the 21x21 hit error matrix
     TPDTHR     Unpack tpd bad channels
     TPHIST     Tpc histograms
     TPHSMR     Tphsmr smears the tpco coordinates in accordance with the data
     TPK1CO     Fill one entry into the ptnc bank
     TPKILL     Remove tpc bad channels from monte carlo input
     TPLANA     Analyze a tpc pulse
     TPPADD     Kludge function to give tpp primary address - sector number correspondence
     TPREDA     Prepare tpc data
     TPRF2      Get square of pad response
     TPRFIN     Initialize pad response function
     TPRFX      Get pad response correction factor
     TPRLST     Establish tpc rowlist
     TPRNDM     Tprndm calculates a random vector rvec of ndim dimensions
     TPRSUM     Job summary from tpc reconstruction
     TPSMGT     Read in the given row ibank of bank (upper triangular matrix)
     TPSMR1     Adds the smearing vector to the tpco coordinates.
     TPSORT     Sort pulses by pad number and time
     TPSTAT     Accumulate tpc cluster statistics
     TPULDP     Dump bos bank tpul to iunit
     TRDWP1     Reduce those tpc wire pulses not already done by the tpp
     TRDWP2     Reduce tpc wire pulses not handled by the tpp, using the default
     TRDWP3     Reduce tpc wire pulses not handled by the tpp, using the default
     TREFCH     Reference between clusters, coordinates and mc hits
     TREFIT     Refit frft 2 tracks after monte carlo smearing
     TREMPT     Remove bad tpc points to get a track with better chi**2
     TRFTCH     Perform "helix" fit to coordinates of current chain
     TRHLX2     Intersection of helix with cylinder
     TRKDMP     Dump all fitted tpc tracks
     TRKELS     Sum up de/dx for tracks
     TRKFND     Track-finding in the tpc
     TRKMCA     Associate tpc tracks with mc tracks
     TRKWRA     Match wire hits to tracks
     TRMVEP     Cut low edge pulses from a subcluster
     TRNCON     Load tpc run constants
     TRPHDI     Difference between phi1 ind phi2 in range -pi to + pi
     TRPROJ     Projects chain to find more hits
     TRRESC     Rescue a chain,
     TRSEEK     Propagate current 3-point link to form chain
     TRSLNK     Search for link across 3  padrows
     TSACHA     Find chains from coordinates in the current
     TSACLU     Find theta-phi pad clusters
     TSACOR     Update and sort coordinate banks after small angle tracking
     TSAPAT     Steering for track finding at low polar angles.
     TSATRK     Steering routine for finding chains from new coordinates.
     TSAWIR     Created by mermikides            26-sep-1989
     TSAWTK     Look for track candidates in bucket # vs wire
     TSCFIL     Fill subpulse and subcluster banks
     TSCIDP     Dump slow control bank for tpc
     TSCLDP     Dump tpc subclusters
     TSCOOR     Determine coordinate in sector frame
     TSEQUE     Drop tpc sectors which are out of sequence
     TSIRDP     Dump the tsir, tsle, and tsdi banks (tpc wire raw data) to
     TSLOWC     Handle slow control banks for the tpc
     TSMFT      Smear and refit frft  tracks in mc events
     TSORDP     Print tpc start-of-run conditions
     TSPUDP     Dump tpc subpulses
     TSUMVD     Create and fill tsvd bank.
     TSZCOR     Calculate cluster z coordinate
     TTLOOP     Author   :- d.cinabro              3-dec-1990
     TTRUNK     Fix tpc raw data for truncated sectors by making the hit list
     TTWODX     Calculate de/dx for overlapping tpc tracks
     TTWOSH     Calculate number of wire hits shared by two tracks
     TTWOSI     Calculate number of unshared wire hits of two tracks on the same w
     TVDVEL     Calculate tpc drift velocity using vdet.
     TWINCO     Make 2 coords from 1 subcluster
     TWINDO     Pick wire pulses within wire range r01 to r02 and time
     TWIRES     Create tpc wire-pulses.
     TWIREZ     Process landau corrections and wire z coordinates
     TWIRFX     Standardize tpc wire raw data banks for monte carlo
     TWPEAK     Find isolated peaks in array.
     TWRRDP     Dump tpc raw and reduced wire data for sector slot

3 T1FTDP
         SUBROUTINE T1FTDP(IUNIT)
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Dump bos bank t1ft
   
       Author:    D. Cinabro 29.5.91
   
       Input:
            - IUNIT   /I    Fortran output logical unit number
   
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   TPCREC                                                                          
        |---- T1FTDP                                                               
                   |----  NAMIND                              External             
   
 
3 TACCMN
         SUBROUTINE TACCMN
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Accumulate tpc monitoring information
   
     Author:  R. Johnson  11-10-89
      Modified :- E. Lancon             21-JUL-1993
      Modified :- Z. FENG               06-MAY-1994
                  fill DEDX histograms per sector and global
                  DEDX per sector is not corrected with sector gain map
                  DEDX global is corrected with sector gain map
      Modified :- D. Casper             02-NOV-1995
                  include pad DEDX
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   TPCREC                                                                          
        |---- TACCMN                                                               
                   |----  NAMIND                              External             
                   |----  FLOAT                               External             
                   |----  MAX                                 External             
                   |----  MOD                                 External             
                   |----  ABS                                 External             
                   |----  SQRT                                External             
                   |----  PROB                                External             
                   |----  ITPTYP                              External             
                   |----  HFILL                               External             
                   |----  GAINTM                              External             
   
 
3 TARCDP
         SUBROUTINE TARCDP(IUNIT)
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Dump contents of arc bank
   
    Author:    R. Johnson   16-9-88
   
    Input:  IUNIT       /I     Fortran output unit number
   
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   TPCREC                                                                          
        |---- TARCDP                                                               
                   |----  NAMIND                              External             
                   |----  SQRT                                External             
   
 
3 TATWIN
         SUBROUTINE TATWIN(NBADC,ICBAD,ITPCO,RTPCO,ICH1,ICH2)
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Add twin coordinates to track candidates
    Author:  R. Johnson   10-09-89
    Input:   NBADC           /I      Number of bad coordinates
             ICBAD( )        /I      List of bad coordinates
             ITPCO( ,2)      /I      The two coordinates
             RTPCO( ,2)      /R      Same as ITPCO
             ICH(2)          /I      Pointers to the two chains
    Output:  ITPCO( ,2)      /I      Add reference to the tracks
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   TOVRLP                                                                          
        |---- TATWIN                                                               
                   |----  NAMIND                              External             
                   |----  RERROR                                                   
                   |----  TFTHEL                                                   
                   |----  SIGN                                External             
                   |----  THLCIR                              External             
                   |----  ABS                                 External             
   
 
3 TBCODP
         SUBROUTINE TBCODP(IUNIT)
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Dump tpc bad coordinates (bank tbco) to iunit
   
       Author:    R. Johnson  05-08-87
   
       Called by TCODRV
   
       Input:
            - IUNIT   /I    Fortran output logical unit number
   
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   TPREDA                                                                          
        |---- TBCODP                                                               
                   |----  NAMIND                              External             
                   |----  MOD                                 External             
   
 
3 TBNKIN
         SUBROUTINE TBNKIN
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Initialize tpc name indices
   
       Author:   R. Johnson   16-12-86
       Modified: R. Johnson   13-10-87
   
    Called by TINIJO
   
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   TINIJO                                                                          
        |---- TBNKIN                                                               
                   |----  NAMIND                              External             
   
 
3 TBPRNT
         SUBROUTINE TBPRNT
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Print tpc sector banks
   
        Author:    D. Schlatter
        Modified:  R. Johnson     6-05-87
   
        Called by TPCREC
   
        Description
        ===========
        This routine will dump all TPC raw and reconstructed data
        at the sector level (pulses and clusters).
        By providing the data card TSECtor, the user can limit the
        printout to only specified sectors.  The TPC dump level must be
        greater than 4 in order for this routine to be called
        automatically by TPCREC.
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   TPCREC                                                                          
        |---- TBPRNT                                                               
                   |----  NAMIND                              External             
                   |----  BPRNT                               External             
                   |----  NPRNT                               External             
                   |----  TPULDP                                                   
                   |----  TCLUDP                                                   
                   |----  TSPUDP                                                   
                   |----  TSCLDP                                                   
   
 
3 TBVAL
         FUNCTION TBVAL(IXV)
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Calib. from v ==> gauss
   
         Author:    J. Richstein     18-06-84
         Modified:  R. Johnson       18-12-86
   
         Input:    IXV         Voltage of Hall probe
         Output:   TBVAL       Field in Gauss
   
         Called by TMAGNT
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   TMAGNT                                                                          
        |---- TBVAL                                                                
                   |----  TCHSUM                                                   
   
 
3 TCALDP
         SUBROUTINE TCALDP(IUNIT)
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Dump contents of tcal bank
   
    Author:    R. Johnson   19-9-88
   
    Input:  IUNIT       /I     Fortran output unit number
   
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   TPCREC                                                                          
        |---- TCALDP                                                               
                   |----  NAMIND                              External             
   
 
3 TCDUMP
         SUBROUTINE TCDUMP
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Print tpc clusters
   
       Author:    D. Schlatter
       Modified:  R. Johnson   6-05-87   5-09-93
   
       Called by TPREDA
   
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   TPREDA                                                                          
        |---- TCDUMP                                                               
                   |----  IBITS                               External             
                   |----  NAMIND                              External             
                   |----  NLINK                               External             
                   |----  TCLDMP                                                   
                   |----  TWRRDP                                                   
   
 
3 TCHADP
         SUBROUTINE TCHADP(IUNIT)
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Dump contents of chain bank
   
    Author:    M. Mermikides   8/9/86
    Modified:  R. Johnson     17/4/87
    Modified:  M.Mermikides   23/08/89
   
    Input:  IUNIT       /I     Fortran output unit number
   
    Called by TRKFND
   
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   TPCREC                                                                          
        |---- TCHADP                                                               
                   |----  NAMIND                              External             
   
 
3 TCHSUM
         FUNCTION TCHSUM(X,C,N)
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Chebychev sum
   
         Author:    J. Richstein     18-06-84
         Modified:  R. Johnson       18-12-86
   
         Called by TBVAL
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   TBVAL                                                                           
        |---- TCHSUM.                                                              
   
 
3 TCLANA
         SUBROUTINE TCLANA
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Analyze a cluster to attempt separation into subclusters
   
       Author:    R. Johnson   22-12-86
       Modified:  R. Johnson   19-01-88
   
       Called from TCLCOR
   
       Description
       -----------
       This routine is called once for each cluster.  For each pulse
       in the cluster it calls TPLANA to separate the pulse into
       subpulses and to analyze each subpulse.  It then calls
       TCLPAT to associate the subpulses into subclusters.  The
       parameters of each subcluster then are determined from
       the associated subpulses and filled into the ISCLUS workbank.
   
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   TCLCOR                                                                          
        |---- TCLANA                                                               
                   |----  TPLANA                                                   
                   |----  TCLPAT                                                   
                   |----  FLOAT                               External             
                   |----  TVOFFS                              External             
                   |----  IENDTP                              External             
                   |----  FTLCOO                              External             
   
 
3 TCLCOR
         SUBROUTINE TCLCOR(KTPAD,KTPDI,KTPUL,KTCLU,KTLRL,ISLOT,JGARB,IER)
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Analyze pulses and clusters
   
       Author:    R. Johnson    22-12-86
       Modified:  R. Johnson    19-01-88
   
       Input:
            - KTPAD     /I     Pointer to raw data hit bank
            - KTPDI     /I     Pointer to raw data sample bank
            - KTPUL     /I     Pointer to bank of pulses
            - KTCLU     /I     Pointer to bank of islands (clusters)
            - KTLRL     /I     Pointer to cluster rowlist bank
            - ISLOT     /I     Sector number to be analyzed
       Output:
            - KTPAD,KTPDI,KTPUL,KTCLU are updated if garbage collection
                                      is done.
            - JGARB     /I     Set to 1 if garbage collection is done
                               Set to 0 otherwise
            - IER       /I     Set to 1 if no room in BOS for name banks
                               Set to 2 if no room in BOS for work banks
                               Otherwise it is set to zero.
   
       Called from TPADS
   
       Description
       -----------
       This is the driver routine for TPC cluster analysis.  It is called
       once for each sector.  It creates the named banks TSCL and TSPU
       for output and some workbanks to be used by this module.  Then it
       loops over all clusters in TCLU and unpacks the raw data hits and
       samples, one cluster at a time, and calls TCLANA to analyze each
       cluster.  The rowlist bank TSRL also is filled at this time.
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   TPADS                                                                           
        |---- TCLCOR                                                               
                   |----  IBITS                               External             
                   |----  JPEDST                              External             
                   |----  WBANK                               External             
                   |----  INTCHA                              External             
                   |----  ITPTYP                              External             
                   |----  AUBOS                               External             
                   |----  BLIST                               External             
                   |----  VZERO                               External             
                   |----  MAX                                 External             
                   |----  NLINK                               External             
                   |----  RERROR                                                   
                   |----  MOD                                 External             
                   |----  FLOAT                               External             
                   |----  TVOFFS                              External             
                   |----  TPPROW                              External             
                   |----  INT                                 External             
                   |----  RTLCZW                              External             
                   |----  SQRT                                External             
                   |----  RTLCDM                              External             
                   |----  TCLSNG                                                   
                   |----  TCLANA                                                   
                   |----  TSCFIL                                                   
                   |----  NDROP                               External             
                   |----  WDROP                               External             
   
 
3 TCLDMP
         SUBROUTINE TCLDMP(IC,ISLOT,IUNIT)
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Dump a single tpc cluster
   
       Author:   R. Johnson    6-05-87
   
       Input:
           - IC         /I    Cluster index in TCLU
           - ISLOT      /I    Number of sector containing the cluster
           - IUNIT      /I    Logical unit number to dump to
   
       Called by TCDUMP
   
       Description
       ===========
       This routine dumps all information available about a single
       TPC cluster---raw data, subpulses, subclusters, and coordinates.
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   TCDUMP                                                                          
        |---- TCLDMP                                                               
                   |----  IBITS                               External             
                   |----  NLINK                               External             
                   |----  NAMIND                              External             
                   |----  MIN0                                External             
                   |----  IABS                                External             
                   |----  ISIGN                               External             
   
 
3 TCLPAT
         SUBROUTINE TCLPAT(NPADS,IFPN)
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Associate subpulses into subclusters
   
       Author:   R. Johnson    14-04-87
       Modified: R. Johnson    19-01-88
   
       Input:
           - NPADS    /I     Number of pads in the cluster
           - IFPN     /I     Pad number of first pad in cluster
   
       Called by TCLANA
   
       Description
       -----------
       This routine is called once for each cluster once the subpulses
       have been found and analyzed, the subpulses being stored in the
       workbank ITSPUW (see TCLCOW).  Starting at one end in r*phi of
       the cluster, for each subpulse it tries to find a match on
       the next pad.  A match is determined by the relative z positions
       of the subpulse peaks.  Once no more subpulses can be added,
       then the program goes back over those which have been picked up,
       and after first checking that the boundary subpulses do not
       overlap too much with pulses on the adjacent pads, the program
       analyzes the pulse height profile in r*phi.  All maximum
       and minimum points are marked, and then the group of subpulses
       is divided at each mimimum if it is low enough with respect to
       the adjacent peaks, resulting in the final subclusters.  The
       subclusters are marked as bad if they contain minima at which
       they could not be further divided.
   
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   TCLANA                                                                          
        |---- TCLPAT                                                               
                   |----  F                                   External             
                   |----  IPIDXW                              External             
                   |----  IF                                  External             
                   |----  JPSTIF                              External             
                   |----  IABS                                External             
                   |----  MAX                                 External             
                   |----  MIN                                 External             
                   |----  MOD                                 External             
                   |----  FTLCOO                              External             
                   |----  RERROR                                                   
                   |----  WBANK                               External             
   
 
3 TCLSNG
         SUBROUTINE TCLSNG
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Quick cluster analysis
   
       Author:    R. Johnson   04-02-88
       Modified:  R. Johnson   31-05-88
   
       Called by TCLCOR
   
       Description
       ===========
       This routine sets up the subcluster and subpulse workbanks of
       common TCLCOW under the assumption that the cluster consists
       of only a single subcluster (only one track).
   
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   TCLCOR                                                                          
        |---- TCLSNG                                                               
                   |----  RERROR                                                   
                   |----  WBANK                               External             
                   |----  FLOAT                               External             
   
 
3 TCLUDP
         SUBROUTINE TCLUDP(ISECT,IUNIT)
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Dump bos bank tclu
   
       Author:    R. Johnson  23-10-86
       Modified:  R. Johnson   6-05-87
   
       Called by TBPRNT
   
       Input:
            - ISECT   /I    Number of the sector to dump
            - IUNIT   /I    Fortran output logical unit number
   
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   TBPRNT                                                                          
        |---- TCLUDP                                                               
                   |----  NLINK                               External             
                   |----  FORMAT                              External             
   
 
3 TCLUST
         SUBROUTINE TCLUST(ISECT,NSECL,KTPAD,KTPDI,KTPRL,KTLRL,KTISL,
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
        &                                      KTCLU,KTPUL,JGARB,IER)
   Store tpc clusters and pulses
   
         Author:    D. Schlatter
         Modified:  R. Johnson    6-05-87
   
         Input:
            - ISECT    /I   Sector number to be analyzed
            - NSECL    /I   Upper limit on number of clusters in sector
            - KTPAD    /I   BOS offset to 'TPAD' bank
            - KTPDI    /I   BOS offset to 'TPDI' bank
            - KTPRL    /I   BOS offset to 'TPRL' bank
            - KTLRL    /I   BOS offset to 'TLRL' bank
            - KTISL    /I   BOS offset to 'TISL' bank
         Output:
            - KTPAD, etc.   updated if garbage collection done
            - KTCLU    /I   BOS offset to newly created cluster bank
            - KTPUL    /I   BOS offset to newly created pulse bank
            - JGARB    /I   =1 if garbage collection done, =0 otherwise
            - IER      /I   =1 if BOS runs out of space, =0 if all OK
                            =2 if sorting array overflows
   
         Called by TPADS
   
         Description
         ===========
         This routine decodes the cluster information stored by the TPP
         (or TISLND) in the TISL bank.  The TCLU bank is formed and
         filled with the cluster information, and the TPUL bank is
         filled with pointers into the raw data.  TPUL also will
         contain the z charge estimate and z position of each pulse.
         The pulses for each cluster are sorted into order of increasing
         or decreasing pad number.
   
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   TPADS                                                                           
        |---- TCLUST                                                               
                   |----  IBITS                               External             
                   |----  WBANK                               External             
                   |----  INTCHA                              External             
                   |----  ITPTYP                              External             
                   |----  AUBOS                               External             
                   |----  BLIST                               External             
                   |----  VZERO                               External             
                   |----  NLINK                               External             
                   |----  MIN0                                External             
                   |----  MAX0                                External             
                   |----  TPSORT                                                   
                   |----  RERROR                                                   
                   |----  WDROP                               External             
   
 
3 TCO4PA
         SUBROUTINE TCO4PA (IPADA, RPULS, PRFS2, RPH1, RPH2,IER)
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Tpc coordinates finding : 2 coordinates from 4 pads
     algorithms" (D). Uses 4 pads.
   
     Author:    Gigi Rolandi 7-09-89
   
     INPUT :
       I4/  IPADA      : indice of 1st pad of the four, in [1 .. NPADS].
       R4/  RPULS(ip): p heights for this cluster (in [1 ... 255] !).
       R4/  PRFS2    : width**2 (>0 !) of PRF.
   
     OUTPUT :
       R4/  RPH1     : 1st coordinate, in [1..NPADS].
       R4/  RPH2     : 2nd coordinate, in [1..NPADS].
       I4/  IER      : Error code 0=O.K.
   
     Called by ......
   
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   TWINCO                                                                          
        |---- TCO4PA                                                               
                   |----  EXP                                 External             
                   |----  SQRT                                External             
                   |----  FLOAT                               External             
   
 
3 TCOALG
         SUBROUTINE TCOALG(ISLOT,IROW,IQW,NPADS,RPULS,
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
        &                                    PRFS2,IPDMN,RPHI,QCO,IERY)
   Calculate r*phi position and charge of cluster.
   
     Author:    T. Pun        10-06-86
     Modified:  R. Johnson     8-04-88
     Modified:  A. Roth       14-12-89
                D. Casper     09-06-95  Add Gaussian charge estimate for
                                        pad dE/dx.
   
     Includes possibility of choosing algorithm, depending on NPADS.
     NPADS must be <= LMXPCL, because of lookup tables and vectors.
   
     Complete description of all algorithms : ALEPH-TPC Note 86-68,
     by Thierry Pun and Dieter Schlatter (especially APPENDIX).
   
     INPUT :
       I4/  ISLOT     : Sector number from which the cluster comes
       I4/  IROW      : Row number of the sector (not global)
       I4/  IQW       : =0 for isolated subcluster, =1 otherwise
       I4/  NPADS     : No. of pads in this cluster, in [2 ... LMXPCL].
       R4/  RPULS(ip) : P-heights for this cluster : ip in [1 ... NPADS],
       R4/  PRFS2     : pad response width
       I4/  IPDMN     : Minimum pad number in sector row for this cluster
   
     OUTPUT :
       R4/  RPHI      : r*phi coordinate in sector system.
       R4/  QCO       : charge of coordinate, using Gaussian estimator
       I4/  IERY      : Error code, > 0 if problem.
                       111      : (A) WSTD2 < eps.
                       121      : (B) negative logarithm.
                       131      : (C) threshold <= 1.0.
                       161      : (F) < 3 pads;
                       162      :     denominator = 0.
                       171      : (G) < 3 pads;
                       172      :     denominator < eps.
                       191      : (I) < 3 pads;
                       192      :     denominator < eps for r*phi;
                       193      :     PRFS2 < 0.
                       300      : illegal value of IALGTP.
                       300 + x  : alg number x does not exit.
                       350      : max pulse height at position 0.
                       400      : less than 2 pads.
                       400 + x  : > LMXPCL pads (x = NPADS - LMXPCL).
                       500      : RPhi outside physical bounds of
                                  cluster.  Check PRF and ratio
                                  of the pulse heights.
                       700      : Cluster peaks at sector edge
   
     OTHER INPUT PARAMETERS. . .
       from TPCCUT:
       I4/  IALGTP   : Algorithm(s) to use:
                       IALGTP < 10 : alg nr  1  2  3  4  5  6  7  9
                                     (letter A  B  C  D  E  F  G  I.
                       IALGTP = 3 digits integer IJK : if NPADS <= I,
                       then algorithm (J), else algorithm (K).
                       Ex : 2   --> alg 2 (B) whatever pad multiplicity.
                            321 --> if NPADS <= 3, then (B), else (A).
       R4/  ALGPTP   : INPUT by user. Real, for possible use in algs.
                       Currently needed for alg 3 (=C) : threshold.
       from TCOCOM:
       I4/  MOMPH1(ip): lookup 1st pad moments; initialized: TPLKUP.INC.
       I4/  MOMPH2(ip): lookup 2nd pad moments.
       I4/  MOMPH3(ip): lookup 3rd pad moments.
       I4/  MOMPH4(ip): lookup 4th pad moments.
   
     Called by TCOOR
   
     MODULES called:
            TCOWAV  : weighted average and standard-deviation^2;  alg A.
            TCOGS3  : 3 pads algorithm (3 equations, 3 unknowns); alg B.
            TCOTHR  : threshold algorithm;                        alg C.
            TCOWA2  : weighted avg of 2 "2 pads estimates";       alg D.
            TCOWA3  : weighted avg of 3 "2 pads estimates";       alg E.
            TCOUL2  : unweighted LSE, 2 unknown parameters;       alg F.
            TCOWL2  : weighted LSE, 2 unknown parameters;         alg G.
            TCOUL3  : unweighted LSE, 3 unknown parameters;       alg I.
   
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   TCOOR                                                                           
   TCOORT                                                                          
   TSAWIR                                                                          
        |---- TCOALG                                                               
                   |----  MOD                                 External             
                   |----  FORMAT                              External             
                   |----  RERROR                                                   
                   |----  ITPTYP                              External             
                   |----  TCOWAV                                                   
                   |----  TCOGS3                                                   
                   |----  TCOTHR                                                   
                   |----  TCOWA2                                                   
                   |----  TCQGS3                                                   
                   |----  TCOWA3                                                   
                   |----  TCOUL2                                                   
                   |----  TCOWL2                                                   
                   |----  TCOUL3                                                   
                   |----  FLOAT                               External             
                   |----  ALOG                                External             
                   |----  EXP                                 External             
                   |----  SQRT                                External             
   
 
3 TCOBIN
         SUBROUTINE TCOBIN(IER)
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Bin coordinates for pattern recognition
   
       Author:  R. Johnson     4-12-87
   
       Output:   IER     /I     Error return code=0 for good return
   
       Called by TRKFND
   
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   TRKFND                                                                          
        |---- TCOBIN                                                               
                   |----  NAMIND                              External             
                   |----  FLOAT                               External             
                   |----  RERROR                                                   
                   |----  WBANK                               External             
                   |----  INTCHA                              External             
                   |----  VZERO                               External             
                   |----  INT                                 External             
   
 
3 TCODRV
         SUBROUTINE TCODRV(IER)
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Driver for tpc coordinate finding
   
       Author:    R. Johnson 20-09-86
       Modified:  R. Johnson  8-04-88
   
       Output:  IER              =0 if all is OK; =1 for space overflow
                                                  =2 if input missing
   
       Input banks:
                TCLU              TPC pad clusters
                TSPU,TSCL         TPC pad subpulses and subclusters
                TSRL              TPC subcluster row list
                THPL,THRP         TPD bad pad lists
       Output banks:
                TPCO,TCRL         TPC coordinates and row list
                TBCO              TPC bad coordinates
              { TSCL              Fill pointers to coordinates }
       Called by TCODRV
   
       Description
       ===========
       This routine cycles through all subclusters in TSCL row by
       row (using the TSRL bank to point to row beginnings in
       TSCL) over all TPC sectors.  For each good cluster, a
       coordinate is calculated by TCOOR.   All coordinates for
       the entire TPC are filled into the TPCO bank and
       the bank TCRL is filled with pointers to the row beginnings
       in TPCO.  Also, TCOOR calculates a rough coordinate for each of
       those subclusters which fail, and it stores them in TBCO.  TCODRV
       also fills into TBCO a rough coordinate for each cluster which
       has no subcluster associated.
       NOTE:  This routine and the subroutines which it calls represent
              a module within JULIA.
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   TPREDA                                                                          
        |---- TCODRV                                                               
                   |----  IBITS                               External             
                   |----  NAMIND                              External             
                   |----  BDROP                               External             
                   |----  IF                                  External             
                   |----  AUBOS                               External             
                   |----  BLIST                               External             
                   |----  BWIND                               External             
                   |----  ITPTYP                              External             
                   |----  TCOOR                                                    
                   |----  MAX                                 External             
                   |----  WBANK                               External             
                   |----  INTCHA                              External             
                   |----  VZERO                               External             
                   |----  NLINK                               External             
                   |----  FLOAT                               External             
                   |----  TSCOOR                                                   
                   |----  TCTGLB                              External             
                   |----  AUBPRS                              External             
                   |----  RERROR                                                   
                   |----  WDROP                               External             
   
 
3 TCOERR
         SUBROUTINE TCOERR(ERRM,NPAD,WP,WZ,IQ)
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   -----*************************************--------------------------C
   Calculate the errors on tpc pad coordinates
   
       Author: Martin Poppe
       Date  : August 1987
       Modified:  R. Johnson   7-02-88
   
       INPUT:  NPAD = Number of pads contributing to subcluster
               WP   = Sub cluster width in R*PHI
               WZ   = Sub cluster widths in Z
               IQ   = total charge of subcluster
          ---- All input units as in 'TSCL' ---
   
       OUTPUT: SP2  = SIGMA**2(R*PHI)  [CM**2]  = ERRM(1)
               COV  = COV (R*PHI,Z)    [CM**2]  = ERRM(2)
               SZ2  = SIGMA**2(Z)      [CM**2]  = ERRM(3)
   
       This routine will be replaced by a database driven one after
       the final choice of the coordinate determination algorithm
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   TCOOR                                                                           
   TSAWIR                                                                          
   TWINCO                                                                          
        |---- TCOERR                                                               
                   |----  XZRPER                              External             
                   |----  CFZDER                              External             
   
 
3 TCOGS3
         SUBROUTINE TCOGS3 (IPADA, RPULS, RPHI, PRFS2, IERY)
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Tpc coordinates finding : three pads algorithm, gaussian pulse,
     three unknowns (B). Uses 3 pads.
   
     Author:    T. Pun      12-06-86
     Modified:  R. Johnson   8-04-88
   
     INPUT :
       I4/  IPADA      : indice of 1st pad of the three, in [1 .. NPADS].
       R4/  RPULS(ip): p heights for this cluster (in [1 ... 255] !).
   
     OUTPUT :
       R4/  RPHI     : coordinate, in [1..NPADS].
       R4/  PRFS2   : width**2 (>0 !) of gaussian pulse.
       I4/  IERY     : error flag = 121: negative logarithm.
   
     Called by TCOALG
   
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   TCOALG                                                                          
   TCOUL3                                                                          
        |---- TCOGS3                                                               
                   |----  ALOG                                External             
                   |----  FLOAT                               External             
   
 
3 TCOOR
         SUBROUTINE TCOOR(IROW,IC,KTCLU,KTSPU,KTSCL,KTHRP)
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Calculate coordinates from subclusters
   
       Author:    R. Johnson 20-09-86
       Modified:  R. Johnson  8-04-88
              D. Casper  09-06-95  Support for Gaussian charge estimator
                                   for pad dE/dx in call to TCOALG
              D. Casper  12-06-95  Support for low momentum track coords
                                   Store #pads in subcluster, instead of
                                   cluster, in TBCO
              D. Casper  24-04-96  Correct z for shaping effects
   
              D. Casper  26-02-97  modify alignment calls
   
                         05-08-97  Replace call to THPFDG with new routine
                                   THPCOR, to correct 1 half-pad coordinates
                                   too.
   
       Input:
          IROW     /I       Padrow number within the sector
          IC       /I       Subcluster number for this sector
          KTCLU    /I       BOS offset to TCLU cluster bank
          KTSPU    /I       BOS offset to TSPU subpulse bank
          KTSCL    /I       BOS offset to TSCL subcluster bank
          KTHRP    /I       BOS offset to THRP TPD threshold pointers
   
       Called by TCODRV
   
       Description
       ===========
       This routine cycles through all subclusters in TSCL row by
       row (using the TSRL bank to point to row beginnings in
       TSCL) over all TPC sectors.  For each good cluster, a
       coordinate is calculated by TCOALG.  All coordinates for
       the entire TPC are filled into the TPCO bank and
       the bank TCRL is filled with pointers to the row beginnings
       in TPCO.
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   TCODRV                                                                          
        |---- TCOOR                                                                
                   |----  NAMIND                              External             
                   |----  TPDHGT                              External             
                   |----  TPPROW                              External             
                   |----  TVOFFS                              External             
                   |----  IENDTP                              External             
                   |----  ITPTYP                              External             
                   |----  TGETQT                                                   
                   |----  TRMVEP                                                   
                   |----  TSZCOR                                                   
                   |----  TPRF2                                                    
                   |----  TCOALG                                                   
                   |----  TNHLFP                                                   
                   |----  THPCOR                                                   
                   |----  FLOAT                               External             
                   |----  TSCOOR                                                   
                   |----  TCTGLB                              External             
                   |----  TCOERR                                                   
                   |----  TLACOR                              External             
                   |----  TCRTOF                              External             
                   |----  TCRTRN                              External             
                   |----  TZCRVD                              External             
                   |----  TZCSVD                              External             
                   |----  TCORES                              External             
                   |----  TFICOR                              External             
   
 
3 TCOORT
         SUBROUTINE TCOORT(IER)
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Calculate corrected coordinates from initial track fit and initial
    coordinate bank
   
       Author:    D. Cinabro  6-12-89
       Modified:  R. Johnson 19-10-90
               D. Casper  25-04-95  Support for wire corrections to TPC
                                    coordinates. (Disable with TNLC card)
               D. Casper  09-06-95  Support for Gaussian charge estimator
                                    for pad dE/dx. (Disable with TNGS card).
               D. Casper  24-04-96  Correct subpulses for shaping effects
               D. Casper  07-06-96  Add wire coordinates, unless a TWNZ
                                    card is present.
                          05-08-97  Replace call to THPFDG with new routine
                                    THPCOR, to correct 1 half-pad coordinates
                                    too.
   
       Output:   IER      /I     Return code=0 if all is OK
   
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   TPCREC                                                                          
        |---- TCOORT                                                               
                   |----  NAMIND                              External             
                   |----  NLINK                               External             
                   |----  NDROP                               External             
                   |----  AUBOS                               External             
                   |----  BWIND                               External             
                   |----  MOD                                 External             
                   |----  ITPTYP                              External             
                   |----  ISLOTFORMAT                         External             
                   |----  RERROR                                                   
                   |----  TNHLFP                                                   
                   |----  TFILPA                                                   
                   |----  TGETQT                                                   
                   |----  TRMVEP                                                   
                   |----  TSZCOR                                                   
                   |----  TVOFFS                              External             
                   |----  IENDTP                              External             
                   |----  TPRF2                                                    
                   |----  TCOALG                                                   
                   |----  THPCOR                                                   
                   |----  UCOPY                               External             
                   |----  TERPAR                                                   
                   |----  TSCOOR                                                   
                   |----  TCTGLB                              External             
                   |----  TCRTOF                              External             
                   |----  TLACOR                              External             
                   |----  TCRTRN                              External             
                   |----  TZCRVD                              External             
                   |----  TZCSVD                              External             
                   |----  TCORES                              External             
                   |----  TFICOR                              External             
                   |----  MDROP                               External             
                   |----  TWIREZ                                                   
                   |----  TPPROW                              External             
                   |----  WDROP                               External             
   
 
3 TCOTHR
         SUBROUTINE TCOTHR (IPADA, RPULS, PRFS2, RPHI, IERY)
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Tpc coordinates finding : threshold algorithm, using two "2 pads
     algorithms" (C). Uses 3 pads.
   
     Author:    T. Pun      12-06-86
     Modified:  R. Johnson   8-04-88
   
     INPUT :
       I4/  IPADA      : indice of 1st pad of the three, in [1 .. NPADS].
       R4/  RPULS(ip): p heights for this cluster (in [1 ... 255] !).
       R4/  PRFS2    : width**2 (>0 !) of PRF.
   
     INPUT from COMMON /TPCCUT/ :
       R4/  ALGPTP   : threshold (>1) to choose ratio.
                      Assuming C2>C3>C1: (C2/C3) > ALGPTP, uses $C1,C3;
                                            "    <=   "  , uses $C2,C3.
     OUTPUT :
       R4/  RPHI     : coordinate, in [1..NPADS].
       I4/  IERY     : error flag = 131: threshold <= 1.
   
     Called by TCOALG
   
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   TCOALG                                                                          
        |---- TCOTHR                                                               
                   |----  FLOAT                               External             
   
 
3 TCOUL2
         SUBROUTINE TCOUL2 (NPADS, RPULS, PRFS2, RPHI, IERY, WSTD2)
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Tpc coordinates finding : unweighted least-squares estimation of
     amplitude and position, Gaussian pulse (F). Uses all NPADS pads.
   
     Author:    T. Pun      12-06-86
     Modified:  R. Johnson   8-04-88
   
     INPUT :
       I4/  NPADS     : # of pads in this cluster, in [2 ... LMXPCL].
       R4/  RPULS(ip): p heights for this cluster (in [1 ... 255] !).
       R4/  PRFS2   : width**2 (>0 !) of PRF.
   
     OUTPUT :
       R4/  RPHI     : coordinate, in [1..NPADS].
       I4/  IERY     : error flag = 161: < 3 pads;
                                    162: denominator = 0;
       R4/  WSTD2   : width**2 (>0 !) of PRF.
   
     MODULE(S) :
            TCOWAV   : computes weighted standard-deviation.
   
     Called by TCOALG
   
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   TCOALG                                                                          
        |---- TCOUL2                                                               
                   |----  TCOWAV                                                   
                   |----  ALOG                                External             
                   |----  FLOAT                               External             
   
 
3 TCOUL3
         SUBROUTINE TCOUL3 (NPADS, RPULS, DOSTD, RPHI, PRFS2, IERY)
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Tpc coordinates finding : unweighted least-squares estimation of
     the 3 parameters of a Gaussian pulse (I). Uses all NPADS pads.
   
     Author:    T. Pun      12-06-86
     Modified:  R. Johnson   8-04-88
   
     INPUT :
       I4/  NPADS     : # of pads in this cluster, in [2 ... LMXPCL].
       R4/  RPULS(ip): p heights for this cluster (in [1 ... 255] !).
       L4/  DOSTD    : if .TRUE. computes also PRFS2.
   
     OUTPUT :
       R4/  RPHI     : coordinate, in [1..NPADS].
       R4/  PRFS2   : width**2 (>0 !) of PRF.
                       If = 3 pads, obtained from 3 pads algorithm (B);
                       If > 3 pads, computed here, IF DOSTD is .TRUE..
       I4/  IERY     : error flag = 191: < 3 pads;
                                    192: denominator < eps for r*phi;
                                    193: PRFS2 < 0.
   
     MODULE(S) :
            TCOGS3   : 2 pads algorithm.
   
     Called by TCOALG
   
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   TCOALG                                                                          
        |---- TCOUL3                                                               
                   |----  TCOGS3                                                   
                   |----  ALOG                                External             
                   |----  FLOAT                               External             
                   |----  MOMPH4                              External             
                   |----  ABS                                 External             
   
 
3 TCOWA2
         SUBROUTINE TCOWA2 (IPADA, RPULS, PRFS2, RPHI)
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Tpc coordinates finding : weighted-avg of two "2 pads
     algorithms" (D). Uses 3 pads.
   
     Author:    T. Pun      12-06-86
     Modified:  R. Johnson   8-04-88
   
     INPUT :
       I4/  IPADA      : indice of 1st pad of the three, in [1 .. NPADS].
       R4/  RPULS(ip): p heights for this cluster (in [1 ... 255] !).
       R4/  PRFS2    : width**2 (>0 !) of PRF.
   
     OUTPUT :
       R4/  RPHI     : coordinate, in [1..NPADS].
   
     Called by TCOALG
   
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   TCOALG                                                                          
        |---- TCOWA2                                                               
                   |----  FLOAT                               External             
   
 
3 TCOWA3
         SUBROUTINE TCOWA3 (IPADA, RPULS, PRFS2, RPHI)
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Tpc coordinates finding : weighted-avg of three "2 pads
     algorithms" (E). Uses 3 pads.
   
     Author:    T. Pun      12-06-86
     Modified:  R. Johnson   8-04-88
   
     INPUT :
       I4/  IPADA      : indice of 1st pad of the three, in [1 .. NPADS].
       R4/  RPULS(ip): p heights for this cluster (in [1 ... 255] !).
       R4/  PRFS2    : width**2 (>0 !) of PRF.
   
     OUTPUT :
       R4/  RPHI     : coordinate, in [1..NPADS].
   
     Called by TCOALG
   
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   TCOALG                                                                          
        |---- TCOWA3                                                               
                   |----  FLOAT                               External             
   
 
3 TCOWAV
         SUBROUTINE TCOWAV (NPADS, RPULS, DOSTD, WAVG, WSTD2, IERY)
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Tpc coordinates finding : weighted avg and standard-dev**2, alg (a).
    Uses all NPADS pads.
   
     Author:    T. Pun      12-06-86
     Modified:  R. Johnson   8-04-88
   
     INPUT :
       I4/  NPADS     : # of pads in this cluster, in [2 ... LMXPCL].
       R4/  RPULS(ip): p heights for this cluster (in [1 ... 255] !).
       L4/  DOSTD    : if .TRUE. computes also WSTD2, otherwise not.
   
     OUTPUT :
       R4/  WAVG      : weighted-average, in [1..NPADS].
       R4/  WSTD2     : weighted standard-deviation**2; not modified if
                        DOSTD = .FALSE.
       I4/  IERY      : error flag = 111: WSTD2 < eps (ie. <0 or small).
   
     Called by TCOALG
   
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   TCOALG                                                                          
   TCOUL2                                                                          
   TCOWL2                                                                          
        |---- TCOWAV                                                               
                   |----  FLOAT                               External             
   
 
3 TCOWL2
         SUBROUTINE TCOWL2 (NPADS, RPULS, PRFS2, RPHI, IERY, WSTD2)
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Tpc coordinates finding : weighted least-squares estimation of
     amplitude and position, Gaussian pulse (G). Uses all NPADS pads.
   
     Author:    T. Pun      12-06-86
     Modified:  R. Johnson   8-04-88
   
     INPUT :
       I4/  NPADS     : # of pads in this cluster, in [2 ... LMXPCL].
       R4/  RPULS(ip): p heights for this cluster (in [1 ... 255] !).
       R4/  PRFS2   : width**2 (>0 !) of PRF.
   
     OUTPUT :
       R4/  RPHI     : coordinate, in [1..NPADS].
       I4/  IERY     : error flag = 171: < 3 pads.
                                   172: denominator < eps.
       R4/  WSTD2   : width**2 (>0 !) of PRF.
   
     MODULE(S) :
            TCOWAV   : computes weighted standard-deviation.
   
     Called by TCOALG
   
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   TCOALG                                                                          
        |---- TCOWL2                                                               
                   |----  ALOG                                External             
                   |----  TCOWAV                                                   
                   |----  FLOAT                               External             
                   |----  ABS                                 External             
   
 
3 TCPTST
         SUBROUTINE TCPTST(IER)
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Create bank for tpc reconstruction status
    Author:  R. Johnson    20-5-91
    Modified: W. Wiedenmann  3-2-92
                 handle new banks TE1R,TANF,TWNF,TSIR
    Modified: G. Ganis      25-4-94
                 handle new bank TOER
    Output:   IER        /I      Error code nonzero if BOS error occurs
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   TPREDA                                                                          
        |---- TCPTST                                                               
                   |----  NAMIND                              External             
                   |----  AUBOS                               External             
                   |----  NLINK                               External             
                   |----  TPPADD                                                   
                   |----  SBIT1                               External             
                   |----  JBIT                                External             
   
 
3 TCQGS3
         SUBROUTINE TCQGS3 (IPADA, RPULS, QCO, IERY)
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Compute coordinate charge assuming gaussian; based on tcogs3
   
     Author:    T. Pun      12-06-86
     Modified:  R. Johnson   8-04-88
                D. Casper    5-04-95 Create TCQGS3 from TCOGS3
   
     INPUT :
       I4/  IPADA      : indice of 1st pad of the three, in [1 .. NPADS].
       R4/  RPULS(ip): p heights for this cluster (in [1 ... 255] !).
   
     OUTPUT :
       R4/  QCO     : area under Gaussian = coordinate charge
       I4/  IERY     : error flag = 121: negative logarithm.
   
     Called by TCOALG
   
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   TCOALG                                                                          
        |---- TCQGS3                                                               
                   |----  ALOG                                External             
                   |----  FLOAT                               External             
                   |----  EXP                                 External             
                   |----  SQRT                                External             
   
 
3 TCSHF1
         SUBROUTINE TCSHF1( DELIN, DELOUT ,IBAD)
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Shifts coordinates derived from sub-clusters with one half-
    pad by the empirically known mean-offset. It is assumed
    that the calibration of the half-pad pulseheights has been
    applied before this.
   ---           SUBROUTINE TCSHF1
                =================
             AUTHOR: T.LOHSE        9.Mar 1989
                     D.CASPER       6.Aug 1997 Create from TCSHFT
       INPUT:    DELIN  distance of the r-phi coordinate with two
                        half-pads to the boundary between the
                        half-pads. DELIN must be positive in the
                        coordinate lies towards the INSIDE of the
                        sector, otherwise negative.
       OUTPUT:   DELOUT as DELIN after the correction for the
                        known coordinate shift (same sign
                        convention).
                 IBAD is not equal to zero if the coordinate
                      is too far out to be shifted.
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   THPCOR                                                                          
        |---- TCSHF1                                                               
                   |----  NAMIND                              External             
                   |----  RERROR                                                   
   
 
3 TCSHFT
         SUBROUTINE TCSHFT( DELIN, DELOUT ,IBAD)
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Shifts coordinates derived from sub-clusters with two half-
    pads by the empirically known mean-offset. It is assumed
    that the calibration of the half-pad pulseheights has been
    applied before this.
   ---           SUBROUTINE TCSHFT
                =================
             AUTHOR: T.LOHSE        9.Mar 1989
       INPUT:    DELIN  distance of the r-phi coordinate with two
                        half-pads to the boundary between the
                        half-pads. DELIN must be positive in the
                        coordinate lies towards the INSIDE of the
                        sector, otherwise negative.
       OUTPUT:   DELOUT as DELIN after the correction for the
                        known coordinate shift (same sign
                        convention).
                 IBAD is not equal to zero if the coordinate
                      is too far out to be shifted.
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   THPCOR                                                                          
   THPFDG                                                                          
        |---- TCSHFT                                                               
                   |----  NAMIND                              External             
                   |----  RERROR                                                   
   
 
3 TERPAR
         SUBROUTINE TERPAR( PCA, ZCO, TALA, NHP, ICOR, SIGRFI, SIGZ )
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Parameterize tpc coordinate errors after the initial fit
   ---        TPC error parametrization
             Author: T.LOHSE        7.DEC 1989
             Modified: R. Johnson  20-OCT-1990
                       To read database if necessary
                       D. Casper   12-Jun-1995
                       Treat wire-corrected coordinates
                       Replace TERN bank with TLCE
       INPUT:    PCA   Pad-crossing angle at coordinate [rad]
                 ZCO   Z coordinate value [cm]
                 TALA  TAN(DIP ANGLE)    (global track parameter)
                 NHP   Number of half-pads in this coordinate
                 ICOR  Wire correction flag
                       First two digits flag Landau corrections
                       0 = neither coordinate was corrected
                       1 = z coordinate (only) corrected
                      10 = rphi coordinate (only) was corrected
                      11 = both rphi and z coordinates corrected
                       Higher digits indicate that the coordinate
                       has wire data in TWZZ
                  ####XX = row of TWZZ bank containing wire
       OUTPUT:   SIGRFI   Error on R*PHI coordinate  [cm]
                 SIGZ     Error on Z coordinate  [cm]
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   FTPCER                                                                          
   TCOORT                                                                          
   TPK1CO                                                                          
        |---- TERPAR                                                               
                   |----  NAMIND                              External             
                   |----  RERROR                                                   
                   |----  AGETDB                              External             
                   |----  MOD                                 External             
                   |----  ABS                                 External             
                   |----  ATAN                                External             
                   |----  TAN                                 External             
                   |----  SQRT                                External             
   
 
3 TFCAND
         SUBROUTINE TFCAND(IER)
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Assemble tpc chains to track candidates
   
       AUTHOR        :- MARTIN POPPE 87/5/25
       Modified      :- Robert Johnson 88/9/14
       Modified      :- Marco Cattaneo 99/12/09
         Kill hits on a chain if there are more than 21 pad rows in the chain,
         due to pattern recognition error that should never happen.....
   
       OUTPUT: IER  = ERROR CODE: =0 IF OK, =1 IF INCOMPLETE
   
       INPUT  BANKS  : 'TCHA' , 'TCTC' , 'TLNK'
       OUTPUT BANKS  : 'TCAL' , 'TTCC' , 'TARC', 'TATC'
   
       DESCRIPTION
       ===========
   
       According to the table of links between chains provided by
       the bank 'tlnk', sets of chains are assembled to form the
       so called track candidates. Track candidates are sets of
       tpc pad coordinates which are assumed to originate in the
       same particle. the coordinates are ordered according to
       their path of flight. For non spiraling tracks, this path
       is assumed to point away from the beam line. For spiraling
       tracks, the order is deduced from the assumption that
       the particles loose energy as they traverse the chamber.
       All pad coordinates that belong to a chain will also
       belong to a track candidate. Every chain will be part
       of exactly one track candidate.
       Also, the TARC and TATC banks are filled with the chains
       which are not in the first arc of a track candidate.
       This is done in order to make available the helix parameters
       of the extra loops of track candidates.
   
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   TPCREC                                                                          
        |---- TFCAND                                                               
                   |----  NAMIND                              External             
                   |----  BDROP                               External             
                   |----  BLIST                               External             
                   |----  AUBOS                               External             
                   |----  WBANK                               External             
                   |----  INTCHA                              External             
                   |----  VZERO                               External             
                   |----  F                                   External             
                   |----  ABS                                 External             
                   |----  FLOAT                               External             
                   |----  SQRT                                External             
                   |----  IOR                                 External             
                   |----  RERROR                                                   
                   |----  SIGN                                External             
                   |----  AUBPRS                              External             
                   |----  WDROP                               External             
   
 
3 TFCHEK
           SUBROUTINE TFCHEK(VV0,LTASSO,IERR)
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Check tpc helix parameters for basic sanity
    Input:       VV0(5)    helix fit(R*4)
                 LTASSO    helix convention(L)
                           .TRUE. if TASSO convention used
                           .FALSE. if ALEPH (standard) convention used
    Output:      IERR      error code (I*4)
                           0 = no problem
                    non-zero = fit appears to be garbage
                 D. Casper  09/07/97
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   TFITTK                                                                          
   TFLNK2                                                                          
   UCTGFT                                                                          
        |---- TFCHEK                                                               
                   |----  SIGN                                External             
                   |----  UCOPY                               External             
                   |----  ALFIEL                              External             
                   |----  ABS                                 External             
                   |----  ATAN                                External             
                   |----  COS                                 External             
                   |----  RERROR                                                   
   
 
3 TFILPA
         SUBROUTINE TFILPA(KCO,KTR,PADCRO,WIRCRO)
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Return pad and wire crossing angles of a track
   
      Author   :- A. Roth, D.Cinabro        14-DEC-1989
      Modified:   R. Johnson                20-OCT-1990
                  Changes so it can be used in FTPCER
                  Cleaned out code not being used.
                  Return results in arg list instead of common block.
                  Redo calculation using standard ALEPHLIB routines.
   
      Inputs: KCO = Pointer to the row in the TPCO bank
              KTR = Pointer to row in TGFT or FRFT bank
      Output:
         PADCRO    = Pad crossing angle of a track
                         0=parallel to the pad
         WIRCRO    = Wire crossing angle of a track
                         0=perpendicular to the wire
   
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   FTPCER                                                                          
   TCOORT                                                                          
   TPADDX                                                                          
   TPK1CO                                                                          
        |---- TFILPA                                                               
                   |----  THLCIR                              External             
                   |----  SQRT                                External             
                   |----  TGHPTS                              External             
   
 
3 TFILTJ
         SUBROUTINE TFILTJ(IER)
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Fill bank ptun with constants for packing and unpacking
    of TPC data to and from the POT.
   
       Author:   R. Johnson   15-06-88
       Modified: W. Wiedenmann 3-10-91
                 This is a modified version of TFILTU on
                 ALEPHLIB for JULIA to write out the
                 packing constants (PTUN) with the run header
   
                 D. Casper 26-03-97
                 Allow errors to be packed into two bytes instead of
                 one, to allow accurate refitting.  Scale factors
                 changed accordingly.
   
       Output:   IER       /I    Error return=0 if operation successful
   
       Called by TINIRU
   
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   TINIRU                                                                          
        |---- TFILTJ                                                               
                   |----  AUBOS                               External             
   
 
3 TFITHL
         SUBROUTINE TFITHL(NPT,XF,YF,RF,PF,WF,ZF,WZF,IOPT,
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
        1                  VV0,EE0,CH2PH,CH2Z)
   Fast helix fit
     A generalization of the TFTHEL routine to allow it to be called
     from a routine that contains any list of x and y values XF,YF for a
     set of NPT points to be fitted.
     Input:  NPT    /I     Number of 3-D points to be fit
             XF     /R     Array of X-values of points to be fit
             YF     /R     Array of Y-values of points to be fit
             RF     /R     Array of R-values of points to be fit
             PF     /R     Array of PHI-values of points to be fit
             WF     /R     Array of 1/(sig(rphi))**2 for each point
             ZF     /R     Array of Z-values of points to be fit
             WZF    /R     Array of 1/(sig(z))**2 for each point
             IOPT = 0 -> DISTANCE**2=X**2+Y**2 MINIMISED
                    1 -> WEIGHTED WITH 1/SIMA(R*PHI)**2
                    2 -> ERROR MATRIX CALCULATED
                    3 -> 3-DIMENSIONAL ITERATION
    OUTPUT:   VV0 = 1/R*CHARGE   [1/CM]  POS. IF CLOCKWISE
                    TAN(LAMBDA)  {=DZ/DS}TAN(ANGLE TO X,Y PLANE)
                    PHI0         {0,2PI} ANGLE TO X-AXIS
                    D0*SIGN      [CM]    MINIMAL DIST. TO Z-AXIS,
                                         POS. IF AXIS ENCIRCLED
                    Z0           [CM]    Z POS AT R=D0
            EE0 = INVERSE OF ERROR MATRIX IN TRIANG. FORM
            CH2PH = CHI SQUARED = SUM (PHI DEVIATIONS/ERRORS)**2
            CH2Z  = CHI SQUARED = SUM (Z DEVIATIONS/ERRORS)**2
    NOTE: DEGREES OF FREEDOM = 2*NPT-5
       BASED ON  SUBROUTINE CIRCLE
       REFERENCE:  COMPUTER PHYSICS COMMUNICATIONS VOL 33,P329
     AUTHORS:  N. CHERNOV, G. OSOSKOV & M. POPPE
     Modified by:  Fred Weber, 8 Jun 1989
     Modified by:  M.Cattaneo, 27-Jan-1998 Protect against arg SIN > 1.0
     Modified by:  D.Smith,    27-Ovt-1999 Double precision fixes for Linux
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   TFTHEL                                                                          
   TRFTCH                                                                          
   TSACHA                                                                          
   YKVDET                                                                          
        |---- TFITHL                                                               
                   |----  RERROR                                                   
                   |----  FLOAT                               External             
                   |----  ABS                                 External             
                   |----  DBLE                                External             
                   |----  DSQRT                               External             
                   |----  DASIN                               External             
                   |----  ASIN                                External             
                   |----  SQRT                                External             
                   |----  OV                                  External             
                   |----  SMINV                               External             
                   |----  SMAV                                External             
                   |----  V1                                  External             
                   |----  DV                                  External             
   
 
3 TFITKF
         SUBROUTINE TFITKF(IER)
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Refit tgft tracks using kalman filter
     Remove hits flagged as outliers from coordinate list
   
         Created: 23-OCT-1995    D.Casper
   
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   TPCREC                                                                          
        |---- TFITKF                                                               
                   |----  NAMIND                              External             
                   |----  RERROR                                                   
                   |----  UCOPY                               External             
                   |----  UFDALI                              External             
                   |----  FDETCO                                                   
                   |----  SNGL                                External             
                   |----  FRMHIT                                                   
   
 
3 TFITTK
         SUBROUTINE TFITTK(IER)
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Fit tpc track candidates and produce tpc tracks
   
       AUTHOR        :- MARTIN POPPE 87/9/25
       Modified      :  I.Tomalin    12/3/94
                        Protection put in requiring chains to have at
                        least 3 coords. (Necessary because TOVRLP
                        sometimes leaves chains with less than this).
                     :  D.Casper     09/5/97
                        Protect against crazy fits by calling sanity check
   
       INPUT  BANKS  : 'TCAL' , 'TTCC' , 'TPCO'
       OUTPUT BANKS  : 'T1FT' , 'T1TL' , 'T1CL'
   
       DESCRIPTION
       ===========
       THE HELIX PARAMETERS OF ALL TRACK CANDIDATES ARE FITTED.
       TRACKS WITH A BAD CHI**2 PROBABILITY ARE MASSAGED:
       FIRST, IT IS TRIED TO IMPROVE THE FIT BY EXCLUDING
       THE POINT WITH THE LARGEST CONTRIBUTION TO CHI**2.
       IF THIS METHOD DOES NOT LEAD TO AN ACCEPTABLE TRACK,
       A KINK SEARCH "A LA STIMPFL" IS MADE: THE CRITERIUM FOR
       A KINK IS THAT THE DIFFERENCE IN CHI**2 BETWEEN THE "BEST"
       KINK POINT AND THE "WORST" KINK POINT HYPOTHESIS IS
       LARGER THAN A CUT VALUE (CALLED DCM IN THIS PROGRAM).
       IF A KINK HAS BEEN FOUND, THE TRACK IS SPLIT INTO TWO PIECES.
       IF THE FIT PROBABILITY OF ONE OF THESE PIECES IS TOO LOW,
       THE POINT(S) WITH THE LARGEST CONTRIBUTION TO CHI**2
       ARE REMOVED.
       FOR THE REMAINING TRACK CANDIDATES, POINTS
       OF A TRACK CANDIDATE ARE THROWN AWAY "ONE BY ONE" TO OBTAIN
       A BEST FIT.
       IF NEITHER MASSAGE HELPS, THE TRACK CANDIDATE (OR A PIECE
       THEREOF IN CASE OF A KINK) IS THROWN AWAY.
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   TPCREC                                                                          
        |---- TFITTK                                                               
                   |----  NAMIND                              External             
                   |----  BDROP                               External             
                   |----  WBANK                               External             
                   |----  AUBOS                               External             
                   |----  TMSHEL                                                   
                   |----  PROB                                External             
                   |----  TFCHEK                                                   
                   |----  TMSHEC                                                   
                   |----  TKINK                                                    
                   |----  TREMPT                                                   
                   |----  AUBPRS                              External             
                   |----  BLIST                               External             
                   |----  UCTGFT                                                   
                   |----  RERROR                                                   
                   |----  WDROP                               External             
   
 
3 TFLNK2
         SUBROUTINE TFLNK2(IER)
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Finds links between pairs of tracks in the tpc.
    If the chi**2 of the combined fit is too bad the point
    with the largest contribution to the chi**2 is rejected
    and the fit is repeated. A maximum of 2 points can be removed.
    Input banks:  T1FT, T1TL, T1CL
    Output banks: TGFT, TGTL, TGCL
    Author : LL. Garrido 30/5/1989
    Modified:  R. Johnson   29-05-91
    Modified:  P. Colrain   01-08-95
               Treatment of track candidates (2 linked tracks)
               is now consistent with that in TFITTK, the main
               TPC track fitting routine
               D. Casper    09-07-97
                Check for bogus fits
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   TPCREC                                                                          
        |---- TFLNK2                                                               
                   |----  NAMIND                              External             
                   |----  RERROR                                                   
                   |----  NDROP                               External             
                   |----  AUBOS                               External             
                   |----  NLINK                               External             
                   |----  BLIST                               External             
                   |----  WBANK                               External             
                   |----  SBIT1                               External             
                   |----  IAND                                External             
                   |----  SQRT                                External             
                   |----  ABS                                 External             
                   |----  ACOS                                External             
                   |----  UFITMS                                                   
                   |----  PROB                                External             
                   |----  TFCHEK                                                   
                   |----  NINT                                External             
                   |----  UCOPY                               External             
                   |----  AUBPRS                              External             
                   |----  WDROP                               External             
   
 
3 TFLNKS
         SUBROUTINE TFLNKS(IER)
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Find tpc links between chains
   
       AUTHOR        :- MARTIN POPPE 87/5/25
       Modified      :  P. Colrain 95/10/26
                        D. Casper  98/2/04  Correct typo in "long-range" code
                                            Select best link, not first...
   
       OUTPUT:  IER = ERROR CODE:  =0 IF OK, =1 IF INCOMPLETE
   
       INPUT  BANKS  : 'TCHA' , 'TCTC'
       OUTPUT BANK   : 'TLNK'
   
   
       DESCRIPTION
       ===========
   
       Creates a table of links between chains defining
       which chains belong to the same particle. This table is
       stored in the bank 'TLNK' which has as many rows as there
       are chains. Four types of links  are possible: "up", "down"
       "top" , and "bottom". These links are stored in columns 1 to 4.
       For example, the number 16 in row 3 of column 10 means that
       there is a "top" link between chains 10 an 16, i.e. this is
       a spiraling particle.
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   TPCREC                                                                          
        |---- TFLNKS                                                               
                   |----  ABS                                 External             
                   |----  NAMIND                              External             
                   |----  TPDRST                              External             
                   |----  RERROR                                                   
                   |----  BDROP                               External             
                   |----  AUBOS                               External             
                   |----  BLIST                               External             
                   |----  IAND                                External             
                   |----  ALOG                                External             
                   |----  FLOAT                               External             
                   |----  TFTHEL                                                   
                   |----  IOR                                 External             
                   |----  AMOD                                External             
                   |----  TPPROW                              External             
                   |----  IBUF2                               External             
   
 
3 TFPCOI
         SUBROUTINE TFPCOI(IER)
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Create bank pcoi with supplementary coordinate information
    Author:  R. Johnson    12-12-89
    Modified: D.Cinabro    31-05-90 to include info on 1/2 pads and length
              D. Casper    24-04-95 include information on Landau corrections
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   TJTOP                                                                           
        |---- TFPCOI                                                               
                   |----  NAMIND                              External             
                   |----  BWIND                               External             
                   |----  BDROP                               External             
                   |----  AUBOS                               External             
                   |----  MOD                                 External             
                   |----  ITPTYP                              External             
                   |----  TNHLFP                                                   
                   |----  AUBPRS                              External             
                   |----  WDROP                               External             
   
 
3 TFTHEL
         SUBROUTINE TFTHEL(NAME,NPT,LIST,IOPT,VV0,EE0,CHI2)
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   -----**************************************************---------C
   Fast fitting routine for helices
       AUTHORS:  N. CHERNOV, G. OSOSKOV & M. POPPE
       INPUT: NAME  = NAME OF THE BANK CONTAINING COORDINATES
               NPT  = NUMBER OF POINTS TO BE FITTED
               LIST = LIST OF POINTS TO BE FITTED
               IOPT = 0 -> DISTANCE**2=X**2+Y**2 MINIMISED
                      1 -> WEIGHTED WITH 1/SIMA(R*PHI)**2
                      2 -> ERROR MATRIX CALCULATED
                      3 -> 3-DIMENSIONAL ITERATION
     OUTPUT:   VV0 = 1/R*CHARGE   [1/CM]  POS. IF CLOCKWISE
                     TAN(LAMBDA)  {=DZ/DS}TAN(ANGLE TO X,Y PLANE)
                     PHI0         {0,2PI} ANGLE TO X-AXIS
                     D0*SIGN      [CM]    MINIMAL DIST. TO Z-AXIS,C
                                          POS. IF AXIS ENCIRCLED
                     Z0           [CM]    Z POS AT R=D0
               EE0 = INVERSE ERROR MATRIX IN TRIANG. FORM
               CHI2= CHI SQUARED = SUM (DEVIATIONS/ERRORS)**2
     NOTE: DEGREES OF FREEDOM = 2*NPT-5
       BASED ON  SUBROUTINE CIRCLE
       REFERENCE:  COMPUTER PHYSICS COMMUNICATIONS VOL 33,P329
     Modified on 8-Jun-89 to allow interface on a lower level to old
     algorithm by Fred Weber; now calls old algorithm in form of new
     routine TFITHL.
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   TATWIN                                                                          
   TFLNKS                                                                          
   TKINK                                                                           
   TREMPT                                                                          
        |---- TFTHEL                                                               
                   |----  NAMIND                              External             
                   |----  RERROR                                                   
                   |----  COS                                 External             
                   |----  SIN                                 External             
                   |----  TFITHL                                                   
   
 
3 TFTPAD
         SUBROUTINE TFTPAD
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Remove garbage pulses from tpc raw pad data
       Any pulse with T0=0 is removed, along with its digitizations.
       If any other sort of error is found in the hit list, then
       the sector is skipped and TPRLST will take care of it.
   
      Author   :- Robert P. Johnson     27-MAY-1991
   
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   TPREDA                                                                          
        |---- TFTPAD                                                               
                   |----  NAMIND                              External             
                   |----  NLINK                               External             
                   |----  ITPTYP                              External             
                   |----  IBITS                               External             
                   |----  MOD                                 External             
                   |----  RERROR                                                   
                   |----  MVBITS                              External             
                   |----  AUBOS                               External             
   
 
3 TFTWTB
         SUBROUTINE TFTWTB(ISLOT,JGARB)
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Fill the twtb bank
   
       Author:   R. Johnson     21-02-89
       Modified: R. Johnson     21-01-91  hard cut on wire residual for
                                          good wire hits
                                11-08-91  wire number and edge corrects.
                                          and fixes for 2-track dedx
                                24-08-92  include null wire hits
                                2-3-93    database control of constants
                                5-9-93    get rid of TWPU and add DZNLTW
       Modified: W. Wiedenmann   6-07-93  suppress error message #6 for
                                          wire# 220 in islot=4
                                          (t0 measurement)
   
                 D. Casper     26-07-98   suppress missed hits if they
                                          will not be used
   
       Input:  ISLOT       /I   TPC sector slot number
       Output: JGARB       /I   2 if BOS runs out or space
                                1 if BOS collected garbage
       Called by TRKWRA
   
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   TRKWRA                                                                          
        |---- TFTWTB                                                               
                   |----  NAMIND                              External             
                   |----  TPPROW                              External             
                   |----  TPDRST                              External             
                   |----  ITPTYP                              External             
                   |----  PWDPCL                              External             
                   |----  MIN                                 External             
                   |----  IENDTP                              External             
                   |----  NLINK                               External             
                   |----  RERROR                                                   
                   |----  WBANK                               External             
                   |----  IBITS                               External             
                   |----  ITLWIF                              External             
                   |----  ITLWIL                              External             
                   |----  FLOAT                               External             
                   |----  TWIRLE                              External             
                   |----  ABS                                 External             
                   |----  SIGN                                External             
                   |----  SQRT                                External             
                   |----  ATAN2                               External             
                   |----  TVOFFS                              External             
                   |----  AUBOS                               External             
                   |----  EDGECL                              External             
                   |----  MOD                                 External             
                   |----  WDROP                               External             
   
 
3 TGETQT
         SUBROUTINE TGETQT(IROW,KTSCL,IC,KTSPU,IQE,ITE,TANL,RPULS,
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
        &                                RTIME,NPUL,K1,IFLG)
   Make charge and time lists for coordinates
   
       Author:    R. Johnson  03-08-87
       Modified:  R. Johnson  08-04-88
                  D. Casper   25-04-96   Support for shaping correction
                              20-05-97   Restrict tan(lambda) to range +/-3
   
       Input:
          - IROW      /I     Sector row number
          - KTSCL     /I     Pointer to subcluster bank in BOS
          - IC        /I     Row number of the subcluster in TSCL
          - KTSPU     /I     Pointer to subpulse bank in BOS
          - IQE       /I     Charge algorithm; see ChargeAlg of TLCT
          - ITE       /I     Time algorithm
          - TANL      /I     tan(lambda) for shaping correction
       Output:
          - RPULS     /R     List of charge estimates
          - RTIME     /R     List of time estimates
          - NPUL      /I     Number of values of RPULS and RTIME
          - K1        /I     First pulse in RPULS and RTIME
          - IFLG      /I     Quality flag   =0 for a good subcluster
                             600  : Cluster of two half pads only.
                             601  : Long cluster with two half pads.
                             602  : Outer half pad has larger ph. than
                                    the inner one.
   
       Called by TCOOR
   
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   TCOOR                                                                           
   TCOORT                                                                          
   TSAWIR                                                                          
   TWINCO                                                                          
        |---- TGETQT                                                               
                   |----  ITPTYP                              External             
                   |----  MIN                                 External             
                   |----  ABS                                 External             
                   |----  EXP                                 External             
                   |----  FLOAT                               External             
                   |----  THPADD                                                   
   
 
3 TGFTDP
         SUBROUTINE TGFTDP(IUNIT)
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Dump bos bank tgft
   
       Author:    D. Schlatter 10.6.87
   
       Input:
            - IUNIT   /I    Fortran output logical unit number
   
       Called by TPCREC at TPC debug level of 2
   
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   TPCREC                                                                          
        |---- TGFTDP                                                               
                   |----  NAMIND                              External             
   
 
3 TGMADP
         SUBROUTINE TGMADP(IUNIT)
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Dump banks tgma and tmtl
    Author:  R. Johnson   10-1-89
    Input   IUNIT    /I    FORTRAN output logical unit number
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   TPCREC                                                                          
        |---- TGMADP                                                               
                   |----  NAMIND                              External             
   
 
3 THPADD
         FUNCTION THPADD(PHIN,PHOUT)
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Add ph of two half pads
   
       Author:      R. Johnson  17-10-86
       Modified:    A. ROTH     01-03-90
   
       Input:
            - PHIN    /R   Pulse height of inner half pad
            - PHOUT   /R   Pulse height of outer half pad
   
       Called by:  TCOALG
   
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   TGETQT                                                                          
        |---- THPADD                                                               
                   |----  NAMIND                              External             
                   |----  RERROR                                                   
   
 
3 THPCOR
         SUBROUTINE THPCOR(NHALF,IPDMN,ISLOT,IROW,RPHI,RFUDG,IERY)
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Fudge the coordinate location in case two half pads are used
    R. Johnson     13-3-90
    D. Casper      06-08-97 create THPCOR from THPFDG, to handle
                            corrections for 1 half-pad coords as well
    Input:  NHALF     /I      Number of half-pads in coordinate
            IPDMN     /I      1st pad number in the cluster
            ISLOT     /I      TPC sector slot number
            IROW      /I      Row number in the sector
            RPHI      /R      Uncorrected RPHI in pad units
    Output: RFUDG     /R      Corrected RPHI
            IERY      /I      Error code.  Chuck this coordinate if
                              not zero.
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   TCOOR                                                                           
   TCOORT                                                                          
   TSAWIR                                                                          
        |---- THPCOR                                                               
                   |----  ITPTYP                              External             
                   |----  TPDSEP                              External             
                   |----  TCSHF1                                                   
                   |----  TCSHFT                                                   
                   |----  FLOAT                               External             
   
 
3 THPFDG
         SUBROUTINE THPFDG(IPDMN,ISLOT,IROW,RPHI,RFUDG,IERY)
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Fudge the coordinate location in case two half pads are used
    R. Johnson     13-3-90
    Input:  IPDMN     /I      1st pad number in the cluster
            ISLOT     /I      TPC sector slot number
            IROW      /I      Row number in the sector
            RPHI      /R      Uncorrected RPHI in pad units
    Output: RFUDG     /R      Corrected RPHI
            IERY      /I      Error code.  Chuck this coordinate if
                              not zero.
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
              THPFDG                                                               
                   |----  ITPTYP                              External             
                   |----  TPDSEP                              External             
                   |----  TCSHFT                                                   
                   |----  FLOAT                               External             
   
 
3 THTROW
         SUBROUTINE THTROW(HP,IFLG)
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Check which tpc rows are hit by a given track
    R. Johnson    12-6-90
    Input(6) HP(6)     /R    Helix parameters in the ALEPH frame,
                             as from the FRFT bank
    Output:  IFLG(21)  /I    Flag for each padrow
                                 1= padrow is hit by this track
                                 0= not hit
    Banks needed:  TCLU
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   FCFRID                                                                          
        |---- THTROW                                                               
                   |----  IBSET                               External             
                   |----  TPDINT                              External             
                   |----  BWIND                               External             
                   |----  ITPTYP                              External             
                   |----  FLOAT                               External             
                   |----  TPDSEP                              External             
                   |----  IENDTP                              External             
                   |----  TVOFFS                              External             
                   |----  WDROP                               External             
   
 
3 TINIJO
         SUBROUTINE TINIJO
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Initialize job for tpc
   
       Author:   R. Johnson    15-04-87
       Modified: J.Knobloch    23-03-89
       Modified: R. Johnson    21-01-91   clean up unused flags
       Modified: D. Casper     04-11-95   add pad dE/dx monitoring
                               05-03-97   change default for TOPT 'TWPU';
                                          the bank TWPU is necessary for
                                          TPC wire coordinates
   
       Description
       ===========
       This routine is called once at the JOB beginning to
       initialize the TPC part of the reconstruction program.
   
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   RINJOB                                                                          
        |---- TINIJO                                                               
                   |----  TBNKIN                                                   
                   |----  TLINIT                                                   
                   |----  UCOPY                               External             
                   |----  NAMIND                              External             
                   |----  CHAINT                              External             
   
 
3 TINIRU
         SUBROUTINE TINIRU
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Initialize run for the tpc
   
       Author:   R. Johnson   15-04-87
       Modified: R. Johnson    8-04-88
   
       Description
       -----------
       At each run beginning, this routine fills common blocks with
       constants need for TPC reconstruction.
   
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   RINRUN                                                                          
        |---- TINIRU                                                               
                   |----  NAMIND                              External             
                   |----  CHAINT                              External             
                   |----  IBITS                               External             
                   |----  TRNCON                                                   
                   |----  TPRFIN                                                   
                   |----  TRDT90                              External             
                   |----  TRDDAF                              External             
                   |----  REPORT                                                   
                   |----  TGEDMP                              External             
                   |----  TGEPBK                              External             
                   |----  TFCINI                              External             
                   |----  TPDTHR                                                   
                   |----  TFILTJ                                                   
                   |----  RERROR                                                   
   
 
3 TISFIL
         SUBROUTINE TISFIL(IRLST,LEN,IOFRB,ICLDR,IPLST,IORD,NISLE)
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Fill tpc island pointers
   
       Author:    R. Johnson    25-11-86
       Modified:  R. Johnson    18-12-86
   
       Input:
          - LEN         /I     Number of islands + number of pointers
          - IOFRB       /I     Offset to row beginning in TPAD
          - ICLDR       /I     Pointer to island list directory
          - IPLST       /I     Pointer to pulse list for each island
          - IORD        /I     Ordering flag for each island
          - NISLE       /I     Number of islands
       Output
          - IRLST(ip)   /I     Row list of island pointers to TPAD hits
          - ICLDR       /I     These should be zero upon exit
          - IPLST       /I     This should be zero upon exit
   
       Called by TISLND
   
       Description
       ===========
       IRLST points to the beginning of a row list in the 'TISL' bank,
       which is of length LEN.  Using IPLST and ICLDR, the TLIPAK list
       routines are used to go through the linked list for each of
       NISLE islands (clusters of connected pad pulses), pull out the
       pointers to TPAD, and fill it all into IRLST.
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   TISLND                                                                          
        |---- TISFIL                                                               
                   |----  TLNEXT                                                   
                   |----  REPORT                                                   
                   |----  MVBITS                              External             
                   |----  TLSCRA                                                   
   
 
3 TISLND
          SUBROUTINE TISLND(ISECT,KTPAD,KTISL,NCTOT,JGARB,IER)
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Find tpc pad islands
   
       Author:    R. Johnson    25-11-86
       Modified:  R. Johnson     8-04-88
       Modified:  H. Meinhard   18-Jul-1991
                         Zero TCPL bank before it is used
   
       Input:
          - ISECT     /I     Sector number to be analyzed
          - KTPAD     /I     BOS pointer to the 'TPAD' bank for ISECT
                             This should never be zero!
          - KTISL     /I     BOS pointer to the 'TISL' bank for ISECT
                             Note: KTISL should be zero if the bank
                                   'TISL' doesn't yet exist for ISECT
       Output:
          - KTPAD     /I     BOS pointer to the 'TPAD' bank
          - KTISL     /I     BOS pointer to the 'TISL' bank for ISECT
          - NCTOT     /I     Total number of islands (clusters)
          - JGARB     /I     Set to 1 if garbage collection done.
                             Otherwise it is set to zero.
          - IER       /I     Set to 1 if BOS runs out of space.
                             Otherwise it is set to zero.
   
       Called by TPADS
   
       Description
       ===========
       This routine finds the pad islands and fills TISL if that has
       not already been done by the TPP online.  In some cases the TPP
       may time out before finishing the islands.  In that case, this
       routine will retain what the TPP has finished and then complete
       the job for the remaining sector rows.
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   TPADS                                                                           
        |---- TISLND                                                               
                   |----  NAMIND                              External             
                   |----  ITPTYP                              External             
                   |----  NLINK                               External             
                   |----  AUBOS                               External             
                   |----  BLIST                               External             
                   |----  IBITS                               External             
                   |----  RERROR                                                   
                   |----  MAX                                 External             
                   |----  VZERO                               External             
                   |----  TPADPR                                                   
                   |----  MVBITS                              External             
                   |----  TISFIL                                                   
                   |----  NDROP                               External             
   
 
3 TJTOP
         SUBROUTINE TJTOP(FLAGS,IERR)
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Change tpc julia banks to pot format for packing
   
       Author:  R. Johnson   16-06-88
       Modified: W. Wiedenmann 3-10-91
                 suppres call to TFILTU, call TFILTJ instead in TINIRU
                 D. Casper   13-05-97
                 reverse the order of calls to TPAKCO and TFPCOI, since
                 information in PCOI is useful in TPAKCO and TFPCOI does
                 not reference the output bank of TPAKCO (PTNC)
   
       Input:    FLAGS(3)  /L    Flag for each of
                                      1= coordinates
                                      2= bad coordinates
                                      3= dE/dx
                                 Set true for packing of the item.
       Output:   IERR      /I    Error return=0 if operation successful
                                 10s digit:  error from TPAKCO
                                100s digit:  error from TPAKBC
                               1000s digit:  error from TPAKTX
                              10000s digit:  error from TPAKTA
                             100000s digit:  error from TFPCOI
   
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   RDEFPO                                                                          
        |---- TJTOP                                                                
                   |----  TFPCOI                                                   
                   |----  TPAKCO                                                   
                   |----  TPAKBC                                                   
                   |----  TPAKTX                                                   
                   |----  TPAKTA                                                   
   
 
3 TKINK
         SUBROUTINE TKINK(DCHI2,KINK,LIN,NIN)
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   -----************************************--------------------------
   Find kink in a tpc track
   
       AUTHOR        :- GEORG STIMPFL 87/9/25
   
       DO NOT CALL THIS SUBROUTINE FOR LESS THAN 10 POINTS
   
       INPUT  : LIN = ARRAY OF 'TPCO' COORDINATE NUMBERS OF A TRACK
                NIN = NUMBER OF INPUT PARTICLES
       OUTPUT : KINK= FIRST COORDINATE AFTER KINK
                      REMOVED SUCH THAT CHI**2 IS MINIMISED
                DCHI2=IMPROVEMENT OF CHI**2 BY PUTTING THE KINK INTO
                      THE RIGHT PLACE
       DESCRIPTION
       ===========
       THE KINK POINT IS CALCULATED AS THAT ONE FOR WHICH
       THE SUM OF THE CHI**2 VALUES FOR BOTH ENDS OF THE TRACK
       IS MINIMAL. DCHI2 IS DEFINED AS
       DCHI2 = CHI**2(BEST KINK POINT) - CHI**2(WORST KINK POINT)
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   TFITTK                                                                          
        |---- TKINK                                                                
                   |----  TFTHEL                                                   
   
 
3 TKSGDP
         SUBROUTINE TKSGDP(KTGFT,ITK,IUNIT,ICTRL)
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Dump single track
   
      Author:    Z. Feng     10-03-87
      Modified:  R. Johnson   6-05-87
      Modified:  D. Cinabro  29-05-91
      Modified:  R. Johnson  24-08-92   Use pulse length banks
                 R. Johnson   5-09-93   use TWRF instead of TWPU
                 D. Casper    4-11-95   add pad dE/dx info
   
      Called by TRKDMP
   
      Input:
            - IUNIT   /I    Fortran output logical unit number
            - ITK     /I    Track number
            - KTGFT   /I    Offset to the BOS bank TGFT
            - ICTRL   /I    Control parameter
                            0:  print only track information
                            1:  include coordinates
                            2:  include wire hits
                            3:  include coordinates and wire hits
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   TRKDMP                                                                          
        |---- TKSGDP                                                               
                   |----  PROB                                External             
                   |----  FLOAT                               External             
                   |----  FORMAT                              External             
                   |----  NAMIND                              External             
                   |----  MOD                                 External             
                   |----  ITKFORMAT                           External             
                   |----  NLINK                               External             
                   |----  IBITS                               External             
                   |----  TVOFFS                              External             
                   |----  IENDTP                              External             
                   |----  MIN                                 External             
   
 
3 TLCTDP
         SUBROUTINE TLCTDP(IUNIT)
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Dump tpc cluster cuts
   
       Author:  R. Johnson    3-5-87
   
       Input:  IUNIT    /I     Fortran logical unit number for output
   
       Called by TRNCON
   
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   TRNCON                                                                          
        |---- TLCTDP.                                                              
   
 
3 TLIPAK
         SUBROUTINE TLCONS(A,LIST)
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Add on top of a list
   --
   --   ADD A ON TOP OF LIST.
   --     IF 'A' IS A LIST THEN A=0 ON EXIT.
   
 
3 TMAGNT
         SUBROUTINE TMAGNT(IERR)
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Tpc90 b-field
   
         Author:    J. Richstein     18-06-84
         Modified:  R. Johnson       18-12-86
   
         Output:
              IERR =  0   No error
                   =  2   Overflow
                   =  4   If field changes by more than 10%
   
         Called by TPREDA
   
         Description
         ===========
         The routine converts the value of the ADC in bank TMAG
         which reads out the hall probe inside TPC90 magnet, and
         converts it into a value according to "GAUSS".
         the conversion is done by the use of the calibration constants
         given by LEHM. They are taken from $WV.LEH.COEF(MONAL) from IBM.
         Once at the beginning the value of sor-comment record is
         compared with the first found value of magnetic field
         mesured by the hall probe. In case it differs by more than 10%
         a warning message is printed, but IERR = 0.
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   TPREDA                                                                          
        |---- TMAGNT                                                               
                   |----  NLINK                               External             
                   |----  RERROR                                                   
                   |----  FLOAT                               External             
                   |----  IFIX                                External             
                   |----  TBVAL                                                    
                   |----  ABS                                 External             
   
 
3 TMSHEL
         SUBROUTINE TMSHEL(NAME,NPT,LIST,IOPT,VV0,EE0,CHI2)
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   -----**************************************************---------C
   Fast fitting routine for scattered helices in the tpc
       AUTHORS:  N. CHERNOV, G. OSOSKOV & M. POPPE
       Modified: M.Cattaneo 97/12/05
                 Protect against divide by zero when DENOM=0.0
       Modified: M.Cattaneo 98/09/28
                 Protect against divide by zero when DENOM=0.0, again...
       Modified: D.Smith    99/10/27 Double precision fixes for Linux
       INPUT: NAME  = NAME OF THE BANK CONTAINING COORDINATES
               NPT  = NUMBER OF POINTS TO BE FITTED
               LIST = LIST OF POINTS TO BE FITTED
               IOPT = 0 -> OBSOLETE
                      1 -> WEIGHTED WITH 1/SIMA(R*PHI)**2
                      2 -> ERROR MATRIX CALCULATED
                      3 -> 3-DIMENSIONAL ITERATION
     OUTPUT:   VV0 = 1/R*CHARGE   [1/CM]  POS. IF CLOCKWISE
                     TAN(LAMBDA)  {=DZ/DS}TAN(ANGLE TO X,Y PLANE)
                     PHI0         {0,2PI} ANGLE TO X-AXIS
                     D0*SIGN      [CM]    MINIMAL DIST. TO Z-AXIS,C
                                          POS. IF AXIS ENCIRCLED
                     Z0           [CM]    Z POS AT R=D0
               EE0 = ERROR MATRIX IN TRIANG. FORM
               CHI2= CHI SQUARED = SUM (DEVIATIONS/ERRORS)**2
     NOTE: DEGREES OF FREEDOM = 2*NPT-5
   ARNING***WARNING***WARNING***WARNING***WARNING***WARNING****C
    SUBROUTINE IS NOT PROTECTED AGAINNST MISSING INPUT BANKS
   ARNING***WARNING***WARNING***WARNING***WARNING***WARNING****C
       BASED ON  SUBROUTINE CIRCLE
       REFERENCE:  COMPUTER PHYSICS COMMUNICATIONS VOL 33,P329
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   TFITTK                                                                          
        |---- TMSHEL                                                               
                   |----  ASIN                                External             
                   |----  NAMIND                              External             
                   |----  COS                                 External             
                   |----  SIN                                 External             
                   |----  ABS                                 External             
                   |----  DBLE                                External             
                   |----  DSQRT                               External             
                   |----  ATAN                                External             
                   |----  SQRT                                External             
                   |----  DASIN                               External             
                   |----  OV                                  External             
                   |----  SMINV                               External             
                   |----  SMAV                                External             
                   |----  V1                                  External             
                   |----  DV                                  External             
   
 
3 TNHLFP
         SUBROUTINE TNHLFP(ISLOT,IPAD,KTS,NHALF)
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
     Author   :- D.Cinabro             11-MAR-1990
   Calculate the number of halfpads in a sub cluster
    Code stolen from Andreas Roth
     Inputs    : ISLOT=  sector slot number
                 IPAD =  sector padrow number
                 KTS/I = pointer to row in TSCL bank
     Ouput     : NHALF/I = nuumber of half pads in this sub cluster
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   TCOOR                                                                           
   TCOORT                                                                          
   TFPCOI                                                                          
   TPADDX                                                                          
   TSAWIR                                                                          
   TWIREZ                                                                          
        |---- TNHLFP                                                               
                   |----  ITPTYP                              External             
   
 
3 TOVRLP
         SUBROUTINE TOVRLP(IER,MTOSS,MADD)
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Resolve tpc track overlaps in pad coordinates
       Author:  R. Johnson     15-07-88
       Modified: I. Tomalin     4-03-94 Bug removed concering ICFLG.
       Modified: I. Tomalin     5-02-98 Changed scale factor in ITRKSW(2)
                                        to allow for events with > 999 tracks
                 D. Casper      5-02-98 Before allowing a chain to pick up
                                        a split coordinate, check all chains
                                        which are linked into the same track
                                        candidate to be sure none have hits in
                                        the padrow.  This prevents track
                                        candidates from winding up with more
                                        than one hit in a given padrow.
       Output:   IER     /I          Error return = 0 if all was OK
                 MTOSS   /I          Number of coordinates removed from
                                     track candidates
                 MADD    /I          Number of twin coordinates calculate
       Input banks:     TPCO 2       TPC pad coordinates
                        TCAL 1       TPC track candidates
                        TTCC 1
                        TCHA         TPC chains
                        TCTC
                        TSPU 1-36    TPC pad subpulses per sector
                        TSCL 1-36    TPC pad subclusters per sector
       Output banks:    TPCO 1       Resolved TPC pad coordinates
                        TCAL 0       Resolved TPC track candidates
                        TTCC 0
                                 *** Also, if TPCO is changed, then
                                     pointers to TPCO from TCTC, TATC,
                                     TCRL and TSCL are updated to point
                                     to the new TPCO bank.
       Called by TPCREC
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   TPCREC                                                                          
        |---- TOVRLP                                                               
                   |----  NAMIND                              External             
                   |----  NDROP                               External             
                   |----  WBANK                               External             
                   |----  INTCHA                              External             
                   |----  MOD                                 External             
                   |----  RERROR                                                   
                   |----  ITPTYP                              External             
                   |----  SIGN                                External             
                   |----  TGHPTS                              External             
                   |----  TPPROW                              External             
                   |----  THLCIR                              External             
                   |----  ABS                                 External             
                   |----  TPDPHF                              External             
                   |----  MIN                                 External             
                   |----  TSNEXT                              External             
                   |----  TSCINT                              External             
                   |----  SORTZV                              External             
                   |----  VZERO                               External             
                   |----  MAX                                 External             
                   |----  TGHPAL                              External             
                   |----  TPDRBG                              External             
                   |----  FLOAT                               External             
                   |----  TPDRST                              External             
                   |----  ACOS                                External             
                   |----  SQRT                                External             
                   |----  ASIN                                External             
                   |----  TPDSEP                              External             
                   |----  TPDWID                              External             
                   |----  IAND                                External             
                   |----  AMIN1                               External             
                   |----  AMAX1                               External             
                   |----  TVOFFS                              External             
                   |----  IENDTP                              External             
                   |----  TWINCO                                                   
                   |----  TATWIN                                                   
                   |----  AUBOS                               External             
                   |----  UCOPY                               External             
                   |----  NLINK                               External             
                   |----  WDROP                               External             
   
 
3 TPADDX
         SUBROUTINE TPADDX
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Store subcluster pulseheights in tpdx bank for measurement of pad
     dE/dx
   
    There is a TPDX bank for each tpc track.  Each row is a single
    subcluster measurement.
   
       Author:    D. Casper  04-11-94
   
       Modified:  D. Casper/ 17-04-97  add protection for logarithmic
                  J-Y. Nief            correction to specific ionization
                                       calculation
       Modified:  F. Palla   15-11-98  consider a large pad crossing angle
   
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   TPCREC                                                                          
        |---- TPADDX                                                               
                   |----  NAMIND                              External             
                   |----  BDROP                               External             
                   |----  AUBOS                               External             
                   |----  BWIND                               External             
                   |----  ABS                                 External             
                   |----  COS                                 External             
                   |----  ATAN                                External             
                   |----  MOD                                 External             
                   |----  ITPTYP                              External             
                   |----  ISLOTFORMAT                         External             
                   |----  RERROR                                                   
                   |----  TNHLFP                                                   
                   |----  TPPROW                              External             
                   |----  SIN                                 External             
                   |----  INT                                 External             
                   |----  TWIRLE                              External             
                   |----  EDGECL                              External             
                   |----  EXP                                 External             
                   |----  TFILPA                                                   
                   |----  ATAN2                               External             
                   |----  TPDWID                              External             
                   |----  TPDHGT                              External             
                   |----  TPDSEP                              External             
                   |----  AMOD                                External             
                   |----  BLIST                               External             
                   |----  AUBPRS                              External             
                   |----  WDROP                               External             
   
 
3 TPADFX
         SUBROUTINE TPADFX
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Purpose: synchronize tpad and tpdi bank when
                one hit is missing in the TPAD bank but not
                in the TPDI bank. This could happen when
                a hit was removed by the TPP in the TPAD bank
                but the corresponding digitizations were not
                removed.
   
      Author   :- Werner Wiedenmann     19-May-1993
   
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   TPREDA                                                                          
        |---- TPADFX                                                               
                   |----  NAMIND                              External             
                   |----  RERROR                                                   
                   |----  NLINK                               External             
                   |----  IBITS                               External             
                   |----  ITPTYP                              External             
                   |----  MOD                                 External             
                   |----  MVBITS                              External             
                   |----  AUBOS                               External             
   
 
3 TPADPO
         SUBROUTINE TPADPO(ISEC,IROW,IPADT,RPAD,PPAD,PWID)
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Returns position of pad ipad in row irow of sector  isec
         RPAD = radius at centre of pad
         PPAD = phi at middle of pad in LOCAL ref. sys.
         PWID = Angular pad width
    7/1/87
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   TSAWIR                                                                          
        |---- TPADPO                                                               
                   |----  ITPTYP                              External             
                   |----  TPDRBG                              External             
                   |----  TPDRST                              External             
                   |----  TPDPHS                              External             
                   |----  FLOAT                               External             
                   |----  TPDHWD                              External             
                   |----  TPDPHW                              External             
                   |----  TPDWID                              External             
   
 
3 TPADPR
         SUBROUTINE TPADPR(IRLST,LEN,ICLDR,ICLST,IFLNK,IOPEN,IORD,NCLUS)
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Pad cluster pat. recognition
    Reference: ALEPH Note 159  24-4-86
   
      Author:   P.S.Marrocchesi    1-07-85
      Modified: R. Johnson        18-12-86
   
      Input:
     - IRLST( hit_addr )  =  Rowlist array containing valid HITS
                             information coded in 32 bit words .
     - LEN                =  Length of the ROWLIST in longwords :
                             total number of hits in the pad row
     - IFLNK,IOPEN        =  Work space for this routine.
   
      Output:
     - NCLUS              =  Number of reconstructed clusters
     - list buffer           This is internal to the LISPAK and is
                             accessed when LISPAK routines are called
                             to get the cluster lists.
     - ICLDR              =  Pointer to cluster directory (for LISPAK)
                             This points to a list of cluster indices
                             for valid clusters.  These indices then
                             are to be used for ICLST(ic).
     - ICLST(ic)          =  Pointers to the list of pulses for each
                             cluster.
     - IORD(ic)           =  Order flag for each cluster.
                             0 = cluster is in order
                             1 = cluster must be ordered later
   
     - Dim. of ICLST,     =  max number of clusters in one PADROW :
               IFLNK,        this number can be as high as
               IOPEN,        2048 x 3 since the  maximum number
                             of TPD modules in a row  is 3 and
                             and the hitlist memory size
                             is 2k longwords per module.
                             Set at least as large as the number of
                             pulses in the row (LEN).
     - Parameters:
                    NLAP  =  pulses from two adjacent pads are
                             said to " overlap in time " when
                             they have _ at least _ NLAP samples
                             in common .
                    ITHRE =  threshold value for overlap parame-
                             ter F to define a " backward link ".
   
       Called by TISLND
   
       Routines used:
         This program makes use of the LISPAK routines in order to
         form and manipulate linked lists of pointers into the rowlist
         for the pulses in each cluster.  At the finish, there should be
         one such linked list for each cluster, and the pointer to
         the beginning of a list may be found in ICLIST(ic) in common
         TCLIST.  LISPAK must be used to access the lists themselves.
   
       Description
       ===========
         This routine loops over the pulses in the TPAD rowlist in
         order and forms clusters as it goes along by adding to lists
         maintained by LISPAK.  Two pulses are considered part of a
         cluster if they are on adjacent pads and overlap in time
         by at least NLAP buckets.  No pulse height information is
         used.  When a pulse is found to overlap with two existing
         clusters, then the two clusters are merged together by a
         call to a LISPAK routine.
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   TISLND                                                                          
        |---- TPADPR                                                               
                   |----  TLSCRA                                                   
                   |----  IBITS                               External             
                   |----  TLCONS                                                   
                   |----  IABS                                External             
                   |----  TLADD                                                    
   
 
3 TPADS
         SUBROUTINE TPADS(IER)
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Reconstruct pad clusters
   
       Author:    D. Schlatter
       Modified:  R. Johnson    20-07-89
   
       Output:
           - IER      /I    Error code = 1 if we run out of space
                                       = 2 if input banks are missing
                                       = 0 if all is OK
   
       Input banks:
             TPAD:          TPC pad hits
             TPDI:          TPC pad digitizations
             TISL:          Optional; it will be created if not input
       Output banks:
             TPRL           Row list pointers to raw data
             TPUL,TCLU      TPC pad pulses and clusters
             TSPU,TSCL      TPC pad subpulses and subclusters
             TLRL,TSRL      Row pointers for clusters and subclusters
   
       Called by TPREDA
   
       Description
       ===========
       For each sector:
         Build a pad row list
         Find pad islands
         Set up cluster and pulse banks
         Find subpulses and subclusters
   
       NOTE:  This routine plus those subroutines which it calls
              represent a MODULE within JULIA.
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   TPREDA                                                                          
        |---- TPADS                                                                
                   |----  NAMIND                              External             
                   |----  BDROP                               External             
                   |----  ISLOTFORMAT                         External             
                   |----  RERROR                                                   
                   |----  NDROP                               External             
                   |----  NLINK                               External             
                   |----  ITPTYP                              External             
                   |----  TPRLST                                                   
                   |----  TISLND                                                   
                   |----  TCLUST                                                   
                   |----  TCLCOR                                                   
   
 
3 TPAKBC
         SUBROUTINE TPAKBC(IER)
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Transfer the tbco bank to the ptbc bank
   
       Author:   R. Johnson  16-06-88
   
       Output:   IER       /I    Error return=0 if operation successful
   
       Called by TJTOP
   
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   TJTOP                                                                           
        |---- TPAKBC                                                               
                   |----  NAMIND                              External             
                   |----  BDROP                               External             
                   |----  AUBOS                               External             
                   |----  ITPTYP                              External             
                   |----  TCTSEC                              External             
                   |----  INT                                 External             
   
 
3 TPAKCO
         SUBROUTINE TPAKCO(IER)
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Produce the ptnc bank from tpco
   
       Author:   R. Johnson    880615
       Modified: M.Cattaneo    971017
                 Produce PTNC even if FRTL and FTCL are missing
   
       Output:  IER        /I    Error code=0 if operation is successful
   
       Called by TJTOP
   
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   TJTOP                                                                           
        |---- TPAKCO                                                               
                   |----  NAMIND                              External             
                   |----  BDROP                               External             
                   |----  AUBOS                               External             
                   |----  TPK1CO                                                   
   
 
3 TPAKTA
         SUBROUTINE TPAKTA(IER)
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Pack tpc track-mc association for production output tape
       Author:  R. Johnson   10-1-89
       Output:   IER    /I    Error code is non-zero if BOS overflows
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   TJTOP                                                                           
        |---- TPAKTA                                                               
                   |----  NAMIND                              External             
                   |----  BDROP                               External             
                   |----  AUBOS                               External             
                   |----  MIN                                 External             
                   |----  AUBPRS                              External             
   
 
3 TPAKTX
         SUBROUTINE TPAKTX(IER)
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Transfer the texs,t2xs,tpxs banks to the ptex,pt2x,ptpx banks
   
       Author:   R. Johnson  16-06-88
       Modified: R. Johnson  21-01-91 add flag to the PTEX bank
                 D. Casper   04-11-95 add pad dE/dx banks
   
       Output:   IER       /I    Error return=0 if operation successful
   
       Called by TJTOP
   
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   TJTOP                                                                           
        |---- TPAKTX                                                               
                   |----  NAMIND                              External             
                   |----  BDROP                               External             
                   |----  AUBOS                               External             
                   |----  INT                                 External             
   
 
3 TPARAB
         SUBROUTINE TPARAB(TOFF,IPH,TMAX,PHMAX)
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Parabolic fit of peak of a subpulse
   
       Author:    R. Johnson    6-01-87
       Modified:  R. Johnson    6-01-87
   
       Input:
           - TOFF     /R     Time at center of second pulse
           - IPH(3)   /I     Array of pulse heights
       Output:
           - TMAX     /R     Time at peak of parabola
           - PHMAX    /R     Peak height of parabola
   
       Called by TPLANA
   
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   TRDWP3                                                                          
   TSCFIL                                                                          
        |---- TPARAB                                                               
                   |----  FLOAT                               External             
                   |----  RERROR                                                   
   
 
3 TPBOOK
         SUBROUTINE TPBOOK
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Book tpc histograms
   
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   RBKHIS                                                                          
        |---- TPBOOK                                                               
                   |----  HBOOK1                              External             
                   |----  HIDOPT                              External             
   
 
3 TPCBUN
         SUBROUTINE TPCBUN(ITPBUN,IQUAL)
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Determine the tpc bunch number and set the quality flag
   
       Author M.Girone, I. Tomalin 21/3/95
   
    Input arguements:
      None (but uses TGFT bank via TPCT0N).
   
    Output arguments:
      INTE ITPBUN: TPC bunch number.
      INTE IQUAL : Flag indicating reliability of ITPBUN.
                   (=0 => No information, =1 probably correct,
                =2 => almost certainly correct, =3 => certainly correct).
   
    Calls: RQBUNC, TPCT0N
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   TPCREC                                                                          
        |---- TPCBUN                                                               
                   |----  RQBUNC                              External             
                   |----  TPCT0N                                                   
                   |----  SQRT                                External             
                   |----  ABS                                 External             
                   |----  FLOAT                               External             
                   |----  NINT                                External             
                   |----  MAX                                 External             
                   |----  MIN                                 External             
   
 
3 TPCREC
         SUBROUTINE TPCREC
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Steering for tpc reconstruction
   
       Author:    D. Schlatter
       Modified:  R. Johnson   19-01-88
       Modified:  R. Johnson   21-01-91 clean out unused code.
       Modified:  I. Tomalin    3-04-95 Calculate TPC bunch number.
       Modified:  D. Casper    05-11-94 calculate dE/dx from pad pulses.
       Modified:  D. Casper    23-10-95 refit after corrections, and remove
                                        filtered hits from coord list
       Modified:  O. Callot       12-95 call ALTIME only if TPTI card used
   
       Description
       ===========
         1.  find chains
         2.  find links
         3.  create track candidates
         4.  resolve coordinates in clusters with overlapping tracks
         5.  fit tracks
         6.  add wire pulses to tracks
         7.  calculate wire dE/dx for tracks
         8.  calculate pad dE/dx for tracks
         9.  recalculate coordinates, including wire corrections
         10. refit track and remove filtered coordinates (turn off w/TNFF card)
         11. associate tracks with MC truth information
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   RECEVT                                                                          
        |---- TPCREC                                                               
                   |----  NAMIND                              External             
                   |----  ALTIME                                                   
                   |----  TRKFND                                                   
                   |----  TCHADP                                                   
                   |----  TFLNKS                                                   
                   |----  TFCAND                                                   
                   |----  BDROP                               External             
                   |----  TARCDP                                                   
                   |----  TCALDP                                                   
                   |----  TOVRLP                                                   
                   |----  TFITTK                                                   
                   |----  T1FTDP                                                   
                   |----  TFLNK2                                                   
                   |----  RNXMOD                                                   
                   |----  TRKWRA                                                   
                   |----  TRKELS                                                   
                   |----  TTWODX                                                   
                   |----  TCOORT                                                   
                   |----  TFITKF                                                   
                   |----  AUBPRS                              External             
                   |----  TGFTDP                                                   
                   |----  TPADDX                                                   
                   |----  TPDELS                                                   
                   |----  TREFCH                                                   
                   |----  RERROR                                                   
                   |----  TRKMCA                                                   
                   |----  TGMADP                                                   
                   |----  FAWIAN                                                   
                   |----  TPCBUN                                                   
                   |----  MVBITS                              External             
                   |----  TACCMN                                                   
                   |----  TRKDMP                                                   
                   |----  TBPRNT                                                   
   
 
3 TPCRUN
         SUBROUTINE TPCRUN
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Run summary from tpc reconstruction
   
       Author:  W. Wiedenmann  14-07-93 store summary information
                                        in JTRE bank
      Modified :- E. Lancon             21-JUL-1993
                 Add dE/dx summary
      Modified :- E. Lancon             26-AUG-1993
                 restrict the fit to the FWHM interval
                - F.Ranjard             10-MAY-1994
                 fill JHDX bank with DEDX histograms
      Modified :- I. Tomalin            15-AUG-1995
                 call TVDVEL
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   RCLRUN                                                                          
        |---- TPCRUN                                                               
                   |----  TVDVEL                                                   
                   |----  FORMAT                              External             
                   |----  BDROP                               External             
                   |----  AUBOS                               External             
                   |----  NWTKTM                              External             
                   |----  NPTKTM                              External             
                   |----  NMISTM                              External             
                   |----  LMISTM                              External             
                   |----  NWSYTM                              External             
                   |----  LWSYTM                              External             
                   |----  NPSYTM                              External             
                   |----  LPSYTM                              External             
                   |----  NDRPTM                              External             
                   |----  LDRPTM                              External             
                   |----  NHORTM                              External             
                   |----  LHORTM                              External             
                   |----  NROWTM                              External             
                   |----  LROWTM                              External             
                   |----  NBDHTM                              External             
                   |----  LBDHTM                              External             
                   |----  NTPDTM                              External             
                   |----  LTPDTM                              External             
                   |----  NCPDTM                              External             
                   |----  LCPDTM                              External             
                   |----  NBADTM                              External             
                   |----  LBADTM                              External             
                   |----  BKFMT                               External             
                   |----  HUNPAK                              External             
   
 
3 TPCT0
         SUBROUTINE TPCT0(IER,DT)
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Tpc t0 monitoring
   
     Author:   W. Wiedenmann   12-09-89
     Modified: R. Johnson      18-09-89
     Modified :- E. Lancon             25-FEB-1992
        use alephlib routine TPDVEL to load drift velocity
   
     Output:  IER      /I     If non-zero, then no valid T0 info for
                              this event
              DT       /R     Difference in time between TPC side A
                              and side B in microseconds.
   
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   RMONIT                                                                          
        |---- TPCT0                                                                
                   |----  NAMIND                              External             
                   |----  NLINK                               External             
                   |----  TPDVEL                              External             
                   |----  ATAN                                External             
                   |----  ABS                                 External             
                   |----  IENDTP                              External             
                   |----  FLOAT                               External             
   
 
3 TPCT0N
         SUBROUTINE TPCT0N(IER,DT,EDT,NTR)
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Tpc t0 monitoring
   
     Author   :- M. Girone, I. Tomalin          15-DEC-1994
     Source: JULIA TPCT0 routine, modified to include the error on DT.
     Modified :- I. Tomalin 18/5/95 to reduce sensitivity to V0's.
   
     Output:  IER      /I     If non-zero, then no valid T0 info for
                              this event
              DT       /R     Difference in time between TPC side A
                              and side B in microseconds.
              EDT      /R     Error on the difference in time between
                              TPC side A and side B in microseconds.
              NTR(2)   /I     Number of tracks used in each TPC side.
   
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   RCJSUM                                                                          
   TPCBUN                                                                          
        |---- TPCT0N                                                               
                   |----  NAMIND                              External             
                   |----  TPDVEL                              External             
                   |----  MAX                                 External             
                   |----  FLOAT                               External             
                   |----  ATAN                                External             
                   |----  ABS                                 External             
                   |----  SQRT                                External             
                   |----  IENDTP                              External             
                   |----  INT                                 External             
                   |----  LOG                                 External             
   
 
3 TPDELS
         SUBROUTINE TPDELS
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Create tpxs bank of truncated means for pad de/dx
   
            Author: D.Casper 26-Oct-1995
   
            Modified: D.Casper, J-Y.Nief  17-Apr-1997
                      Add logarithmic correction to specific ionization
            Modified: J-Y. Nief           19-Nov-1998
                      Change value of logarithmic correction coefficient
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   TPCREC                                                                          
        |---- TPDELS                                                               
                   |----  NAMIND                              External             
                   |----  BDROP                               External             
                   |----  WBANK                               External             
                   |----  INTCHA                              External             
                   |----  AUBOS                               External             
                   |----  BLIST                               External             
                   |----  RERROR                                                   
                   |----  LOG10                               External             
                   |----  SORTZV                              External             
                   |----  VZERO                               External             
                   |----  NCLST                               External             
                   |----  FLOAT                               External             
                   |----  AUBPRS                              External             
                   |----  WDROP                               External             
   
 
3 TPDIAG
         SUBROUTINE TPDIAG(NDIM,EMAT,EVEC,EVAL)
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Tpdiag diagonalizes the 21x21 hit error matrix
            returns the eigen vectors (as columns in EVEC)
            and the eigen values (as EVAL)
   
   - Author         Manoj Thulasidas  5-Nov-1994
    Input :  NDIM  - dimension
             EMAT   - error matrix
    Output : EVEC   - eigen vectors of EMAT in columns
             EVAL   - eigen values
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   TPHSMR                                                                          
        |---- TPDIAG                                                               
                   |----  RERROR                                                   
                   |----  EISRS1                              External             
   
 
3 TPDTHR
         SUBROUTINE TPDTHR
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Unpack tpd bad channels
   
       Author:   R. Johnson  8-04-88
   
       Input banks:  TCLB and TKAP banks from TPC online.
       Input common: TPGEOM global geometry constants for TPC.
                     TPGEOP pad geometry constants for TPC
       Output banks:
               THPL -  list of bad pads and associated thresholds
               THRP -  pointers into THPL for each sector and row
   
       Called by TINIRU
   
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   TINIRU                                                                          
        |---- TPDTHR                                                               
                   |----  NAMIND                              External             
                   |----  MAX                                 External             
                   |----  BDROP                               External             
                   |----  WBANK                               External             
                   |----  INTCHA                              External             
                   |----  AUBOS                               External             
                   |----  BLIST                               External             
                   |----  IBITS                               External             
                   |----  RERROR                                                   
                   |----  ITPTYP                              External             
                   |----  VZERO                               External             
                   |----  SORTZV                              External             
                   |----  AUBPRS                              External             
                   |----  WDROP                               External             
   
 
3 TPHIST
         SUBROUTINE TPHIST
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Tpc histograms
    for analysis of coordinate- and track-finding efficiency.
   
       Author:   M. Mermikides
       Modified: R. Johnson      8/04/88
       Modified: I. Tomalin     23/06/88
   
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   RHSEVT                                                                          
        |---- TPHIST                                                               
                   |----  NAMIND                              External             
                   |----  HFILL                               External             
                   |----  FLOAT                               External             
                   |----  PROB                                External             
                   |----  ABS                                 External             
                   |----  NDROP                               External             
                   |----  IF                                  External             
                   |----  SQRT                                External             
                   |----  WBANK                               External             
                   |----  INTCHA                              External             
                   |----  SORTZV                              External             
                   |----  WDROP                               External             
                   |----  MIN                                 External             
                   |----  F                                   External             
   
 
3 TPHSMR
         subroutine TPHSMR
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Tphsmr smears the tpco coordinates in accordance with the data
            base bank TPSM (NR=tpc setup) for Monte Carlo events
   
   - Author         Manoj Thulasidas  5-Dec-1994
     Input    TPCO and TPSM banks
     Output   Smeared TPCO Bank
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   TSMFT                                                                           
        |---- TPHSMR                                                               
                   |----  ABRUEV                              External             
                   |----  TPSMGT                                                   
                   |----  NAMIND                              External             
                   |----  TPDIAG                                                   
                   |----  TPRNDM                                                   
                   |----  VSCALE                              External             
                   |----  TPSMR1                                                   
   
 
3 TPK1CO
         SUBROUTINE TPK1CO(IC,IPTNC)
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Fill one entry into the ptnc bank
   
       Author:  R. Johnson     15-06-88
   
       Modified:D. Casper      26-03-97  Remove requirement that errors
                                         fit into a byte, to allow scale
                                         factors to change and round-off
                                         to be reduced.
   
                               13-05-97  Recalculate the coordinate errors
                                         appropriate for only pad coordinates,
                                         since the content of the TPCO
                                         bank represents the error on the
                                         combined pad and wire coordinate
                                         (if any) at this point.
   
       Input:   IC       /I      Coordinate number in TPCO
       Output:  IPTNC(6) /I      A single row of the PTNC bank
   
       Called by TPAKCO
   
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   TPAKCO                                                                          
        |---- TPK1CO                                                               
                   |----  NAMIND                              External             
                   |----  ITPTYP                              External             
                   |----  NINT                                External             
                   |----  TFILPA                                                   
                   |----  TERPAR                                                   
                   |----  SQRT                                External             
                   |----  RERROR                                                   
   
 
3 TPKILL
         SUBROUTINE TPKILL
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Remove tpc bad channels from monte carlo input
    Author:   R. Johnson   7-09-89
    Modified: R. Johnson  21-01-91  handle the TRIR and TRDI banks
    Modified: W. Wiedenmann 3-2-92  handle the TSIR and TSDI banks
    Modified: R. Johnson 2-3-93     fix bug introduced in mods of
                                    3-2-92
    NOTE: this routine requires as input the TCLB and TKAP banks, which
          provide lists of bad channels.  These banks may be extracted
          for the run headers of real data tapes for the runs of interest
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   TPREDA                                                                          
        |---- TPKILL                                                               
                   |----  NAMIND                              External             
                   |----  GTSTUP                              External             
                   |----  ALGTDB                              External             
                   |----  JUNIDB                              External             
                   |----  RERROR                                                   
                   |----  VZERO                               External             
                   |----  NLINK                               External             
                   |----  IBITS                               External             
                   |----  BTEST                               External             
                   |----  MVBITS                              External             
                   |----  AUBOS                               External             
                   |----  IF                                  External             
                   |----  BDROP                               External             
                   |----  BSWAP                               External             
   
 
3 TPLANA
         SUBROUTINE TPLANA(IP,LSTSP)
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Analyze a tpc pulse
   
       Author:   R. Johnson   23-12-86
       Modified: R. Johnson   19-01-88
       Modified: M. Cattaneo   3-07-97
          Bug fix: Update IOFFS after calls to WBANK
   
       Input:
          - IP      /I      Pulse number in workbank ITPAD
       Output and Input:
          - LSTSP   /I      Pointer to the last subpulse found
                            on this pad
   
       Called from TCLANA
   
       Description:
       ------------
       This program is called for each TPC pulse in a cluster, where a
       pulse is defined by TPD zero suppression hardware and a cluster
       is a topologically connected group of pulses.  It considers
       separately groups of consecutive samples above a fixed software
       threshold.  The beginnings and endings of such groups are marked,
       and the points of all significant local maxima and minima are
       also marked, except for pulses at large dip angle (assuming
       a track coming from the origin), for which local maxima and
       minima are ignored. Each maximum along with its adjacent minima
       are then considered to form a separate subpulse if the maximum is
       sufficiently greater than the adjacent minima and not too much
       less than any adjacent maxima.  Precise definitions of the cuts
       are found in common TCLUCT.  The results are output into the
       workbank ITSPUW, which is described in comdeck TCLCOW.
   
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   TCLANA                                                                          
        |---- TPLANA                                                               
                   |----  MIN                                 External             
                   |----  RERROR                                                   
                   |----  WBANK                               External             
   
 
3 TPPADD
         SUBROUTINE TPPADD(PRIAD,ISLOT,IERR)
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Kludge function to give tpp primary address - sector number correspondence
   ARNING: this routine depends on the hardware setup, which is not
            expected to change (but changes cannot be ruled out).  It
            is only used offline to interpret the TERR bank, which for
            some perverse reason gives us the fastbus address instead of
            the sector number.  Called by TCPTST.
    :
     PRIAD - integer containing the fastbus primary address of the TPP
    :
     ISLOT - sector number of the TPP
     IERR - error flag. = 1 if address error problem detected.
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   TCPTST                                                                          
        |---- TPPADD.                                                              
   
 
3 TPREDA
         SUBROUTINE TPREDA
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Prepare tpc data
   
       Author:    R. Johnson    28-04-87
       Modified:  R. Johnson    21-01-91
       Modified:  W. Wiedenmann  3-02-92  handle TSIR,TSDI banks
       Modified:  W. Wiedenmann 19-05-93  call TPADFX
       Modified:  I. Tomalin     3-04-95  Correct T0 for bunch trains.
       Modified:  I. Tomalin     3-10-97  Correct 1997 T0 for problems.
       Modified:  M. Cattaneo   24-04-98  Force use of TWIR/TWDI in
                                          run range 10000-11800
   
       Description
       -----------
         1.  find pad-clusters
         2.  calculate coordinates
         3.  associate coordinates with Monte Carlo true hits
         4.  find wire-pulses
   
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   RPREDA                                                                          
        |---- TPREDA                                                               
                   |----  NAMIND                              External             
                   |----  ALTIME                                                   
                   |----  RQBUNC                              External             
                   |----  TVOFS0                              External             
                   |----  FLOAT                               External             
                   |----  TFIXT0                              External             
                   |----  NDROP                               External             
                   |----  BDROP                               External             
                   |----  TCPTST                                                   
                   |----  TPADFX                                                   
                   |----  TSEQUE                                                   
                   |----  TTRUNK                                                   
                   |----  TWIRFX                                                   
                   |----  TWRRED                              External             
                   |----  BLIST                               External             
                   |----  IERFORMAT                           External             
                   |----  RERROR                                                   
                   |----  TPKILL                                                   
                   |----  TMAGNT                                                   
                   |----  TFTPAD                                                   
                   |----  TPADS                                                    
                   |----  IF                                  External             
                   |----  TPSTAT                                                   
                   |----  TCODRV                                                   
                   |----  TPCODP                              External             
                   |----  TBCODP                                                   
                   |----  TWIRES                                                   
                   |----  TCDUMP                                                   
   
 
3 TPRF2
          REAL FUNCTION TPRF2(Z,ISECT,NSUB,PADCR,WIRCR)
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Get square of pad response
   
        Author:    D. Schlatter
        Modified:  R. Johnson    06-06-89
        Modified:  A. Roth       14-12-89
   
        Input:    Z       /R      Length of drift in cm.
                  ISECT   /I      sector number
                  NSUB    /I      Number of subpulses (0 not to make
                                  corrections based on track angles)
                  PADCRO  /R      Pad crossing angle
                  WIRCRO  /R      Wire crossing angle
   
        Called by TCOALG
   
        Description
        ===========
        The square of the PRF as function of z is obtained
        by interpolation of measurements made at several drift
        lengths.
   
        At each start of run, TPRFIN must be called for initialization.
   
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   TCOOR                                                                           
   TCOORT                                                                          
   TSAWIR                                                                          
   TWINCO                                                                          
        |---- TPRF2                                                                
                   |----  NAMIND                              External             
                   |----  ABS                                 External             
                   |----  TPDSEP                              External             
                   |----  ITPTYP                              External             
                   |----  TPRFX                                                    
   
 
3 TPRFIN
         SUBROUTINE TPRFIN
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Initialize pad response function
   
        Author:    D. Schlatter
        Modified:  T. Lohse      12-03-87
        Modified:  R. Johnson    06-06-89
   
    Called by TINIRU at start of each run
   
    Description
    -----------
    The data statements contain measurements of the squared pad response
    width measured in TPC90 from laser tracks at three drift lengths
    and several values of magnetic field.  An interpolation is made
    to find values appropriate for the present field strength, giving
    constants to be used by TPRF2 for interpolation in z.
   
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   TINIRU                                                                          
        |---- TPRFIN                                                               
                   |----  ALGTDB                              External             
                   |----  REPORT                                                   
                   |----  NAMIND                              External             
                   |----  ABS                                 External             
                   |----  DIVDIF                              External             
   
 
3 TPRFX
         SUBROUTINE TPRFX (NSUB, PADCRO, WIRCRO, PRFCOR)
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Get pad response correction factor
   
      Author   :- Andreas ROTH          14-DEC-1989
   
      Inputs:
           - NSUB     Number of subpulses
           - PADCRO   Pad crossing angle
           - WIRCRO   Wire crossing angle
   
      Outputs:
           - PRFCOR   Pad response correction factor
   
      Libraries required:   BOS
   
      Description
      ===========
         This routine corrects the pad response width as determined insid
         TPRF2 with respect to the pad and wire crossing angle.
         It is called by TPRF2.
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   TPRF2                                                                           
        |---- TPRFX                                                                
                   |----  NAMIND                              External             
                   |----  RERROR                                                   
   
 
3 TPRLST
          SUBROUTINE TPRLST(ISLOT,KTPAD,KTPDI,KTPRL,JGARB,IER)
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Establish tpc rowlist
   
     Author:    D. Schlatter
     Modified:  R. Johnson    10-05-88
   
     INPUT:
          - ISLOT  /I     Sector number
          - KTPAD  /I     Offset for pad-hit bank
          - KTPDI  /I     Offset to pad digitization bank
     OUTPUT:
          - KTPAD  /I     (this may change if garbage collection is done)
          - KTPDI  /I     (this may change if garbage collection is done)
          - KTPRL  /I     Offset for rowlist bank
          - JGARB  /I     =1 if garbage collection done; =0 otherwise
          - IER    /I     Set to zero for good return,
                          and set to 1 if space is not available.
                          >9 means the input data format is wrong.
     Called from TPADS
   
     Description
     ===========
        Define offsets into TPC raw data banks TPAD+TPDI
        for each padrow in a sector.
        Offsets and number of hits and samples per row are stored
        in the TPC-row-list bank TPRL.
        Several checks are made to verify that the input data are
        in the proper format.
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   TPADS                                                                           
        |---- TPRLST                                                               
                   |----  NAMIND                              External             
                   |----  ITPTYP                              External             
                   |----  AUBOS                               External             
                   |----  NLINK                               External             
                   |----  BLIST                               External             
                   |----  VZERO                               External             
                   |----  IBITS                               External             
                   |----  RERROR                                                   
                   |----  IOFRBIF                             External             
                   |----  MVBITS                              External             
                   |----  BDROP                               External             
   
 
3 TPRNDM
         SUBROUTINE TPRNDM(NDIM,EVEC,EVAL,RVEC)
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Tprndm calculates a random vector rvec of ndim dimensions
            depending on a NDIM by NDIM error matrix whose eigen
            vectors (EVEC) and eigen values (EVAL) are provided
   
   - Author         Manoj Thulasidas  5-Nov-1994
    Input :  NDIM  - dimension
             EVEC   - eigen vectors of EMAT in columns
             EVAL   - eigen values
    Output : RVEC   - random vector
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   TPHSMR                                                                          
        |---- TPRNDM                                                               
                   |----  RANNOR                              External             
                   |----  SQRT                                External             
                   |----  VMATR                               External             
   
 
3 TPRSUM
         SUBROUTINE TPRSUM
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Job summary from tpc reconstruction
   
       Author:       R. Johnson     03-06-87
       Modified:     D. Casper      04-11-95  add pad dE/dx stats
   
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   RSMJOB                                                                          
        |---- TPRSUM                                                               
                   |----  FORMAT                              External             
                   |----  FLOAT                               External             
                   |----  NUSCTM                              External             
                   |----  NBADTM                              External             
                   |----  NDEXTM                              External             
                   |----  DEDXTM                              External             
                   |----  DEX2TM                              External             
                   |----  SQRT                                External             
                   |----  AMAX1                               External             
                   |----  NDPXTM                              External             
                   |----  DPDXTM                              External             
                   |----  DPX2TM                              External             
                   |----  JPRERF                              External             
                   |----  NWTKTM                              External             
                   |----  NPTKTM                              External             
                   |----  NMISTM                              External             
                   |----  NWSYTM                              External             
                   |----  NDRPTM                              External             
                   |----  NHORTM                              External             
                   |----  NROWTM                              External             
                   |----  NBDHTM                              External             
   
 
3 TPSMGT
         SUBROUTINE TPSMGT(NDIM,BANK,IBANK,ARRAY,IRET)
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Read in the given row ibank of bank (upper triangular matrix)
    into ARRAY(NDIM,NDIM).  NR of the BANK is the TPC setup code
    Author  Manoj Thulasidas  Dec. 8, 1997
    Input
              NDIM  = dimenstion of ARRAY  (21 for TPSM)
              BANK  = the bank name        (TPSM)
              IBANK = the row number       (= view number here)
    Output
              ARRAY = the square matrix into which the bank is unpacked
              IRET  = 0 if success, -1 if failed
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   TPHSMR                                                                          
        |---- TPSMGT                                                               
                   |----  ABRUEV                              External             
                   |----  GTSTUP                              External             
                   |----  JUNIDB                              External             
                   |----  ALGTDB                              External             
                   |----  NAMIND                              External             
                   |----  TRUPCK                              External             
   
 
3 TPSMR1
         subroutine TPSMR1(MAXHIT,ZVEC,RVEC)
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Adds the smearing vector to the tpco coordinates.
     takes into account the drift length dependence for z hits
    Author  Manoj Thulasidas  Dec. 8, 1997
    Input
              MAXHIT  = number of hits to be smeared  (21 here)
              ZVEC    = smearing vector in Z
              RVEC    = smearing vector in Z
    Output
              smeared TPCO bank
    Modified:  Manoj Thulasidas  Feb. 15, 1998
              Change the Z smearing proportional to the drift distance
              to an average smearing.  (Fixes the cos(theta) dependence)
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   TPHSMR                                                                          
        |---- TPSMR1                                                               
                   |----  NAMIND                              External             
   
 
3 TPSORT
         SUBROUTINE TPSORT(IPDNR,IT0NR,IDXSR,NP)
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Sort pulses by pad number and time
   
       Author:    R. Johnson   15-12-86
       Modified:  R. Johnson   27-08-89
   
       Input:
          - IPDNR(np)   /I        Pad numbers of the pulses
          - IT0NR(np)   /I        T0 of each pulse
          - IDXSR(np)   /I        Ordering of the pulses
          - NP          /I        Number of pulses
       Output:
          - IDXSR(np)   /I        Ordering of the pulses
   
       Called by TCLUST
   
       Description
       ===========
          This routine sorts the pulses of a cluster by pad number by
       a simple ripple sort.  They are sorted in either descending or
       ascending order, depending on the initial order of the first
       and last pulses.  This is appropriate because most clusters are
       initially either in ascending or descending order, and those
       which are not so generally are close to being so.  Pulses with
       the same pad number are sorted by increasing time.
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   TCLUST                                                                          
        |---- TPSORT.                                                              
   
 
3 TPSTAT
         SUBROUTINE TPSTAT
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Accumulate tpc cluster statistics
   
       Author:   R. Johnson   04-06-87
       Modified: R. Johnson   19-01-88
   
       Called by TPREDA
   
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   TPREDA                                                                          
        |---- TPSTAT                                                               
                   |----  NAMIND                              External             
                   |----  IF                                  External             
   
 
3 TPULDP
         SUBROUTINE TPULDP(ISECT,IUNIT)
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Dump bos bank tpul to iunit
   
       Author:    R. Johnson  23-10-86
       Modified:  R. Johnson  18-12-86
   
       Called by TBPRNT
   
       Input:
            - ISECT   /I    Number of the sector to dump
            - IUNIT   /I    Fortran output logical unit number
   
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   TBPRNT                                                                          
        |---- TPULDP                                                               
                   |----  NLINK                               External             
                   |----  FORMAT                              External             
   
 
3 TRDWP1
         SUBROUTINE TRDWP1(IT0,NWSMP,IPH,ICHG,TIM,IER)
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Reduce those tpc wire pulses not already done by the tpp
    R. Johnson    16-1-91
    Input:    IT0       /I        Time of 1st bucket in the pulse
              NWSMP     /I        Number of samples in the pulse
              IPH(n)    /I        Array of sample pulse heights
    Output:   ICHG      /I        Charge estimate
              TIM       /R        Time estimate
              IER       /I        Error code
                                  0= all OK
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   TWIRES                                                                          
        |---- TRDWP1                                                               
                   |----  FLOAT                               External             
                   |----  INT                                 External             
                   |----  RERROR                                                   
   
 
3 TRDWP2
         SUBROUTINE TRDWP2(IT0,NWSMP,IPH,ICHG,TIM,LMPH,IER)
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Reduce tpc wire pulses not handled by the tpp, using the default
    algorithm used for all data taken so far.
    Author:    R. Johnson    16-1-91
    Modified:  R. Johnson    24-8-92   Return LMPH to calling routine
    Modified:  R. Johnson    2-3-93    Fix bug such that LMPH REALLY
                                       is returned
    Input:    IT0       /I        Time of 1st bucket in the pulse
              NWSMP     /I        Number of samples in the pulse
              IPH(n)    /I        Array of sample pulse heights
    Output:   ICHG      /I        Charge estimate
              TIM       /R        Time estimate
              LMPH      /I        Length of pulse above threshold
              IER       /I        Error code
                                  0= all OK
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   TWIRES                                                                          
        |---- TRDWP2                                                               
                   |----  FLOAT                               External             
   
 
3 TRDWP3
         SUBROUTINE TRDWP3(NSAT,IT0,NWSMP,IPH,NHIT,IQ,TIME,LENGTH,IQUAL)
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Reduce tpc wire pulses not handled by the tpp, using the default
    algorithm used for all data taken so far.
    Author:    R. Johnson    16-1-91
    Modified:  R. Johnson    24-8-92   Return LMPH to calling routine
    Modified:  R. Johnson    2-3-93    Fix bug such that LMPH REALLY
                                       is returned
               R. Johnson    5-9-93    Major changes to add possibility
                                       of splitting double peaks.  Also,
                                       use threshold alg. for times.
    Input:    NSAT      /I        Number of saturated samples
              IT0       /I        Time of 1st bucket in the pulse
              NWSMP     /I        Number of samples in the pulse
              IPH(n)    /I        Array of sample pulse heights
    Output:   NHIT
              IQ        /I        Charge estimate
              TIME      /R        Time estimate
              LENGTH    /I        Length of pulse above threshold
              IQUAL     /I        Error code
                                  0= all OK
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   TWIRES                                                                          
        |---- TRDWP3                                                               
                   |----  TPARAB                                                   
                   |----  FLOAT                               External             
                   |----  INT                                 External             
                   |----  RERROR                                                   
   
 
3 TREFCH
         SUBROUTINE TREFCH(KTPCH,JGARB)
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Reference between clusters, coordinates and mc hits
   
       Author:   R. Johnson    22-10-87
       Modified: R. Johnson    19-01-87
   
       Output:
          - KTPCH    /I       BOS pointer to cross reference bank
                              for coordinates
          - JGARB    /I       Set to one if a garbage collection
                              has occured.  Set to two if no space
                              was available in BOS
   
       Called by TPHIST
   
       Note that tracks traveling almost parallel to the padrow can
       leave ionization in one sector padrow without ever passing over
       the center of the padrow.  These cases can produce coordinates
       with no MC reference.
   
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   TPCREC                                                                          
        |---- TREFCH                                                               
                   |----  NAMIND                              External             
                   |----  VZERO                               External             
                   |----  AUBOS                               External             
                   |----  BLIST                               External             
                   |----  BWIND                               External             
                   |----  IF                                  External             
                   |----  ITPTYP                              External             
                   |----  NLINK                               External             
                   |----  FLOAT                               External             
                   |----  TVOFFS                              External             
                   |----  TPPROW                              External             
                   |----  TSCOOR                                                   
                   |----  TCTGLB                              External             
                   |----  AMIN1                               External             
                   |----  AMAX1                               External             
                   |----  MOD                                 External             
   
 
3 TREFIT
         SUBROUTINE TREFIT
  ------------------------------------------------------------------------------
    CKEY TPC SMEARING
  ------------------------------------------------------------------------------
   Refit frft 2 tracks after monte carlo smearing
    Author      : A. BONISSENT 050298
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   TSMFT                                                                           
        |---- TREFIT                                                               
                   |----  NAMIND                              External             
                   |----  NLINK                               External             
                   |----  UFSWIM                              External             
                   |----  UFTFIL                              External             
                   |----  ALFIEL                              External             
                   |----  RERROR                                                   
   
 
3 TREMPT
         SUBROUTINE TREMPT(PBEST,LOUT,LIN,NIN)
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   -----*************************************--------------------------
   Remove bad tpc points to get a track with better chi**2
   
       AUTHOR        :- MARTIN POPPE 87/9/25
   
   
       INPUT  : LIN = ARRAY OF 'TPCO' COORDINATE NUMBERS OF A TRACK
                NIN = NUMBER OF INPUT PARTICLES
       OUTPUT : LOUT= ARRAY OF COORDINATE NUMBERS WITH 1 POINT
                      REMOVED SUCH THAT CHI**2 IS MINIMISED
                PBEST=FIT PROBABILITY OF BEST CASE
       DESCRIPTION
       ===========
       EACH OF THE POINTS IN "LIN" IS THROWN AWAY ONCE
       AT A TIME. THE REMAINING SET OF POINTS IS FITTED.
       LOUT IS FILLED WITH THOSE (NIN-1) POINTS FOR WHICH
       CHI**2 IS MINIMAL. THE INPUT ARGUMENTS REMAIN UNCHANGED
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   TFITTK                                                                          
        |---- TREMPT                                                               
                   |----  TFTHEL                                                   
                   |----  PROB                                External             
                   |----  FLOAT                               External             
   
 
3 TRFTCH
         SUBROUTINE TRFTCH
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Perform "helix" fit to coordinates of current chain
   
       Author:    M. Mermikides
       Modified:  M. Mermikides 22-04-87
       Modified:  R. Johnson    19-01-88
       Modified:  F. Weber       8-6-89
       Modified:  M.Mermikides  17-08-89
   
      Called by TRKFND
   
       Description
       ===========
       Use internal errors on r-phi and z coordinates
       Add m/s error and external r-phi error for oblique tracks
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   TRKFND                                                                          
   TRPROJ                                                                          
   TRRESC                                                                          
        |---- TRFTCH                                                               
                   |----  IBITS                               External             
                   |----  NAMIND                              External             
                   |----  VZERO                               External             
                   |----  MCHAIN                              External             
                   |----  D2CHAI                              External             
                   |----  FLOAT                               External             
                   |----  TFITHL                                                   
                   |----  SIGN                                External             
                   |----  ABS                                 External             
                   |----  COS                                 External             
                   |----  SIN                                 External             
                   |----  ASIN                                External             
                   |----  SQRT                                External             
                   |----  UCOPY                               External             
   
 
3 TRHLX2
         SUBROUTINE TRHLX2(RAD,PAR,V,IERR)
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Intersection of helix with cylinder
   
      Author:   M Mermikides  6-10-86
      Modified: D.Smith      99/10/27 Double precision fixes for Linux
   
      Input:
         PAR:    /R      Helix parameters Q*Rho,tanl,phi0,d0,z0
         RAD:    /R      Radius of cylinder centered at zero
      Output:
         V:      /R      1 intersection points, x,y,z,phi
         IERR:   /I      =1 if intersection is not physical
   
      Description:
      -----------
      Computes intersections of first full turn of helix described by
      parameters PAR (Q*Rho, tanl, phi0, d0, z0) with cylinder of radius
      RAD centred at zero.   Intersection points returned in
      V(x,y,z,phi, 2)
   
      Called by TRPROJ
   
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   TRPROJ                                                                          
        |---- TRHLX2                                                               
                   |----  ABS                                 External             
                   |----  SIGN                                External             
                   |----  ASIN                                External             
                   |----  COS                                 External             
                   |----  SIN                                 External             
                   |----  SQRT                                External             
                   |----  DBLE                                External             
   
 
3 TRKDMP
         SUBROUTINE TRKDMP(IUNIT,ICTRL)
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Dump all fitted tpc tracks
   
      Author:    Z. Feng    10-03-87
      Modified:  R. Johnson  6-05-87
   
      Called by TPCREC
   
      Input:
            - IUNIT   /I    Fortran output logical unit number
            - ICTRL   /I    Control parameter
                            0:  print only track information
                            1:  include coordinates
                            2:  include wire hits
                            3:  include coordinates and wire hits
   
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   TPCREC                                                                          
        |---- TRKDMP                                                               
                   |----  NAMIND                              External             
                   |----  TKSGDP                                                   
   
 
3 TRKELS
         SUBROUTINE TRKELS(IER)
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Sum up de/dx for tracks
   
       Author:   R. Johnson   23-04-87
       Modified: R. Johnson   21-01-91 flag track segments with more
                              than 40% of the samples saturated
                              11-09-91 nonlinear and z corrections
                              24-08-92 2-sided truncated mean
                              2-3-93   data-base control such that
                                       old algorithm still works
                 D. Casper    26-7-98  ensure that zero charge samples
                                       remain zero after correction
   
       Output: IER     /I      Set to 1 if BOS runs out of space.
                               Set to 0 for a good return.
   
       Called by TPCREC
   
       Description
       -----------
       This routine calculates the truncated mean for each TPC track.
       The output goes into the banks TELS and TEXS.
   
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   TPCREC                                                                          
        |---- TRKELS                                                               
                   |----  NAMIND                              External             
                   |----  BDROP                               External             
                   |----  WBANK                               External             
                   |----  INTCHA                              External             
                   |----  AUBOS                               External             
                   |----  BLIST                               External             
                   |----  BWIND                               External             
                   |----  ALOG                                External             
                   |----  RERROR                                                   
                   |----  SQRT                                External             
                   |----  VZERO                               External             
                   |----  ABS                                 External             
                   |----  SORTZV                              External             
                   |----  MAX                                 External             
                   |----  IBITS                               External             
                   |----  FLOAT                               External             
                   |----  AUBPRS                              External             
                   |----  WDROP                               External             
   
 
3 TRKFND
         SUBROUTINE TRKFND(IER)
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Track-finding in the tpc
    using 3-D chain method (ALEPH-TPCDET Note 84-69)
   
      Author:     M.Mermikides    06-10-86
      Modified:   R.Johnson        8-04-88
      Modified:   M.Mermikides    19-08-89
   
      Output:  IER    /I    Error code, nonzero if error has occurred
      Input banks:
               'TPCO'       TPC coordinates
               'TCRL'       TPC coordinate row list
      Output banks:
               'TCHA'       Chain parameters
               'TCTC'       Chain -> coordinate reference
   
   
      Called by TPCREC
   
      Strategy:
      ========
   
        Three-point links are formed from successive padrows,
     starting from the outermost row.(There can be a maximum gap
     of MAXGAP between successive rows). Links are sorted in order
     of decreasing radius of curvature and propagated inwards
     using a local point search to form longest possible chain.
     Chains are verified by a helix fit and fitted parameters
     are used to project incomplete chains both inwards and
     outwards to pick extra coordinates.
   
     Workbanks used internally:
                   INDCXY    X-Y coordinates corresp. to TPCO
                   INDLNK    Padrow and hit references and
                             helix parameters of links from
                             current staring row
                   JSORTW    Workspace for sorting links
                   INDBIN    Date structure for binned coordinates
   
     NOTE:  This routine and the subroutines which it calls represent
            a MODULE within JULIA.
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   TPCREC                                                                          
        |---- TRKFND                                                               
                   |----  IBITS                               External             
                   |----  NAMIND                              External             
                   |----  BDROP                               External             
                   |----  WBANK                               External             
                   |----  INTCHA                              External             
                   |----  TCOBIN                                                   
                   |----  RERROR                                                   
                   |----  AUBOS                               External             
                   |----  BLIST                               External             
                   |----  COS                                 External             
                   |----  SIN                                 External             
                   |----  IF                                  External             
                   |----  TRSLNK                                                   
                   |----  ABS                                 External             
                   |----  SORTZV                              External             
                   |----  UCOPY                               External             
                   |----  PCHAIN                              External             
                   |----  VZERO                               External             
                   |----  TRSEEK                                                   
                   |----  TRFTCH                                                   
                   |----  TRRESC                                                   
                   |----  TRPROJ                                                   
                   |----  MCHAIN                              External             
                   |----  IBSET                               External             
                   |----  WDROP                               External             
                   |----  TSAPAT                                                   
                   |----  AUBPRS                              External             
   
 
3 TRKMCA
         SUBROUTINE TRKMCA
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Associate tpc tracks with mc tracks
   
       Author:   R. Johnson   11-10-87
       Modified: R. Johnson   19-01-88
   
       Called by TPHIST
   
       Description
       ===========
       First, all coordinates must be associated with Monte Carlo hits
       by a call to the routine TREFCH, which will fill the bank
       TPCH.  Then for each fitted track in bank TGFT, all Monte Carlo
       tracks are found which contain at least one hit matching with
       a coordinate used on the fitted track.  These results, including
       a chi-squared value giving a quality of each match, are stored
       in the banks TGMA and TMTL.
   
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   TPCREC                                                                          
        |---- TRKMCA                                                               
                   |----  NAMIND                              External             
                   |----  BDROP                               External             
                   |----  MDARD                               External             
                   |----  JUNIDB                              External             
                   |----  AUBOS                               External             
                   |----  BLIST                               External             
                   |----  TNRHPA                              External             
                   |----  AUBPRS                              External             
   
 
3 TRKWRA
         SUBROUTINE TRKWRA(IER)
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Match wire hits to tracks
   
       Author:   R. Johnson    7-02-89
       Modified: R. Johnson   12-01-91 make a more careful check of
                              which sectors the tracks pass through
                              24-08-92 make list of dead wires for TFTWTB
                              2-3-93 database control of constants
   
       Output:  IER     /I      =1 if BOS is out of space
                                =0 if all is OK
       Input banks:
              TWRR              Reduced and packed wire pulses
              TGFT,TGFT,TGCL    TPC tracks
              TPCO              TPC pad coordinates
              TWPU              Optional expanded wire bank
       Output banks:
              TWTB,TWIT,TWAT    Created and filled
              TWPU              Pointer filled if present
   
       Called by TPCREC
   
       Description
       -----------
       For each track in TGFT, the program determines which sectors
       it crosses by looking at which sectors it has coordinates on.
       For each wire on those sectors it calculates the crossing
       point of the x-y projection of the track.  If this point is
       within the bounds of the wire and not too far from the
       track origin, in terms of turning angle, then the track parmameter
       are used to find the z position of the track at that point.  A
       search is made over all hits on the wire to find those within
       a z window of the track position.  If only ONE such pulse is
       found and if this pulses matches in this fashion only ONE
       track, then the pulse is associated with the wire by entering
       it into the TWTB bank.  Also included are some calibration
       corrections and a calculation of the length of the track
       element which contributes charge to the wire.
   
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   TPCREC                                                                          
        |---- TRKWRA                                                               
                   |----  NAMIND                              External             
                   |----  BDROP                               External             
                   |----  BLIST                               External             
                   |----  AUBOS                               External             
                   |----  VZERO                               External             
                   |----  WBANK                               External             
                   |----  INTCHA                              External             
                   |----  IF                                  External             
                   |----  MAX                                 External             
                   |----  MIN                                 External             
                   |----  MOD                                 External             
                   |----  RERROR                                                   
                   |----  TSNEXT                              External             
                   |----  TSCINT                              External             
                   |----  SORTZV                              External             
                   |----  IBITS                               External             
                   |----  TGHPAL                              External             
                   |----  TGHPTS                              External             
                   |----  ABS                                 External             
                   |----  SQRT                                External             
                   |----  SIGN                                External             
                   |----  SIN                                 External             
                   |----  COS                                 External             
                   |----  TFTWTB                                                   
                   |----  WDROP                               External             
                   |----  AUBPRS                              External             
   
 
3 TRMVEP
         SUBROUTINE TRMVEP(KTSCL,IC,KTSPU,RPULS,JP1,NSPL)
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Cut low edge pulses from a subcluster
    Author:  R. Johnson   15-12-89
    Input:  KTSCL        /I      BOS pointer to subcluster bank
            IC           /I      Subcluster number
            KTSPU        /I      BOS pointer to subpulse bank
            RPULS        /I      List of pulse heights in subcluster
            JP1          /I      First pulse in RPULS to be used for
                                 coordinate calculation
            NSPL         /I      Number of pulses in RPULS to be used
                                 for coordinate calculation
    Output: JP1,NSPL     /I      Updated values after removal of
                                 useless edge pulses
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   TCOOR                                                                           
   TCOORT                                                                          
        |---- TRMVEP                                                               
                   |----  AMAX1                               External             
   
 
3 TRNCON
         SUBROUTINE TRNCON
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Load tpc run constants
   
       Author:    R. Johnson   16-12-86
       Modified:  M.Mermikides 13-03-87
                  R. Johnson   11-09-91
                  E. Lancon    25-02-92 use alephlib routine TPDVEL to
                                        load drift velocity
                  R. Johnson    2-3-93  add TC7X bank
                                5-9-93  add DZNLTW cut to TC7X
                  E. Lancon    21.7.93  Load TDXC bank from daf
                  F.Ranjard    23.3.94  use GTT0GL to get T0GL bank
                                        use T0GL bank even for MCdata
                                        when TPCSIM version > 217
                              10.5.94   fill sector gain map :
                                        /TMONIT/GAINTM(LTSECT) with
                                        TC2X info for run<20000 or
                                        TCSX info for run>20000
                                        if no bank is found then gain=1.
                                        book DEDX histograms or reset them
                 F.Ranjard    29.8.94   wire pedestal is set to 0
                                        for runs > 28833 since pedestals
                                        are also substracted for
                                        unreduced wire hits in online
                                        DAQ program.
                 I.Tomalin     3.4.95   Added TVOFS0 and TPCCLK to
                                        /TPCCON/ to cope with bunch trains.
                 D.Casper     26.10.95  Read pad dE/dx constants, book histos
                              05.06.96  Read constants for pulse-shape correction
                                        from TSHP bank on database.
                 M.Cattaneo   20.08.97  Read TNRN bank from database
                 W.Wiedenmann 12.05.99  Read clock frequency in Hz from TSOR bank
   
   
       Called by TINIRU
   
       Description
       ===========
       Parameters for TPC reconstruction which are constant for a run
       are initialized here.  The data comes from a direct access
       file.  Temporarily, at least, if the direct access data is not
       found then some default numbers are loaded in by hand.  The user
       may also put the banks onto input cards, in which case the
       direct access banks will be ignored.
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   TINIRU                                                                          
        |---- TRNCON                                                               
                   |----  MDARD                               External             
                   |----  REPORT                                                   
                   |----  NAMIND                              External             
                   |----  FLOAT                               External             
                   |----  TLCTDP                                                   
                   |----  ALGTDB                              External             
                   |----  UCOPY                               External             
                   |----  ABRUEV                              External             
                   |----  GTSTUP                              External             
                   |----  JUNIDB                              External             
                   |----  AGETDB                              External             
                   |----  RERROR                                                   
                   |----  HBOOK1                              External             
                   |----  HIDOPT                              External             
                   |----  HRESET                              External             
                   |----  CHAINT                              External             
                   |----  RGETDV                                                   
                   |----  TPDVEL                              External             
                   |----  GTT0GL                              External             
                   |----  TVOFFFORMAT                         External             
                   |----  TSORDP                                                   
                   |----  ABS                                 External             
                   |----  NDANR                               External             
                   |----  NLINK                               External             
                   |----  FORMAT                              External             
   
 
3 TRPHDI
         FUNCTION TRPHDI(PHI1,PHI2)
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Difference between phi1 ind phi2 in range -pi to + pi
    (PHI1, PHI2 are in range 0 - 2pi)
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   TRPROJ                                                                          
   TRSEEK                                                                          
   TRSLNK                                                                          
   TSACHA                                                                          
   TSACLU                                                                          
        |---- TRPHDI.                                                              
   
 
3 TRPROJ
         SUBROUTINE TRPROJ
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Projects chain to find more hits
   
      Author:     M. Mermikides    06-10-86
      Modified:   R. Johnson       19-01-88
      Modified:   M. Mermikides    19-08-89
   
      Called by TRKFND
   
     Road width is Min(TDZSTR,TDZMAX)*Min(TDWSTR,TDWMAX)
     The chain is extended iteratively until there are no more
     hits that can be added.
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   TRKFND                                                                          
        |---- TRPROJ                                                               
                   |----  IBITS                               External             
                   |----  NAMIND                              External             
                   |----  ABS                                 External             
                   |----  PCHAIN                              External             
                   |----  SIGN                                External             
                   |----  MAX                                 External             
                   |----  MIN                                 External             
                   |----  INT                                 External             
                   |----  TPPROW                              External             
                   |----  TPDRST                              External             
                   |----  UCOPY                               External             
                   |----  MCHAIN                              External             
                   |----  D2CHAI                              External             
                   |----  SQRT                                External             
                   |----  COS                                 External             
                   |----  SIN                                 External             
                   |----  VFILL                               External             
                   |----  TRHLX2                                                   
                   |----  ATAN2                               External             
                   |----  TRPHDI                                                   
                   |----  IF                                  External             
                   |----  NXTR1FORMAT                         External             
                   |----  FORMAT                              External             
                   |----  TRFTCH                                                   
   
 
3 TRRESC
         SUBROUTINE TRRESC
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Rescue a chain,
    break it in half and refit
   
     M.Mermikides  6/10/86   V 1.0
   
     Called by TRKFND
   
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   TRKFND                                                                          
        |---- TRRESC                                                               
                   |----  TRFTCH                                                   
   
 
3 TRSEEK
         SUBROUTINE TRSEEK
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Propagate current 3-point link to form chain
   
      Author:     M. Mermikides    06-10-86
      Modified:   R. Johnson       19-01-88
      Modified:   M.Mermikides     17-08-89
   
      Called by TRKFND
   
       Description
       ===========
    Extract hits from adjacent padrows extrapolating from current
    starting link.  Given a link joining hits on padrows j, j-1,
    j-2, we form new  3-point links using the previously assigned
    hits on rows j-1, j-2 and each hit on row j-3.  A link is
    acceptable if it passes the following tests:
   
          1.Difference in phi between hits in successive padrows
                                      < DPNEXT
          2.Difference in z between hits in successive padrows
                                      < DZNEXT
          3.Radius of curvature of link > RHOMIN
          4.Difference between predicted z value of middle point
            of new link and old z value < TDZTOL (take account
                                                of dip angle)
          5.D0 of new link < TD0TOL
          6.Z0 of new link < TZ0TOL
          7.Consistency in curvature with previous link < CURTOL
   
       The process is repeated until one of the following occurs :
                1. Innermost padrow reached
                2. More than one link passes above tests
                3. No link is found over MAXGAP successive padrows
   
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   TRKFND                                                                          
        |---- TRSEEK                                                               
                   |----  IBITS                               External             
                   |----  NAMIND                              External             
                   |----  ABS                                 External             
                   |----  PCHAIN                              External             
                   |----  INT                                 External             
                   |----  TRPHDI                                                   
                   |----  SQRT                                External             
                   |----  ASIN                                External             
                   |----  ATAN2                               External             
                   |----  COS                                 External             
                   |----  SIN                                 External             
   
 
3 TRSLNK
         SUBROUTINE TRSLNK(IR3,IR2,IR1,IPTR3,NLK,IER)
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Search for link across 3  padrows
   
     Author:   M. Mermikides   6-10-86
     Modified: R. Johnson     19-01-88
   
     Input:
         - IR3       /I      TPC row number
         - IPTR3     /I      Hit in this row at which to begin.  This
                             points into the workbank INDBIN
         - IR2       /I      Middle row number
         - IR1       /I      Inner row number
     Output:
         - NLK       /I      No of valid links found
         - IER       /I      Error code =0 for good return
                             Set to 1 if BOS runs out of space
   
     Called by TRKFND
   
     Description:
     -----------
     Condition for accepting a link are:
           1. Phi difference between hits on successive padrows < DPNEXT
           2. z difference between hits on successive padrows   < DZNEXT
           3. Radius of curvature of link  > RHOMIN
           4. Consistency in z (|pred.z -msd z|) < TDZTOL
           5. Closest approach to origin in r-phi, D0 < TD0TOL
           6. Z at D0  < TZ0TOL
     Rows, hit ref and link parameters are entered in workbanks INDLNK
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   TRKFND                                                                          
        |---- TRSLNK                                                               
                   |----  IBITS                               External             
                   |----  NAMIND                              External             
                   |----  INT                                 External             
                   |----  IF                                  External             
                   |----  TRPHDI                                                   
                   |----  ABS                                 External             
                   |----  SQRT                                External             
                   |----  ASIN                                External             
                   |----  ATAN2                               External             
                   |----  COS                                 External             
                   |----  SIN                                 External             
                   |----  WBANK                               External             
                   |----  RERROR                                                   
   
 
3 TSACHA
         SUBROUTINE TSACHA(IRMIN,IRMAX,NCROW,JCROW)
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Find chains from coordinates in the current
     cluster.
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   TSATRK                                                                          
        |---- TSACHA                                                               
                   |----  NAMIND                              External             
                   |----  VZERO                               External             
                   |----  ABS                                 External             
                   |----  MOD                                 External             
                   |----  TRPHDI                                                   
                   |----  FLOAT                               External             
                   |----  COS                                 External             
                   |----  SIN                                 External             
                   |----  SQRT                                External             
                   |----  ASIN                                External             
                   |----  ATAN2                               External             
                   |----  TFITHL                                                   
                   |----  UCOPY                               External             
                   |----  WBANK                               External             
                   |----  IBSET                               External             
                   |----  RERROR                                                   
   
 
3 TSACLU
         SUBROUTINE TSACLU
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Find theta-phi pad clusters
   
       Author:    M. Mermikides  890904
   
       Description
       ===========
       1.  Use a simple clustering algorithm to find pad hits in adjacent
           bins of the histogram stored in the JTPHIS work bank.
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   TSAPAT                                                                          
        |---- TSACLU                                                               
                   |----  NAMIND                              External             
                   |----  SORTIQ                              External             
                   |----  WBANK                               External             
                   |----  INTCHA                              External             
                   |----  ATAN                                External             
                   |----  TRPHDI                                                   
                   |----  FLOAT                               External             
                   |----  RERROR                                                   
   
 
3 TSACOR
         SUBROUTINE TSACOR
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Update and sort coordinate banks after small angle tracking
    Author:  M. Mermikides          22-DEC-1989
    Modified D. Casper              24-APR-1996  Flag coords modified by
                                                 this routine to avoid
                                                 correcting wire z.
       Input:    Banks TPBO,TBCO,JTNWCO,JTTCHA,JTTCTC
       Output:   Updated TPCO(NR=2),TBCO(NR=0),TCHA and banks
                 referencing TPCO (TCTC,TCRL,TPCH,TSCL)
       Called by TSATRK
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   TSAPAT                                                                          
        |---- TSACOR                                                               
                   |----  NAMIND                              External             
                   |----  BWIND                               External             
                   |----  MOD                                 External             
                   |----  IENDTP                              External             
                   |----  AUBOS                               External             
                   |----  IABS                                External             
                   |----  WBANK                               External             
                   |----  SORTZV                              External             
                   |----  NLINK                               External             
                   |----  UCOPY                               External             
                   |----  VZERO                               External             
                   |----  NDROP                               External             
                   |----  BLIST                               External             
                   |----  WDROP                               External             
                   |----  RERROR                                                   
   
 
3 TSAPAT
         SUBROUTINE TSAPAT
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Steering for track finding at low polar angles.
   
       Author:    M. Mermikides  890904
   
       Description
       ===========
         1.  Look for unassociated or bad coordinates in the low
             polar angle region (within cone subtented by K sectors)
         2.  Use histogramming method to find potential tracks
             among the missed and bad coordinates (It is assumed that
             we are dealing with fast tracks originating near the IP)
         3.  Improve or define z-coordinate using wire information
         4.  Find tracks using improved coordinates
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   TRKFND                                                                          
        |---- TSAPAT                                                               
                   |----  NAMIND                              External             
                   |----  WBANK                               External             
                   |----  INTCHA                              External             
                   |----  MOD                                 External             
                   |----  ABS                                 External             
                   |----  ATAN                                External             
                   |----  FLOAT                               External             
                   |----  WDROP                               External             
                   |----  TSACLU                                                   
                   |----  TSAWIR                                                   
                   |----  TSATRK                                                   
                   |----  TSACOR                                                   
                   |----  RERROR                                                   
   
 
3 TSATRK
         SUBROUTINE TSATRK
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Steering routine for finding chains from new coordinates.
     After track finding redefine and resequence TPCO, TBCO
     banks and update TCTC (TPCO -> TCHA relation)
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   TSAPAT                                                                          
        |---- TSATRK                                                               
                   |----  WBANK                               External             
                   |----  INTCHA                              External             
                   |----  VZERO                               External             
                   |----  RERROR                                                   
                   |----  TSACHA                                                   
   
 
3 TSAWIR
         SUBROUTINE TSAWIR
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Created by mermikides            26-sep-1989
      Modified:  D. Casper 09-06-95    Support for pad dE/dx in TCOALG
                 D. Casper 26-02-97    Fix grotesque bugs in field/alignment
                                       correction.
                           05-08-97    Replace call to THPFDG with new routine
                                       THPCOR, to correct 1 half-pad coordinates
                                       too.
   
      Purpose   : To associate wires with pads for z-coord. refinement
      Inputs    : Banks TPCO,TBCO, JTPHCL,JTHPHI
      Outputs   : Workbank JTNWCO (see common /TSAWRK/)
   
      Called by : TSAPAT
      Calls     : TPADPO,TWINDO,TSAWTK,UTLSLF
   
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   TSAPAT                                                                          
        |---- TSAWIR                                                               
                   |----  NAMIND                              External             
                   |----  WBANK                               External             
                   |----  INTCHA                              External             
                   |----  ITPTYP                              External             
                   |----  SQRT                                External             
                   |----  MOD                                 External             
                   |----  ABS                                 External             
                   |----  TPADPO                                                   
                   |----  IENDTP                              External             
                   |----  TVOFFS                              External             
                   |----  COS                                 External             
                   |----  TWINDO                                                   
                   |----  TSAWTK                                                   
                   |----  UTLSLF                                                   
                   |----  FLOAT                               External             
                   |----  NLINK                               External             
                   |----  TGETQT                                                   
                   |----  TPRF2                                                    
                   |----  TCOALG                                                   
                   |----  TNHLFP                                                   
                   |----  THPCOR                                                   
                   |----  TSCOOR                                                   
                   |----  TCTGLB                              External             
                   |----  TCRTOF                              External             
                   |----  TLACOR                              External             
                   |----  TCRTRN                              External             
                   |----  TZCRVD                              External             
                   |----  TZCSVD                              External             
                   |----  TCORES                              External             
                   |----  TFICOR                              External             
                   |----  TCOERR                                                   
                   |----  TPDRBG                              External             
                   |----  TPDRST                              External             
                   |----  RERROR                                                   
   
 
3 TSAWTK
         SUBROUTINE TSAWTK(NWIR,RWIRE,BUCK,NTCAN,ITIND)
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Look for track candidates in bucket # vs wire
    position projection using a histogramming method.
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   TSAWIR                                                                          
        |---- TSAWTK                                                               
                   |----  FLOAT                               External             
                   |----  VZERO                               External             
                   |----  TWPEAK                                                   
                   |----  NINT                                External             
   
 
3 TSCFIL
         SUBROUTINE TSCFIL(ICLUS,KTSCL,KTSPU)
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Fill subpulse and subcluster banks
   
       Author:    R. Johnson   11-01-88
   
       Modified:  D. Casper    05-06-96    Replace algorithm 1 with new code:
                                           same as #2, except first moment of
                                           pulse wrt the midpoint of the edges
                                           is used to correct the z value.
                                           Load the value of the first moment
                                           in an unused location of TSPU.
   
    Input:
        - ICLUS        /I     Cluster number in the bank KTCLU
        - KTSCL        /I     BOS index of the subcluster bank
        - KTSPU        /I     BOS index of the subpulse bank
   
    Called by TCLCOR
   
    Description
    ===========
    In this routine the information from the temporary workbanks ISCLUS
    and ITSPUW is used to fill the subclusters for the current cluster
    into the TSCL bank.  The TSPU bank is filled, and in doing so
    the charge and time estimates for each subpulse are found using
    the algorithms specified in ISCLUS.
   
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   TCLCOR                                                                          
        |---- TSCFIL                                                               
                   |----  SQRT                                External             
                   |----  FLOAT                               External             
                   |----  TPARAB                                                   
                   |----  INT                                 External             
   
 
3 TSCIDP
         SUBROUTINE TSCIDP(IUNIT)
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Dump slow control bank for tpc
    Author:  R. Johnson   21-09-89
    Input:   IUNIT      /I    FORTRAN output unit
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   TSLOWC                                                                          
        |---- TSCIDP                                                               
                   |----  NAMIND                              External             
                   |----  IBITS                               External             
                   |----  FLOAT                               External             
                   |----  FORMAT                              External             
   
 
3 TSCLDP
         SUBROUTINE TSCLDP(ISECT,IUNIT)
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Dump tpc subclusters
   
       Author:    R. Johnson    9-1-87
   
       Input:
          - ISECT     /I     Sector number to be dumped
          - IUNIT     /I     Fortran logical unit number for output
   
       Called by TBPRNT
   
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   TBPRNT                                                                          
        |---- TSCLDP                                                               
                   |----  NLINK                               External             
   
 
3 TSCOOR
         SUBROUTINE TSCOOR(ISLOT,IROW,RPHIP,ZB,RS,RPHIS,ZS)
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Determine coordinate in sector frame
   
       Author:    R. Johnson  03-08-87
       Modified:  R. Johnson  19-01-88
   
       Input:
          - ISLOT     /I      Sector slot number
          - IROW      /I      Padrow number in the sector
          - RPHIP     /R      r*phi coordinate in units of pad spacing
          - ZB        /R      Z coordinate in units of bucket length
       Output:
          - RS        /R      radius in units of cm in sector frame
          - RPHIS     /R      r*phi coordinate in units of cm
          - ZS        /R      z coordinate in units of cm
   
       Called by TCOOR
   
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   TCODRV                                                                          
   TCOOR                                                                           
   TCOORT                                                                          
   TREFCH                                                                          
   TSAWIR                                                                          
   TWINCO                                                                          
        |---- TSCOOR                                                               
                   |----  ITPTYP                              External             
                   |----  TVOFFS                              External             
                   |----  IENDTP                              External             
                   |----  TPDSEP                              External             
                   |----  FLOAT                               External             
                   |----  TPPROW                              External             
                   |----  TAPRPH                              External             
   
 
3 TSEQUE
         SUBROUTINE TSEQUE
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Drop tpc sectors which are out of sequence
    Author:   R. Johnson    3-08-89
    Modified: R. Johnson   21-01-91  also drop TRIR and TRDI
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   TPREDA                                                                          
        |---- TSEQUE                                                               
                   |----  NAMIND                              External             
                   |----  IF                                  External             
                   |----  RERROR                                                   
   
 
3 TSIRDP
         SUBROUTINE TSIRDP(IUNIT,ISLOT)
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Dump the tsir, tsle, and tsdi banks (tpc wire raw data) to
    unit IUNIT for sector slot number ISLOT
    Author:   R. Johnson  13-8-92
    PLEASE do not delete this routine from the library even
    though it is not called by any other Julia routine.  It is
    a useful debugging and testing tool.
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
              TSIRDP                                                               
                   |----  NLINK                               External             
                   |----  IBITS                               External             
                   |----  FLOAT                               External             
                   |----  MOD                                 External             
                   |----  MIN                                 External             
                   |----  TVOFFS                              External             
                   |----  IENDTP                              External             
   
 
3 TSLOWC
         SUBROUTINE TSLOWC
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Handle slow control banks for the tpc
    R. Johnson    23-09-89
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   RUNKNO                                                                          
        |---- TSLOWC                                                               
                   |----  NAMIND                              External             
                   |----  TSCIDP                                                   
                   |----  FLOAT                               External             
   
 
3 TSMFT
         SUBROUTINE TSMFT
  ------------------------------------------------------------------------------
    CKEY TPC SMEARING
  ------------------------------------------------------------------------------
   Smear and refit frft  tracks in mc events
    Author      : A. BONISSENT 050298
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
              TSMFT                                                                
                   |----  NAMIND                              External             
                   |----  AUBOS                               External             
                   |----  UCOPY                               External             
                   |----  NLINK                               External             
                   |----  TPHSMR                                                   
                   |----  TREFIT                                                   
                   |----  NDROP                               External             
                   |----  RERROR                                                   
   
 
3 TSORDP
         SUBROUTINE TSORDP(LUNIT)
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Print tpc start-of-run conditions
        Author:   R. Johnson   27-06-88
                  W.Wiedenmann 12.05.99  Display clock frequency in Hz
                                         from TSOR bank
        Input:    LUNIT     /I     Fortran logical unit for output
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   TRNCON                                                                          
        |---- TSORDP                                                               
                   |----  NAMIND                              External             
                   |----  CHAINT                              External             
                   |----  FLOAT                               External             
   
 
3 TSPUDP
         SUBROUTINE TSPUDP(ISECT,IUNIT)
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Dump tpc subpulses
   
       Author:    R. Johnson    9-1-87
   
       Input:
          - ISECT     /I     Sector number to be dumped
          - IUNIT     /I     Fortran logical unit number for output
   
       Called by TBPRNT
   
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   TBPRNT                                                                          
        |---- TSPUDP                                                               
                   |----  NLINK                               External             
   
 
3 TSUMVD
         SUBROUTINE TSUMVD
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Create and fill tsvd bank.
   
     Author: I.Tomalin  4/8/95
   
    Input banks: FRFT, FRTL, FTCL, TPCO, VDZT, VDXY, VTXT
    Output bank: TSVD
   
    Loop over good tracks having all coords. in one TPC half.
      Extrapolate each track back to VDET using VTXT bank.
      Find VDET z hits in +-2cm window around extrapolation.
      If only 1 hit in window note its residual in TSVD bank.
    End Loop
    See ALEPH note 95-108 for details.
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   RECEVT                                                                          
        |---- TSUMVD                                                               
                   |----  TIZERO                              External             
                   |----  RQBUNC                              External             
                   |----  NLINK                               External             
                   |----  NAMIND                              External             
                   |----  WBANK                               External             
                   |----  INTCHA                              External             
                   |----  ABS                                 External             
                   |----  SQRT                                External             
                   |----  MOD                                 External             
                   |----  IENDTP                              External             
                   |----  VADEWA                              External             
                   |----  VJFACI                              External             
                   |----  VJWFFW                              External             
                   |----  VSLOTF                              External             
                   |----  VVUWAB                              External             
                   |----  VINSEN                              External             
                   |----  VNRWFF                              External             
                   |----  FLOAT                               External             
                   |----  INT                                 External             
                   |----  RERROR                                                   
   
 
3 TSZCOR
         SUBROUTINE TSZCOR(ITE,TIME,RPH,N,ZB)
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Calculate cluster z coordinate
   
       Author:    R. Johnson  03-08-87
       Modified:  R. Johnson  08-04-88
   
       Input:
          - ISLOT     /I     Sector slot number
          - ITE       /I     Algorithm used to calculate TIME
          - TIME      /R     List of time estimates from adjacent pads
          - RPH       /R     List of charge estimates from adjacent pads
          - N         /I     Number of pads
       Output:
          - ZB        /R     Z position in units of time buckets
   
       Called by TCOOR
   
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   TCOOR                                                                           
   TCOORT                                                                          
   TWINCO                                                                          
        |---- TSZCOR.                                                              
   
 
3 TTLOOP
         INTEGER FUNCTION TTLOOP(ITK)
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Author   :- d.cinabro              3-dec-1990
      Modified :- D.Cinabro             19-MAY-1991
   
      Inputs:ITK /I FRFT row number of track under consideration
           -
   
      Outputs: 0 if FRFT paramters are the only loop of the track
           -   >0 row in TARC of the last loop on the track
               <0 if an error has occured
   
      Libraries required:
   
      Description
      ===========
      Find which row in TCAL this track points to.  If TCAL indicates
      there is more than one arc, loop in TARC and find which is the
      final arc and return
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   EPRTPC                                                                          
        |---- TTLOOP                                                               
                   |----  NAMIND                              External             
                   |----  ABS                                 External             
   
 
3 TTRUNK
         SUBROUTINE TTRUNK
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Fix tpc raw data for truncated sectors by making the hit list
    agree with the number of digitizations.
    Author:   R. Johnson    3-08-89
    Modified: R. Johnson   21-01-91  include TRIR and TRDI banks
    Modified: W. Wiedenmann 3-02-92  include TSIR and TSDI banks
                                        "    TANF/TWNF banks
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   TPREDA                                                                          
        |---- TTRUNK                                                               
                   |----  NAMIND                              External             
                   |----  IF                                  External             
                   |----  RERROR                                                   
                   |----  NLINK                               External             
                   |----  NDROP                               External             
                   |----  F                                   External             
                   |----  IBITS                               External             
                   |----  AUBOS                               External             
   
 
3 TTWODX
         SUBROUTINE TTWODX(IER)
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Calculate de/dx for overlapping tpc tracks
   
      Author   :- D.Cinabro             30-NOV-1989
      Modified :- R.Johnson             12-APR-1991
                  fixed bug in addition of non-overlapping samples and
                  changed truncation mean scheme to match that in TRKELS
                  G.Taylor               9-SEP-1991
                  fixed many bugs-->1st tested, working version
      Modified :- M.Cattaneo            24-AUG-1998
                  Bank T2XS was not being extended a second time if necessary
   
      Inputs: TGFT,TWTB,TWOL
   
      Outputs: T2XS
   
      Libraries required: BOS,JULIA
   
      Description
      ===========
      Calculate the truncated mean for TPC tracks which overlap with
      one other TPC track.  The output is stored in T2XS.
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   TPCREC                                                                          
        |---- TTWODX                                                               
                   |----  NAMIND                              External             
                   |----  BDROP                               External             
                   |----  ALOG                                External             
                   |----  TTWOSH                                                   
                   |----  WBANK                               External             
                   |----  INTCHA                              External             
                   |----  AUBOS                               External             
                   |----  VZERO                               External             
                   |----  ABS                                 External             
                   |----  SORTZV                              External             
                   |----  FLOAT                               External             
                   |----  WDROP                               External             
                   |----  AUBPRS                              External             
                   |----  RERROR                                                   
   
 
3 TTWOSH
         SUBROUTINE TTWOSH(IT1,IT2)
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Calculate number of wire hits shared by two tracks
   
      Author   :- D.Cinabro             30-NOV-1989
   
      Inputs: IT1 /I One TGFT track number
              IT2 /I A different TGFT track number
   
      Outputs: Via workbank existence or not.
   
      Libraries required: BOS
   
      Description
      ===========
       Given two TGFT track numbers calculate the number of wire
       hits shared by the two.  Store the pointers to these hits
       in a workbank if there are more than MNSPTW many otherwise make
       no bank.
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   TTWODX                                                                          
        |---- TTWOSH                                                               
                   |----  NAMIND                              External             
                   |----  WOSEC                               External             
                   |----  WBANK                               External             
                   |----  INTCHA                              External             
                   |----  WDROP                               External             
   
 
3 TTWOSI
         SUBROUTINE TTWOSI(IT1,IT2)
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Calculate number of unshared wire hits of two tracks on the same w
   
      Author   :- D.Cinabro             2-DEC-1989
   
      Inputs: IT1 /I One TGFT track number
              IT2 /I A different TGFT track number
   
      Outputs: Via workbank existence or not.
   
      Libraries required: BOS
   
      Description
      ===========
       Given two TGFT track numbers calculate the number of wire
       hits on the same wire of the two tracks.  Store the pointers to
       these hits in a workbank.
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
              TTWOSI                                                               
                   |----  NAMIND                              External             
                   |----  IBITS                               External             
                   |----  WBANK                               External             
                   |----  INTCHA                              External             
                   |----  WDROP                               External             
   
 
3 TVDVEL
         SUBROUTINE TVDVEL
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Calculate tpc drift velocity using vdet.
   
       Author  : I. Tomalin  15-8-95
       Modified: I. Tomalin   8-7-96 (Protection for small no. of VDET coords)
   
    Input banks: TSVD, JCON
    Output bank: TVVD
   
    Calculate drift velocity using VDET residuals from TSVD bank.
    First find truncated mean residual in each side.
    Then find V_d using difference of these two numbers.
    See ALEPH note 95-108 for details.
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   TPCRUN                                                                          
        |---- TVDVEL                                                               
                   |----  NLINK                               External             
                   |----  RERROR                                                   
                   |----  FLOAT                               External             
                   |----  SQRT                                External             
                   |----  MAX                                 External             
                   |----  ERF                                 External             
                   |----  EXP                                 External             
                   |----  MIN                                 External             
                   |----  ABS                                 External             
                   |----  AUBOS                               External             
                   |----  BKFMT                               External             
                   |----  WDROP                               External             
   
 
3 TWINCO
         SUBROUTINE TWINCO(ISLOT,IROW,ISC,ICH1,ICH2,
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
        &                                       ITPCO,RTPCO,IRET)
   Make 2 coords from 1 subcluster
    Author:  R. Johnson   14-12-89
       Input:  ISLOT         /I    TPC sector slot number
               IROW          /I    TPC global row number of subcluster
               ISC           /I    Subcluster number in bank TSCL
               ICH1          /I    1st chain contributing to the
                                   subcluster (pointer into TCHA)
               ICH2          /I    2nd chain contributing to ISC
       Output: ITPCO         /I    Two rows of TPCO for new coords
               RTPCO         /I    Same as ITPCO
               IRET          /I    =0 if calculation successful
       Called by TOVRLP
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   TOVRLP                                                                          
        |---- TWINCO                                                               
                   |----  NAMIND                              External             
                   |----  NLINK                               External             
                   |----  ITPTYP                              External             
                   |----  ABS                                 External             
                   |----  SIGN                                External             
                   |----  TGHPAL                              External             
                   |----  THLCIR                              External             
                   |----  TPPROW                              External             
                   |----  SQRT                                External             
                   |----  RERROR                                                   
                   |----  TGETQT                                                   
                   |----  AMAX1                               External             
                   |----  TSZCOR                                                   
                   |----  TVOFFS                              External             
                   |----  IENDTP                              External             
                   |----  TPRF2                                                    
                   |----  TCO4PA                                                   
                   |----  FLOAT                               External             
                   |----  TSCOOR                                                   
                   |----  TCTGLB                              External             
                   |----  TCOERR                                                   
                   |----  TLACOR                              External             
                   |----  TCRTRN                              External             
                   |----  TCRTOF                              External             
                   |----  TZCRVD                              External             
                   |----  TZCSVD                              External             
                   |----  TCORES                              External             
                   |----  TFICOR                              External             
   
 
3 TWINDO
         SUBROUTINE TWINDO(ISEC,R01,R02,IT1,IT2,NW,R0,BK,MAXS,SIG)
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Pick wire pulses within wire range r01 to r02 and time
     window IT1 to IT2 and return the number of pulses found in NW
     and their positions and bucket numbers in the arrays R0 and BK.
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   TSAWIR                                                                          
        |---- TWINDO                                                               
                   |----  FLOAT                               External             
                   |----  ITPTYP                              External             
                   |----  NLINK                               External             
                   |----  IBITS                               External             
                   |----  RERROR                                                   
   
 
3 TWIRES
         SUBROUTINE TWIRES(IER)
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Create tpc wire-pulses.
   
      Author:   R. Johnson   20-07-89
      Modified: R. Johnson   21-01-91 new reduction algorithm
      Modified: W. Wiedenmann 3-02-92 new banks TSIR,TSDI
      Modified: R. Johnson   24-08-92 handle pulse length banks
      Modified: R. Johnson    4-09-93 split double peaked pulses
                                      and add reference bank TWRF
                                      Obsolete TWPU bank removed.
   
      Output: IER       /I    Error code:  1 = we ran out of space
                                           2 = input banks missing
                                           0 = space is OK
      Input banks:
              TSIR,TSDI,TSLE  Wire hits and digitizations
      Output banks:
              TWRF       Wire pulses and pointers (optional)
              TWRR,TWLE       Reduced TRIR bank and pulse length bank
   
      Called from TPREDA
   
      Description
      ===========
        Banks TWRR and TWLE are created and filled for sector ISLOT.
        TWRF contains pointers from TWRR back to TSIR and TSDI.
        It is optional (with the TOPT 'TWPU' card) and is not
        used further by JULIA.  It is useful for debugging.
   
      NOTE: This routine represents a module within JULIA.
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   TPREDA                                                                          
        |---- TWIRES                                                               
                   |----  NAMIND                              External             
                   |----  BDROP                               External             
                   |----  BLIST                               External             
                   |----  RERROR                                                   
                   |----  ITPTYP                              External             
                   |----  JPEDST                              External             
                   |----  AUBOS                               External             
                   |----  NLINK                               External             
                   |----  IBITS                               External             
                   |----  FLOAT                               External             
                   |----  MVBITS                              External             
                   |----  MIN                                 External             
                   |----  INT                                 External             
                   |----  MOD                                 External             
                   |----  TRDWP1                                                   
                   |----  TRDWP3                                                   
                   |----  TRDWP2                                                   
                   |----  NDROP                               External             
   
 
3 TWIREZ
         SUBROUTINE TWIREZ(IER)
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Process landau corrections and wire z coordinates
      Author D.Casper
      Modified from TWIRES by I.Tomalin
      Modified       D. Casper   20-05-97  Protect vs. negative VARFIT(3)
                     M.Cattaneo  26-07-97  Protect vs. ABS(B1) .GT. RPAD
                     D.Casper    05-08-97  Do not apply Landau to coords
                                           with half-pads, since the PH
                                           response is falling off at the
                                           sector edge.
                     D.Casper    Mar 1999  Bug fix: use IROWP instead of IROW
                                           for check on whether coord includes
                                           half-pads
                     D.Smith     99/10/27  Double precision fixes for Linux
   
    Input:  TGFT, TGTL, TGCL, TPCO, TWIT, TWAT, TWTB and TWRR banks.
    Output: TWZZ bank.
            Modifies raw r-phi and z values in TPCO
            Integer IER: = 0 if no error occured.
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   TCOORT                                                                          
        |---- TWIREZ                                                               
                   |----  ABS                                 External             
                   |----  NAMIND                              External             
                   |----  ABRUEV                              External             
                   |----  AGETDB                              External             
                   |----  RERROR                                                   
                   |----  NLINK                               External             
                   |----  AUBOS                               External             
                   |----  BWIND                               External             
                   |----  IW                                  External             
                   |----  BLIST                               External             
                   |----  MOD                                 External             
                   |----  IBITS                               External             
                   |----  ITPTYP                              External             
                   |----  FLOAT                               External             
                   |----  TVOFFS                              External             
                   |----  IENDTP                              External             
                   |----  MAX                                 External             
                   |----  UFDALI                              External             
                   |----  UF2TPO                              External             
                   |----  TNHLFP                                                   
                   |----  TPPROW                              External             
                   |----  COS                                 External             
                   |----  SIN                                 External             
                   |----  TCTGLB                              External             
                   |----  SIGN                                External             
                   |----  SQRT                                External             
                   |----  ATAN2                               External             
                   |----  TCTSEC                              External             
                   |----  MIN                                 External             
                   |----  TPDHGT                              External             
                   |----  ACOS                                External             
                   |----  UTLSLF                                                   
                   |----  PROB                                External             
                   |----  AUBPRS                              External             
                   |----  NDROP                               External             
                   |----  BDROP                               External             
                   |----  WDROP                               External             
   
 
3 TWIRFX
         SUBROUTINE TWIRFX
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Standardize tpc wire raw data banks for monte carlo
    R. Johnson    17-01-91
    The versions of TPCSIM earlier than 208 produce banks TWIR, TWDI
    which are reduced.  The reduced banks now are supposed to be named
    TRIR and TRDI.  This routine is called by TPREDA to rename them.
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   TPREDA                                                                          
        |---- TWIRFX                                                               
                   |----  NAMIND                              External             
                   |----  BSWAP                               External             
   
 
3 TWPEAK
         SUBROUTINE TWPEAK(ARR,NTOT, THRSH,MAXLEN,
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
        &                  IOFF1,NLEN,PSUM,NISOL,MXISOL)
   Find isolated peaks in array.
    INPUTS:   PASSED:  --ARR,    Array
                       --NTOT,   Length of array
                       --THRSH   Threshold above which we take take peak
                       --MAXLEN  Max no of successive bins above THRSH
                       --MXISOL, MAX number of peaks allowed
    OUTPUTS:  PASSED:  --NISOL,  number of peaks
                       --IOFF1,  offset from ARR(1) of 1ST BIN OF
                                 each peak
                       --NLEN,   No of bins in each peak
                       --PSUM,   Sum of bin contents under peak
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   TSAWTK                                                                          
        |---- TWPEAK                                                               
                   |----  MIN                                 External             
   
 
3 TWRRDP
         SUBROUTINE TWRRDP(SLOT,UNIT)
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Dump tpc raw and reduced wire data for sector slot
    do not delete this routine from the library, even though
    is not referenced by any other routine---it is essential for
    purposes.
   Author:  R. Johnson    9-4-93
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   TCDUMP                                                                          
        |---- TWRRDP                                                               
                   |----  NLINK                               External             
                   |----  IBITS                               External             
                   |----  MIN                                 External             
                   |----  MOD                                 External             
                   |----  FLOAT                               External             
                   |----  FORMAT                              External             
   

2 U_

  >>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>
    CKEY 
     1st entry in U_set
     ! JULIA 310
        UFITMS,UMXINV,UVPFIT,UVPMAT,UXSFIT,UXSMAT :
                 Double precision fixes for Linux       (D.Smith)
    
     * corr file 305.4
        UFITMS : Tighten numerical checks                              (D.Casper)
                 Bring phi back into 0-2*pi range after Newtonian step (M.Cattaneo)
    
     * corr file 305.3
        UCTGFT : Test error return of UFITMS                          (D.Casper)
        UFITMS : Make sure all tracks have sensible covariance matrix (D.Casper)
                 Fix precision problem for GG0P variable            (M.Cattaneo)
    
     ! JULIA 305
        UFITMS : fix variable type inconsistencies in function calls, 
                 for Linux                                            (A.Waananen)
    
     * corr file 304.2
        UFITMS : Protect against divide by zero (M.Cattaneo)
    
     * corr file 303.5
        UCTGFT : Protect against crazy fits by calling sanity check (D.Casper)
    
     ! JULIA 303
        UFITMS : Disable Newtonian for 3-hit tracks (D.Casper)
    
     ! JULIA 280
        UFITMS : replace WRITE(6, by WRITE(IW(6), (H.Drevermann, Feb 96)
    
     ! JULIA 278
        UFITMS : rearrange DASIN argument to avoid crash (P.Comas, Sep 95)
    
  <<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<
     UCTGFT     Change to new helix convention in bank t1ft
     UFITMS     Fitting routine for scattered helices in aleph
     UMXINV     Modified by joe from cernlib routine syminv to be double precision
     UNPACK     Unpack 16 bit words and fill them into arrays
     USBOOK     The user books his/her histograms here.
     USCJOB     The user closes his/her job here.
     USCRUN     The user closes his/her run here.
     USHIST     The user fills his/her event histograms here.
     USIEVT     User initialises his/her event variables here.
     USIJOB     The user does his/her job initialisation here.
     USIRUN     User initialises his/her run variables here.
     USLOWC     User routine for slow control
     USPRDA     User routine called after data preparation
     UTDCBP     Unpack bitstrings and fills the bits into arrays
     UTLSLF     Do weighted least squares fit
     UVPFIT     3-d vertex fitter
     UVPMAT     Auxiliary routine to uvpfit to compute chisq and derivative
     UXSFIT     Track helix fitter with multiple scattering
     UXSMAT     Auxiliary routine to uxsfit.

3 UCTGFT
           SUBROUTINE UCTGFT
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Change to new helix convention in bank t1ft
     Subroutine that changes the T1FT bank from the TASSO
     convention of parameters to the mathematical convention,
     and puts in the covariance matrix instead of the inverse of it.
     This is done by refitting the track with UFITMS, which gives
     its output in the desired convention.
     AUTHOR:  LLUIS GARRIDO   14/6/1988
     Modified: R. Johnson     19/5/1991   (use T1FT instead of TGFT)
               D. Casper      09/7/1997   Check for garbage fits
               D. Casper      28/1/1998   Test error return of UFITMS
     Called by TFITTK
     CONVERSION:
            R_TASSO=-R_MAT
           D0_TASSO= SIGN(R_MAT)*D0_MAT
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   TFITTK                                                                          
        |---- UCTGFT                                                               
                   |----  NAMIND                              External             
                   |----  RERROR                                                   
                   |----  BDROP                               External             
                   |----  UFITMS                                                   
                   |----  TFCHEK                                                   
                   |----  SIGN                                External             
   
 
3 UFITMS
         SUBROUTINE UFITMS(N1,N2,N3,LIST1,LIST2,LIST3,IOPT,NMULT,RMS,XLEN,
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
        -VV0,EE0,COV,CHI2,IERR)
   -----**************************************************---------C
   Fitting routine for scattered helices in aleph
       AUTHOR: LL. GARRIDO       JUNE 1988
               N1   = NUMBER OF POINTS IN TPC TO BE FITTED
               N2   = NUMBER OF POINTS IN IPC TO BE FITTED
               N3   = NUMBER OF POINTS IN VDET TO BE FITTED
               LISTI= LIST OF POINTS TO BE FITTED
               IOPT =
                      1 -> CIRCLE+LINE
                      2 -> 3-DIMENSIONAL ITERATION
                      3 -> M.S. A*(R-R0)/R
                      4 -> M.S. I-DD0(A) I-PH0(A)
                NMULT= FLAG TO INCREASE THE ERROS INSIDE TO TPC
                       DO TO MULTIPLE SATTERING (NMULT=1 YES)
                       (THIS FLAG IS NOT USED FOR IOPT=1)
                RMS=RADIUS OF SCATERING ANGLE
                XLEN=LENGH OF MATERIAL IN RADIATION LENGH UNITS
     OUTPUT:   VV0 = 1/R*CHARGE   [1/CM]  NEG. IF CLOCKWISE
                     TAN(LAMBDA)  {=DZ/DS}TAN(ANGLE TO X,Y PLANE)
                     PHI0         {0,2PI} ANGLE TO X-AXIS
                     D0*SIGN      [CM] POS. IF AT THIS PONIT THE
                        ANGULAR MOMENTUM AROUND THE ORIGIN IS POS.C
                     Z0           [CM]    Z POS AT R=D0
                     ALFA         [RAD]   SCATTERING ANGLE
               EE0 = INVERSE COVAR MATRIX IN TRIANG. FORM
               COV = COVAR MATRIX IN TRIANG. FORM
               CHI2= CHI SQUARED = SUM (DEVIATIONS/ERRORS)**2
               IERR= :
                     =1 IF CIRCLE+LINE FIT FAILS
                     =2 IF COVARIANCE MATRIX CAN NOT BE INVERTED
                     =3 IF COVAR. MAT. NOT POSITIVE
       BASED ON   1) SUBROUTINE CIRCLE  (N.CHERNOV, G. OSOSKOV )
       REFERENCE:  COMPUTER PHYSICS COMMUNICATIONS VOL 33,P329
                  2) 3-DIMENSIONAL ITERACTION  (MARTIN POPPE)
       REFERENCE:  ALEPH NOTE 87-102
       Modified:  D. Casper  970520  Disable Newtonian for 3-hit tracks
                  M.Cattaneo 971017  Protect against divide by zero
                  D. Casper  980128  Make sure all tracks have sensible
                                     covariance matrix
                  M.Cattaneo 980204  Fix precision problem for GG0P variable
                  D. Casper  980225  Tighten numerical checks
                  M.Cattaneo 980226  Bring phi back into 0-2*pi range after
                                     Newtonian step
                  D.Smith    991027  Double precision fixes for Linux
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   FITALL                                                                          
   FKKPAR                                                                          
   FREFIT                                                                          
   IFITP                                                                           
   IMATCH                                                                          
   ITEXTN                                                                          
   ITRECF                                                                          
   TFLNK2                                                                          
   UCTGFT                                                                          
        |---- UFITMS                                                               
                   |----  ASIN                                External             
                   |----  NAMIND                              External             
                   |----  COS                                 External             
                   |----  SIN                                 External             
                   |----  ABS                                 External             
                   |----  DBLE                                External             
                   |----  DSQRT                               External             
                   |----  DASIN                               External             
                   |----  ATAN                                External             
                   |----  SQRT                                External             
                   |----  SIGN                                External             
                   |----  OV                                  External             
                   |----  SMINV                               External             
                   |----  COV                                 External             
                   |----  SMAV                                External             
                   |----  NDIMVV0                             External             
                   |----  DV                                  External             
                   |----  AMOD                                External             
                   |----  VZERO                               External             
   
 
3 UMXINV
         SUBROUTINE UMXINV(A,L,M,N,IFAIL)
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Modified by joe from cernlib routine syminv to be double precision
       Modified: D.Smith    991027  Double precision fixes for Linux
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   UVPFIT                                                                          
   UXSFIT                                                                          
        |---- UMXINV                                                               
                   |----  ABS                                 External             
                   |----  F                                   External             
                   |----  NA                                  External             
   
 
3 UNPACK
         SUBROUTINE UNPACK(IWORD,NVAL,IUNP)
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Unpack 16 bit words and fill them into arrays
   
      Author   :- Alois Putzer           4-AUG-1989
                  Martin Wunsch          4-AUG-1989
                  Yves A. Maumary       20-DEC-1989 Adapted for JULIA
   
      Inputs:
           - IWORD : INTEGER : array of values packed in 16 bit words
           - NVAL  : INTEGER : number of values (MUST BE EVEN)
   
      Outputs:
           - IUNP  : INTEGER : array of dimension NVAL with the unpacked
                               values
   
      Libraries required: CERNLIB
   
      Calls: IAND, ISHFT, VZERO
   
      Description
      ===========
      NVAL values packed in 16 bit words into NVAL/2 INTEGERs are
      unpacked into NVAL INTEGERs
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
              UNPACK                                                               
                   |----  VZERO                               External             
                   |----  ISHFT                               External             
                   |----  IAND                                External             
   
 
3 USBOOK
         SUBROUTINE USBOOK
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   The user books his/her histograms here.
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   RBKHIS                                                                          
        |---- USBOOK.                                                              
   
 
3 USCJOB
         SUBROUTINE USCJOB
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   The user closes his/her job here.
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   RCLJOB                                                                          
        |---- USCJOB                                                               
                   |----  CRCJOB                                                   
   
 
3 USCRUN
         SUBROUTINE USCRUN
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   The user closes his/her run here.
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   RCLRUN                                                                          
        |---- USCRUN.                                                              
   
 
3 USHIST
         SUBROUTINE USHIST(IREJ)
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   The user fills his/her event histograms here.
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   RHSEVT                                                                          
        |---- USHIST.                                                              
   
 
3 USIEVT
         SUBROUTINE USIEVT(IREJ)
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   User initialises his/her event variables here.
    Set IREJ<>0 if you want to reject the event
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   RECONS                                                                          
        |---- USIEVT.                                                              
   
 
3 USIJOB
         SUBROUTINE USIJOB
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   The user does his/her job initialisation here.
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   RINJOB                                                                          
        |---- USIJOB.                                                              
   
 
3 USIRUN
         SUBROUTINE USIRUN
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   User initialises his/her run variables here.
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   RINRUN                                                                          
        |---- USIRUN.                                                              
   
 
3 USLOWC
         SUBROUTINE USLOWC
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   User routine for slow control
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   RUNKNO                                                                          
        |---- USLOWC.                                                              
   
 
3 USPRDA
         SUBROUTINE USPRDA(IREJ)
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   User routine called after data preparation
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   RPREDA                                                                          
        |---- USPRDA.                                                              
   
 
3 UTDCBP
         SUBROUTINE UTDCBP(IWORD,NBITS,IBITP)
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Unpack bitstrings and fills the bits into arrays
   
      Author   :- Alois Putzer           4-AUG-1989
                  Martin Wunsch          4-AUG-1989
                  Yves A. Maumary       20-DEC-1989 Adapted for JULIA
   
      Inputs:
           - IWORD : INTEGER : bitstring to be unpacked
           - NBITS : INTEGER : length of the bitstring
   
      Outputs:
           - IBITP : INTEGER : array of dimension NBITS containing the
                               unpacked bitstring
   
      Libraries required: CERNLIB
   
      Calls: BTEST, VZERO
   
      Description
      ===========
      Unpacks a bitstring of length NBITS into an INTEGER array of
      dimension NBITS
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
              UTDCBP                                                               
                   |----  VZERO                               External             
                   |----  INT                                 External             
                   |----  MOD                                 External             
                   |----  BTEST                               External             
   
 
3 UTLSLF
         SUBROUTINE UTLSLF(X,Y,W,N,A,B,CHISQ,VAR)
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Do weighted least squares fit
    to line  Y = A*X + B
   
      Author:     M.Mermikides
      Modified:   M.Mermikides    08-04-87
   
     INPUT:
   
           N  = Number of data points
         X(N) = x-values
         Y(N) = y-values
         W(N) = weights (1./sigma(y)**2)
   
     OUTPUT:
   
            A  = Slope
            B  = Intercept
         CHISQ = Chisquared of fit
         VAR(3)= Covariance matrix {1=V(AA), 2=V(AB), 3=V(BB)}
   
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   TSAWIR                                                                          
   TWIREZ                                                                          
        |---- UTLSLF                                                               
                   |----  ABS                                 External             
   
 
3 UVPFIT
         SUBROUTINE UVPFIT(NTRA,TRPAR,ERRX,ERRZ,NPAR,
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
        &                         NIT,NDF,CHISQ,VXP,ERRVX)
   3-d vertex fitter
    Author:   M.E.Mermikides  27 May 1987
    Modified: D.Smith         991027  Double precision fixes for Linux
     INPUT:
             NTRA = Number of tracks to be fitted
             TRPAR(6*NTRA) = Array of parameters of each track
                              (rho,d0,phi0,zo,tanl,Theta)
             ERRX(NTRA) = Errors on track deviation from vertex in
                          (x,y) plane. (For tracks coming from near
                          the origin this corresponds closely to the
                          error on d0)
             ERRZ(NTRA) = Errors on track deviation from vertex in
                          z plane. (For tracks coming from near
                          the origin this corresponds closely to the
                          error on z0)
             NPAR = No of parameters to be fitted (2 -> xy, 3 -> xyz)
     OUTPUT:
            NIT  = Number of iterations (<0 if fit failed)
            CHISQ  = chisquared of fit
            NDF = number of degrees of freedom
            VXP(NPAR) = fitted vertex coordinates {x,y(,z)}
            ERRVX(NDIM) = Error matrix (=Inverse covariance matrix)
                   of fitted vertex position in triangular form:
                  {xx,xy,yy(,xz,yz.zz)};    (NDIM = NPAR*(NPAR+1)/2)
        CHISQ IS CALCULATED, 1ST DERIVATIVES IN G(3), 2ND IN GG(3,3)
     Description:
     ===========
         The method is based on the formalism by D.H. Saxon
     (NIM A234 (1985) 258-266), generalised to 3-dimensions for
     use with the ALEPH tracking detectors.   The procedure is to
     minimise the deviations of the tracks from the common vertex
     at the coordinates (A,B,C).
         In the x-y plane and in z, the deviations of a track
     from the vertex point (A,B,C) are given by:
         d(xy) = s - rho
         d(z) = z - C - rho*tdip*delta
         where
            s =sqrt[(A-xc)**2 - (B-yc)**2]
            rho = radius of curvature of track circle
            tdip = tangent of track helix dip angle
            delta = 2*arcsin{sqrt[(xt-x0)**2 + (yt-y0)**2]/(2*rho)}
            xt = xc +/- rho*(A-xc)/s
            yt = yc +/- rho*(B-xc)/s
            x0,y0 = coordinates at point of closest approach of track
                    to origin (d0)
      Fitting is done using a matrix inversion method on the vector
      (A,B,C)
     Chisq = d(xy)**2/SIGX**2 + d(z)**2/SIGZ**2
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   YFVERT                                                                          
        |---- UVPFIT                                                               
                   |----  MIN                                 External             
                   |----  SIGN                                External             
                   |----  ABS                                 External             
                   |----  DBLE                                External             
                   |----  DCOS                                External             
                   |----  DSIN                                External             
                   |----  UVPMAT                                                   
                   |----  GG                                  External             
                   |----  UMXINV                                                   
                   |----  G                                   External             
   
 
3 UVPMAT
         SUBROUTINE UVPMAT(NTK,NPAR)
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Auxiliary routine to uvpfit to compute chisq and derivative
    matrices
    Author:   M.E.Mermikides  27 May 1987
    Modified: D.Smith         991027  Double precision fixes for Linux
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   UVPFIT                                                                          
        |---- UVPMAT                                                               
                   |----  XV                                  External             
                   |----  DSQRT                               External             
                   |----  RADI                                External             
                   |----  ABS                                 External             
                   |----  CPHC                                External             
                   |----  SPHC                                External             
                   |----  DSIGN                               External             
                   |----  Q                                   External             
                   |----  DASIN                               External             
                   |----  DMIN1                               External             
                   |----  TDIP                                External             
                   |----  SIGX                                External             
                   |----  SIGZ                                External             
   
 
3 UXSFIT
         SUBROUTINE UXSFIT(PARI,NHITS,XYZ,SIGXY,SIGZ,RSCAT,XCON,BFIEL,
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
        &                  NIT,CHISQ,NPAR,PARF,ERM2)
   Track helix fitter with multiple scattering
    Author:   M.E.Mermikides  2 April 1987
    Modified: D.Smith         991027  Double precision fixes for Linux
     INPUT:
            PARI   = 1st estimate of track parameters
               (1) = Signed track radius in x-y plane
               (2) = Point of closest approach (d0)
               (3) = Azimuth at d0
               (4) = Z coordinate at d0  (z0)
               (5) = Tan. of helix dip angle
               (6) = Scatt. angle
             RSCAT = Radius of scattering layer
             NHITS = No of measured coordinates
             XYZ(NHITS) = (x,y,z) coordinates of measurements
             SIGXY(NHITS) = (x,y) error of each hit
             SIGZ(NHITS) = z error of each hit
             RSCAT = Radius of equivalent m/s layer
             XCON = m/s constant = 0.015*sqrt(l), where l is
                    the thickness of the scattering layer in
                    radiation lengths
             BFIEL = value of magnetic field in kG
     OUTPUT:
            NIT  = Number of iterations (<0 if fit failed)
            CHISQ  = chisquared of fit
            NPAR = No. of parameters fitted
            PARF(NPAR) = fitted track parameters
                         (N.B. The number of degrees of freedom is
                           given by 2*NHITS - NPAR)
            ERM2(NDIM) = error matrix in triangular form.
                           Dimensionality NDIM = NPAR*(NPAR+1)/2
                      k   do  phi0  z0  tdip theta
                     -----------------------------
                  k | 1   2    4    7   11    16  |
                 d0 |     3    5    8   12    17  |
               phi0 |          6    9   13    18  |
                 z0 |              10   14    19  |
               tdip |                   15    20  |
              theta |                         21  |
                     -----------------------------
     Description:
     ===========
         The method is based on the formalism by D.H. Saxon
     (NIM A234 (1985) 258-266), generalised to 3-dimensions for
     use with the ALEPH TPC.   The procedure is to minimise the
     deviations of points from the track helix. In the x-y plane
     and in z, the distances are given by:
         d(xy) = 0.5*K*(r**2 - d0**2)
                 + x*sin(phi0) - y*cos(phi0) + Q*d0**2
                 - theta*(r - rs)   (for r > rs)
         d(z) = z - z0 - Q*tdip*delta*(1 - KQd0)/K
         delta = arcos{1-K**2*(r**2 - d0**2)/2(1- KQd0)}
             r = sqrt(x**2 + y**2)
     We form  chi**2 = Sum(d(xy)**2/err**2) + Sum(d(z)**2/erz**2)
                              + (theta/theta0)**2
       (last term is operative only if there are at least 3 hits
        before scattering radius, rs)
     and derivatives with respect to the helix parameters v(i)
         G(a) = d(chi**2)/dv(a)  = 2*SUM{d(i)*d'(a)/err(i)**2}
                                 + 2*theta/theta0**2 * d'(theta)
         GG(a,b) = d2(chi**2)/dv(a)dv(b)
                 =2*SUM{d(i)*d''(a,b) +d'(a)*d'(b)}
                    + 2*theta/theta0**2 * d''(theta)
        (d'(a) = d(d)/dv(a), d''(a,b) = d2(d)/dv(a)dv(b)
        (d'(theta) = d(theta)/dv(a), d''(theta) = d(theta)/dv(a)dv(b)
     The iterative fit proceeds according to
            v(N+1) = v(N) - GG(-1)*G
     and the error matrix at convergence is 2*GG(-1)
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   YFVERT                                                                          
        |---- UXSFIT                                                               
                   |----  SIGN                                External             
                   |----  ABS                                 External             
                   |----  SQRT                                External             
                   |----  UXSMAT                                                   
                   |----  GG                                  External             
                   |----  UMXINV                                                   
                   |----  G                                   External             
   
 
3 UXSMAT
         SUBROUTINE UXSMAT(NHITS,NPAR,RSCAT,ACON,BFIEL)
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Auxiliary routine to uxsfit.
    Computes chisq. and derivatives
    Author:   M.E.Mermikides  2 April 1987
    Modified: D.Smith         991027  Double precision fixes for Linux
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   UXSFIT                                                                          
        |---- UXSMAT                                                               
                   |----  SIN                                 External             
                   |----  TRACK                               External             
                   |----  COS                                 External             
                   |----  SQRT                                External             
                   |----  ABS                                 External             
                   |----  DSHIT                               External             
                   |----  DZHIT                               External             
                   |----  ACOS                                External             
   

2 V_

  >>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>
    CKEY 
     1st entry in V_set
    
     ! JULIA 310
        VDKLCP : Bug fix - Modification of the logic of the VKIL bank to 
                           delete the correct hits.
                 Add protections for garbage collection. (P.Coyle, T.Kachelhoffer)
        VDKMCE : Add protections for garbage collection. (T.Kachelhoffer)
        VSPXYZ : Bug fix - Apply VRECOR correction only to real data
                                                         (P.Coyle, T.Kachelhoffer)
    
     ! JULIA 308
        Following 4 routines implement chip specific efficiencies in MonteCarlo
        for VDET95. Needs ADBS 240, Alephlib 308.3 or greater   (M.Thulasidas)
        VDKLCP : Introduced the new bank VDCE instead of the VDEM bank.
                 (VDet Chip Efficiency map)
        VDMCEF : Move the VDKLCP section before the test on NOTDO
        VDMKCE : NEW - Makes the Chip efficiency map file VDCE from VDPR and VDCM
        VINIRU : Add VDPR, VDCM to list of banks to be loaded with the setup code
    
        VSPXYZ : Correct coordinate for additional bonding problems (VRECOR)
                                                                      (J.Rothberg)
    
     * corr file 307.3
        VPRSUM : Improve test on VGLOB execution                   (M.Cattaneo)
    
     ! JULIA 307
        VPREDA : Skip VDET reconstruction if VDOK (HV) not on         (A.Bonissent)
    
     * corr file 306.3
        VDECOD : Protect against corrupted raw data (A.Bonissent)
    
     * corr file 305.1
        VBSPOT : Call xvdeok (from Alephlib > 306) instead of VDETOK (M.Cattaneo)
        VDETOK : Obsolete. Use XVDEOK instead (Alephlib version>306) (M.Cattaneo)
    
     ! JULIA 305
        VDECOD,VPREDA : fix variable type inconsistencies in 
                        function calls, for Linux                  (A.Waananen)
    
     * corr file 304.1
        VDECOD,VDFSUP,VDRTAN,VHINIT,VSPXYZ :
                      Remove CALL from function references, for Linux. (A.Waananen)
    
     ! JULIA 304
        VDECOD : Protect against corrupted raw data (A.Bonissent, M.Cattaneo)
    
     * corr file 303.7
        VDJACB : Fix the missing JACOB(3) bug (in IV=2) (M.Thulasidas)
    
     * corr file 303.1
        VDOSMR : Remove call to NORRIN, replace RANNOR by VDGAUS      (M.Cattaneo)
        VDISMR,VDOSMR,VDWSMR : replace WRITE(6,*) by WRITE(IW(6),*)   (M.Cattaneo)
        VDXYZT : Replace call exit() by RERROR,
                 Move 999 label to include BDROP of work banks        (M.Cattaneo)
    
     ! JULIA 303
        VDRCUN, VINIRU : Mods to PASS0 to allow drift velocity to be taken for
                 all data taken with new VDET (and not just LEP2 runs) (I.Tomalin)
        VPRSUM : Print end of job statistics for VGLOB code (P.Rensing)
    
     * corr file 302.5
        VDMSUP2: New. Update face extrapolation bank VDMS for true VDET 
                 hit position. Based on VDMSUP from ALEPHLIB. Used by
                 kinks package (and VGLOB)                            (P.Rensing)
    
     * corr file 302.4
        VRECLT : Bug fix. Do not reduce clusters of < 2 strips (A.Bonissent 020497)
    
     ! JULIA 302
        VTRUTH : Removed from library (replaced by VTRURL in JUL285) (M.Cattaneo)
        
     ! JULIA 285
       VDXYZT :     keep track of strips which belong to two clusters
                    (after splitting) (A.Bonissent, Dec96)
       VUMCTR, VDMCTR, VDGTHT : handle properly strips which
                    belong to two clusters (A.Bonissent, Dec96)
       VTRURL : New routine, gives truth MC relation between hits and tracks
                (A.Bonissent, Dec96). 
                IMPORTANT NOTE: VTRURL supersedes VTRUTH (changed calling sequence)
                VTRUTH is obsolete and will be removed in a future JULIA version.
    
     * corr file 284.1
        VDECOD.F : Do not check for cable swap in MonteCarlo (PBT, Nov96) 
    
     ! JULIA 284
        VINIRU.F : Request creation of VDZT banks during PASS0 if PVGG
                   option being used. (I.Tomalin 09/10/96)
        VDRCUN.F : Ditto.             (I.Tomalin 09/10/96)
    
     ! JULIA 283
       Replace expicit BOS macro declaration by #include bmacrod.h (O.Schneider)
       Affects: vbmfit, vbsclr, vbsinr, vbspot, vcbfit, vdosmr
    
     * corr file 281.2
         - VDMCEF : move the treatment of the new VDET to VDKLCP. It can not be 
                    done in VDMCEF because of multiplexing. (M.Thulasidas)
         - VDKLCP : New routine to take care of the efficiency map for the new
                    VDET, making sure that the multiplexed hits get killed
                    together. (M.Thulasidas)
    
     ! JULIA 281
       Changes to VDET alignment smearing routines to work with new VDET geometry
       (M.Thulasidas)
       Affects:
         - VDALSG, VDGTXL, VDSIGM, VDWSDX, VDWSMR
       New Routines:
         - VDINCP, VDJACB, VDRTAN
    
       Changes to MonteCarlo stream, to take care of efficiencies properly
       (M.Thulasidas)
       Affects:
         - VPREDA, VDMCEF
       New routine:
         - VDFSUP (replaces VDMCEF95)
    
       Rewrite fix for cabling errors using new bank VCAB (P.Bright-Thomas)
       Affects:
         - VDECOD, VINIRU
    
     ! JULIA 280
       New clustering algorithm for low theta tracks : wafers 2 and 3 of
                  1st layer; wafer 3 of 2nd layer (A. Bonissent, Jan 96)
       We exploit the fact that we know approximately the cluster size
          (nstrips) and pulse height.
       Affected : cluster finding and cluster splitting, subroutines :
    
        - RFORMA : define format for new bank VPHN
        - VDECOD : creat bank VPHN; declare variables types for implicit
                  none
        - VDXYZT : declare variables types for implicit none; switch to
                  low theta cluster separation when necessary
        - VRECLU : declare variables types for implicit none; switch to
                  low theta cluster separation when necessary
        - VSEPAR : declare variables types for implicit none
    
          New subroutines :
    
        - VRECLT : find clusters in the low theta region (Z view)
        - VCLBNK : Put clusters in banks
        - VSEPLT : Split clusters in the low theta region (Z view)
    
        VBSPOT,VDSTCH : cosmetic changes to move to cvs: integer declara-
               tion no longer needed for HAC parameters (F.Ranjard, Feb 96)
    
     ! JULIA 279
       VDRCUN : never produce hot channels for new Vdet (A. Bonissent,
               Nov 95)
    
     * corr file 278.3
       VRECON : change number of channels (A. Bonissent, Nov 95)
       VDECOD : make max. number of channels in z view, useful
               for wraparound cluster (A. Bonissent, Nov 95)
       VINIRU : offset of online channels is diffent for old and
               new VDET (A. Bonissent, Nov 95)
       VMKR95 : initialize package which handles bonding maps
               (A. Bonissent, Nov 95)
       VDSM95 : handling of the nominal bonding scheme (A. Bonissent,
               Nov 95)
       VMGCRL : decode wafer number, apply channel to strip mapping and
               fill relation from data channel to readout strip
               (A. Bonissent, Nov 95)
       VTRSUP : transform electronic channel number from Galeph
               into data channel (A. Bonissent, Nov 95)
     * corr file 278.2
       VDMCEF95 : suppress hits in dummy faces in Oct 95 installation of
                 new VDET. Supersedes routine of last correction file (A.
                 Bonissent, Oct 95)
       VHOTIN   : control usage of VHOT bank with a data card VNHT and
                 protection against VHOT inconsistency (A. Bonissent, Oct95)
       VDSM95   : protect for nonsense in VHOT (A. Bonissent, Oct 95)
       VINIRU   : initialization of beam position finding moved to RINIRUN
                 (S.Wasserbaech, Nov 95)
     * corr file 278.1
       VDMCEF95 : new routine for MC efficiency of new  Vdet (A. Bonissent
                 Oct 95)
       VRECLU   : fix a bug in clustering (only for new Vdet) (A. Bonissent
                 Oct 95)
       ALCBJJ, ALLRJJ : comdecks dropped (S. Wasserbaech, Oct 95)
       ALPBJJ, VBSCOM : comdecks modified (S. Wasserbaech, Oct 95)
       ALRPJJ, VBPCJJ : comdecks added (S. Wasserbaech, Oct 95)
       VBSPOT   : huge bug fixed : number of VDET z hits was not correctly
                 calculated (S. Wasserbaech, Oct 95)
       VBMFIT, VBSCLR, VBSINR, VCBFIT : change from to ALLR and ALCB to ALRP
                 and VBPC; allow tau-tau rejection and VDET hit definition to
                 be switchable for LEP1 and LEP2, little protection for LEP2
                 against cosmics, better handling of failures in VCBFIT, add
                 features to allow JULIA routines to be used in ALPHA without
                 modification (S. Wasserbaech, Oct 95)
       VDNOIS : move DATA statement just before BMACRO to allow compilation in
               Linox (P. Comas, Oct 95)
    
     ! JULIA 278
       VUMCTR, VDMCTR : change the corrections given by A.B in 277.1 by
                       those from G.Taylor (Aug 1995)
       VHOTIN : Put VHOT on the C list, so it isn't dropped
               (A. Bonissent, Aug 95)
       VDPINH : new routine to simulate peculiar readout channels in MC
               (G. Taylor, Aug 95)
       VDCHST : new function to map electronic readout channel to physi-
               cal readout strip (G. Taylor, Aug 95)
       VDSTCH : new function inverse to the previous (G. Taylor, Aug 95)
       VDMPIN,VINIRU,VDGTHT,VTRUTH: modified for the new MC treatment
               of delta rays (G. Taylor, Aug 95)
       VDGCJJ,VDMRJJ,VWRLJJ : new common decks (A. Bonissent, Sep 95)
       VCSGJJ,VREGJJ : common decks modified (A. Bonissent, Sep 95)
       VDMJLN : SAVE statement added (P. Rensing, Sep 95)
       VDSM95,VTRSUP,VMKR90,VMKR95,VMGCRL : new routines to handle new
               VDET and allow a different treatment of old Vdet (A. Boni-
               ssent, Sep 95)
       VDECOD,VDMPIN,VRECLU,VDXYZT,VSPXYZ,VCRHOT,VHOTIN,
       VDNOIS,VTRUTH,VCALCM,VCMEAN,VDBGCL,VDSMAP,VINIRU
       All routines modified to addapt to the different treatment for old
       and new Vdet (A. Bonissent, Sep 95)
    
     * corr file 277.2
       VCBFIT : protect RSINV against an error return (P.Comas)
       VMGNJJ : hac parameters modified (A.Bonissent)
       VDMPIN : use changed VMGN modified to contain also first and last
               channel in a region (A.Bonissent)
     * corr file 277.1
       VUMCTR, VDMCTR : correction to process GALEPH events made with old
                        vdet geometry package (A.Bonissent)
    
     ! JULIA 277
       VHOTOF, VCALCM, VCMEAN, VCRHOT, VDBOOK, VDCRUN, VDECOD, VDHIST, VDLINK,
       VDMPIN, VDNOIS, VDRCUN, VDXYZT, VDSMAP, VHINIT, VHOTIN, VINIJO, VINIRU,
       VLCPOS, VPREDA, VPRPOT, VPRSUM, VRECLU, VRECON, VREPOS, VSEPAR, VSLOWC,
       VPRTNC, VDFLGS,
       All decks purged and rewritten (Vdet prepare data).
       - Forget about peculiarities for 1990 Vdet data
       - Use geometry package to obtain information about Vdet topology
       - Redesign and clarify the code
               (D. Brown, A. Bonissent, M. Thulasidas, April 1995)
       VDISMR : Check VDHT bank is there (M. Thulasidas, May 95)
    
     * corr file 276.1
       VBSPOT : Use ABS on d0 and z0 cuts; remove call to VDAMB
               (S.Wasserbaech, Apr 95)
       VBMFIT : Use existing first-event-in-chunk number when
               NEWROW = .FALSE. (S.Wasserbaech, Apr 95)
       VBSCLR : Do not create a new row if the first row is not
               yet filled (S.Wasserbaech, Apr 95)
       VCBFIT : Take beam size from ALLR instead of data statement
               (S.Wasserbaech, Apr 95)
       VBSINR : Always clear the work banks (number of rows = 0)
               Get ALLR from daf (S.Wasserbaech, Apr 95)
       ALLRJJ : Comdeck added to be used in VCBFIT
               (S.Wasserbaech, Apr 95)
    
       VDLINK : Call VDMCTR to compress Monte Carlo truth info
               (A.Bonissent, Mar 95)
       VDMCTR,VTRUTH,VUMCTR : Compress Monte Carlo truth info
               (A.Bonissent, Mar 95)
       VDALIN,VDALXY,VDALZT,VDALSG,VDGTHT,VDGTMV,VDGTXL,VDOSMR,VDRNDM,
       VDSIGM,VDTAN,VDWSDX,VDWSMR,VDGAUS : New treatment of alignment
       errors for 1994 Monte Carlo production (M.Thulasiadas, Mar 95).
       VDMCEF : Take out position smearing (M.Thulasiadas, Mar 95).
       VPREDA : Call VDISMR for smearing (M.Thulasiadas, Mar 95).
       VDISMR : Set up appropriate smearing scheme (M.Thulasiadas, Mar 95).
    
     * corr file 275.3
       VBSPOT : avoid taus to measure the beam spot (S.Wasserbaech).
     ! JULIA 275
     * corr file 274.3
       VBSINR : create working bank only once (E.Lancon).
     ! JULIA 274
     ! JULIA 273
     * corr file 272.4
       VDMCEF : remove double correction which created wrong ALEPH
                Z-coordinate pertubating DALI, the local Z-coordinate
                was correct (M.Thulasidas).
     ! JULIA 272
     * corr file 271.6
       VBSINR : do not create a new working bank for each run.
     * corr file 271.1
       VDMCDEF : call rannor instead of norran
    
    
  <<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<
     VBMFIT     Beamspot position fit
     VBSCLR     End of run beam spot position computation, close bank
     VBSINR     Initialise beam spot position computation for the run
     VBSPOT     Measure the beamspot using the aleph vdet
     VCALCM     Removes coherent noise from hits
     VCBFIT     Close form beamspot fit
     VCKTRK     Returns number of expected vdet hits for a track itrk
     VCLBNK     Put vdet cluster into banks
     VCMEAN     Calculates quanitites used in removing coherent noise
     VCRHOT     Create and fill vhot the list of noisy strips accumulated by vdnois
     VDALIN     Smears the vdxy and vdzt coordinates in accordance with
     VDALSG     Vdalsg calculates the sigmas to smear the vdzt (iv=1) or vdxy (iv=2)
     VDALXY     Smears the vdxy in accordance with
     VDALZT     Vdalzt smears the vdzt in accordance with
     VDBGCL     Find where clustering should start
     VDBOOK     Book vdet histograms
     VDCHST     Mapping from electronic readout channel to physical readout strip
     VDCRUN     Vdet end of run
     VDECOD     Main vdet hit reconstruction routine
     VDETOK     Determine hv state of vdet
     VDFNAM     Defines namindex common vdnamc
     VDFSUP     Suppress the hits in dummy faces
     VDGAUS     Returns the quantity mean smeared by sigma
     VDGEPH     Physics parameter from helix parameters
     VDGTHT     Given the vdzt (iv=1) or vdxy (iv=2) bank number (nrbk)
     VDGTMV     Vdgtmv unpacks the alignment error matrix and calculates
     VDGTXL     Given the vdzt (iv=1) or vdxy (iv=2) bank number (nr)
     VDHIST     Vdet histograming routine (steering)
     VDINCP     Find the difference vector xdiff of the points of intersection
     VDISMR     Sets up the appropriate smearing scheme
     VDJACB     Vdjacb calculates the jacobian of local coordinate (w or u)
     VDKLCP     Sets quality flag for hits in vdxy,vdzt banks according to dead chip
     VDLINK     Steering routine for mvd hit association and track refit
     VDMCEF     Sets quality flag for hits in vdxy,vdzt banks according to dead line
     VDMCTR     Compress monte carlo truth information
     VDMJLN     Function to define a vdet line number index
     VDMKCE     Makes the chip efficiency map file vdce (similar to the old vdem)
     VDMONI     Monitoring of mvd reconstruction quality
     VDMPIN     Unpack vdet mapping and module banks used in hit reconstruction
     VDMSUP2    Update face extrapolation bank vdms for true vdet hit position
     VDNOIS     Detects noisy strips to be switched off during subsequent
     VDOSMR     Vdosmr smears the vdxy and vdzt coordinates with averages
     VDPINH     This takes the list of peculiar readout channels for a given module
     VDRCUN     This subroutine unpacks the vrcn bank into the vrecon common
     VDRNDM     Vdrndm calculates a random vector rvec of mxaln dimensions
     VDRTAN     Given the hit position, this routine returns the cotangents necessary
     VDSIGM     Vdsigm calculates the sigmas to smear the vdzt (iv=1) or vdxy (iv=2)
     VDSM95     Performs the map from electronics channels to strip numbers
     VDSMAP     Performs the map from electronics channels to strip numbers
     VDSTCH     Mapping from physical readout strip to electronic readout channel
     VDTAN      For a given vdht track entry (xin) and exit (xout) and
     VDWSDX     Vdwsdx calculates the displacement in a hit (at vuw) in a
     VDWSMR     Vdwsmr smears the vdxy and vdzt coordinates in accordance with
     VDXYZT     Creates the banks vdxy,vdzt from the banks vfph,vfhl,vflg
     VHINIT     Initialization for runs creating new vhot lists
     VHOTIN     Initialize the hot channels list (vhot bank) for current run.
     VINIJO     Initialise the vdet job
     VINIRU     Initialize the vdet run
     VLCPOS     Compute the local position of a final cluster
     VMGCRL     Author   :- a. bonissent june 1995
     VMKR90     Prepare vmre banks used in hit reconstruction
     VMKR95     Initialise the package which handles bonding maps
     VPREDA     Prepare data step before reconstruction
     VPRPOT     Converts vdco bank in pot output bank pvco
     VPRSUM     Print end of job statistics for vglob code
     VRECLT     Find vdet clusters at low theta
     VRECLU     Select final clusters
     VSEPAR     Separate merged vdet hits
     VSEPLT     Separate merged vdet hits at low theta
     VSLOWC     Handle slow control for vdet
     VSPXYZ     Transform strip position into xyz glob. coordinates
     VSTRIM     Cleanup a raw hit for the hardware vagaries of the tpd
     VTRSUP     Update the vtrs bank
     VTRURL     Supplies truth information for reconstructed hits from vfph
     VUMCTR     Unpack vdet history bank

3 VBMFIT
         SUBROUTINE VBMFIT (NEWROW)
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Beamspot position fit
   
      Author   :- D. Brwon                   8-APR-1993
     First written by G. Redlinger
   
      Bug fix: Steve Wasserbaech, April 1995
      Use existing first-event-in-chunk number when NEWROW = .FALSE.
      Modified: SW, 18 October 1995
      Switch to VBPC; introduce track deweighting in first iteration;
      protect against failure in VCBFIT.
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   VBSCLR                                                                          
   VBSPOT                                                                          
        |---- VBMFIT                                                               
                   |----  NAMIND                              External             
                   |----  VCBFIT                                                   
                   |----  NLINK                               External             
                   |----  AUBOS                               External             
                   |----  NINT                                External             
                   |----  RERROR                                                   
   
 
3 VBSCLR
         SUBROUTINE VBSCLR
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   End of run beam spot position computation, close bank
   
      Author   :- E. Lancon             29-APR-1993
   
      Bux fix: Steve Wasserbaech, April 1995
      Do not create a new row if the first row is not yet filled
      Modified: SW, 18 October 1995
      Switch to VBPC; introduce VBSP card.
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   RCLRUN                                                                          
        |---- VBSCLR                                                               
                   |----  NAMIND                              External             
                   |----  VBMFIT                                                   
                   |----  AUBPRS                              External             
                   |----  BLIST                               External             
                   |----  MALREC                              External             
                   |----  AGTFIL                              External             
                   |----  BWRITE                              External             
                   |----  ACLOSE                              External             
   
 
3 VBSINR
         SUBROUTINE VBSINR
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Initialise beam spot position computation for the run
   
      Author   :- E. Lancon             29-APR-1993
      Modified :- E. Lancon             24-JUN-1994
           Create working bank only once
      Modified: Steve Wasserbaech, April 1995
      Always clear the work banks (number of rows = 0)
      Get ALLR from daf
      Modified: SW, 18 October 1995
      Switch to ALRP and VBPC; introduce VBSP card.
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   RINRUN                                                                          
        |---- VBSINR                                                               
                   |----  NAMIND                              External             
                   |----  WBANK                               External             
                   |----  INTCHA                              External             
                   |----  JUNIDB                              External             
                   |----  MDARD                               External             
                   |----  ALLEP1                              External             
                   |----  GTSTUP                              External             
                   |----  BDROP                               External             
                   |----  AUBOS                               External             
                   |----  RERROR                                                   
   
 
3 VBSPOT
         SUBROUTINE VBSPOT
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Measure the beamspot using the aleph vdet
   
      Author   :- Dave Brown, George Redlinger           8-APR-1993
   
      Modified :- Steve Wasserbaech
          Nov 1994: Avoid taus to measure the beam spot
          Apr 1995: Use ABS on d0 and z0 cuts; remove call to VDAMB
      Modified: SW, 18 October 1995
      Fix an unbelievable ancient bug in inline function NW;
      switch to VBPC; introduce VBSP card; allow FRFT 0 if no VDET
      hits are required; allow tautau rejection and VDET hit
      definition to be switchable with VBPC; add some features
      to facilitate use in Alpha.
      Modified :- M.Cattaneo 97/12/05
         Call xvdeok instead of VDETOK
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   RECONS                                                                          
        |---- VBSPOT                                                               
                   |----  MIN                                 External             
                   |----  IAND                                External             
                   |----  ISHFT                               External             
                   |----  NAMIND                              External             
                   |----  NLINK                               External             
                   |----  XVDEOK                              External             
                   |----  VDHITS                              External             
                   |----  COS                                 External             
                   |----  SIN                                 External             
                   |----  ABS                                 External             
                   |----  ALFIEL                              External             
                   |----  SQRT                                External             
                   |----  WBANK                               External             
                   |----  VBMFIT                                                   
                   |----  RERROR                                                   
   
 
3 VCALCM
         SUBROUTINE VCALCM
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Removes coherent noise from hits
     Computes the Common Mode independently for each cluster belonging
     to a particular wafer stored in IPULS
     CM is defined by an iterative procedure which removes all elements
     higher or lower than the average plus or minus given numbers of
     standard deviations.
     The maximum element is removed at entry upon the assumption that it,
     at least, constitutes the signal.
     Convergence can be achieved either when no more elements are removed
     by a cycle or a number of elements smaller than a given value are
     left in the cluster.
     Author : C. Vannini 1/4/90
    Modified 15-1-94 Dave Brown for 95 VDET
    Modified March 1995 A. Bonissent, M. Thulasidas
                   reorganise and debug
     Internal variables:
        REAL CMODE             ! Common mode computed on a subset of PHIN
        REAL CSIGM             ! Std. Dev. of the NCHAN elements of PHIN
        LOGICAL RETRY          ! Used in the iterative calculation of CM
        REAL HIGTR             ! Pulses above this value are discarded
                               ! under the assumption that "it's signal"
        REAL LOWTR             ! Pulses below this value are discarded
                               ! as too negative spikes "are not real"
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   VDECOD                                                                          
        |---- VCALCM                                                               
                   |----  IAND                                External             
                   |----  NAMIND                              External             
                   |----  HFILL                               External             
                   |----  FLOAT                               External             
                   |----  VCMEAN                                                   
                   |----  NINT                                External             
                   |----  ISHFT                               External             
   
 
3 VCBFIT
         SUBROUTINE VCBFIT (BP, BPVEC, BPERR)
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Close form beamspot fit
   
   
      Inputs:
           - BP(2)           R   Input Beam Position
   
      Outputs:
           - BPVEC(2)        R   Output Beam Position
           _ BPERR(2)        R   Output Beam Position Error
   
      Author   :- D. Brown               8-APR-1993
   
      Modified: Steve Wasserbaech, April 1995
      Take beam size from ALLR instead of data statement
      Modified: Pere Comas, July 1995
      Protect RSINV against an error return
      Modified: SW, 18 October 1995
      Take beam size from VBSCOM; allow customized chunks; return
      zeros in case of failure.
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   VBMFIT                                                                          
        |---- VCBFIT                                                               
                   |----  VZERO                               External             
                   |----  MOD                                 External             
                   |----  AMAX1                               External             
                   |----  SIN                                 External             
                   |----  COS                                 External             
                   |----  RSINV                               External             
                   |----  SQRT                                External             
                   |----  MAX                                 External             
   
 
3 VCKTRK
         SUBROUTINE  VCKTRK(ITRK,ITCO,IHIT)
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Returns number of expected vdet hits for a track itrk
   
   
       by Hans-Guenther Moser
   
       created:           01/06/89
   
       last modification: 01/06/89
   
   
       can be called after the VDET track-hit association has been done
       (after call to VDLINK)
       uses the information in the VPRT banks (track extrapolation banks)
   
       ITRK   (in) : track number
       ITC0   (in) : = 1 if ITC only track (0 if TPC used)
       IHIT   (out): number of hits expected (-1 if error occurred)
   
   
       if ITCO = 0 it is assumed that ITRK is a track number in
       TGFT #1
       if ITCO = 1 it is assumed that ITRK is a track number in
       ITFT #2
   
   
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   FCFRID                                                                          
        |---- VCKTRK                                                               
                   |----  NLINK                               External             
   
 
3 VCLBNK
         SUBROUTINE VCLBNK(
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
        >      KVFHL,KVFPH,KVFLG,KVCOM,IFRS,ILS,ILAY,IPHI,IVIEW,IWAF,IWFF)
   Put vdet cluster into banks
   
      Inputs:
           - KVFHL,KVFPH,KVFLG,KVCOM : Bank indices
                       (necessary because they are members of families)
           - IFRS first strip
           - ILS  last strip
           - ILAY layer
           - IPHI face
           - IVIEW view
           - IWAF wafer in module
           - IWFF wafer in face
     15-12-96 A. Bonissent
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   VRECLT                                                                          
   VRECLU                                                                          
        |---- VCLBNK                                                               
                   |----  NAMIND                              External             
                   |----  VPKADD                              External             
   
 
3 VCMEAN
         SUBROUTINE VCMEAN(IFS,NST,CMODE,CSIGM)
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Calculates quanitites used in removing coherent noise
     Computes the average and the standard deviation on the non-flagged
     elements of PHIN(1..NST). Returns the average as CMODE and the
     std. dev. as CSIGM. Returns (0.,0.) if less than 2 elements found
     non-flagged.
     Author : C. Vannini 1/4/90
    Modified March 1995 A. Bonissent, M. Thulasidas
                   reorganise and debug
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   VCALCM                                                                          
        |---- VCMEAN                                                               
                   |----  NAMIND                              External             
                   |----  MAX                                 External             
   
 
3 VCRHOT
         SUBROUTINE VCRHOT
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Create and fill vhot the list of noisy strips accumulated by vdnois
   
     Author: C.Vannini  -  6/1/90
   
     Modified 17-1-94 by Dave Brown for the VDET upgrade
     Modified March 1995 A. Bonissent, M. Thulasidas
                    reorganise and debug
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
              VCRHOT                                                               
                   |----  IAND                                External             
                   |----  RERROR                                                   
                   |----  NBANK                               External             
                   |----  VNLAYR                              External             
                   |----  VROMAX                              External             
                   |----  VNSCRM                              External             
                   |----  VNRFAC                              External             
                   |----  VJFACI                              External             
                   |----  VJWAFF                              External             
                   |----  VAENWA                              External             
                   |----  NLINK                               External             
                   |----  FLOAT                               External             
                   |----  HFILL                               External             
                   |----  NINT                                External             
                   |----  VPKADD                              External             
                   |----  BDROP                               External             
   
 
3 VDALIN
         SUBROUTINE VDALIN
  ------------------------------------------------------------------------------
    CKEY V_DECK VDET
  ------------------------------------------------------------------------------
   Smears the vdxy and vdzt coordinates in accordance with
            the errors in the alignment quantities.
   
   -  Author         Manoj Thulasidas  5-Nov-1994
   
     Description
     ===========
     The alignment procedure for the VDET essentially measures the
     position of each wafer with respect to the rest of the detector.
     The results are given in the form of 6 quantities - 3
     translations and 3 rotations to go from the nominal position to
     the measure postion.  The statistical accuracy of these
     measurements is given in the 6x6 (symmetric) error matrix (21
     numbers) for each wafer.  There is no mathematically rigorous way
     of treating the uncertainty in the real position of the wafers -
     especially because it is measured with respect to the rest of the
     detector which is, in turn, subject to the same uncertainties,
     and the global correlations are not stored.
     Many possible treatments can be thought about:
   
     This subroutine does treatment B.
     (Treatment A => VDOSMR   and   Treatment C => VDWSMR)
   
     B:  Propagate the error analytically from the error matrix on
     the six quantities to an arbitray position on the wafer.  Smear
     the hits at that position using this error.  (See the subroutine-
     header for VDSIGM for the mathematical details.)
        While this procedure recovers the position and angular
     dependence of the smearing quantities (and results in a near
     perfect agreement between the data and MC resolution measurement
     as a function of the incident angle), it is still not completely
     satisfactory.  For instance, all the hits in one wafer get some
     random smearing, while in reality the smearing should be highly
     correlated.
    Output : smeard VDZT and VDXY banks
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   VDISMR                                                                          
        |---- VDALIN                                                               
                   |----  NAMIND                              External             
                   |----  RERROR                                                   
                   |----  VDALZT                                                   
                   |----  VDALXY                                                   
   
 
3 VDALSG
         SUBROUTINE VDALSG(IBREAL,JWAF,IV,XYZ,TNG,SIGMA)
  ------------------------------------------------------------------------------
    CKEY V_DECK VDET
  ------------------------------------------------------------------------------
   Vdalsg calculates the sigmas to smear the vdzt (iv=1) or vdxy (iv=2)
            bank.
   
   -  Author         Manoj Thulasidas  5-Nov-1994
   
     Description
     ===========
     Loads and unpacks the error matrix from the database
     Calls VDSIGM to calculate the SIGMA
    Input :  IBREAL - the VALC row number
             JWAF  - the global wafer number
             IV    - the view
             XYZ   - the global coordinates of the hit
             TNG   - the cotangent of the angle that the track makes
                     with the wafer, projected to the view
    Output : SIGMA - the smear
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   VDALXY                                                                          
   VDALZT                                                                          
        |---- VDALSG                                                               
                   |----  NAMIND                              External             
                   |----  RERROR                                                   
                   |----  UCOPY                               External             
                   |----  TRUPCK                              External             
                   |----  VXYZVU                              External             
                   |----  VDSIGM                                                   
   
 
3 VDALXY
         SUBROUTINE VDALXY
  ------------------------------------------------------------------------------
    CKEY V_DECK VDET
  ------------------------------------------------------------------------------
   Smears the vdxy in accordance with
            the errors in the alignment quantities.
   
   -  Author         Manoj Thulasidas  5-Nov-1994
      Description
     ===========
     Called by VDALIN to do half the job
   
    Output : smeard VDXY bank
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   VDALIN                                                                          
        |---- VDALXY                                                               
                   |----  NAMIND                              External             
                   |----  VDGTXL                                                   
                   |----  VJWABR                              External             
                   |----  VDALSG                                                   
                   |----  VXYZVU                              External             
                   |----  VDGAUS                                                   
                   |----  VVUWXY                              External             
                   |----  SQRT                                External             
                   |----  IOR                                 External             
   
 
3 VDALZT
         SUBROUTINE VDALZT
  ------------------------------------------------------------------------------
    CKEY V_DECK VDET
  ------------------------------------------------------------------------------
   Vdalzt smears the vdzt in accordance with
            the errors in the alignment quantities.
   
   -  Author         Manoj Thulasidas  5-Nov-1994
   
     Description
     ===========
     Called by VDALIN to do half the job
    Output : smeard VDZT bank
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   VDALIN                                                                          
        |---- VDALZT                                                               
                   |----  NAMIND                              External             
                   |----  VDGTXL                                                   
                   |----  VJWABR                              External             
                   |----  VDALSG                                                   
                   |----  VXYZVU                              External             
                   |----  VDGAUS                                                   
                   |----  VVUWXY                              External             
                   |----  SQRT                                External             
                   |----  IOR                                 External             
   
 
3 VDBGCL
         SUBROUTINE VDBGCL(IBEG)
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Find where clustering should start
       Used only for VET95
       If first and last strips are fired, start after the first
       non fired strip. The beginning will be attached to the
       last cluster at the end
   
    Author A. Bonissent March 1995
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
              VDBGCL                                                               
                   |----  IAND                                External             
                   |----  NAMIND                              External             
   
 
3 VDBOOK
         SUBROUTINE  VDBOOK
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Book vdet histograms
   
   
       by Hans-Guenther Moser
   
       created:           10/04/88
   
       last modification: 15-4-91
       Rewrite for 1991 VDET, Dave Brown
   
     Modified March 1995 A. Bonissent, M. Thulasidas
                    reorganise and debug
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   RBKHIS                                                                          
        |---- VDBOOK                                                               
                   |----  JHISRF                              External             
                   |----  JPRSRF                              External             
                   |----  IAND                                External             
                   |----  HBOOK1                              External             
                   |----  HBOOK2                              External             
                   |----  HBPROF                              External             
   
 
3 VDCHST
         INTEGER FUNCTION VDCHST(IROMD,ICHAN)
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Mapping from electronic readout channel to physical readout strip
    taking into account the bonding map in the VREG bank
                       G. Taylor 20/8/95
   
    INPUT  :
        IROMD   :  Readout module address
        ICHAN   :  Electronic readout channel
    OUTPUT :
        VDCHST  :  Physical readout strip
                   =0 if not bonded to a readout strip
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   VDPINH                                                                          
        |---- VDCHST                                                               
                   |----  VADEWA                              External             
                   |----  VNELRM                              External             
                   |----  NLINK                               External             
                   |----  RERROR                                                   
   
 
3 VDCRUN
         SUBROUTINE VDCRUN
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Vdet end of run
   
      Author   :- E. Lancon             26-FEB-1993
   
     Modified March 1995 D. Brown, A. Bonissent, M. Thulasidas
                    reorganise and debug for VDET 95
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   RCLRUN                                                                          
        |---- VDCRUN                                                               
                   |----  FLOAT                               External             
                   |----  NNOSHT                              External             
                   |----  VCRHOTRETURN                        External             
   
 
3 VDECOD
         SUBROUTINE VDECOD
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Main vdet hit reconstruction routine
   
   
     This is the micro-vertex silicon detector internal co-ordinate
     reconstruction routine.  This takes as input the raw detector
     data (VHLS and VPLH), plus maps of the detector bonding
     taken from the ALEPH database, and produces final hit banks.
   
     12-1-93  Rewrite for 95 VDET compatibility  D. Brown
     Modified March 1995 A. Bonissent, M. Thulasidas
                    reorganise and debug
              Nov   1995 P. Bright-Thomas
                    Rewrite fix for cabling errors using new bank VCAB
   
              Aug   1997 A. Bonissent
                    Protect against corrupted raw data
              Apr   1998 A. Bonissent
                    Protect against corrupted raw data
   
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   VPREDA                                                                          
        |---- VDECOD                                                               
                   |----  IAND                                External             
                   |----  NAMIND                              External             
                   |----  AUBOS                               External             
                   |----  BDROP                               External             
                   |----  VNSCRM                              External             
                   |----  VNELRM                              External             
                   |----  VDYEAR                              External             
                   |----  NLINK                               External             
                   |----  RERROR                                                   
                   |----  NBANK                               External             
                   |----  VUNADD                              External             
                   |----  VAENWA                              External             
                   |----  VJWFFW                              External             
                   |----  HFILL                               External             
                   |----  FLOAT                               External             
                   |----  VDSMAP                                                   
                   |----  VDPINH                                                   
                   |----  VCALCM                                                   
                   |----  VDSM95                                                   
                   |----  VRECLU                                                   
                   |----  VZERO                               External             
                   |----  AUBPRS                              External             
                   |----  BGARB                               External             
                   |----  NSWAP                               External             
                   |----  NDROP                               External             
   
 
3 VDETOK
         LOGICAL FUNCTION VDETOK(DUMMY)
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Determine hv state of vdet
   
    Obsolete, call XVDEOK directly
   
      Author   :- HCJ Seywerd            2-AUG-1991
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
              VDETOK                                                               
                   |----  XVDEOK                              External             
   
 
3 VDFNAM
         SUBROUTINE  VDFNAM
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Defines namindex common vdnamc
   
       by Hans-Guenther Moser
   
       created:           24/03/88
   
       last modification: 24/03/88
   
   
   
   
   
   
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
              VDFNAM                                                               
                   |----  NAMIND                              External             
   
 
3 VDFSUP
         SUBROUTINE VDFSUP
  ------------------------------------------------------------------------------
    CKEY V_DECK VDET
  ------------------------------------------------------------------------------
   Suppress the hits in dummy faces
   -  Author         Alain Bonissent, 22-October-1995
      Modified       Manoj Thulasidas 15-May-1996
               to change the subroutine name
    Input :  none
    Output :  suppressed VDXY, VDZT
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   VDMCEF                                                                          
        |---- VDFSUP                                                               
                   |----  VNTFAC                              External             
                   |----  VNRWAF                              External             
                   |----  VNRMOD                              External             
                   |----  VFACSN                              External             
                   |----  VIFACI                              External             
                   |----  VAENWA                              External             
                   |----  NDROP                               External             
   
 
3 VDGAUS
         REAL FUNCTION VDGAUS(MEAN, SIGMA)
  ------------------------------------------------------------------------------
    CKEY V_DECK VDET
  ------------------------------------------------------------------------------
   Returns the quantity mean smeared by sigma
   
   -  Author        Manoj Thulasidas  5-Nov-1994
    Input :   MEAN    - mean
              SIGMA   - sigma (Gaussian)
    Output :  VDGAUS  - smeared random variable
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   VDALXY                                                                          
   VDALZT                                                                          
   VDOSMR                                                                          
   VDWSMR                                                                          
        |---- VDGAUS                                                               
                   |----  RANNOR                              External             
   
 
3 VDGEPH
         SUBROUTINE  VDGEPH(R,TL,P0,D0,Z0,P,X)
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Physics parameter from helix parameters
   
       SUBROUTINE  VDGEPH
   
       by Hans-Guenther Moser
   
       created:           18/03/88
   
       last modification: 18/03/88
   
   
        input:  R      radius
                TL     dip angle
                P0     Phi at closest point to origin
                D0     distance to x=y=0 in x-y plane
                Z0     z coordinate at D0
   
        output  P(1-3) Momentum vector
                X(1-3) coordinates of D0i
   
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
              VDGEPH                                                               
                   |----  ABS                                 External             
                   |----  COS                                 External             
                   |----  SIN                                 External             
   
 
3 VDGTHT
         SUBROUTINE VDGTHT(IV,NRBK,IHIT,IVDHT,IERR)
  ------------------------------------------------------------------------------
    CKEY V_DECK VDET
  ------------------------------------------------------------------------------
   Given the vdzt (iv=1) or vdxy (iv=2) bank number (nrbk)
     and the hit number (IHIT), this truth finding routine returns
     the true hit number IVDHT in VDHT bank
   
   -  Author         Alain Bonissent  5-Nov-1994
    Modified November 1996, handle properly strips which
                   belong to two clusters (after splitting)
    Input :   IV    - view
              NRBK  - bank number for VDZT or VDXY
              IHIT  - row number in the bank
    Output :  IVDHT - true hit row number in the VDHT bank
              IERR  - zero if sucess
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   VDGTXL                                                                          
        |---- VDGTHT                                                               
                   |----  NLINK                               External             
                   |----  VTRURL                                                   
   
 
3 VDGTMV
         SUBROUTINE VDGTMV(IROW,AVEC)
  ------------------------------------------------------------------------------
    CKEY V_DECK VDET
  ------------------------------------------------------------------------------
   Vdgtmv unpacks the alignment error matrix and calculates
            a random vector AVEC (6-dim), the displacements in the
            alignment quanties.
   
   - Author         Manoj Thulasidas  5-Nov-1994
    Input :  IROW  - the VALC row number to be used.
    Output : AVEC  - six dimensional vector of displacements in
                     the three alignment translations and three
                     rotations.
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   VDWSMR                                                                          
        |---- VDGTMV                                                               
                   |----  NAMIND                              External             
                   |----  RERROR                                                   
                   |----  UCOPY                               External             
                   |----  TRUPCK                              External             
                   |----  VDRNDM                                                   
   
 
3 VDGTXL
         SUBROUTINE VDGTXL(IV,NR,IHIT,XYZ,TNG,IERR)
  ------------------------------------------------------------------------------
    CKEY V_DECK VDET
  ------------------------------------------------------------------------------
   Given the vdzt (iv=1) or vdxy (iv=2) bank number (nr)
     and the hit number (IHIT), this truth finding routine returns
     the true hit position XYZ (and the cotangent of the angle
     between the track and wafer normal projected to the view)
     if possible (IERR=0), if not IERR is non-zero.
   
   -  Author         Alain Bonissent and Manoj Thulasidas  5-Nov-1994
    Input :   IV    - view
              NR    - bank number for VDZT or VDXY
              IHIT  - row number in the bank
    Output :  XYZ   - true position from the VDHT bank
              TNG   - the cotangent of the angle that the track makes
                      with the wafer, projected to the view
              IERR  - zero if sucess
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   VDALXY                                                                          
   VDALZT                                                                          
   VDWSMR                                                                          
        |---- VDGTXL                                                               
                   |----  NAMIND                              External             
                   |----  VDGTHT                                                   
                   |----  VJFACI                              External             
                   |----  VDTAN                                                    
                   |----  VJWABW                              External             
                   |----  VXYZWA                              External             
                   |----  VDRTAN                                                   
   
 
3 VDHIST
         SUBROUTINE  VDHIST
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Vdet histograming routine (steering)
   
   
       by Hans-Guenther Moser
   
       created:           10/01/89
   
       last modification: 10/01/89
   
   
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   RHSEVT                                                                          
        |---- VDHIST.                                                              
   
 
3 VDINCP
         SUBROUTINE VDINCP(WID,PHIN,XYZ,XDIFF)
  ------------------------------------------------------------------------------
    CKEY V_DECK VDET
  ------------------------------------------------------------------------------
   Find the difference vector xdiff of the points of intersection
     of a line drawn from the origin through XYZ with a slab of width WID
     placed parallel to the z axis with the normal making an azimuthal angle
     PHIN.  Like a wafer for instance.
     Basically, given the hit position and the wafer geometry, this routine
     gives the difference vector between the intersections.
   -  Author         Manoj Thulasidas  9-May-1996
    inputs:       WID   - the wafer width / slab thickness
                  PHIN  - phi of the normal / azimuthal orientation
                  XYZ   - a point on the line array(3), real
    output:       XDIFF - the difference vector, array(3), real
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   VDRTAN                                                                          
        |---- VDINCP                                                               
                   |----  ATAN2                               External             
                   |----  VMOD                                External             
                   |----  SQRT                                External             
                   |----  SIN                                 External             
   
 
3 VDISMR
         SUBROUTINE VDISMR
  ------------------------------------------------------------------------------
    CKEY V_DECK VDET
  ------------------------------------------------------------------------------
   Sets up the appropriate smearing scheme
     depending on the datacard VDSM in the first call
     Thereafter, calls the appropriate smearing routine
   
   -  Author         Manoj Thulasidas  27-MAR-1995
    Input :
    Output :
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   VPREDA                                                                          
        |---- VDISMR                                                               
                   |----  NAMIND                              External             
                   |----  RERROR                                                   
                   |----  VDWSMR                                                   
                   |----  VDOSMR                                                   
                   |----  VDALIN                                                   
   
 
3 VDJACB
         SUBROUTINE VDJACB(IV,VUW,TNG,JACOB)
  ------------------------------------------------------------------------------
    CKEY V_DECK VDET
  ------------------------------------------------------------------------------
   Vdjacb calculates the jacobian of local coordinate (w or u)
     with respect to the alignment parameters
   
   - Author         Manoj Thulasidas  10-Apr-96
   
     Fix the missing JACOB(3) bug (in IV=2)
        Manoj Thulasidas 16-July-1997
     Description
     ===========
    Input :
             IV    - the view
             VUW   - the local coordinate
             TNG   - the cotangent of the angle that the track makes
                     with the wafer, projected to the view
    Output : JACOB(6) - the jacobian
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   VDSIGM                                                                          
   VDWSDX                                                                          
        |---- VDJACB.                                                              
   
 
3 VDKLCP
         SUBROUTINE VDKLCP(IER)
  ------------------------------------------------------------------------------
    CKEY VDET
  ------------------------------------------------------------------------------
   Sets quality flag for hits in vdxy,vdzt banks according to dead chip
    making sure that the multiplexed hits get killed together
           Manoj Thulasidas 24-June-1996
    - Output IER =0 OK ,
                 =-1 problem with banks
                 = 1 routine will do nothing
   
    - Input banks : VDXY, VDZT, VDCE, VDGC, VDMR
    - Output banks: VDXY, VDZT only the word(quality flag)
   
         It takes the first element in the VDEM bank and applies that
         efficiency to all the hits in both views.  Ad-hoc correction.
                       24-June-1996 Manoj Thulasidas
         Introduced the new bank VDCE instead of the VDEM bank.
         It is the VDet Chip Efficiency map
         It is built from the data base banks
            VDPR (Vdet efficiency Periods and weights)
            VDCM (Vdet Chip efficiency map, compact form)
                       03-Jul-1998 Manoj Thulasidas
         Add protections for garbage collection.
         Modification of the logic of the VKILL bank to delete the correct hits.
                       07-Oct-1999 Paschal Coyle, Thomas Kachelhoffer
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   VDMCEF                                                                          
        |---- VDKLCP                                                               
                   |----  VDMKCE                                                   
                   |----  NAMIND                              External             
                   |----  BDROP                               External             
                   |----  ALBOS                               External             
                   |----  RMARIN                              External             
                   |----  RANMAR                              External             
                   |----  NLINK                               External             
                   |----  IOR                                 External             
                   |----  VDGTCH                              External             
   
 
3 VDLINK
         SUBROUTINE  VDLINK
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Steering routine for mvd hit association and track refit
   
       Author :- hans-guenther moser         25/01/88
   
       last modification: 4-2-91 David Brown
       Rewritten to drive the new MOURS vertex refitting
       Modified A. Bonissent May 1995
       Compress Monte Carlo truth information
   
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   RECEVT                                                                          
        |---- VDLINK                                                               
                   |----  NAMIND                              External             
                   |----  AUNPCK                              External             
                   |----  VTRKEX                              External             
                   |----  RERROR                                                   
                   |----  VTRFIT                              External             
                   |----  VDMCTR                                                   
   
 
3 VDMCEF
         SUBROUTINE VDMCEF(IER)
  ------------------------------------------------------------------------------
    CKEY VDET
  ------------------------------------------------------------------------------
   Sets quality flag for hits in vdxy,vdzt banks according to dead line
    - J.Carr - 16-9-91
    - Output IER =0 OK ,
                 =-1 problem with banks
                 = 1 routine will do nothing
   
    - Input banks : VDXY, VDZT, VDEM
    - Output banks: VDXY, VDZT only the word(quality flag)
   
         Modified 27-8-93 to include hit position smearing      D. Brown
         This uses the VDSM bank.
         Modified 10-nov-94  to take out the position smearing.
         This will be organized as a separate subroutine.
         Modified 20-May-96  to tread the new VDET, it takes the first
         element in the VDEM bank and applies that efficiency to all
         the hits in both views.  Ad-hoc correction.
                       Manoj Thulasidas
         Modified 24-June-96, to move the treatment of the new VDET to
         VDKLCP.  The multiplexed hits can not be taken care of in the
         the framework of VDMCEF
                       Manoj Thulasidas
         Modified 8-July-1998, to move the VDKLCP section before the
         test on NOTDO.  VDKLCP has been modified to handle low
         efficiency chips / modules properly with new database banks
         VDPR and VDCM
                       Manoj Thulasidas
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   VPREDA                                                                          
        |---- VDMCEF                                                               
                   |----  NAMIND                              External             
                   |----  VDYEAR                              External             
                   |----  VDFSUP                                                   
                   |----  VDKLCP                                                   
                   |----  RMARIN                              External             
                   |----  RANMAR                              External             
                   |----  VDMJLN                                                   
                   |----  IOR                                 External             
   
 
3 VDMCTR
         SUBROUTINE VDMCTR(IERR)
  ------------------------------------------------------------------------------
    CKEY V_DECK VDET
  ------------------------------------------------------------------------------
   Compress monte carlo truth information
   A.Bonissent - 950317
    Modified November 1996, handle properly strips which
                   belong to two clusters (after splitting)
     Input banks : VTRS Galeph strips to KINE tracks relation
                   VDCO Reconstructed 3D hit clusters
                   VDXY, VDZT 2D reconstructed hit clusters
                   FKIN Compressed kinematic tracks built in Julia
                   FPOI Relation between KINE and FKIN tracks
                   VFHL, VFPH  Julia pulseheight banks
     Output banks : VDFK, VUFK Relations between
                               reconstructed hits VDCO, VDXY, VDZT
                               and FKIN tracks
     RETURN CODES: IERR=-1,-2 MISSING BANKS,
                        -3 : Could not booK VDFK,
                        -4 : NMAX was too small
                  IERR > 0 : same error occured in VUMCTR
                             when dealing with unassociated hits
                         0 OK
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   VDLINK                                                                          
   VGLINK                                                                          
        |---- VDMCTR                                                               
                   |----  NAMIND                              External             
                   |----  BDROP                               External             
                   |----  AUBOS                               External             
                   |----  NLINK                               External             
                   |----  VTRURL                                                   
                   |----  AUBPRS                              External             
                   |----  VUMCTR                                                   
   
 
3 VDMJLN
         INTEGER FUNCTION VDMJLN(UW,NRWAF,IVIEW)
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Function to define a vdet line number index
     Written by John Carr, 16-9-91
   
      Input
           UW local position
           IVIEW: =1 W  , =2 U
           NRWAF: Bank number from same
   
      Output
           VDMJLN = 1,288 (JJD CONVENTION)
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   VDMCEF                                                                          
        |---- VDMJLN                                                               
                   |----  VADEWA                              External             
                   |----  VDMJLS                              External             
   
 
3 VDMKCE
         subroutine VDMKCE
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Makes the chip efficiency map file vdce (similar to the old vdem)
     from VDPR (which defines the efficiency periods and weights) and
     VDCM (which gives the efficiencies of the chips that have non-default
     efficiency)
   
   - Author         Manoj Thulasidas  3-Jul-1998
     Input    VDPR and VDCM banks
     Output   VDCE Bank
        Add protections for garbage collections.
                     07-Oct-1999 Thomas Kachelhoffer
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   VDKLCP                                                                          
        |---- VDMKCE                                                               
                   |----  NAMIND                              External             
                   |----  RERROR                                                   
                   |----  ALBOS                               External             
                   |----  VFILL                               External             
                   |----  VDCHNB                              External             
   
 
3 VDMONI
         SUBROUTINE  VDMONI
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Monitoring of mvd reconstruction quality
   
   
       by Hans-Guenther Moser
   
       created:           09/03/88
      Modified :- E. Lancon              8-MAR-1991
                 Make it Dummy
   
       last modification: 09/01/90
   
   
       this program makes use of the MC truth information,
       with real data the results are unpredictable and
       lots of error messages and warnigns are ensured
   
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
              VDMONI.                                                              
   
 
3 VDMPIN
         SUBROUTINE VDMPIN
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Unpack vdet mapping and module banks used in hit reconstruction
   
    This subroutine is responsible for reading in the database files
    which contain the module maping information of the ALEPH silicon
    vertex detector, and translating these into a form usefull in the
    reconstruction.  D. Brown, 10-4-90
    Modified March 1995 D. Brown, A. Bonissent, M. Thulasidas
                   reorganise and debug,
                   use geom. package for Vdet 91 or 95
    Modified June 1995 A. Bonissent
                   VMGN was changed to contain also first and last
                   channel in a region
                   would work only with DAF > 198
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   VINIRU                                                                          
        |---- VDMPIN                                                               
                   |----  NAMIND                              External             
                   |----  VUNADD                              External             
                   |----  VDYEAR                              External             
                   |----  VMKR90                                                   
                   |----  VMKR95                                                   
                   |----  RERROR                                                   
                   |----  VAENWA                              External             
                   |----  NBANK                               External             
                   |----  VADEWA                              External             
                   |----  VNELRM                              External             
                   |----  BDROP                               External             
                   |----  BGARB                               External             
   
 
3 VDMSUP2
         SUBROUTINE VDMSUP2(ITRK,NH,WAFER,UHIT,WHIT, IGArg)
  ------------------------------------------------------------------------------
    CKEY VDET TRACK
  ------------------------------------------------------------------------------
   Update face extrapolation bank vdms for true vdet hit position
     Author : Paul Rensing 7-7-95
           Based on VDMSUP from ALEPHLIB 207
     VDMS bank for the requested track is copied to bank# 0, and
       updated for VDET hit information, coming either from given hits or
       VDCO.
     Inputs:
       INTEGER ITRK     - FRFT track number
       INTEGER NH       - number of VDET hits; 0 means use VDCO
       INTEGER WAFER(*) - wafer number of hits
       REAL UHIT(*)     - the VDET u co-ordinate of the hit (wafer local!)
       REAL WHIT(*)     - the VDET w co-ordinate of the hit (wafer local!)
     Outputs:
       INTEGER IGArg    - non 0 means a garbage collection was performed
       VDMS, 0 bank
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   VFTALL                                                                          
   VMCHIP                                                                          
   YKFFIT                                                                          
        |---- VDMSUP2                                                              
                   |----  NAMIND                              External             
                   |----  VNRWAF                              External             
                   |----  VNRMOD                              External             
                   |----  VABCXY                              External             
                   |----  NLINK                               External             
                   |----  AUBOS                               External             
                   |----  ALTELL                              External             
                   |----  UCOPY                               External             
                   |----  VADEWA                              External             
                   |----  COS                                 External             
                   |----  SIN                                 External             
                   |----  VGWFVU                              External             
                   |----  VDMSEC                              External             
                   |----  SORTZV                              External             
   
 
3 VDNOIS
         SUBROUTINE VDNOIS
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Detects noisy strips to be switched off during subsequent
       reprocessing
   
     Author: C.Vannini  -  6/1/90
   
     Modified 16-1-94 by Dave Brown for the VDET upgrade
     Modified March 1995 A. Bonissent, M. Thulasidas
                    reorganise and debug
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   VPREDA                                                                          
        |---- VDNOIS                                                               
                   |----  IAND                                External             
                   |----  NAMIND                              External             
                   |----  NLINK                               External             
                   |----  RERROR                                                   
                   |----  VUNADD                              External             
                   |----  VAENWA                              External             
   
 
3 VDOSMR
         SUBROUTINE VDOSMR
  ------------------------------------------------------------------------------
    CKEY V_DECK VDET
  ------------------------------------------------------------------------------
   Vdosmr smears the vdxy and vdzt coordinates with averages
            stored in VDSM bank.
            Origanally, it was a part of VDMCEF as introduced
            by Dave brown.  Expected to be obselete in view of
            the new routine VDWSMR, dealigning the MC detector
            wafer by wafer and event by event.
   -   Author         Manoj Thulasidas  5-Nov-1994
   -   Modified       Marco Cattaneo    3-Jun-1997
           Remove call to NORRIN, replace RANNOR by VDGAUS
   
      Description
      ===========
      The alignment procedure for the VDET essentially measures the
      position of each wafer with respect to the rest of the detector.
      The results are given in the form of 6 quantities - 3
      translations and 3 rotations to go from the nominal position to
      the measure postion.  The statistical accuracy of these
      measurements is given in the 6x6 (symmetric) error matrix (21
      numbers) for each wafer.  There is no mathematically rigorous way
      of treating the uncertainty in the real position of the wafers -
      especially because it is measured with respect to the rest of the
      detector which is, in turn, subject to the same uncertainties.
      and the global correlations are not stored.
     Many possible treatments can be thought about:
   
     This subroutine does treatment A.
     (Treatment B => VDALIN   and   Treatment C => VDWSMR)
   
     A: Take some kind of an average error for each hit, smear the
     position with this error.  This is in effect done in the current
     version of the Monte Carlo (Jul274, in VDMCEF). The VDSM bank
     that holds these average smears reads: SIGU = 8.8mu and
     SIGW=9.7mu.
   
     This method has the drawback of ignoring the position/angular
     dependence of the propagated errors.
    - Input banks : VDXY, VDZT, VDSM
    - Output banks: VDXY, VDZT smeared and quality flag, 29th bit
                    changed.
         27-8-93 to include hit position smearing      D. Brown
         This uses the VDSM bank.
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   VDISMR                                                                          
        |---- VDOSMR                                                               
                   |----  NAMIND                              External             
                   |----  AGETDB                              External             
                   |----  RERROR                                                   
                   |----  IAND                                External             
                   |----  VDGAUS                                                   
                   |----  VGWFXY                              External             
                   |----  IOR                                 External             
                   |----  RANNOR                              External             
   
 
3 VDPINH
         SUBROUTINE VDPINH(IROMD)
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   This takes the list of peculiar readout channels for a given module
    and sets the flags of the corresponding strips in the Monte Carlo
                       G. Taylor 20/8/95
   
    INPUT  :
        IROMD   :  Readout module address
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   VDECOD                                                                          
        |---- VDPINH                                                               
                   |----  NAMIND                              External             
                   |----  NLINK                               External             
                   |----  VDCHST                                                   
                   |----  IAND                                External             
   
 
3 VDRCUN
         SUBROUTINE VDRCUN
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   This subroutine unpacks the vrcn bank into the vrecon common
   
      Author   :- D. Brown
   
      Modified :- E. Lancon              5-APR-1993
                 Set only final P.H. and Hot chanels for PASS0 mode
      Modified :- I. Tomalin            16-SEP-1996
                 Set MKVDXY to .TRUE. if in PASS0 and using new VDET
                 and PVGG card.
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   VINIRU                                                                          
        |---- VDRCUN                                                               
                   |----  NAMIND                              External             
                   |----  RERROR                                                   
                   |----  GTSTUP                              External             
                   |----  VDYEAR                              External             
   
 
3 VDRNDM
         SUBROUTINE VDRNDM(MXALN,EMAT,RVEC)
  ------------------------------------------------------------------------------
    CKEY V_DECK VDET
  ------------------------------------------------------------------------------
   Vdrndm calculates a random vector rvec of mxaln dimensions
            depending on a MXALN by MXALN error matrix EMAT
   
   - Author         Manoj Thulasidas  5-Nov-1994
    Input :  MXALN  - dimension
             EMAT   - error matrix
    Output : RVEC   - random vector
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   VDGTMV                                                                          
        |---- VDRNDM                                                               
                   |----  RERROR                                                   
                   |----  EISRS1                              External             
                   |----  RANNOR                              External             
                   |----  SQRT                                External             
                   |----  VMATR                               External             
   
 
3 VDRTAN
         SUBROUTINE VDRTAN(JWAF,SXYZ,TNG)
  ------------------------------------------------------------------------------
    CKEY V_DECK VDET
  ------------------------------------------------------------------------------
   Given the hit position, this routine returns the cotangents necessary
     to calculate the Jacobian (to get the alignment errors)
   -  Author         Manoj Thulasidas  9-May-1996
    input:  JWAF - the global wafer address
            SXYZ - the global hit position array(3), real
    output: TNG  - the cotangents array(2), real
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   VDGTXL                                                                          
        |---- VDRTAN                                                               
                   |----  VJFACW                              External             
                   |----  VWTHCK                              External             
                   |----  VPHIFN                              External             
                   |----  VDINCP                                                   
                   |----  SIN                                 External             
                   |----  COS                                 External             
                   |----  VDOT                                External             
   
 
3 VDSIGM
         SUBROUTINE VDSIGM(EMAT,IV,VUW,TNG,SIGMA)
  ------------------------------------------------------------------------------
    CKEY V_DECK VDET
  ------------------------------------------------------------------------------
   Vdsigm calculates the sigmas to smear the vdzt (iv=1) or vdxy (iv=2)
            bank.
   
   - Author         Manoj Thulasidas  5-Nov-1994
   
     Description
     ===========
     given the alignment error matrix, wafer center and
     the position of the hit,  returns the error due to the
     alignment to be applied in the MC.
     in order to make a fair comparison with the data 3-hit method,
     the local coordinate vector VUW has to be taken in the overlap
     region.
    Input :  EMAT  - the error matrix
             IV    - the view
             VUW   - the local coordinate
             TNG   - the cotangent of the angle that the track makes
                     with the wafer, projected to the view
    Output : SIGMA - the smear
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   VDALSG                                                                          
        |---- VDSIGM                                                               
                   |----  VDJACB                                                   
                   |----  VMATR                               External             
                   |----  VDOT                                External             
                   |----  SQRT                                External             
   
 
3 VDSM95
         SUBROUTINE VDSM95(IROMD)
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Performs the map from electronics channels to strip numbers
   
    This subroutine takes as input hits from a single readout module
    and produces as output an edited version of same,
    with address mapped onto the actual (integer) strip numbers,
    unmapped channels removed, and special case strips flaged,
    for each of the 3 wafers in a module.
    1 electronic channel -> 2(view1) or 3 (view2) readout strips
    A. Bonissent June 1995
    INPUT  :
        IROMD   :  Readout module address
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   VDECOD                                                                          
        |---- VDSM95                                                               
                   |----  IAND                                External             
                   |----  NAMIND                              External             
                   |----  VADEWA                              External             
                   |----  VNELRM                              External             
                   |----  IOR                                 External             
                   |----  NLINK                               External             
                   |----  VFWAFF                              External             
                   |----  VJMODI                              External             
                   |----  VSCHAN                              External             
                   |----  RERROR                                                   
                   |----  VNSCRM                              External             
                   |----  VTRSUP                                                   
   
 
3 VDSMAP
         SUBROUTINE VDSMAP(IROMD,GOOD)
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Performs the map from electronics channels to strip numbers
   
    This subroutine takes as input hits from a single wafer
    and produces as output an edited version of same,
    with address mapped onto the actual (integer) strip numbers,
    unmapped channels removed, and special case strips flaged.
    D. Brown, 9-4-90
    Modified 16-1-94 by Dave Brown for the VDET upgrade
    Modified March 1995 A. Bonissent, M. Thulasidas
                   reorganise and debug
    INPUT  :
        IROMD   :  Readout module address
    OUTPUT :
        GOOD    :  Flag if everything went OK
    Upgraded 13-1-94 for new vdet    D. Brown
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   VDECOD                                                                          
        |---- VDSMAP                                                               
                   |----  IAND                                External             
                   |----  NAMIND                              External             
                   |----  VADEWA                              External             
                   |----  VNELRM                              External             
                   |----  IOR                                 External             
                   |----  NLINK                               External             
                   |----  RERROR                                                   
                   |----  VNSCRM                              External             
   
 
3 VDSTCH
         INTEGER FUNCTION VDSTCH(IROMD,ISTRIP)
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Mapping from physical readout strip to electronic readout channel
    taking into account the bonding map in the VREG bank
                       G. Taylor 20/8/95
   
    INPUT  :
        IROMD   :  Readout module address
        ISTRIP  :  Physical readout strip
    OUTPUT :
        VDSTCH  :  Electronic readout channel
                   =0 if the is an error
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
              VDSTCH                                                               
                   |----  VADEWA                              External             
                   |----  VNELRM                              External             
                   |----  NLINK                               External             
                   |----  RERROR                                                   
   
 
3 VDTAN
         SUBROUTINE VDTAN(IV,JFAC,XIN,XOUT,TNG)
  ------------------------------------------------------------------------------
    CKEY V_DECK VDET
  ------------------------------------------------------------------------------
   For a given vdht track entry (xin) and exit (xout) and
     the global face number JFAC, get the cotangent of the angle
     between the track and wafer normal projected to the view
   
   - Author          Manoj Thulasidas  5-Nov-1994
    Input :   IV    - view
              JFAC  - global face number
              XIN   - VDHT entry
              XOUT  - VDHY exit
    Output :  TNG   - the cotangent of the angle that the track makes
                      with the wafer, projected to the view
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   VDGTXL                                                                          
        |---- VDTAN                                                                
                   |----  VSUB                                External             
                   |----  VWTHCK                              External             
                   |----  RERROR                                                   
                   |----  VPHIFN                              External             
                   |----  SIN                                 External             
                   |----  COS                                 External             
                   |----  VDOT                                External             
   
 
3 VDWSDX
         SUBROUTINE VDWSDX(IV,VUW,AVEC,TNG,DISP)
  ------------------------------------------------------------------------------
    CKEY V_DECK VDET
  ------------------------------------------------------------------------------
   Vdwsdx calculates the displacement in a hit (at vuw) in a
            given view for a misalignment described by the alignment
            quantities in AVEC for wafer JWAF.
   
   - Author         Manoj Thulasidas  5-Nov-1994
    Input :  IV    - view
             VUW   - local coordinates
             AVEC  - six dimensional vector of displacements in
                     the three alignment translations and three
                     rotations.
             TNG   - tangent of the track incident angle (= track slope)
    Output : DISP  - displacement in position (to be applied to either
                     U [view=1] or W [view=2] coordinate) by the
                     caller.
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   VDWSMR                                                                          
        |---- VDWSDX                                                               
                   |----  VDJACB                                                   
                   |----  VDOT                                External             
   
 
3 VDWSMR
         SUBROUTINE VDWSMR
  ------------------------------------------------------------------------------
    CKEY V_DECK VDET
  ------------------------------------------------------------------------------
   Vdwsmr smears the vdxy and vdzt coordinates in accordance with
            the errors in the alignment quantities.
   
   - Author         Manoj Thulasidas  5-Nov-1994
   
     Description
     ===========
     The alignment procedure for the VDET essentially measures the
     position of each wafer with respect to the rest of the detector.
     The results are given in the form of 6 quantities - 3
     translations and 3 rotations to go from the nominal position to
     the measure postion.  The statistical accuracy of these
     measurements is given in the 6x6 (symmetric) error matrix (21
     numbers) for each wafer.  There is no mathematically rigorous way
     of treating the uncertainty in the real position of the wafers -
     especially because it is measured with respect to the rest of the
     detector which is, in turn, subject to the same uncertainties.
     and the global correlations are not stored.
     Many possible treatments can be thought about:
   
     This subroutine does treatment C.
     (Treatment A => VDOSMR   and   Treatment B => VDALIN)
   
     C: Dealign the MC detector.  In each MC julia event, one could
     position the wafers at random locations dictated by the alignment
     error matrices.  And then one would have to just recompute the
     coordinates (VDXY and VDZT entities).  The resolution measured for
     each wafer (at each position) would come out better than the data,
     but when averaged over all the wafers and all positions, the
     agreement between data and MC should be just as good as in B.  Note
     that C is better than B in that it gets the correlations within on
     wafer right.  It is still not perfect because there is no way one
     could take care of wafer to wafer correlations (all the hits in the
     same module should have highly correlated errors).  Also, the
     random placement of the wafers may not be appealing to some.
     However, given the information, this about the best we can do.
    Output : smeard VDZT and VDXY banks
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   VDISMR                                                                          
        |---- VDWSMR                                                               
                   |----  JUNIDB                              External             
                   |----  GTSTUP                              External             
                   |----  ALGTDB                              External             
                   |----  NAMIND                              External             
                   |----  RERROR                                                   
                   |----  VJWABW                              External             
                   |----  VDYEAR                              External             
                   |----  VBRJWA                              External             
                   |----  NLINK                               External             
                   |----  VDGTMV                                                   
                   |----  VDGTXL                                                   
                   |----  VJWABR                              External             
                   |----  VXYZVU                              External             
                   |----  VDWSDX                                                   
                   |----  VDGAUS                                                   
                   |----  VGWFXY                              External             
                   |----  IOR                                 External             
   
 
3 VDXYZT
         SUBROUTINE VDXYZT
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Creates the banks vdxy,vdzt from the banks vfph,vfhl,vflg
      Author   :- D. Brown           18-SEP-1991
   
     Modified 16-1-94 by Dave Brown for the VDET upgrade
     Modified March 1995 A. Bonissent, M. Thulasidas
                    reorganise and debug
    Modified June 1995 handle Vdet95, multiplexing was not foreseen
    Modified November 1996 A. Bonissent, keep track of strips which
                                    belong to two clusters (after splitting)
    Modified 3/6/97 M.Cattaneo, replace call exit() by RERROR,
                                move 999 label to include BDROP of work banks
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   VPREDA                                                                          
        |---- VDXYZT                                                               
                   |----  IAND                                External             
                   |----  MAX                                 External             
                   |----  VNELRM                              External             
                   |----  NAMIND                              External             
                   |----  BDROP                               External             
                   |----  AUBOS                               External             
                   |----  RERROR                                                   
                   |----  VDYEAR                              External             
                   |----  NLINK                               External             
                   |----  VUNADD                              External             
                   |----  VAENWA                              External             
                   |----  VJFACI                              External             
                   |----  VJWAFF                              External             
                   |----  VMWAFJ                              External             
                   |----  HFILL                               External             
                   |----  VSEPLT                                                   
                   |----  VSEPAR                                                   
                   |----  VLCPOS                                                   
                   |----  FLOAT                               External             
                   |----  UCOPY                               External             
                   |----  VMGCRL                                                   
                   |----  VZERO                               External             
   
 
3 VHINIT
         SUBROUTINE VHINIT
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Initialization for runs creating new vhot lists
   
    Author: C.Vannini  -  6/1/90
   
    Variables of common/VHOTPM/ are initialized here
    Create an empty bank VHOT with nr=IRUNRC
    Create VOCC to record the occurrency of each strip/run
    Control histograms are booked
   
     Modified 16-1-94 by Dave Brown for the VDET upgrade
     Modified March 1995 A. Bonissent, M. Thulasidas
                    reorganise and debug
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   VHOTIN                                                                          
        |---- VHINIT                                                               
                   |----  NLINK                               External             
                   |----  RERROR                                                   
                   |----  NDROP                               External             
                   |----  NBANK                               External             
                   |----  VNLAYR                              External             
                   |----  VROMAX                              External             
                   |----  VNSCRM                              External             
                   |----  VNRFAC                              External             
                   |----  VAENWA                              External             
   
 
3 VHOTIN
         SUBROUTINE VHOTIN
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Initialize the hot channels list (vhot bank) for current run.
     If in a special run for hot channels list creation, initialization
     is done by VHINIT.  Else the VHOT bank corresponding to run IRUNRC
     is checked, and eventually reduced, according to current MXp/zOCC
     values.
     Author : C. Vannini  13/7/90
   
     Modified 16-1-94 by Dave Brown for the VDET upgrade
     Modified March 1995 A. Bonissent, M. Thulasidas
                    reorganise and debug
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   VINIRU                                                                          
        |---- VHOTIN                                                               
                   |----  NAMIND                              External             
                   |----  BDROP                               External             
                   |----  VHINIT                                                   
                   |----  RERROR                                                   
                   |----  VUNADD                              External             
                   |----  VAENWA                              External             
                   |----  AUBOS                               External             
                   |----  BLIST                               External             
   
 
3 VINIJO
         SUBROUTINE VINIJO
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Initialise the vdet job
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   RINJOB                                                                          
        |---- VINIJO.                                                              
   
 
3 VINIRU
         SUBROUTINE VINIRU
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Initialize the vdet run
      AUTHOR    : G. BAGLIESI   861007
      Input      : VDG1, VDRD, VDPA banks
      Output     : Filled VDPARM and VDGEOS commons
   
       called by : RPRRUN
       calls     : VDIGEP
   
       modifications:
       08/01/90   test for MC event (HGM)
       14-5-90    Rearrange DB logic, get module mapping banks,
                  reduce bank lists, etc.  D. Brown
       4-2-91     Changes for 91 D. Brown
       16-4-93    get DB banks depending on setup code through ALGTDB
                  instead of MDARD
   
     Modified 16-1-94 by Dave Brown for the VDET upgrade
     Modified March 1995 A. Bonissent, M. Thulasidas
                    reorganise and debug
     Modified 16-9-96 by I. Tomalin:
                 Set MKVDXY to .TRUE. if in PASS0 and using new VDET
                 and PVGG card.
     Modified 3-7-98 by Manoj Thulasidas:
                 Include VDPR and VDCM in the list of banks to be
                 loaded with the set up code
   
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   RINRUN                                                                          
        |---- VINIRU                                                               
                   |----  GTSTUP                              External             
                   |----  NAMIND                              External             
                   |----  RERROR                                                   
                   |----  VRDDAF                              External             
                   |----  VGRDAL                              External             
                   |----  MAX                                 External             
                   |----  VNELRM                              External             
                   |----  ALGTDB                              External             
                   |----  VDMPIN                                                   
                   |----  VDRCUN                                                   
                   |----  VHOTIN                                                   
                   |----  VDYEAR                              External             
                   |----  BGARB                               External             
   
 
3 VLCPOS
         SUBROUTINE VLCPOS(IBEG,NSTRP,PHCUT,POS,PSUM,NPOS)
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Compute the local position of a final cluster
   
      Modified :- Dave Brown, 18-8-91,
     complete rewrite of VREPOS for hit separation,
     new algorthim, etc.
      Modified 1 1992 new definition of sum pulseheight
   
    A newer and better version was written by D. Brown, but the
    This routine is an adaptation of the one extracted from old code.
    algorithms were slightly changed. For the moment, and for best
    compatibility with the old code, we use this.
    A. Bonissent January 1995
   
   
     Inputs;     RPULS = Array of pulseheight values
                 NSTRP = Number of strips
                 PHCUT = Minimum PH cut
     Outputs;    POS   = position relative to first strip, in strip coord
                 PSUM  = Pulseheight sum of all strips
                 NPOS  = # of used strips, 0 means bug
   
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   VDXYZT                                                                          
        |---- VLCPOS                                                               
                   |----  NAMIND                              External             
                   |----  SORTZV                              External             
                   |----  MIN                                 External             
                   |----  MAX                                 External             
   
 
3 VMGCRL
         SUBROUTINE VMGCRL(IWAFR,MMOD)
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
    - Make global cluster relations
   Author   :- a. bonissent june 1995
   
    Establish relations between clusters in a wafer and global cluster
    in a module
     IVIEW = view
     MMOD  = signed module number -24:+24
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   VDXYZT                                                                          
        |---- VMGCRL                                                               
                   |----  NAMIND                              External             
                   |----  VNRDIR                              External             
                   |----  VADEWA                              External             
                   |----  VJMODM                              External             
                   |----  VRMMOD                              External             
                   |----  VAENWA                              External             
                   |----  VCHNST                              External             
                   |----  VFWAFF                              External             
                   |----  VIWFFW                              External             
                   |----  NLINK                               External             
                   |----  AUBOS                               External             
                   |----  RERROR                                                   
   
 
3 VMKR90
         SUBROUTINE VMKR90
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Prepare vmre banks used in hit reconstruction
       For Vdet version '90
   
     A. Bonissent, June 1995
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   VDMPIN                                                                          
        |---- VMKR90                                                               
                   |----  NAMIND                              External             
                   |----  RERROR                                                   
                   |----  VUNADD                              External             
                   |----  VAENWA                              External             
                   |----  NBANK                               External             
   
 
3 VMKR95
         SUBROUTINE VMKR95
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Initialise the package which handles bonding maps
       For Vdet version '95
   
     A. Bonissent, October 1995
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   VDMPIN                                                                          
        |---- VMKR95                                                               
                   |----  ABRUEV                              External             
                   |----  VINIBM                              External             
                   |----  RERROR                                                   
   
 
3 VPREDA
         SUBROUTINE VPREDA
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Prepare data step before reconstruction
      Author    : G. Bagliesi   860910
      Modifiew  : D. Brown 14-5-90
   
      Input      : Minivertex raw data  (VPLH,VHLS banks)
      Output     : Vertex detector final hits and coordinates
   
     Modified 16-1-94 by Dave Brown for the VDET upgrade
     Modified March 1995 A. Bonissent, M. Thulasidas
                    reorganise and debug
      Modified  : Manoj Thulasidas Dec 5, 1994
      New scheme for smearing of MC events
   
      Modified  : Manoj Thulasidas May 15, 1996
      Take out the ad-hoc call to VDMCEF95 which does face suppression
      It has been moved to VDMCEF under the name VDFSUP
   
      Modified  : Alain Bonissent April 1998
                  Skip VDET if VDOK not on
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   RECEVT                                                                          
        |---- VPREDA                                                               
                   |----  ABRUEV                              External             
                   |----  XVDEOK                              External             
                   |----  VDECOD                                                   
                   |----  VDXYZT                                                   
                   |----  VTRLAS                              External             
                   |----  VDNOIS                                                   
                   |----  VDMCEF                                                   
                   |----  RERROR                                                   
                   |----  VDISMR                                                   
   
 
3 VPRPOT
         SUBROUTINE  VPRPOT
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Converts vdco bank in pot output bank pvco
   
       by Hans-Guenther Moser
   
       created:           22/08/88
   
       last modification: 29/08/88
                          15-5-91  D. Brown- remove the code.
                    reorganise and debug
   
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   RDEFPO                                                                          
        |---- VPRPOT.                                                              
   
 
3 VPRSUM
         Subroutine VPRSUM
  ------------------------------------------------------------------------------
    CKEY VGLOB
  ------------------------------------------------------------------------------
   Print end of job statistics for vglob code
     Author:   Paul Rensing   21/11/95
     Modified: Marco Cattaneo 08/07/98
               Improve test on VGLOB execution
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   RSMJOB                                                                          
        |---- VPRSUM                                                               
                   |----  NAMIND                              External             
                   |----  VDYEAR                              External             
                   |----  IW                                  External             
                   |----  FLOAT                               External             
   
 
3 VRECLT
           SUBROUTINE VRECLT(KVFHL,KVFPH,KVFLG,KVCOM,
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
        >                     ILAY,IPHI,IVIEW,IMOD,IWAF)
   Find vdet clusters at low theta
   
      Inputs:
           - IWAF  wafer in module
           - ILAY  LAYER
     15-12-96 A. Bonissent
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   VRECLU                                                                          
        |---- VRECLT                                                               
                   |----  IAND                                External             
                   |----  NAMIND                              External             
                   |----  ABRUEV                              External             
                   |----  GTSTUP                              External             
                   |----  ALGTDB                              External             
                   |----  JUNIDB                              External             
                   |----  VIWFFW                              External             
                   |----  VZERO                               External             
                   |----  VROSTM                              External             
                   |----  VDRSLC                              External             
                   |----  VJWAFM                              External             
                   |----  VABCXY                              External             
                   |----  VWTHCK                              External             
                   |----  VFJFAC                              External             
                   |----  VXYZFC                              External             
                   |----  SQRT                                External             
                   |----  MAX                                 External             
                   |----  MIN                                 External             
                   |----  VCLBNK                                                   
   
 
3 VRECLU
         SUBROUTINE VRECLU(IROMD,NR)
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Select final clusters
   
      Inputs:
           - IROMD       I/  cluster address from VHLS
   
     Modified 16-1-94 by Dave Brown for the VDET upgrade
     Modified March 1995 A. Bonissent, M. Thulasidas
                    reorganise and debug
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   VDECOD                                                                          
        |---- VRECLU                                                               
                   |----  IAND                                External             
                   |----  NAMIND                              External             
                   |----  NLINK                               External             
                   |----  VADEWA                              External             
                   |----  VFWAFF                              External             
                   |----  HFILL                               External             
                   |----  VDYEAR                              External             
                   |----  VRECLT                                                   
                   |----  FLOAT                               External             
                   |----  VIWFFW                              External             
                   |----  VCLBNK                                                   
   
 
3 VSEPAR
         SUBROUTINE VSEPAR(PHCUT,IFST,NSTRP,NCLU,ISTRT,NSCLU)
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Separate merged vdet hits
   
      Author   :- Dave Brown 18-8-91.
   
     This takes as input a VFHL cluster list of pulseheights,
     and checks to see if they are consistent with coming from a
     single cluster.  If not, it attempts to separate into separate
     hits.
   
    This routine is an adaptation of the one extracted from old code.
    A newer and better version was written by D. Brown, but the
    algorithms were slightly changed. For the moment, and for best
    compatibility with the old code, we use this.
    A. Bonissent January 1995
   
     Inputs;    RPULS = Array of pulseheights
                NVCSG = Number of strips in array
                PHCUT = Minimum PH difference to define a significant val
     Outputs;   NCLU  = Number of clusters found (>=1 normally, 0=error)
                ISTRT = Starting strip number for each cluster
                NSCLU = Number of strips for each cluster
   
      NOTE: in case a strip is shared by 2 clusters, it's PH value will
      be REDUCED BY HALF in this routine.
   
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   VDXYZT                                                                          
        |---- VSEPAR                                                               
                   |----  IAND                                External             
                   |----  NAMIND                              External             
                   |----  SORTZV                              External             
                   |----  ABS                                 External             
                   |----  MIN                                 External             
                   |----  MAX                                 External             
                   |----  SQRT                                External             
                   |----  FLOAT                               External             
                   |----  SORTIQ                              External             
   
 
3 VSEPLT
         SUBROUTINE VSEPLT(ILAY,IWAF,IFST,NSTRP,NSEP,SSPOS,PPSUM,
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
        >              IBEG,NSCLU)
   Separate merged vdet hits at low theta
   
      Author   :- A. Bonissent 19-12-95
   
     This takes as input a VFHL cluster list of pulseheights,
     and checks to see if they are consistent with coming from a
     single cluster.  If not, it attempts to separate into separate
     hits.
   
     Inputs;
                ILAY  = Layer
                IWAF  = Wafer in module
                FSTRP = First strip in the cluster
                NSTRP = Number of strips in cluster
     Outputs;
                NSEP  = Number of clusters found (>=1 normally, 0=error)
                SSPOS = Position of each separated cluster
                PPSUM = Pulseheight for each separated cluster
                IBEG  = Starting position of each subcluster
                NSCLU = number of strips in each subcluster
   
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   VDXYZT                                                                          
        |---- VSEPLT                                                               
                   |----  NAMIND                              External             
                   |----  ABRUEV                              External             
                   |----  GTSTUP                              External             
                   |----  ALGTDB                              External             
                   |----  JUNIDB                              External             
                   |----  VROSTM                              External             
                   |----  VZERO                               External             
                   |----  VDRSLC                              External             
                   |----  VJWAFM                              External             
                   |----  VABCXY                              External             
                   |----  SQRT                                External             
                   |----  VJFACI                              External             
                   |----  VXYZFC                              External             
                   |----  VWTHCK                              External             
                   |----  MIN                                 External             
   
 
3 VSLOWC
         SUBROUTINE VSLOWC
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Handle slow control for vdet
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   RUNKNO                                                                          
        |---- VSLOWC.                                                              
   
 
3 VSPXYZ
         INTEGER FUNCTION VSPXYZ(EPOS,IVIEW,ILAY,IFAC,IWFF,NROM,
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
        &                        VUW,XYZ)
   Transform strip position into xyz glob. coordinates
   
      Author   :- A. Bonissent March 1995.
                - updated 11/5/95 Bugfix for wrong NRXYZ
     This Input is the decimal strip number, layer, face view and
     wafer number. Returns NRXYZ and global position
   
     Correct coordinate for additional bonding problems (VRECOR)
                                 July 1998
     Correct the correction above, do that it applies only to real data
                                 May 1999
   
     Inputs;
                  EPOS = decimal strip number
                  IVIEW= view
                  ILAY = layer
                  IFAC = face
                  IWFF = wafer in face
                  NROM = encoded resdout module number
   
     Outputs;
                  VUW  = local coordinate
                  XYZ  = global coordinate
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
              VSPXYZ                                                               
                   |----  VJWFFW                              External             
                   |----  VZERO                               External             
                   |----  VDYEAR                              External             
                   |----  VNRDIR                              External             
                   |----  VNSCRM                              External             
                   |----  VDRSPS                              External             
                   |----  VDPSLC                              External             
                   |----  VRECOR                              External             
                   |----  VABCVU                              External             
                   |----  VGWFXY                              External             
   
 
3 VSTRIM
         SUBROUTINE VSTRIM(ISTRP,MSTRP,ISTRT,ISTOP)
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Cleanup a raw hit for the hardware vagaries of the tpd
   
    This routine trims off non-physical strips from a MVD cluster
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
              VSTRIM                                                               
                   |----  MOD                                 External             
   
 
3 VTRSUP
         SUBROUTINE VTRSUP(IROMD)
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Update the vtrs bank
   
    Bank VTRS contains the relations between VDET electronic channels
    and monte carlo tracks. For VDET95, we demultiplex the strips
    before clustering. VTRS now needs to contain the readout strip
    address. Has to be done now that we have the relation between
    el. chann. and R/O strips in bank VCSG
    A. Bonissent June 1995
    INPUT  :
        IROMD   :  Readout module address
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   VDSM95                                                                          
        |---- VTRSUP                                                               
                   |----  NAMIND                              External             
                   |----  NLINK                               External             
                   |----  VADEWA                              External             
                   |----  VFWAFF                              External             
                   |----  VUNADD                              External             
                   |----  VIWFFW                              External             
                   |----  VPKADD                              External             
   
 
3 VTRURL
         SUBROUTINE VTRURL(IKOD,IBN,ICLS,NHXYZ,NRVS,NMAX,
  ------------------------------------------------------------------------------
    CKEY V_DECK VDET
  ------------------------------------------------------------------------------
        &                  NMATC,ITIND,NSTR,QFRAC,IERR)
   Supplies truth information for reconstructed hits from vfph
   - Author: Alain Bonissent (Nov 1994)
    Modified November 1996, handle properly strips which
                   belong to two clusters (after splitting)
    INPUTS:
    ------
    = Type of relation wanted
          1 or any nb = Relation to VDHT
          2 = Relation to FRFT
   BN    - Bank number for VFPH and VFHL linking
     - Hit number
    = Row number in hits bank of the hit
     = NR of the relevant VTRS bank
   AX  = max number of allowed matched tracks
   
   --------
   ATC:   Number of matching tracks
      Index of matched tracks
     = Array of number of strips in which
           each track has deposited charge
   AC = Charge deposited by each track (array)
     = return code (0=OK)
      Banks used: VFPH,VFHL,FPOI,FKIN,VTRS
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   VDGTHT                                                                          
   VDMCTR                                                                          
   VUMCTR                                                                          
        |---- VTRURL                                                               
                   |----  NAMIND                              External             
                   |----  VZERO                               External             
                   |----  NLINK                               External             
                   |----  VUNADD                              External             
                   |----  MAX                                 External             
                   |----  VPKADD                              External             
                   |----  MIN                                 External             
   
 
3 VUMCTR
         SUBROUTINE VUMCTR(IERR)
  ------------------------------------------------------------------------------
    CKEY V_DECK VDET
  ------------------------------------------------------------------------------
   Unpack vdet history bank
   -  Author: Alain Bonissent (Nov 1994)
    Modified November 1996 A. Bonissent, handle properly strips which
                                    belong to two clusters (after splitting)
     RETURN CODES: IERR=-1,-2 MISSING BANKS,
                        -3 : Could not booK VUFK,
                         0 OK
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   VDMCTR                                                                          
        |---- VUMCTR                                                               
                   |----  NAMIND                              External             
                   |----  BDROP                               External             
                   |----  AUBOS                               External             
                   |----  VTRURL                                                   
                   |----  AUBPRS                              External             
   

2 VGLOB

  >>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>
    CKEY 
     1st entry in vglob_set
     ! JULIA 305
        VFTALL,VGBRAN,VGBRUT,VGFEVT,VGTCUT,VMCHIP,VMCLLD : fix variable 
                 type inconsistencies in function calls, for Linux    (A.Waananen)
    
     ! JULIA 304
        VFTALL : Tracks identified as originating at a secondary vertex 
                 have their errors and energy loss propagated only to the 
                 corresponding point.                                  (D.Casper)
    
     *JULIA 303 correction file no 7
        VFTALL : Do not generate "Fatal" error if no track banks found (D.Casper)
    
     *JULIA 303 correction file no 3
        VGLINK : Create FXTR if it doesn't exist; primarily to 
                 facilitate ALPHA interface                     (D.Casper)
    
     ! JULIA 303
        New package in JULIA to do VDET global pattern recognition in the context
        of the tracking upgrade. The package is called as an option in JULIA, by
        adding the steering card VGLO.
    
        IMPORTANT NOTE. This software is currently not officially supported in
        Aleph, since its authors (P.Rensing, J-F.Pusztaszeri) have left and noone
        has been found to take over responsibility.
    
  <<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<
     VADDIA     Add value val to bank ind.
     VDBLHT     Retroactively change the error when you find a double hit
     VFNDIL     Find val in the list ind and return its index
     VFTALL     Refit all the tracks with kalman, including ms to origin
     VGBRAN     Solve a large component of the vdet pat. rec. by  branch and bound
     VGBRUT     Try to solve a vdet pat. rec. component by "brute force."
     VGCMBV     Merge list of hits from both views and check for feasibility
     VGCOMP     Create a list of components for the global vdet pat. rec.
     VGFEVT     Clean up after all vdet pattern recognition is done for event.
     VGINIT     Initialize variables for vdet global pattern recognition
     VGLINK     Steering routine for vdet global pattern recognition
     VGLOB      Vdet global pattern recognition
     VGNEVT     Create the new banks that will be filled by the vdet pattern recognition
     VGSOLV     Find the best solution for all vdet pat. rec. components.
     VGSTOR     Create the vdet hit banks for a solution to the vdet pat. rec.
     VGTCUT     Remove tracks from components based on size of extrapolation footprint
     VHERR      Compute the vdet hit error, based on a parameterization of the data
     VHITID     Map packed wafer/hit to unique hit id
     VHMAP      Create a map of hit to track for the vdet global pat. rec.
     VHUPCK     Unpack the wafer number and hit number from a unique id
     VHUPRM     Unpack and transform to an address in the vdxy or vdzt bank
     VKAERR     Compute the error for the kalman fit of a vdet hit for a given track
     VM1TRK     Find all reasonable combinations of vdet hits for each track.
     VMCHIP     Calculate one-pass kalman chisquared for full vdet combinations
     VMCHIS     Calculate simple chisquared for 2-layer vdet combinations
     VMCLLD     Collect vdet hits within a given area around a track
     VMOVER     Compress vdet overlap hits into an effective hit
     VMUPDT     Update the vm5c bank by removing rows
     VPKSLN     Pick the vdet pat. rec. soln from the list of possibilities
     VSLTRK     Select good outer tracks for use in vdet pattern recognition
     VTEREX     Expand the vter error matrix into 8x8 form

3 VADDIA
         SUBROUTINE VADDIA(IND, VAL, ADDED)
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Add value val to bank ind.
        Paul Rensing   - 1-11-94
   ADDIA expects IND to point to a BOS bank. The bank is first checked
       if VAL is already in the bank (see VFNDIL). If not, a new row is
       created with VAL in the first column. The bank may be extended
       but NO garbage collection is allowed. ADDED is returned .TRUE. if
       the element was added, .FALSE. otherwise.
    Also: VFNDIL
    INPUT:
       INTEGER IND   - bank index
       INTEGER VAL   - integer value
   
       INTEGER IND   - may be changed if item is added
       LOGICAL ADDED - .TRUE. if VAL was added to list
       Bank (IND) may be modified
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   VGCOMP                                                                          
   VHMAP                                                                           
   VMCLLD                                                                          
        |---- VADDIA                                                               
                   |----  VFNDIL                                                   
                   |----  CHAINT                              External             
                   |----  RERROR                                                   
   
 
3 VDBLHT
         SUBROUTINE VDblHt(View, Wafer, Hit)
  ------------------------------------------------------------------------------
    CKEY VGLOB VDET TRACK
  ------------------------------------------------------------------------------
   Retroactively change the error when you find a double hit
     Author:   Paul Rensing    4-5-95
    you have a double hit in the VDet, the hit uncertainty is
       larger. This routine finds all VDCO entries which use the given
       hit, and changes the uncertainty.
   
      integer View   - 1=z, 2=r-phi
      integer wafer  - the wafer number
      integer hit    - the hit number
   
      the VDCO bank is modified.
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   VGSTOR                                                                          
        |---- VDBLHT                                                               
                   |----  NAMIND                              External             
                   |----  VRMWF                               External             
                   |----  RERROR                                                   
                   |----  NLINK                               External             
   
 
3 VFNDIL
         SUBROUTINE VFNDIL( IND, VAL, LOC)
  ------------------------------------------------------------------------------
    CKEY VGLOB
  ------------------------------------------------------------------------------
   Find val in the list ind and return its index
        Paul Rensing   - 2-11-94
    expects IND to point to a BOS bank. It searches the bank for
       value VAL in the first column and returns the row number. It
       returns -1 if VAL is not found.
    INPUT:
      INTEGER VAL     - value to find
      INTEGER IND     - BOS index of bank
   
      INTEGER LOC     - index (row) of VAL in the bank
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   VADDIA                                                                          
   VGBRAN                                                                          
        |---- VFNDIL.                                                              
   
 
3 VFTALL
         SUBROUTINE VFtAll(FIELD, IFRFT, ISWIM)
  ------------------------------------------------------------------------------
    CKEY VGLOB VDET TRACK
  ------------------------------------------------------------------------------
   Refit all the tracks with kalman, including ms to origin
        Paul Rensing   - 4-5-95
    through all the tracks in the given FRFT bank and refit them. If
       a fit fails, use the existing fit, but add the extra uncertainty
       due to propogating the track from the last point to the origin.
       (if ISWIM = 1)
    identified as originating at a secondary vertex have their
    and energy loss propagated only to the corresponding point.
    INPUT:
       REAL FIELD - the magnetic field
       INTEGER IFRFT - the FRFT bank number to fill
       INTEGER ISWIM - swim flag for Kalman
                         0 = helix at innermost co-ordinate
                         1 = helix at origin of co-ordinate system
   
        FRFT number IFRFT is modified
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   VGLINK                                                                          
        |---- VFTALL                                                               
                   |----  NAMIND                              External             
                   |----  NLINK                               External             
                   |----  RERROR                                                   
                   |----  UFSWIM                              External             
                   |----  ITABL                               External             
                   |----  UFTRAD                              External             
                   |----  NDROP                               External             
                   |----  VDMSUP2                                                  
                   |----  UFTMSO                              External             
                   |----  SORTI                               External             
                   |----  AUBPRS                              External             
   
 
3 VGBRAN
         SUBROUTINE VGBRAN(ICOMP)
  ------------------------------------------------------------------------------
    CKEY VGLOB VDET TRACK
  ------------------------------------------------------------------------------
   Solve a large component of the vdet pat. rec. by  branch and bound
        Paul Rensing   - 1-11-94
    component # ICOMP is solved by the branch and bound
        algorithm. This routine creates a set of arrays which are used
        by the C routine which solves the problem. Once solved it builds
        the output banks.
    INPUT:
        INTEGER ICOMP     - the number of the component to solve
   
        Banks VGHC and VGXC # ICOMP are created.
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   VGSOLV                                                                          
        |---- VGBRAN                                                               
                   |----  NAMIND                              External             
                   |----  NLINK                               External             
                   |----  LROWS                               External             
                   |----  ABRUEV                              External             
                   |----  VDYEAR                              External             
                   |----  RERROR                                                   
                   |----  NBANK                               External             
                   |----  MAX                                 External             
                   |----  VZERO                               External             
                   |----  VHITID                                                   
                   |----  VFNDIL                                                   
                   |----  INDHIT                              External             
                   |----  NHITS                               External             
                   |----  VGBSLV                              External             
                   |----  NDROP                               External             
                   |----  BDROP                               External             
   
 
3 VGBRUT
         SUBROUTINE VGBRUT(ICOMP, SOLVED)
  ------------------------------------------------------------------------------
    CKEY VGLOB VDET TRACK
  ------------------------------------------------------------------------------
   Try to solve a vdet pat. rec. component by "brute force."
        Paul Rensing   - 29-3-95
    routine solves the combinatorial problem by "brute force",
        ie. complete enumeration. However, it first checks if the
        component is "diagonal", that is, the obvious solution is
        feasible and is therefore the solution. If so, it simplely
        produces a single solution and returns. If the component is
        small enough, it finds all solutions (maximum number MAXSOLN)
        which are with FINALPRB of the best.
    INPUT:
        INTEGER ICOMP    - the number of the component to solve
   
        LOGICAL SOLVED   - .TRUE. if solved
        Banks VGHC and VGXC, NR=ICOMP are created if SOLVED is .TRUE.
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   VGSOLV                                                                          
        |---- VGBRUT                                                               
                   |----  NAMIND                              External             
                   |----  VDYEAR                              External             
                   |----  RERROR                                                   
                   |----  NLINK                               External             
                   |----  NBANK                               External             
                   |----  VZERO                               External             
                   |----  ABRUEV                              External             
                   |----  FLOAT                               External             
                   |----  VHITID                                                   
                   |----  VHUPRM                                                   
                   |----  MOD                                 External             
                   |----  RTABL                               External             
                   |----  MIN                                 External             
                   |----  SORTRQ                              External             
                   |----  ITABL                               External             
                   |----  NDROP                               External             
                   |----  BDROP                               External             
   
 
3 VGCMBV
         subroutine vgcmbv(wHits, uHits, hits, ucols, good)
  ------------------------------------------------------------------------------
    CKEY VGLOB VDET TRACK
  ------------------------------------------------------------------------------
   Merge list of hits from both views and check for feasibility
    Author      : P. Rensing  27-8-95
    routine is passed the lists of hits (packed bank number + row number)
      for the two views. It produces a single list of hits (4 (w,u) pairs)
      and checks if the set is feasible, ie. that it was physically possible.
    INPUTS:
      INTEGER wHits(4)    = List of w (ie. z) hits
      INTEGER uHits(4)    = List of u (ie. r-phi) hits
    OUTPUTS:
      INTEGER hits(8)     = merged list of hits ( (w,u) pairs)
      INTEGER ucols(4)     = column number for each U hit
      LOGICAL good        = .TRUE. is this set of hits could be from 1 track
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   VMCHIP                                                                          
        |---- VGCMBV                                                               
                   |----  WHITS                               External             
                   |----  VHUPRM                                                   
                   |----  VHUPCK                                                   
   
 
3 VGCOMP
         SUBROUTINE VGCOMP(CompOffset, SelFlag)
  ------------------------------------------------------------------------------
    CKEY VGLOB VDET TRACK
  ------------------------------------------------------------------------------
   Create a list of components for the global vdet pat. rec.
        Paul Rensing   - 1-11-94
    from the VM5C and VHMP banks, determine the lists of which
       tracks belong in each component. The VCTL banks holds the list of
       tracks (FRFT #) that are part of the component, while VCHx holds
       the unique list of hits in layer x in the component.
    INPUT:
      integer CompOffset  - offset for numbering the components
      integer SelFlag     - track selection flag
      VM5C banks
   
      VCTL, VCHx banks; x=1-4
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   VGLOB                                                                           
        |---- VGCOMP                                                               
                   |----  NAMIND                              External             
                   |----  BDROP                               External             
                   |----  RERROR                                                   
                   |----  VHMAP                                                    
                   |----  NBANK                               External             
                   |----  VZERO                               External             
                   |----  IW                                  External             
                   |----  VHITID                                                   
                   |----  VADDIA                                                   
                   |----  NLINK                               External             
                   |----  VGTCUT                                                   
                   |----  ABRUEV                              External             
                   |----  BPRTAB                              External             
   
 
3 VGFEVT
         SUBROUTINE VGFEVT
  ------------------------------------------------------------------------------
    CKEY VGLOB VDET TRACK
  ------------------------------------------------------------------------------
   Clean up after all vdet pattern recognition is done for event.
        Paul Rensing   - 21-6-95
    VDet pattern recognition cleanup. Change all NAss in VDXY/VDZT
       to abs(NAss).
   
        VDXY, VDZT are modified
        VDCO, FVCL are shrunk to size
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   VGLINK                                                                          
        |---- VGFEVT                                                               
                   |----  NAMVDXZ                             External             
                   |----  NAMIND                              External             
                   |----  NLINK                               External             
                   |----  NBANK                               External             
                   |----  BDROP                               External             
                   |----  ABS                                 External             
                   |----  VDYEAR                              External             
   
 
3 VGINIT
         SUBROUTINE VGINIT
  ------------------------------------------------------------------------------
    CKEY VGLOB
  ------------------------------------------------------------------------------
   Initialize variables for vdet global pattern recognition
    Author      : Paul Rensing 6-2-95
    Modified    : Dave Casper 17-4-97  Initialize VGLB from database
    INPUTS:
      Bank VGLB from dbase or cards
    OUTPUTS:
      Common block VGLBCM is initialized.
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   VGLINK                                                                          
        |---- VGINIT                                                               
                   |----  NAMIND                              External             
                   |----  ABRUEV                              External             
                   |----  GTSTUP                              External             
                   |----  ALGTDB                              External             
                   |----  JUNIDB                              External             
                   |----  IW                                  External             
   
 
3 VGLINK
         SUBROUTINE VGLINK
  ------------------------------------------------------------------------------
    CKEY VGLOB VDET TRACK
  ------------------------------------------------------------------------------
   Steering routine for vdet global pattern recognition
     Author: Paul Rensing   4-5-95
     Modified: Dave Casper  17-6-97  Create FXTR if it doesn't exist;
                                     primarily to facilitate ALPHA interface
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   RECEVT                                                                          
        |---- VGLINK                                                               
                   |----  ABRUEV                              External             
                   |----  VGINIT                                                   
                   |----  NAMIND                              External             
                   |----  PJPFXT                              External             
                   |----  RERROR                                                   
                   |----  TIMEX                               External             
                   |----  VGNEVT                                                   
                   |----  VSLTRK                                                   
                   |----  VTRKEX                              External             
                   |----  VGLOB                                                    
                   |----  VFTALL                                                   
                   |----  VGFEVT                                                   
                   |----  VDMCTR                                                   
   
 
3 VGLOB
         SUBROUTINE VGLOB(FIELD, SELFLAG)
  ------------------------------------------------------------------------------
    CKEY VGLOB VDET TRACK
  ------------------------------------------------------------------------------
   Vdet global pattern recognition
    Author      : D. Brown 12-11-94
    INPUTS:
       REAL FIELD       = Magnetic field
       INTEGER SELFLAG  = track selection flag (col 4 in FXTR)
       bank FRFT, 0
    OUTPUTS:
       VGHC and VGXC banks for this set of tracks. First new bank is
           numbered 1 higher than existing banks.
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   VGLINK                                                                          
        |---- VGLOB                                                                
                   |----  NAMIND                              External             
                   |----  UFTFIL                              External             
                   |----  VM1TRK                                                   
                   |----  VGCOMP                                                   
                   |----  VGSOLV                                                   
                   |----  NLINK                               External             
                   |----  VPKSLN                                                   
                   |----  VGSTOR                                                   
                   |----  BDROP                               External             
   
 
3 VGNEVT
         SUBROUTINE VGNEVT(IFRFT)
  ------------------------------------------------------------------------------
    CKEY VGLOB VDET TRACK
  ------------------------------------------------------------------------------
   Create the new banks that will be filled by the vdet pattern recognition
        Paul Rensing   - 4-5-95
    the new banks (FRFT, VDCO, FVCL) that are filled by the VDet
       pattern recognition. Also, clear the number of assignments in the
       VDXY and VDZT banks. This should be called only once per event at
       the start of the VDet pattern recognition.
    INPUT:
        INTEGER IFRFT  - the bank number for the new frft bank
   
        FRFT number IFRFT, VDCO, FVCL are created.
        VDXY, VDZT are modified
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   VGLINK                                                                          
        |---- VGNEVT                                                               
                   |----  NAMIND                              External             
                   |----  BDROP                               External             
                   |----  BLIST                               External             
                   |----  VDYEAR                              External             
                   |----  NBANK                               External             
                   |----  RERROR                                                   
                   |----  BOSBK                               External             
                   |----  UCOPY                               External             
   
 
3 VGSOLV
         SUBROUTINE VGSolv
  ------------------------------------------------------------------------------
    CKEY VGLOB VDET TRACK
  ------------------------------------------------------------------------------
   Find the best solution for all vdet pat. rec. components.
        Paul Rensing   - 1-11-94
    over all VCTL banks and call VGBRUT or VGBRAN to solve each one.
    INPUT:
        none
   
        Solution banks VGXC and VGHC are created.
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   VGLOB                                                                           
        |---- VGSOLV                                                               
                   |----  NAMIND                              External             
                   |----  TIMEX                               External             
                   |----  VGBRUT                                                   
                   |----  IW                                  External             
                   |----  VGBRAN                                                   
   
 
3 VGSTOR
         SUBROUTINE VGSTOR(ICOMP, ISOLN)
  ------------------------------------------------------------------------------
    CKEY VGLOB VDET TRACK
  ------------------------------------------------------------------------------
   Create the vdet hit banks for a solution to the vdet pat. rec.
        Paul Rensing   - 4-5-95
        Dave Casper    - 3-6-96  make VCPL tabular by removing unneeded
                                 rows when finished
    the VDCO, VCPL, FVCL banks with the hits that represent a
       solution found by the VDet global pattern recognition. FRTL is
       modified with the number of hits found. The FRFT bank is NOT
       modified by this routine.
    INPUT:
       INTEGER IComp - the component number
       INTEGER ISoln - the solution number to use
   
        VDCO and FVCL are modified and may be lengthened
        VCPL banks are created (one for each track)
        FRTL is modified
        VDXY, VDZT banks are modified
        VDGC bank is modified (VDET 95 only)
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   VGLOB                                                                           
        |---- VGSTOR                                                               
                   |----  NAMIND                              External             
                   |----  NLINK                               External             
                   |----  RERROR                                                   
                   |----  ITABL                               External             
                   |----  VDYEAR                              External             
                   |----  NBANK                               External             
                   |----  VHUPCK                                                   
                   |----  VRMWF                               External             
                   |----  KNEXT                               External             
                   |----  LROWS                               External             
                   |----  VKAERR                                                   
                   |----  SQRT                                External             
                   |----  ATAN2                               External             
                   |----  VDBLHT                                                   
                   |----  ABS                                 External             
                   |----  KROW                                External             
                   |----  AUBPRS                              External             
   
 
3 VGTCUT
         Subroutine VGTCUT(NTrk, Trks, FootCut, NRemove, RmList)
  ------------------------------------------------------------------------------
    CKEY VDET TRACK
  ------------------------------------------------------------------------------
   Remove tracks from components based on size of extrapolation footprint
    Author      : P. Rensing  16-5-95
    routine takes an array of track numbers, assumed to be a VGLOB
        component, and creates a list of those whose extrapolation
        footprint (in r-phi direction) is much larger than the smallest
        in the component.
    INPUTS:
      INTEGER NTRK      = number of tracks
      INTEGER TRKS(*)   = FRFT track number
      REAL FootCut      = ratio between footprints at which to cut
    OUTPUTS:
      INTEGER NREMOVE   = number of tracks to remove
      INTEGER RMLIST(*) = list of tracks to remove
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   VGCOMP                                                                          
        |---- VGTCUT                                                               
                   |----  NAMIND                              External             
                   |----  NBANK                               External             
                   |----  RERROR                                                   
                   |----  NLINK                               External             
                   |----  NDROP                               External             
   
 
3 VHERR
         SUBROUTINE VHERR(IVIEW,PVEC,PH,VERR)
  ------------------------------------------------------------------------------
    CKEY VGLOB VDET TRACK
  ------------------------------------------------------------------------------
   Compute the vdet hit error, based on a parameterization of the data
        D.Brown - 8-9-94
    INPUT;  IVIEW   = View flag; 1 = W, 2 = U
            PVEC(3) = track momentum vector at wafer in wafer frame
            PH      = Pulseheight in normalized units
   ;  VERR    = hit error
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   VKAERR                                                                          
   VMCLLD                                                                          
        |---- VHERR                                                                
                   |----  ABS                                 External             
                   |----  SQRT                                External             
   
 
3 VHITID
         SUBROUTINE VHITID(wafHit, view, hitID)
  ------------------------------------------------------------------------------
    CKEY VGLOB VDET
  ------------------------------------------------------------------------------
   Map packed wafer/hit to unique hit id
        Paul Rensing   - 28-8-95
    a packed wafer number / hit number (see VHPCK), return a unique
       ID for the hit. This is the cluster number within the event, so it
       is a reasonable array index.
    INPUT:
         integer wafHit   - the packed wafer,hit numbers
         integer view     - the view ( 1 = Z, 2 = r/phi )
   
         integer hitID    - hit id
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   VGBRAN                                                                          
   VGBRUT                                                                          
   VGCOMP                                                                          
   VHMAP                                                                           
        |---- VHITID                                                               
                   |----  VHUPRM                                                   
                   |----  NLINK                               External             
                   |----  RERROR                                                   
   
 
3 VHMAP
         SUBROUTINE VHMAP(SelFlag)
  ------------------------------------------------------------------------------
    CKEY VGLOB VDET TRACK
  ------------------------------------------------------------------------------
   Create a map of hit to track for the vdet global pat. rec.
        Paul Rensing   - 1-11-94
    the set of track indicated by flag SelFlag (column 4 in FXTR),
        create the set of VHMx banks which map hits to tracks.
    :
        INTEGER SelFlag  = track selection flag
   
        Bank VHMx are created, x = 1-4
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   VGCOMP                                                                          
        |---- VHMAP                                                                
                   |----  NAMIND                              External             
                   |----  RERROR                                                   
                   |----  VHITID                                                   
                   |----  NLINK                               External             
                   |----  NBANK                               External             
                   |----  VADDIA                                                   
   
 
3 VHUPCK
         SUBROUTINE VHUPCK(ID, WAFER, IHIT)
  ------------------------------------------------------------------------------
    CKEY VGLOB VDET TRACK
  ------------------------------------------------------------------------------
   Unpack the wafer number and hit number from a unique id
        Paul Rensing   - 1-11-94
    INPUT:  integer ID    - pack hit ID
     integer WAFER - VDet wafer number
            integer IHIT  - hit number within wafer
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   VGCMBV                                                                          
   VGSTOR                                                                          
   VHUPRM                                                                          
   VMCHIP                                                                          
   VMCHIS                                                                          
   VMOVER                                                                          
        |---- VHUPCK.                                                              
   
 
3 VHUPRM
           subroutine vhuprm(id, view, hit, bank)
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Unpack and transform to an address in the vdxy or vdzt bank
         Author:  D. Casper      24/04/97
    INPUT:  integer ID    - pack hit ID
            integer VIEW  - 1=w, 2=v
     integer HIT   - hit number within wafer
            integer BANK  - encoded readout module address
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   VGBRUT                                                                          
   VGCMBV                                                                          
   VHITID                                                                          
   VMUPDT                                                                          
        |---- VHUPRM                                                               
                   |----  VHUPCK                                                   
                   |----  VRMWF                               External             
   
 
3 VKAERR
         SUBROUTINE VKAERR(TRK, WAFER, WHIT, UHIT,
  ------------------------------------------------------------------------------
    CKEY VGLOB VDET TRACK
  ------------------------------------------------------------------------------
        $     vuw, xyz, uErr2, zErr2, WNPulH, UNPulH)
   Compute the error for the kalman fit of a vdet hit for a given track
        Paul Rensing   - 21-11-94
    a hit specified by wafer number and hit number, compute the
       error needed by the Kalman filter.
    INPUT:
      integer trk      - FRFT track number
      integer wafer    - wafer number
      integer whit     - w wafer hit number; 0 means no hit
      integer uhit     - u wafer hit number; 0 means no hit
   
      real vuw(3)      - local wafer coordinates of the hit
                          extrapolation point is used for missing hits
      real xyz(3)      - global coordinates of hit
      real uErr2       - the r-phi error**2 used by the Kalman
      real ZErr2       - the z error**2 used by the Kalman
      real WNPulH      - the w hit's normalized pulse height
      real UNPulH      - the u hit's normalized pulse height
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   VGSTOR                                                                          
   VMCHIP                                                                          
        |---- VKAERR                                                               
                   |----  MAX                                 External             
                   |----  NAMIND                              External             
                   |----  VDYEAR                              External             
                   |----  NLINK                               External             
                   |----  RERROR                                                   
                   |----  VADEWA                              External             
                   |----  VTXNWT                              External             
                   |----  UW                                  External             
                   |----  VRMWF                               External             
                   |----  ABS                                 External             
                   |----  VHERR1                              External             
                   |----  VHERR                                                    
                   |----  VGWFXY                              External             
                   |----  VGWFVU                              External             
                   |----  ATAN2                               External             
                   |----  VUW                                 External             
                   |----  COS                                 External             
                   |----  SIN                                 External             
   
 
3 VM1TRK
         SUBROUTINE VM1TRK(FIELD, SelFlag, UseKal)
  ------------------------------------------------------------------------------
    CKEY VGLOB VDET TRACK
  ------------------------------------------------------------------------------
   Find all reasonable combinations of vdet hits for each track.
    Author      : D. Brown 3-11-94
                  P. Rensing
    routine takes in the FRFT,0 bank and creates for each properly
       flagged track a set of all possible associated VDET hits. Patterns
       are kept whose change in chisquared for the kalman fit with the
       new hits is less than a given cut. Appropriate penalties are
       applied for missing hits.
    INPUTS:
      READ FIELD       = Value of the magnetic field
      INTEGER SelFlag  = Track selection flag (col 4 in FXTR)
      LOGICAL UseKal   = if .FALSE., do not use Kalman
    OUTPUTS:
      VM5C bank  for each flagged track, bank # = FRFT row #
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   VGLOB                                                                           
        |---- VM1TRK                                                               
                   |----  NAMIND                              External             
                   |----  TIMEX                               External             
                   |----  BDROP                               External             
                   |----  RERROR                                                   
                   |----  NLINK                               External             
                   |----  VMUPDT                                                   
                   |----  VADEWA                              External             
                   |----  VTEREX                                                   
                   |----  VMCLLD                                                   
                   |----  VMCHIS                                                   
                   |----  VMCHIP                                                   
                   |----  ABRUEV                              External             
                   |----  IW                                  External             
                   |----  BPRTAB                              External             
   
 
3 VMCHIP
         SUBROUTINE VMCHIP(FIELD,ITRK)
  ------------------------------------------------------------------------------
    CKEY VGLOB VDET TRACK
  ------------------------------------------------------------------------------
   Calculate one-pass kalman chisquared for full vdet combinations
    Author      : P. Rensing  27-3-95
    routine takes as input the existing VMUC and VMWC banks for a
       track, and computes the Kalman chi^2 for all permutations, using
       the special VDET pattern recognition mode of the Kalman
       filter. Some cuts are made on the number of hits assigned to
       reduce backgrounds. The list of acceptable combinations is then
       trimmed to a reasonable number.
    INPUTS:
      REAL FIELD          = Magnetic field
      INTEGER ITRK        = FRFT track row
      bank VMUC and VMWC (num=itrk)
    OUTPUTS:
      VM5C bank (NR=itrk)
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   VM1TRK                                                                          
        |---- VMCHIP                                                               
                   |----  NAMIND                              External             
                   |----  RERROR                                                   
                   |----  NLINK                               External             
                   |----  NBANK                               External             
                   |----  VDMSUP2                                                  
                   |----  UFVDIN                              External             
                   |----  UFVDOU                              External             
                   |----  VGCMBV                                                   
                   |----  VHUPCK                                                   
                   |----  VKAERR                                                   
                   |----  WAFER                               External             
                   |----  SQRT                                External             
                   |----  XYZ                                 External             
                   |----  VUW                                 External             
                   |----  SORTRQ                              External             
                   |----  MIN                                 External             
                   |----  UCOPY                               External             
                   |----  VZERO                               External             
   
 
3 VMCHIS
         SUBROUTINE VMCHIS(ITRK, IVIEW, ERRMAT)
  ------------------------------------------------------------------------------
    CKEY VGLOB VDET TRACK
  ------------------------------------------------------------------------------
   Calculate simple chisquared for 2-layer vdet combinations
    Author      : D. Brown 7-11-94
     This routine takes as input the two VMTC banks (1 for each layer)
     of matched hits for a given track.  It loops explicitly over all
     possible combinations, and computes the chisquared of their association.
     The chisquared is computed in a simple way, using the track
     error matrix.
    INPUTS:
      INTEGER ITRK     = FRFT track row
      INTEGER IVIEW    = View being considered, 1=Z, 2=rho-phi
      REAL ERRMAT(8,8) = Error matrix of a track in each of the intersected
                         wafers, with full correlations.  This should include
                         the intrinsic hit errors as well
      banks VMTC 1 and 2
    OUTPUTS:
      VMWC or VMUC bank, # itrk, depending on the view
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   VM1TRK                                                                          
        |---- VMCHIS                                                               
                   |----  NLINK                               External             
                   |----  RERROR                                                   
                   |----  VADEWA                              External             
                   |----  MAX                                 External             
                   |----  NBANK                               External             
                   |----  VHUPCK                                                   
                   |----  IADDVEC                             External             
                   |----  ERR                                 External             
                   |----  DSINV                               External             
                   |----  ABRUEV                              External             
                   |----  NAMIND                              External             
                   |----  BNAMES                              External             
                   |----  IW                                  External             
                   |----  RESVEC                              External             
                   |----  VZERO                               External             
                   |----  BPRTAB                              External             
                   |----  LROWS                               External             
   
 
3 VMCLLD
         SUBROUTINE VMCLLD(ITRK,VIEW,ERRMAT)
  ------------------------------------------------------------------------------
    CKEY VGLOB VDET TRACK
  ------------------------------------------------------------------------------
   Collect vdet hits within a given area around a track
    Author      : A. Bazarko 31-Oct-94
     This routine creates a VMTC bank, which is the collection
     of VDET hits within a road of specified size per
     VDET layer. (VMTC bank number = VDET layer number)
     Calls VMOVER which combines hits in the wafer overlap
     regions to create so-called eta hits.
    INPUTS:
      INTEGER ITRK     = FRFT track number
      INTEGER VIEW     = Flag specifying which view to consider
                           1 if in z (W); 2 if in r-phi (U);
      REAL ERRMAT(8,8) = Error matrix of the track extrapolation
    OUTPUTS:
      VMTC banks 1, 2
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   VM1TRK                                                                          
        |---- VMCLLD                                                               
                   |----  NAMIND                              External             
                   |----  VDYEAR                              External             
                   |----  RERROR                                                   
                   |----  NLINK                               External             
                   |----  NBANK                               External             
                   |----  BOSBK                               External             
                   |----  VZERO                               External             
                   |----  VNRWAF                              External             
                   |----  VNRMOD                              External             
                   |----  VRMWF                               External             
                   |----  VADDIA                                                   
                   |----  VADEWA                              External             
                   |----  MAX                                 External             
                   |----  MIN                                 External             
                   |----  VAENWA                              External             
                   |----  VTXNWT                              External             
                   |----  HITBNK                              External             
                   |----  SQRT                                External             
                   |----  ABS                                 External             
                   |----  IAND                                External             
                   |----  VHERR1                              External             
                   |----  VHERR                                                    
                   |----  VMOVER                                                   
                   |----  ABRUEV                              External             
                   |----  BPRTAB                              External             
                   |----  INDVMTC                             External             
                   |----  LROWS                               External             
                   |----  BDROP                               External             
   
 
3 VMOVER
         SUBROUTINE VMOVER(View, LAYer, ERRMAT, IROWS)
  ------------------------------------------------------------------------------
    CKEY VDET TRACK
  ------------------------------------------------------------------------------
   Compress vdet overlap hits into an effective hit
    Author      : D. Brown 30-10-94
     This routine finds the VMTC bank indicated by ILAY and
     searches the list of matched hits for hits in different
     wafers.  If any are found, all possible combinations of
     hits in the different layers are cross-checked against each other
     to see if they are consistant with being an overlap hit.
     If they are consistant, the compound hit is then entered as
     a new row in VMTC, and the single hits which comprise them
     are modified so that their missing companion is a NULL hit
     instead of a missing hit.
    INPUTS:
      Layer       = VDET layer number (1 or 2)
      ERRMAT(8,8) = Error matrix of a track in each of the intersected
                    wafers, with full correlations.  This should include
                    the intrinsic hit errors as well
      IROWS(2)    = Row pointers in ERRMAT to the 2 wafers being considered
                    as possibly having overlap hits
    OUTPUTS:
              VMTC bank is (possibly) modified
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   VMCLLD                                                                          
        |---- VMOVER                                                               
                   |----  NLINK                               External             
                   |----  RERROR                                                   
                   |----  VHUPCK                                                   
                   |----  ITABL                               External             
                   |----  VADEWA                              External             
                   |----  DSINV                               External             
   
 
3 VMUPDT
         Subroutine VMUpDt(Trk)
  ------------------------------------------------------------------------------
    CKEY VDET TRACK
  ------------------------------------------------------------------------------
   Update the vm5c bank by removing rows
    Author      : P. Rensing  16-5-95
    routine takes as input the existing VM5C bank for a
       track, and removes rows which are no longer valid. Rows can become
       invalid because the hits used have already been assigned.
    INPUTS:
      Trk        = FRFT track row
      bank VM5C (num=itrk)
    OUTPUTS:
      VM5C bank is changed
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   VM1TRK                                                                          
        |---- VMUPDT                                                               
                   |----  NAMIND                              External             
                   |----  NLINK                               External             
                   |----  RERROR                                                   
                   |----  VDYEAR                              External             
                   |----  VHUPRM                                                   
                   |----  MAX                                 External             
                   |----  ABS                                 External             
                   |----  UCOPY                               External             
                   |----  NBANK                               External             
   
 
3 VPKSLN
         SUBROUTINE VPkSln( comp, bestsoln )
  ------------------------------------------------------------------------------
    CKEY VGLOB VDET TRACK
  ------------------------------------------------------------------------------
   Pick the vdet pat. rec. soln from the list of possibilities
    Author      : Paul Rensing  17-5-95
    routines takes the list of ambiguous solutions provide by VGSOLV
       and tries to pick the best using various heuristics.
    INPUTS:
       integer comp  - the number of the component
    OUTPUTS:
       integer soln  - the number of the solution to use
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   VGLOB                                                                           
        |---- VPKSLN                                                               
                   |----  NLINK                               External             
                   |----  RERROR                                                   
   
 
3 VSLTRK
         SUBROUTINE VSLTRK
  ------------------------------------------------------------------------------
    CKEY VGLOB VDET TRACK
  ------------------------------------------------------------------------------
   Select good outer tracks for use in vdet pattern recognition
    Author      : Paul Rensing  27-6-95
    Subroutine to select which outer tracks to extrapolate into
       the VDET for Pat. Rec.  Use the information in the FXTR bank,
       plus D0, Z0, and no. of TPC hits on the track.
       The flag is stored in colunm JFXTVD of the FXTR bank.
    INPUT:
       FXTR, FRFT, FRTL banks
    OUTPUT:
       FXTR bank is modified.
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   VGLINK                                                                          
        |---- VSLTRK                                                               
                   |----  NAMIND                              External             
                   |----  RERROR                                                   
                   |----  ABS                                 External             
   
 
3 VTEREX
         SUBROUTINE VTEREX(VTERRAW,NVTXT,LAYVTXT,VTERMAT)
  ------------------------------------------------------------------------------
    CKEY VGLOB VDET TRACK
  ------------------------------------------------------------------------------
   Expand the vter error matrix into 8x8 form
        D.Brown - 7-11-94
    INPUT;  VTERRAW(36)  = raw upper-diagonal VTER-bank track error matrix
            NVTXT        = # of rows in VTXT bank
            LAYVTXT(4)   = VDET Layers corresponding to the VTXT rows
   ;  VTERMAT(8,8) = Expanded 8X8 matrix.  Missing rows in
            VTERRAW are expanded to give 1.0 on the diagonal and 0.0
             off-diagonal
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   VM1TRK                                                                          
        |---- VTEREX.                                                              
   

2 W_

  >>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>
    CKEY 
     1st entry in W_set
  <<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<
     WCAL       To create weighted p-vectors for energy-flow calculation
     WIRJUL     Correct wire energy for run 4001-4095

3 WCAL
         SUBROUTINE WCAL( ITYP, X , WEIG , IFIT)
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   To create weighted p-vectors for energy-flow calculation
   -
   -   Authors : M.N. Minard , M. Pepe       10/05/89
   -   Input : ITYP    element type as defined in subroutine FLOWFI
   -           X       element P-vector
              IFIT    fit type (1=Calorimeters 2=Masks)
   -   Output: WEIG    weighting coefficient for each element
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   EFOLMK                                                                          
        |---- WCAL                                                                 
                   |----  NAMIND                              External             
                   |----  SQRT                                External             
                   |----  ATAN2                               External             
   
 
3 WIRJUL
         SUBROUTINE WIRJUL
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Correct wire energy for run 4001-4095
   -    Banks EWDI EWHE updated
                                  M.N Minard 1/10/89
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   EWIRCL                                                                          
        |---- WIRJUL                                                               
                   |----  NAMIND                              External             
                   |----  MOD                                 External             
                   |----  FLOAT                               External             
                   |----  ABS                                 External             
                   |----  UCOPY                               External             
   

2 X_

  >>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>
    CKEY 
     1st entry in trigger set
     ! JULIA 30.5
        X1NAMC.H : Deleted. COMMON block is also defined in Alephlib with 
                   DIFFERENT variables                          (M.Cattaneo)
    
     ! corr file 281.2
       XTPENB : Make same event selection as XLUMOK for lumi. (P.H.Hansen July 96)
    
     ! JULIA 27.3
       X1NAMC : remove XSGE, XSHI, XSSC name-indices.
       X1DCRB,XTUNPK,XTRSIN,XTRSEV,XTRSFI : are purged.
       XTCNCR : new routine to create XTCN from X1RG.
     ! corr file 273.1
       XPTENB : use of X1RG instead of XTOP dropped in the readout upgrade
       X1TT, X1RG, X1HI : HAC parameters of new trigger banks added as common decks
    
    
  <<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<
     XPTENB     True if principal physics and bhabha triggers are enabled
     XTCNCR     Create xtcn from x1rg

3 XPTENB
         LOGICAL FUNCTION XPTENB(IRUN)
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   True if principal physics and bhabha triggers are enabled
   
      Author   :- J.Wear                  22-MAR-1990
    Modified   : P. Comas      940502
              Use of X1RG instead of XTOP dropped in the readout upgrade.
   
      Inputs:  IRUN -- Run number
           -
      Outputs: XPTENB -- logical variable
           -
      Libraries required:
   
      Description
      ===========  If principal physics triggers and bhabha
      triggers are enabled XPTENB returns true.  For use in determining
      whether to count runs/events in the "ideal case" luminosity
      determination.  Each running period has distinct trigger names for
      these required triggers, so each period must have its own list.
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
              XPTENB                                                               
                   |----  NAMIND                              External             
                   |----  CHAINT                              External             
                   |----  IBSET                               External             
   
 
3 XTCNCR
         SUBROUTINE XTCNCR
  ------------------------------------------------------------------------------
    CKEY X_SET XTCN X1RG
  ------------------------------------------------------------------------------
   - F.Ranjard - 940427
   Create xtcn from x1rg
    if X1RG is there and XTCN is not there then
       create and fill XTCN
    endif
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   RLOOPR                                                                          
        |---- XTCNCR                                                               
                   |----  NAMIND                              External             
                   |----  BKFMT                               External             
                   |----  AUBOS                               External             
                   |----  IBITS                               External             
                   |----  BLIST                               External             
   

2 Y_

  >>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>
    CKEY 
     1st entry in Y_set
     ! JULIA 310
        YKVDET : Double precision fixes for Linux       (D.Smith)
    
     ! JULIA 305
        YKSFIT : fix variable type inconsistencies in function calls, 
                 for Linux                                            (A.Waananen)
    
     * corr file 304.1
        YKINIT : Remove CALL from function references, for Linux. (A.Waananen)
    
     ! JULIA 304
        YKFFIT : Suppress Kalman filter error message               (D.Casper)
        YKSRCH : Allow more than one bit to be set in the hypothesis mask, 
                 if candidate passes more than one cut; if is INCOMING
                 to two kink candidates, save only the best candidate 
                 (smallest chi^2) to avoid confusing DALI, ENFLW, etc.  
                 Also drop output bank at entry, if present.         (D.Casper)
    
     * corr file 303.2
        YKSFIT : Check basic quality cuts (minimum distance and #bad hits) 
                 here rather than in calling routine, to avoid asking YTOP 
                 for impossible fits                                 (D.Casper)
        YKSRCH : Remove basic quality cuts                           (D.Casper)
     
     ! JULIA 303
        YKSFIT : Bug fix - do not call YFTVTC with identical input
                 and output vertex arguments                       (M.Cattaneo)
    
     * corr file 302.6
        YKFFIT : Add protections against negative SQRT               (D.Casper)
        YKSRCH : Store a record of what mass cuts are passed in YKNK (D.Casper)
    
     * corr file 302.5
        In this correction file we implement the kinks package by P.Rensing
        with minor corrections by D.Casper
    
        YKNKCM.H New - Common blocks for kinks 
        YKNKPT.H New - Common block for kinks
        YKFFIT : New - Full fit of two tracks to seach for a kink
        YKINIT : New - Initialize the cuts used in the Kink analysis 
        YKLDC  : New - Load kink coordinate arrays for an FRFT track
        YKNEM2 : New - Find the mass^2 of a kink's neutral daughter
        YKSFIT : New - Simple fit of two tracks to seach for a kink
        YKSRCH : Main Kink search routine, replaces dummy routine from JULIA 302
        YKVDET : New - Look for free VDET hits which match the inner track 
                 of a potential kink. This routine is inserted in the library
                 for completenes but is never called because it relies on VGLOB.
                 The code calling it (in YKSRCH) is commented out. 
    
     ! JULIA 302 (Tracking upgrade)
        YKSRCH : Main Kink search routine. Dummy for now   (M.Cattaneo)
  <<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<
     YFBOOK     Book histograms for mermekides main vertex fit
     YFHIST     Fill histograms for main vertex (mermekides)
     YFIJOB     Initialise name indices and formats bank for main vertex
     YFMAIN     Find the main vertex of the event
     YFVERT     Perform vertex fit using specified set of tracks
     YINIJO     Initialise name indices and formats bank for
     YINIRU     Initialise the main vertex(mermekides),topology and v0
     YKFFIT     Full fit of two tracks to seach for a kink
     YKINIT     Initialize the cuts used in the kink analysis
     YKLDC      Load kink coordinate arrays for an frft track
     YKNEM2     Find the mass^2 of a kink's neutral daughter
     YKSFIT     Simple fit of two tracks to seach for a kink
     YKSRCH     Main kink search routine
     YKVDET     Look for free vdet hits which match the inner track of a potential kink
     YMFV0S     Interface between julia and v0 package
     YPRPOT     Creates the vertex banks for the pot
     YPRSUM     Print run statistics for topology reconstruction and v0 package
     YTBOOK     Histogram booking for the topology reconstruction
     YTHIST     Histogram filling for the topology reconstruction
     YTIRUN     Initialize the run for topology reconstruction
     YV0SUM     Print run statistics for v0
     YVBOOK     Book histograms for v0 analysis
     YVHIST     V0 histograms
     YVIJOB     Initialise the number of v0 for event
     YYBOOK     Book histograms for vertex fit(mermekides),topology and v0 package
     YYHIST     Fill histograms for main vertex(mermekides), topology and v0

3 YFBOOK
         SUBROUTINE YFBOOK
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Book histograms for mermekides main vertex fit
   
      Author: M.Mermikides    11/10/87
      Modified: M.Bosman 12/04/89
      Modified: M.A. Ciocci 16/4/89
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   YYBOOK                                                                          
        |---- YFBOOK                                                               
                   |----  HBOOK2                              External             
                   |----  HBOOK1                              External             
   
 
3 YFHIST
         SUBROUTINE YFHIST
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Fill histograms for main vertex (mermekides)
   
       Author:   M. Mermikides  11 Oct 1987
       Modified: M.A. Ciocci,L. Rolandi 4/5/88
       Modified: M.Bosman 12/04/89
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   YYHIST                                                                          
        |---- YFHIST                                                               
                   |----  JHISRF                              External             
                   |----  HF2                                 External             
                   |----  HF1                                 External             
                   |----  SQRT                                External             
                   |----  FLOAT                               External             
                   |----  PROB                                External             
   
 
3 YFIJOB
         SUBROUTINE YFIJOB
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Initialise name indices and formats bank for main vertex
   
        AUTHOR:  MERMEKIDES ?
        MODIFIED:    M.BOSMAN  11/04/89
   
   
                 Description
                 ===========
        Initialise name indices and formats bank for
        the M.Mermekides primary vertex reconstruction routine
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   YINIJO                                                                          
        |---- YFIJOB                                                               
                   |----  NAMIND                              External             
   
 
3 YFMAIN
         SUBROUTINE YFMAIN
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Find the main vertex of the event
       Author   :-F. James,  Sept., 1987
       Modified: M. Mermikides 9 Sept 1987
       Modified :- E. Lancon             14-FEB-1992
                  Use FRFT,FRTL bank instead of TGFT,TGTL
                  (TGFT,TGTL) are not present in case of DST-DST
                  reprocessing without TPC)
       Description
       ===========
       Input:  the bank containing all fiited charged tracks. For the
       moment that is FRFT since we have only TCP tracks, but later it
       will be whatever comes out of joining the inormation from all
       inner tracking detectors.
   
       Action: find the point z with the largest associated energy, where
       associated energy is defined as the sum of the momenta of all
       tracks compatible with coming from x=y=0 and the point z.
       The momentum-weighted average value of z0 for those tracks
       compatible with coming from that z point is then taken as the
       nominal starting value for the vertex fit, and the tracks
       participating in the fit are those which are compatible with
       that origin. Later, tracks which are "less compatible" can be
       added to the fit according to the procedure described by Billoir,
       Fruhwirth, and Regler, NIM A241 (1985)p.115.
   
       Output: The fitted main vertex point, with error matrix and chisq.
               The list of tracks associated to the main vertex.
               The refitted 1/R, tanl, and phi off all participating
            tracks, with the n 3x3 error matrices.
   
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   RECEVT                                                                          
   RVDPRE                                                                          
        |---- YFMAIN                                                               
                   |----  NAMIND                              External             
                   |----  MIN                                 External             
                   |----  ABS                                 External             
                   |----  SQRT                                External             
                   |----  MAX                                 External             
                   |----  FLOAT                               External             
                   |----  UCOPY                               External             
                   |----  YFVERT                                                   
                   |----  BDROP                               External             
                   |----  AUBOS                               External             
                   |----  YPRPOT                                                   
                   |----  PRYFITRETURN                        External             
   
 
3 YFVERT
         SUBROUTINE YFVERT(NT,ITLIS,ERRD,ERRZ,IER)
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Perform vertex fit using specified set of tracks
       Author   : M. Mermikides,  Sept., 1987
       Modified :M.A.Ciocci 16/4/89 from 216 julia version
       Modified :- E. Lancon             14-FEB-1992
             To make it work with FRFT,FRTL
       Modified :- E. Lancon              1-OCT-1992
             return if diagonal ERMXV are <0
   
       INPUT:
                NT         I/   No of tracks to be used in vertex fit
                ITLIS(NT)  I/   Row indices in TGFT of tracks to be used
                ERRD(NT)   F/   Error on d0 for each track
                ERRZ(NT)   F/   Error on Z0 for each track
   
       Description
       ===========
           For the time being we use a 3-D vertex fitter derived
       from D. Saxon (see my note) to find the position and
       associated error matrix of the point closest to all tracks
       in space.   The results of the vertex fit are stored in
       the bank YVXL. The tracks are refitted to include the vertex
       point and the updated parameters are stored in bank YTRL.
       Please note that this strategy is provisional, and will be
       eventually replaced by a something better.
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   YFMAIN                                                                          
        |---- YFVERT                                                               
                   |----  NAMIND                              External             
                   |----  AUBOS                               External             
                   |----  BLIST                               External             
                   |----  SIGN                                External             
                   |----  UVPFIT                                                   
                   |----  SQRT                                External             
                   |----  COS                                 External             
                   |----  SIN                                 External             
                   |----  UXSFIT                                                   
                   |----  REPORT                                                   
   
 
3 YINIJO
         SUBROUTINE YINIJO
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Initialise name indices and formats bank for
                     Main Vertex Routine (Mermekides)
                     Topology software
                     V0 reconstruction
   
        AUTHOR:  M.MERMEKIDES
        MODIFIED:    M.A.CIOCCI,L.ROLANDI 12/4/88
        MODIFIED:    M.BOSMAN  12/04/89
   
   
                 Description
                 ===========
        Call the initialisation routine for the 3 packages
        CALL YFIJOB : Main vertex (Mermekides)
        CALL YTIJOB : Topology reconstruction
        CALL YVIJOB : V0 package
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   RINJOB                                                                          
        |---- YINIJO                                                               
                   |----  YFIJOB                                                   
                   |----  YTIJOB                              External             
                   |----  YVIJOB                                                   
   
 
3 YINIRU
         SUBROUTINE YINIRU
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Initialise the main vertex(mermekides),topology and v0
   
         AUTHOR:    M.MERMEKIDES
         MODIFIED:  M.A.Ciocci,L.Rolandi. 14/4/87
         MODIFIED:  M.BOSMAN 12/04/89
         MODIFIED:  M.A.Ciocci 7/6/90
   
   
                       Description
                       ===========
         CALL: YTIRUN, initialize the topology routines
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   RINRUN                                                                          
        |---- YINIRU                                                               
                   |----  YTIRUN                                                   
   
 
3 YKFFIT
         Subroutine  YKFFit(field, rowYKNK, rc)
  ------------------------------------------------------------------------------
    CKEY YKINK KINK
  ------------------------------------------------------------------------------
   Full fit of two tracks to seach for a kink
    for a kink using the point information. The two tracks are refit
       using the Kalman filter. Then, YNV0VE is used to perform the
       vertex fit. The process is iterated once in case the division of
       hits between the two tracks shifts. At the end, the inner track is
       refit with the vertex as a point in order to get the helix
       parameters with the vertex constraint applied.
       FRFT is copied into a temporary work bank, so various routines
       which use it as input will work without affecting the values
       which will be written to POT.  FRFT is always restored before
       returning.
     Author: Paul Rensing   4-5-95
    INPUT:
       REAL FIELD        - magnetic field
       INTEGER rowYKNK   - row in the YKNK bank to work on
       contents of YKNKPT bank
    OUTPUT:
       INTEGER RC - 0 means OK
       YKNK, 0 row ROWYKNK is modified
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   YKSRCH                                                                          
        |---- YKFFIT                                                               
                   |----  NAMIND                              External             
                   |----  RERROR                                                   
                   |----  WBANK                               External             
                   |----  INTCHA                              External             
                   |----  BKTOW                               External             
                   |----  UCOPY                               External             
                   |----  VZERO                               External             
                   |----  VTRKEX                              External             
                   |----  VDMSUP2                                                  
                   |----  UHELIX                              External             
                   |----  YNV0VE                              External             
                   |----  SQRT                                External             
                   |----  ATAN2                               External             
                   |----  BKFRW                               External             
                   |----  WDROP                               External             
                   |----  BDROP                               External             
   
 
3 YKINIT
         subroutine YKInit
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Initialize the cuts used in the kink analysis
       Uses banks YKCI and YKSP
         Author: Paul Rensing    08/04/97
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   YKSRCH                                                                          
        |---- YKINIT                                                               
                   |----  NAMIND                              External             
                   |----  ABRUEV                              External             
                   |----  ALGTDB                              External             
                   |----  JUNIDB                              External             
                   |----  RERROR                                                   
   
 
3 YKLDC
         subroutine YKLdC(Trk, noVDET, Npts, r, u, z, sigU, sigZ,
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
        $     vdHits, nvdet, wafers, uVDet, wVDet)
   Load kink coordinate arrays for an frft track
     Author: Paul Rensing    08/04/97
     Inputs:     FRFT, FRTL, TPCO, ICCO, VCPL and VDCO banks
                 Trk     Track number in FRFT
                 noVDET  Logical flag specifying whether to skip the
                         loading of VDET hits
     Outputs:    Npts    Number of coordinates on this track
                 r       Array of coordinate radii
                 u       Array of coordinate r-phi
                 z       Array of coordinate z
                 sigU    Array of coordinate r-phi errors
                 sigZ    Array of coordnate z errors
                 vdhits  Array of VDET hit numbers from VCPL
                 nvdet   Number of VDET hits
                 wafers  Array of VDET wafers crossed by the track
                 uVDet   Array of VDET u coordinates
                 wVDet   Array of VDET w coordinates
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   YKSRCH                                                                          
        |---- YKLDC                                                                
                   |----  NAMIND                              External             
                   |----  RERROR                                                   
                   |----  ABS                                 External             
                   |----  VZERO                               External             
                   |----  NLINK                               External             
                   |----  COS                                 External             
                   |----  SIN                                 External             
                   |----  VGWFVU                              External             
   
 
3 YKNEM2
         Real Function YKNEM2(row, parentM, dauM)
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Find the mass^2 of a kink's neutral daughter
       Given a row in the YKNK bank, and a mass for the parent and charged
       daughter, compute the mass of the neutral and the uncertainty.
       Author:  Paul Rensing     08/04/97
       Inputs:   YKNK bank
                 row         row of YKNK to use
                 parentM     mass of particle which is decaying
                 dauM        mass of charged decay product
       Returns:  YKNEM2      mass^2 of unobserved neutral decay product
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
              YKNEM2                                                               
                   |----  NAMIND                              External             
                   |----  DBLE                                External             
                   |----  SQRT                                External             
   
 
3 YKSFIT
         Subroutine YKSFit(helInner, covInner, helOuter, covOuter,
  ------------------------------------------------------------------------------
    CKEY YKINK KINK
  ------------------------------------------------------------------------------
        $     vertex, vertexCov, minDistXY, minDistZ, nBadHits, rc)
   Simple fit of two tracks to seach for a kink
    for a kink using only the pre-existing helix information.
     If there is more than one crossing point for the two helices,
     the chosen point is the one with the fewest "bad" hits (hits on the
     wrong side of the kink), with distance of closest approach as a
     second arbitrator. Cuts are made to ensure that the kink position
     is within the tracking volume.
     Input:      helInner    Helix parameters of inner track
                 covInner    Error matrix for inner track
                 helOuter    Helix parameter of outer track
                 covOuter    Error matrix for outer track
     Output:     vertex      Candidate decay position
                 vertexCov   Error matrix of vertex
                 minDistXY   Closest distance of approach in XY
                 minDistZ    Closest distance of approach in Z
                 nBadHits    Total number of hits assigned to these
                             tracks which are inconsistent with the
                             reconstructed vertex
                 rC          Status return code; 0 if no error
     Author: Paul Rensing   4-5-95
     Modified: Dave Casper  8-4-97  Calculation of vertex covariant matrix
                                    not working as intended - call YTOP
                                    instead.
     Modified: M.Cattaneo  13-5-97  Call to yftvtx with identical input and
                                    output vertex array was not working, because
                                    yftvtx initialises output to zero before
                                    input is looked at.
               D.Casper    03-5-97  Check basic quality cuts (minimum
                                    distance and #bad hits) here rather
                                    than in calling routine, to avoid
                                    asking YTOP for impossible fits
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   YKSRCH                                                                          
        |---- YKSFIT                                                               
                   |----  SIGN                                External             
                   |----  ABS                                 External             
                   |----  YDISMC                              External             
                   |----  SQRT                                External             
                   |----  VZERO                               External             
                   |----  UHELIX2                             External             
                   |----  ATAN2                               External             
                   |----  UCOPY                               External             
                   |----  YFTVTC                              External             
   
 
3 YKSRCH
         Subroutine YKSrch(SrchVD)
  ------------------------------------------------------------------------------
    CKEY YKINK KINK
  ------------------------------------------------------------------------------
   Main kink search routine
     Author: Paul Rensing   4-5-95
     Modified: Dave Casper  17-4-97  Store a record of what mass cuts
                                     are passed in YKNK
                            08-8-97  Allow more than one bit to be set in
                                     the hypothesis mask, if candidate
                                     passes more than one cut; if is INCOMING
                                     to two kink candidates, save only the
                                     best candidate (smallest chi^2) to avoid
                                     confusing DALI, ENFLW, etc.  Also drop
                                     output bank at entry, if present.
    routine looks through all pairs of tracks. Each pair is tested as
       a possible kink. First, a simple calculation is done to see if the
       tracks for a vertex. If they do, an vertex fit is made. Cuts are
       made on the charge of the two tracks, the quality of the vertex
       (before and after fitting), and the match with a known kink
       species. The result is the YKNK bank.
   
     LOGICAL SrchVD  - if .TRUE., look in VDET for free hits which match
   
     Bank YKNK,0 is created and filled
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   RECEVT                                                                          
   RVDPRE                                                                          
        |---- YKSRCH                                                               
                   |----  NAMIND                              External             
                   |----  BDROP                               External             
                   |----  ABRUEV                              External             
                   |----  YKINIT                                                   
                   |----  AUBOS                               External             
                   |----  RERROR                                                   
                   |----  ABS                                 External             
                   |----  YKLDC                                                    
                   |----  YKSFIT                                                   
                   |----  UCOPY                               External             
                   |----  YKFFIT                                                   
                   |----  YKNEUTM                             External             
                   |----  IBSET                               External             
                   |----  VTRKEX                              External             
   
 
3 YKVDET
         Subroutine YKVDet(field, vertex, vertexCov, helParm, helCov,
  ------------------------------------------------------------------------------
    CKEY YKINK VDET
  ------------------------------------------------------------------------------
        $     vdhits, minChi2, sndChi2)
   Look for free vdet hits which match the inner track of a potential kink
    Author:   Paul Rensing  15-1-96
    Modified: D.Smith       991027  Double precision fixes for Linux
    routine looks for VDET hits which match the inner track of a
     potential kink. If the inner track does not enough z measurements to
     define the track, the track is refit with the kink vertex and/or
     the beam spot used as contraints. The work of finding matching hits
     is done by the routines from the VGLOB package.
   
       real field         - magnetic field
       real vertex(3)     - position of kink vertex
       real vertexCov(6)  - covariance of kink vertex
       contents of YKNKPT common
   
       real helParm(5)    - parameters of inner helix with constaints added
       real helCov(15)    - covariance of inner helix with constaints added
       integer vdhits(8)  - list of VDET hits, packed as in VGHC bank
       real minChi2       - chi**2 of association for best combination
       real sndChi2       - chi**2 of assoc. for second best combination
       YKNKPT is updated to reflect any VDET hits found
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
              YKVDET                                                               
                   |----  SQRT                                External             
                   |----  COS                                 External             
                   |----  SIN                                 External             
                   |----  DATAN2                              External             
                   |----  NLINK                               External             
                   |----  RERROR                                                   
                   |----  TFITHL                                                   
                   |----  MAX                                 External             
                   |----  SMINV                               External             
                   |----  VGSRCH                              External             
                   |----  VZERO                               External             
                   |----  UCOPY                               External             
   
 
3 YMFV0S
         SUBROUTINE YMFV0S
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Interface between julia and v0 package
     Author M.A.Ciocci 6/10/90
     MODIFIED:M.A.Ciocci 28/1/93
         DESCRIPTION
         ============
     Calls the steering routine for v0 reconstruction,
     ymfv0v, take decision about histograms and fills the y0josu
     common (summary for V0)
    This package drop the yv0v bank (if it is present)
    and rewrite the same bank WITH THE NR OF THE YV1C BANK.
    (look at yv0v bank -> sbank yv0v)
    (it can  use the mean value for run of beam beam crossing point).
    It give (if you want) the histograms for v0 candidate after
    any sequential cut (yv1c).
    And give as argument output
        IERCO/INTEGER         code for error:
                              if 0 all is ok
                              if 1, problems with coovariance matrix
                              of charged tracks in ychiv2
                              if 2, problems with coovariance matrix
                              of charged tracks in ynv0ve
                              if 3, problems with coovariance matrix
                              of charged tracks in ynvonf
                              if 4, problems in yvcame with frft
                              if 5, problems inverting coovariance
                              matrix of reconstructed V0 vertex
                              candidate
                              if 6, the number of V0 candidates is
                              greater than 50
                              if 7, no booked enlarged space for yv0v
                              if 8, problems with working banks
                              if 9 no space for yv0v bank
                              if 10 no yv1c on dbase or cards
        NUMV0/INTEGER         Number of V0 candidates (at
                              maximum 50)
        CHIOR(2,50)/REAL      chi2 increasing constraining
                              the track coming from V0 candidate
                              to the origin
       QGA(50)/REAL          Q value in the gamma hypothesis
       CHQGA(50)/REAL        chi2 of Q value in the gamma hypothesis
       QLA(50)/REAL          Q value in the lambda hypothesis
       CHQLA(50)/REAL        chi2 of Q value in the lambda hypothesis
       QAL(50)/REAL          Q value in the antilambda hypothesis
       CHQAL(50)/REAL        chi2 of Q value in the antilambda
                             hypothesis
       QK0(50)/REAL          Q value in the k0 hypothesis
       CHQK0(50)/REAL        chi2 of Q value in the k0 hypothesis
       XMGA(50)/REAL         invariant mass in the gamma hypothesis
       CXMGA(50)/REAL        chi2 of invariant mass in the gamma
                             hypothesis
       XMLA(50)/REAL         invariant mass in the lambda hypothesis
       CXMLA(50)/REAL        chi2 of the invariant mass in the
                             lambda hypothesis
       XMAL(50)/REAL         invariant mass in the antilambda
                             hypothesis
       CXMAL(50)/REAL        chi2 of invariant mass  in the
                             antilambda hypothesis
       XMK0(50)/REAL         invariant mass in the k0 hypothesis
       CXMK0(50)/REAL        chi2 of the invariant mass in the
                             k0 hypothesis
      NCOR(2,50)/INTE        number of coordinates before the
                             reconstructed vertex for tracks
                             coming from v0
      DISCO(2,50)/REAL       radial distance for the furthest
    To use this package:
      a) data base must be opened
      b) frft,frtl,pyer,eveh must be present ( make unpacking
         tp,it,fi )
      c) yv1c bank (that contains cuts for v0 selection)
         must be present on data base or given by data cards
         if you want change cut for v0 analysis.
      d) fvcl,ficl,ftcl,vdco,itco,tpco must be present
         only if you check the number of coordinates
         before the reconstructed vertex
         ( make unpacking tp,it,fi)
         To understand cuts look the ddl of yv1c bank
         (-> sbank yv1c)
       Beware that the different cuts used in different period
       of Aleph data taking (89-90 91-92 93...) are sumarized
       by the different NR of the yv1c bank. So on the data base
       the yv1c is present with 3 different value for NR
   1C 1/ 25  1  1  1  99999999
   1989-1990
         IV     O1     O2     CT     PS         RV    ZV    DI
           1      0.0    0.    2.     0.         180. 220. 0.06
         CF     CS     CO     MA     PM    NT   CB    NC    MD
          13.    0.92    0.    50.    0.     4    0    0      0.
         D0     Z0     WK        WL         WG
          999.   999.   0.1E+05  0.1E+05     0.1E+05
   1C 2/ 25  1  1  1  99999999
   1991-1992
         IV     O1     O2     CT     PS         RV    ZV    DI
          1      0.0    0.     3.    0.0        180.  220. 0.06
         CF     CS     CO     MA     PM    NT   CB    NC    MD
          25.    0.5    0.0    9999.  0.1   4     2    10    1.5
         D0     Z0     WK     WL     WG
          999.   999.   9999. 9999.   9999.
   1C 3/ 25  1  1  1  99999999
   1993 and later i hope...
         IV     O1     O2     CT     PS         RV    ZV    DI
          1      0.0    0.     2.    0.0        180.  180. 0.06
         CF     CS     CO     MA     PM    NT   CB    NC    MD
          13.    0.92   0.0    9999.  0.    5     0    33    0.
         D0     Z0     WK     WL     WG
          999.   999.   0.5    0.50  0.50
   
        To  change cut change values of cut on the following cards
         and add these cards
   
   1C 4/ 25  1  1  1  99999999
    private cards
         IV     O1     O2     CT     PS         RV    ZV    DI
          1      0.0    0.     2.    0.0        180.  180. 0.06
         CF     CS     CO     MA     PM    NT   CB    NC    MD
          13.    0.92   0.0    9999.  0.    5     0    33    0.
         D0     Z0     WK     WL     WG
          999.   999.   0.5    0.50  0.50
   
                      iflag=0, primary vertex is assumed to
                       be (0,0,0)
      IV/I            iflag=1  primary vertex defined by pyer
                       bank
                       iflag=2 primary defined using the jsum bank
                       (mean value of primary run per run)
   
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   RECEVT                                                                          
        |---- YMFV0S                                                               
                   |----  JHISRF                              External             
                   |----  YMFV0V                              External             
                   |----  REPORT                                                   
   
 
3 YPRPOT
         SUBROUTINE YPRPOT
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Creates the vertex banks for the pot
    input banks: YVXL
    ouput banks: PYFR  PYER
               Author : LL. Garrido 30/9/88
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   YFMAIN                                                                          
        |---- YPRPOT                                                               
                   |----  NDROP                               External             
                   |----  NLINK                               External             
                   |----  AUBOS                               External             
                   |----  UCOPY                               External             
                   |----  SMINV                               External             
   
 
3 YPRSUM
         SUBROUTINE YPRSUM
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Print run statistics for topology reconstruction and v0 package
      AUTHOR: M.A.Ciocci,L.Rolandi 13/4/88
      MODIFIED : M.Bosman 12/04/89
                       Description
                       ===========
         CALL: YTOSUM, summary of the topology package
         CALL: YV0SUM, summary of the V0 reconstruction
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   RSMJOB                                                                          
        |---- YPRSUM                                                               
                   |----  YTOSUM                              External             
                   |----  YV0SUM                                                   
   
 
3 YTBOOK
         SUBROUTINE YTBOOK
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Histogram booking for the topology reconstruction
   
       Author :     G. Lutz   30/11/87
       Modified :   M. Bosman 01/12/88
   
   
       Description
       ===========
       This routine books histograms
       for the TOPOLOGY reconstruction program
   
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   YYBOOK                                                                          
        |---- YTBOOK                                                               
                   |----  HBOOK1                              External             
   
 
3 YTHIST
         SUBROUTINE YTHIST
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Histogram filling for the topology reconstruction
   
       Author :     G. Lutz   30/11/87
       Modified :   M. Bosman 01/12/88
   
   
       Description
       ===========
       This routine fills histograms
       for the TOPOLOGY reconstruction program
   
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   YYHIST                                                                          
        |---- YTHIST                                                               
                   |----  NAMIND                              External             
                   |----  HF1                                 External             
                   |----  FLOAT                               External             
   
 
3 YTIRUN
         SUBROUTINE YTIRUN
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Initialize the run for topology reconstruction
       from JULIA
   
       Author :     M. Bosman    1/2/89
   
       Description
       ===========
       This routine is called once at each RUN beginning to
       initialize the TOPOLOGY part of the reconstruction
       program.
       It calls the routine YTOIRU
   
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   YINIRU                                                                          
        |---- YTIRUN                                                               
                   |----  YTOIRU                              External             
   
 
3 YV0SUM
         SUBROUTINE YV0SUM
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Print run statistics for v0
      AUTHOR: M.A.Ciocci,L.Rolandi 13/4/88
      MODIFIED : M.Bosman 12/04/89
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   YPRSUM                                                                          
        |---- YV0SUM                                                               
                   |----  FLOAT                               External             
   
 
3 YVBOOK
         SUBROUTINE YVBOOK
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Book histograms for v0 analysis
   
      Author: M.A.Ciocci,L.Rolandi 14/4/88
      Modified: M.Bosman 12/04/89
      Modified: M.A. Ciocci 16/4/89
      Modified: M.A. Ciocci 20/7/89
      Modified: M.A. Ciocci 6/6/90
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   YYBOOK                                                                          
        |---- YVBOOK                                                               
                   |----  JHISRF                              External             
                   |----  HBOOK1                              External             
   
 
3 YVHIST
         SUBROUTINE YVHIST
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   V0 histograms
   
       Author: M.A. Ciocci,L. Rolandi 4/5/88
       Modified: M.Bosman 12/04/89
       Modified: M.A.Ciocci 16/4/89
       Modified: M.A.Ciocci 6/6/90
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   YYHIST                                                                          
        |---- YVHIST                                                               
                   |----  JHISRF                              External             
                   |----  NAMIND                              External             
                   |----  ABS                                 External             
                   |----  HF1                                 External             
                   |----  YFQERQ                              External             
   
 
3 YVIJOB
         SUBROUTINE YVIJOB
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Initialise the number of v0 for event
   
        AUTHOR:  M.A.CIOCCI
        MODIFIED:    M.BOSMAN  11/04/89
        Modified: M.A. CIOCCI 16/4/89
        Modified: M.A. CIOCCI 6/6/90
   
                 Description
                 ===========
        Initialise name indices and formats bank for
        the V0 reconstruction routine
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   YINIJO                                                                          
        |---- YVIJOB.                                                              
   
 
3 YYBOOK
         SUBROUTINE YYBOOK
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Book histograms for vertex fit(mermekides),topology and v0 package
   
      Author: M.Mermikides    11/10/87
      Modified: M.A.Ciocci,L.Rolandi 14/4/88
      Modified: M.Bosman 12/04/89
                       Description
                       ===========
         CALL: YFBOOK, book histograms for main vertex (Mermekides)
         CALL: YTBOOK, book histograms topology package
         CALL: YVBOOK, book histograms for the V0 package
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   RBKHIS                                                                          
        |---- YYBOOK                                                               
                   |----  YFBOOK                                                   
                   |----  YTBOOK                                                   
                   |----  YVBOOK                                                   
   
 
3 YYHIST
         SUBROUTINE YYHIST
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Fill histograms for main vertex(mermekides), topology and v0
   
       Author:   M. Mermikides  11 Oct 1987
       Modified: M.A. Ciocci,L. Rolandi 4/5/88
       Modified: M.Bosman 12/04/89
                       Description
                       ===========
         CALL: YFHIST, fill histograms for main vertex (Mermekides)
         CALL: YTHIST, fill histograms topology package
         CALL: YVHIST, fill histograms for the V0 package
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   RHSEVT                                                                          
        |---- YYHIST                                                               
                   |----  YFHIST                                                   
                   |----  YTHIST                                                   
                   |----  YVHIST                                                   
   
