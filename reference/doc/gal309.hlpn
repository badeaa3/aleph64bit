1 GALEPH

    on AXP/VMS:
              $ define GAL309 $2$DKB200:[GENERAL_A.GAL.GAL309]
              $ define ALINC  $2$DKB200:[GENERAL_A.ALE.INC]
               source on GAL309:*.F, *.h 
               library   GAL:GAL309.OLB, _D.OLB, .NEWS
    on UNIX :  source on $ALROOT/gal309/
               library   $ALEPH/gal/libgal309.a
                         $ALEPH/gal/libgal309_dbx.a
               link      $ALEPH/lib/libgaleph.a
                         $ALEPH/lib/libgaleph_dbx.a
                         $ALEPH/src/galeph
  -----------------------------------------------------------------------
  ! 19991129 - galeph 309.0
               must be linked with new alephlib and new database
               to get date in the Y2K format
    ASINIT,ASIJOB,ASREDC,ASRRUN,ASWSUM,AGLCAL,HCRDCA - mods for Y2K.
    ASINIT - STOP if ALEPHLIB < 314.0
    ASIJOB - STOP if DB < 300
  ----------------------------------------------------------------------
  ! 991116 - galeph 308.2
    VDMKTE - fix a mistyping error.
  ! 990511 - galeph 308.1
             ================BECAREFUL!!!=========================== 
             the $GUSER environment variable has been modified to add
             ",-u,gntube_".
             GAL:GALRUN.COM has been modified to include GNTUBE
             from the galeph library.
             ========================================================
    GPGHEI - make a character string from the integer NAMATE to please
             Linux compiler
    GNTUBE - modify the geant321/ggeom/gntube.F routine to add a protection
             for particles strickly parallel to z-axis
  ! 981203 - galeph 308.0
             ================BECAREFUL!!!=========================== 
             the $GUSER environment variable has been modified to add
             ",-u,gpghei_".
             GAL:GALRUN.COM has been modified to include GDRAY and
             GPGHEI from the galeph library.
             ========================================================
    AGCOIL - reduce the density of the average material used to describe
             the volumes at the edges of the coil since in this volume
             there is not the Al cylinder where the col is wound around.
             (A.Venturi)
    AGHCAL - reduce the radius of the HCAL endcap pole from 217cm to 210cm.
             (A.Venturi)
    GPGHEI - modify this GEANT321 routine: 
             the probability of interaction, for (in)elastic interactions
             of stable particles on proton and neutron, is increased by 8%
             in ECAL (M.N.Minard).
             this routine is added in guse/ and in the $GUSER environment
             variable
  -----------------------------------------------------------------------
  ! 981102 - galeph 307.2
    HCCRTO - replace data statment with data base value
  ! 980821 - galeph 307.1
    HCRDCA, HCALTO, HCALCT.H, HCTWTH.H - 
             implement the possibility equilizing the HCAL modules
             in the MC as in real data.
    HCCRTO - is recompiled because include files have changed.
  ! 980703 - galeph 307.0
             BECAREFUL : This version requires ADBSCONS => 239
    ASIGAL - call RECUST as a FUNCTION to please Lynux compiler.
    ASREVE - modify a FORMAT statment.
    ASWSUM - modify a FORMAT statment.
    AGTPCH - change a comment.
    new routines in hcal/
    HCALTO - function to evaluate the calibration constant applied
             to the HCAL module if they were real data. (A.Scabia`)
    HCMODN - find the module(s) number a tower belongs to. (A.Scabia`)
    HCRDCA - read the HCAL calibration constant used for the real data
             that are simulated. (A.Scabia`)
    mods in hcal/
    HCASIG - increase the size of HTHT to be ready for the HCAL signal spread
             along the tubes.
    HCFITU - spacers are taken into account in the determination of the center
             and of the length of the track segment.
    HCSTSE - change of one input argument to allow a better determination of the
             absolute coordinate of each track sub-segment.
    HCBACK - bug fix in the determination of a hit coordinate.
    HCTKSP - consistency checks and protections added.
    HCSHOW - modified to take into account the change in HCSTSE.
    HCCOIN - bug fixes in the evaluation of the hit local coordinates and
             better evaluation of the hit absolute coordinates;
             protections and consistency checks added.
    HCIRUN - add a call to HCRDCA.
    HCFORA - implementation of the tower thresholds and half-tower miscalibration.
    new include files in /inc
    HCTWTH.H, HCALCT.H
  ---------------------------------------------------------------------------------
  ! 980305 - galeph 306.3
             BECAREFUL : To simulate the LSCIntillator correctly you need 
                         ADBSCONS => 234
    LSCHIT - The routine and the database bank should change simultaneously.
             Since this simulation is more realistic, it should be applied
             in future simulations of any year. The main difference is that a
             particle hitting the scintillators give rise to a finite number
             of photoelectrons (on average 0.6), instead of a Gaussian signal.
             This explains why there half the time is signal in only one of
             the two PMs looking at each scintillator.(P.Hansen)
  ! 980225 - galeph 306.2
             BECAREFUL : To simulate 96-97-98 MCarlo it must be used with
                         ADBSCONS => 233
    AGGEAN - use the xPCO bank to introduce TRAP parameters(6-11) in GEANT.
  ! 980113 - galeph 306.1
             BECAREFUL : To simulate 98 MCarlo it must be used with
                         ADBSCONS => 232
    LCIRUN, AGLCAL - replace the lead absorber in front of the LSCIntillator
                     with a tungsten one.
  ! 971219 - galeph 306
             BECAREFUL : this version MUST be used with adbscons => 230
    AGVDET - use same geometry description for VDET 91-95
    AGTPCH - add TPC resistor chain and laser optics.
             augment the reinforcing ring on the inner field cage.
  ------------------------------------------------------------------------
  ! 970822 - galeph 305.3
    ASGPAR, ASWKIN - remove bugs which prevent new particles with 
                     geant# > 52 and .ne.NOTRK(=100) to be stored properly.
  ! 970505 - galeph 305.2
 	    BECAREFUL : this version MUST be used for 97 MCarlo
                         it can handle the LCAL scintillator if in DB.
                         To simulate 97 MCarlo it must be used with
                         ADBSCONS => 224 
                         The LSCIntillator is NOT in ADBS224.
    AGLCAL - in modifying the code to remove the LSCintillator from the
             LCAL geometry, 4 screws were lost.
             restore them.
  ! 970429 - galeph 305.1
 	    BECAREFUL : this version MUST be used for 97 MCarlo
                         it can handle the LCAL scintillator if in DB.
                         To simulate 97 MCarlo it must be used with
                         ADBSCONS => 223
    AGLCAL - do NOT STOP if LCAL scintillator not on DB.
    CAPSTO - replace a call to ALBOS with a call to ALTELL.
  ! 970317 - galeph 305.0
 	    BECAREFUL : this version MUST be used for 97 MCarlo
                         it contains the LCAL scintillator.
                         To simulate 97 MCarlo it must be used with
                         ADBSCONS => 222
    AGLCAL - add LCAL scintillators.
    GUSTEP - call LSCHIT to store LCAL scintillator hits.
    LCIRUN, LCBKPR - introduce LCAL scintillators.
    LCSHOW - corrections to limit the amount of fluctuations in the shower 
             parameters, and to optimize parameters for high energy.
    LSCHIT - new routine to store LCAL scintillator hits.
  -------------------------------------------------------------------------
    GAL304   First version maintained with CVS.
             flags are -DALEPH_DEC on AXP/VMS
                       -DUNIX -DALEPH_${VENDOR} on (DEC SGI HP)
  ! 961113 - galeph 304.11
 	    BECAREFUL : This version can handle both VDET description
                         VDET95 description from ADBSCONS < 219
                         VDET96 description from ADBSCONS => 219
                         older version of galeph CANNOT handle VDET96
                         ===> DON'T RUN galeph < 304.11 with ADBSCONS > 218   
                              ===============================================
  ! 961113 - galeph 304.11
             introduce VDET96 a new GEANT description of VDET.
    AGVDET - calls AGVF95 when ADBSCONS < 219
             calls AGVF96 when ADBSCONS => 219
    AGVF96 - positions faces into VDET volume.
    GUSTEP - in geantino parametrization in LCAL check that FSENS is true
             AND igsvol=idetjo(5)
    USER   - cut user.F in pieces, remove user.F, add usieve.F, usceve.F,
             usirun.F, uscrun.F, usijob.F, uscjob.F
    ASDUMMY- cut asdummy.F in pieces, remove asdummy.F, add askusi.F, askuse.F
  ! 961009 - galeph 304.10
    VFNDEL - access VDEP bank correctly.
  ! 960822 - galeph 304.9
    ALDUMMY, USER, LCXYPA, MUINCB, MUINCE, MUINCM - add #ifndef 1.. #endif
    ITHIT  - remove call to ITAMP  (dummy routine).
    MUFLHT - remove call to MUDSTP (dummy routine).
    MUHIT  - remove call to MUDTUB (dummy routine).
    ITAMP, MUDSTP, MUDTUB - remove these dummy routines.
  ! 960624 - galeph 304.8
    HCSHOW - reset IHCPOR hcal portion no. and IHCMOD hcal module no.
             to those where the shower starts between 2 shower spots.
    960611 - galeph 304.7
    ASKTRK - correct definition of UPTPC
    960531 - galeph 304.6
    LCSHOW - code introduced in 304.3 was not the right one.
    960529 - galeph 304.5
    AGVDET - wrong setup code used for 9501.         
    960528 - galeph 304.4
             a part of the corrections made to built gal303 were missing.
    CATINO, ASKTRK - store vertex in GPOS (mandatory for GEANT321)
    GCKING - add common /GCKIN3/
    AGTPCH - adapt TPC gas mixture to Geneva conditions.
    HCFITU - add some protections
    ITDTGO - add some protections
    VAENCL, VDFILL - use different encoding schemes for old and new VDET.
    960523 - galeph 304.3
    GUSTEP, LCHIT, LCSHOW - implement geantino parametrisation in LCAL
             as it is done in ECAL (M.N.Minard)               
    960520 - galeph 304.2
    AGGEAN - in case of error call PRTABL (bank,IW(jbank-2))
    AGEOME - call AGSATR which calls AGSMBA if necessary.
    AGVDET - call AGVF92 in case of 91 geometry.
    AGCHCK - remove a conditionnal jump which is now made in ASREDC.
    ASREDC - it is not allowed to suppress SATR or SAMBA with 
             GEOM 'SATR' 0 because it is passive material.
    SAASIG - remove double quotes in a WRITE statment.
    960513 - galeph 304.1
    ASKTRK - do not keep primaries in mask region (Beam pipe region)
    AGLCAL - add 2mm of Lead at inner circumference from Oct 95 onwards
    960508 - GALEPH 304.0
  * corr no.1 to galeph 30.3
    introduce GERA data card to allow very specific studies.   
  * corr no.2 to galeph 30.3
    EHSITW - to call EVERIF.
    EVERIF - new routine to check tower address consitency. 
  * corr no.3 to galeph 30.3
    replace TIMAx by TIMEx
    remove tpg*.h which are stored in ALINC. 
          In /geom
    AGTPCH - move #if defined(INTER) to another place because
             cpp on HP does not like #if defined between continuation 
             cards.
  ----------------------------------------------------------------------- 
  ! 950821 - GALEPH 30.3
    BECAREFUL : because of the changes in VDET
                GALEPH 30.2 should NOT be used with ADBSCONS > 200 to
                simulate DATE > 93.
                To simulate DATE => 94 with all VDET improvments:
                USE GALEPH 30.3 with ADBSCONS => 201.
  * corr no.1
    corrections to adapt to cvs (FLR302A)
    VDCLU  - Stop clustering when the wafer boundary is reached
             (for VDET92, z-view)
    VDPRTE - create electron clouds only if the track element is
             in the active region
  * corr no.2
    VDFOOB -remove an old bug (Manoj)
         In *CD -> GUSER
    GUSTEP - call VDHITE at end of track in VDET.
    GDRAY  - GEANT modified version.
         In *CD -> GEOMNEWS
    AGVDET - set name of sensitive volume.
         In *CD -> VDETNEWS
    VDHIT,VDHITE,VDASIG,VDMKLO,VDMKTE -
      1. NEW improved treatment of DELTA RAY production.
         Delta rays are important since they generate
         on average a nearby 3-D hit for 5% of the real hits.
      2. Let GEANT treat the Landau fluctuations in the energy
         deposition within the silicon.
      Induced by changes in the above routines and the
      database banks VTME,VVOL,VDEP,VGPA,VVOL,VPOS and VMAT
      which are made for setup code 6 onwards.
      Thus these changes will only take effect for Monte Carlo
      simulations of data from DATE 94 onwards.
      (Easy to change if needed.)
      The routine GDRAY is a copy of a GEANT routine in which
      the energy of each delta ray produced in the VDET region
      is multiplied by a FACTOR (1.4), which effectively give
      a cross-section increase of the same amount. This factor is
      used to give optimal agreement between data and monte carlo.
    - VDLAND,VDMKLA
       No longer used could be droped
  ----------------------------------------------------------
  ! 950512 - GALEPH 30.2
             1st version capable to simulate VDET95.
             To simulate VDET95 :
             - use ADBSCONS => 199  on test as ADBSTEST
             - put a card DATE 96. in your galeph cards file
         In *CD -> GALNEWS
    GALEPH - call ASIGAL to initialize GALEPH.
             call GPAW in interactive mode.
             call GZEBRA in NOT interactive mode.
         In *CD -> GUSENEWS
    GUINTI - is purged
    GAXEPH - reorganized to run with GEANT 3.21
         In *CD -> GEOMNEWS
    remove calls to GSORD which is now a 'do nothing' routine.
    AGGORD - remove the routine.
    AGSATT - new routine , copied from GUINTI which is removed.
             set volume attributes which are not set by *ATT bank.
    AGGORD - remove the routine, code is included into AGGEAN.
    AGGEAN - read *ATT banks and call GSATT.
    AGEOME - call AGSATT before closing the geometry.
    AGVF92 - '92 vdet face geometry.
    AGVF95 - '95 vdet face geometry.
    AGVDET - call AGVF92 or AGVF95 depending on the year.
         In *CD -> SKELNEWS
     ASIGAL - new routine to initialize GALEPH , called by Main program.
     ASIEVE, ASPRUN - move reading of input file from ASPRUN to ASIEVE.
         In *CD -> VDETNEWS
     VFNDMP - Take into account different multiplexing
              schemes between VDET92 and VDET200 for the computation
              of strip capacitances.
  ---------------------------------------------------------------
  ! 950420 - GALEPH 30.1
    use AUTONEST in HISTORIAN to facilitate transfer to CVS.
    update HCVLJJ, CAPAJJ, KRUNJJ
         In *CD -> VDETNEWS
    - VFNDEL, VDFOOB, VDMKLO : remove bugs
         In *CD -> SKELNEWS
     remove LEVEL 3 trigger
     call new LEVEL 1 trigger
     ASRUST - store GEANT version no. * 10000.
     ASIGAL - GALEPH initialization (new routine)
          In *SET -> IFINTER
     adapt to GEANX321
         In *CD -> ECALNEWS
    ECIRUN - read EDPA bank from DB, and call EUPPAR.
    EUPPAR - new routine
             update ECAL parameters from EDPA bank.
         In *CD -> TRIGNEWS
    remove the TRIG set : all routines are in ALEPH205
         In *CD -> LCALNEWS
  There has been problems with the simulated Energy
  spectrum in Lcal for qqbar events. While the data spectrum
  falls smoothly with energy, the simulated spectrum has a
  strange 'shoulder' at about 3 GeV.
  Another complaint is that the energy in wireplanes
  in the MC look like discrete lines when plotted in
  fine bins of a few MeV.
  a) A new shower parametrization, used
     for the last Bhabha production, is incorporated.
     This makes better use of the results from Ecal testbeam
     at low energies where there was no Lcal testbeam.
     It also fluctuates some of the parameters, and reproduces
     better the longitudinal shower fluctuations seen in data.
     While this does not help on any of the above problems,
     it does make the EM showers a bit more realistic.
     The parameters of the new shower is given in a data-
     base bank LSHO, which I have submitted to Francoise.
     I have also changed the bank LECA 1 so that the energy
     is calibrated like data with 45.5 GeV electrons.
  b) The mysterious shoulder turns out to be a minimum ionising
     peak from hadrons that are tracked with GEANT through the
     volume. The energy deposited in each plane by the
     routine LCTRAK was way too high (typically 56 MeV).
     I have reduced it to 9.1 MeV (the min ionising energy
     in bank LSHO). This number may change a little after
     more studies.
  c) The energy is quantised in 40 MeV packages. This
     causes the right sampling fluctuations in EM showers
     and keeps down the computertime. This is why discrete
     lines are seen in the plots.
     The 40 MeV corresponds reasonably well to the zero
     suppression in the pads, but the wires are actually 16
     times more sensitive.
     Each "hit" in LCSHOW is weighed by a
     factor which is Poisson fluctuated around 16, and
     also multiplied the hit multiplicity in LCTRAK by 16.
     In LADC I divide again by 16. This way the wire energy
     is better reproduced - especially for min ionising
     tracks, and some smearing of the lines is provided.
  d) The end-of-job summary is changed so that it becomes
     meaningful.
    -----------------------------------------------------------------
  ! 941121 - GALEPH 30.0
    BECAREFUL ===> this version requires ALEPHLIB => 20.4
    remove OLD VDET code.
    redesign VDET package using NEW VDET geometry package.
    Suppress manipulation of lists of strips
    Process one wafer at a time, use array of strips
    Process one module at a time, use array of readout channels
    Include correct treatment of Landau fluctuations inside silicon
    (optional)
    Details are given in Aleph note :  ALEPH 94-152, MINIV 94-05
  ------------------------------------------------------------------------
  ! 941115 - GALEPH 25.7
   * corr.file # 1
     increase ZEBRA size to run GEANT321
     add a protection in CAHERB
   * corr.file # 2
     add many protections to run cosmolep
     ASCTRA,ASKTRK,ASREVE,HCHISE,MUSGNL,MUSTSG
     increase BOS size
     increase TIMEST argument
 ----------------------------------------------------------------
  ! 940111 - GALEPH 25.6
         In *CD -> SCALNEWS
  Modifications by B.Bloch  May 1993 including update of SIDOC deck
   o New comdeck SICONST with constants loaded from Data Base
   o New subroutines :
     SIZINI  Get zero suppression scheme and conversion constants
     SITRA3  generate transverse shower distribution in Sical (3 Gauss.)
     SIDFRT  initialise transverse em-shower distribution in Sical
   o Modifications in :
     SIPARM: update parametrisation common content
     SIBOOK: update histos
     SIDFPA: update parametrization constants
     SIIRUN: get BANKS from Data base for all constants
     SISIDI: apply Zero suppression on Raw Data
     SITRAK: use constant from Bank
     SISHOW: update parametrization steering
     SITRAN: update transverse parametrization
     SITRIG: apply Zero suppression to SIFO bank
         In *CD -> ECALNEWS
    ECIRUN : get ENNO bank from DB using setup code
    EDSNOI : use ENNO bank if it exists, otherwise use data statment
         In *CD -> GALNEWS
    GALEPH - increase size of ZEBRA common to fit SiCAL geometry.
         In *CD -> CALONEWS
    * corr no. 1
    CAASBS -  a wrong version was introduced in GALEPH 255 corrected
              in corr.file no.1
    -----------------------------------------------------------------
  ! 930910 - GALEPH 25.5
         In *CD -> CALONEWS
    CAPGET  - calls new routine CAABSB
    CAABSB  - new routine to stop geantino when all energy is deposited.
         In *CD -> SKELNEWS
   Modifications activated only with flag IFINTER  (B.Bloch May 1993)
     ASPRUN: update to call KUWHAT instead of GINTER
     GALEPH: update Zebra common length for interactive graphic version
         In *CD -> GUSENEWS
     GUINTI : call AGGATT for the ITC banks (B. Bloch May 1993 )
         In *CD -> GALNEWS
     GALEPH - add a CALL TIMEST(99999.) to please new TIMEL
              routine on VAX when running interactively
         In *CD -> GEOMNEWS
     AGEOME : update description of central region     (B.Bloch May 1993)
     AGITCH : implement geometry from Data base banks  (B.Bloch May 1993)
     AGHCAL : update materials (L.Silvestris)
         In *CD -> ITCNEWS
   Modifications for new drift time parameterisation.
   Database bank IDTC is replaced by IDRP to allow higher order
   polynomial.  For backwards compatibility versions of IDRP for old
   Monte Carlo data are provided which duplicate the existing IDTC
   banks.   NB. Requires ADBSCONS >= 183
   purged   IDTCJJ
   modified IJJPAR, ITPARC
            ITDCNS, ITDRFT, ITDTGO, ITIRUN, ITPGEO, ITRES
         In *CD -> HCALNEWS
    HCCONG, HCDIGI : cleaning of the code
    HCHIT  : suppress the possibility (never used) to create a geantino.
             to develop hadronic shower.
    HCSHOW : improvments in the hadronic shower development.
    -----------------------------------------------------------------
  ! GALEPH 25.4   930416   18:25:21
          in GAL253 CORR
    921001:1 - change in SiCAL
    921007:2 - GALEPH: suppress call to ALGTENV replace it by GETENVF
    921104:3 - suppress correction in VDET introduced in corr # 1
               create VDET face 92
               VDNOCL: redefine a row index after bank extension
    921119:4 - VDNOCL: reset ELNOI and ELNOP to zero to avoid
                       edge effects
               GALEPH: redefine length of GEANT ZEBRA array to fit SiCAL
    930113:5 - LCFRAL: compute XOUT when there is a full track element
                       (ITRKEL(8).NE.1)
    930113:6 - HCAL mods in shower development
    930208:7 - CAPGET remove correction introduced in previous
                      correction file
         In *CD -> GALNEWS
    suppress all references to CRAY
    replace ALCONS by ALBITW and ALCONS without any reference to the
    number of bits in a word.
    new historian flag BIT64 to select 64-bit words machine.
         In *CD -> SKELNEWS
     to avoid linking problems on UNIX machines, the KINE options 'LUND'
     ans 'SJET' are removed.
     They can be replaced by KINE 'USER' or by reading a KINGAL file
     ASKLUN, ASKLUI, ASKJET - purged
     ASREDC, ASRTYP, ASKINE - modified
         In *CD -> GEOMNEWS
    AGCHCK, AGGEAN, AGGATT, AGGORD:
    calls ALGTDB instead of MDARD with the setup code to avoid to
    repeat on the data base geometry banks with different NR but
    with identical content.
    AGCHCK, AGSCAL, AGVDET:
    change test on setupcode from .EQ.last to .GE.last
         In *CD -> ECALNEWS
    ECIRUN : use ALGTDB instecd of MDARD to get bank depending on
             the setup code
         In *CD -> HCALNEWS
    HCFITU : call HCTKSP with different argument names to please
             SHIFT compiler
         In *CD -> LCALNEWS
    LCIRUN : use ALGTDB instecd of MDARD to get bank depending on
             the setup code
         In *CD -> VDETNEWS
    VRDGAL,VDDIGI : use ALGTDB instecd of MDARD to get bank depending
                    on the setup code
    VDCLU,VDNOCL  : setupcode < or = LROWS('VDEL')
  -----------------------------------------------------------------
  ! GALEPH 25.3   920910   18.00
    ++++++++++++++++++ BECAREFUL +++++++++++++++++++++++++++
               GALEPH 25.3 needs ALEPHLIB 14.0
               it should be linked to GEANT 315
    ++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
    corr. in  :
      1         VDHIT   do not retain hits with ENER=0.
                ASxxxx  get PART bank before run intialisation
                ASWRTP  drop T-list before using it and then make T=0
                ASREAD  when no input file make sure RUNH comes 1st
                        on C-list.
      2         ITTOFE  limit Z hit position to the wire max. length
                ISBEND  when Z=limit return 1st or last TDIF value
      3         ASIMOD  keep all detectors in the geometry even when
                        they are not required on a SETS card.
                GALEPH   set IW(5) and IW(6).
                ASINIT   set LINPIO and LOUTIO as IW(5) and IW(6).
                ASIGEA   change TCUT(3)=CUTHAD from 10Mev to 6Mev
                         when using GEANT 315.
                AGVDET   same vdet face geometry in 91 and 92.
      4         ASINIT   do not kill HCAL dead tubes in GALEPH,
                         it is done in QMUIDO.
      5         ASKTRK   redefine TPC region for the 92 beam pipe.
      6         CAGERB   reset the output argument NRJDP=0 when
                CAHGRB   entering the routine.
                EHSHOW   fill a new row when there is energy to
                         deposit (NRJDP .gt. 0)
      7         ASIEVE   print correctly the trigger # being processed
                         when reading an input file and using NEVT card.
    mods in :   ASREDC   suppress opening of data cards file
                GALEPH   move it to GALEPH
                HCCRPL   decode plane # for different period.
                HTDEAD   take into account the shift of tubes in barrel.
                VDCLU    small bug
    -----------------------------------------------------------------
  ! GALEPH 25.2   920325   18.00
    GAL:GAL252.HLB, .CORR, _.FOR, _B.FOR, .OLB, _D.OLB, .INPUT,
                    .NEWS/
    GAL:GCOR252.FOR, .OBJ(in debug mode)
    GAL252 OLDLIB GAL, TXTLIB, CORR, NEWS, GEO
    GCOR252 FORTRAN GAL, TEXT GAL
    GAL252 CRAYFOR CRAYXU.401, CRAYLIB, GCOR252 CRAYFOR, OBJ
    $KEEP/gal252.lib    $KEEP/gcor252.obj
    ++++++++++++++++ BECAREFUL +++++++++++++++++++++++++++
            GALEPH 25.2 needs ADBSCONS 165
    remember that ADBS8990 DAF is forseen to analize REAL DATA
    taken in 1989-1990.
    GALEPH should always use ADBSCONS DAF.
    +++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
    mods in     : SKEL set
                  reorganization to use the ALPHARD package.
                  TRIG data card is removed and replaced by
                  NEVT, SEVT data cards
                  NEVT card refers to serial event number on input file
                  SEVT card refers to real trigger number
                  DEBU card refers to real trigger number
                  i.e. - TRIG 1 100    is replaced by   NEVT 100
                       - TRIG 5 10     is replaced by   NEVT 5 -10
                       - TRIG 1 100 10 is replaced by   NEVT 100   and
                                                        DEBU 0 0 10
                       - TRIG 1 100 1  are replaced by  NEVT 100   and
                         DEBU 1 10                      DEBU 25 125 1
                         if 1st trigger on input file has number 25
                  introduce DRAW Historian flag to protect calls
                  to GEANT drawing package
                  when selecting DRAW the following routines have to
                  be recompiles: ASCEVE, ASIGEA, ASIPAC,ASTDEB.
                  AGHCAL in GEOM set
                  make sure that there is no overlap regions in HCAL.
                  GEOM set
                  check the GEANT version number where it is necessary.
                  TPCOOR, TPWSUM
                  suppress reference to FASGAL and IEV1JO
                  HCINDU in HCAL
                  stop processing in case of stupid POISSN response.
                  HCCOIN in HCAL
                  set module number IHCMOD
                  ITC set
                  Assume all database banks are accessed via running
                  period scheme, previously only IGEO was.
                  Use new database banks IXCR, IXBW to set correct
                  trigger conditions for the ITC.
                  Modify Z resolution and S-bend simulation to use IZRS
                  and IZNL (new bank).
                  Replace use of IRES by IRRF for r-phi resolution.
                  Use new database bank IEFF to specify wire inefficiency
                  Where any new database banks are used for 1992 onwards
                  suitable constants are chosen for the previous running
                  period for backwards compatibility.
                  GRANEQ, QNEXT,ASDUMMY in GAL set
                  suppress misplaced or unecessary SAVE statment.
                  EHGEOB, EHGEOE in ECAL set
                  the decision flag to parametrize or not incident e+/e-
                  was not reset at the entrance of these subroutines
                  EDTONO in ECAL set
                  add protection against work bank too short
                  GUSTEP in GUSER set
                  allow track length up to 20m. instead of 10m.
                  before ( necessary for tracking cosmics events)
                  AGMEDI
                  use GEANT version to cope with the change of argument
                  type in GFTMED between GEANT 313 and 315
   new
   comdecks :     IRRFJJ, IZNLJJ, IZRSJJ, IEFFJJ, IXBWJJ, IXCRJJ
   purged
   comdecks :     ITDCJJ, IWSTJJ, IZSCJJ
   new
   subroutines:   introduce a *DK ALDUMMY in GAL set with ALEPHLIB
                  dummy subroutines referenced by the ALPHARD package
                  but never called by GALEPH :
                  AUNPCK - GALEPH does not unpack POT banks
    -----------------------------------------------------------
  ! GALEPH 25.1   920123   18.00
    GAL:GAL251.HLB, .CORR, _.FOR, _B.FOR, .OLB, _D.OLB, .INPUT,
                    .NEWS/
    GAL:GCOR251.FOR, .OBJ(in debug mode)
    GAL251 OLDLIB GAL, TXTLIB, CORR, NEWS, GEO
    GCOR251 FORTRAN GAL, TEXT GAL
    GAL251 CRAYFOR CRAYXU.401, CRAYLIB, GCOR251 CRAYFOR, OBJ
    $KEEP/gal251.lib    $KEEP/gcor251.obj
    mods in     : add SAVE statment in every subroutines.
                  GEOM and FAST
                  yank AGFAST and FAST set which are obsolete
                  TPCOOR
                  suppress reference to FAST common block.
                  VDAABB, VDROST
                  small bugs removed
                  GALEPH
                  increase GEANT ZEBRA array  to 400000 words.
                  AGHCAL, HRDGAL
                  adapt HCAL tracking parameters to GEANT version and
                  computer used.
                  HCINDU, HCFORD
                  remove bugs.
                  HCNAMC, HCASIG, HCNAMI
                  create a new bank HLWD to remember hit position along
                  the wire.
    new
    routines    : GSTMED in GUSER set
                  GEANT subroutine modified to not use the old
                  parameter DMAXMS as new parameter STEMAX
                  ( STEMAX is set to 1.E9) when running with
                  GEANT version > or = 3.15
                  HCHLWD in HCAL set
                  fill HLWD bank to remember the hit position
                  along the tube.
    -------------------------------------------------------------
  ! GALEPH 25.0   911010   18.00
     ========> this version is identical to GALEPH 24.3 <========
     ========> BUT ADAPTED TO GEANT 3.14                <========
    GAL:GAL250.HLB, .CORR, _.FOR, _B.FOR, .OLB, _D.OLB, .INPUT,
                    .NEWS/
    GAL:GCOR250.FOR, .OBJ(in debug mode)
    GAL250 OLDLIB GAL, TXTLIB, CORR, NEWS, GEO
    GCOR250 FORTRAN GAL, TEXT GAL
    GAL250 CRAYFOR CRAYXU.401, CRAYLIB, GCOR250 CRAYFOR, OBJ
    $KEEP/gal250.lib    $KEEP/gcor250.obj
    mods in     : GCTRAK, GCJLOC
                  modified according to GEANT 3.14
                  GALEPH
                  increase LGB (GEANT ZEBRA array) to 300000
                  decrease LIW (BOS array) to 600000 on CRAY
                  ASGPAR
                  do not call GPART for particles with type=
                  NOtrackingmarker
                  ASIGEA
                  set  IGAUTO = 0 . if AUTO data card is there
                  set IGAUTO=1.
                  ASIRUN,AGEOME
                  print GEANT geometry banks after call to GPHYSI
                  ASRUST,AJOBJJ
                  add the GEANT version number * 100 in AJOB bank
                  AGHCAL
                  new cuts adapted at GEANT 3.14
                  use HGEA bank got from DB depending on the GEANT
                  version number
                  HRDGAL
                  use MDARD to get HCOS, HGEA, HTRE banks from DB
                  get HCOS and HGEA with NR=GEANT version number
  ----------------------------------------------------------------------
  ! GALEPH 24.3   911009   18.00
    GAL:GAL243.HLB, .CORR, _.FOR, _B.FOR, .OLB, _D.OLB, .INPUT,
                    .NEWS/
    GAL:GCOR243.FOR, .OBJ(in debug mode)
    GAL243 OLDLIB GAL, TXTLIB, CORR, NEWS, GEO
    GCOR243 FORTRAN GAL, TEXT GAL
    GAL243 CRAYFOR CRAYXU.401, CRAYLIB, GCOR243 CRAYFOR, OBJ
    $KEEP/gal243.lib    $KEEP/gcor243.obj
    mods in     : AGECAL, AGHCAL, AGMUCH, GUSTEP, HCCOIN
                  use GEANT division in geometry definition.
                  replace all 'MANY' volumes with 'ONLY' volumes.
                  AGVDET
                  calls new routine AGGEAN.
                  TPWSUM
                  prints the right time per event.
                  VDDIGI
                  replace digit pointer in VDTD with strip address.
                  VDNOCL
                  correct length of strips
                  ASxxxx, AGCHCK, AGEOME, AGHCAL, GUINTI
                  prepare introduction of SICAL.
                  SICAL gets nmber 9 in the list of detectors
                  TS is deleted from the list of components
                  COIL gets number 13 in the list of components
                  MUSPMD
                  bug correction
    new routines: SUBROUTINE AGGEAN ('xx',setup)
                  xx = 2-letter code of a detector
                  returns the setup code
                  builds the GEANT geometry for this detector
                  from xMAT,xVOL,xTME,xGPA,xMED data base banks
                  INTEGER FUNCTION AGMATE (NAME)
                  returns the GEANT material # known by its name
                  SUBROUTINE GETRAN (TRAN)
                  get the translation vector of HBLA when the
                  hit is in HBL1 or HBL2.
  ---------------------------------------------------------------
  ! GALEPH 24.2   910425   18.00
     ++++++++++++++++++++++++++++++++++++++++++
         BECAREFUL THIS VERSION REQUIRES :
                 ADBSCONS =>151
      +++++++++++++++++++++++++++++++++++++++++
    GAL:GAL242.HLB, .CORR, _.FOR, _B.FOR, .OLB, _D.OLB, .INPUT,
                    .NEWS/
    GAL:GCOR242.FOR, .OBJ(in debug mode)
    GAL242 OLDLIB GAL, TXTLIB, CORR, NEWS, GEO
    GCOR242 FORTRAN GAL, TEXT GAL
    GAL242 CRAYFOR CRAYXU.401, CRAYLIB, GCOR242 CRAYFOR, OBJ
    $KEEP/gal242.lib    $KEEP/gcor242.obj
    mods in     : VDET
                  VPAR bank in read at 1st entry in VDAABB
                  VDEL bank is read at 1st entry in VDCLU, VDNOCL
                  VDEL bank replaces VELE bank
                  remove some bugs and simplify the code
                  HCAL
                  HCCRPL adopt online numbering
                  GEOM
                  AGTPCH remove bug in TPHF numbering and add some
                         materials.
                  AGBEAM wrong material in the end region.
                  AGECAL use division of space
                  AGHCAL use division of space, declare HBLA as MANY,
                         remove overlap between MUB1 and HBAR.
                  AGITCH small change
                  INTER
                  GEANT interactive graphics
  ---------------------------------------------------------------------
  ! GALEPH 24.1   910213   18.00
     ++++++++++++++++++++++++++++++++++++++++++
         BECAREFUL THIS VERSION REQUIRES :
                 ALEPHLIB =>12.2 AND
                 ADBSCONS =>140
      +++++++++++++++++++++++++++++++++++++++++
    GAL:GAL241.HLB, .CORR, _.FOR, _B.FOR, .OLB, _D.OLB, .INPUT,
                    .NEWS/
    GAL:GCOR241.FOR, .OBJ(in debug mode)
    GAL241 OLDLIB GAL, TXTLIB, CORR, NEWS, GEO
    GCOR241 FORTRAN GAL, TEXT GAL
    GAL241 CRAYFOR CRAYXU.401, CRAYLIB, GCOR241 CRAYFOR, OBJ
    $KEEP/gal241.lib    $KEEP/gcor241.obj
    mods in        : VDET
                     few bugs removed in digitizings
                     GEOM
                     new beam pipe for '91
                     a lot of screws in the LCAL + TPC support
                     GUINTI
                     introduce SATR
                     ECWSUM
                     update a print statment
                     HCAL
                     new calibration
   ----------------------------------------------------------------
  ! GALEPH 24.0   901213   18.00
     ++++++++++++++++++++++++++++++++++++++++++
         BECAREFUL THIS VERSION REQUIRES :
                 ALEPHLIB 12.2 AND
                 ADBSCONS 138
      +++++++++++++++++++++++++++++++++++++++++
    GAL:GAL240.HLB, .CORR, _.FOR, _B.FOR, .OLB, _D.OLB, .INPUT,
                    .NEWS/
    GAL:GCOR240.FOR, .OBJ(in debug mode)
    GAL240 OLDLIB GAL, TXTLIB, CORR, NEWS, GEO
    GCOR240 FORTRAN GAL, TEXT GAL
    GAL240 CRAYFOR CRAYXU.401, CRAYLIB, GCOR240 CRAYFOR, OBJ
    $KEEP/gal240.lib    $KEEP/gcor240.obj
    mods in        : VDET
                     new description of the geometry for 90 and 91.
                     ITC
                     remove a bug in the hit computation
                     introduce ITC geometry for 91
                     ASIEVE
                     remove a bug when  skipping of events
                     AGCHCK
                     restore SATR geometry
                     ASINIT,ASREADC
                     make use of the DATE data card
                     create ASIM bank in the run header record
                     APOLLO flag necessary in some routines
                     ECAL
                     changes in the digitization
                     generate noise in the adjacent towers.
   ---------------------------------------------------------------
  ! GALEPH 23.9   900922   18.00
    GAL:GAL239.HLB, .CORR, _.FOR, _B.FOR, .OLB, _D.OLB, .INPUT,
                    .NEWS/
    GAL:GCOR239.FOR, .OBJ(in debug mode)
    GAL239 OLDLIB GAL, TXTLIB, CORR, NEWS, GEO
    GCOR239 FORTRAN GAL, TEXT GAL
    GAL239 CRAYFOR CRAYXU.401, CRAYLIB, GCOR239 CRAYFOR, OBJ
    $KEEP/gal239.lib    $KEEP/gcor239.obj
    mods in         : VDET
                      better new geometry.
                      HCAL
                      introduce killing of unrecoverable dead tubes.
                      LCAL
                      move internal wire-supports to the right place
                      SATR
                      better description of the material in front of
                      LCAL. Alignment constants taken from LALI bank
                      instead of SPOS.
    -----------------------------------------------------------
  ! GALEPH 23.8   900606   18.00
    GAL:GAL238.HLB, .CORR, _.FOR, _B.FOR, .OLB, _D.OLB, .INPUT,
                    .NEWS/
    GAL:GCOR238.FOR, .OBJ(in debug mode)
    GAL238 OLDLIB GAL, TXTLIB, CORR, NEWS, GEO
    GCOR238 FORTRAN GAL, TEXT GAL
    GAL238 CRAYFOR CRAYXU.401, CRAYLIB, GCOR238 CRAYFOR, OBJ
    $KEEP/gal238.lib    $KEEP/gcor238.obj
    mods in         : VDET
                      new geometry. The old one cannot be used.
                      ADBSCONS DAF 128 must be used. When using
                      older version of the data base the VDET must
                      be switched off.
                      ITHIT
                      has been completely rewritten to improve the
                      number of hits found, especially for non-radial
                      tracks. The ITHT bank has been replaced by the
                      IHIT bank and the data describing a hit has been
                      changed.
                      Calculation of the drift time and R-Phi resolution
                      has been changed to conform to the scheme used by
                      JULIA.
                      The relevant database banks are IDTC and IRES.
                      SATR
                      introduce alignment corrections
                      FAST
                      because of new VDET and ITC code the FAST package
                      does not compile any longer. For this reason the
                      following routines as been YANKed: AGFAST,FAIHIT.
                      LCAL
                      Placed the energy depositions always at the WIRE
                      planes.
                      Remembered to transform ALSO THE DIRECTION into the
                      loca system - and not just the impact point of a
                      GEANT track.
                      Instead of trying to improve the material description
                      in front of Lcal, I have simply mapped the differences
                      in energy response between data and Monte Carlo into a
                      new table LCCA, which is used to correct the Monte
                      Carlo energies (in LCADC).
                      ASKTRK, EHDEPT
                      CRAY correction to get CHARACTER variable from
                      GEANT hollerith variable. This error affected
                      the history of energetic Bremstrahlung.
    -------------------------------------------------------------
  ! GALEPH 23.7   891123   18.00
    GAL:GAL237.HLB, .CORR, _.FOR, _B.FOR, .OLB, _D.OLB, .INPUT,
                    .NEWS/
    GAL:GCOR237.FOR, .OBJ(in debug mode)
    GAL237 OLDLIB GAL, TXTLIB, CORR, NEWS, GEO
    GCOR237 FORTRAN GAL, TEXT GAL
    GAL237 CRAYFOR CRAYXU.401, CRAYLIB, GCOR237 CRAYFOR, OBJ
    $KEEP/gal237.lib    $KEEP/gcor237.obj
    mods in             : ECAL
                          few bugs fixed
                          HCAl
                          update some tracking parameter to follow
                          GEANT 3.13 improvments (CUTH=0.02).
                          LCAL
                          better handling of dead zone
                          GEOM - SATR
                          add some materials in front of LCAL
                          ASxxxx
                          to make use of RLEP bank which
                          contains the LEP energy.
                          ITC
                          new trigger
    ------------------------------------------------------------
  ! GALEPH 23.6   890900   18.00
    GAL:GAL236.HLB, .CORR, _.FOR, _B.FOR, .OLB, _D.OLB, .INPUT,
                    .NEWS/
    GAL:GCOR236.FOR, .OBJ(in debug mode)
    GAL236 OLDLIB GAL, TXTLIB, CORR, NEWS, GEO
    GCOR236 FORTRAN GAL, TEXT GAL
    GAL236 CRAYFOR CRAYXU.401, CRAYLIB, GCOR236 CRAYFOR, OBJ
    $KEEP/gal236.lib    $KEEP/gcor236.obj
    Becareful the correction file has been renamed. It has the same
    name on VAX CRAY and IBM : GAL:GCOR236.FOR, .OBJ
                               GCOR236 FORTRAN GAL, TEXT GAL
                               $KEEP/gcor236.obj
    GALEPH does not contain the RDST package which is an independant
    library kept as:
          GAL:RDST.HLB, .FOR, .NEWS, .OLB, _D.OLB
          RDST OLDLIB GAL, NEWS GAL, TXTLIB GAL
    The GALEPH steering routines with the flag RDST ON are kept on:
          GAL:GRDST236.FOR, .OBJ / GRDST236 FORTRAN GAL, TEXT GAL
    RDST is called by GALEPH through the data card:
          PROC  'RDST'
    in this case the program must be linked with:
          GAL:GRDST236.OBJ / GRDST236 TEXT GAL
          GAL:RDST.OLB     / RDST TXTLIB GAL
    GALRUN has been modified accordingly.
    BCS size has been increased to 900000 words.
    ECAL geometry is set by default to 2 (3 stacks) : the data card
         GEOM   'ECAL'  2    is no longer necessary
    mods in              :LCAL
          - the default running mode is changed again to be without
            noise generation. It does not affect the important
            features of the data anyway. And you gain a lot on
            both speed and size by having no noise. (LCDIGI)
          - If you choose to run with noise (LCNOIS), then the
            noise generation has also been changed a bit
            The energy dependent noise and coherent noise are
            fluctuated independently in the four modules, and it
            runs faster since only non-empty channels are considered.
          - Energy is not deposited in the dead channels listed
            in the database. (LCSHOW)
          - The previous code assumed that the Event Builder
            did not use floating point operations. Well it does,
            so I changed that (although it makes little difference)
            (LCADC).
          - We have observed a large difference between the wire
            and pad energy near the wire support. This I have
            tried to simulate by increasing the live area of the
            wires which is then different from the live area
            of the pads. (LCXYPA)
    new package           : MUON
             complete rewriting of the package to follow the new
             geometry
    mods in               : HCAL
             correction of bugs in history banks, and tube address
                            SKEL
             'S'list is used to collect banks belonging to a run, in
              order to drop them at end of run.(mods in ITC and SATR)
                            TRIGGER
              Level 2 has been moved to ALEPHLIB 9.9
    --------------------------------------------------------------
  ! GALEPH 23.1   890627   18.00
    GAL:GAL231.HLB, .CORR, _.FOR, _B.FOR, .OLB, _D.OLB, .INPUT,
                    .NEWS/
    GAL:CORR231.FOR, .OBJ(in debug mode)
    GAL231 OLDLIB GAL, TXTLIB, CORR, NEWS, GEO
    CORR231 FORTRAN GAL, TEXT GAL
    GAL231 CRAYFOR CRAYXU.401, CRAYLIB, GCOR231 CRAYFOR, OBJ
    $KEEP/gal231.lib    $KEEP/gcor231.obj
    new VDET digitizings : is NOT implemented because of problems with
                           the code.
    new package          : bookkeeping can be called with BOOK data card.
    new routine          : TPCOOR
    mods in              : ITC digitizings
                           SATR digitizings
                           TRIGGER package, trigger level 1 routines are
                           purged, routines from the ALEPHLIB are used.
                           TCUT data card, cuts are kinetic energy cuts
                           (documentation DATDOC was wrong).
                           update AFID beam energy with the EVEH beam
                           energy (ASCEVE).
                           change calls to GSPART to use char. variable
                           instead of integer (ASGPAR).
                           GALEPH - initialization of RANECU
    mods in              : ECAL - 3 stacks and mods in parametrization.
                                  treatment of minimum ionizing particles.
                                  several changes in digizitation part.
                           HCAL - add tube efficiency
                                  changes in digitization part: new banks.
    reorganisation of the historian library in view of the documentation
    the following sets have been defined:
       *SET GAL,GALNEWS.GALEND
       *SET SKEL,SKELNEWS.SKELEND
       *SET DRAW,DRAWNEWS.DRAWEND
       *SET GEOM,GEOMNEWS.GEOMEND
       *SET CALO,CALONEWS.CALOEND
       *SET ECAL,ECALNEWS.ECALEND
       *SET FAST,FASTNEWS.FASTEND
       *SET GUSER,GUSENEWS.GUSEEND
       *SET HCAL,HCALNEWS.HCALEND
       *SET LCAL,LCALNEWS.LCALEND
       *SET MUON,MUONNEWS.MUONEND
       *SET RDST,RDSTNEWS.RDSTEND
       *SET SATR,SATRNEWS.SATREND
       *SET TPC,TPCNEWS.TPCEND
       *SET VDET,VDETNEWS.VDETEND
       *SET TRIG,TRIGNEWS.TRIGEND
       *SET 1,DOCNEWS.DOCEND
       *SET HAC,HACNEWS.HACEND
    ---------------------------------------------------------------
    GAL:GAL230.HLB, .CORR, _A.FOR, _B.FOR, .OLB, _D.OLB, .INPUT,
                    .NEWS, .GEO/
    GAL230 OLDLIB GAL, TXTLIB, CORR, NEWS, GEO
    The correction files are kept as:
    GAL:CORR230.FOR, .OBJ(in debug mode) / CORR230 FORTRAN GAL, TEXT
    the version needs a .GEO files because of some banks not yet put
    on the data base: GAL:GAL230.GEO / GAL230 GEO GAL
    Trigger banks xxTR are built in DIGI process. That was true for
    ECAL and ITC, but not for HCAL and LCAL. The corresponding code
    has been moved from HCASIG/LCASIG to HCDIGI/LCDIGI. So it is now
    possible to reprocess the TRIGger without reprocessing the TRACking
    but the DIGItization has to be reprocessed too.
    Work has been done to modified word(4) of KINE and FKIN banks:
    the mass of the track replaces the energy.
    It is still possible to read KINGAL files created with ALEPHLIB
    version < 9.0 ( that means with the energy instead of the mass).
    KMACRO has been modified such that:
    ENERVK(JVK) is the energy of the track known by its BOS index JVK.
    PMASVK(JVK) is the mass of the track known by its BOS index JVK.
    PARMAS(JPA) is the mass of the aleph particle # JPA.
    A version # has been introduced in the correction file GALxxx CORR
    it is printed in the title and stored in the AJOB bank.
    Work has been prepared to be able to use RNDM or RANMAR or RANEQU
    as random number generator. It is forseen to use RANMAR in KINGAL
    and RANECU in GALEPH.
    To cope with this change the variable NRNDJO has been dimensioned
    to LRND=3 and IRNDJO(LPRO) to IRNDJO(LRND,LPRO).
    Routines RDMIN and RDMOUT are called with NRNDJO(1) or IRNDJO(1,n)
    such that if RNDM is used it will work as before, if RUNECU is used
    the 1st 2 elements of NRNDJO / IRNDJO will be set/used, if RANMAR
    is used then the 3 elements of NRNDJO / IRNDJO will be set/used.
    When using RNDM 1 seed is used to restart on a given event:
                    RNDM    234567
    When using RANECU 2 seeds are used to restart on a given event:
                    RNDM    3657489   77668943
    When using RANMAR 3 seeds are used to reastart on a given event:
                    RNDM    5486953   98100     0
    to start a GALEPH run using RANMAR and the specific lab. seeds:
                    RNDM    10001     123      -1
    For more details refer to B.Bloch who is in charge of the
    implementation of these generators.
    - update PARTJJ to cope with the new content of the PART bank.
    - introduce new history banks ESHI, EWHI, LSHI, LWHI
      the banks ETHT is derived from ESHI
                EWHT                 EWHI
                LTHT                 LSHI
                LWHT                 LWHI
      in calling a new INTEGER FUNCTION from the ALEPHLIB 8.92 :
                JxyHT = CAFIHT (NAxzHI,'xyHT')
      the following banks ARE written onto the output:
                ESHI, LSHI
      the following banks ARE NOT written onto the output:
                EWHI, ETHT, EWHT, LWHI, LTHT, LWHT
      the following banks DO NOT EXIST any longer:
                ETTD, EWTD, LTTD, LWTD
    - call ASRETP internally inside ASIEVE to skip events before the
      1st event to be processed.
    - new code for the ITC.
    - new code for the VDET (the geometry is still the old one).
    ---------------------------------------------------------------
    GAL:GAL220.HLB, .CORR, .FOR, .OLB, _D.OLB, .INPUT, .NEWS/
    GAL220 OLDLIB GAL, TXTLIB, CORR, NEWS
    The correction files are kept as:
    GAL:CORR220.FOR, .OBJ(in debug mode) / CORR220 FORTRAN GAL, TEXT
    THE VERSION WORKS WITH GEANT 3.12
    THE VERSION HAS BEEN RESEQUENCED
    The version before resequencing is kept as GAL210, only the
    Historian library is kept.
    -----------------------------------------------------------------
    GAL:GAL203.HLB, .CORR, .FOR, .OLB, _D.OLB, .INPUT/
    GAL203 OLDLIB GAL, TXTLIB, CORR
    GAL:TPCSIM.HLB, .OLD / TPCSIM OLDLIB GAL, TXTLIB
    the correction files are kept as:
    GAL:CORR203.FOR, .OBJ(in debug mode) / CORR203 FORTRAN GAL, TEXT
    GAL:TPCCORR.FOR, .OBJ(in debug mode) / TPCCORR FORTRAN GAL, TEXT
    The version requires ALEPHLIB 8.5
    There is a new GAL:GALRUN.COM / GALRUN EXEC GAL
    The following features have been implemented:
     - GET and SAVE data cards are obsolete. Use instead:
       FILI  'fname ftype fmode | alephtype | GIME ......'
       FILO  'fname ftype A  | alephtype'
       i.e. : FILI 'ALEPHDATA:FLRLUN01.EPIO'
              FILI 'FLRLUN01 EPIO *  | GIME PUBXU 403 Z'
              FILO 'SCWEEK:MCDIG312.DAT | NATIVE'
              FILO 'MCDIG312 DAT A | NATIVE'
     - to read a .GEO file:
       FGEO  'GAL:GAL201.GEO | CARDS'
       FGEO  'MYGEO 203 * | CARDS | GIME FLR 192 D'
     - to read a non-standard data base:
     - FDBA  'DBASE:ADBSCONS DAF107 '
     - FDBA  'ADBSCONS TEST109 * | DAF | GIME PUBXU 210 *'
     - Trigger Level 2 is implemented:TTHT is produced by default.
     - Trigger Level 1 is modified.
     - New HCALDES is implemented.
     - Historian flags HCDETAIL and HCAVERAG are removed.
     - primary track definition has been updated to include:
       * muons, daughters of primaries.
       * particles with a mementum above 40Mev in the ITC and daughters
         of primaries. (the previous cut was at 100Mev).
    ==================================================================
    GAL:GAL202.HLB, .CORR, .FOR, .OLB, _D.OLB, .INPUT/
    GAL202 OLDLIB GAL, TXTLIB, CORR
    GAL:TPCSIM.HLB, .OLB / TPCSIM OLDLIB GAL, TXTLIB
    the correction files are kept as:
    GAL:CORR202.FOR, .OBJ(in debug mode) / CORR202 FORTRAN GAL, TEXT
    GAL:TPCCORR.FOR, .OBJ(in debug mode) / TPCCORR FORTRAN GAL, TEXT
    TPCSIM can be called from GALEPH on request (data card: TPCSIM)
    the BOS array as been enlarged to 800000 words to contain TPCSIM
    banks.
    the GAL:GALRUN.COM / GALRUN EXEC GAL has been modified to call
    TPCSIM on request.
    the FXXX package can be called from GALEPH on request:
        data card  FXXX
    the definition of a PRIMARY track has been changed to be:
        a track which is a daughter of a primary with its origin in
        the central detector up to the outer wall of the TPC but the
        endplate of the ITC and the endplate of the TPC, with a
        momentum above 100Mev.
    a primary which produces a bremstrahlung or a delta ray which takes
    more than 15% of its energy will be stopped and a new particle will
    be recorded.
    an end vertex is recorded for charged primary tracks.
    bug corrected in LCTRAK, RDST, EHSHOW, HCFORA, AGECAL, AGLCAL
    the outside detectors (ECAL,LCAL,SATR,HCAL,MUON) are physically
    removed (geometry level set to 0) if they are not digitized ( do
    not appear ob the data card SETS).
    Remember that MUON detector is attached to the HCAL so you cannot
    require MUON without HCAL.
    It is not reasonnable to required HCAL without ECAL. In any case the
    computer time per event will increase if ECAL is not require because
    the shower parametrization is not turned on.
    geantino parametrization is ON by default for electrons/positrons.
    to use the previous parametrization give a data card:
        RUNC  'ECAL' 0 0 0 0 1
    GAL202 is still working with GEANT311.
    GAL210 should work with GEANT312 and be resequenced!!!!!!!!!!
    ----------------------------------------------------------------
    GAL:GAL201.HLB, .CORR, .FOR, .OBJ, _D.OBJ, .INPUT, .GEO/
    GAL201 OLDLIB GAL, TXTLIB, CORR, GEO
    The correction files are kept as:
    GAL:CORR201.FOR, .OBJ(in debug mode) / CORR201 FORTRAN GAL, TEXT
    The RDST option must load GAL:RDST.OBJ / RDST TEXT GAL
    The FAST RDST option must load GAL:FRDST.OBJ / FRDST TEXT GAL
    The version works with HBOOK4. Because of incompatibilities of
    GEANT and HBOOK4/HPLOT5, to run the interactive version of GALEPH
    one has to link with the previous libraries. To do so use the
    command file GAL:GALINT.COM instead of GAL:GALRUN.COM.
    Use the Historian flag INTER to select the interactive version,
    recompile the Historian set IFINTER.
    The GEO file contains LCAL banks which should go to the data base:
    wait for the A.Putzer's message. In the meantime use GAL201 GEO .
    Bugs are removed from  RDST, ASxx.
    New code in LCAL, RDST, GUFLD.
    EPIO and NATIVE files are written with BLKSIZE 32760. For EPIO files
    BOS has to be told through a call to BUNIT that the record length is
    16380 16-bit words.
    New Historian flag HCAVERAG to get average medium geometry and
    parametrization a la "Della Negra" in the HCAL.
    New Historian set IFINTER to get routines to be recompiled when
    Historian flag INTER is used.
    The code for the "geantino" parametrization is implemented for the
    ECAL/HCAL code writers ONLY.
    =================================================================
    GAL:GAL200.HLB, .CORR, .FOR, .OBJ, _D.OBJ, .INPUT, .GEO/
    GAL200 OLDLIB GAL, TXTLIB, CORR, GEO
    The correction files are kept as:
    GAL:CORR200.FOR, .OBJ(in debug mode) / CORR200 FORTRAN GAL, TEXT
    The RDST option must load GAL:RDST.OBJ / RDST TEXT GAL
    The FAST RDST option must load GAL:FRDST.OBJ / FRDST TEXT GAL
    This version works with ALEPHLIB 7.8
    The Historian flags TATINA, CASCADE, GHEISHA have been removed: GHEISHA
    is used by default. It is no longer necessary to specified the historian
    flag GHEISHA in the Historian input file.
    The GEO file is empty. It can be used for new data base banks (not yet
    on the data base) or to change the content of a data base bank. Banks
    which are read from the GEO file will be written onto the output file.
    Extra banks which have to be written onto the output file can be read
    either from the GEO file as before or from the CARDS file as long as
    the card UNIT 14 is removed and the extra bank cards are placed behind
    the card ENDQ.
    If no GEO file has to be read it is enough to suppress the card UNIT 14.
    Bugs are removed from MUON, HCAL, RDST, ASxx, KMACRO.
    Add DEDX simulation in RDST.
    Use OPENSQ to access the input file if any in ASREIN, This allows a
    READONLY access on VAX.
    =================================================================
    GAL:GAL199.HLB, .CORR, .FOR, .OBJ, _D.OBJ, .INPUT, .GEO/
    GAL199 OLDLIB GAL, TXTLIB, CORR, GEO
    The correction files are kept as:
    GAL:CORR199.FOR, .OBJ(in debug mode) / CORR199 FORTRAN GAL, TEXT
    This version works with ALEPHLIB 7.7
    The GEO file has changed.
    Bugs are removed from HCAL, RDST, ASxx.
    ITDCNS, ITRGPA have been modified so that they no longer require banks
    from the geometry file. Default values are set in these routines. If the
    banks ITCB or ITPA are provided in the steering datacards file the
    values from there will override the defaults.
    ITHIT now checks for stack tracks in the ITC. Hits due to stack tracks
    are flagged by setting the track number negative.
    ITDRFT no longer calculates random ionisation centres along track
    elements as a component of the ITC resolution.  Instead, the drift time
    corresponding to the closest point to the sense wire is used. All the
    resolution effects are simulated in ITRES.
    A new correlation bank, IDHR, has been added to relate digits to hits.
    (The banks already existing relate digits <=> tracks.)
    The ITC chapter of the writeup has been updated.
    Implementation of the RUNR as 1st bank of a run record.
    At the same time implementation of a new facility:
      write the RAW data and the MC data on 2 different BOS records.
      The default stays as before (1 record per event)
    new intrinsic function in KMACRO:
      MOTHVK(jvk) = mother track # of a track known by its BOS
                    index jvk.
    Clean up the /JOBCOM/ and /JQCOM/ : remove unused flags and name
    indices.
    Remove the non-tabular bank ASRU (galeph run header) . Write
    instead the following tabular banks :
      ACUT : galeph tracking cuts
      AFID : galeph fiducial parameters
             magnetic field value = RTABL (JAFID,1,3) should be used
             by downstream programs (TPCSIM, JULIA, etc..)
      AJOB : galeph job conditions
      AKIN : galeph kine parameters
      APRO : galeph process conditions
      ARUN : detector run conditions
      ATIT : galeph run title
    Full description can be found with SBANK.
    Use OPENDB to access the data base in ASREDB
    Do not use the FIDU data card unless you want to change the defaults
                Rmx=650. Zmx=600. magfld=15.  Ecms=90.
    Do not use the TCUT data card : cuts are set by the algorithm used.
    Check carefully the run summary to be sure that data card parameters
    were not mixed up.
    =================================================================
    GAL:GAL198.HLB, .CORR, .FOR, .OBJ, _D.OBJ, .INPUT, .GEO/
    GAL198 OLDLIB GAL, TXTLIB, CORR, GEO
    The correction files are kept as:
    GAL:CORR198.FOR, .OBJ(in debug mode) / CORR198 FORTRAN GAL, TEXT
    This is still an intermediate version, the ECAL is still using
    data statments in the ECALDES, and the ITC still needs banks from
    the .GEO file.
    This version works with ALEPHLIB 7.5 .
    So there is a new .GEO file which contents 2 banks for the HCAL
    and few banks for the ITC.
    This version has been installed with HCDETAIL flag ON, full
    generator ON in HCAL with the following cuts in the HCAL part:
      CUTGAM = 2.4MeV, CUTELE = 2.4MeV
    in the ECAL the parametrization for the electrons in ON with the
    default cuts:
      CUTGAM = 5.MeV, CUTELE = 5.MeV, CUTMUO=CUTHAD=CUTNEU = 10.MeV
    The HCAL reading of the data base has been reorganized to be later
    on incorporated into the ALEPHLIB.
    There is a new VDET package which reads the data base and implements
    the new design of the VDET.
    Bugs has been found everywhere
    A new GALEPH write-up will be published.
    ===================================================================
    GAL:GAL197.HLB, .CORR, .FOR, .OBJ, _D.OBJ, .INPUT, .GEO/
    GAL197 OLDLIB GAL, TXTLIB, CORR, GEO
    This is still an intermediate version, the data base is not
    yet fully implemented.
    There is a new .GEO file which still contents few banks.
    This version has been implemented with HCDETAIL flag ON,
    full generator ON in HCAL and the following cuts on particle
    energy:  TCUT   0.002   0.002   0.01   0.01   0.01
             *      photon  elec    neuth  chargh muon
    and the parametrization of the electrons in ECAL.
    The time per event is longer but the ECAL/HCAL test beam
    data are well reproduced.
    ITC  - remove code using ITCA and ITCB banks
    ECAL - new ECALDES (ALEPHLIB 7.5)
           new geometry description ready to accept 3 different
           media for the 3 different stacks.
           set of standard histogramms is implemented. Look at
           ECDOC for the definition.
           new ECAL documentation kept on CERNVM:
               ECALDOC LISTING GENERA
    HCAL - bug corrections
           changes in few geometrical numbers
    MUON - use now the data base
    LCAL - use now the data base
    -----------------------------------------------------------
    GAL:GAL196.HLB, .CORR, .FOR, .OBJ, _D.OBJ, .INPUT, .GEO/
    GAL196 OLDLIB GAL, TXTLIB, CORR ,GEO
    It is an intermediate version which used the data base to get
    the following banks:
        - PART, GDEC
        - ITC geometry and readout
        - TPC geometry
        - HCAL geometry and readout
        - passive materials BPIP, COIL, QUAD
        - SATR geometry and readout
        - TRIG readout
    MUON will be implemented later, ECAL simulates data base with
    data statments (so no more ECAL banks on GEO file).
    VDET and LCAL are still missing.
    data base banks are not written onto the output file, but
    the banks which have been modified either by data cards (read
    from the GEO file) or by program (i.e. the PART bank).
    mods in    : EDTONO
                 ASFAST, ASFXXX
                 ASKLUI (use KXLUCO to set LUND parameters by
                         data cards)
                 ASKLUN, ASKSIN, ASPEVE, ASKTRK, ASINIT ( book
                 and fill the new bank 'KVOL' defined below)
                 KVOL, NR=0   filled once per event with a list
                              of vertex volume names
                 +1         # of columns (=1)
                 +2         # of vertices in the event
                 =========================================
                 +1         volume name of the vertex
                 ==========================================
                 AGCHCK (book and fill the new bank 'VOLU')
                 VOLU, NR=0   filled once per run with a list
                              of all existing volume names.
                 +1         # of columns (=1)
                 +2         # of sensitive volume names
                 ==========================================
                 +1         sensitive volume name
                 ==========================================
   new statment functions in KMACRO to access content of the VERT and
   KINE banks:
   - # of vertices on a track known by its BOS index JVK /
     # of outgoing tracks of a vertex known by its BOS index JVK
       NOFVK(JVK)
   - Particle type of a track known by its BOS index JVK  : KINTYP(JVK)
   - incoming track # of a vertex known by its BOS index JVK: INPTRK(JVK)
   - origin vertex # of a track known by its BOS index JVK: INPVRT(JVK)
   - momentum of a track known by its BOS index JVK : PMODVK(JVK)
   - energy of a track known by its BOS index JVK : ENERVK(JVK)
   - time of flight of the icoming particle to the vertex known by its
     BOS index JVK : TOFLIT(JVK)
   - radius of the cylinder defined by the vertex known by its BOS
     index JVK : RADVK(JVK)
    ------------------------------------------------------------
    GAL:GAL195.HLB, .CORR, .FOR, .OBJ, _D.OBJ, .INPUT, .GEO/
    GAL195 OLDLIB GAL, TXTLIB, CORR ,GEO
    It is an intermediate version which uses the data base to get
    the following banks:
        - PART, GDEC
        - TPC geometry
        - ITC geometry (read from the GEO file but in the new format)
        - passive materials BPIP, COIL, QUAD geometry
    MUON ,ECAL ,SATR and HCAL will be implemented in the next release.
    mods to clean up the program and be ready for the data base.
    new KINE module (see GAL193.NEWS)
    magnetic field in iron is introduced according to the J.Steinberger's
    region definition.
       -------------------------------------------------------------------
    GAL:GAL193.HLB, .CORR, .FOR, .OBJ, _D.OBJ, .INPUT, .GEO/
    GAL193 OLDLIB GAL, TXTLIB, CORR, INPUT, GEO
    It is an intermediate version which uses the data base to get
    the 'PART' and 'GDEC' banks.
    this version must be run with the new GAL:GALRUN.COM /
    GALRUN EXEC GAL.
    this version calls subroutines from ALEPHLIB 7.0
    It contains:
    - reading of the data base to get 'PART' and 'GDEC' banks (ASREDB)
    - mods in the KINE module in order to use the ASKUSI, ASKUSE
      routines in the same way in GALEPH and in the stand-alone
      KINGAL program.
      ==> mods in /KINCOM/
      ==> move the initial vertex calculation to ASKLUN, ASKSIN, ASKUSE
      ==> call ASKLUN, ASKSIN, ASKUSE with the same set of arguments
          ASK... (IDEV,ISTA,NITR,NIVX,ECMS,WEIT)
     - new format of the PRIN and HIST data cards:
       PRIN   'VDET'  'ITC '  'TPC '
       is equivalent to:
       PRIN     1       2       3
       the possible 'name's for the PRIN card are:
       VDET, ITC , TPC , ECAL, LCAL, SATR, HCAL, MUON, TRIG, RDST,
       INPU, OUTP, KINE, TREL, DRAW, PART, GEOM
       the possible 'name's for the HIST card are:
       VDET, ITC , TPC , ECAL, LCAL, SATR, HCAL, MUON, TRIG, RDST,
       KINE
       both formats are compatible and can be used simultaneously.
     - implement the mini-dst format FXXX:
       mods in /JOBCOM/ : new logical flag FXXXJO
       mods in ASCEVE to call ASFXXX in case the FXXX format is required.
       mods in SAVE data card: add a new parameter 'FXXX'
       SAVE  unit# / 'FXXX'   means write FXXX format in native mode.
       SAVE  unit# / 'EPIO'  'FXXX' means write it in EPIO mode
       SAVE  unit# / 'EPIO'   means write standard format in EPIO mode.
     - mods in KMACRO to used name-indices from /JQCOM/ .
     - bug removal in FS.... module.
     - cleaning of the RDST module.
   ----------------------------------------------------------------
    GAL:GAL192.HLB, .CORR, .FOR, .OBJ, _D.OBJ, .INPUT/
    GAL192 OLDLIB GAL, TXTLIB, CORR, INPUT
    It is an intermediate version which works with GAL190.GEO .
    It contains :
    - mods in the fast tracking process: FSxxxx
      must be used with ALEPHLIB 6.1
      mods in TPC module, LCAL module, ECAL module
    - rewriting of GUSTEP, ECHIT, HCHIT to introduce the common
      parametrization to ECAL and HCAL.
    - new routines ASTDEB called by at the end of GUSTEP to debug the
      step or compute IMPAct points.
    - new *CD KMACRO , used also in the KINGAL package, to access directly
      contents of PART, KINE, VERT banks.
      new *CD GMACRO , used in GUSTEP to access directly GEANT common blocks.
      new *CD TMACROD and TMACROF to access directly TRKCOM content.
    - new variables in /TRKCOM/ : ITRKEL(11)  = particle tracking type
                                  TRKVOL      = volume name (character*4)
                                  FTRHAD      = hadron stopping by hadronic
                                                interaction.
                                  TINOX0      = if it is a geantino:
                                                current X0 value
                                  TINOL0      = current L0 value
    - change in the definition of the PRIMARY particles ( the ones which are
      kept in KINE and VERT banks) : all particles with a Pmod > 1.Gev and
      particles produced in the central part with a Pmod > 0.1 Gev are
      called primaries and kept in KINE / VERT banks.
    - new routine MUWSUM : to print a muon run summary.
    - corrections of bugs in:
    GAL:GAL190.HLB, .CORR, .GEO, .FOR, .OBJ, _D.OBJ, .INPUT, .CARDS /
    GAL190 OLDLIB GAL, TXTLIB, GEO, CORR, INPUT, CARDS
    the geometryfile used by GAL190 has few modifications in COG1
    (coil) and HBG1 (hcal barrel) and the HQG2 AND HSG2 have been
    removed.
    It contains:
    - Make use of the ALEPHLIB 04.0 which contains the KINGAL event
      generator interface kept in the *SET KINE
    - mods in SATR and HCAL
    - mods in ASKxxx module (KINEmatic module)
    - mods in KINCOM : VRTXKI and PLABKI are now dimensioned to 4
    - full doc for SATR and HCAL in decks SADOC and HCDOC
    - mods in ECAL and new ECDOC
    - mods in RDST
    - mods in AGxxxx
    - minor bug corrections in TRIG
    - new routine TPCOOR called by default in DIGI process
    - creation of a *SET for each module containing *CD and *DK
      belonging to a module:
      ALEPH   : ALCONS, BCS, BMACRO, JOBERR
      GCOM    : GEANT *CD
      SKEL    : general *CD and *DK ASxxxx
      GEOM    : AGCONS,ALFGEO,AGxxxx
      GUSER   : GCKING, GCMATE, GUxxxx
      DISPLAY : GAXEPH,ADxxxx
      VDET, ITC, TPC, ECAL, LCAL, SATR, HCAL, MUON, FAST, RDST, TRIG
   ------------------------------------------------------------------
    GAL:GAL180.HLB, .CORR, .GEO, .FOR, .OBJ, _D.OBJ, .INPUT, .CARDS /
    GAL180 OLDLIB GAL, TXTLIB, GEO, CORR, INPUT, CARDS
    is stored on minidisk GAL on VM / directory GAL: on VAX
    It contains:
    - Make use of the ALEPHLIB 03.0 and GAL180.GEO
      AUBOS has been renamed as ALBOS on ALEPHLIB 03.0 (calls ALTELL
      when not enough space when booking a bank).
      There is a new routine AUBOS with the same calling sequence than
      ALBOS BUT does not call ALTELL , return IGARB=2 and KNDX=0 when
      not enough space.
    - *IF CYBER for CYBER205 type of machines : used in BMACRO and
      GALEPH
    - new ECAL shower parameters.
    _ mods in ASxxxx to read event generator input file (not final).
    - minor mods in VDET, ITC, HCAL, LCAL, SATR, FAST, RDST
    - major mods in ITC : linear drift-time relation
                          make use of the time of flight given by GEANT
                          new bank ITCB in the geometry file
                          better documentation
   - mods in TPC        : TPCO bank format is changed to 2I,(I,6F)
                          the content follows now the definition
                          TPCO is filled only on request:
                          ICTPJO(6)=1 means fill TPCO
                          the routine TPRHIT has been moved to
                          the ALEPHLIB.
   ----------------------------------------------------------------------
    GAL:GAL170.HLB, .CORR, .GEO, .FOR, .OBJ, _D.OBJ, .INPUT, .CARDS /
    GAL170 OLDLIB GAL, TXTLIB, GEO, CORR, INPUT, CARDS
    is stored on minidisk GAL on VM / directory GAL: on VAX
    It contains:
    - Make use of ECALDES from the ALEPHLIB 02.0
    - empty *CD's and *DK's such as AAA and ZZZ to help documentation
      tools.
    - *IF CYBER for CYBER205 type of machines : used in BMACRO and
      GALEPH
    - new TRIGGER module : reorganisation of the old one.
    - new routine ASIMOD to initialize various modules (detectors, FAST,
      RDST) before calling the geometry package. This initialization was
      done before in ASIPAC after calling the geometry package.
    - new ECAL shower parameters.
    _ mods in ASRKIN to read event generator input file (not final).
    - mods in VDET, ITC, HCAL, LCAL, SATR, FAST, RDST
    - TCUTJO is now preset in ASINIT to : .005, .005, .01, .01, .01
    ---------------------------------------------------------------
   MC:GAL163.HLB, .CORR, .GEO, .FOR, .OBJ, _D.OBJ /
   GAL163 OLDLIB MCARLO, TXTLIB MCARLO, GEO MCARLO, CORR MCARLO
   is an intermediate version which contains:
    - the use of the MC:ALEPHLIB.HLB, .OLB / ALEPHLIB OLDLIB GENERA,
                                                      TXTLIB GENERA
    - the use of the routines:
      ALBOS ('NAME',NR,LE,INDX,IGARB) from ALEPHLIB
       with  IGARB = 0  the bank is booked/enlarged
                     1  Ok but a garbage collection occured
                     2  not enough space to book/enlarge
                        so the routine ALTELL from ALEPHLIB is called
                        to go to the NEXT event.
      ALTELL ('MESSAGE',IERROR,'ACTION') from the ALEPHLIB
       with  MESSAGE = a character string to be printed
             IERROR  = an error code in the range [1,LERR]
             ACTION  = an action to be taken:
                       RETURN, NEXT, END, FATAL
   - creation of historian SETS
      *ST IFRDST,ASRDST,ASIMOD,ASPEVE,ASCRUN,ASASIG,GUSTEP
      *ST IFFAST,ASIMOD,ASPEVE
      *ST IFPACK,ASIPAC,GUHADR,GUPHAD
      *ST IFHCDET,AGHCAL,HCCRTO,HCIEVE,HCHIT
     these SETS must be compiled when using the corresponding
     historian flag:
      *DF RDST
      *E IFRDST
   or *DF TATINA
      *E IFPACK
   or *DF FAST,RDST
      *E IFFAST,IFRDST
   or *DF HCDETAIL
      *E IFHCDET
   _ introduction of the FAST tracking package (J.Higart, M.Mermikides)
     must be used with: *DF FAST,RDST
                        *E IFFAST,IFRDST
     and a data card PROCess 'KINE'  'RDST' ('TRAC' and 'HITS' are set
                                              by default)
     no need for a SETS card : the necessary detectors are set by default
   - use the new BOS facility: BUNIT, BREAD, BWRITE
   - new format for the data card RNDM:
     RNDM process# / root  (process# 1:KINE, 2:TRAC, 3:HITS, 4:DIGI
                                     5:TRIG, 6:RDST)
   - many bugs corrected everywhere
   - changes in the ITC code to book directly named bank where it is
     possible with the expected maximum length.
     rename the bank ITL1 to ITTR for homogeneity.
   ---------------------------------------------------------------------
   MC:GAL160.HLB, .CORR, .GEO, .FOR, .OBJ, _D.OBJ /
   GAL160 OLDLIB MCARLO, TXTLIB MCARLO, GEO MCARLO, CORR MCARLO
   This version contains:
    - implementation of SATR
    - implementation of the shower parametrization in HCAL
      this is now the default. To use the detailed version:
      *DF HCDETAIL
      *E AGHCAL,HCHIT,HCIEVE,HCCRTO
       these routines are compiled and kept in :
       HCDET160 FORTRAN MCARLO,TEXT MCARLO / MC:HCDET160.FOR, .OBJ
    - mods in MUON (new geometry)
    - new implementation of IMPAct banks: they are created on request
      the filling is steered by a data card
      IMPA  'detname1'   ' ...'
             VDET, ITC, TPCI, ECAL, LCAL, SATR, HCAL, MUON
             track parameters will be stored at the entrance of the
             detector volume 'detname' for all primaries.
             TPCO
             track parameters will be stored at the exit point of the
             TPC gas volume for charged particles only.
    - The INTERACTIVE version is still NOT implemented.
    - When using the flag RDST the routines ASRDST,ASIPAC,ASPEVE,
      ASCRUN,ASASIG,GUSTEP have to be recompiled. The fortran and
      compiled files are kept as :
      RDST160 FORTRAN MCARLO, TEXT MCARLO / MC:RDST160.FOR, .OBJ
    ------------------------------------------------------------------
   MC:GAL150.HLB, .CORR, .FOR, .OBJ, _D.OBJ /
   GAL150 OLDLIB MCARLO, TXTLIB MCARLO, CORR MCARLO
   This is the 1st version which works with GEANT310, GHEISHA7, ZEBRA.
   MUST be used with GAL140 GEO and *DF HCDETAIL.
   The GAL150 part is identical to GAL140 with CORR except the banks
   VERT and GVER which contain now the time of flight (look at the
   ALEPH BOS BANK CONTENTS: ALEPH 86-57 version# 1).
   The files written by GAL140 are not readable by GAL150.
   The Historian library has been RESEQUENCED.
   Only updates to this version will be accepted in the future.
   The INTERACTIVE version does NOT WORK yet.
   -----------------------------------------------------------
    MC:GAL140.HLB, .CORR, .FOR, .OBJ, _D.OBJ, .GEO/
    GAL140 OLDLIB MCARLO, TXTLIB MCARLO, CORR MCARLO, GEO MCARLO
    This is the last version which works with GEANT309+GHEISHA6
    must be used with GAL140 GEO and *DF HCDETAIL.
    This version contains the following mods or features:
    - various corrections in all modules.
    - new subroutine ASCTRA to close the tracking propely:
      the banks 'VERT' and 'KINE' are created there.
    - the data card TCUT should not be used, standard values have
      been set in ASINIT. Only authors of algoritms should play with it.
    - Remember that you MUST have a FIDUcial card in your data card file.
    - mods in ALBOS and AUBLIS to take out all common blocks except
      JQCOM.
    - implementation of LCAL.
    - mods in VDET.
    - write TPC coordinates bank to simulate the 'prepare data' process
      'TPCO' bank.
    - new banks 'RUNH' 'ASRU' 'EVEH' 'ASEV' 'RUNE'
      RUNH, RUNE, EVEH are banks defined by online and offline.
      ASRU is the old RUNH : gives specific information to GALEPH
      ASEV is the old EVEH : gives specific information to GALEPH
      see complete definition of these banks in BANKDOC.HLB .
    - implementation of the RDST process also called SIMDST or ARPEKIN
      to avoid space problem it has been implemented under an Historian
      flag : RDST.
      To run the RDST process add the following cards in the Historian
      input file:
      *DF RDST
      *E ASRDST,ASIPAC,ASPEVE,ASCRUN,ASASIG,GUSTEP
      and use the following data cards:
      PROCESS  'RDST'  'KINE'  'TRAC'  'HITS'
      SETS     'VDET'  'ITC '  'TPC '  'ECAL'   'SATR'   'HCAL'
      PRINT    12      ! print flag for RDST process
      HISTO    12      ! histogramming flag for RDST process
     ...........................................................
    MC:GAL133.HLB, .FOR, .OBJ, _D.OBJ, .GEO /
    GAL133 OLDLIB MCARLO, TXTLIB MCARLO, GEO MCARLO
    This is an intermediate version which works with GAL133 GEO
    must be used with *DF HCDETAIL
    This version contains the following mods or features:
     - better implementation of the beam tube and quadrupoles
     - electronics boxes and other materials in the ECAL region
     - 'IMPA' banks as described in the proposal presented at Munich
     - in case of single particle new definition of a 'primary' track
       as presented in Munich.
     - new routine to print 'KINE' and 'VERT' BOS banks : PRKINE
       new routine to print 'IMPA' BOS banks : PRIMPA
       new routine ASCTRA (close tracking) called after the tracking
                          in ASTRAC. The 'VERT' and 'KINE' Bos banks
                          are built at this level.
    RENAME:  Superconducting Quadrupole SQUA as Quadrupole QUAD
    RENAME:  Luminosity Tracking device LTRK as Small Angle Tracking SATR
   ----------------------------------------------------------------------

2 CALO

  >>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>
    CKEY 
     1st entry in CALOrimetry set
    
     ! GALEPH 256
       * corr no. 1
       CAASBS -  a wrong version was introduced in GALEPH 255 corrected
                 in corr.file no.1
    
     ! GALEPH 255
       CAPGET  - calls new routine CAABSB
       CAABSB  - new routine to stop geantino when all energy is deposited.
    
  <<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<
     CAABSB     Test absorbption of electromagnetic shower
     CACUTG     Decide wheither yes/no a geantino is created
     CAEPAR     E.m shower coefficients
     CAFIHT     Fill bank caht using bank cahi
     CAGERB 
     CAHERB 
     CAHGRB 
     CAHHRB 
     CAHIST     Calorimeter history banks
     CAHMOD 
     CAHPAR     Computes had. shower param.
     CAHTRV     Tirage hadronique transversal
     CALHIT     Create geantino in calorimeters
     CAPGET     Geantino track element : get capa bank
     CAPSTO 
     CASHAD 
     CASHEM 
     CATINO     Create geantino part type ltypel or next (48-52)

3 CAABSB
         SUBROUTINE CAABSB(EMGNRJ,EMBETA,EMALFA,TINOX0,IER)
  ------------------------------------------------------------------------------
    CKEY CALO
  ------------------------------------------------------------------------------
   - M.N.Minard - 930901
   Test absorbption of electromagnetic shower
       ARGUMENT INPUT
                     EMGNRJ = SHOWER ENERGY
                     EMBETA = BETA COEFFICIENT OF SHOWER
                     EMALFA = ALFA COEFFICIENT OF SHOWER
                     TINOX0 = CURRENT RADIATION LENGTH
       ARGUMENT OUTPUT
                     IER = 0 SHOWER NOT FULLY ABSORBED
                     IER = 1 SHOWER ABSORBED
   
 
3 CACUTG
         SUBROUTINE CACUTG (MFLAG)
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   - J.Badier  F.Ranjard - 870817
   Decide wheither yes/no a geantino is created
   - MFLAG = 0 no creation
             1 creation
   - called from   CALHIT                           from this .HLB
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   CALHIT                                                                          
        |---- CACUTG.                                                              
   
 
3 CAEPAR
         SUBROUTINE CAEPAR
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
         J.Badier - 16/03/87
   E.m shower coefficients
   ----- Calcul des coefficients de parametrisation d'une gerbe
         electromagnetique.
   ----- NATGER = 1 : Electron.
   ----- NATGER = 2 : Photon.
   ----- NATGER = 3 : Pi 0
     - Called by EHGERB
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   CAPGET                                                                          
   EHGERB                                                                          
        |---- CAEPAR                                                               
                   |----  ALOG                                External             
                   |----  ASURB1                              External             
                   |----  ASURB2                              External             
                   |----  UNSRB1                              External             
                   |----  UNSRB2                              External             
                   |----  SQRT                                External             
                   |----  SIGMA1                              External             
                   |----  SIGMA2                              External             
                   |----  SIGMB1                              External             
                   |----  SIGMB2                              External             
                   |----  SIGMA3                              External             
                   |----  SIGMB3                              External             
                   |----  RANNOR                              External             
   
 
3 CAFIHT
         INTEGER FUNCTION CAFIHT (NCAHI,TCAHT)
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   - F.Ranjard - 881213
   Fill bank caht using bank cahi
    CAHT stands for a detector HiT bank known by its name-index NCAHT
    CAHI stands for a detector HIstory bank known by its name TCAHI
   - Input  : NCAHI / I  = name-index of the history bank
              TCAHT / A  = name of the HIT bank
   - Output : CAFIHT/ I  = index of name-bank TCAHT
                           if 0 means not enough space
     a work bank CKEY with index JDCKEY is created, filled and dropped.
     if CAHT bank exists when entering the routine it is dropped.
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   ECASIG                                                                          
   LCASIG                                                                          
   SIASIG                                                                          
        |---- CAFIHT                                                               
                   |----  BDROP                               External             
                   |----  AUBOS                               External             
                   |----  WBANK                               External             
                   |----  INTCHA                              External             
                   |----  SORTZV                              External             
                   |----  AUBPRS                              External             
                   |----  WDROP                               External             
   
 
3 CAGERB
         SUBROUTINE CAGERB(ENER,IFIN,XGERB,NRJDP)
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
       Deposition of electromagnetic energy in ECAL
       J.Badier  10/03/88
       ENER  : electromagnetic energy to be deposited
       IFIN  : 0  no more points to be generated
       IFIN  : 1  points have to be generated to deposit
                  energy
       XGERB : coordinate of generated points
       NRDJ  : energy deposited by generated point
       calls to   CASHEM ,POISSN , EHTRTI  ,EHDEPS
       called from EHSHOW
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   EHSHOW                                                                          
        |---- CAGERB                                                               
                   |----  ABS                                 External             
                   |----  MAX                                 External             
                   |----  SQRT                                External             
                   |----  CASHEM                                                   
                   |----  POISSN                              External             
                   |----  MIN                                 External             
                   |----  RNDM                                                     
                   |----  EHTRTI                                                   
                   |----  COS                                 External             
                   |----  SIN                                 External             
                   |----  EHDEPS                                                   
   
 
3 CAHERB
         SUBROUTINE CAHERB(ENER,IFIN,XGERB,NRDJ)
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
       Deposition of electromagnetic energy in HCAL
       M.N Minard  10/05/88
       modified by: F.Ranjard 26/07/94
       add a protection in case SMIN>SMAX
       ENER  : electromagnetic energy to be deposited
       IFIN  : 0  no more points to be generated
       IFIN  : 1  points have to be generated to deposit
                  energy
       XGERB : coordinate of generated points
       NRDJ  : 0 generated point does not deposit energy
             : #0 it does
       calls to   CASHEM ,POISSN , EHTRTI
       called from HCSHOW
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   HCSHOW                                                                          
        |---- CAHERB                                                               
                   |----  ABS                                 External             
                   |----  MAX                                 External             
                   |----  SQRT                                External             
                   |----  CASHEM                                                   
                   |----  POISSN                              External             
                   |----  RNDM                                                     
                   |----  EHTRTI                                                   
                   |----  COS                                 External             
                   |----  SIN                                 External             
   
 
3 CAHGRB
         SUBROUTINE CAHGRB(ENER,IFIN,XGERB,NRJDP)
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
       Deposition of hadronic energy in ECAL
       J.Badier  10/03/88
       ENER  : hadronic energy to be deposited
       IFIN  : 0  no more points to be generated
       IFIN  : 1  points have to be generated to deposit
                  energy
       XGERB : coordinate of generated points
       NRDJ  : energy deposited by generated point
       calls to   CASHAD ,POISSN , CAHTRV  ,EHDEPH
       called from EHSHOW
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   EHSHOW                                                                          
        |---- CAHGRB                                                               
                   |----  ABS                                 External             
                   |----  MAX                                 External             
                   |----  SQRT                                External             
                   |----  CASHAD                                                   
                   |----  POISSN                              External             
                   |----  RNDM                                                     
                   |----  CAHTRV                                                   
                   |----  COS                                 External             
                   |----  SIN                                 External             
                   |----  EHDEPH                                                   
   
 
3 CAHHRB
         SUBROUTINE CAHHRB(ENER,IFIN,XGERB,NRDJ)
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
       Deposition of hadronic energy in HCAL
       M.N Minard  10/05/88
       ENER  : hadronic energy to be deposited
       IFIN  : 0  no more points to be generated
       IFIN  : 1  points have to be generated to deposit
                  energy
       XGERB : coordinate of generated points
       NRDJ  : 0 generated point does not deposit energy
             : #0 it does
       calls to   CASHAD ,POISSN , CAHTRV
       called from HCSHOW
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
              CAHHRB                                                               
                   |----  ABS                                 External             
                   |----  MAX                                 External             
                   |----  SQRT                                External             
                   |----  CASHAD                                                   
                   |----  POISSN                              External             
                   |----  RNDM                                                     
                   |----  CAHTRV                                                   
                   |----  COS                                 External             
                   |----  SIN                                 External             
   
 
3 CAHIST
         SUBROUTINE CAHIST(NAMI,IAD,IST,ISIG)
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
       M.N MINARD 14-11-88
   Calorimeter history banks
    INPUT : NAME = NAME-INDEX OF BANK TO BE FILLED
            IAD  = ADDRESS
            IST  = STACK OR PLANE NUMBER
            ISIG = SIGNAL
    OUTPUT: History Banks ESHI EWHI / LSHI LWHI
    Called by EHSITW, LCTRAK, LCSHOW
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   EHSITW                                                                          
   LCSHOW                                                                          
   LCTRAK                                                                          
   SISHOW                                                                          
   SITRAK                                                                          
        |---- CAHIST                                                               
                   |----  UCOPY2                              External             
                   |----  CHAINT                              External             
                   |----  ALBOS                               External             
   
 
3 CAHMOD
         SUBROUTINE CAHMOD ( IPAR,IHPLN)
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
     M.N Minard 880508
     1 st : lift working bank HCVL
            initialisation start volume in HCAL
            HCVL allows to store volume parameter for geantino tracking
     ELSE
            Calculate absorption and radiation length in non sensistive
            volume
            Fill common CAHTRA at the end of volume
   - Output arguments:
                IPAR = 1 if bank HCVL and common /CAHTRA/ are filled
                IHPLN= plane # where the shower starts
   -  Called  in HCSHOW
   -  Calls HCSETP
     Modify by M.N. Minard    29/1/93
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   HCSHOW                                                                          
        |---- CAHMOD                                                               
                   |----  NLINK                               External             
                   |----  ALBOS                               External             
                   |----  BLIST                               External             
                   |----  HCSETP                                                   
                   |----  HCTIRF                              External             
   
 
3 CAHPAR
         SUBROUTINE CAHPAR (ENER,IPART)
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
         J.Badier - 16/03/87
     Modified by G.Ganis        16/Jun/89
   Computes had. shower param.
   ----- Calcul des parametres de la gerbe hadronique.
    ENER  Energie du track elem.
          IPART  particle #
   ----- Voir HADCAL.
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   CAPGET                                                                          
        |---- CAHPAR                                                               
                   |----  ALOG                                External             
                   |----  RNDM                                                     
                   |----  SQRT                                External             
   
 
3 CAHTRV
         SUBROUTINE CAHTRV( ZLON , RADIS )
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
         J.Badier - 15/03/88
   Tirage hadronique transversal
      Input : ZLON    Distance a l'origine de la gerbe en cm.
      Output: RADIS   Distance a l'axe de la gerbe
    - Called by CAHGRB
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   CAHGRB                                                                          
   CAHHRB                                                                          
        |---- CAHTRV                                                               
                   |----  RNDM                                                     
   
 
3 CALHIT
         SUBROUTINE CALHIT
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   - J.Badier F.Ranjard - 870817
   Create geantino in calorimeters
    called by hadron stopping because of a hadronic interaction
   - called from GUSTEP                      from this .HLB
   - calls       CACUTG, CATINO              from this .HLB
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   GUSTEP                                                                          
        |---- CALHIT                                                               
                   |----  CACUTG                                                   
                   |----  CATINO                                                   
   
 
3 CAPGET
         SUBROUTINE CAPGET
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   - F.Ranjard - 880505
   Geantino track element : get capa bank
    IF 1st entry (bank does not exist) THEN
       create the CAPA bank with the bank# = track# IGTRA
       fill it with the shower parameters
    ELSE
       increment the total rad. length and abs. length
       copy the CAPA bank to common /CAPANO/
    ENDIF
   - called by GUSTEP                                from this .HLB
   - calls ALBOS, ALTELL                             from ALEPHLIB
           CAHPAR, CAEPAR, CAPSTO                    from this .HLB
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   GUSTEP                                                                          
        |---- CAPGET                                                               
                   |----  NLINK                               External             
                   |----  ALBOS                               External             
                   |----  BLIST                               External             
                   |----  CAHPAR                                                   
                   |----  CAEPAR                                                   
                   |----  CAPSTO                                                   
                   |----  CHAINT                              External             
                   |----  CAABSB                                                   
   
 
3 CAPSTO
         SUBROUTINE CAPSTO (IGTRA)
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
         M.N Minard 880509
   - fill bank CAPA for geantino with track# IGTRA
   - called by CAPGET                                from this .HLB
   - call   ALTELL                                   from ALEPHLIB
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   CAPGET                                                                          
   EHSHOW                                                                          
   LCSHOW                                                                          
        |---- CAPSTO                                                               
                   |----  NLINK                               External             
                   |----  ALTELL                              External             
                   |----  INTCHA                              External             
   
 
3 CASHAD
         FUNCTION CASHAD( S , INIT )
  ------------------------------------------------------------------------------
    CKEY CALO GEANTINO HADRONIC
  ------------------------------------------------------------------------------
   - M.N.Minard
   - Input   : INIT   / I = initialisation flag
             : S      / R = track length
   - Output  : CASHAD / R =
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   CAHGRB                                                                          
   CAHHRB                                                                          
        |---- CASHAD                                                               
                   |----  GAMMA                               External             
                   |----  ALOG                                External             
                   |----  ABS                                 External             
                   |----  EXP                                 External             
   
 
3 CASHEM
         FUNCTION CASHEM(S,INIT)
  ------------------------------------------------------------------------------
    CKEY CALO GEANTINO E.M.
  ------------------------------------------------------------------------------
   - M.N.Minard
   - Input   : INIT   / I = initialisation flag
             : S      / R = track length
   - Output  : CASHEM / R =
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   CAABSB                                                                          
   CAGERB                                                                          
   CAHERB                                                                          
        |---- CASHEM                                                               
                   |----  GAMMA                               External             
                   |----  ALOG                                External             
                   |----  ABS                                 External             
                   |----  EXP                                 External             
   
 
3 CATINO
           SUBROUTINE CATINO
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Boucrot   March 87    F.Ranjard - 870815
                                       880316
   Create geantino part type ltypel or next (48-52)
    Called by ECHIT, HCHIT, CALHIT                from this .HLB
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   CALHIT                                                                          
   ECHIT                                                                           
   LCHIT                                                                           
        |---- CATINO                                                               
                   |----  HPANTP                                                   
                   |----  JHOCHA                              External             
                   |----  REAL                                External             
   

2 DRAW

  >>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>
    CKEY 
     1st entry in event DRAWing package using GEANT
  <<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<
     ADINIT     Initialises capture file and set up view banks
     ADRZ       Draw the r-z cut view of aleph in view bank #iv
     ADVIEW     Draw two typical cut views of alef with header and text
     ADXY       Draw the x-y cut view of aleph in view bank # iv
     GAXEPH 

3 ADINIT
         SUBROUTINE ADINIT
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   B. BLOCH-DEVAUX  - 850910
   Initialises capture file and set up view banks
     Called by user   in ASIPAC   from this .HLB
     Calls HPLCAP
     Calls GUINTI,ADXY,ADRZ   from this .HLB
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
              ADINIT                                                               
                   |----  HPLCAP                              External             
                   |----  GUINTI                              External             
                   |----  ADXY                                                     
                   |----  ADRZ                                                     
   
 
3 ADRZ
         SUBROUTINE ADRZ(IV)
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
     B. BLOCH-DEVAUX 850910
   Draw the r-z cut view of aleph in view bank #iv
     Called by    ADINIT , GUVIEW                 from this .HLB
     Calls  GEANT3 drawing routines
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   ADINIT                                                                          
        |---- ADRZ                                                                 
                   |----  GDELET                              External             
                   |----  GDOPEN                              External             
                   |----  GDRAWC                              External             
                   |----  GDRAWT                              External             
                   |----  GDCLOS                              External             
   
 
3 ADVIEW
         SUBROUTINE ADVIEW
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   B. BLOCH-DEVAUX  - 850910
   Draw two typical cut views of alef with header and text
     Called by user   in ASCEVE   from this .HLB
     Calls  GEANT3 drawing routines
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
              ADVIEW                                                               
                   |----  ICLRWK                              External             
                   |----  GDOPT                               External             
                   |----  GDSHOW                              External             
                   |----  GDXYZ                               External             
                   |----  GDHEAD                              External             
   
 
3 ADXY
         SUBROUTINE ADXY(IV)
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
     B. BLOCH-DEVAUX 850910
   Draw the x-y cut view of aleph in view bank # iv
     Called by    ADINIT , GUVIEW                        from this .HLB
     Calls  GEANT3 drawing routines
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   ADINIT                                                                          
        |---- ADXY                                                                 
                   |----  GDELET                              External             
                   |----  GDOPEN                              External             
                   |----  GDRAWC                              External             
                   |----  GDRAWT                              External             
                   |----  GDCLOS                              External             
   
 
3 GAXEPH
   
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
         SUBROUTINE GTRIG
    -  B. BLOCH - 850910
    Event   tracking   control routine to replace Geant default
     Calls   ASPEVE ,ASCEVE from this .HLB
     Called from <GXINT>GXCONT     from GEANT3
   
         SUBROUTINE GTRIGC
    -  B. BLOCH - 850910
     event closing routine to replace Geant default
     Calls   ASCEVE        from this .HLB
     Called from <GXINT>GXCONT     from GEANT3
   
         SUBROUTINE GTRIGI
    -  B. BLOCH - 850910
     event initialisation routine to replace Geant default
     Calls   ASIEVE        from this .HLB
     Called from <GXINT>GXCONT     from GEANT3
   
         SUBROUTINE GUKINE
    -  B. BLOCH - 850910
    Event   generation control routine to replace Geant default
     Calls   ASKINE        from this .HLB
     Called from <GXINT>GXCONT     from GEANT3
   
         SUBROUTINE UGINIT
    -  F.Ranjard - 950425
    job initialization to replace Geant default
     Calls   AIGAL        from this .HLB
     Called from <GXINT>GXCONT     from GEANT3
   
         SUBROUTINE UGLAST
    -  B. BLOCH - 850910
    Job termination  routine to replace Geant default
     Calls   GLAST       from this .HLB
     Called from <GXINT>GXCONT     from GEANT3
   
         SUBROUTINE GUVIEW ( NAME ,TXT1 ,TXT2 ,IV )
   B. BLOCH-DEVAUX  - 850910
     Draw some typical cut view of ALEF  with header and text
     If option 'STAN' selected then draw standards plots (X-Y and R-Z views)
     If not,draw plot of detector 'NAME' in cut view  at cutval value
     determined by answers.A comment is added at the bottom
     Replaces default GEANT GUVIEW routine
     Called by <GXINT>GINC1
     Calls UCTOH,UHTOC                 from cernlib
     Calls GDOPT,GDRAWT,GDRAWC,GDHEAD  from GEANT3
     Calls TVNEXT,TVSHOW               from GD3
     Calls ZCGETI,ZCGETA,ZCGETR        from ZCEDEX
     Calls ADXY,ADRZ,ADVIEW         from this .HLB
   
   

2 ECAL

  >>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>
    CKEY 
     1st entry in ECAL set
     ! GALEPH 30.3 corr file no. 2
       EHSITW - call EVERIF to check consistency of ecal address.
       EVERIF - new routine from (M.N.Minard) to check and correct
                row number if wrong.
    
     ! GALEPH 30.1
       ECIRUN - read EDPA bank from DB, and call EUPPAR.
       EUPPAR - update ECAL parameters from EDPA bank.
    
     ! GALEPH 25.6
       ECIRUN : get ENNO bank from DB using setup code
       EDSNOI : use ENNO bank if it exists, otherwise use data statment
     * corr.file no.3
       ECIRUN : add EZTH bank format
    
     ! GALEPH 25.4
       ECIRUN : use ALGTDB instecd of MDARD to get bank depending on
                the setup code
    
  <<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<
     EBEBLO     Calculate de/dx from bethe-bloch formula
     EBETHE     Calculate de/dx from bethe-bloch formula
     ECASIG     Reduce hits banks
     ECBOOK     Book ecal histograms
     ECDFCD     Modified :- e. lancon              3-dec-1990
     ECDFPA     Define ecal parameters
     ECDIGI     Ecal digitisation steering
     ECHIT      Ecal analog signal steering
     ECIBUG     Debug init for ecal
     ECIRUN     Modified :- e. lancon              3-dec-1990
     ECISTA     Initialise ecal statistics
     ECNAMI 
     ECTRIG     Ec trigger anal. signals
     ECWSUM     Modified :- e. lancon              3-dec-1990
     EDFILH     Fill standard histog. for digits
     EDINIP     Init ecal digit constants
     EDSNOI     Modified :- e. lancon              3-dec-1990
     EDTADJ     Give list of adj. towers
     EDTAIN     Initialisation of constants for routine edtadj
     EDTCOR     Correct tower digit
     EDTCUT     Modified :- e. lancon              3-dec-1990
     EDTDIG     Convert signal to digit
     EDTONO     Add noise to analog signal
     EDTRGI     Initialisation of trigger region theta limits in ecal
     EDTZSU     Zero suppression in towers
     EDWBRU     Simulate noise on wire readout
     EDWDGT     Digitize wire signals
     EHADRN     Tirage d'une gerbe hadronique.
     EHBARI 
     EHCHAR     Track elem. energy
     EHCHEK     Parametrisation allowed ?
     EHCPWI     Fill wire bank ewht
     EHCUTF     Fast tracking or not?
     EHCUTG     Decide wheither yes/no a geantino is created
     EHCUTP     Fast tracking init
     EHDEPH     Energy for hadr. shower
     EHDEPS     Energy  e.m shower points
     EHDEPT     Tr. elem energy deposit
     EHEDGE     Shower edge proximity
     EHGEOB     Edges geom for barrel mod.
     EHGEOE     Edges geom for end cap mod.
     EHGERB     Computes shower points
     EHIBOS     Ecal bos banks init
     EHLOTI     Shower longitud. profile
     EHPALO     Longitud. parametrisation
     EHPASR     Init param. for signals
     EHPETA 
     EHSHOW     Shower creation steering
     EHSITW     Ecal signals -->addresses
     EHTRAN     Towards local coordinates
     EHTRKE     Track elem. signal steering
     EHTRTI     Tirage transversal
     ELANDA     Get a landau distribution from a look-up table
     EPRIMI     Returns the wire signal value integrated during x ns
     EUPPAR 
     EVERIF     Check consistency of ecal address

3 EBEBLO
         SUBROUTINE EBEBLO( GBIN , CHAR , TMAS , DEDX )
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
        S.SNOW   02/5/89
   
   Calculate de/dx from bethe-bloch formula
   
    Constants taken from the note by M Bardadin et al. ALEPH 89-2
      INPUT :  GABE is gamma*beta of the particle
            :  CHAR is the charge of the particle
            :  TMAS is the mass   of the particle
     OUTPUT :  DEDX is the de/dx , normalised so that m.i.p. = 1
    by  EHDEPT
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   EHDEPT                                                                          
        |---- EBEBLO                                                               
                   |----  SQRT                                External             
                   |----  ALOG10                              External             
                   |----  ALOG                                External             
   
 
3 EBETHE
         SUBROUTINE EBETHE(EP,GABE,EP1)
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   
   Calculate de/dx from bethe-bloch formula
                                  M.N. Minard Feb. 88
        EP   = INVERSE PARTICLE BETA ( E/P )
        GABE = PARTICLE GAMMA*BETA   ( P/M )
        EP1= EP * ( DE/DX (BETHE)/ DE/DX (5 GEV))**0.5
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   LCTRAK                                                                          
        |---- EBETHE                                                               
                   |----  ALOG                                External             
                   |----  ABS                                 External             
                   |----  SQRT                                External             
   
 
3 ECASIG
         SUBROUTINE ECASIG
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
      Y. Karyotakis 11-3-86   End of Tracking
   Reduce hits banks
   - Calls : WDROP                                       from BOSlib
             AUBPRS                                      from ALEPHLIB
             CAFIHT                                      from this .HLB
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   ASASIG                                                                          
        |---- ECASIG                                                               
                   |----  IPRIJO                              External             
                   |----  WDROP                               External             
                   |----  AUBPRS                              External             
                   |----  PRTABL                              External             
                   |----  CAFIHT                                                   
                   |----  FHISJO                              External             
                   |----  HFILL                               External             
                   |----  VSUM                                External             
                   |----  CCONT                               External             
                   |----  ALTELL                              External             
   
 
3 ECBOOK
         SUBROUTINE ECBOOK
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Book ecal histograms
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   ASBOOK                                                                          
        |---- ECBOOK                                                               
                   |----  BKINJO                              External             
                   |----  HBOOK2                              External             
                   |----  HBOOK1                              External             
                   |----  HIDOPT                              External             
   
 
3 ECDFCD
         SUBROUTINE ECDFCD
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
    M.Rumpf may 86                            modification may 87
   Modified :- e. lancon              3-dec-1990
    ECAL Run cond. interface
    Correspondance  Integers <--> Characters
    Can be changed using Steering data cards
             RUNC   'ECAL' n1  n2 ....    where n1 etc are integers
    - Called by ECIRUN
       EXTERNAL   INTERNAL                      VALUES
       Integer    Character     Default
        ICECJO                     0                1            2
          (1)     TCUTRK       NO CUT           CUT TRACK        -
          (2)     TSMEAR       NO SMEARING      SMEARING         -
          (3)     TIRAGE       FLUCTUATED       VERY FAST        -
          (4)     TEDEPO       FLUCTUATED       VERY FAST        -
          (5)     TPARAM       NO               ELEC           ALL
          (6)     EDNOXT       +ONE             HITS           ALL
          (7)     EDMIXR       NO               YES              -
          (8)     EDSAVG       NO               YES              -
          (9)     EDZSUP       SINGLE CUT       DOUBLE CUT       -
         (10)     not used         -                -            -
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   ECIRUN                                                                          
        |---- ECDFCD                                                               
                   |----  ICECJO                              External             
   
 
3 ECDFPA
         SUBROUTINE ECDFPA
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
    M.Rumpf dec 85
   Define ecal parameters
    - Called by ECIRUN
    - Calls EHPASR,EDINIP
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   ECIRUN                                                                          
        |---- ECDFPA                                                               
                   |----  EHCUTP                                                   
                   |----  EHPASR                                                   
                   |----  EDINIP                                                   
   
 
3 ECDIGI
         SUBROUTINE ECDIGI
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Ecal digitisation steering
        O.CALLOT    29-OCT-85
    modified by M.Bernard /D.Pallin 05/89
    - calls EDTONO,EDTDIG,EDTZSU,EDTCOR                    this .HLB
            EDWBRU,EDWDGT,ECTRIG,EDFILH                    this .HLB
            ECPRTO,ECPRWI,ECPRHI,ECPRTR                    this .HLB
            WDROP                                         BOS77
    - called by ASDIGI
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   ASDIGI                                                                          
        |---- ECDIGI                                                               
                   |----  EDTONO                                                   
                   |----  EDTDIG                                                   
                   |----  EDTZSU                                                   
                   |----  EDTCOR                                                   
                   |----  WDROP                               External             
                   |----  EDWBRU                                                   
                   |----  ECTRIG                                                   
                   |----  EDWDGT                                                   
                   |----  EDFILH                                                   
                   |----  FHISJO                              External             
                   |----  IPRIJO                              External             
                   |----  ECPRTO                              External             
                   |----  ECPRWI                              External             
                   |----  ECPRHI                              External             
                   |----  ECPRTR                              External             
   
 
3 ECHIT
         SUBROUTINE ECHIT
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   - J.Badier  F.Ranjard - 870817
   Ecal analog signal steering
   - Initialize BOS banks at beginning of event
   - Get sub-component # and module #
   - IF it is a geantino particle THEN treat it and RETURN
     ELSE treat the McTreackElement stored in /TRKCOM/
   - IF shower parametrization is required AND it is
           a photon which stops loosing all its energy
        OR a hadron which stops because of an hadronic
           mechanism
     THEN treat the shower parametrization depending of the
        type of parametrization chosen.
   - called by   GUSTEP                     from GEANT3 lib
   - calls       EHSHOW, EHTRKE, EHCUTF
                 EHCUTG, CATINO             from this .HLB
                 ELIMSC                     from ALEPHLIB
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   GUSTEP                                                                          
        |---- ECHIT                                                                
                   |----  ICECJO                              External             
                   |----  FBEGJO                              External             
                   |----  ELIMSC                              External             
                   |----  EHIBOS                                                   
                   |----  EHSHOW                                                   
                   |----  EHTRKE                                                   
                   |----  EHCUTF                                                   
                   |----  EHCUTG                                                   
                   |----  CATINO                                                   
                   |----  FHISJO                              External             
                   |----  HFILL                               External             
   
 
3 ECIBUG
         SUBROUTINE ECIBUG
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
    M.Rumpf jan 86
   Debug init for ecal
    -Called by ECIRUN
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   ECIRUN                                                                          
        |---- ECIBUG.                                                              
   
 
3 ECIRUN
         SUBROUTINE ECIRUN
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
    M.Rumpf dec 85
                             modified by F.Ranjard - 880308
   Modified :- e. lancon              3-dec-1990
    ECAL run initialisation
       - Called by ASIMOD
       - Calls     ERDDAF,ECDFRD,ECDFCD,ECDFPA,ECISTA,ECIBUG
                   ALTELL, GTSTUP
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   ASIMOD                                                                          
        |---- ECIRUN                                                               
                   |----  ECNAMI                                                   
                   |----  ECIBUG                                                   
                   |----  ERDDAF                              External             
                   |----  ALTELL                              External             
                   |----  ECDFRD                              External             
                   |----  ECDFCD                                                   
                   |----  ECDFPA                                                   
                   |----  BKFMT                               External             
                   |----  GTSTUP                              External             
                   |----  ALGTDB                              External             
                   |----  BLIST                               External             
                   |----  EUPPAR                                                   
                   |----  ECISTA                                                   
   
 
3 ECISTA
         SUBROUTINE ECISTA
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
    M.Rumpf jan 86
   Initialise ecal statistics
     -Called by ECIRUN
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   ECIRUN                                                                          
        |---- ECISTA.                                                              
   
 
3 ECNAMI
         SUBROUTINE ECNAMI
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   - F.Ranjard - 860422
   - define formats and name-indices of EC BOS banks
     set working bank indices to 0
   - Called from   ECIRUN                       from ECAL lib
   - Calls         NAMIND, BKFMT                from BOS77.hlb
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   ECIRUN                                                                          
        |---- ECNAMI                                                               
                   |----  NAMIND                              External             
                   |----  BKFMT                               External             
   
 
3 ECTRIG
         SUBROUTINE ECTRIG
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
      G.DEBOUARD     20-JAN-86
   Ec trigger anal. signals
    -Called from ECDIGI                                  this .HLB
    - calls  ECRWRG                                      this .HLB
             RANNOR                                      CERNLIB
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   ECDIGI                                                                          
        |---- ECTRIG                                                               
                   |----  EDTRGI                                                   
                   |----  ALBOS                               External             
                   |----  BLIST                               External             
                   |----  RANNOR                              External             
                   |----  NINT                                External             
                   |----  ETTNOI                              External             
                   |----  IBITS                               External             
                   |----  F                                   External             
                   |----  ECRWRG                              External             
                   |----  INT                                 External             
                   |----  ETSTWE                              External             
                   |----  FLOAT                               External             
                   |----  MOD                                 External             
   
 
3 ECWSUM
         SUBROUTINE ECWSUM
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
    may 86
   Modified :- e. lancon              3-dec-1990
    ECAL Run summary
    -Called by ASCRUN
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   ASCJOB                                                                          
        |---- ECWSUM                                                               
                   |----  FORMAT                              External             
                   |----  EDZSUPFORMAT                        External             
                   |----  EDZTHR                              External             
                   |----  CCONT                               External             
                   |----  SQRT                                External             
   
 
3 EDFILH
          SUBROUTINE EDFILH
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
     D.Zwierski  (X)                                    October 87
   Fill standard histog. for digits
    Si FHISJO(4)=.TRUE., then fills histograms with digital
    values taken from EWDI and ETDI BOS banks
    Called by ECDIGI
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   ECDIGI                                                                          
        |---- EDFILH                                                               
                   |----  FHISJO                              External             
                   |----  NLINK                               External             
                   |----  MOD                                 External             
                   |----  FLOAT                               External             
                   |----  HFILL                               External             
   
 
3 EDINIP
         SUBROUTINE EDINIP
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
        O.CALLOT  8-NOV-85
   Init ecal digit constants
    - called from ECDFPA                                  this .HLB
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   ECDFPA                                                                          
        |---- EDINIP                                                               
                   |----  FLOAT                               External             
   
 
3 EDSNOI
         FUNCTION EDSNOI(ISTK,JPHI,KTET)
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
       O.CALLOT  29-NOV-85
   Modified :- e. lancon              3-dec-1990
    Compute noise on storeys
    Initialise array SIGMN on first call
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   EDTONO                                                                          
        |---- EDSNOI                                                               
                   |----  ALOG                                External             
                   |----  SQRT                                External             
                   |----  NAMIND                              External             
                   |----  COSH                                External             
                   |----  FLOAT                               External             
                   |----  ACOS                                External             
                   |----  SINH                                External             
   
 
3 EDTADJ
         SUBROUTINE EDTADJ(JPHI,KTET,NBVOI,LIVOI)
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
       O.CALLOT  26-NOV-85
   Give list of adj. towers
    in LIVOI ordered from I and J indices
       from Phi and Theta indices.
    - called from  EDTONO,EDTZSU                          this .HLB
    - calls        ECRWRG                                 this .HLB
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   EDTONO                                                                          
   EDTZSU                                                                          
        |---- EDTADJ                                                               
                   |----  EDTAIN                                                   
                   |----  ECRWRG                              External             
                   |----  MOD                                 External             
                   |----  UCOPY2                              External             
   
 
3 EDTAIN
         SUBROUTINE EDTAIN(JINF,JNB)
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
      G.de BOUARD   4-OCT-87
   Initialisation of constants for routine edtadj
    - called from EDTADJ                              this .HLB
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   EDTADJ                                                                          
        |---- EDTAIN.                                                              
   
 
3 EDTCOR
         SUBROUTINE EDTCOR
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
        O.CALLOT   31-OCT-85
   Correct tower digit
    - called from ECDIGI                                 this .HLB
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   ECDIGI                                                                          
        |---- EDTCOR                                                               
                   |----  KALEDT                              External             
                   |----  FLOAT                               External             
   
 
3 EDTCUT
         INTEGER FUNCTION EDTCUT(IMOD,ISTK,JPHI,KTET)
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
       O.CALLOT   3-DEC-85
   Modified :- e. lancon              3-dec-1990
   
     give the ADC count threshold for mode IMOD ( =1 or 2 )
     take zero sup. values from EZTH bank
    - called from ECTDZS                                    this .HLB
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   EDTZSU                                                                          
        |---- EDTCUT                                                               
                   |----  EBTZTH                              External             
                   |----  EDTGAI                              External             
                   |----  EDZTHR                              External             
   
 
3 EDTDIG
         SUBROUTINE EDTDIG
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
        O.CALLOT   27-NOV-85
   Convert signal to digit
    - called from ECDIGI                                   this .HLB
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   ECDIGI                                                                          
        |---- EDTDIG                                                               
                   |----  EDTGAI                              External             
                   |----  EDTGER                              External             
                   |----  RNDM                                                     
                   |----  NINT                                External             
                   |----  FLOAT                               External             
   
 
3 EDTONO
         SUBROUTINE EDTONO
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
      O.CALLOT   17-MAR-86
   Add noise to analog signal
      Built a map of the hit zones in ECAL
    - called from ECDIGI                                  this .HLB
    - calls      EDSNOI,EDTADJ          This .HLB
                 ALTELL,ECRWRG          ALEPHLIB
                 RANNOR                 CERNLIB
                  VFILL,VZERO,UCOPY,NORRAN                CERNLIB
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   ECDIGI                                                                          
        |---- EDTONO                                                               
                   |----  ECRWRG                              External             
                   |----  IBITS                               External             
                   |----  EDTADJ                                                   
                   |----  WBANK                               External             
                   |----  INTCHA                              External             
                   |----  RANNOR                              External             
                   |----  ISHFT                               External             
                   |----  EDSNOI                                                   
                   |----  NINT                                External             
                   |----  ALTELL                              External             
   
 
3 EDTRGI
         SUBROUTINE EDTRGI(KTHEB)
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
      G.de BOUARD   4-OCT-87
   Initialisation of trigger region theta limits in ecal
    - called from ECTRIG                              this .HLB
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   ECTRIG                                                                          
        |---- EDTRGI.                                                              
   
 
3 EDTZSU
         SUBROUTINE EDTZSU
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
       O.CALLOT   27-NOV-85
   Zero suppression in towers
    - called from ECDIGI                                 this .HLB
    - calls       EDTCUT,EDTADJ                          this .HLB
                  VFILL ,VZERO ,UCOPY                    CERNLIB
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   ECDIGI                                                                          
        |---- EDTZSU                                                               
                   |----  EDTCUT                                                   
                   |----  EDTADJ                                                   
                   |----  ALBOS                               External             
                   |----  BLIST                               External             
                   |----  ISHFT                               External             
   
 
3 EDWBRU
         SUBROUTINE EDWBRU
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Simulate noise on wire readout
     AUTHOR   : B. MICHEL, D. PALLIN 05/89
     MODIFIED :
     Called by : ECDIGI
     Calls     : EPRIMI  from this HLB
               : RANNOR       Genlib
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   ECDIGI                                                                          
        |---- EDWBRU                                                               
                   |----  AMSUM                               External             
                   |----  LEWDIAIWIRES                        External             
                   |----  NINT                                External             
                   |----  REAL                                External             
                   |----  EPRIMI                                                   
                   |----  FLOAT                               External             
                   |----  IFIX                                External             
                   |----  RANNOR                              External             
   
 
3 EDWDGT
         SUBROUTINE EDWDGT
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Digitize wire signals
       AUTHOR : B.MICHEL , D.PALLIN , 05/89
       REVISED: 06/06/90
       Banks created : EWDI,EWHE
       Called by : ECDIGI
       Calls ALBOS, BLIST from BOS lib.
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   ECDIGI                                                                          
        |---- EDWDGT                                                               
                   |----  NTMODUIMODH                         External             
                   |----  FLOAT                               External             
                   |----  NINT                                External             
                   |----  IFIX                                External             
                   |----  REAL                                External             
                   |----  CONSUMIF                            External             
                   |----  LEWDIASWIRES                        External             
                   |----  LEWDIAIWIRES                        External             
                   |----  ALBOS                               External             
                   |----  BLIST                               External             
   
 
3 EHADRN
         SUBROUTINE EHADRN( ICOND , XGERB )
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
          J.Badier - 17/03/87
   Tirage d'une gerbe hadronique.
     INPUT   ICOND = 0    Initialisation
                     1    Tirage d'un point.
     OUTPUT  XGERB        Coordonnees du point tire dans le systeme
                          de la gerbe. XGERB(1) en cm selon l'axe.
          Call RANNOR , RNDM.
     Appele par EHGERBE
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
              EHADRN                                                               
                   |----  RNDM                                                     
                   |----  RANNOR                              External             
   
 
3 EHBARI
         SUBROUTINE EHBARI(XMAX1,XMAX2,YMAX,ZMAX1,ZMAX2)
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   /B.B Special interface for BARREL
    EVOLPL,EVOLCR from ALEPHLIB
    by EHGEOB
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   EHGEOB                                                                          
        |---- EHBARI                                                               
                   |----  EVOLPL                              External             
                   |----  EVOLCR                              External             
   
 
3 EHCHAR
         SUBROUTINE EHCHAR(PDEP,TRLEN,IPLAN,NGTR)
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
    M.Rumpf      Jan 86
   Track elem. energy
    Input : PDEP  (NGTR)     Energy deposition point
            TRLEN (NGTR)     Track segment length
            IPLAN (NGTR)     Wire plane number
            NGTR             number of points
    Store results in temporary bank PSIG
    UNIT for signal is 1 Kev integer
    - Called by EHTRKE
    - Calls     EHDEPT,WBANK
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   EHTRKE                                                                          
        |---- EHCHAR                                                               
                   |----  WBANK                               External             
                   |----  INTCHA                              External             
                   |----  FHISJO                              External             
                   |----  EHDEPT                                                   
                   |----  IUCOMP                              External             
                   |----  MOD                                 External             
                   |----  FLOAT                               External             
                   |----  HFILL                               External             
   
 
3 EHCHEK
         SUBROUTINE EHCHEK(NST,DTB,PTB,PV,MFLSL)
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   
   Parametrisation allowed ?
    TEST IF DISTANCE IN MODULE ALLOWS PARAMETRISATION OR NOT
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   EHCUTF                                                                          
        |---- EHCHEK                                                               
                   |----  ABS                                 External             
                   |----  SIGN                                External             
                   |----  ACOS                                External             
                   |----  ALOG                                External             
                   |----  COS                                 External             
                   |----  CCS3EH                              External             
   
 
3 EHCPWI
         SUBROUTINE EHCPWI
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
    March 86
   Fill wire bank ewht
    - Called by ECASIG
    - Calls ALBOS,BKFMT,BLIST
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
              EHCPWI                                                               
                   |----  ALBOS                               External             
                   |----  BLIST                               External             
   
 
3 EHCUTF
         SUBROUTINE EHCUTF(MFLAG)
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
    R.Clifft                       mod   M.Rumpf March 87
   Fast tracking or not?
    MFLAG = 0|1 --> no|yes
    called by ECHIT
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   ECHIT                                                                           
        |---- EHCUTF                                                               
                   |----  ABS                                 External             
                   |----  SQRT                                External             
                   |----  UHTOC                               External             
                   |----  EHEDGE                                                   
                   |----  EHCHEK                                                   
   
 
3 EHCUTG
         SUBROUTINE EHCUTG (MFLAG)
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   - J.Badier  F.Ranjard - 870817
   Decide wheither yes/no a geantino is created
   - MFLAG = 0 no creation
             1 creation
   - called from   ECHIT                           from this .HLB
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   ECHIT                                                                           
        |---- EHCUTG                                                               
                   |----  SQRT                                External             
                   |----  ABS                                 External             
   
 
3 EHCUTP
         SUBROUTINE EHCUTP
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   
   Fast tracking init
    CONSTANTS FOR FAST TRACKING DECISION IN ECAL MODULES
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   ECDFPA                                                                          
        |---- EHCUTP.                                                              
   
 
3 EHDEPH
         SUBROUTINE EHDEPH(NRJDP)
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
         J.Badier - 16/03/87
   Energy for hadr. shower
         Energie deposee pour les points d'une gerbe hadronique.
         L'unite est le kev.
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   CAHGRB                                                                          
        |---- EHDEPH                                                               
                   |----  RNDM                                                     
                   |----  NINT                                External             
   
 
3 EHDEPS
         SUBROUTINE EHDEPS(NRJDP)
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
         J.Badier - 11/12/85
   Energy  e.m shower points
         Tirage de l'energie deposee par les points d'une gerbe
         selon la condition TIRAGE
           Output : NRJDP Energie deposee en Kev
    - Called by EHGERB
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   CAGERB                                                                          
   EHGERB                                                                          
        |---- EHDEPS                                                               
                   |----  RNDM                                                     
                   |----  NINT                                External             
   
 
3 EHDEPT
         SUBROUTINE EHDEPT (DELT,NRJ)
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
         J.Badier - 25/3/86
   Tr. elem energy deposit
         Depot d'energie pour un segment de trace
             Input :  DELT Longueur du segment (for hadrons..)
             Output:  NRJ  Energie deposee en KEV
    - Called by EHCHAR
    - calls      IUCOMP                              KERNLIB
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   EHCHAR                                                                          
        |---- EHDEPT                                                               
                   |----  RNDM                                                     
                   |----  FLUCT1                              External             
                   |----  FLUCT2                              External             
                   |----  NINT                                External             
                   |----  CHAHOL                              External             
                   |----  EBEBLO                                                   
                   |----  ELANDA                                                   
                   |----  EPICUT                              External             
   
 
3 EHEDGE
         SUBROUTINE EHEDGE (NST,PV,XV,YV,ZV,UV,VV,WV,DPERP,DTOT,MFLEG)
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   
   Shower edge proximity
    CALCULATE PROXIMITY TO EDGES AND DECIDE TO CONTAIN
    SHOWER OR NOT
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   EHCUTF                                                                          
        |---- EHEDGE                                                               
                   |----  EHTRAN                                                   
                   |----  ABS                                 External             
                   |----  EHGEOB                                                   
                   |----  AMIN1                               External             
                   |----  EXP                                 External             
                   |----  EHGEOE                                                   
   
 
3 EHGEOB
         SUBROUTINE EHGEOB (ILAY,X,Y,Z,U,V,W,XSEP,YSEP,ZTB,DTB,MFLSI)
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
           mod Rumpf
   Edges geom for barrel mod.
    CALCULATE EDGES GEOMETRY FOR BARREL MODULES
    EHBARI
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   EHEDGE                                                                          
        |---- EHGEOB                                                               
                   |----  TAN                                 External             
                   |----  EHBARI                                                   
                   |----  SIGN                                External             
                   |----  ABS                                 External             
                   |----  ACOS                                External             
                   |----  ATAN2                               External             
                   |----  SIN                                 External             
                   |----  COS                                 External             
                   |----  SQRT                                External             
   
 
3 EHGEOE
         SUBROUTINE EHGEOE (ILAY,X,Y,Z,U,V,W,ZSEP,XSEP,YTB,DTB,MFLSI)
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
                               Mod. Rumpf
   Edges geom for end cap mod.
    CALCULATE EDGES GEOMETRY FOR END CAP MODULES
    EHPETA
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   EHEDGE                                                                          
        |---- EHGEOE                                                               
                   |----  TAN                                 External             
                   |----  EHPETA                                                   
                   |----  SIGN                                External             
                   |----  ABS                                 External             
                   |----  ACOS                                External             
                   |----  ATAN2                               External             
                   |----  SIN                                 External             
                   |----  COS                                 External             
                   |----  SQRT                                External             
   
 
3 EHGERB
         SUBROUTINE EHGERB(ENER,IFIN,XGERB,NRJDP)
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
         J.Badier - 11/12/85
         J.Badier - 16/03/87 : Adaptation aux gerbes hadroniques.
   Computes shower points
      Input : ENER   Energie totale de la gerbe (Gev)
      Le premier appel est une initialisation selon la condition
             TIRAGE = 'FLUCTUATED' methode standard
                      'VERY FAST' methode rapide (Defaut)
         Output  IFIN :  Nombre de points a tirer dans la gerbe
      Aux appels suivants  (IFIN NE 0)
         Output  XGERB:  Coordonnees du i eme point i=1,IFIN
                 NRJDP   Signal exprime en kev pour ce point.
     - Called by EHSHOW
     - Calls POISSN,EHLOTI,EHTRTI,EHDEPS
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   EHSHOW                                                                          
        |---- EHGERB                                                               
                   |----  POISSN                              External             
                   |----  CAEPAR                                                   
                   |----  EHLOTI                                                   
                   |----  ELIMST                              External             
                   |----  EHTRTI                                                   
                   |----  RNDM                                                     
                   |----  COS                                 External             
                   |----  SIN                                 External             
                   |----  EHDEPS                                                   
   
 
3 EHIBOS
         SUBROUTINE EHIBOS
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
    M.Rumpf
   Ecal bos banks init
    - Called by ECHIT
    - Calls     BKFMT,BLIST
   
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   ECHIT                                                                           
        |---- EHIBOS                                                               
                   |----  BDROP                               External             
                   |----  ALBOS                               External             
                   |----  BLIST                               External             
   
 
3 EHLOTI
         SUBROUTINE EHLOTI( ICOND , CLOTI )
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
         J.Badier - 27/ 2/86
                    Modifie le 13/03/87.
   Shower longitud. profile
   ----- Tirage longitudinal d'une gerbe .
     Input:
         ICOND = 0 phase initialisation
                 1 Tirage d'un point
     Output:
         CLOTI  tirage logitudinal en longueurs de radiation.
         METH a ete defini dans la phase d'initialisation
     Calls EHPALO , RNDM , GAUSS ,GAMMA
        Apelle EHPALO,RANNOR,RNDM,GAUSS,GAMMA
         Appele par EHGERB
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   EHGERB                                                                          
        |---- EHLOTI                                                               
                   |----  GAUSS                               External             
                   |----  EHPALO                                                   
                   |----  EXP                                 External             
                   |----  GAMMA                               External             
                   |----  NINT                                External             
                   |----  RNDM                                                     
                   |----  ALOG                                External             
   
 
3 EHPALO
         FUNCTION EHPALO( X )
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
         J.Badier - 11/12/85
   Longitud. parametrisation
         Forme reduite de la parametrisation longitudinale
         EMALM1 = ALPHA - 1.
         X = [BETA * (Z cm /Lrad cm)] / EMALM1
      -Called by EHLOTI
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   EHLOTI                                                                          
        |---- EHPALO                                                               
                   |----  EXP                                 External             
   
 
3 EHPASR
         SUBROUTINE EHPASR
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
         J.Badier - 27/ 2/86
         J.Badier - Modifie le 16/03/87.
   Init param. for signals
         Initialisation des parametres pour la creation de signal.
    - Called by ECDFPA
    - Calls  none
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   ECDFPA                                                                          
        |---- EHPASR                                                               
                   |----  SQRT                                External             
                   |----  NINT                                External             
   
 
3 EHPETA
         SUBROUTINE EHPETA(XMAX,YMAX1,YMAX2,ZMAX)
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   /B.B Special interface for END CAPS
    EVOLPL,EVOLCR from ALEPHLIB
    by EHGEOE
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   EHGEOE                                                                          
        |---- EHPETA                                                               
                   |----  EVOLPL                              External             
                   |----  EVOLCR                              External             
   
 
3 EHSHOW
         SUBROUTINE EHSHOW (ISCMP,MODUL)
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
     J.Badier 11/12/85    M.Rumpf  00/01/86
   Shower creation steering
    SHOWER for track element selected by EHCUTF
    and signals stored in temporary bank 'PSIG'
     - avec NSIGNL points de cordonnees POSSG
   ----- TIRAGE : 'FLUCTUATED' pour tirage standard
   -----          'VERY FAST'  pour tirage rapide
     - Called by ECHIT
     - Calls     EHGERB,ECSGEO,EHSITW,UCOPY
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   ECHIT                                                                           
        |---- EHSHOW                                                               
                   |----  CAGERB                                                   
                   |----  CAHGRB                                                   
                   |----  CAPSTO                                                   
                   |----  EHGERB                                                   
                   |----  ECSGEO                              External             
                   |----  WBANK                               External             
                   |----  INTCHA                              External             
                   |----  EFNLAY                              External             
                   |----  EHSITW                                                   
   
 
3 EHSITW
         SUBROUTINE EHSITW(ISCMP,MODUL,TYGEO)
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
    M.Rumpf Dec 85
   Ecal signals -->addresses
      Process ECAL Signals for one Geant3 Track Element
      Find Towers and wire planes addresses
     - Called by EHTRKE,EHSHOW
     _ Calls     EHSMTW,EHSMWI,EHTTWD
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   EHSHOW                                                                          
   EHTRKE                                                                          
        |---- EHSITW                                                               
                   |----  ECPLST                              External             
                   |----  EFNDCL                              External             
                   |----  EFNDLG                              External             
                   |----  EVERIF                                                   
                   |----  MVBITS                              External             
                   |----  CAHIST                                                   
   
 
3 EHTRAN
         SUBROUTINE EHTRAN (XV,YV,ZV,UV,VV,WV,X,Y,Z,U,V,W)
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   
   Towards local coordinates
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   EHEDGE                                                                          
        |---- EHTRAN.                                                              
   
 
3 EHTRKE
         SUBROUTINE EHTRKE(ISCMP,MODUL)
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
    M.Rumpf Dec 85
   Track elem. signal steering
      INPUT : ISCMP  1 = end cap z>0  2 = Barrel  3 = End cap z<0
            : MODUL   module number
        - Called by ECHIT
       Calls EHSIMT,EHCHAR,EHSITW
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   ECHIT                                                                           
        |---- EHTRKE                                                               
                   |----  EHSIMT                              External             
                   |----  ABS                                 External             
                   |----  EFNDPL                              External             
                   |----  EHCHAR                                                   
                   |----  EHSITW                                                   
   
 
3 EHTRTI
         SUBROUTINE EHTRTI( ZLON , RADIS )
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
         J.Badier - 11/12/85
         J.Badier - 16/03/87 : modifie
         J.Badier - 11/08/87 : modifie
   Tirage transversal
      Input : ZLON    Distance a l'origine de la gerbe en cm.
      Output: RADIS   Distance a l'axe de la gerbe
    - Called by EHGERB
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   CAGERB                                                                          
   CAHERB                                                                          
   EHGERB                                                                          
        |---- EHTRTI                                                               
                   |----  RNDM                                                     
   
 
3 ELANDA
         SUBROUTINE ELANDA(T,W)
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
        S.SNOW   02/5/89
   Get a landau distribution from a look-up table
    INPUT : T is the length of the step in gas ( cm )
    : W is a number drawn from a distribution having the correct
                       shape and a mean of 1.0
    Landau distribution is taken from test beam data with
   -interacting particles in the ECAL end cap .
    is the energy distribution measured in a single wire plane,
    to have a mean of 1 ( the rms is about 1.23 ) .
    Called by EHDEPT
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   EHDEPT                                                                          
        |---- ELANDA                                                               
                   |----  FLOAT                               External             
                   |----  RNDM                                                     
   
 
3 EPRIMI
         FUNCTION EPRIMI(X)
  ------------------------------------------------------------------------------
    CKEY ECAL / INTERNAL
  ------------------------------------------------------------------------------
   Returns the wire signal value integrated during x ns
    Author M.Bernard/D.Pallin
   - Input  : X      / R   = time in ns
   - Output : EPRIMI / R   = wire signal value integrated during X ns
    Called by EDWBRU
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   EDWBRU                                                                          
        |---- EPRIMI                                                               
                   |----  EXP                                 External             
   
 
3 EUPPAR
         SUBROUTINE EUPPAR
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   -   M.N Minard              10.3.95
      Update digitisation parameters for ECAL
      when available
      Called from ECIRUN
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   ECIRUN                                                                          
        |---- EUPPAR                                                               
                   |----  NAMIND                              External             
                   |----  FLOAT                               External             
   
 
3 EVERIF
         SUBROUTINE EVERIF(ILG,ICL,IMODU,IOK)
  ------------------------------------------------------------------------------
    CKEY ECAL
  ------------------------------------------------------------------------------
   Check consistency of ecal address
   - MNM - 960404
   - Input   : ILG    / I = ecal row no.
               ICL    / I = ecal column no.
               IMODU  / I = ecal module no.
   - Output  : IOK    / I = new row number if .ne. 0
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   EHSITW                                                                          
        |---- EVERIF                                                               
                   |----  MOD                                 External             
   

2 GAL

  >>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>
    CKEY 
     1st entry in GALEPH library
       GALEPH is the ALEPH simulation program based on GEANT/GHEISHA.
       It uses the BOS memory manager.
       Full documentation can be found in 1 set.
       partial documentation on a given set can be found in *CD setnNEWS.
    
     ! GALEPH 25.6
       GALEPH - increase size of ZEBRA common to fit SiCAL geometry.
    
     ! GALEPH 25.5
       GALEPH - add a CALL TIMEST(99999.) to please new TIMEL
                routine on VAX when running interactively
    
  <<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<
     ALDUMMY 
     GALEPH     Montecarlo main routine
     GRANEQ     Galeph interface between rndm and ranecu.
     QNEXT      Calls next event or end of job
     USCEVE 
     USCJOB 
     USCRUN 
     USIEVE 
     USIJOB 
     USIRUN 

3 ALDUMMY
         SUBROUTINE AUNPCK (ELIST,ULIST,IFLG)
  ------------------------------------------------------------------------------
    CKEY GAL /INTERNAL
  ------------------------------------------------------------------------------
   - F.Ranjard -
   - dummy alephlib routine in galeph
   
 
3 GALEPH
         PROGRAM GALEPH
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Montecarlo main routine
    - F.RANJARD - 850222
    version
   - GALEPH   30.9    991129
         PARAMETER (GALVER=30.9)
         PARAMETER (CORVER=0.0)
   
         GALVER    = GALEPH version #
   
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
              GALEPH                                                               
                   |----  TIMEST                              External             
                   |----  GZEBRA                              External             
                   |----  HLIMIT                              External             
                   |----  ASIGAL                                                   
                   |----  QNEXTE                              External             
   
 
3 GRANEQ
   
  ------------------------------------------------------------------------------
    CKEY GAL RNDM RANECU ALSEED
  ------------------------------------------------------------------------------
   Galeph interface between rndm and ranecu.
       The code of RANECU is put in the comdeck RANECU and then called
       in RNDM and GRNDM.
       the package must be initialize by a call to RECUST before the
       1st call to GRNDM or RNDM.
       the package contains the following entries:
         SUBROUTINE ALSEED(IRGEN,ISD1,ISD2)
         Output : IRGEN = generator ident (2 is RANECU)
                  ISD1= first original seed
                  ISD2= second original seed
         SUBROUTINE RDMIN(ISEED)
         FUNCTION RNDM(DUMMY)
         SUBROUTINE RDMOUT(ISEED)
   
   
         SUBROUTINE ALSEED(IRGEN,ISD1,ISD2)
   - Author : B.Bloch-Devaux -890201
    returns original seeds from RANECU random generator
  ------------------------------------------------------------------------------
    CKEY GAL RANECU SEED / USER
  ------------------------------------------------------------------------------
   - Structure : SUBROUTINE subprogram
                 User Entry Name :ALSEED
                 External references :RECUUT
                 Comdecks references : none
   - Input : none
   - Output : IRGEN = generator ident (2 is RANECU)
              ISD1= first original seed
              ISD2= second original seed
    arndmc
         PARAMETER (LRVEC=100)
         COMMON /ARNDMC/ RVEC(LRVEC),NRVEC,ISEED1,ISEED2
   
    RANECU server common block / INTERNAL
      RVEC         list of RANECU random numbers
      LRVEC        length of the RANECU list
      NRVEC        pointer in the RANECU list
      ISEED1       1st RANECU seed
      ISEED2       2nd RANECU seed
   
         IRGEN = 2
         ISD1 = ISEED1
         ISD2 = ISEED2
         RETURN
         END
         SUBROUTINE RDMIN(ISEED)
   - Author : B.Bloch-Devaux -890201
    from RDMIN to RECUIN (RANECU initialization)
    with ISEED(1) and ISEED(2) and reset the server
   - Structure : SUBROUTINE program
                 User Entry Name :RDMIN
                 External references :RECUIN, RRESET
   - Input : ISEED   2 input seeds
   - Output : none
    arndmc
         PARAMETER (LRVEC=100)
         COMMON /ARNDMC/ RVEC(LRVEC),NRVEC,ISEED1,ISEED2
   
    RANECU server common block / INTERNAL
      RVEC         list of RANECU random numbers
      LRVEC        length of the RANECU list
      NRVEC        pointer in the RANECU list
      ISEED1       1st RANECU seed
      ISEED2       2nd RANECU seed
   
         INTEGER ISEED(*)
         ISEED1 = ISEED(1)
         ISEED2 = ISEED(2)
         NRVEC = LRVEC
         END
         FUNCTION RNDM(DUMMY)
   - Author : B.Bloch-Devaux -890201
    from RNDM to RANECU.
    as a server of 100 numbers from one RANECU call
   - Structure : REAL FUNCTION subprogram
                 User Entry Name :RNDM,RECUST
                 Comdecks references : ARNDMC
   - Input : DUMMY   dummy
   - Output : Real value between 0. and 1.
    arndmc
         PARAMETER (LRVEC=100)
         COMMON /ARNDMC/ RVEC(LRVEC),NRVEC,ISEED1,ISEED2
   
    RANECU server common block / INTERNAL
      RVEC         list of RANECU random numbers
      LRVEC        length of the RANECU list
      NRVEC        pointer in the RANECU list
      ISEED1       1st RANECU seed
      ISEED2       2nd RANECU seed
   
         IF(NRVEC.EQ.LRVEC) THEN
    ranecu
   =================== CALL RANECU(RVEC,LRVEC)========================
            DO 100 I= 1, LRVEC
               K = ISEED1/53668
               ISEED1 = 40014*(ISEED1 - K*53668) - K*12211
               IF (ISEED1 .LT. 0) ISEED1=ISEED1+2147483563
               K = ISEED2/52774
               ISEED2 = 40692*(ISEED2 - K*52774) - K* 3791
               IF (ISEED2 .LT. 0) ISEED2=ISEED2+2147483399
               IZ = ISEED1 - ISEED2
               IF (IZ .LT. 1)  IZ = IZ + 2147483562
               RVEC(I) = REAL(IZ) * 4.6566128E-10
     100    CONTINUE
           NRVEC=0
         ENDIF
         NRVEC=NRVEC+1
         RNDM=RVEC(NRVEC)
         RETURN
   - start up of RANECU
         ENTRY RECUST
         ISEED1 = 12345
         ISEED2 = 67890
         NRVEC = LRVEC
         RETURN
         END
         SUBROUTINE RDMOUT(ISEED)
   - Author : B.Bloch-Devaux -890201
    Initialize RANECU and reset the server
   - Structure : SUBROUTINE subprogram
                 User Entry Name :RDMOUT
   
                 Comdecks references : ARNDMC
   - Input : none
   - Output : Array of generator seeds (integer)
    arndmc
         PARAMETER (LRVEC=100)
         COMMON /ARNDMC/ RVEC(LRVEC),NRVEC,ISEED1,ISEED2
   
    RANECU server common block / INTERNAL
      RVEC         list of RANECU random numbers
      LRVEC        length of the RANECU list
      NRVEC        pointer in the RANECU list
      ISEED1       1st RANECU seed
      ISEED2       2nd RANECU seed
   
         INTEGER ISEED(*)
         ISEED(1) = ISEED1
         ISEED(2) = ISEED2
         NRVEC = LRVEC
         RETURN
         END
 
3 QNEXT
         SUBROUTINE QNEXT
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   - F.Ranjard - 870105
   Calls next event or end of job
   - Called from QNEXTE                                from cernlib
   - Calls       ACRUN, ASCEVE, ASPRUN                 from this .HLB
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
              QNEXT                                                                
                   |----  ASPRUN                                                   
                   |----  RDMOUT                                                   
                   |----  ASCRUN                                                   
                   |----  ASCJOB                                                   
   
 
3 USCEVE
   
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   - GALEPH dummy user routines
   
         SUBROUTINE USCEVE
         RETURN
         END
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   ASCEVE                                                                          
        |---- USCEVE.                                                              
   
 
3 USCJOB
         SUBROUTINE USCJOB
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
         RETURN
         END
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   ASCJOB                                                                          
        |---- USCJOB.                                                              
   
 
3 USCRUN
         SUBROUTINE USCRUN
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
         RETURN
         END
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   ASCRUN                                                                          
        |---- USCRUN.                                                              
   
 
3 USIEVE
         SUBROUTINE USIEVE
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
         RETURN
         END
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   ASIEVE                                                                          
        |---- USIEVE.                                                              
   
 
3 USIJOB
         SUBROUTINE USIJOB
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
         RETURN
         END
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   ASIJOB                                                                          
        |---- USIJOB.                                                              
   
 
3 USIRUN
         SUBROUTINE USIRUN
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
         RETURN
         END
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   ASIRUN                                                                          
        |---- USIRUN.                                                              
   

2 GEOM

  >>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>
    CKEY 
     1st entry in GEOM set which builds the geometry using GEANT.
       detailed documentation can be found in *DK AGDOC.
    
     ! GALEPH 30.2
       remove calls to GSORD which is now a 'do nothing' routine.
       AGGORD - remove the routine.
       AGSATT - new routine , copied from GUINTI which is removed.
                set volume attributes which are not set by *ATT bank.
       AGGORD - remove the routine, code is included into AGGEAN.
       AGGEAN - read *ATT banks and call GSATT.
       AGEOME - call AGSATT before closing the geometry.
       AGVF92 - '92 vdet face geometry.
       AGVF95 - '95 vdet face geometry.
       AGVDET - call AGVF92 or AGVF95 depending oN the year.
    
     ! GALEPH 25.6
        AGMATE : add a SAVE statment ( this routine is never called)
    
     ! GALEPH 25.5
        AGEOME : update description of central region     (B.Bloch May 1993)
        AGITCH : implement geometry from Data base banks  (B.Bloch May 1993)
        AGHCAL : update materials (L.Silvestris)
    
     ! GALEPH 25.5
        AGEOME : update description of central region     (B.Bloch May 1993)
        AGITCH : implement geometry from Data base banks  (B.Bloch May 1993)
        AGHCAL : update materials (L.Silvestris)
    
    
     ! GAL254
       AGCHCK, AGGEAN, AGGATT, AGGORD:
       calls ALGTDB instead of MDARD with the setup code to avoid to
       repeat on the data base geometry banks with different NR but
       with identical content.
       AGCHCK, AGSCAL, AGVDET:
       change test on setupcode from .EQ.last to .GE.last
    
  <<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<
     AGBEAM     Build beam pipe geometry up to compensator parts
     AGCHCK     Check validity of geometry data and selected detectors
     AGCOIL     Build coil geometry
     AGDIMP     Add the volume named 'volna' at level lvlvo to the list used
     AGECAL     Build e/gamma calorimeter geometry (barrel and end-caps)
     AGECPM     Implement passive material related to ecal
     AGEMAT     Define materials needed in the ecal
     AGEOME     Build geometry for aleph detector 'a la geant3'
     AGGEAN     Implement detector  geometry
     AGHCAL     Implement   hadron calorimeter geometry
     AGITCH     Build itc chamber and related cables and supports geometry
     AGLCAL     Implement luminosity calorimeter geometry
     AGMATE     Returns the geant material # known by its name
     AGMEDI     Returns the geant tracking medium # known by its name
     AGMIX      Fills density from thickness of components
     AGMUCH     Implement muon chambers geometry
     AGQUAD     Implement forward and backward quadrupoles geometry
     AGSATR     Implement small angle track detector geometry
     AGSATT     Set geant drawing attributes
     AGSCAL     Build scal geometry
     AGSI92     Build scal geometry for crystals and ceramics
     AGSMBA     Build samba geometry for materials in geant
     AGTPCH     Implement tpc geometry
     AGVDET     Build vdet geometry
     AGVF92     Defines and positions vdet 92 faces in geant
     AGVF95     Defines and positions vdet 95 faces in geant
     AGVF96     Defines and positions vdet 96 faces described in

3 AGBEAM
         SUBROUTINE AGBEAM
  ------------------------------------------------------------------------------
    CKEY BPIPE GEOM
  ------------------------------------------------------------------------------
   Build beam pipe geometry up to compensator parts
                                B. BLOCH-DEVAUX 19 MARCH 85
       modified 15 april 86  for revised implementation
       modified sept 87 to implement Data Base  Banks
       modified Novem 90 to implement New Beam pipe from 91 onwards
       modified January 92 for 92 beam pipe and complete rewriting...
   - called by AGEOME
   - calls     AGGEAN                            from this Lib
   - calls     ALTELL                            from ALEPHLib
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   AGEOME                                                                          
        |---- AGBEAM                                                               
                   |----  AGGEAN                                                   
   
 
3 AGCHCK
         SUBROUTINE AGCHCK
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
    B. Bloch-Devaux   _  850619
           modified 7 septembre 87 for DATA BASE usage
           modified November 15 , 1990 for geometry setup usage
   Check validity of geometry data and selected detectors
     and set up array IGEOJO in common JOBCOM according to selected
         detectors
        Fills FMGEOM common with boundaries of field regions
   - modified by : F.Ranjard - 911002
                   change COIL component # to 13 instead of 9
   - modified by : B.Bloch-Devaux - 911015
                   handle SATR or SCAL depending on setup number
   - modified by : B.Bloch-Devaux - 920110
                   handle more beam pipes.....
      Called by AGEOME                  from this .HLB
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   AGEOME                                                                          
        |---- AGCHCK                                                               
                   |----  ALGTDB                              External             
                   |----  ALTELL                              External             
                   |----  GTSTUP                              External             
                   |----  NAMIND                              External             
                   |----  MIN                                 External             
                   |----  MAX                                 External             
                   |----  INTCHA                              External             
                   |----  AMAX1                               External             
                   |----  EVOLPL                              External             
                   |----  EVOLCR                              External             
                   |----  ABS                                 External             
                   |----  HCRMIN                              External             
                   |----  HCRMAX                              External             
                   |----  HCZMIN                              External             
                   |----  HCZMAX                              External             
                   |----  COS                                 External             
                   |----  LVELJO                              External             
   
 
3 AGCOIL
         SUBROUTINE AGCOIL
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Build coil geometry
     Author :B. Bloch-Devaux                      19 March 85
          modified for data base access           sept. 87
     -Called by AGEOME                  from this .HLB
     -Calls GSMATE,GSTMED,GSVOLU,GSPOS, from  GEANT3
   
    -Stores extra material needed
    -Stores extra Tracking Media needed
    -Builds geometry levels below 'COIL' level
    -Initialises some search optimisation
   
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   AGEOME                                                                          
        |---- AGCOIL                                                               
                   |----  NAMIND                              External             
                   |----  GHSIGM                              External             
                   |----  GSMATE                              External             
                   |----  GSVOLU                              External             
                   |----  GSPOS                               External             
                   |----  GSTMED                                                   
   
 
3 AGDIMP
         SUBROUTINE AGDIMP(VOLNA,LVLVO,DETNA)
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
        O.Callot     11-jun-86
   Add the volume named 'volna' at level lvlvo to the list used
    to generate the IMPA bank, with detector name DETNA.
     Calls  INTCHA                                      BOS lib
     Called by various AGxxxx routines
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   AGITCH                                                                          
   AGLCAL                                                                          
   AGMUCH                                                                          
   AGSATR                                                                          
   AGSCAL                                                                          
   AGTPCH                                                                          
   AGVDET                                                                          
        |---- AGDIMP                                                               
                   |----  INTCHA                              External             
                   |----  CHAINT                              External             
   
 
3 AGECAL
         SUBROUTINE AGECAL
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Build e/gamma calorimeter geometry (barrel and end-caps)
      Author:B. Bloch-Devaux                  April 85
                          modified sept 87 to use  Ecal volume package
                          some more addition of material June 89
                         when possible use automatic division to speed up
     -Called by AGEOME                  from this .HLB
     -Calls GSMATE,GSMIXT,GSTMED,GSVOLU,GSPOS,GSPOSP,GSROTM from  GEANT3
   
    -Stores extra material and mixtures required
    -Stores extra Tracking Media needed
    -Builds geometry levels below 'ECBL' level for Barrel part
    -Builds geometry levels below 'ECEA' and 'ECEB' for end-cap part
   
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   AGEOME                                                                          
        |---- AGECAL                                                               
                   |----  IDETJO                              External             
                   |----  ECTILT                              External             
                   |----  EVOLPL                              External             
                   |----  EVOLCR                              External             
                   |----  COS                                 External             
                   |----  ABS                                 External             
                   |----  GSTMED                                                   
                   |----  GSVOLU                              External             
                   |----  GSPOS                               External             
                   |----  GSDVN2                              External             
                   |----  GSROTM                              External             
                   |----  GSPOSP                              External             
                   |----  JHOCHA                              External             
                   |----  GSDVN                               External             
   
 
3 AGECPM
         SUBROUTINE AGECPM(IFL)
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   B. Bloch-Devaux   november 87
   Implement passive material related to ecal
    IFL  : 1 Passive material in ECEA (B) volumes
           2 Passive material in HCEA (B) volumes
    the numbers explicitly in the code will be
        removed when better known and thus included
        in the Data Base
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
              AGECPM                                                               
                   |----  NAMIND                              External             
                   |----  ECTILT                              External             
                   |----  MIN                                 External             
                   |----  MAX                                 External             
                   |----  GSTMED                                                   
                   |----  GSVOLU                              External             
                   |----  GSPOS                               External             
                   |----  GSPOSP                              External             
                   |----  ABS                                 External             
                   |----  TAN                                 External             
   
 
3 AGEMAT
         SUBROUTINE AGEMAT
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Define materials needed in the ecal
     B. Bloch-Devaux    November 1987
     This routine will disappear when we will use
    the more general Data Base of material included
     in the Aleph DB
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   AGEOME                                                                          
        |---- AGEMAT                                                               
                   |----  GSMIXT                              External             
                   |----  AGMIX                                                    
                   |----  IGEOJO                              External             
   
 
3 AGEOME
         SUBROUTINE AGEOME
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Build geometry for aleph detector 'a la geant3'
                                          B. BLOCH DEVAUX 18 MARCH 85
                                          Modified september 87
                                       Modified November  90 ( new BPIP)
   - modified by : F.Ranjard - 911002
                   change COIL component # to 13 instead of 9
   - modified by : B.Bloch-Devaux - 911015
                   introduce SCAL related calls and mods for inner
                   tracking region ( SAMBA and others..)
     called by    ASIRUN                                   from this .HLB
     calls   AGBEAM,AGVDET,AGITCH,AGTPCH,AGECAL,AGLCAL,AGSMBA
             AGCOIL,AGQUAD,AGHCAL,AGMUCH,AGCHCK            from this .HLB
     calls   GGCLOS,GPMATE,GPTMED,GPROTM,GPVOLU
             GSMATE,GMATE,GSTMED,GSROTM,GSVOLU,GSPOS    from GEANT3
   
    -Checks the consistency of the geometry data
    -Stores the material table for widely used materials
    -Stores Tracking Media #1,#2 and #3  as ALEPH volume of air
     inside field (resp. outside field,non uniform field) for general use
    -Store Rotation Matrices #1,2,3 as
             1 Identity matrix,
             2 Rotation around Y axis (180 deg):end-cap A --> end-cap B
             3 Rotation around Z axis (180 deg):right half --> left half
    -Builds the first and second levels of the tree structure according
      to the required fiducial volume and the selected detectors.
    -Calls specific detector geometry routines if required
    -Initialises some search optimisation
    -Closes geometry banks and prints out (IPRIJO(19))the stored quantiti
    -Get cross-section and energy loss tables
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   ASIJOB                                                                          
        |---- AGEOME                                                               
                   |----  AGCHCK                                                   
                   |----  GMATE                               External             
                   |----  GSMATE                              External             
                   |----  GSMIXT                              External             
                   |----  AGEMAT                                                   
                   |----  GSTMED                                                   
                   |----  GSROTM                              External             
                   |----  GSVOLU                              External             
                   |----  IGEOJO                              External             
                   |----  GSPOS                               External             
                   |----  AGBEAM                                                   
                   |----  AGVDET                                                   
                   |----  AGITCH                                                   
                   |----  AGTPCH                                                   
                   |----  AGECAL                                                   
                   |----  AGLCAL                                                   
                   |----  AGSATR                                                   
                   |----  AGSCAL                                                   
                   |----  AGCOIL                                                   
                   |----  AGQUAD                                                   
                   |----  AGHCAL                                                   
                   |----  AGMUCH                                                   
                   |----  AGSATT                                                   
                   |----  GGCLOS                              External             
                   |----  BDROP                               External             
                   |----  ALBOS                               External             
                   |----  BLIST                               External             
   
 
3 AGGEAN
         SUBROUTINE AGGEAN (DET,ISTUP)
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Implement detector  geometry
   - F.Ranjard - 901212
   - Input :   - DET     / CHA*2  : detector initials
   - Output:   - ISTUP   / I      : setup code
     -Called by AGEOME                  from this .HLB
     -Calls GSTMED,GSVOLU,GSPOS,GSROTM  from  GEANT3
   
    -Stores extra Tracking Media needed
    -Builds geometry levels below  'CDET'levels for the VDET parts
    -Initialises some search optimisation
   
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   AGBEAM                                                                          
   AGITCH                                                                          
   AGSCAL                                                                          
   AGSMBA                                                                          
   AGVDET                                                                          
        |---- AGGEAN                                                               
                   |----  GTSTUP                              External             
                   |----  ALTELL                              External             
                   |----  LENOCC                              External             
                   |----  LEN                                 External             
                   |----  ALGTDB                              External             
                   |----  NAMIND                              External             
                   |----  NLINK                               External             
                   |----  TGEOJO                              External             
                   |----  ALSTIN                              External             
                   |----  GSMATE                              External             
                   |----  GFMATE                              External             
                   |----  ALSTHO                              External             
                   |----  LNBLNK                              External             
                   |----  INDEX                               External             
                   |----  MIN                                 External             
                   |----  CHAINT                              External             
                   |----  AGMIX                                                    
                   |----  GSMIXT                              External             
                   |----  IDETJO                              External             
                   |----  GSTMED                                                   
                   |----  GSTPAR                              External             
                   |----  GSVOLU                              External             
                   |----  GSROTM                              External             
                   |----  GSPOS                               External             
                   |----  GSATT                               External             
                   |----  PRTABL                              External             
   
 
3 AGHCAL
         SUBROUTINE AGHCAL
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Implement   hadron calorimeter geometry
     Author :        B. Bloch-Devaux                    18 march 85
                     modified for Data Base access     September 87
                      suppress HCDETAIL / HCAVERAG     October 88
          Modified by L.Silvestris   5/9/90  (mixture gas changed)
          Modified by B.Bloch       15/5/91  for improved geometry
          Modified L.Silvestris     10/10/91 for geant3.14
          Modified F.Ranjard        10/10/91 get new cuts from data base
                                             depending on GEANT version
   - modified by : L.Silvestris - 900905
                   F.Ranjard    - 911002
                   change COIL component # to 13 instead of 9
          Modify by L.Silvestris   5/9/90  (mixture gas changed)
          Modify by B.Bloch       15/5/91  for improved geometry
          Modify by L.Silvestris  16/5/93 (improved materials)
     -Called by AGEOME                  from this .HLB
     -Calls GSMATE,GSTMED,GSVOLU,GSPOS,GSROTM from  GEANT3
   
    -Stores extra material  required
    -Stores extra Tracking Media needed
    -Builds geometry levels below 'HCBL' level for Barrel part
    -Builds geometry levels below 'HCEA' and 'HCEB' for end-cap part
   
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   AGEOME                                                                          
        |---- AGHCAL                                                               
                   |----  NAMIND                              External             
                   |----  GSMIXT                              External             
                   |----  GSMATE                              External             
                   |----  AGMIX                                                    
                   |----  HCTIRF                              External             
                   |----  IDETJO                              External             
                   |----  GSTMED                                                   
                   |----  GSTPAR                              External             
                   |----  COS                                 External             
                   |----  TAN                                 External             
                   |----  HCZMAX                              External             
                   |----  HCRMAX                              External             
                   |----  HCRMIN                              External             
                   |----  GSVOLU                              External             
                   |----  GSPOS                               External             
                   |----  GSDVN2                              External             
                   |----  GSROTM                              External             
                   |----  HCWINO                              External             
                   |----  HCLTNO                              External             
                   |----  GSPOSP                              External             
                   |----  HCLARA                              External             
                   |----  HCLAWI                              External             
                   |----  JHOCHA                              External             
                   |----  HCZMIN                              External             
                   |----  GSDVN                               External             
   
 
3 AGITCH
         SUBROUTINE AGITCH
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Build itc chamber and related cables and supports geometry
      Modified : B.Bloch-Devaux May 1993 rewritten to get ITC GEANT
                 Geometry from Data BAse banks
     -Called by AGEOME                        from this .HLB
     -Calls AGGEAN,AGDIMP,ALTELL              from this .HLB
    -Builds geometry levels below 'CDET' level for ITC  part
    -Initialises some search optimisation
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   AGEOME                                                                          
        |---- AGITCH                                                               
                   |----  AGGEAN                                                   
                   |----  JHOCHA                              External             
                   |----  AGDIMP                                                   
                   |----  ALTELL                              External             
   
 
3 AGLCAL
         SUBROUTINE AGLCAL
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Implement luminosity calorimeter geometry
   
     Author : B. Bloch-Devaux                   4 April 1985
     Modified : P. H. Hansen  (Data Base use)    29 Novem 1987
       Modified:   H. Meinhard       26-Jul-1990  (2)
          for the implementation of SATR dowels
     Modified : B.Bloch-Devaux 28 January,1991  for
          -inox screws in front plate
          -lead cutoff from inner part of stacks
     Modified : B.Bloch-Devaux 15 October,1991  for
          -implement SATR passive parts only if SATR there
          -take alignment into account to take care of new 92 positions
     Modified : B.Bloch-Devaux 10 May,1996  for
          -2mm of Lead at inner circumference from October 95 onwards
     Modified : B.Bloch-Devaux 5 March,1997  for
          - add lead absorber and scintillator behind LCAL cracks
     Modified : B.Bloch-Devaux 5 January,1998  for
          - absorber before scintillator is tungsten from 1998 onwards
     -Called by AGEOME                  from this .HLB
     -Calls GSMIXT,GSTMED,GSVOLU,GSPOS,GSPOSP      from  GEANT3
     -Calls AGMIX,AGDIMP                           from this HLB
     -Calls ALTELL                                 from ALEPHLIB
   
    -Stores extra material needed
    -Stores extra Tracking Media needed
    -Builds geometry levels below 'ECEA'('ECEB') level for LCAL part
   
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   AGEOME                                                                          
        |---- AGLCAL                                                               
                   |----  GSMIXT                              External             
                   |----  AGMIX                                                    
                   |----  ALTELL                              External             
                   |----  IGEOJO                              External             
                   |----  NAMIND                              External             
                   |----  IDETJO                              External             
                   |----  GSTMED                                                   
                   |----  MAX                                 External             
                   |----  ABS                                 External             
                   |----  GSVOLU                              External             
                   |----  GSPOS                               External             
                   |----  GSMATE                              External             
                   |----  JHOCHA                              External             
                   |----  COS                                 External             
                   |----  SIN                                 External             
                   |----  GSPOSP                              External             
                   |----  GSROTM                              External             
                   |----  AGDIMP                                                   
   
 
3 AGMATE
         INTEGER FUNCTION AGMATE (NAME)
  ------------------------------------------------------------------------------
    CKEY GEOM MATERIAL
  ------------------------------------------------------------------------------
   - F.Ranjard - 910121
   Returns the geant material # known by its name
   - Input :   - NAME   / CHA16     = material name
                                      if ' ' get all names in ALLNAM
   - Output :  - AGMATE / I         = Geant tracking medium #
                                     = IAGMAT if NAME is ' '
                                     = 0  if NAME does not exist
                                     = -IAGMAT if ALLNAM too short
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
              AGMATE                                                               
                   |----  ALTELL                              External             
                   |----  GFMATE                              External             
                   |----  ALSTHO                              External             
                   |----  LENOCC                              External             
                   |----  INDEX                               External             
                   |----  MIN                                 External             
   
 
3 AGMEDI
         INTEGER FUNCTION AGMEDI (NAME)
  ------------------------------------------------------------------------------
    CKEY GEOM
  ------------------------------------------------------------------------------
   - W.Manner  - 901203
   Returns the geant tracking medium # known by its name
   - Input :   - NAME   / CHA16     = tracking medium name
                                      if ' ' get all names in ALLNAM
   - Output :  - AGMEDI / I         = Geant tracking medium #
                                     = IAGMED if NAME is ' '
                                     = 0  if NAME does not exist
                                     = -IAGMED if ALLNAM too short
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   AGQUAD                                                                          
        |---- AGMEDI                                                               
                   |----  ALTELL                              External             
                   |----  GFTMED                              External             
                   |----  ALSTHO                              External             
                   |----  LNBLNK                              External             
                   |----  INDEX                               External             
                   |----  MIN                                 External             
                   |----  LENOCC                              External             
   
 
3 AGMIX
         SUBROUTINE AGMIX(N,NLIS,EPS,A,Z,W,D)
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Fills density from thickness of components
    and prepare weigth , atomic weight and atomic number
    for subsequent use in GSMIXT
     Input arguments
     N     number of components
     NLIS  array containing the material numbers
     EPS   array of thicknesses
     Output arguments
     A     array of atomic weights
     Z     array of atomic numbers
     W     array of relative weights
     D     density of the compound
     units are cm,g/cm**3
     B. Bloch-Devaux    april 30 1987
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   AGEMAT                                                                          
   AGGEAN                                                                          
   AGHCAL                                                                          
   AGLCAL                                                                          
   AGSATR                                                                          
        |---- AGMIX                                                                
                   |----  GFMATE                              External             
   
 
3 AGMUCH
         SUBROUTINE AGMUCH
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Implement muon chambers geometry
    Author :   B. Bloch-Devaux       4 October 85
             - Taijie Wang  last  revised 30 November 86
             - modified for DAF and new bank layout
               by F.Bossi,D.Kuhn,R.Xu 87-09-14
              - adapted to GAL196 by B. Bloch 25-01-88
             - modified for final dbase
               by A. Antonelli, F. Bossi 1 July 89
     -Called by AGEOME                  from this .HLB
     -Calls GSTMED,GSVOLU,GSPOS,GSPOSP,
            GSROTM                      from  GEANT3
   
    -Stores extra Tracking Media needed
    -Builds geometry levels below 'MUON' level
   
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   AGEOME                                                                          
        |---- AGMUCH                                                               
                   |----  IDETJO                              External             
                   |----  ICMUJO                              External             
                   |----  GSTMED                                                   
                   |----  GSMATE                              External             
                   |----  JHOCHA                              External             
                   |----  GSVOLU                              External             
                   |----  GSROTM                              External             
                   |----  GSPOS                               External             
                   |----  COS                                 External             
                   |----  SIN                                 External             
                   |----  GSPOSP                              External             
                   |----  MAX                                 External             
                   |----  MIN                                 External             
                   |----  AGDIMP                                                   
                   |----  ALTELL                              External             
   
 
3 AGQUAD
         SUBROUTINE AGQUAD
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Implement forward and backward quadrupoles geometry
    Author :      B. Bloch-Devaux                     18 March 85
                  Modified for Data base access      Septmeber 87
       called from AGEOME                            from this .HLB
       calls       GSMATE,GSTMED,GSVOLU,GSPOS           from GEANT3
   
    -Stores extra material needed
    -Stores extra Tracking Media needed
    -Builds geometry levels below 'QUEA' and 'QUEB' levels
   
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   AGEOME                                                                          
        |---- AGQUAD                                                               
                   |----  GHSIGM                              External             
                   |----  GSMATE                              External             
                   |----  NAMIND                              External             
                   |----  GSTMED                                                   
                   |----  GSVOLU                              External             
                   |----  AGMEDI                                                   
                   |----  GSPOS                               External             
                   |----  GSPOSP                              External             
   
 
3 AGSATR
         SUBROUTINE AGSATR
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Implement small angle track detector geometry
       Author :                    H.Burkhardt   October 1986
                                modified for Data Base use october 87
                                modified for more passive materials
                                and better implementation (B.Bloch,09/89)
       Modified: H. Meinhard July 1990 to handle both sides separately
       (needed to describe the dowels correctly). SATR alignment is now
       read from bank LALI.
       Modified by B.Bloch-Devaux October 15, 1991 to handle SATR/SAMBA
        called by AGEOME                      from this .HLB
    -Calls GSTMED,GSVOLU,GSPOS,GSPOSP,GSROTM  from  GEANT3
            AGDIMP                                 this .HLB
   
   -Stores extra Tracking Media needed
   -Builds geometry levels below 'ECEA' ('ECEB') level for SATR
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   AGEOME                                                                          
        |---- AGSATR                                                               
                   |----  GTSTUP                              External             
                   |----  AGSMBA                                                   
                   |----  NAMIND                              External             
                   |----  AGMIX                                                    
                   |----  GSMIXT                              External             
                   |----  IDETJO                              External             
                   |----  SQRT                                External             
                   |----  GSTMED                                                   
                   |----  MAX                                 External             
                   |----  FLOAT                               External             
                   |----  GSVOLU                              External             
                   |----  ABS                                 External             
                   |----  GSPOS                               External             
                   |----  GSROTM                              External             
                   |----  MIN                                 External             
                   |----  COS                                 External             
                   |----  SIN                                 External             
                   |----  PHIBSA                              External             
                   |----  TAN                                 External             
                   |----  GSPOSP                              External             
                   |----  JHOCHA                              External             
                   |----  AGDIMP                                                   
                   |----  ALTELL                              External             
   
 
3 AGSATT
         SUBROUTINE AGSATT
  ------------------------------------------------------------------------------
    CKEY GEOM DRAW
  ------------------------------------------------------------------------------
    B. BLOCH-DEVAUX - 850910
   Set geant drawing attributes
    by  AGEOME
    GSATT                 from GEANT3
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   AGEOME                                                                          
        |---- AGSATT                                                               
                   |----  MIN                                 External             
                   |----  GSATT                               External             
                   |----  IGEOJO                              External             
   
 
3 AGSCAL
         SUBROUTINE AGSCAL
  ------------------------------------------------------------------------------
    CKEY SCAL GEOM
  ------------------------------------------------------------------------------
   - B.Bloch-Devaux and J.P.Schuller 910930
   Build scal geometry
   - called by AGEOME
   - calls     AGGEAN,AGSI92,AGDIMP              from this Lib
   - calls     ALTELL                            from ALEPHLib
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   AGEOME                                                                          
        |---- AGSCAL                                                               
                   |----  AGGEAN                                                   
                   |----  ALTELL                              External             
                   |----  JHOCHA                              External             
                   |----  AGSI92                                                   
                   |----  AGDIMP                                                   
   
 
3 AGSI92
         SUBROUTINE AGSI92
  ------------------------------------------------------------------------------
    CKEY SCAL GEOM
  ------------------------------------------------------------------------------
   - B.Bloch-Devaux                  910930
   Build scal geometry for crystals and ceramics
   - called by AGSCAL
   - calls     GSROTM,GSPOS                      from GEANTLib
   - calls     ALTELL                            from ALEPHLib
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   AGSCAL                                                                          
        |---- AGSI92                                                               
                   |----  MOD                                 External             
                   |----  GSPOS                               External             
                   |----  SIN                                 External             
                   |----  COS                                 External             
                   |----  GSROTM                              External             
   
 
3 AGSMBA
         SUBROUTINE AGSMBA
  ------------------------------------------------------------------------------
    CKEY SAMBA GEOM
  ------------------------------------------------------------------------------
   - B.Bloch-Devaux                  911210
   Build samba geometry for materials in geant
   - called by AGSATR
   - calls     AGGEAN                            from this Lib
   - calls     ALTELL                            from ALEPHLib
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   AGSATR                                                                          
        |---- AGSMBA                                                               
                   |----  AGGEAN                                                   
                   |----  ALTELL                              External             
   
 
3 AGTPCH
         SUBROUTINE AGTPCH
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Implement tpc geometry
     Author :B. Bloch-Devaux                       18 March 85
                 M.E.Mermikides                    25/11/85
                       add  Detailed endplate geometry
                  B. Bloch and M. Mermikides        sept. 87
                       Data base connection
                  B.Bloch update materials for central membrane,supports
                  gas mix and inner cage.              april 1991
                  S. Wasserbaech: add TPC resistor chain and laser
                  optics; augment the reinforcing ring on the
                  inner field cage.                December 1997
   
     -Called by AGEOME                  from this .HLB
     -Calls GSTMED,GSVOLU,GSPOS  from  GEANT3
   
    -Stores extra Tracking Media needed
    -Builds geometry levels from  'TPCR'  and downwards
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   AGEOME                                                                          
        |---- AGTPCH                                                               
                   |----  GSMATE                              External             
                   |----  GSTMED                                                   
                   |----  IDETJO                              External             
                   |----  GSVOLU                              External             
                   |----  GSPOS                               External             
                   |----  JHOCHA                              External             
                   |----  NAMIND                              External             
                   |----  GSPOSP                              External             
                   |----  GSMIXT                              External             
                   |----  AGDIMP                                                   
                   |----  ALTELL                              External             
   
 
3 AGVDET
         SUBROUTINE AGVDET
  ------------------------------------------------------------------------------
    CKEY VDET GEOM
  ------------------------------------------------------------------------------
   Build vdet geometry
   - W.Manner - 901100
   - Modified : A. Bonissent 940215 : use geom. package
    VDET91-95 is the same object built with AGVF92
    a new description of the wafers was introduced in 94.
    new VDET was introduced in 9510, it is built with AGVF95
   - Modified : FLR 961113 - new description of the faces
    to avoid VFAC volumes which were overlapping each other.
    it is built with AGVF96 and ADBSCONS no. > 218
   - Modified: S. Wasserbaech 971216 - use the same
    description for 1991-1995
   - called by AGEOME
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   AGEOME                                                                          
        |---- AGVDET                                                               
                   |----  AGGEAN                                                   
                   |----  ALTELL                              External             
                   |----  AGVF92                                                   
                   |----  JHOCHA                              External             
                   |----  AGVF96                                                   
                   |----  AGVF95                                                   
                   |----  AGDIMP                                                   
   
 
3 AGVF92
         SUBROUTINE AGVF92
  ------------------------------------------------------------------------------
    CKEY VDET GEOM FACE
  ------------------------------------------------------------------------------
   Defines and positions vdet 92 faces in geant
   - W.Manner - 921103
   - Modified : A. Bonissent 940215 : use geom. package
   - Modified : F.Ranjard 950419 : restore AGFV92
     -Called by AGVDET                 from this .HLB
     -Calls GSROTM,GSPOS               from  GEANT3
   
    - positions volumes VDBX and VDB2
   
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   AGVDET                                                                          
        |---- AGVF92                                                               
                   |----  NAMIND                              External             
                   |----  ALTELL                              External             
                   |----  CHAINT                              External             
                   |----  VNTFAC                              External             
                   |----  VPHIFC                              External             
                   |----  GSROTM                              External             
                   |----  VXYZFC                              External             
                   |----  COS                                 External             
                   |----  SIN                                 External             
                   |----  GSPOS                               External             
   
 
3 AGVF95
         SUBROUTINE AGVF95
  ------------------------------------------------------------------------------
    CKEY VDET GEOM FACE
  ------------------------------------------------------------------------------
   Defines and positions vdet 95 faces in geant
   - Author : F.Ranjard 950419 from W.Manner and A.Bonissent
     -Called by AGVDET                 from this .HLB
     -Calls GSROTM,GSPOS               from  GEANT3
   
    - positions volumes VFAO and VFAS in VDET
      VFAC is a box which contains : wafers, omega beam,
      and the electronic on the omega side.
      VFPB is an adjacent box which contains the protection bonding
      on the silicon side.
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   AGVDET                                                                          
        |---- AGVF95                                                               
                   |----  NAMIND                              External             
                   |----  ALTELL                              External             
                   |----  CHAINT                              External             
                   |----  VNTFAC                              External             
                   |----  VPHIFC                              External             
                   |----  GSROTM                              External             
                   |----  VXYZFC                              External             
                   |----  COS                                 External             
                   |----  SIN                                 External             
                   |----  GSPOS                               External             
   
 
3 AGVF96
         SUBROUTINE AGVF96
  ------------------------------------------------------------------------------
    CKEY VDET GEOM FACE
  ------------------------------------------------------------------------------
   Defines and positions vdet 96 faces described in
     ADBSCONS no.> 218 in GEANT.
   - Author : F.Ranjard 961113 from AGVF95
   - Called by AGVDET                 from this .HLB
   - Calls GSROTM,GSPOS               from  GEANT3
   - description:
     Positions volumes VFSI and VFPB in VDET
     VFSI is a box which contains : wafers, omega beam,
     and the electronic on the omega side.
     VFPB is an adjacent box which contains the protection bonding
     on the silicon side.
     Positions VOUP, VOKE, VOPI, VMEO in VDET
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   AGVDET                                                                          
        |---- AGVF96                                                               
                   |----  NAMIND                              External             
                   |----  ALTELL                              External             
                   |----  CHAINT                              External             
                   |----  VNTFAC                              External             
                   |----  VPHIFC                              External             
                   |----  GSROTM                              External             
                   |----  VXYZFC                              External             
                   |----  COS                                 External             
                   |----  SIN                                 External             
                   |----  GSPOS                               External             
   

2 GUSE

  >>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>
    CKEY 
     1st entry in GEANT user set
     ! GALEPH 25.5
        GUINTI : call AGGATT for the ITC banks (B. Bloch May 1993 )
    
  <<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<
     GDRAY 
     GETRAN     Copy of glvolu modified to get translation vector of hbla
     GNTUBE 
     GPGHEI 
     GRNDM      Geant user routine to get random numbers
     GSTMED     Store tracking media parameters
     GUFLD      Return field components for position xyz
     GUHADR 
     GUPHAD 
     GUSEAR 
     GUSTEP 
     GUTRAK     Follow one particle through the apparatus using geant3

3 GDRAY
         SUBROUTINE GDRAY
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   
       *****************************************************************
       *
       *  Generates Delta rays
       *
       *    ==>Called by : GTELEC,GTHADR,GTMUON
       *       Authors    D.Ward, L.Urban  ********
       *                  G. Taylor 1/8/95
       *                  This GEANT routine has been modified so that
       *                  the effective threshold energy for delta ray
       *                  production in the VDET area has been modified
       *                  by a FACTOR. This results in an effective
       *                  increase in the cross-section by the same
       *                  FACTOR.
       *
       *
       *
       *
       *****************************************************************
   
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
              GDRAY                                                                
                   |----  SQRT                                External             
                   |----  ABS                                 External             
                   |----  NAMEC                               External             
                   |----  GRNDM                                                    
                   |----  COS                                 External             
                   |----  SIN                                 External             
                   |----  GFANG                               External             
                   |----  GDROT                               External             
                   |----  GEKBIN                              External             
                   |----  LOG                                 External             
   
 
3 GETRAN
         SUBROUTINE GETRAN (TRAN)
  ------------------------------------------------------------------------------
    CKEY GUSER HCAL / INTERNAL
  ------------------------------------------------------------------------------
   - F.Ranjard - 910522      from GEANT/GLVOLU
   Copy of glvolu modified to get translation vector of hbla
                            when the hit is in HBL1 or HBL2
   - Output : TRAN (3)  / R     = translation vector of HBLA
   - Description:
           Loads the common block GMYVOL for the volume at level NLEV
           as described by the lists of names (LNAM) and numbers (LNUM)
   
           The routine is optimized and does not re-compute the part of
           history already available in GMYVOL.
   
           Called by : 'User', GDRVOL
           Authors   : S.Banerjee, F.Bruyant, A.McPherson
   
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   HCCOIN                                                                          
        |---- GETRAN                                                               
                   |----  JHOCHA                              External             
                   |----  UCOPY                               External             
                   |----  MZBOOK                              External             
                   |----  MIN                                 External             
                   |----  GMAIL                               External             
                   |----  UHTOC                               External             
                   |----  GLMOTH                              External             
                   |----  IFIX                                External             
                   |----  GTRMUL                              External             
                   |----  C                                   External             
                   |----  GCENT                               External             
                   |----  RMAT                                External             
                   |----  COS                                 External             
                   |----  SIN                                 External             
   
 
3 GNTUBE
   
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
    $Id: gntube.F,v 1.1 1999/05/11 14:38:57 flr Exp $
   
    $Log: gntube.F,v $
    Revision 1.1  1999/05/11 14:38:57  flr
     gal308.1 add gntube with a protection, use chaint in gpghei to please Linux compiler
   
    Revision 1.1.1.1  1995/10/24 10:20:54  cernlib
    Geant
   
   
   
   
   
   
   
    :  3.21/02 29/03/94  15.41.30  by  S.Giani
   -- Author :
         SUBROUTINE GNTUBE(X,P,IACT,IFL,SNEXT,SNXT,SAFE)
       *****************************************************************
       *
       *      Compute distance to intersection with boundary surface of
       *      volume TUBE or TUBS, from point X(1),X(2),X(3)  INSIDE
       *      the volume along track with direction cosines X(4),X(5),
       *      X(6)
       *      P     (input)  : volume parameters
       *      IACT  (input)  : action flag
       *         = 0  Compute SAFE only
       *         = 1  Compute SAFE, compute SNXT only if SAFE.LT.SNEXT
       *         = 2  Compute both SAFE and SNXT
       *         = 3  Compute SNXT only
       *      IFL   (input)  : 1 for TUBE, 2 for PHI segmented TUBE
       *      SNEXT (input)  : see IACT = 1
       *      SNXT  (output) : distance to volume boundary along track
       *      SAFE  (output) : not larger than scalar distance to
       *                       volume boundaray
       *      Called by : GNEXT, GNPCON, GTNEXT
       *
       *      Authors   : Michel Maire and Rolf Nierhaus    21-JUN-1990
       *
       *****************************************************************
       *
       * 'TUBE'    is a tube. It has 3 parameters, the inside radius,
       *           the outside radius and the half length in z.
       * 'TUBS'    is a phi segment of a  tube.  It has 5 parameters,
       *           the same  3 as  'TUBE' plus  the phi  limits.  The
       *           segment  starts at  the first  limit and  includes
       *           increasing phi  value up  to the  second limit  or
       *           that plus 360 degrees.
       *
       *****************************************************************
   
    $Id: gntube.F,v 1.1 1999/05/11 14:38:57 flr Exp $
   
    $Log: gntube.F,v $
    Revision 1.1  1999/05/11 14:38:57  flr
     gal308.1 add gntube with a protection, use chaint in gpghei to please Linux compiler
   
    Revision 1.1.1.1  1995/10/24 10:20:32  cernlib
    Geant
   
   
   
   
    gconsp.inc
   
         DOUBLE PRECISION PI,TWOPI,PIBY2,DEGRAD,RADDEG,CLIGHT,BIG,EMASS
         DOUBLE PRECISION EMMU,PMASS,AVO
   
         PARAMETER (PI=3.14159265358979324D0)
         PARAMETER (TWOPI=6.28318530717958648D0)
         PARAMETER (PIBY2=1.57079632679489662D0)
         PARAMETER (DEGRAD=0.0174532925199432958D0)
         PARAMETER (RADDEG=57.2957795130823209D0)
         PARAMETER (CLIGHT=29979245800.D0)
         PARAMETER (BIG=10000000000.D0)
         PARAMETER (EMASS=0.0005109990615D0)
         PARAMETER (EMMU=0.105658387D0)
         PARAMETER (PMASS=0.9382723128D0)
         PARAMETER (AVO=0.60221367D0)
   
   
    gconsp.inc
   
   
         DIMENSION X(6),P(5)
   
        this part has to be moved outside the routine
         IF (IFL.EQ.2) THEN
            P4=P(4)*DEGRAD
            P5=P(5)*DEGRAD
            IF (P5.LT.P4) P5=P5+TWOPI
            C1=COS(P4)
            S1=SIN(P4)
            C2=COS(P5)
            S2=SIN(P5)
            FIO=0.5*(P5+P4)
            CFIO=COS(FIO)
            SFIO=SIN(FIO)
         END IF
   
         SNXT=1.E10
         R=SQRT(X(1)**2+X(2)**2)
   
        Compute SAFE radius
         IF (IACT.LT.3) THEN
            SAF1=R-P(1)
            SAF2=P(2)-R
            SAF3=P(3)-ABS(X(3))
            SAF4=1.E10
            IF (IFL.EQ.2) THEN
               IF ((X(2)*CFIO-X(1)*SFIO).LE.0.) THEN
                  SAF4=ABS(X(1)*S1-X(2)*C1)
               ELSE
                  SAF4=ABS(X(1)*S2-X(2)*C2)
               END IF
            ENDIF
            SAFE=MIN(SAF1,SAF2,SAF3,SAF4)
            IF (IACT.EQ.0) GO TO 999
            IF (IACT.EQ.1.AND.SNEXT.LE.SAFE) GO TO 999
         END IF
   
        Intersection with z-plane
         IF (X(6).GT.1.E-20) THEN
            SZ= (P(3)-X(3))/X(6)
         ELSEIF (X(6).LT.-1.E-20) THEN
            SZ=-(P(3)+X(3))/X(6)
         ELSE
            SZ=1.E10
         END IF
   
        Intersection with cylinders
        Intersection point (x,y,z)
        (x,y,z) is on track :    x=X(1)+t*X(4)
                                 y=X(2)+t*X(5)
                                 z=X(3)+t*X(6)
        (x,y,z) is on cylinder : x**2 + y**2 = R**2
   
        (X(4)**2+X(5)**2)*t**2
        +2.*(X(1)*X(4)+X(2)*X(5))*t
        +X(1)**2+X(2)**2-R**2=0
   
         T1=X(4)**2+X(5)**2
         T2=(X(1)*X(4)+X(2)*X(5))
         T3=X(1)**2+X(2)**2
         IF (T1.LE.1.E-20) THEN
           track parallel to the z-axis
            SNXT=SZ
            GO TO 999
         ENDIF
         B=T2/T1
   
        Intersection with inner cylinder
         IF (P(1).GT.0.) THEN
            C=(T3-P(1)**2)/T1
            D=B**2-C
            IF (D.GE.0.) THEN
               SR=-B-SQRT(D)
               IF (SR.GE.0.) GO TO 101
            END IF
         END IF
        Intersection with outer cylinder
            C=(T3-P(2)**2)/T1
            D=MAX(B**2-C,0.)
            SR=-B+SQRT(D)
   
        Intersection with phi-planes
        x=r*cos(phi)=X(1)+t*X(4)
        y=r*sin(phi)=X(2)+t*X(5)
        z           =X(3)+t*X(6)
        t=(X(2)*cos(phi)-X(1)*sin(phi))/(X(4)*sin(phi)-X(5)*cos(phi))
     101 SFI1=1.E10
         SFI2=1.E10
         IF (IFL.EQ.2) THEN
           track not parallel to the phi1 plane ?
            UN=X(4)*S1-X(5)*C1
            IF (UN.NE.0.) THEN
               S=(X(2)*C1-X(1)*S1)/UN
               IF (S.GE.0.) THEN
                  XI=X(1)+S*X(4)
                  YI=X(2)+S*X(5)
                  IF ((YI*CFIO-XI*SFIO).LE.0.) SFI1=S
               END IF
            END IF
           track not parallel to the phi2 plane ?
            UN=X(4)*S2-X(5)*C2
            IF (UN.NE.0.) THEN
               S=(X(2)*C2-X(1)*S2)/UN
               IF (S.GE.0.) THEN
                  XI=X(1)+S*X(4)
                  YI=X(2)+S*X(5)
                  IF ((YI*CFIO-XI*SFIO).GE.0.) SFI2=S
               END IF
            END IF
         END IF
   
         SNXT=MIN(SZ,SR,SFI1,SFI2)
     999 END
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
              GNTUBE                                                               
                   |----  COS                                 External             
                   |----  SIN                                 External             
                   |----  SQRT                                External             
                   |----  ABS                                 External             
                   |----  MIN                                 External             
                   |----  MAX                                 External             
   
 
3 GPGHEI
         SUBROUTINE GPGHEI
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
    COMPUTE DISTANCE TO NEXT HADRONIC INTERACTION POINT **
    THIS ROUTINE IS AN INTERFACE TO GHEISHA8 **
    NVE 06-APR-1988 CERN GENEVA **
   ALLED BY : GUPHAD (USER ROUTINE)
    : F.CARMINATI
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   GUPHAD                                                                          
        |---- GPGHEI                                                               
                   |----  GHEINI                              External             
                   |----  IFINIT                              External             
                   |----  ABS                                 External             
                   |----  CHAINT                              External             
                   |----  GHESIG                              External             
   
 
3 GRNDM
         SUBROUTINE GRNDM(RNDMV,LRNDV)
  ------------------------------------------------------------------------------
    CKEY GUSER RNDM RANECU / INTERNAL
  ------------------------------------------------------------------------------
   - Author : F.RANJARD - 890608
   Geant user routine to get random numbers
    as a server of 100 numbers from one RANECU call
   - Structure : subprogram
                 User Entry Name :GRNDM
                 External references :RANECU
                 Comdecks references : ARNDMC
   - Input  : LRNDV  = number of output random numbers
   - Output : RNDMV  = vector of random numbers in the range [0.,1.]
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   GDRAY                                                                           
        |---- GRNDM                                                                
                   |----  REAL                                External             
   
 
3 GSTMED
         SUBROUTINE GSTMED(KTMED,NATMED,NMAT,ISVOL,IFIELD,FIELDM,TMAXFD,
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
        +        DMAXMS,DEEMAX,EPSIL,STMIN,UBUF,NWBUF)
   - F.Ranjard - 911213      from GSTMED / GEANT314
    put DMAXMS to a big value in case of GEANT version > or = 3.15
   
   Store tracking media parameters
   
       Stores the  parameters of the tracking  medium ITMED in  the data
     structure JTMED.
     ITMED     tracking medium number 0<ITMED<100
     NATMED    tracking medium name (up to 20 characters ended by $)
     NMAT      material number corresponding to ITMED
     ISVOL     =0 if not a sensitive volume
     IFIELD    = 0  if no magnetic field
               = -1  reserved for user decision in GUSWIM
               = 1  tracking performed with GRKUTA
               = 2  tracking performed with GHELIX
               = 3  tracking performed with GHELX3
     FIELDM    maximum field value (in Kilogauss)
     TMAXFD    maximum  angle due  to field  permitted in  one step  (in
               degrees)
     DMAXMS    maximum displacement for multiple  scattering in one step
               (in cm)
     DEEMAX    maximum fractional energy loss in one step
     EPSIL     tracking precision (in cm)
     STMIN     minimum step  due to energy  loss or  multiple scattering
               (in cm)
     UBUF      array of NWBUF additional parameters
     NWBUF
   
   
             The Tracking Medium data structure JTMED
   
                                            | JTMED
       NTMED           ITMED                v
        ..........................................................
        |               | |                | | Standard Trac.media
        ..........................................................
                         | JT
                         v
                       ..........................
                       | 1 |                    |
                       .....                    |
                       | 2 |  Tracking medium   |
                       |...|                    |
                       | 3 |   Name             |
                       |...|                    |
                       | 4 |                    |
                       |...|                    |
                       | 5 |                    |
                       ..........................
                       | 6 |   NMAT             |
                       |...|....................|
                       | 7 |   ISVOL            |
                       |...|....................|
                       | 8 |   IFIELD           |
                       |...|....................|
                       | 9 |   FIELDM           |
                       |...|....................|
                       | 10|   TMAXFD           |
                       |...|....................|
                       | 11|   DMAXMS           |
                       |...|....................|
                       | 12|   DEEMAX           |
                       |...|....................|
                       | 13|   EPSIL            |
                       |...|....................|
                       | 14|   STMIN            |
                       |...|....................|
                       | 15|   User words ....  |
                       ..........................
      JT = LQ(JTMED-ITMED) pointer to tracking medium ITMED
   
       ==>Called by : <USER>, UGEOM    ,<GXINT> GINC3
          Author    R.Brun  *********
   
   
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   AGCOIL                                                                          
   AGECAL                                                                          
   AGECPM                                                                          
   AGEOME                                                                          
   AGGEAN                                                                          
   AGHCAL                                                                          
   AGLCAL                                                                          
   AGMUCH                                                                          
   AGQUAD                                                                          
   AGSATR                                                                          
   AGTPCH                                                                          
        |---- GSTMED                                                               
                   |----  ABS                                 External             
                   |----  MZBOOK                              External             
                   |----  UCOPY                               External             
                   |----  MZPUSH                              External             
                   |----  GMAIL                               External             
                   |----  GPTMED                              External             
                   |----  MZDROP                              External             
                   |----  LENOCC                              External             
                   |----  UCTOH                               External             
   
 
3 GUFLD
         SUBROUTINE GUFLD(POS,B)
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Return field components for position xyz
      B. Bloch-Devaux                 30 april 1987
     this routine is the interface between Geant tracking and
     the field map in case one has to use such a map
         modified may 1988 to introduce better parametrisation
    units are cm for POS and KGauss for Field components  B
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
              GUFLD                                                                
                   |----  SQRT                                External             
                   |----  ABS                                 External             
                   |----  MAX                                 External             
                   |----  SIGN                                External             
   
 
3 GUHADR
         SUBROUTINE GUHADR
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
    - F.Ranjard - 850430
    - GEANT3 user routine called when a hadronic process has been
      selected in the current step.
    - Called from    GTHADR                              from GEANT3 pam
    - Calls          GHEISH                              from GEANT3 pam
   
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
              GUHADR                                                               
                   |----  GHEISH                              External             
   
 
3 GUPHAD
         SUBROUTINE GUPHAD
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
    - F.Ranjard - 850430
    - GEANT3 user routine called at each step to evaluate the next
      hadronic interaction point.
    - Called from
    - Calls          GPGEI  (Gheisha)                  from GEANT3 pam
   
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
              GUPHAD                                                               
                   |----  GPGHEI                                                   
   
 
3 GUSEAR
         SUBROUTINE GUSEAR
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
    - F.Ranjard - 850515
    - dummy routines
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
              GUSEAR                                                               
                   |----  ALTELL                              External             
   
 
3 GUSTEP
         SUBROUTINE GUSTEP
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
    - F.Ranjard - 850418
    - GEANT3 user routine called at the end of every step in GTVOL
      and also when entering a new volume in GTRACK.
      At this level a track element is avalaible in the GEANT common
      block /GCTRAK/, /GCTMED/, /GCKINE/. Secondaries are
      stored in /GCKING/.
      If the track element is in a selected sensitive volume
      (IGSVOL>0 and SETS data card) the common /TRKCOM/ is
      filled in and control is transferred  to the corresponding
      module xxHIT.
      The current material parameters are stored in /GCMATE/
      Then in case of production of secondaries during the last tracking
      step , control is transferred to ASKTRK to store the secondaries
      either in the standard KINEmatics banks or in a temporary STACK.
    - Called from    GTVOL, GTRACK                        from GEANT3 pam
    - Calls          GSXYZ, GPCXYZ                        from GEANT3 pam
                     VDHIT, ITHIT, TPHIT, ECHIT, HCHIT    from this .HLB
                     MDHIT, LCHIT, SAHIT, VDHITE          from this .HLB
                     ASKTRK                               from this .HLB
                     UCOPY                                from CERN lib
                     CHAINT                     from BOS77.hlb
   
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
              GUSTEP                                                               
                   |----  CHAHOL                              External             
                   |----  CAPGET                                                   
                   |----  IUCOMP                              External             
                   |----  UCOPY                               External             
                   |----  GTRAN                               External             
                   |----  GRMAT                               External             
                   |----  IDETJO                              External             
                   |----  VDHIT                                                    
                   |----  ITHIT                                                    
                   |----  TPHIT                                                    
                   |----  SIHIT                                                    
                   |----  MUHIT                                                    
                   |----  SAHIT                                                    
                   |----  LSCHIT                                                   
                   |----  LCHIT                                                    
                   |----  ECHIT                                                    
                   |----  HCHIT                                                    
                   |----  CALHIT                                                   
                   |----  ASKTRK                                                   
                   |----  ASTDEB                                                   
   
 
3 GUTRAK
         SUBROUTINE GUTRAK
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   - F.Ranjard - 870331
   Follow one particle through the apparatus using geant3
   - IF  tracking type .eq. NOtracking marker word  THEN  do NOT track
     IF the particle comes from the generator and has been decayed in
        the generator THEN do NOT track
     Otherwise DO tracking  --> CALL GTRACK
     ENDIF
   - called by GTREVE                                  from GEANT3lib
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
              GUTRAK                                                               
                   |----  SQRT                                External             
                   |----  NLINK                               External             
                   |----  GTRACK                              External             
   

2 HCAL

  >>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>
    CKEY 
     1st entry into HCAL set
     ! GALEPH 25.5
       HCCONG, HCDIGI : cleaning of the code
       HCHIT  : suppress the possibility (never used) to create a geantino.
                to develop hadronic shower.
       HCSHOW : improvments in the hadronic shower development.
    
     ! GALEPH 25.4
       HCFITU : call HCTKSP with different argument names to please
                SHIFT compiler
    
  <<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<
     HCALTO     Evaluates the total calibration constant applied to data in
     HCASIG     Create analog signal
     HCBACK     Determine spot coordinate in the plane which containing the spot
     HCCOIN     Compute intersection with tubes for the full generator mode level
     HCCRDI     Implements the module create digital pattern
     HCCRPL     Builds the plane hit bank
     HCCRTO     Builds the tower hit bank
     HCDIGI     Implements the module create hc digitisings
     HCFITU     Find the tubes intersected by the track element
     HCFOPL     Implements the module format plane signal
     HCFORA     Implements the module format tower signal
     HCFORD     Implements the module format tube signal
     HCGEST     Implements the module generate hstreamer
     HCHISE     Order htht in increasing order of storey address
     HCHIST     Fill the history bank name,(nr=1,mr) with namindex nami
     HCHIT      Main routine to process each track element
     HCHLWD     Fill hlwd bank to remember the hit position along the tube
     HCIEVE     Initilize or upgrade variables and counters at the beginning of the e
     HCIFIR     Calculate the first plane crossed  by the shower
     HCINDU     Consider effects of inductions between tubes
     HCINIT     Initializes the variables used in local and counter commons
     HCIRUN     Initialisation routine for hcal
     HCMODN     Finds the module number for a given hcal tower
     HCNAMI     Define formats and name indices of hc bos banks
     HCNSTR     Return the numbers of streamers fired in the tube by each track. elem
     HCPROJ     Project the spots given onto the nearest sensible plane
     HCRDCA     Reads the calibration constants for the year
     HCSETP     Prepare information from track banks for the parametrization routines
     HCSHOW     Parametrize showers (geantino mode)
     HCSTAT     Statistics on single event
     HCSTEN     Return the energy of the streamers
     HCSTSE     Mod by a.venturi 980701 : allow one set of absolute coordinates
     HCTKSP     Take into account the spacers inside the module
     HCTRGA     Implements the module form tower trigger signal
     HCTRGD     Implements the module form tube trigger signal
     HCWSUM     Print statistics
     HFNDTR     Evaluate theta phi trigger adress
     HGETDB     Fill the hcgega common
     HHCUTG     Set flag to decide on geantino parametrization
     HNEWTK     Update same statistical informations when a new track enter in hcal
     HPANTP     Hpantp = +1. hadronic antiparticle
     HRDGAL     Get hcal bank used only in galeph and store the content in the
     HRDTRI     Load /hctrig/ with db trigger banks
     HTDEAD     Checks if a track element  is in the active area of a hcal tube

3 HCALTO
         REAL FUNCTION HCALTO(ISUB,IMD)
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Evaluates the total calibration constant applied to data in
     the year of generation
   
             Author: A. Sciaba`   24/04/98
   
   
           -Called by : HCFORA
   
   
   
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   HCFORA                                                                          
        |---- HCALTO                                                               
                   |----  CALMCB                              External             
                   |----  CALMCE                              External             
   
 
3 HCASIG
         SUBROUTINE HCASIG
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Create analog signal
   
        Author G. Zito  - 86/05/21
        Modified by G.Catanesi 87/10/27
        Modified by F.Ranjard  89/02/10
        Modified by A.Venturi & A.Sciaba` 98/7/1
                increase the size of HTHT
   
        Input bank: JDHCSE
        Output banks:JDHCHI,HWHT,HTHT       'E' list
   
       -Called by ASASIG
          -Calls : HCGEST, HCCRDI, HCINDU, HCCRTO, HCCRPL
              HCHISE,HCHIST,HCSTAT          from this .HLB
              SORTIQ                        from CERNLIB
   
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   ASASIG                                                                          
        |---- HCASIG                                                               
                   |----  SORTIQ                              External             
                   |----  WBANK                               External             
                   |----  INTCHA                              External             
                   |----  HCGEST                                                   
                   |----  ALBOS                               External             
                   |----  BLIST                               External             
                   |----  HCCRDI                                                   
                   |----  HCHLWD                                                   
                   |----  ICHCJO                              External             
                   |----  HCINDU                                                   
                   |----  HCCRTO                                                   
                   |----  HCCRPL                                                   
                   |----  HCHISE                                                   
                   |----  HCSTAT                                                   
                   |----  HCHIST                                                   
                   |----  HCHIS1                                                   
                   |----  AUBPRS                              External             
                   |----  WDROP                               External             
                   |----  ALTELL                              External             
   
 
3 HCBACK
         SUBROUTINE HCBACK(POS,KLEAV,VIN,XX,YY)
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Determine spot coordinate in the plane which containing the spot
    Transform spot coordinates from local frame to the Aleph frame
   
     Author    :F.Romano   86/7/20
     Modified  :G.Catanesi 86/11/1,87/10/21,88/07/06
     Modified  :A.Sciaba`  98/07/01 : bug fix in the determination of xx
   
             INPUT:
                  - POS/R  : spot coordinates in the local frame
                  - KLEAV/I: flag of the type spot type [0,2]
   
             OUTPUT:
                   - VIN/R   : spot coordinates in the Aleph frame
                   - XX/R    : spot coordinate in the tube plane
                                                    along wires
                   - YY/R    : spot coordinate  in the tube plane
                                     normal to the wires
          Called by : HCSHOW
       Calls     :HCRINV
   
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   HCSHOW                                                                          
        |---- HCBACK                                                               
                   |----  MOD                                 External             
                   |----  COS                                 External             
                   |----  SIN                                 External             
                   |----  POS                                 External             
                   |----  INT                                 External             
                   |----  ABS                                 External             
                   |----  HCRINV                              External             
                   |----  ATG                                 External             
                   |----  HCTIRF                              External             
   
 
3 HCCOIN
         SUBROUTINE HCCOIN
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Compute intersection with tubes for the full generator mode level
   
        Author :G.Catanesi 87/01/30
        Mod. by G.Catanesi 89/04/13 to take in account
                                       tube's inefficency
               Mod. by G.Catanesi 89/08/01
                       to take in account dead zone and dead tubes
             Mod by L. Silvestris 18/3/92
             Mod by A.Venturi and A.Sciaba 98/07/01
          bug fixes, improvments of local and abs coord evaluation
          and consistency checks
   
            Input  : McTrackElement stored in common TRKCOM
   
            Output : HCSE  McHcTubesSegment
   
   
      -Called by :HCHIT
          -Calls : HCFITU, HCSTSE, HTDEAD from this .HLB
                   GTRNSF from CERNLIB
                   HCMDPL, HCDEIT         from Alephlib
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   HCHIT                                                                           
        |---- HCCOIN                                                               
                   |----  GETRAN                                                   
                   |----  GTRNSF                              External             
                   |----  HCMDPL                              External             
                   |----  MOD                                 External             
                   |----  ABS                                 External             
                   |----  VDIST                               External             
                   |----  HCFITU                                                   
                   |----  MIN                                 External             
                   |----  SIGN                                External             
                   |----  ITUBE                               External             
                   |----  MAX                                 External             
                   |----  ICHCJO                              External             
                   |----  HCDEIT                              External             
                   |----  RNDM                                                     
                   |----  HCTEFF                              External             
                   |----  HTDEAD                                                   
                   |----  HCSTSE                                                   
   
 
3 HCCRDI
         SUBROUTINE HCCRDI
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Implements the module create digital pattern
   
            Author     : G.Zito 86/05/21
   
            Input bank : JDHCHI  McHcHits
                         JDHCSE  McHcTubesSegment
            Output bank : HWHT  McHcTubeSignal
   
      -Called by :HCASIG
      -Calls     :none
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   HCASIG                                                                          
        |---- HCCRDI.                                                              
   
 
3 HCCRPL
         SUBROUTINE HCCRPL
  ------------------------------------------------------------------------------
    CKEY HCAL HVPLANE HIT / INTERNAL
  ------------------------------------------------------------------------------
   Builds the plane hit bank
        Author      : G.Catanesi  89/02/03
        Mod. by     : L.Silvestris 24/6/92
   
        Input bank  : JDHCSE   McHcTrachSegment
                      JDHCHI   McHcHits
        Output bank : 'HPHT'   McHcPlanes
   
            Called by: HCASIG
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   HCASIG                                                                          
        |---- HCCRPL                                                               
                   |----  GTSTUP                              External             
                   |----  HCSTEN                                                   
   
 
3 HCCRTO
         SUBROUTINE HCCRTO
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Builds the tower hit bank
        Author      :G.Zito      86/05/21
        Modified    :G.Catanesi  86/12/03
                    :G.Catanesi  87/10/21
                    :G.Catanesi  88/08/20
                    :A.Venturi   98/07/01
           simulation of the signal spread along the tubes
           and simulation of the half-towers calibration
                    :A.Sciaba    98/08/21 mods in hctwth.h
   
        Input bank  : JDHCSE   McHcTrachSegment
                      JDHCHI   McHcHits
        Output bank : 'HTHT'   McHcStoreys
   
            Called by: HCASIG
           -Calls : HFNDTR, HCSTEN     from this .HLB
                    HFNDTW             from Alephlib
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   HCASIG                                                                          
        |---- HCCRTO                                                               
                   |----  NAMIND                              External             
                   |----  VZERO                               External             
                   |----  HCSTEN                                                   
                   |----  MOD                                 External             
                   |----  SQRT                                External             
                   |----  ABS                                 External             
                   |----  SIGN                                External             
                   |----  HTULEN                              External             
                   |----  HNEIGH                              External             
                   |----  HTSTEC                              External             
                   |----  HFNDTW                              External             
                   |----  HFNDTR                                                   
   
 
3 HCDIGI
         SUBROUTINE HCDIGI
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Implements the module create hc digitisings
   
        Author     : G.Zito     86/05/21
        Modified   : G.Catanesi 89/02/06
        Modified   : L.Silvestris 18/3/93
   
        Input bank : HTHT  McHcStoreys
                     HWHT  McHcTubeSignal with induction
                     HPHT  McHcPlaneSignal
        Output bank :
                     HWDI McHcTubeDigitising
                     HTDI  McHcStackDigitising
                     HPDI  McHcPlaneDigitising
                     HWTR McHcPlaneTriggerSignal
                     HTTR McHcTowerTriggerSignal
   
      -Called by : ASDIGI
      -Calls : HCTRGA, HCTRGD, HCFORA, HCFOPL, HCFORD from this .HLB
               BDROP,BLIST from BOS77.HLB
               ALBOS  from ALEPHLIB
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   ASDIGI                                                                          
        |---- HCDIGI                                                               
                   |----  BDROP                               External             
                   |----  ALBOS                               External             
                   |----  BLIST                               External             
                   |----  HCTRGA                                                   
                   |----  HCTRGD                                                   
                   |----  HCFORA                                                   
                   |----  HCFOPL                                                   
                   |----  HCFORD                                                   
                   |----  AUBPRS                              External             
   
 
3 HCFITU
         SUBROUTINE HCFITU(IPOR,IPL,YY,DY,ITUBF,NTUB,YPART,NTUSP,WSPAC)
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Find the tubes intersected by the track element
          is usable also with DY=0. (shower)
   
             Author   : G.Catanesi  86/12/05
             Modified : G.Catanesi  87/10/21,88/05/01
                        F.Ranjard   88/12/12
                        A.Venturi   98/7/1
                spacers taken into account in the determination
                of YMAX and of YY
   
             input  :
                    - YY/R           : coordinate normal to the wire dir.
                                      (Plane R.S.)
                    - DY/R           : track element projection          ion
                    - IPOR/I         : portion number
                    - IPL/I          : plane number
             output :
                    - ITUBF/R        :  # of first tube hit
                    - NTUB/I         : # of tubes hit
                    - YPART(1:NTUB)  :  % of the element track in
                                         the tube  j
                    - NTUSP/I        : if=I the Ith tube hit (1:NTUB)is
                                       a spacer
                    - WSPAC/R        : width of the spacer found (if any)
   
       calls     : HCTKSP  from this .HLB
   
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   HCCOIN                                                                          
   HCSHOW                                                                          
        |---- HCFITU                                                               
                   |----  HCDRBM                              External             
                   |----  HCSAMP                              External             
                   |----  ICHCJO                              External             
                   |----  HCTKSP                                                   
                   |----  MAX                                 External             
                   |----  HCLATU                              External             
                   |----  INT                                 External             
                   |----  HCDPSP                              External             
                   |----  MIN                                 External             
                   |----  MOD                                 External             
   
 
3 HCFOPL
         SUBROUTINE HCFOPL
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Implements the module format plane signal
   
             Author : G.Catanesi 03/02/1989
   
             Input bank : HPHT
             Output bank: HPDI
   
   
           -Called by : HCDIGI
           -Calls     : SORTIQ,MVBITS from CERNLIB
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   HCDIGI                                                                          
        |---- HCFOPL                                                               
                   |----  SORTIQ                              External             
                   |----  MOD                                 External             
                   |----  INT                                 External             
                   |----  MVBITS                              External             
                   |----  IBITS                               External             
   
 
3 HCFORA
         SUBROUTINE HCFORA
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Implements the module format tower signal
   
             Author : G.Zito  86/05/21
             mod. by: G.Catanesi, F.Ranjard - 890522
                      1 stack or 2 stacks
             mod. by: A.Sciaba`, A.Venturi -980702
                      thresholds and half towers calib
             Input bank : HTHT  McHcStoreys
             Output bank: HTDI  McHcTowerDigitising
   
   
           -Called by : HCDIGI
           -Calls     : SORTMI,MVBITS from CERNLIB
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   HCDIGI                                                                          
        |---- HCFORA                                                               
                   |----  MOD                                 External             
                   |----  INT                                 External             
                   |----  MVBITS                              External             
                   |----  IHCREG                              External             
                   |----  MIN                                 External             
                   |----  IBITS                               External             
                   |----  HCMODN                                                   
                   |----  HCALTO                                                   
                   |----  MAX                                 External             
                   |----  ABS                                 External             
                   |----  CALMCB                              External             
                   |----  CALMCE                              External             
                   |----  UBPACK                              External             
   
 
3 HCFORD
         SUBROUTINE HCFORD
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Implements the module format tube signal
   
          Author      : G.Zito     86/05/21
          Modified    : G.Catanesi, F.Ranjard  89/05/22
   
          Input bank  :       HWHT McHcTubeSignal
          Output bank :       HWDI McHcTubeDigitising
   
         -Called by : HCDIGI
         -Calls     : MVBITS  from CERNLIB
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   HCDIGI                                                                          
        |---- HCFORD                                                               
                   |----  MOD                                 External             
                   |----  NHCTU1                              External             
                   |----  IXHCSE                              External             
                   |----  IXHCFI                              External             
                   |----  MVBITS                              External             
                   |----  MIN                                 External             
                   |----  IBITS                               External             
   
 
3 HCGEST
         SUBROUTINE HCGEST
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Implements the module generate hstreamer
    Saturation effects are handled in this routine
   
          Authors :G.Catanesi,G.Zito 86/05/21
          Modified:G.Catanesi        87/01/17
   
         Input bank : JDHCSE McHcTubesSegment
         Output bank: JDHCHI  McHcHits
   
          -Called by :HCASIG
         -Calls      :HCNSTR from this .HLB
                      SORTRQ from CERNLIB
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   HCASIG                                                                          
        |---- HCGEST                                                               
                   |----  SORTRQ                              External             
                   |----  ABS                                 External             
                   |----  MAX                                 External             
                   |----  HCNSTR                                                   
   
 
3 HCHISE
         SUBROUTINE HCHISE
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   - F.RANJARD - 860619            modified - 890801
   Order htht in increasing order of storey address
    modify HCSE accordingly
   - Called by   HCASIG                                from this .HLB
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   HCASIG                                                                          
        |---- HCHISE                                                               
                   |----  WBANK                               External             
                   |----  SORTZV                              External             
                   |----  IUCOMP                              External             
                   |----  SORTIQ                              External             
                   |----  WDROP                               External             
                   |----  ALTELL                              External             
   
 
3 HCHIST
         SUBROUTINE HCHIST (NAME,MR,NAMI,IELE,JELE)
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   - F.Ranjard - 860613
   Fill the history bank name,(nr=1,mr) with namindex nami
     for that the bank HCSE is sorted in increasing order of
     element# IELE and then for a each value of element# IELE
     in increasing order of element# JELE.
   - If the element# IELE is the same for 2 concecutive calls to
     HCHIST the entry point HCHIS1 can be used instead to save
     the 1st sort.
   -       NAME, NR=MR-2   # of element JELE belonging to 1 element IELE
                 NR=MR-1   pointer to 1st element JELE belonging to 1
                           element IELE in the list NR=MR
                 NR=MR     list of elements JELE belonging to each elemen
                           IELE
   - If MR=4 the correlation is between tracks and hits. In this case
           NAME, NR=1      list of track#s which have contributed to hits
   - Called by    HCASIG                                 from this .HLB
   - Calls        SORTIQ                                 from GENLIB
                  ALBOS                                  from this .HLB
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   HCASIG                                                                          
        |---- HCHIST                                                               
                   |----  SORTIQ                              External             
                   |----  NLINK                               External             
                   |----  ALBOS                               External             
                   |----  BLIST                               External             
                   |----  AUBPRS                              External             
   
 
3 HCHIT
         SUBROUTINE HCHIT
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Main routine to process each track element
   
          Author   :G.Catanesi      86/11/24
          Mod.     :G.Catanesi      87/11/19
          Mod.     :L.Silvestris    18/3/93
          input:  McTrackElement stored in common TRKCOM
          output bank: HCSE McHcTubeSegments
   
   
      -Called by : GUSTEP
      -Calls     : HCCOIN (detailed geometry)  from this .HLB
                   HCSHOW (geantino electron param) from this .HLB
                   HCIEVE, HNEWTK (general) from this .HLB
   
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   GUSTEP                                                                          
        |---- HCHIT                                                                
                   |----  FBEGJO                              External             
                   |----  HCIEVE                                                   
                   |----  HNEWTK                                                   
                   |----  HCSHOW                                                   
                   |----  HCCOIN                                                   
   
 
3 HCHLWD
         SUBROUTINE HCHLWD
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Fill hlwd bank to remember the hit position along the tube
   
          Author      : F.Ranjard - 911121
   
          Input bank  :       HWHT and HCSE
          Output bank :       HLWD
   
         -Called by : HCASIG
         -Calls     : MVBITS  from CERNLIB
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   HCASIG                                                                          
        |---- HCHLWD                                                               
                   |----  MOD                                 External             
                   |----  MVBITS                              External             
                   |----  NHCTU1                              External             
                   |----  IXHCSE                              External             
                   |----  IXHCFI                              External             
                   |----  MIN                                 External             
                   |----  IBITS                               External             
   
 
3 HCIEVE
         SUBROUTINE HCIEVE
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Initilize or upgrade variables and counters at the beginning of the e
   
          Author       :G.Catanesi   86/05/22
          Modified by  :G.Catanesi   87/07/10
   
          Called by : HCHIT
          Calls     : VZERO from CERNLIB
                    : BDROP,WBANK from BOS77
                    : ALTELL from ALEPHLIB
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   HCHIT                                                                           
        |---- HCIEVE                                                               
                   |----  BDROP                               External             
                   |----  WBANK                               External             
                   |----  INTCHA                              External             
                   |----  IPRIJO                              External             
                   |----  ICHCJO                              External             
                   |----  ALTELL                              External             
   
 
3 HCIFIR
         INTEGER FUNCTION HCIFIR(S)
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
            G.Catanesi         1/9/86
   Calculate the first plane crossed  by the shower
          Called by CAHMOD
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
              HCIFIR                                                               
                   |----  AMOD                                External             
   
 
3 HCINDU
         SUBROUTINE HCINDU
  ------------------------------------------------------------------------------
    CKEY HCAL INDUCTION
  ------------------------------------------------------------------------------
   Consider effects of inductions between tubes
         Author       : G. Iaselli  880119
                        F.Ranjard   920115
   
         Input  Bank    : JDHCHI  McHcHits
                          JDHCSE  McHcTubesSegment
                          HWHT    McHcTubeSignal
   
         Output Bank    : HWHT
         temporary Bank : JDHTEM
         Called by      : HCASIG
   
   
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   HCASIG                                                                          
        |---- HCINDU                                                               
                   |----  WBANK                               External             
                   |----  POISSN                              External             
                   |----  SIGN                                External             
                   |----  RNDM                                                     
                   |----  NHCTU1                              External             
                   |----  SORTIQ                              External             
                   |----  ALTELL                              External             
                   |----  UCOPY                               External             
                   |----  MOD                                 External             
                   |----  BKFRW                               External             
                   |----  WDROP                               External             
   
 
3 HCINIT
         SUBROUTINE HCINIT
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Initializes the variables used in local and counter commons
          at the beginning of the run
   
                                    Author: G.Catanesi 87/10/07
   
         Called by : HCIRUN
         Calls     : none
   
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   HCIRUN                                                                          
        |---- HCINIT.                                                              
   
 
3 HCIRUN
         SUBROUTINE HCIRUN
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Initialisation routine for hcal
   
                         Author : G.Catanesi 87/09/15
                        modified: F.Ranjard  88/02/05
                        modified: A.Sciaba`  98/04/29
      Called by : ASIMOD                             from this .HLB
      Calls     : HRDGAL,HCRDCA,HRDTRI,HCNAMI,HCINIT,HCINPA
                                                     from this .HLB
                  HRDDAF                             from ALEPHLIB
   
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   ASIMOD                                                                          
        |---- HCIRUN                                                               
                   |----  HRDDAF                              External             
                   |----  ALTELL                              External             
                   |----  HCPRGE                              External             
                   |----  IPRIJO                              External             
                   |----  HRDGAL                                                   
                   |----  HCRDCA                                                   
                   |----  HRDTRI                                                   
                   |----  IDETJO                              External             
                   |----  HCNAMI                                                   
                   |----  HCINIT                                                   
   
 
3 HCMODN
         SUBROUTINE HCMODN(ITH,IPH,ISUB,IMD1,IMD2)
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Finds the module number for a given hcal tower
   
             Author : A. Sciaba` 02/07/1998
    input:
            ITH   : tower theta index
            IPH   : tower phi index
    output:
            ISUB  : subcomponent (1=barrel,2=overlap,3=endcaps)
            IMD1  : module number for the barrel part of the tower
            IMD2  : module number for the endcap part of the tower
   
           -Called by : HCFORA
           -Calls     : MDARD, NAMIND
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   HCFORA                                                                          
        |---- HCMODN                                                               
                   |----  NAMIND                              External             
                   |----  MOD                                 External             
   
 
3 HCNAMI
         SUBROUTINE HCNAMI
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Define formats and name indices of hc bos banks
   
                                   Author:G.Catanesi 87/09/15
             Called from :HCIRUN
             Calls       :NAMIND,BFKFMT from BOS77.hlb
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   HCIRUN                                                                          
        |---- HCNAMI                                                               
                   |----  NAMIND                              External             
                   |----  BKFMT                               External             
   
 
3 HCNSTR
         INTEGER FUNCTION HCNSTR(DX)
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
                                           140486 G.Catanesi
   Return the numbers of streamers fired in the tube by each track. elem
   
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   HCGEST                                                                          
        |---- HCNSTR                                                               
                   |----  MOD                                 External             
                   |----  RNDM                                                     
                   |----  INT                                 External             
   
 
3 HCPROJ
         SUBROUTINE HCPROJ(POS,IS,IGO,KLEAV)
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Project the spots given onto the nearest sensible plane
   
          Author    :F.Romano    86/06/06
          Modified  :G.Catanesi  86/11/01
        Project the spots given by Hcpars onto the
        nearest sensible plane. If the plane is in
        another module the projection is performed
        Care is taken when the shower propagates at
        a small angle respect to the sensible planes
        without changing the reference system.
   
          input :
               - POS/R  : coordinates in the 'SHOWER' frame
               - ISS/I  : first plane crossed by the shower
               - IGO/I  : flag (+1=Z>0 -1=Z<0)
   
          output :
                -POS/R  : coordinates projected on nearest
                          sensible plane
                -KLEAV/I: flags the type of spot
                   0   spot is in the same barrel module where
                       the shower started
                   1   spot is in a contiguous barrel module
                   2   spot is in the endcap
   
         Called by : HCSHOW
         Calls     : none
   
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   HCSHOW                                                                          
        |---- HCPROJ                                                               
                   |----  HCTIRF                              External             
                   |----  ABS                                 External             
                   |----  SIN                                 External             
                   |----  NHCPLA                              External             
                   |----  TAN                                 External             
                   |----  SQRT                                External             
                   |----  ATG                                 External             
                   |----  SIGN                                External             
                   |----  INT                                 External             
   
 
3 HCRDCA
         SUBROUTINE HCRDCA
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Reads the calibration constants for the year
   
              Author: A.Sciaba`  29/04/98
              Modified: 18/08/98
                   -added HIMM bank
              Input banks: HSCA,HT0C,HIMC,HSTD,HIFC,HIMM
   
   
            -Called by : HCIRUN
            -Calls     : MDARD                      from BOS
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   HCIRUN                                                                          
        |---- HCRDCA                                                               
                   |----  MDARD                               External             
                   |----  IPRIJO                              External             
                   |----  GTSTUP                              External             
                   |----  NAMIND                              External             
                   |----  ALGTDB                              External             
                   |----  NDANR                               External             
   
 
3 HCSETP
         SUBROUTINE HCSETP
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Prepare information from track banks for the parametrization routines
    coordinates to the local frame : z-axis is
       always normal to the wire planes
   
            Authors   :G.Catanesi,F.Romano 86/09/01
   
            Called by : CAHMOD
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   CAHMOD                                                                          
        |---- HCSETP                                                               
                   |----  MOD                                 External             
                   |----  SQRT                                External             
                   |----  ASIN                                External             
                   |----  ATG                                 External             
   
 
3 HCSHOW
         SUBROUTINE HCSHOW
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Parametrize showers (geantino mode)
   
              Authors     :G.Catanesi 87/12/14
              Mod         :G.Catanesi 89/08/01
              Modified by :L.Silvestris 18/3/93
              Modified by :A.Venturi 98/07/01
          take into account the change in HCSTSE arguments
   
          Called by :HCHIT                         from this .HLB
          Calls to :CAHMOD, CAHERB, HCPROJ, HCBACK from this .HLB
                    HCFITU,HCSTEN,HCSTSE
                    HCDEIT,HTDEAD                   from Alephlib
   
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   HCHIT                                                                           
        |---- HCSHOW                                                               
                   |----  CAHMOD                                                   
                   |----  VZERO                               External             
                   |----  CAHERB                                                   
                   |----  NHCPLA                              External             
                   |----  SIGN                                External             
                   |----  HCPROJ                                                   
                   |----  HCBACK                                                   
                   |----  ABS                                 External             
                   |----  HCFITU                                                   
                   |----  ICHCJO                              External             
                   |----  HCDEIT                              External             
                   |----  RNDM                                                     
                   |----  HCTEFF                              External             
                   |----  HTDEAD                                                   
                   |----  HCSTEN                                                   
                   |----  HCSTSE                                                   
   
 
3 HCSTAT
         SUBROUTINE HCSTAT
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Statistics on single event
   
           Author    :G.Catanesi  87/07/10
   
      -Called by : HCASIG
      -Calls     : HCVRTX
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   HCASIG                                                                          
        |---- HCSTAT                                                               
                   |----  SQRT                                External             
                   |----  NLINK                               External             
                   |----  CHAINT                              External             
                   |----  FLOAT                               External             
                   |----  WBANK                               External             
                   |----  HCEPOR                              External             
                   |----  ICHCJO                              External             
                   |----  WDROP                               External             
   
 
3 HCSTEN
         REAL FUNCTION HCSTEN(NST)
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
                                          032486  G.Catanesi
   Return the energy of the streamers
          Calls to : HISRAN from Cernlib
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   HCCRPL                                                                          
   HCCRTO                                                                          
   HCSHOW                                                                          
        |---- HCSTEN                                                               
                   |----  HISRAN                              External             
   
 
3 HCSTSE
         SUBROUTINE HCSTSE(VTUB,IPOR,IMOD,ILAY,XTUB,YTUB,DYTUB,ITUB,NTUB)
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   - F.Ranjard - 860529
   -  mod by G.Catanesi 871021
   - mod by F.Ranjard  890523 : do not keep negative tube #
   Mod by a.venturi 980701 : allow one set of absolute coordinates
     for each track segment: VTUB(100,3)
    - Fill the bank JDHCSE with the NTUB fired tubes with
      numbers listed in ITUB from plane # IPLAN
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   HCCOIN                                                                          
   HCSHOW                                                                          
        |---- HCSTSE                                                               
                   |----  MAX                                 External             
                   |----  WBANK                               External             
                   |----  WDROP                               External             
                   |----  ALTELL                              External             
   
 
3 HCTKSP
         SUBROUTINE HCTKSP(IPOR,IPL,YY,DY,NSP,NTUSP,IDEAD)
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Take into account the spacers inside the module
    in the barrel , and the iron frames in the
    end-caps
   
           Author       : G.Catanesi   86/06/07
           Modified by  : F.Ranjard    88/12/12
           Modified by  : A.Venturi    98/07/01
                          consistency checks added
           input :
                - YY/R   :coordinate in the tube plane normal
                          to the wires
                - DY/R   :projection of the track element
                          normal to the wires
                - IPOR/I :portion number
                - IPL/I  :layer number
           output :
                 - YY/R     : coordinate in the tube plane normal
                              minus the spacer width
                 - DY/R     : width of the track element outside spacer
                 - NTUSP/I  : Flag (if=I track element passed trougth
                                         the spacer I)
                 - NSP/I    : # of spacers found
                 - IDEAD/I  : =0  sensitive zone
                              =1  dead zone
   
   
           called by :HCFITU
           calls     : none
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   HCFITU                                                                          
        |---- HCTKSP                                                               
                   |----  HCDPSP                              External             
                   |----  HCDWSP                              External             
                   |----  INT                                 External             
                   |----  HCSAMP                              External             
   
 
3 HCTRGA
         SUBROUTINE HCTRGA
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Implements the module form tower trigger signal
   
   
         Author     : G.Zito 86/05/21
         Modified by: F.Ranjard 89/02/10
   
         Input bank  : HTHT  McHcStoreys
         Output bank : HTTR  McHcTowerTrigSignal
   
   
      -Called by : HCDIGI
      -Calls     : none
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   HCDIGI                                                                          
        |---- HCTRGA                                                               
                   |----  NINT                                External             
   
 
3 HCTRGD
         SUBROUTINE HCTRGD
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Implements the module form tube trigger signal
   
        Author     :G.Zito   86/05/21
         Modified by :G.Catanesi   88/01/20
                      F.Ranjard    89/02/10
   
         Input bank  : HWHT  McHcTubeSignal
         Output bank : HWTR  McHcTubeTrigSignal
   
   
      -Called by :HCDIGI
      -Calls     :none
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   HCDIGI                                                                          
        |---- HCTRGD                                                               
                   |----  MOD                                 External             
   
 
3 HCWSUM
         SUBROUTINE HCWSUM
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Print statistics
   
         Authors     :G.Catanesi,G.Zito  86/12/03
         Modified by :G.Catanesi  87/07/10,87/11/19
   
          -Called by : ASCRUN      from this .HLB
      -Calls     : none
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   ASCJOB                                                                          
        |---- HCWSUM                                                               
                   |----  FLOAT                               External             
                   |----  ICHCJO                              External             
   
 
3 HFNDTR
         SUBROUTINE HFNDTR(COOR,IPOR,ITOW,ITRI)
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Evaluate theta phi trigger adress
   
                            Author: G.Catanesi 25/08/88
   
    - Input:
            COOR(1-3)/R  : X,Y,Z in the ALEPH system
            IPOR /I      :portion #
            ITOW(1-3)/I  : nphi,ntheta,nstack
    - Output :
            ITRI(1-2)/I  : nphi trigger, ntheta trigger
   
     - Called by :HCCRTO
     - Calls     :HCCYL
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   HCCRTO                                                                          
        |---- HFNDTR                                                               
                   |----  HCCYL                               External             
                   |----  NHCBTS                              External             
                   |----  NHCETS                              External             
                   |----  INT                                 External             
   
 
3 HGETDB
         SUBROUTINE HGETDB
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Fill the hcgega common
   
             Author : G.Catanesi 88/04/18
   
        Called by: HRDGAL    from this .HLB
      Calls    : HGETGA from Alephlib
   
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   HRDGAL                                                                          
        |---- HGETDB                                                               
                   |----  HGETGA                              External             
                   |----  INT                                 External             
   
 
3 HHCUTG
         SUBROUTINE HHCUTG(MFLAG)
  ------------------------------------------------------------------------------
    CKEY HCAL GEANTINO
  ------------------------------------------------------------------------------
   Set flag to decide on geantino parametrization
   - M.N.Minard
   - Output : MFLAG / I =
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
              HHCUTG.                                                              
   
 
3 HNEWTK
         SUBROUTINE HNEWTK
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Update same statistical informations when a new track enter in hcal
   
                Author    :G.Catanesi  87/05/25
   
                Called by  : HCHIT
                Calls      : none
   
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   HCHIT                                                                           
        |---- HNEWTK                                                               
                   |----  SQRT                                External             
                   |----  NLINK                               External             
                   |----  FBEGJO                              External             
                   |----  WBANK                               External             
                   |----  INTCHA                              External             
                   |----  WDROP                               External             
   
 
3 HPANTP
         REAL FUNCTION HPANTP(ITYP)
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
                                   G.Catanesi 1/9/86
   Hpantp = +1. hadronic antiparticle
        "     = -1. hadronic particle
        "     =  0. otherwise
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   CATINO                                                                          
        |---- HPANTP.                                                              
   
 
3 HRDGAL
         SUBROUTINE HRDGAL
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Get hcal bank used only in galeph and store the content in the
                       HCCONG common
   - F.Ranjard - 880202
   - Modified by L.Silvestris     31/08/90
                F.Ranjard        11/10/91
                get HCOS and HGEA depending on the GEANT version number
                use MDARD to get banks from data base
   - Called by : HCIRUN
             Calls     : ALTELL from Alephlib
                         UCOPY,HISPRE from Cernlib
   
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   HCIRUN                                                                          
        |---- HRDGAL                                                               
                   |----  INT                                 External             
                   |----  MDARD                               External             
                   |----  UCOPY                               External             
                   |----  HCFLSS                              External             
                   |----  HISPRE                              External             
                   |----  HGETDB                                                   
                   |----  ALTELL                              External             
   
 
3 HRDTRI
         SUBROUTINE HRDTRI (LDBAS,IRUN,IFLAG)
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   - G.Catanesi - 871007 -                    F.Ranjard - 880203
   Load /hctrig/ with db trigger banks
   - input arguments:
          LDBAS    : data base logical unit#
          IRUN     : run number
   - output argument:
          IFLAG     : return flag ( = ALGTDB(LDBAS,list,IRUN) )
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   HCIRUN                                                                          
        |---- HRDTRI                                                               
                   |----  ALGTDB                              External             
                   |----  NAMIND                              External             
   
 
3 HTDEAD
                 SUBROUTINE HTDEAD(XTBIN,DXTBI,ITUB,IDEAD)
  ------------------------------------------------------------------------------
    CKEY HCAL DEAD TUBE / INTERNAL
  ------------------------------------------------------------------------------
   
   - G.Catanesi - 890813
                  900211 - set XTBOU for encap part
   Checks if a track element  is in the active area of a hcal tube
   
    if a fraction of the track element is outside the active area
    this fraction is killed and x and dx recomputed
   
                       Author : G.Catanesi 15/5/89
                       Mod by: Andrea Venturi & L.Silvestris 24/6/92
                       to take in account the shift of tubes in barrel...
   
          INPUT:
                    XTBIN /R = x coordinate in the Plane R.S.
                            of the track element baricenter
                    DXTBI/R = projection in the wire direction
                    ITUB/I  = tube #
             ==>    becareful the input argument XTBIN and DXTBI
                    can be modified by the routine
          OUTPUT:
                    XTBIN /R = x coordinate in the Plane R.S.
                             of the track element baricenter
                    DXTBI/R = projection in the wire direction
                    IDEAD/I = Flag if = 0 Track in the active area
                                      = 1 Track in the dead area
   
   
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   HCCOIN                                                                          
   HCSHOW                                                                          
        |---- HTDEAD                                                               
                   |----  HNEIGH                              External             
                   |----  SIGN                                External             
                   |----  HTULEN                              External             
                   |----  ABS                                 External             
                   |----  HTSTEC                              External             
                   |----  MAX                                 External             
   

2 ITC

  >>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>
    CKEY 
     1st entry in ITC set
    
     ! GALEPH 25.5
       Modifications for new drift time parameterisation.
       Database bank IDTC is replaced by IDRP to allow higher order
       polynomial.  For backwards compatibility versions of IDRP for old
       Monte Carlo data are provided which duplicate the existing IDTC
       banks.   NB. Requires ADBSCONS >= 183
       purged   IDTCJJ
       modified IJJPAR, ITPARC
                ITDCNS, ITDRFT, ITDTGO, ITIRUN, ITPGEO, ITRES
    
  <<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<
     IAPROX     Find closest point to wire on track element.
     IRUCHK     Check interpolation along itc track element.
     ISBEND     Calculate apparent measured z with non-linear s-bend parameters.
     ISPLIN     Compute point on cubic spline curve, 1st call.
     ITALIG     Transform hits to itc local system (rotated chamber).
     ITASIG     Termination of hits stage for itc.
     ITBINT     Calculate the theta bin number corresponding to the input trigger
     ITDAQ      Simulate itc readout.  produce the raw data bank and trigger bits.
     ITDCNS     Get constants controlling drift relation and resolution.
     ITDIGI     Create the digitisings for the itc.
     ITDRFT     Calculate the drift time due to a set of hits in a single cell.
     ITDTGO     Initialise drift time parameterisation.
     ITHIT      Compute the hits data for the itc.
     ITIRUN     Initialise itc routines.
     ITMSK1     Map the itc trigger segments onto the 18 bus-lines.
     ITMSK2     Map the 18 itc trigger bus-lines with the 8 bit memory address
     ITNOIS     Generate random noise hits in the itc.
     ITPGEO     Print itc read out geometry
     ITPHIM     Fill the 192 itc trigger masks.
     ITRES      Smear itc drift distance by parameterised resolution from irrf.
     ITRGPA     Set up the itc trigger 256 bit address scheme for the allowed
     ITROTI     Initialise itc alignment constants.
     ITRPP      Simulate the itc r-phi and r-phi-z trigger processors.
     ITRSB      Evaluate itc special trigger bits.
     ITSDIG     Calculate the digitised values of the itc data.
     ITTEXP     Create time-expanded pulses.  return the output pulse time and
     ITTOFE     Propagate induced wire signals to the preamps at either end of itc.
     ITWINI     Initialise layout of itc and time expansion constants for readout.
     ITWSUM     Print run summary for itc.
     ITXTLK     Generate cross-talk on itc readout channels.
     ITZCOI     Calculate the 3d trigger result for a single mask using the time

3 IAPROX
         SUBROUTINE IAPROX(XWI, YWI, VA, VB, VP)
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   
   APROX  1.00  900426  14:54                        R.Beuselinck.
   
   Find closest point to wire on track element.
   
     Arguments:
     XWI [S,I,REAL] : X coordinate of wire.
     YWI [S,I,REAL] : Y coordinate of wire.
     VA  [V,I,REAL] : Start point on track element.
     VB  [V,I,REAL] : End point on track element.
     VP  [V,O,REAL] : Point closest to sense wire on track element.
   
     The closest point to (XWI,YWI) on the line segment AB is found.
     This is normally the perpendicular distance to the line unless that
     point falls outside the limits of the given start and end points.
     In that case the closest of VA, VB is returned.
   
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   ITHIT                                                                           
        |---- IAPROX                                                               
                   |----  ABS                                 External             
   
 
3 IRUCHK
         SUBROUTINE IRUCHK(RWANT, U, DRDU)
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   
     1.00  900509  17:07                         R.Beuselinck
   
   Check interpolation along itc track element.
   
     Arguments:
     RWANT [S,I ,REAL] : Required radius of interpolated point.
     U     [S,IO,REAL] : Fraction of distance along track element.
     DRDU  [S,I ,REAL] : Gradient of R wrt. U using quadratic approx.
   
     The purpose of this routine is to correct for any significant
     errors in the predictions of the intersections of track elements
     with the inner and outer radial boundaries of the ITC sense wire
     layers.  These predictions are made by solving the quadratic
     approximation for R(u). In a small number of cases there may be
     significant discrepancy from the value of R calculated using the
     cubic spline formula.
   
     RWANT is the radius required in (x,y) projection for intersection
     with an ITC wire cylinder.
     U is the fraction along the current track element at which the
     crossing is predicted.  DRDU is the local gradient derived from the
     quadratic approximation formula.
   
     Calculate the actual value of R using the cubic spline formula at U.
     If the difference from RWANT is greater than tolerance
     calculate the predicted shift in U needed using the local gradient.
     Calculate RNEW using the updated U value according to the cubic
     spline formula.  Keep the new U value if RNEW is closer to RWANT.
   
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   ITHIT                                                                           
        |---- IRUCHK                                                               
                   |----  ISPLIO                                                   
                   |----  SQRT                                External             
                   |----  ABS                                 External             
   
 
3 ISBEND
         SUBROUTINE ISBEND(Z, ZM)
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   
   BEND  2.00  920213  18:59                        R.Beuselinck
   
   Calculate apparent measured z with non-linear s-bend parameters.
   
     Arguments:
     Z   [S,I,REAL] : Z coordinate on ITC wire (cm).
     ZM  [S,O,REAL] : "Measured Z" from inverting S-bend relation.
   
     The measured Z is computed according to an interpolation
     table generated from the parametrisation of Z = F(ZM) of the form
              Z = S1*ZM + S2*SIN(2*Pi/S3 * ZM)
     where S1,S2,S3 are the "S-bend" coefficients from the IZNL bank.
     This routine must be initialised by first calling ISBGIN.
   
   
         ENTRY ISBGIN(ZMAX, S1, S2, S3)
   
   BGIN  2.00  920213  19:13                        R.Beuselinck
   
     Setup lookup table for inverse S-bend parametrisation.
   
     Arguments:
     ZMAX  [S,I,REAL] : Maximum Z coordinate to interpolate.
     S1    [S,I,REAL] : S-bend parameter 1.
     S2    [S,I,REAL] : S-bend parameter 2.
     S3    [S,I,REAL] : S-bend parameter 3.
   
     The input S-bend parameters describe the non-linearity of time
     difference measured as a function of Z along the ITC wires.
     This routine computes the true Z for a set of equally spaced
     measured Z positions along the wires which are then used for a fast
     interpolation of the inverse function, i.e. Zmease as a function
     of Ztrue.
     This routine is the initialisation entry point for ISBEND.
   
     NB: This routine used to work in terms of time difference rather
     than measured Z, so the variables T1, T2, TT, TDIF should now
     be understood as referring to measured Z values.
   
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   ITTOFE                                                                          
        |---- ISBEND                                                               
                   |----  SIN                                 External             
                   |----  ABS                                 External             
   
 
3 ISPLIN
         SUBROUTINE ISPLIN(U, V1, V2, SLENG, VP)
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   
     1.00  900424  13:04                        R.Beuselinck.
   
   Compute point on cubic spline curve, 1st call.
   
     Arguments:
     U     [S,I,REAL] : Fraction of distance along total spline length.
     V1    [V,I,REAL] : (x,y,z,dx,dy,dz) of first point on spline.
     V2    [V,I,REAL] : (x,y,z,dx,dy,dz) of last point on spline.
     SLENG [S,I,REAL] : Total path length from V1 to V2.
     VP    [V,O,REAL] : (x,y,z) of requested point on spline.
   
     Use a standard cubic spline formula to compute the coordinates of
     the point at a distance U along a track element, where U ranges
     from 0.0 to 1.  The coordinate origin is shifted to the first point
     on the track element to remove one term from the spline formula.
   
   
         ENTRY ISPLIO(U, VP)
   
     1.00  900424  13:04                        R.Beuselinck.
   
     Compute point on cubic spline curve, later call.
   
     Arguments:
     U  [S,I,REAL] : Fraction of distance along total spline length.
     VP [V,O,REAL] : (x,y,z) of requested point on spline.
   
     This is an entry point of ISPLIN to reduce the number of calling
     arguments required for subsequent calls for the same spline.
   
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   ITHIT                                                                           
        |---- ISPLIN.                                                              
   
 
3 ITALIG
         SUBROUTINE ITALIG(VECI, VECO)
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   
   ALIG  1.01  870714  12:57                          R.Beuselinck
   
   Transform hits to itc local system (rotated chamber).
   
     Input  VECI(6) /R
     Output VECO(6) /R
   
     The elements of VECI,VECO are a position vector (x,y,z) plus
     a set of direction cosines (dx/x,dy/y,dz/z).
   
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   ITHIT                                                                           
        |---- ITALIG.                                                              
   
 
3 ITASIG
         SUBROUTINE ITASIG
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   
   ASIG  1.01  880407  16:08                        R.Beuselinck
   
   Termination of hits stage for itc.
     If no track elements have activated ITHIT in this event create a
     hit bank containing only noise hits.
   
     Called by: ASASIG                                   from this .HLB
         Calls: WBANK, WDROP, BKFRW, BLIST               from BOS77
                ITNOIS                                   from this .HLB
   
     Named banks used:
     IHIT - created if not existing and reduced
   
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   ASASIG                                                                          
        |---- ITASIG                                                               
                   |----  ALBOS                               External             
                   |----  ITNOIS                                                   
                   |----  AUBPRS                              External             
                   |----  BLIST                               External             
                   |----  IPRIJO                              External             
                   |----  ITPRHT                              External             
   
 
3 ITBINT
         SUBROUTINE ITBINT(TRIGT,IBIN)
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   
   BINT  1.00  860609  19:55                        R.Beuselinck
   
   Calculate the theta bin number corresponding to the input trigger
     time for the R-phi-Z trigger.
   
     Calling arguments:
     TRIGT - Time of valid trigger coincidence (ns)           (INPUT)
     IBIN  - Bin number resulting in range 1 to 256          (OUTPUT)
   
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   ITZCOI                                                                          
        |---- ITBINT.                                                              
   
 
3 ITDAQ
         SUBROUTINE ITDAQ
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   
   AQ  2.10  890413  13:11                         R.Beuselinck.
   
   Simulate itc readout.  produce the raw data bank and trigger bits.
   
     Called by: ITDIGI                                from this .HLB
         Calls: WBANK, WDROP, BLIST                   from BOS77
                ITSDIG, ITRPP                         from this .HLB
                ALBOS                                 from ALEPHLIB
   
     Work banks used:
      JDITNW, JDITAB, JDITDC, JDIZSC          - created and dropped
                                                in this routine.
      JDITFN  - read only.
   
     Named banks used:
      IDIG - raw data (DST bank).
      IDHR - correlation bank. Digits to Hits Relation.
      ITTR - level 1 trigger bank.
      IXRP - ITC R-Phi mask bits for level 3.
   
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   ITDIGI                                                                          
        |---- ITDAQ                                                                
                   |----  WBANK                               External             
                   |----  VFILL                               External             
                   |----  ITSDIG                                                   
                   |----  ALTELL                              External             
                   |----  ALBOS                               External             
                   |----  MVBITS                              External             
                   |----  IBSET                               External             
                   |----  ITRPP                                                    
                   |----  ICITJO                              External             
                   |----  BLIST                               External             
                   |----  WDROP                               External             
   
 
3 ITDCNS
         SUBROUTINE ITDCNS
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   
     2.11  930721  18:03                          R.Beuselinck
   
   Get constants controlling drift relation and resolution.
   
     Called by: ITIRUN                                  from this .HLB
         Calls: NAMIND                                  from BOS77
   
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   ITIRUN                                                                          
        |---- ITDCNS                                                               
                   |----  NAMIND                              External             
                   |----  ITDTGO                                                   
   
 
3 ITDIGI
         SUBROUTINE ITDIGI
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   
     1.07  890417  14:53                        R.Beuselinck.
   
   Create the digitisings for the itc.
   
     Simulate the drift time distribution of the cells and find the
     drift times corresponding to the accumulated hits.
     Propagate the induced signals to the electronics and generate the
     digitisings.
   
     Called by: ASDIGI                                   from this .HLB
         Calls: WBANK, WDROP, BKFRW, BLIST               from BOS77
                ITTOFE, ITXTLK,ITDAQ                     from this .HLB
                SORTZV, LOCATI                           from CERNLIB
   
     Work banks used:
     JDITWP  - dropped at end.
   
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   ASDIGI                                                                          
        |---- ITDIGI                                                               
                   |----  BDROP                               External             
                   |----  SORTZV                              External             
                   |----  ITDRFT                                                   
                   |----  WBANK                               External             
                   |----  ITTOFE                                                   
                   |----  ITXTLK                                                   
                   |----  ITDAQ                                                    
                   |----  ITPRDI                              External             
                   |----  IPRIJO                              External             
                   |----  FLOAT                               External             
                   |----  ABS                                 External             
                   |----  LOCATI                              External             
                   |----  MIN                                 External             
                   |----  LOCATF                              External             
                   |----  WDROP                               External             
   
 
3 ITDRFT
         SUBROUTINE ITDRFT(INDEX,I1,I3)
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   
     3.10  920213  14:18                         R.Beuselinck.
   
   Calculate the drift time due to a set of hits in a single cell.
     INDEX contains pointers to the 3rd word (wire no.) of each hit
     ordered by increasing wire number.
     I1 and I3 give the first and last indices in INDEX for hits in
     the current cell.
   
     Called by: ITDIGI                                 from this .HLB
         Calls: WBANK                                  from BOS77
                RNDM                                   from CERNLIB
   
     Named banks used:
     IHIT - read only.
     Work banks used:
     JDITWP - created at start of each event. Filled on each call.
   
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   ITDIGI                                                                          
        |---- ITDRFT                                                               
                   |----  WBANK                               External             
                   |----  INTCHA                              External             
                   |----  RNDM                                                     
                   |----  ABS                                 External             
                   |----  COS                                 External             
                   |----  ITRES                                                    
                   |----  ITDTIM                                                   
                   |----  WDROP                               External             
                   |----  ALTELL                              External             
   
 
3 ITDTGO
         SUBROUTINE ITDTGO
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   
     1.02  950804  13:48                        R.Beuselinck.
   
   Initialise drift time parameterisation.
   
     This routine creates a linear interpolation table for computing
     drift time from drift distance.  The table is created using a
     polynomial parameterisation of drift distance from drift time.
     This is the initialisation entry point for ITDTIM.
   
   
         ENTRY ITDTIM(LAY, D, T, OK)
   
     1.10  930812  13:37                           R.Beuselinck
   
     Compute drift time from drift distance.
   
     Arguments:
     LAY [S,I,INTE] : Layer number.
     D   [S,M,REAL] : Drift distance, .LE. max for layer on return (cm).
     T   [S,O,REAL] : Drift time (ns).
     OK  [S,O,LOGI] : .FALSE. if D is outside maximum tdc range.
   
     Compute the drift time using a linear interpolation table for the
     particular wire layer.
   
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   ITDCNS                                                                          
        |---- ITDTGO                                                               
                   |----  CELWIT                              External             
                   |----  ABS                                 External             
                   |----  MIN                                 External             
                   |----  RNDM                                                     
   
 
3 ITHIT
         SUBROUTINE ITHIT
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   
     2.00  900423  17:23                         R.Beuselinck.
   
   Compute the hits data for the itc.
   
     Called by: GUSTEP                                   from this .HLB
         Calls: ITNOIS, ITALIG, ITCROS                   from this .HLB
                AUARCM                                   from ALEPHLIB
                WBANK                                    from BOS77
                SORTZV                                   from CERNLIB
   
     Named banks used:
     IHIT    - created on 1st call for each event. Filled on each call.
   
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   GUSTEP                                                                          
        |---- ITHIT                                                                
                   |----  FBEGJO                              External             
                   |----  BDROP                               External             
                   |----  ALBOS                               External             
                   |----  ITNOIS                                                   
                   |----  NINT                                External             
                   |----  ITALIG                                                   
                   |----  ICITJO                              External             
                   |----  ISPLIN                                                   
                   |----  SQRT                                External             
                   |----  ABS                                 External             
                   |----  IRUCHK                                                   
                   |----  SORTZV                              External             
                   |----  ISPLIO                                                   
                   |----  CELWIT                              External             
                   |----  ATAN2                               External             
                   |----  AUARCM                              External             
                   |----  SIGN                                External             
                   |----  COS                                 External             
                   |----  SIN                                 External             
                   |----  IAPROX                                                   
                   |----  ACOS                                External             
   
 
3 ITIRUN
         SUBROUTINE ITIRUN
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   
     1.18  930721  18:08                        R.Beuselinck
   
   Initialise itc routines.
   
     Define formats for all banks used and set /ITNAMC/.
     Initialise ITC readout geometry and calibration from database.
   
     Called by: ASIPAC                                   from this .HLB
         Calls: ITWINI, ITDCNS, ITRGPA                   from this .HLB
                NAMIND, NLIST, BKFMT, BLIST              from BOS77
                ALTELL, ALGTDB                           from ALEPHLIB
   
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   ASIMOD                                                                          
        |---- ITIRUN                                                               
                   |----  ICITJO                              External             
                   |----  ALTELL                              External             
                   |----  NAMIND                              External             
                   |----  BKFMT                               External             
                   |----  GTSTUP                              External             
                   |----  NLIST                               External             
                   |----  ALGTDB                              External             
                   |----  ITWINI                                                   
                   |----  ITDCNS                                                   
                   |----  ITRGPA                                                   
                   |----  ITROTI                                                   
                   |----  ITPGEO                                                   
                   |----  IPRIJO                              External             
   
 
3 ITMSK1
         SUBROUTINE ITMSK1(MASI, IB16, LBUS)
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   
   1  1.00  860518  22:46                     R.Beuselinck
   
   Map the itc trigger segments onto the 18 bus-lines.
     This is the first stage in correlating the ITC trigger to the
     calorimeter trigger segments.
     To understand this routine you need to look at the curcuit diagram.
   
     Calling arguments:
     MASI - Array containing the results of the 48 ITC phi masks  (INPUT)
     IB16 - Word containing the 16 software controllable bits.    (INPUT)
     LBUS - Word containing the 18 bit bus-line mask.            (OUTPUT)
   
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   ITRPP                                                                           
        |---- ITMSK1                                                               
                   |----  IAND                                External             
                   |----  IOR                                 External             
   
 
3 ITMSK2
         SUBROUTINE ITMSK2(LBUS, NMEM, ICALS)
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   
   2  1.00  860520  20:33                        R.Beuselinck
   
   Map the 18 itc trigger bus-lines with the 8 bit memory address
     to produce the final 72 trigger bits corresponding to the
     calorimeter segments.
     To understand this routine you need to look at the schematic
     diagram of the ITC trigger.
   
     Calling arguments:
     LBUS  - word containing 18 significant low order bits,   (INPUT)
             produced by the first stage of the trigger.
     NMEM  - word containing 8 bits to gate the bus-lines     (INPUT)
             onto the 72 latches.
     ICALS - 3 words containing the 72 latch bits.     (INPUT+OUTPUT)
   
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   ITRPP                                                                           
        |---- ITMSK2                                                               
                   |----  BTEST                               External             
                   |----  IOR                                 External             
                   |----  IAND                                External             
   
 
3 ITNOIS
         SUBROUTINE ITNOIS
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   
     0.00  860401                              R.Beuselinck
   
   Generate random noise hits in the itc.
     This routine is not implemented yet.
   
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   ITASIG                                                                          
   ITHIT                                                                           
        |---- ITNOIS.                                                              
   
 
3 ITPGEO
         SUBROUTINE ITPGEO
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   
     1.11  930721  18:08                        R.Beuselinck
   
   Print itc read out geometry
   
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   ITIRUN                                                                          
        |---- ITPGEO                                                               
                   |----  ZRESIT                              External             
   
 
3 ITPHIM
         SUBROUTINE ITPHIM(NHIT,TMEXP,ITRGR,ITRGZ)
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   
     2.00  890417  13:34                       R.Beuselinck
   
   Fill the 192 itc trigger masks.
   
     The trigger pattern for one sector is stored in arrays IGRPA and
     INWA giving the first wire number used and the number of wires
     respectively for each of the 8 layers (this includes the half-cell
     overlapping patterns).
     The pattern of each sector repeats LPSCT times around the chamber.
   
     The digitisations are copied into an array with built in "wrap"
     to avoid complicating the algorithm.
   
     Calling arguments:
     NHIT  - Array of hit flag for each wire (=1 if hit).       (INPUT)
     TMEXP - Array of expanded time differences for each wire.  (INPUT)
     ITRGR - Array of trigger mask results (8-bit address)     (OUTPUT)
     ITRGZ - Array of theta bin numbers for Z-trigger result.  (OUTPUT)
   
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   ITRPP                                                                           
        |---- ITPHIM                                                               
                   |----  VZERO                               External             
                   |----  ITZCOI                                                   
   
 
3 ITRES
         SUBROUTINE ITRES(LAY, DIST, ANGLE)
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   
     3.00  930902  11:42                          R.Beuselinck
   
   Smear itc drift distance by parameterised resolution from irrf.
   
     LAY    [S,I,INTE] : layer number for current hit.
     DIST   [S,M,REAL] : distance of hit from sense wire.
     ANGLE  [S,I,REAL] : phi angle of line from sense wire to track
                         wrt cell.
   
     Subroutines called:
       RANNOR                                      - from CERN library.
   
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   ITDRFT                                                                          
        |---- ITRES                                                                
                   |----  COS                                 External             
                   |----  CELWIT                              External             
                   |----  RANNOR                              External             
   
 
3 ITRGPA
         SUBROUTINE ITRGPA
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   
   A  1.10  920213  10:33                        R.Beuselinck.
   
   Set up the itc trigger 256 bit address scheme for the allowed
     hit combinations.
   
     Each of the addresses (0 to 255) corresponds to an 8 bit pattern
     representing the layer which received a hit for the trigger mask
     being considered.  The addresses point to an array which contains
     a 1 for a valid layer combination or a 0 for an invalid one.
   
     The aim of this routine is to setup the 256 zero or one values
     according to the minimum trigger criteria:
       1) a minimum number of hit layers is required. (ITRPMN,ITZPMN)
       2) a minimum number of hits in layers 1-4
       3) a minimum number of hits in layers 5-8
   
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   ITIRUN                                                                          
        |---- ITRGPA                                                               
                   |----  ICITJO                              External             
                   |----  VZERO                               External             
                   |----  NAMIND                              External             
                   |----  UCOPY                               External             
                   |----  IBSET                               External             
                   |----  IBCLR                               External             
                   |----  BTEST                               External             
                   |----  IF                                  External             
   
 
3 ITROTI
         SUBROUTINE ITROTI
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   
     1.10  870922  14:47                     R.Beuselinck
   
   Initialise itc alignment constants.
   
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   ITIRUN                                                                          
        |---- ITROTI                                                               
                   |----  NAMIND                              External             
                   |----  COS                                 External             
                   |----  SIN                                 External             
   
 
3 ITRPP
         SUBROUTINE ITRPP(IWIRS,TIMES,IRPBT,IZPBT,ISPBT,IRPHM)
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   
     1.20  920213  13:22                        R.Beuselinck
   
   Simulate the itc r-phi and r-phi-z trigger processors.
   
     Calling arguments:
     IWIRS - Index of hit wires. (data part of work bank).      (INPUT)
     TIMES - Expanded time differences for 3D trigger.          (INPUT)
     IRPBT - 3 words containing the 72 R-phi trigger bits.     (OUTPUT)
     IZPBT - 3 words containing the 72 R-phi-Z trigger bits.   (OUTPUT)
     ISPBT - 1 word containing the 24 'special' trigger bits.  (OUTPUT)
     IRPHM - Array containing R-phi mask results for lev 3.    (OUTPUT)
   
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   ITDAQ                                                                           
        |---- ITRPP                                                                
                   |----  ITBINS                              External             
                   |----  ICITJO                              External             
                   |----  RNDM                                                     
                   |----  VZERO                               External             
                   |----  ITPHIM                                                   
                   |----  IBSET                               External             
                   |----  ITRSB                                                    
                   |----  ITMSK1                                                   
                   |----  ITMSK2                                                   
                   |----  BTEST                               External             
                   |----  MOD                                 External             
   
 
3 ITRSB
         SUBROUTINE ITRSB(NHIT,IMSK,ISPBT)
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   
   B  1.00  890707                                  J.Ratcliffe
   
   Evaluate itc special trigger bits.
   
     Calling arguments:
     NHIT  - Array of hit flag for each wire (=1 if hit).       (INPUT)
     IMSK  - Array of 192 R-Phi masks (=1 if positive).         (INPUT)
     ISPBT - 1 word containing the 24 'special' trigger bits.  (OUTPUT)
   
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   ITRPP                                                                           
        |---- ITRSB                                                                
                   |----  ICITJO                              External             
                   |----  IBSET                               External             
                   |----  VZERO                               External             
                   |----  MOD                                 External             
                   |----  IBITS                               External             
                   |----  MVBITS                              External             
   
 
3 ITSDIG
         SUBROUTINE ITSDIG(NWIRS,IWIR,TAB,IDAB)
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   
     2.10  900517  15:38                        R.Beuselinck.
   
   Calculate the digitised values of the itc data.
     Store the results in the work banks (indices are stored in ITNAMC)
     The BOS structure must not be modified by this routine or its
     descendants.
   
     Called by: ITDAQ                               from this .HLB
         Calls: ITTEXP                              from this .HLB
   
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   ITDAQ                                                                           
        |---- ITSDIG                                                               
                   |----  ITTEXP                                                   
   
 
3 ITTEXP
         SUBROUTINE ITTEXP(LAY,TAB,TPULS,IZDIG)
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   
     2.10  920213  19:18                       R.Beuselinck.
   
   Create time-expanded pulses.  return the output pulse time and
     the digitised value (Z-scalar).
   
     Called by: ITSDIG                            from this .HLB
   
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   ITSDIG                                                                          
        |---- ITTEXP                                                               
                   |----  ITZTDL                              External             
                   |----  ITZTDH                              External             
   
 
3 ITTOFE
         SUBROUTINE ITTOFE
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   
     2.00  920213  19:21                          R.Beuselinck
   
   Propagate induced wire signals to the preamps at either end of itc.
   
     Input:  IHIT, JDITWP banks.
     Output: JDITFN, JDITFP banks.
   
     JDITFN contains: Hit.Id, Wire.Id, End (+/-), pulse start time,
                    number of pulses in ITFP,
                    zero address of 1st pulse in ITFP.
   
     JDITFP contains: pulse height, pulse length.
   
     This version produces fixed length pulses only of unique height.
     The JDITFP bank allows for an arbitrary pulse shape to be recorded
     as a continuous series of rectangular pulses.
   
     Called by: ITDIGI, ISBEND                           from this .HLB
         Calls: WBANK, WDROP, BLIST, BKFRW               from BOS77
   
     Named banks used:
     IHIT   - read only.
     JDITWP - read only.
     JDITFN - created and filled
     JDITFP - created and filled
   
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   ITDIGI                                                                          
        |---- ITTOFE                                                               
                   |----  WBANK                               External             
                   |----  INTCHA                              External             
                   |----  ZRESIT                              External             
                   |----  RANNOR                              External             
                   |----  ABS                                 External             
                   |----  SIGN                                External             
                   |----  ISBEND                                                   
                   |----  ZLOFIT                              External             
                   |----  UCOPY                               External             
                   |----  WDROP                               External             
                   |----  ALTELL                              External             
   
 
3 ITWINI
         SUBROUTINE ITWINI
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   
     2.30  920213  19:31                         R.Beuselinck
   
   Initialise layout of itc and time expansion constants for readout.
   
     Called by: ITIRUN                                    from this .HLB
         Calls: ISBGIN                                    from this .HLB
                BLIST, NAMIND                             from BOS77
                ALTELL                                    from ALEPHLIB
   
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   ITIRUN                                                                          
        |---- ITWINI                                                               
                   |----  NAMIND                              External             
                   |----  ISBGIN                                                   
   
 
3 ITWSUM
         SUBROUTINE ITWSUM
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   
     1.00  880407  15:11                        R.Beuselinck
   
   Print run summary for itc.
   
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   ASCJOB                                                                          
        |---- ITWSUM.                                                              
   
 
3 ITXTLK
         SUBROUTINE ITXTLK
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   
     0.00  860401                               R.Beuselinck
   
   Generate cross-talk on itc readout channels.
     This routine is not implemented yet.
   
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   ITDIGI                                                                          
        |---- ITXTLK.                                                              
   
 
3 ITZCOI
         SUBROUTINE ITZCOI(NWZ,NHZ,TZM,IBIN)
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   
     1.00  860610  20:36                         R.Beuselinck
   
   Calculate the 3d trigger result for a single mask using the time
     difference values for the hit wires of the mask plus additional
     constraints on the allowed layer combinations for the correlated
     R-phi-Z trigger.
   
     If the trigger condition is satisfied then the theta bin number is
     returned in IBIN, otherwise zero is returned.
   
     Calling arguments:
     NWZ  - Total number of hit wires in the mask.              (INPUT)
     NHZ  - Number of hit wires in each layer (array).          (INPUT)
     TZM  - Time difference values (array of NWZ times).        (INPUT)
     IBIN - ITC theta bin number for success, or zero.         (OUTPUT)
   
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   ITPHIM                                                                          
        |---- ITZCOI                                                               
                   |----  ICITJO                              External             
                   |----  SORTZV                              External             
                   |----  VZERO                               External             
                   |----  IFIX                                External             
                   |----  ITBINT                                                   
   

2 LCAL

  >>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>
    CKEY 
     1st entry in LCAL set
     ! GALEPH 30.1
     There has been problems with the simulated Energy
     spectrum in Lcal for qqbar events. While the data spectrum
     falls smoothly with energy, the simulated spectrum has a
     strange 'shoulder' at about 3 GeV.
    
     Another complaint is that the energy in wireplanes
     in the MC look like discrete lines when plotted in
     fine bins of a few MeV.
    
     a) A new shower parametrization, used
        for the last Bhabha production, is incorporated.
        This makes better use of the results from Ecal testbeam
        at low energies where there was no Lcal testbeam.
        It also fluctuates some of the parameters, and reproduces
        better the longitudinal shower fluctuations seen in data.
    
        While this does not help on any of the above problems,
        it does make the EM showers a bit more realistic.
        The parameters of the new shower is given in a data-
        base bank LSHO, which I have submitted to Francoise.
        I have also changed the bank LECA 1 so that the energy
        is calibrated like data with 45.5 GeV electrons.
    
     b) The mysterious shoulder turns out to be a minimum ionising
        peak from hadrons that are tracked with GEANT through the
        volume. The energy deposited in each plane by the
        routine LCTRAK was way too high (typically 56 MeV).
        I have reduced it to 9.1 MeV (the min ionising energy
        in bank LSHO). This number may change a little after
        more studies.
    
     c) The energy is quantised in 40 MeV packages. This
        causes the right sampling fluctuations in EM showers
        and keeps down the computertime. This is why discrete
        lines are seen in the plots.
        The 40 MeV corresponds reasonably well to the zero
        suppression in the pads, but the wires are actually 16
        times more sensitive.
    
        Each "hit" in LCSHOW is weighed by a
        factor which is Poisson fluctuated around 16, and
        also multiplied the hit multiplicity in LCTRAK by 16.
        In LADC I divide again by 16. This way the wire energy
        is better reproduced - especially for min ionising
        tracks, and some smearing of the lines is provided.
    
     d) The end-of-job summary is changed so that it becomes
        meaningful.
    
     ! GALEPH 25.4
       LCIRUN : use ALGTDB instecd of MDARD to get bank depending on
                the setup code
    
  <<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<
     LCADC      Fills banks ltdi and lwdi
     LCAMP      Computes an amplifier number
     LCASIG     Controls the analog signal processing in lcal
     LCBHAB     Simulates the bhabha trigger
     LCBKPR 
     LCDIGI     Controls digitalisation in lcal
     LCFRAL     Track element coordinate tranformation
     LCHIT      Controls tracking in lcal
     LCIRUN     Initialise lcal constants
     LCNAMI     Prepare bos banks
     LCNOIS     Make noise in lcal
     LCPAD      Store energies in towers
     LCROC      Simulate read out controller
     LCSAMP     Find trigger sector (amplifier) for an lc tower
     LCSATU 
     LCSHOW     Shower parametrisation in lcal
     LCSTRT     Convert z-coordinate to plane no.
     LCTRAK     Control m.i.p. tracking in lcal
     LCTRDI     Convert trigger signals to mev
     LCTRHT     Sum up tower hits for triggering
     LCWIRE     Deposit energy in wire planes
     LCWSUM     Job summary for lcal
     LCWTRI     Make wire trigger bank
     LCXYPA     Convert coordinates into tower address
     LSCHIT     Deposit hit signal in lcal scintillator

3 LCADC
         SUBROUTINE LCADC
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Fills banks ltdi and lwdi
    - J.Dines Hansen & P.Hansen - 860417
                                  modified by F.Ranjard - 890317
                                  modified by P.H.Hansen -950202
    - Stores digitizations for LCal towers and wireplanes in MeV
    - Called by  LCDIGI                           from this .HLB
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   LCDIGI                                                                          
        |---- LCADC                                                                
                   |----  MOD                                 External             
                   |----  ALBOS                               External             
                   |----  BLIST                               External             
                   |----  LCNLAY                              External             
                   |----  FLOAT                               External             
                   |----  RNDM                                                     
                   |----  AMIN1                               External             
                   |----  SSTPLC                              External             
                   |----  NINT                                External             
                   |----  IPRIJO                              External             
                   |----  PRTABL                              External             
   
 
3 LCAMP
         INTEGER FUNCTION LCAMP(IX,IY)
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Computes an amplifier number
    - J.D.Hansen & P.Hansen - 862306
    - Gives summing amplifier number for pad IX,IY in quadrant 0
    - Called by   LCSAMP                          from this .HLB
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   LCSAMP                                                                          
        |---- LCAMP .                                                              
   
 
3 LCASIG
         SUBROUTINE LCASIG
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Controls the analog signal processing in lcal
    - J.Dines Hansen & P.Hansen - 860417
    - Called by  ASASIG                           from this .HLB
    - Calls      LCSATU                           from this .HLB
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   ASASIG                                                                          
        |---- LCASIG                                                               
                   |----  MOD                                 External             
                   |----  IPRIJO                              External             
                   |----  BDROP                               External             
                   |----  AUBPRS                              External             
                   |----  PRTABL                              External             
                   |----  CAFIHT                                                   
                   |----  LCSATU                                                   
                   |----  ALTELL                              External             
   
 
3 LCBHAB
         SUBROUTINE LCBHAB(LCBHA,EFORW,EBACK)
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Simulates the bhabha trigger
    Author   : J.D.Hansen & P.H.Hansen - 860604
    Modified : P.H.Hansen - 871001
   
      Input : 'LTTR'
      Output: LCBHA  = 0 ... No trigger
                     = 1 ... Trigger
              EFORW  = trigger energy in subdetector A
              EBACK  = trigger energy in subdetector B
              update 'LCWS'
   
    - Called by LCTRIG                            from this .HLB
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   LCDIGI                                                                          
        |---- LCBHAB                                                               
                   |----  FLOAT                               External             
   
 
3 LCBKPR
         SUBROUTINE LCBKPR
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   $ Print LCal banks
    - J.D.Hansen & P.Hansen - 860604
                              modified by F.Ranjard - 890317
    - Prints banks 'LWHT' 'LWDI' 'LTHT' 'LTDI' 'LTTR'
    -              'LWTR'  and 'LTTD'
    - Called by LCDIGI                            from this .HLB
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   LCDIGI                                                                          
        |---- LCBKPR                                                               
                   |----  MOD                                 External             
                   |----  LCNLAY                              External             
                   |----  WBANK                               External             
                   |----  MIN0                                External             
                   |----  WDROP                               External             
                   |----  NAMIND                              External             
   
 
3 LCDIGI
         SUBROUTINE LCDIGI
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Controls digitalisation in lcal
    - J.Dines Hansen & P.Hansen - 860417
    - Called by  ASDIGI                           from this .HLB
    - Calls      LCTRHT,LCADC,LCNOIS,LCROC,LCTRDI from this .HLB
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   ASDIGI                                                                          
        |---- LCDIGI                                                               
                   |----  LCTRHT                                                   
                   |----  LCADC                                                    
                   |----  LCTRDI                                                   
                   |----  LCNOIS                                                   
                   |----  ICLCJO                              External             
                   |----  LCROC                                                    
                   |----  AUBPRS                              External             
                   |----  LCBKPR                                                   
                   |----  LCBHAB                                                   
   
 
3 LCFRAL
         SUBROUTINE LCFRAL(IFB,MODU,XIN,XOUT,DXIN)
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Track element coordinate tranformation
    - J.Dines Hansen & P.Hansen - 860505
    - Mdified P.Hansen - 900415
    - Transform track element from global to subdetector frame
    - Input  : TRKELE
    - Output : MODU   = Module No. [1,4]
               IFB    = endcap #
    -          XIN    = xyz of track element TRKELE
    -          XOUT   = xyz of track element TRKNXT
    -          DXIN   = direction cosines of TRKELE
    - Called by  LCSHOW, LCTRAK                   from this .HLB
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   LCSHOW                                                                          
   LCTRAK                                                                          
   LSCHIT                                                                          
        |---- LCFRAL                                                               
                   |----  XYZOLC                              External             
                   |----  SIGN                                External             
   
 
3 LCHIT
         SUBROUTINE LCHIT
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Controls tracking in lcal
    - J.Dines Hansen & P.Hansen - 860417
                                  modified by F.Ranjard - 890317
    - Called by   GUSTEP                          from this .HLB
    - Calls       LCSHOW, LCTRAK                  from this .HLB
                  BLIST                           from BOS
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   GUSTEP                                                                          
        |---- LCHIT                                                                
                   |----  FBEGJO                              External             
                   |----  BDROP                               External             
                   |----  ALBOS                               External             
                   |----  BLIST                               External             
                   |----  IPRIJO                              External             
                   |----  MAX0                                External             
                   |----  ICLCJO                              External             
                   |----  CATINO                                                   
                   |----  LCSHOW                                                   
                   |----  LCTRAK                                                   
   
 
3 LCIRUN
         SUBROUTINE LCIRUN
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Initialise lcal constants
    Author   : J.Dines Hansen & P.Hansen - 860417
    Modified : P.Hansen - 891120
    Modified : P.Hansen - 950202
    Modified : P.Hansen - 970315
    Description :
    =============
      Fills /LCCOMC/ and /LCCOMD/ from data base
    Modified : B.Bloch-Devaux - 920215 to access LALI via GTSTUP
    Modified : B.Bloch-Devaux - 980112 to access LCAL via GTSTUP
      BOS bank initialisation
      Called by  USIJOB                          from this  .HLB
      Calls      LCNAMI                          from this  .HLB
                 NAMIND,BKFMT                    from BOS
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   ASIMOD                                                                          
        |---- LCIRUN                                                               
                   |----  ICLCJO                              External             
                   |----  LCNAMI                                                   
                   |----  ALGTDB                              External             
                   |----  GTSTUP                              External             
                   |----  BLIST                               External             
                   |----  NINT                                External             
                   |----  FLOAT                               External             
                   |----  IDETJO                              External             
                   |----  NAMIND                              External             
                   |----  BKFMT                               External             
                   |----  ALBOS                               External             
   
 
3 LCNAMI
         SUBROUTINE LCNAMI
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Prepare bos banks
    Author     : P.Hansen & J. Dines Hansen 860801
    Modified   : P.Hansen 870920
    Desciption :
    ============
    Set name-indices for LCal BOS banks
    Set printing formats
   
    - called from LCIRUN                          from this .HLB
    - calls       NAMIND,BKFMT                    from BOS
   
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   LCIRUN                                                                          
        |---- LCNAMI                                                               
                   |----  NAMIND                              External             
                   |----  BKFMT                               External             
   
 
3 LCNOIS
         SUBROUTINE LCNOIS
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Make noise in lcal
    - J.Dines Hansen & P.Hansen - 860417
      Modified P.Hansen - 890429
    - Coherent and incoherent noise in towers and wire-planes
      Adds coherent and incoherent noise in towers and wires
      Adds also extra smearing to DEtot/Etot from sampling fluct
      Note that no noise is added to wireplanes in modules
      that contains no energy to start with.
    - Modifies banks LTDI, LWDI and LTTR
    - Called by  LCDIGI                           from this .HLB
    - Calls      LCPAD                            from this .HLB
    -            LCAMP                            from this .HLB
    -            RANNOR                           from   CERNLIB
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   LCDIGI                                                                          
        |---- LCNOIS                                                               
                   |----  RANNOR                              External             
                   |----  LCNLAY                              External             
                   |----  NINT                                External             
                   |----  FLOAT                               External             
                   |----  WNOILC                              External             
                   |----  SNOILC                              External             
                   |----  TNOILC                              External             
                   |----  MAX0                                External             
   
 
3 LCPAD
         SUBROUTINE LCPAD(NAMI,ISTOR,IPAD,NHIT)
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Store energies in towers
    - J.Dines Hansen & P.Hansen - 860417
    - Store energy deposition on pads in banks LTHT or LTDI
    - Input : NAMI   = name-index of bank
              ISTOR  = storey number
              IPAD   = tower address
              NHIT   = number of hits to be stored
    - Called by  LCSHOW, LCTRAK                   from this .HLB
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
              LCPAD                                                                
                   |----  CHAINT                              External             
                   |----  ALBOS                               External             
   
 
3 LCROC
         SUBROUTINE LCROC
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Simulate read out controller
    - J.Dines Hansen & P.Hansen - 860604
    - Zero suppression and range saturation
    - Modify banks 'LTDI'
    - Called by  LCDIGI                           from this .HLB
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   LCDIGI                                                                          
        |---- LCROC                                                                
                   |----  NINT                                External             
                   |----  MIN0                                External             
   
 
3 LCSAMP
         INTEGER FUNCTION LCSAMP(IPAD)
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Find trigger sector (amplifier) for an lc tower
    - J.D.Hansen & P.Hansen - 860301
    - modified : P.H.Hansen - 881101
    - IN : IPAD = Tower addr.[ICOL + 16*(IROW-1) + 512*(MODU-1)]
    - OUT: LCSAMP  = Amplifier No. [1,24]
           New numbering scheme (881101):
                         X   ^ Y
             15 16        \  |           3  4
           14     17       \ |         2      5
          13       18       \|        1        6
     ------------    -------------------------    ------->Z
          24       19        |\       12       7
           23    20          | \       11     8
             22 21           |  \        10 9
    - Called by  LCTRHT                           from this .HLB
    - Calls      LCAMP                            from this .HLB
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   LCTRHT                                                                          
        |---- LCSAMP                                                               
                   |----  MOD                                 External             
                   |----  LCAMP                                                    
   
 
3 LCSATU
         SUBROUTINE LCSATU
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
    - J.Dines Hansen & P.Hansen - 860417
    - Saturation in luminosity calorimeter
    - Modifies banks LTHT and LWHT
    - Called by  LCASIG                           from this .HLB
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   LCASIG                                                                          
        |---- LCSATU.                                                              
   
 
3 LCSHOW
         SUBROUTINE LCSHOW
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Shower parametrisation in lcal
    - J.Dines Hansen & P.Hansen - 860417
                                  modified by F.Ranjard - 890317
                                  modified by P.Hansen -  940701
    - Sets GEANT stop flag
      ********************New for 94****************************
    - Use longitudinal parametrization:
        dN/dS   = (ETOT/ECRTLC)*B*(B*S)**(A-1)*exp(-B*S)/gamma(A)
    - The P-terms are from fit to Lcal data,
    - the DP-terms from Ecal test beam fit:
         A/B    = PAR1LC + DPR1LC*alog(E)
         1/B    = PAR2LC + DPR2LC*alog(E)    for E>0.1GeV
         A/B    = PAR3LC + DPR3LC*alog(E)
         1/B    = PAR4LC + DPR4LC*alog(E)    for E<0.1GeV
    - Use lateral parametrization:           R in cm
        d(dN/dS)/dR = (dN/dS)*exp(-R/R0)/R0
            R0      = PAR5LC + DPR5LC*S*B/A
    - PAR1LC is fluctuated by the relative amount PAR6LC
    - PAR2LC is fluctuated by the relative amount PAR8LC
    - However, these fluctuations are limited to 4sigma
      to avoid division by zero and gamma(zero). (PH 970320)
    - R0     is fluctuated by the relative amount PAR7LC
    for 96****************************
                                  modified my.M.N.Minard - 960527
      introduce geantino parametrisation.
   
    - Called by  LCHIT                            from this .HLB
    - Calls      LCSTRT, LCFRAL, LCXYPA, CAHIST   from this .HLB
                 RNDM                             from   CERNLIB
                 POISSN                           from    GENSEC
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   LCHIT                                                                           
        |---- LCSHOW                                                               
                   |----  NLINK                               External             
                   |----  ALTELL                              External             
                   |----  CHAINT                              External             
                   |----  ALOG                                External             
                   |----  RANNOR                              External             
                   |----  AMIN1                               External             
                   |----  AMAX1                               External             
                   |----  CAPSTO                                                   
                   |----  LCFRAL                                                   
                   |----  INT                                 External             
                   |----  LCSTRT                                                   
                   |----  ABS                                 External             
                   |----  SSTPLC                              External             
                   |----  GAMMA                               External             
                   |----  ZSTPLC                              External             
                   |----  NAMIND                              External             
                   |----  LCNLAY                              External             
                   |----  EXP                                 External             
                   |----  POISSN                              External             
                   |----  RNDM                                                     
                   |----  COS                                 External             
                   |----  SIN                                 External             
                   |----  LCXYPA                                                   
                   |----  CAHIST                                                   
   
 
3 LCSTRT
         SUBROUTINE LCSTRT(ZABS,ISTMN,LAYMN,LMIN,ZWIRE)
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Convert z-coordinate to plane no.
    - J.Dines Hansen & P.Hansen - 860513
    - Finds first storey and layer for track/shower
    - Called by LCSHOW, LCTRAK                    from this .HLB
    - Input:  ZABS   = z-distance from entrance
    - Output:
              ISTMN =  storey no. [1,3]
              LAYMN =  layer no.  [1,38]
              LMIN  =  layer no. within the storey
              ZWIRE =  Z of preceeding wire-plane
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   LCSHOW                                                                          
   LCTRAK                                                                          
        |---- LCSTRT                                                               
                   |----  Z123LC                              External             
                   |----  LCNLAY                              External             
                   |----  ZSTPLC                              External             
   
 
3 LCTRAK
         SUBROUTINE LCTRAK
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Control m.i.p. tracking in lcal
    - J.Dines Hansen & P.Hansen - 860417
                                  modified by F.Ranjard - 890317
    - Called by  LCHIT                            from this .HLB
    - Calls      LCSTRT, LCFRAL, LCXYPA, CAHIST   from this .HLB
                 POISSN,VSUB                      from   CERNLIB
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   LCHIT                                                                           
        |---- LCTRAK                                                               
                   |----  LCFRAL                                                   
                   |----  LCSTRT                                                   
                   |----  ABS                                 External             
                   |----  ZSTPLC                              External             
                   |----  EBETHE                                                   
                   |----  AMIN1                               External             
                   |----  LCNLAY                              External             
                   |----  AMAX1                               External             
                   |----  POISSN                              External             
                   |----  LCXYPA                                                   
                   |----  CAHIST                                                   
   
 
3 LCTRDI
         SUBROUTINE LCTRDI
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Convert trigger signals to mev
    - J.Dines Hansen & P.Hansen - 860417
    - Modified P.Hansen - 950202
    - Modifies bank LTTR, fills bank LWTR
    - Called by  LCDIGI                           from this .HLB
    - Calls LCWTRI                                from this .HLB
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   LCDIGI                                                                          
        |---- LCTRDI                                                               
                   |----  NINT                                External             
                   |----  CHTOE                               External             
                   |----  LCWTRIRETURN                        External             
   
 
3 LCTRHT
         SUBROUTINE LCTRHT
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Sum up tower hits for triggering
    - J.Dines Hansen & P.Hansen - 860417
                                  modified by F.Ranjard - 890210
    - Fills bank LTTR
    - Called by  LCDIGI                           from this .HLB
    - Calls      LCSAMP                           from this .HLB
                 BLIST                            from BOS
                 VADD                             from CERNLIB
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   LCDIGI                                                                          
        |---- LCTRHT                                                               
                   |----  MOD                                 External             
                   |----  ALBOS                               External             
                   |----  BLIST                               External             
                   |----  LCSAMP                                                   
   
 
3 LCWIRE
         SUBROUTINE LCWIRE(MODU,LAY,NHIT)
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Deposit energy in wire planes
    - J.Dines Hansen & P.Hansen - 860417
    - Fills bank LWHT
    - Input : MODU   = Module No.             [1,4]
    -         LAY    = Layer No.         [1,LCNWPL]
    -         NHIT   = Number of hits in this layer
    - Called by  LCSHOW,LCTRAK                    from this .HLB
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
              LCWIRE.                                                              
   
 
3 LCWSUM
         SUBROUTINE LCWSUM
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Job summary for lcal
    - J.Dines Hansen & P.Hansen - 860417
    - Modified P.Hansen - 950202
    - Called by  ASCRUN                           from this .HLB
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   ASCJOB                                                                          
        |---- LCWSUM                                                               
                   |----  FLOAT                               External             
   
 
3 LCWTRI
         SUBROUTINE LCWTRI
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Make wire trigger bank
    - J.Dines Hansen & P.Hansen - 861001
    - Modified P.Hansen - 950202
    - Fill bank 'LWTR' with the sum of odd and even wire-planes
    - called by LCTRDI                           from this .HLB
    - calls     BLIST                            from BOS
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
              LCWTRI                                                               
                   |----  ALBOS                               External             
                   |----  BLIST                               External             
                   |----  MOD                                 External             
                   |----  IPRIJO                              External             
                   |----  PRTABL                              External             
   
 
3 LCXYPA
         SUBROUTINE LCXYPA(MODU,LAY,XYZ,IPAD)
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Convert coordinates into tower address
      Author   : J.Dines Hansen & P.Hansen - 860301
      Modified : P.Hansen - 870920
   
    - INPUT : LAY      = Layer No.               [1,38]
              MODU     = Module No.              [1,4]
              XYZ(3)   = subcomponent coordinates
    - OUTPUT: IPAD     = Addr. (ICOL + 16*(IROW-1) + 512*(MODU-1))
                         (0 if XYZ is outside the active volume)
                         -1 if XYZ is outside the pads but inside
                          the wires)
   
    - Called by  LCSHOW                          from this .HLB
         SAVE
         DIMENSION XYZ(*)
    jqcom
   
         COMMON /NAMCOM/   NARUNH, NAPART, NAEVEH, NAVERT, NAKINE, NAKRUN
        &                 ,NAKEVH, NAIMPA, NAASEV, NARUNE, NAKLIN, NARUNR
        &                 ,NAKVOL, NAVOLU
         EQUIVALENCE (NAPAR,NAPART)
   
     Standard name-index definition
   
         NAxxxx                  name-index of bank 'xxxx'
                                 index of bank 'xxxx' is Kxxxx = IW(NAxxxx)
                                 NAxxxx are set to 0 in ASINIT and defined at
                                 booking time.
   
    iocom
         PARAMETER (LFIL=6)
         COMMON /IOCOM/   LGETIO,LSAVIO,LGRAIO,LRDBIO,LINPIO,LOUTIO
         DIMENSION LUNIIO(LFIL)
         EQUIVALENCE (LUNIIO(1),LGETIO)
         COMMON /IOKAR/   TFILIO(LFIL),TFORIO(LFIL)
         CHARACTER TFILIO*60, TFORIO*4
   
                        Logical unit definitions
   
         LFIL               number of logical units
         LGETIO             input data file logical unit   (def=1)
         LSAVIO             output data file logical unit  (def=2)
         LGRAIO             graphics logical unit          (def=3)
         LRDBIO             relationnal data base logical unit  (def=4)
         LINPIO             input data card logical unit   (def=5)
         LOUTIO             print out logical unit         (def=6)
         LUNIIO (1-lfil)    equivalent to LGETIO --- LOUTIO
         TFILIO (1-lfil)    name of the file assigned to LUNIIO (1-lfil)
         TFORIO (1-lfil)    file format : 'EPIO' or 'DAIO' or ' '
                                           ' ' means nativ format
   
   
    ljjpar
   
   
   
   
   
   
   
   
   
   
   
   
   
    lcnamc
         COMMON /LCNAMC/ NALTHT, NALTDI, NALWHT, NALWDI, NALTTR, NALWTR,
        *                NALWHI, NALSHI, NALCWS, NALCAL, NALLAY, NALMTY,
        *                NALALI, NALSCO, NALSLO, NALWRG, NALCEL, NALCSH,
        *                NALDRE, NALCCA, NALCPG, NALSHO
    lccomc
         COMMON /LCCOMC/ ADCOLC,    COHNLC,    DPR1LC,    DPR2LC,
        *                DPR3LC,    DPR4LC,    DPR5LC,    ECRTLC,
        *                ECUTLC,    EELALC,    GVARLC,    LCADCO,
        *                LCBHTR,    LCHBOK,    LCNLAY(3), LCNWPL,
        *                LCMATE(2), LCPRNT,    LCSTRH(3), CHTOE(3),
        *                PAR1LC,    PAR2LC,    PAR3LC,    PAR4LC,
        *                PAR5LC,    PAR6LC,    PAR7LC,    PAR8LC,
        *                RADLLC(2), SNOILC(3), SCONLC,    SSAMLC,
        *                SSTPLC(3), TNOILC(3), WNOILC(3),
        *                ZMATLC(2), ZREFLC(3), ZSTPLC(3), Z123LC(3),
        *                XYZOLC(3,2),DWIRLC
   
       The common /LCCOMC/ contains constants to be used in the
       LCAL set of subroutines
       ADCOLC    = MeV per ADC-count (LCIRUN)
       COHNLC    = coherent noise level (LCNOIS)
       DPR1-5LC  = parameters in the shower devellopment (LCSHOW)
       GVARLC    = gainvariation parameter (LCGAIN)
       ECRTLC    = parameter in the shower devellopment (LCSHOW)
       ECUTLC    = energies below are deposited at shower peak
                   (LCSHOW)
       EELALC    = parameter in hit-probability (LCTRAK)
       LCADCO    = ADCOLC
       LCBHTR    = trigger threshold for Bhabha-triggers (LCBHAB)
       LCNLAY(3) = number of planes in each storey
       LCNWPL    = total number of planes
       LCMATE(2) = pointer to materials in storeyes
       LCPRNT    = print flag
       LCSTRH(3) = storey treshold for readout (LCNOIS,LCROC)
       CHTOE(3) = hit to energy conversion factors
       PAR1-8LC  = parameters in the shower devellopment (LCSHOW)
       RADLLC(2) = radiation lengths of light and heavy materials
       SNOILC(3) = incoherent noise level per tower in each storey
                   (LCNOIS)
       SCONLC    = Constant term to be added to the energy fluctuations
                   DE/E that are already there from the sampling algo
       SSAMLC    = Extra term SSAMPL/sqrt(E) to be added to the
                   DE/E that are already there from the sampling algo
       SSTPLC(3) = step length in radians length in each storey
       TNOILC(3) = incoherent noise per trigger segment
                   in each storey (LCNOIS)
       WNOILC(3) = incoherent noise level in wireplanes
       ZMATLC(2) = average atomic number of light and heavy material
       ZREFLC(3) = reference z-value for clusters in each storey
       ZSTPLC(3) = steplength in cm in each storey
       Z123LC(3) = length of each storey in cm
       XYZOLC(3,2) origin of endcap at start of the sensitive area
       DWIRLC    = Z-distance from wire-plane to end-of-layer
   
    lccomd
         COMMON /LCCOMD/ XLSUP(2,2),XHSUP(2,2),YSUP(2,2),
        *                Y0CUT,DYCUT,Y5CUT,DY1,DY3,HUNIT
   
       The common /LCCOMD/ contains constants
       describing dead space in the LCAL average material
       XLSUP(I,J) = Low X end of wire support J (I=even,odd plane)
       XHSUP(I,J) = High X end of wire support J (I=even,odd plane)
       YSUP(I,J)  = Y position of wire support J (I=even,odd plane)
       Y0CUT      = Y intercept of inclined cathode boundary
       DYCUT      = Slope of inclined cathode boundary
       Y5CUT      = Low Y boundary at tube 5
       DY1        = Dead distance from extrusion end
       DY3        = Dead distance from center of wire supports
       HUNIT      = Half the interpad space
   
   
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   LCSHOW                                                                          
   LCTRAK                                                                          
        |---- LCXYPA                                                               
                   |----  ABS                                 External             
                   |----  MOD                                 External             
                   |----  FLOAT                               External             
                   |----  MIN0                                External             
                   |----  INT                                 External             
                   |----  MAX0                                External             
   
 
3 LSCHIT
         SUBROUTINE LSCHIT
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Deposit hit signal in lcal scintillator
    The trackelement is not stopped
    - P.Hansen - 970301
      Modified - P. Hansen 980301
    - Called by  GUSTEP
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   GUSTEP                                                                          
        |---- LSCHIT                                                               
                   |----  NAMIND                              External             
                   |----  EXP                                 External             
                   |----  BKFMT                               External             
                   |----  LCFRAL                                                   
                   |----  ABS                                 External             
                   |----  POISSN                              External             
                   |----  FLOAT                               External             
                   |----  RANNOR                              External             
                   |----  SQRT                                External             
                   |----  NINT                                External             
                   |----  MIN                                 External             
                   |----  ALBOS                               External             
                   |----  BLIST                               External             
   

2 MUON

  >>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>
    CKEY 
     1st entry into MUON set
  <<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<
     MUASIG 
     MUBOOK 
     MUDGTZ 
     MUDIGI 
     MUFILL     Fill histograms for muon
     MUFLDI     Routine to fill a digit into bos bank 'mudg'
     MUFLDT 
     MUFLHT 
     MUFLTD     Make cross reference between digit and tracks,
     MUGETC     Get the constants needed by the process "create mu signals"
     MUHIT      Deal with a track element that enters
     MUINCB     Transforms barrel slot and strip nb. to astros and bus nb.
     MUINCE     Transforms endcap slot and strip nb. to astros and bus nb.
     MUINCM     Transforms m.angle slot and strip nb. to astros and bus nb.
     MUIRUN 
     MUNSTA     Finds the address of a module in the geometric bos
     MUSGNL     Induce signals on strips by streamers.
     MUSMFR     Deal with track segments produced by a track element
     MUSPMD     Find if the track element is in a special module
     MUSTRM     Create normal streamers for a track element
     MUSTSG     Calculate segments of a track element in active
     MUTRSF     Tranformate the track element to the local system
     MUUNOI     Add track-unrelated noise to bos bank 'muht'.
     MUWSUM     Print general statistics of muon

3 MUASIG
         SUBROUTINE MUASIG
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   - F.Ranjard - 860626
   - End of tracking : reduce size of named banks
   - Called by   ASPEVE                              from this .HLB
                 AUBPRS                              from this .HLB
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   ASASIG                                                                          
        |---- MUASIG                                                               
                   |----  AUBPRS                              External             
                   |----  IPRIJO                              External             
                   |----  MUPRHT                              External             
   
 
3 MUBOOK
         SUBROUTINE MUBOOK
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   
    -860808
         Subroutine to book histograms of MUON
         if FHISJO(8) .EQ. .TRUE.
         Called from MUIRUN        in this .HLB
         Calls       HBOOK1        in HBOOK
   
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   ASBOOK                                                                          
        |---- MUBOOK                                                               
                   |----  HBOOK1                              External             
   
 
3 MUDGTZ
         SUBROUTINE MUDGTZ
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   
    -860112
             - modified for final dbase
               by A. Antonelli, F. Bossi 1 July 89
         Routine to digitize all signals ( track signals
         and track uncorrelated noises) and fill digitization
         information in BOS bank 'MUDG', fill digi-track cross reference
         information in BOS bank 'MUDT' and 'MUTD'.
         Called by MUDIGI
         Calls ALBOS,MUFIDI,MUFLDT,MUFLTD       in this .HLB
         Calls BKFMT,BLIST                      in BOS
         Calls SORTZV                           in CERNLIB
   
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   MUDIGI                                                                          
        |---- MUDGTZ                                                               
                   |----  ALTELL                              External             
                   |----  ALBOS                               External             
                   |----  BLIST                               External             
                   |----  WDROP                               External             
                   |----  WBANK                               External             
                   |----  INTCHA                              External             
                   |----  SORTZV                              External             
                   |----  MUFLDI                                                   
                   |----  MUFLDT                                                   
   
 
3 MUDIGI
         SUBROUTINE MUDIGI
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   
    -860112
         Routine to generate MU digitizing information.
         Track uncorreleted noises are generated in subroutine MUUNOI
         that is called once per event.
         Called by ASDIGI
         CALLS     MUUNOI, MUDGTZ      in this .HLB
                   AUBPRS              in this .HLB
   
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   ASDIGI                                                                          
        |---- MUDIGI                                                               
                   |----  BDROP                               External             
                   |----  MUUNOI                                                   
                   |----  ICMUJO                              External             
                   |----  MUDGTZ                                                   
                   |----  AUBPRS                              External             
                   |----  MUFILL                                                   
                   |----  FHISJO                              External             
                   |----  MAX                                 External             
                   |----  IPRIJO                              External             
                   |----  MUPRDI                              External             
   
 
3 MUFILL
         SUBROUTINE MUFILL
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   
    -860808
   Fill histograms for muon
         Called from MUDIGI            in this .HLB
         Calls       HFILL             in      HBOOK
   
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   MUDIGI                                                                          
        |---- MUFILL                                                               
                   |----  FLOAT                               External             
                   |----  HFILL                               External             
                   |----  CBYT                                External             
   
 
3 MUFLDI
         SUBROUTINE MUFLDI(IEMD,IBUS,LCLST,ILAST)
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   
    -860117
             - modified for final dbase
               by A. Antonelli, F. Bossi 1 July 89
   Routine to fill a digit into bos bank 'mudg'
         Input:
           IEMD  -- Atros number of the current digit
           IBUS  -- Bus number of the current digit (0-25)
           LCLST -- the length of cluster of the current digit
           ILAST -- the last address of the cluster of the current digit (0-...)
         Output:
           in BOS bank 'MUDG'
         Called by MUDGTZ
         Calls ALBOS         in this .HLB
   
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   MUDGTZ                                                                          
        |---- MUFLDI                                                               
                   |----  MVBITS                              External             
   
 
3 MUFLDT
         SUBROUTINE MUFLDT (NDIGI,NHTCL,IADHT)
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   
    -860117
         Routine to fill a digit-track reference of one digit
         to BOS bank 'MUDT'
         Input:
           NDIGI -- the current # of digits
           NHTCL -- the # of hits that contribute to the current digit(cluster)
           IADHT -- array to contain the addresses of NHTCL hits in 'MUHT'
         Output:
           in BOS bank 'MUDT'
           RETURN 1 if not enough space to enlarge MUDT-3
         Called by MUDGTZ
         Calls ALBOS            in this .HLB
   
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   MUDGTZ                                                                          
        |---- MUFLDT                                                               
                   |----  ALBOS                               External             
   
 
3 MUFLHT
         SUBROUTINE MUFLHT (JPLAN,IS,NS)
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   
    -860108
             - modified for final dbase
               by A. Antonelli, F. Bossi 1 July 89
         Routine to fill a induced strip signal into BOS bank 'MUHT'
         Input:
           JPLAN -- the tube plane where the signal is ( 1 or 2 );
           IS    -- the index of X- or Y- strip;
                  1 -- X
                  2 -- Y
           NS    -- the strip number in the current strip plane;
         Output:
           Elements in BOS bank 'MUHT'
           RETURN 1 if not enough space to enlarge MUHT
         Called by MUSGNL
         Calls ALBOS               in this .HLB
   
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   MUSGNL                                                                          
        |---- MUFLHT                                                               
                   |----  ALBOS                               External             
   
 
3 MUFLTD
         SUBROUTINE MUFLTD
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   
    -860118
   Make cross reference between digit and tracks,
         then fill BOS bank 'MUTD'.
         This routine is called once per event.
         Input:
           NDIGI -- the current # of digi in BOS bank 'MUDG' and 'MUDT'
         Output:
           NTRK  -- # of tracks which generate these digi
         RETURN 1 if not enough space to book MUTD
         Called by MUDGTZ
         Calls ALBOS                   in this .HLB
         Calls BKFMT,BLIST             in BOS
   
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
              MUFLTD                                                               
                   |----  ALBOS                               External             
                   |----  BLIST                               External             
                   |----  ALTELL                              External             
   
 
3 MUGETC
         SUBROUTINE MUGETC
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   
    -851216
               modified for DAF and new bank layout
               by F.Bossi,D.Kuhn,R.Xu 87-09-19
             - modified for final dbase
               by A. Antonelli, F. Bossi 1 July 89
   Get the constants needed by the process "create mu signals"
          from BOS bank 'M*RD' and to fill them in common
         block /MUGNCN/ and /MUSGCN/.
         Common block /MUGNCN/ keeps the general information of muon
         detector and is filled only once, common block /MUSGCN/
         keeps the information of the volume in which the current
         track element is.
         Called by MUHIT
         Calls     MUNSTA              in this .HLB
   
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   MUHIT                                                                           
        |---- MUGETC                                                               
                   |----  CHAHOL                              External             
                   |----  MUNSTA                                                   
                   |----  FLOAT                               External             
                   |----  MOD                                 External             
   
 
3 MUHIT
         SUBROUTINE MUHIT
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   
    - 851211
   Deal with a track element that enters
         a sensitive volume of MU, it corresponds to
         the process 'Create MU Signals' in DFD 4.4.3.
         Called by GUSTEP
         Calls     MUGETC, MUSTRM, MUSGNL    in this .HLB
   
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   GUSTEP                                                                          
        |---- MUHIT                                                                
                   |----  FBEGJO                              External             
                   |----  BDROP                               External             
                   |----  MUGETC                                                   
                   |----  MUSTRM                                                   
                   |----  MUSGNL                                                   
                   |----  WDROP                               External             
   
 
3 MUINCB
         SUBROUTINE MUINCB(ISLOT,IPLANE,NSTRPF,NAST,NBUS,NSTRPB,IFLAG)
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Transforms barrel slot and strip nb. to astros and bus nb.
    Author :   A. Antonelli, F. Bossi 1 July 89
     -Called by MUDGTZ                  from this .HLB
     -Calls none
   
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
              MUINCB                                                               
                   |----  MOD                                 External             
   
 
3 MUINCE
         SUBROUTINE MUINCE(NSLOT,IPLANE,NSTRPF,NAST,NBUS,NSTRPB,IFLAG)
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Transforms endcap slot and strip nb. to astros and bus nb.
    Author :   A. Antonelli, F. Bossi 1 July 89
     -Called by MUDGTZ                  from this .HLB
     -Calls none
   
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
              MUINCE                                                               
                   |----  MOD                                 External             
   
 
3 MUINCM
         SUBROUTINE MUINCM(NSLOT,IPLANE,NSTRPF,NAST,NBUS,NSTRPB,IFLAG)
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Transforms m.angle slot and strip nb. to astros and bus nb.
    Author :   A. Antonelli, F. Bossi 1 July 89
     -Called by MUDGTZ                  from this .HLB
     -Calls none
   
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
              MUINCM                                                               
                   |----  MOD                                 External             
   
 
3 MUIRUN
         SUBROUTINE MUIRUN
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   - F.Ranjard - 860624
               modified for DAF and new bank layout
               by F.Bossi,D.Kuhn,R.Xu 87-09-05
             - modified for final dbase
               by A. Antonelli, F. Bossi 1 July 89
   - Initialize MUON BOS banks and MUON common blocks
   - Called from   ASIPAC                      from this .HLB
   - Calls         NAMIND, BKFMT               from BOS77 lib
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   ASIMOD                                                                          
        |---- MUIRUN                                                               
                   |----  IDETJO                              External             
                   |----  NAMIND                              External             
                   |----  BKFMT                               External             
                   |----  ALGTDB                              External             
                   |----  ALTELL                              External             
                   |----  VZERO                               External             
   
 
3 MUNSTA
         FUNCTION MUNSTA(NSLOT,TMUCVO,TMU3VO)
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   
    -860422
   Finds the address of a module in the geometric bos
         bank by means of the slot number, the name of the current volume
         and the name of the third level volume.
         Called by MUGETC
   
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   MUGETC                                                                          
   MUSPMD                                                                          
   MUSTSG                                                                          
        |---- MUNSTA.                                                              
   
 
3 MUSGNL
         SUBROUTINE MUSGNL
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   
    -860108
   Induce signals on strips by streamers.
         Called by MUHIT
         Calls ALBOS,MUFLHT                    in this .HLB
               BLIST                           in BOS
   
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   MUHIT                                                                           
        |---- MUSGNL                                                               
                   |----  FHISJO                              External             
                   |----  HFILL                               External             
                   |----  ALBOS                               External             
                   |----  BLIST                               External             
                   |----  RNDM                                                     
                   |----  SNSXMU                              External             
                   |----  MUFLHT                                                   
                   |----  SNSYMU                              External             
   
 
3 MUSMFR
         SUBROUTINE MUSMFR
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   
    -851216
   Deal with track segments produced by a track element
         in a simple way :
           (1) check if a part of the segment is cross a spacer and
               if so then devide it into two pieces or throw it away;
           (2) check if the length of the segment is greater than
               SGLSMU;
           (3) make a random decision of producing a streamer with
               firing efficiency PSCRMU.
         Output:
            fire flag in BOS bank, in some case more track segments
            are added
         Called by MUSTRM
         Calls ALBOS                     in this .HLB
   
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
              MUSMFR                                                               
                   |----  SQRT                                External             
                   |----  RNDM                                                     
                   |----  WBANK                               External             
                   |----  ALTELL                              External             
   
 
3 MUSPMD
         SUBROUTINE MUSPMD(XLOC,IOUFG)
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   
    - 860728
               modified for DAF and new bank layout
               by F.Bossi,D.Kuhn,R.Xu 87-09-28
             - modified for final dbase
               by A. Antonelli, F. Bossi 1 July 89
   Find if the track element is in a special module
       and change the geometric and readout constants.
       Called by MUSTRM        in this .HLB
   
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   MUSTRM                                                                          
        |---- MUSPMD                                                               
                   |----  ABS                                 External             
                   |----  FLOAT                               External             
                   |----  MUNSTA                                                   
   
 
3 MUSTRM
         SUBROUTINE MUSTRM
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   
    - 851211
   Create normal streamers for a track element
         that enters one of the sensitive volume of MU detectors.
         The procedures are:
           (1) Transform track element into local reference system
               -- the system of the current volume (DFD 4.4.3.);
           (2) Create track segments in active area of the tubes
               -- calculate the # of tube hit in each tube plane
                  and the lengths of track segments (DFD 4.4.3.);
           (3) Create streamers in tube (DFD 4.4.3.);
         Called by MUHIT
         Calls MUTRSF,MUSTSG,MUSMFR               in this .HLB
   
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   MUHIT                                                                           
        |---- MUSTRM                                                               
                   |----  MUTRSF                                                   
                   |----  MUSPMD                                                   
                   |----  MUSTSG                                                   
                   |----  MUSMFRRETURN                        External             
   
 
3 MUSTSG
         SUBROUTINE MUSTSG(XLOC,DCLOC)
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   
    -851212
               modified for DAF and new bank layout
               by F.Bossi,D.Kuhn,R.Xu 87-09-24
             - modified for final dbase
               by A. Antonelli, F. Bossi 1 July 89
   Calculate segments of a track element in active
         area of tubes in two tube planes with straight extrapolation.
         Input :
               XLOC(*)  -- Coordinates of track element
               DCLOC(*) -- Direction cosine of track element
         Output :
               in BOS bank JDMUST
         Called by MUSTRM
         Calls ALBOS                        in this .HLB
               BLIST                  in BOS
   
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   MUSTRM                                                                          
        |---- MUSTSG                                                               
                   |----  XSOFMU                              External             
                   |----  YSOFMU                              External             
                   |----  MOD                                 External             
                   |----  WBANK                               External             
                   |----  CHAHOL                              External             
                   |----  MUNSTA                                                   
                   |----  YCUTSL                              External             
                   |----  YCUTSB                              External             
                   |----  ALTELL                              External             
   
 
3 MUTRSF
         SUBROUTINE MUTRSF(XLOC,DCLOC)
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   
    -851214
   Tranformate the track element to the local system
         Input  : common block /TRKCOM/
         Output : XLOC(*)  -- coordinates in local system
                  DCLOC(*) -- Direction cosines in local system
         Called by MUSTRM
         Calls     GTRNSF                       in GEANT3
   
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   MUSTRM                                                                          
        |---- MUTRSF                                                               
                   |----  GTRNSF                              External             
   
 
3 MUUNOI
         SUBROUTINE MUUNOI
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   
   Add track-unrelated noise to bos bank 'muht'.
         This routine is called once per event.
         ----- Not done yet
   
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   MUDIGI                                                                          
        |---- MUUNOI.                                                              
   
 
3 MUWSUM
         SUBROUTINE MUWSUM
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   
   Bossi -870818
   Print general statistics of muon
        Called from ASCRUN       in this .HLB
        Calls       none
   
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   ASCJOB                                                                          
        |---- MUWSUM.                                                              
   

2 SATR

  >>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>
    CKEY 
     1st entry into SATR set
  <<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<
     SAASIG     Delete multihits and reduce sahi bank to actual size
     SABOOK     Histogram booking for the satr
     SADIGI     Satr digitization
     SAHIST     Fill histograms for the satr test run
     SAHIT      Calculate hit and fill sahi bank
     SAIRUN     Initialize common variables and banks for the satr
     SAWSUM     Print out averages for the satr test run

3 SAASIG
         SUBROUTINE SAASIG
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Delete multihits and reduce sahi bank to actual size
     called at the end of the event before SADIGI by ASASIG
                                     H.Burkhardt   October 1986
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   ASASIG                                                                          
        |---- SAASIG                                                               
                   |----  NAMIND                              External             
                   |----  IBITS                               External             
                   |----  AUBPRS                              External             
                   |----  IPRIJO                              External             
                   |----  SAPRHI                              External             
   
 
3 SABOOK
         SUBROUTINE SABOOK
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Histogram booking for the satr
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   ASBOOK                                                                          
        |---- SABOOK                                                               
                   |----  BKINJO                              External             
                   |----  HBOOK1                              External             
                   |----  COS                                 External             
                   |----  HBOOK2                              External             
                   |----  HBPRO                               External             
   
 
3 SADIGI
         SUBROUTINE SADIGI
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Satr digitization
       called from ASDIGI at the end of the event
       call histogram routine SAHIST
       evaluate the full hit information in the SAHI hit bank
       do oring for wires which are connected to the same TDC
       produce the SADIgi bank which simulates real data:
       go from                     var
       SATR side     1 to  2       isid     (The two SATR Detectors)
            wire     1 to 14       iwir
            distance to wire
       to the raw data information were for every wire set
       one 32 bit containing in the upper 16 bit the coded TDC number
       and in the lower 16 bit the TDC information is written to output
       the TDC number is characterized by
                                   var
            crate    1 to  3       JCRAT
            card     1 to 24       JCARD
            #tdc     1 to 16       JTDCN
       in writing, these numbers will be decreased by one to
       to get the #tdc number stored in 4 bits
                                       H.Burkhardt October 1986
       sort raw data according to   - crate,   - card,   - tdc-number
       in order to simulate the sequence of the electronics read-out
                                       H. Meinhard, Jan.1988
       the TDC crate number will not be decreased by one according to the
       behaviour of the readout system. Correct the oring mode
                                       H. Meinhard, March 1989
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
              SADIGI                                                               
                   |----  BDROP                               External             
                   |----  ALBOS                               External             
                   |----  BLIST                               External             
                   |----  FLOAT                               External             
                   |----  IBITS                               External             
                   |----  RANNOR                              External             
                   |----  MOD                                 External             
                   |----  INT                                 External             
                   |----  ISHFT                               External             
                   |----  AUBPRS                              External             
                   |----  SAPRDI                              External             
                   |----  IPRIJO                              External             
                   |----  SAHIST                                                   
                   |----  FHISJO                              External             
   
 
3 SAHIST
         SUBROUTINE SAHIST
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Fill histograms for the satr test run
                                     H.Burkhardt   October 1986
       called from SADIGI if SATR hist flag is set
       fill track info scattered over three banks temporarily
       in PP vector to avoid a lot of forward-backword pointing
       the histogramming is of interest for the following questions:
          in small angle BHABHA scattering
             how many secondaries are produced by the beam pipe
             what is their impact on the SATR Monitor
             and by how much do they change the measurement of
             cos theta
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   SADIGI                                                                          
        |---- SAHIST                                                               
                   |----  SQRT                                External             
                   |----  NLINK                               External             
                   |----  HFILL                               External             
                   |----  FLOAT                               External             
                   |----  NAMIND                              External             
                   |----  CHAINT                              External             
                   |----  ABS                                 External             
                   |----  NHLASA                              External             
                   |----  NHLDSA                              External             
                   |----  IPRIJO                              External             
                   |----  ACOS                                External             
   
 
3 SAHIT
         SUBROUTINE SAHIT
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Calculate hit and fill sahi bank
                                     H.Burkhardt   October 1986
                         modified by E.Neugebauer  December 1989
                           (introduce alignment corrections)
       Modified:   H. Meinhard       03-Aug-1990  (1)
       (read alignment constants from LALI)
        called by GUSTEP                      from this .HLB
        when track is in SATR acceptance
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   GUSTEP                                                                          
        |---- SAHIT                                                                
                   |----  NAMIND                              External             
                   |----  FBEGJO                              External             
                   |----  ICSAJO                              External             
                   |----  BDROP                               External             
                   |----  ALBOS                               External             
                   |----  BLIST                               External             
                   |----  SQRT                                External             
                   |----  ATAN2                               External             
                   |----  ABS                                 External             
                   |----  INT                                 External             
                   |----  MOD                                 External             
                   |----  PHIBSA                              External             
                   |----  ACOS                                External             
                   |----  CROSS                               External             
                   |----  FLOAT                               External             
                   |----  SIN                                 External             
                   |----  COS                                 External             
                   |----  AMOD                                External             
                   |----  ISHFT                               External             
   
 
3 SAIRUN
         SUBROUTINE SAIRUN
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Initialize common variables and banks for the satr
                                  H.Burkhardt October 1986
                          modified for Data Base access October 87
       Modified H. Meinhard 29-May-1990: Get alignment constants from
                                         LALI and LSLO banks
   - modified by : B.Bloch-Devaux - 911015
                   introduce SETUP dependence
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   ASIMOD                                                                          
        |---- SAIRUN                                                               
                   |----  GTSTUP                              External             
                   |----  ALGTDB                              External             
                   |----  ALTELL                              External             
                   |----  NAMIND                              External             
                   |----  IDETJO                              External             
                   |----  BKFMT                               External             
   
 
3 SAWSUM
         SUBROUTINE SAWSUM
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Print out averages for the satr test run
                                  H.Burkhardt October 1986
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   ASCJOB                                                                          
        |---- SAWSUM.                                                              
   

2 SCAL

  >>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>
    CKEY 
     1st entry in SCAL set
     ! GALEPH 25.6
      o New comdeck SICONST with constants loaded from Data Base
      o New subroutines :
        SIZINI  Get zero suppression scheme and conversion constants
        SITRA3  generate transverse shower distribution in Sical (3 Gauss.)
        SIDFRT  initialise transverse em-shower distribution in Sical
      o Modifications in :
        SIPARM: update parametrisation common content
        SIBOOK: update histos
        SIDFPA: update parametrization constants
        SIIRUN: get BANKS from Data base for all constants
        SISIDI: apply Zero suppression on Raw Data
        SITRAK: use constant from Bank
        SISHOW: update parametrization steering
        SITRAN: update transverse parametrization
        SITRIG: apply Zero suppression to SIFO bank
    
  <<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<
     SIASIG     Controls the analog signal processing in scal
     SIBOOK     Book scal histograms
     SIDFGO     Store geometry quantities in common
     SIDFPA     Defines shower parametrisation parameters
     SIDFRT     Initialise transverse em-shower distribution in sical
     SIDIGI     Controls digitalisation in scal
     SIFILH     Fill scal histograms
     SIHIT      Controls tracking in scal
     SIIRUN     Scal run initialisation
     SILONG     Generates longitudinal em-shower profile
     SINOIS     Scal : add noise and/or cross-talk to analog signals
     SISHOW     Scal : shower parametrisation
     SISIDI     Scal : format digitizings apllying zero suppresion scheme
     SITRA3     Generate transverse em-shower distribution in sical
     SITRAK     Controls tracking in scal
     SITRAN     Generate transverse em-shower distribution in sical
     SITRIG     Scal : form trigger signals , apply zero suppression when creating
     SIWSUM     Job summary for scal
     SIZINI     Scal : get zero suppression scheme and conversion constants
     SIZSUP     Scal : apply zero suppression scheme to data

3 SIASIG
         SUBROUTINE SIASIG
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Controls the analog signal processing in scal
    - B.Bloch-Devaux October 91
    - Called by  ASASIG                             from this Lib
    - Calls      BDROP                              from BOS  Lib
    - Calls      AUBPRS,PRTABL,SIDCOD,CAFIHT,ALTELL from ALEPHLIB
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   ASASIG                                                                          
        |---- SIASIG                                                               
                   |----  AUBPRS                              External             
                   |----  PRTABL                              External             
                   |----  CAFIHT                                                   
                   |----  BLIST                               External             
                   |----  FLOAT                               External             
                   |----  SIDCOD                              External             
                   |----  DBLE                                External             
                   |----  SIFILH                                                   
                   |----  FHISJO                              External             
                   |----  ALTELL                              External             
   
 
3 SIBOOK
         SUBROUTINE SIBOOK
  ------------------------------------------------------------------------------
    CKEY SICAL BOOK HISTO
  ------------------------------------------------------------------------------
   Book scal histograms
    B. BLOCH October 91
    - Called by  ASBOOK                           from this .HLB
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   ASBOOK                                                                          
        |---- SIBOOK                                                               
                   |----  HBOOK1                              External             
                   |----  HBOOK2                              External             
   
 
3 SIDFGO
         SUBROUTINE SIDFGO
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Store geometry quantities in common
    - B.Bloch-Devaux        920110
    - Called by  SIIIRUN            from this .HLB
    - Calls      SIGTGO             from Alephlib
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   SIIRUN                                                                          
        |---- SIDFGO                                                               
                   |----  SIGTGO                              External             
   
 
3 SIDFPA
         SUBROUTINE SIDFPA (ENERG)
  ------------------------------------------------------------------------------
    CKEY SICAL SHOWER
  ------------------------------------------------------------------------------
   Defines shower parametrisation parameters
   - J.Rander and B.Bloch-Devaux        920110
   - Input   :   ENERG / R   = particle's energy
   - Output  :   /SIPARM/
   - Called by  SISHOW             from this .HLB
   - Calls      RANNOR,GAMMA       from Cernlibs
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   SISHOW                                                                          
        |---- SIDFPA                                                               
                   |----  SIDFRT                                                   
                   |----  ALOG                                External             
                   |----  SQRT                                External             
                   |----  RANNOR                              External             
                   |----  GAMMA                               External             
   
 
3 SIDFRT
         SUBROUTINE SIDFRT
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Initialise transverse em-shower distribution in sical
    Author: B.Vallage                  5-FEB-1993
      Called by : SIDFPA
      Description  : Sical radial shower distribution
      ===========
                   TRIPLE GAUSSIAN Shape with parameters
                   sigmaa(shower core),sigmab(wings),sigmac(cross talk),
                   siraab(a over a+b) and sirabc(a+b over a+b+c).
   
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   SIDFPA                                                                          
        |---- SIDFRT                                                               
                   |----  IPRIJO                              External             
                   |----  SIGMAA                              External             
                   |----  SIGMAB                              External             
   
 
3 SIDIGI
         SUBROUTINE SIDIGI
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Controls digitalisation in scal
    - B.Bloch-Devaux        911015
    - Called by  ASDIGI                           from this .HLB
    - Calls      SINOIS,SIZSUP,SISIDI,SITRIG,SIBPRN from this Lib
    -            AUBPRS                             from ALEPHLib
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   ASDIGI                                                                          
        |---- SIDIGI                                                               
                   |----  SINOIS                                                   
                   |----  ICSIJO                              External             
                   |----  SIZSUP                                                   
                   |----  SISIDI                                                   
                   |----  SITRIG                                                   
                   |----  AUBPRS                              External             
                   |----  SIFILH                                                   
                   |----  FHISJO                              External             
                   |----  PRTABL                              External             
   
 
3 SIFILH
         SUBROUTINE SIFILH(IPR)
  ------------------------------------------------------------------------------
    CKEY SICAL FILL HISTO
  ------------------------------------------------------------------------------
   Fill scal histograms
    B. BLOCH December 91
    - Input  IPR  flag to select bank content to be analysed
                  1 = analyse SIHT
                  2 = analyse SIDI , SIFO
    - Called by  SIASIG,SIDIGI                    from this .HLB
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   SIASIG                                                                          
   SIDIGI                                                                          
        |---- SIFILH                                                               
                   |----  VZERO                               External             
                   |----  SIDCOD                              External             
                   |----  HFILL                               External             
                   |----  FLOAT                               External             
   
 
3 SIHIT
         SUBROUTINE SIHIT
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Controls tracking in scal
    - B.Bloch-Devaux 910115
    - Called by   GUSTEP                          from this .HLB
    - Calls       BDROP,BLIST                     from BOS lib
    - Calls       ALBOS                           from ALEPHLIB
    - Calls       SISHOW,SITRAK                   from this LIB
   
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   GUSTEP                                                                          
        |---- SIHIT                                                                
                   |----  FBEGJO                              External             
                   |----  BDROP                               External             
                   |----  ALBOS                               External             
                   |----  BLIST                               External             
                   |----  IPRIJO                              External             
                   |----  ICSIJO                              External             
                   |----  SISHOW                                                   
                   |----  SITRAK                                                   
   
 
3 SIIRUN
         SUBROUTINE SIIRUN
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
    B.Bloch-Devaux  October 91
   Scal run initialisation
       - Called by ASIMOD
       - Calls     SIRDAF,SIDFGO                      from this HLB
                   ALTELL, GTSTUP                     from ALEPHLIB
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   ASIMOD                                                                          
        |---- SIIRUN                                                               
                   |----  GTSTUP                              External             
                   |----  NAMIND                              External             
                   |----  BKFMT                               External             
                   |----  AGETDB                              External             
                   |----  SIZINI                                                   
                   |----  SIRDAF                              External             
                   |----  ALTELL                              External             
                   |----  SIPRGO                              External             
                   |----  IPRIJO                              External             
                   |----  SIDFGO                                                   
                   |----  ICSIJO                              External             
   
 
3 SILONG
         FUNCTION SILONG(S)
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Generates longitudinal em-shower profile
    Author: J.Rander for Sical , inspired from Ecal by Jean Badier
         Input : Depth in radiation lengths
         Output : Profile
         Used by : SISHOW
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   SISHOW                                                                          
        |---- SILONG                                                               
                   |----  ABS                                 External             
                   |----  ALOG                                External             
                   |----  EXP                                 External             
   
 
3 SINOIS
         SUBROUTINE SINOIS
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
    B.Bloch-Devaux  October 91
   Scal : add noise and/or cross-talk to analog signals
       - Called by SIDIGI
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   SIDIGI                                                                          
        |---- SINOIS.                                                              
   
 
3 SISHOW
         SUBROUTINE SISHOW
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
    J.Rander & B.Bloch-Devaux  January 92
   Scal : shower parametrisation
       - Called by SIHIT
       - Calls     SIDFPA,SILONG,SITRAN,SITRA3,CAHIST from this lib
                   SIZFRI,SIXTOA                      from Alephlib
                   RANNOR,RNDM                        fron Cern libs
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   SIHIT                                                                           
        |---- SISHOW                                                               
                   |----  SIDFPA                                                   
                   |----  ABS                                 External             
                   |----  SILONG                                                   
                   |----  RANNOR                              External             
                   |----  SQRT                                External             
                   |----  IFIX                                External             
                   |----  SIZFRI                              External             
                   |----  SITRA3                                                   
                   |----  ICSIJO                              External             
                   |----  SITRAN                                                   
                   |----  RNDM                                                     
                   |----  COS                                 External             
                   |----  SIN                                 External             
                   |----  SIGN                                External             
                   |----  SIXTOA                              External             
                   |----  CAHIST                                                   
   
 
3 SISIDI
         SUBROUTINE SISIDI
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
    B.Bloch-Devaux  October 91 - January 93
   Scal : format digitizings apllying zero suppresion scheme
       - Called by SIDIGI
       - Calls     BDROP,BLIST                    from BOS lib
                   ALBOS                          from ALEPHlib
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   SIDIGI                                                                          
        |---- SISIDI                                                               
                   |----  BDROP                               External             
                   |----  ALBOS                               External             
                   |----  BLIST                               External             
   
 
3 SITRA3
         SUBROUTINE SITRA3( LAYER , RADIS )
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Generate transverse em-shower distribution in sical
    Author: J.Rander for Sical         2-SEP-1992
    Modified B.Vallage                 5-FEB-1993
      Input : LAYER = depth from start of shower (stack)
      Output: RADIS = distance from the shower axis (in CM)
      Called by : SISHOW
      Description  : Sical radial shower distribution
      ===========
                   TRIPLE GAUSSIAN Shape with parameters
                   sigmaa(shower core),sigmab(wings),sigmac(cross talk),
                   siraab(a over a+b) and sirabc(a+b over a+b+c).
                   Their energy dependence defined in SIDFRT
   
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   SISHOW                                                                          
        |---- SITRA3                                                               
                   |----  RNDM                                                     
                   |----  SIRABC                              External             
                   |----  SIRAAB                              External             
                   |----  SIGMAA                              External             
                   |----  SIGMAB                              External             
                   |----  SIGMAC                              External             
                   |----  RANNOR                              External             
                   |----  SQRT                                External             
   
 
3 SITRAK
         SUBROUTINE SITRAK
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Controls tracking in scal
    - B.Bloch-Devaux     910115
    - Called by  SIHIT                            from this .HLB
    - Calls  SIXTOA,CAHIST                        from this .HLB
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   SIHIT                                                                           
        |---- SITRAK                                                               
                   |----  SIGN                                External             
                   |----  SIXTOA                              External             
                   |----  IFIX                                External             
                   |----  CAHIST                                                   
   
 
3 SITRAN
         SUBROUTINE SITRAN( LAYER , RADIS )
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Generate transverse em-shower distribution in sical
    Author: J.Rander for Sical         2-SEP-1992
      Input : LAYER = depth from start of shower (stack)
      Output: RADIS = distance from the shower axis (in CM)
      Called by : SISHOW
      Description  : Sical radial shower distribution
      ===========
                   DOUBLE GAUSSIAN Shape with parameters
                   SIGMAA(shower core), SIGMAB(wings), and
                   SIRAAB(ratio of terms). Their energy
                   dependence defined in SIDFPA
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   SISHOW                                                                          
        |---- SITRAN                                                               
                   |----  SIGMAA                              External             
                   |----  SQRT                                External             
                   |----  RANNOR                              External             
   
 
3 SITRIG
         SUBROUTINE SITRIG
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
    B.Bloch-Devaux  October 91 -January 93
   Scal : form trigger signals , apply zero suppression when creating
           SIFO analog sums
       - Called by SIDIGI
       - Calls     BDROP,BLIST                    from BOS lib
       - Calls     ALBOS                          from ALEPHlib
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   SIDIGI                                                                          
        |---- SITRIG                                                               
                   |----  BDROP                               External             
                   |----  ALBOS                               External             
                   |----  BLIST                               External             
                   |----  IAND                                External             
   
 
3 SIWSUM
         SUBROUTINE SIWSUM
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Job summary for scal
    - B.Bloch-Devaux     910115
    - Called by  ASCJOB                           from this .HLB
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   ASCJOB                                                                          
        |---- SIWSUM                                                               
                   |----  SNGL                                External             
                   |----  FLOAT                               External             
   
 
3 SIZINI
         SUBROUTINE SIZINI
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
    B.Bloch-Devaux   January 93
   Scal : get zero suppression scheme and conversion constants
       - Called by SIIRUN
       - Banks SRCO , SFTH , SZTH
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   SIIRUN                                                                          
        |---- SIZINI                                                               
                   |----  NAMIND                              External             
                   |----  CHAINT                              External             
                   |----  IFIX                                External             
                   |----  IPRIJO                              External             
   
 
3 SIZSUP
         SUBROUTINE SIZSUP
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
    B.Bloch-Devaux  October 91
   Scal : apply zero suppression scheme to data
       - Called by SIDIGI
       - Calls
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   SIDIGI                                                                          
        |---- SIZSUP.                                                              
   

2 SKEL

  >>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>
    CKEY 
     1st entry in SKELeton set
      ! GALEPH 30.1
        remove LEVEL 3 trigger
        call new LEVEL 1 trigger
    
      ! GALEPH 25.4
        to avoid linking problems on UNIX machines, the KINE options 'LUND'
        ans 'SJET' are removed.
        They can be replaced by KINE 'USER' or by reading a KINGAL file
        ASKLUN, ASKLUI, ASKJET - purged
        ASREDC, ASRTYP, ASKINE - modified
       --------------------------------------------------------------------
    
       The SKEL set contains *CD common to every modules and all manegerial
       subroutines.
       A set is a module which contains *CD called only by the subroutines of
       this module.
     ! GALEPH 25.5
      Modifications activated only with flag IFINTER  (B.Bloch May 1993)
        ASPRUN: update to call KUWHAT instead of GINTER
        GALEPH: update Zebra common length for interactive graphic version
    
    
  <<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<
     ASASIG     Analog signal steering routine
     ASBOOK     Book histograms for the job
     ASCEVE     Close the current event
     ASCJOB     Close the job
     ASCRUN     Close the run
     ASCTRA     Close tracking process
     ASDIGI     Digitization steering routine
     ASEVST     Build the event headers
     ASFXXX     Change the e list. create fxxx friendly dst format.
     ASGPAR     Fill 'ptyp' geant3 bank with 'part' bos bank
     ASIEVE     Event initialization
     ASIGAL     Galeph initialization routine
     ASIGEA     Interface galeph_geant3
     ASIJOB     Job initialization
     ASIMOD     Initialize all modules (detectors, trigger)
     ASINIT     Initialize general constants
     ASIPAC     Initialize all packages used by the job
     ASIRUN     Read run record, set run status banks, write c-list
     ASKINE     Kinematics steering routine
     ASKSIN     Generate a single track particle of a given type in a given range
     ASKTRK     Store new tracks:
     ASKUSE     Calls the user event generator
     ASKUSI     Initializes the user event generator
     ASPEVE     Process current event # nevtjo
     ASPRUN     Loop over events
     ASREAD     Read asll input files
     ASREDC     Read bos data cards
     ASREVE     Decode eveh kevh and asev banks
     ASRKIN 
     ASRRUN     Decode contents of runh and asru
     ASRTYP     Build run type iproki
     ASRUST     Build the galeph run header banks
     ASTDEB     Debug after a tracking step
     ASTGEA     Clean kine bos banks and transfert to geant
     ASTIMP     Fill 'impa' banks
     ASTRAC     Tracking steering routine
     ASTRIG     Apply trigger conditions
     ASWKIN     Interface geant3/bos kine banks
     ASWRTP     Write output file
     ASWSUM     Print statistic for this run

3 ASASIG
         SUBROUTINE ASASIG
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   - F.Ranjard - 860211
   Analog signal steering routine
   - Compute analog signals with saturation effects in the calorimeters
   - Fill HIT banks for various detectors if required
   - modified by : F.Ranjard - 911002
                   suppress reference to FBEGJO(9)
                   call SIASIG if SICAl is there
   - modified by : F.Ranjard - 920131
                   suppress reference to FASGAL and RDST
   - Called by   ASPEVE                          from this .HLB
   - Calls       ECASIG, LCASIG, HCASIG          from this .HLB
                 RDMIN , RDMOUT                  from CERNLIB
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   ASPEVE                                                                          
        |---- ASASIG                                                               
                   |----  RDMIN                                                    
                   |----  IRNDJO                              External             
                   |----  RDMOUT                                                   
                   |----  VDASIG                                                   
                   |----  IDETJO                              External             
                   |----  ITASIG                                                   
                   |----  TPASIG                                                   
                   |----  SAASIG                                                   
                   |----  SIASIG                                                   
                   |----  ECASIG                                                   
                   |----  LCASIG                                                   
                   |----  HCASIG                                                   
                   |----  MUASIG                                                   
   
 
3 ASBOOK
         SUBROUTINE ASBOOK
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
    - F.Ranjard - 850611
   Book histograms for the job
    - Called by ASIRUN                                  from this .HLB
    - calls     detector booking routine                from this .HLB
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   ASIPAC                                                                          
        |---- ASBOOK                                                               
                   |----  VDBOOK                                                   
                   |----  FHISJO                              External             
                   |----  ECBOOK                                                   
                   |----  SABOOK                                                   
                   |----  MUBOOK                                                   
                   |----  SIBOOK                                                   
                   |----  X1BOOK                              External             
                   |----  X2BOOK                              External             
   
 
3 ASCEVE
         SUBROUTINE ASCEVE
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
    - F.RANJARD - 850328                 modified - 861009
   Close the current event
      do analysis
      save event on tape
      drop BOS banks and release space
    - called by    ASPRUN                      from this .HLB
    - calls        USCEVE, ASEVST, ASWRTP      from this .HLB
                   RDMOUT                      from KERNLIB
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   ASPRUN                                                                          
        |---- ASCEVE                                                               
                   |----  USCEVE                                                   
                   |----  ASEVST                                                   
                   |----  NAMIND                              External             
                   |----  REAL                                External             
                   |----  ASFXXX                                                   
                   |----  PRFKIN                              External             
                   |----  IPRIJO                              External             
                   |----  ASWRTP                                                   
                   |----  AUBLIS                              External             
                   |----  RDMOUT                                                   
                   |----  NRNDJO                              External             
                   |----  VZERO                               External             
                   |----  TIMED                               External             
                   |----  TIMEJO                              External             
   
 
3 ASCJOB
         SUBROUTINE ASCJOB
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
    - F.RANJARD - 850328
   Close the job
      print job summary
      print histograms
      close files
    - Called by    : QNEXT                            from this .HLB
    - Calls        : ACLOSE                           from ALEPHLIB
                     ASWSUM, xxWSUM, USCJOB           from this .HLB
                     HPHST                            from GENLIB
   
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   QNEXT                                                                           
        |---- ASCJOB                                                               
                   |----  ABWEND                              External             
                   |----  BWRITE                              External             
                   |----  ASWSUM                                                   
                   |----  VDWSUM                                                   
                   |----  IDETJO                              External             
                   |----  ITWSUM                                                   
                   |----  TPWSUM                                                   
                   |----  ECWSUM                                                   
                   |----  HCWSUM                                                   
                   |----  LCWSUM                                                   
                   |----  SAWSUM                                                   
                   |----  MUWSUM                                                   
                   |----  SIWSUM                                                   
                   |----  IPROJO                              External             
                   |----  X1WSUM                              External             
                   |----  X2WSUM                              External             
                   |----  USCJOB                                                   
                   |----  HPHST                               External             
                   |----  ACLOSE                              External             
   
 
3 ASCRUN
         SUBROUTINE ASCRUN
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   - F.RANJARD - 860123
   Close the run
   - Close the run : write last record of the run
   - Called from     QNEXT                      from this .HLB
   - Calls           USCRUN, ASWRTP             dummy on this .HLB
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   QNEXT                                                                           
   ASIEVE                                                                          
        |---- ASCRUN                                                               
                   |----  USCRUN                                                   
                   |----  ALRUNE                              External             
                   |----  ALTELL                              External             
                   |----  BLIST                               External             
                   |----  ASWRTP                                                   
                   |----  AUBLIS                              External             
                   |----  IPRIJO                              External             
   
 
3 ASCTRA
         SUBROUTINE ASCTRA
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   - F.Ranjard - 860926
   Close tracking process
   - Copy GEANT kinematic banks to VERT and KINE banks
   - Print tracking summary if required
   - Called by   ASTRAC                          from this .HLB
   - Calls       PRKINE, ASWKIN                  from this .HLB
                 HFILL, TIMED                    from CERNLIB
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   ASTRAC                                                                          
        |---- ASCTRA                                                               
                   |----  ASWKIN                                                   
                   |----  AUBPRS                              External             
                   |----  MBINJO                              External             
                   |----  MAX                                 External             
                   |----  TIMED                               External             
                   |----  TIMEJO                              External             
                   |----  IPRIJO                              External             
                   |----  PRKINE                              External             
                   |----  PRIMPA                              External             
   
 
3 ASDIGI
         SUBROUTINE ASDIGI
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   - F.Ranjard - 851004
   Digitization steering routine
   - Specific module as xxDIGI should be called if xx-detector has been
     selected on the SETS data card:
     in this case IDETJO(i) = i with i in the range [1,9]  and in the
     following order VD, IT, TP, EC, LC, SA, HC, MU, SI
   - modified by : F.Ranjard - 911002
                   suppress reference to FBEGJO(10)
                   call SIDIGI if SICAL is there
   - Called by   ASPEVE                                 from this .HLB
   - Calls       xxDIGI                                 from this .HLB
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   ASPEVE                                                                          
        |---- ASDIGI                                                               
                   |----  RDMIN                                                    
                   |----  IRNDJO                              External             
                   |----  RDMOUT                                                   
                   |----  VDDIGI                                                   
                   |----  IDETJO                              External             
                   |----  ITDIGI                                                   
                   |----  TPDIGI                                                   
                   |----  ECDIGI                                                   
                   |----  LCDIGI                                                   
                   |----  HCDIGI                                                   
                   |----  MUDIGI                                                   
                   |----  SIDIGI                                                   
   
 
3 ASEVST
         SUBROUTINE ASEVST
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   - F.Ranjard - 851021
   Build the event headers
   - Add this block to list 'E'.
   - Called by    ASCEVE                                from this .HLB
   - Calls        NBANK, BLIST, BKFMT, BPRNT, NAMIND    from BOS77.hlb
                  ALBOS                                 from this .HLB
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   ASCEVE                                                                          
        |---- ASEVST                                                               
                   |----  ALEVEH                              External             
                   |----  ALTELL                              External             
                   |----  IPROJO                              External             
                   |----  ALKEVH                              External             
                   |----  IRNDJO                              External             
                   |----  BLIST                               External             
                   |----  AUBOS                               External             
                   |----  UCOPY                               External             
   
 
3 ASFXXX
         SUBROUTINE ASFXXX
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
    - 140987
   Change the e list. create fxxx friendly dst format.
    The Fxxx banks use the SIMDST reconstruction banks w/o
    loss of too much information.
   - Called from    ASCEVE                  from this .HLB
     CALLS:         FYKINE,FYRELT,FYFSTR,FYFSCO,FYFTOC,    from ALEPHLIB
                    FYFLTR,FYFLCO
     CALLS:         BLIST,BDROP           from BOS.OLB
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   ASCEVE                                                                          
        |---- ASFXXX                                                               
                   |----  FYKINE                              External             
                   |----  ALTELL                              External             
   
 
3 ASGPAR
         SUBROUTINE ASGPAR
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
    - F.Ranjard - 850828
   Fill 'ptyp' geant3 bank with 'part' bos bank
    - Define branching ratios and decay modes for standard GEANT particle
      (copy of GPART from GEANT pam)
    - called by    ASIGEA                                from this .HLB
    - calls        GSDK                                  from GEANT pam
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   ASIGEA                                                                          
        |---- ASGPAR                                                               
                   |----  ALTELL                              External             
                   |----  CHAINT                              External             
                   |----  GSPART                              External             
                   |----  IPROJO                              External             
                   |----  NLINK                               External             
                   |----  GSDK                                External             
                   |----  IPRIJO                              External             
                   |----  GPPART                              External             
                   |----  PRGDEC                              External             
   
 
3 ASIEVE
         SUBROUTINE ASIEVE
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
    - F.RANJARD - 850328
   Event initialization
    - Increment event # .
    - Reset all flags, variables and banks for this event
    - Reset random generator if required.
    - Set DEBUG flag.
    - Initialize ZBOOK event partition .
    - modified by : F.Ranjard - 911002
                    supress reference to LMOD which is replaced by LDET
                    in the definition of FBEGJO
    - called from    ASPRUN                             from this .HLB
    - calls          RDMIN, RDMOUT, TIMED, TIMEL        from KERNLIB
                     MZBOOK                             from ZEBRA lib
                     ASREVE                             from this .HLB
                     ABRUEV                             from ALEPHLIB
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   ASPRUN                                                                          
        |---- ASIEVE                                                               
                   |----  NAMIND                              External             
                   |----  IF                                  External             
                   |----  ABRSEL                              External             
                   |----  ALTELL                              External             
                   |----  AUBLIS                              External             
                   |----  IPRIJO                              External             
                   |----  ASWRTP                                                   
                   |----  ASCRUN                                                   
                   |----  ASIRUN                                                   
                   |----  BDROP                               External             
                   |----  BLIST                               External             
                   |----  BGARB                               External             
                   |----  TIMEL                               External             
                   |----  TIMEJO                              External             
                   |----  ABRUEV                              External             
                   |----  GTRIGC                              External             
                   |----  MZBOOK                              External             
                   |----  IRNDJO                              External             
                   |----  RDMIN                                                    
                   |----  RDMOUT                                                   
                   |----  NRNDJO                              External             
                   |----  TIMED                               External             
                   |----  MOD                                 External             
                   |----  ASREVE                                                   
                   |----  USIEVE                                                   
   
 
3 ASIGAL
         SUBROUTINE ASIGAL
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Galeph initialization routine
   - F.Ranjard - 950425
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   GALEPH                                                                          
        |---- ASIGAL                                                               
                   |----  BNAMES                              External             
                   |----  BOS                                 External             
                   |----  RECUST                                                   
                   |----  GETENVF                             External             
                   |----  AOPEN                               External             
                   |----  ASIJOB                                                   
   
 
3 ASIGEA
         SUBROUTINE ASIGEA
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
    - F.Ranjard - 850306
   Interface galeph_geant3
    - Fill GEANT3 common blocks
    - called by    ASIRUN                               from this .HLB
    - calls        GINIT , GZINIT                       from GEANT3.PAM
                   GDINIT                               from GEANG3.PAM
                   ASGPAR                               from this .HLB
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   ASIJOB                                                                          
        |---- ASIGEA                                                               
                   |----  NAMIND                              External             
                   |----  GZINIT                              External             
                   |----  ASGPAR                                                   
   
 
3 ASIJOB
         SUBROUTINE ASIJOB
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
    - F.RANJARD - 850325
   Job initialization
    - called by   GALEPH
    - calls       ASINIT, ASREDC, ASREAD, ASIMOD          from this .HLB
                  ASIGEA, AGEOME, ASIPAC, USIJOB          from this . HLB
                  AOPDBS, ADBVER                          from ALEPHLIB
                  GINIT, GPMATE, GPTMED, GPROTM, GPVOLU   from GEANT
                  TIMED                                   from KERNLIB
   
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   ASIGAL                                                                          
        |---- ASIJOB                                                               
                   |----  TIMEST                              External             
                   |----  TIMED                               External             
                   |----  TIMEJO                              External             
                   |----  ASINIT                                                   
                   |----  ASREDC                                                   
                   |----  AUBOS                               External             
                   |----  ALTELL                              External             
                   |----  BKFMT                               External             
                   |----  NAMIND                              External             
                   |----  INTCHA                              External             
                   |----  IPROJO                              External             
                   |----  ABS                                 External             
                   |----  ICECJO                              External             
                   |----  JUNIDB                              External             
                   |----  AOPDBS                              External             
                   |----  AWERRC                              External             
                   |----  ADBVER                              External             
                   |----  ASREAD                                                   
                   |----  GINIT                               External             
                   |----  ASIMOD                                                   
                   |----  ASIGEA                                                   
                   |----  AGEOME                                                   
                   |----  ASIPAC                                                   
                   |----  IPRIJO                              External             
                   |----  GPMATE                              External             
                   |----  GPTMED                              External             
                   |----  GPROTM                              External             
                   |----  GPVOLU                              External             
                   |----  ASIRUN                                                   
                   |----  USIJOB                                                   
   
 
3 ASIMOD
         SUBROUTINE ASIMOD
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
    - F.RANJARD - 850326
   Initialize all modules (detectors, trigger)
   - modified by : F.Ranjard - 911002
                   introduce SICAL references
    - called by    ASIJOB                           from this .HLB
    - calls        xxIRUN                           from this .HLB
   
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   ASIJOB                                                                          
        |---- ASIMOD                                                               
                   |----  VDIRUN                                                   
                   |----  ITIRUN                                                   
                   |----  TPIRUN                                                   
                   |----  LCIRUN                                                   
                   |----  SAIRUN                                                   
                   |----  HCIRUN                                                   
                   |----  MUIRUN                                                   
                   |----  ECIRUN                                                   
                   |----  SIIRUN                                                   
                   |----  FYIRUN                              External             
                   |----  IPROJO                              External             
                   |----  X1IRUN                              External             
                   |----  X2IRUN                              External             
                   |----  FHISJO                              External             
                   |----  ALTELL                              External             
                   |----  X2PRIN                              External             
                   |----  IPRIJO                              External             
   
 
3 ASINIT
         SUBROUTINE ASINIT
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
    - F.RANJARD - 850215
   Initialize general constants
   - modified by : F.Ranjard - 911002
                   add SICAL in detector list as # 9
                   suppress TS from component list
                   move COIL from #9 to #13 in component list
                   add references to SICAL
   - Called from   ASIJOB                         from this .HLB
   - Calls         NAMIND, BKFMT                  from BOS77.lib
   
   
   
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   ASIJOB                                                                          
        |---- ASINIT                                                               
                   |----  ALTELL                              External             
                   |----  VZERO                               External             
                   |----  DATIME                              External             
                   |----  MOD                                 External             
                   |----  NAMIND                              External             
                   |----  BKFMT                               External             
                   |----  ALVERS                              External             
   
 
3 ASIPAC
         SUBROUTINE ASIPAC
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
    - F.RANJARD - 850326
   Initialize all packages used by the job
    - called by    ASIRUN                           from this .HLB
    - calls        GPHYSI, GHEINI                   from GEANT3.pam
                   ASBOOK                            from this .HLB
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   ASIJOB                                                                          
        |---- ASIPAC                                                               
                   |----  ASBOOK                                                   
                   |----  NAMIND                              External             
                   |----  GPHYSI                              External             
                   |----  GHEINI                              External             
                   |----  BKINJO                              External             
   
 
3 ASIRUN
         SUBROUTINE ASIRUN
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
    - F.RANJARD - 850325
   Read run record, set run status banks, write c-list
      Change during a run.
    - called by   ASREAD, ASPRUN                        from this .HLB
    - calls       ASRUST, ASRRUN, ASWRTP                from this .HLB
                  ALBOS                                 from ALEPH lib
                  BLIST, BDROP, BGARB                   from BOS77
   
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   ASIEVE                                                                          
   ASIJOB                                                                          
        |---- ASIRUN                                                               
                   |----  ASRRUN                                                   
                   |----  ASRUST                                                   
                   |----  ASWRTP                                                   
                   |----  AUBLIS                              External             
                   |----  IPRIJO                              External             
                   |----  USIRUN                                                   
   
 
3 ASKINE
         SUBROUTINE ASKINE
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
    - F.RANJARD - 850328                           modified - 871029
   Kinematics steering routine
    - TKINJO = LUND     LUND generator     (default)
               SJET     LUND generator , single jet
               PART     single particle
               other    user generator
    - Called from    ASPEVE                       from  this .HLB
    - Calls          ASKLUN , ASKSIN              from  this .HLB
                     ASKUSE                       from user library
                     there is a dummy subroutine ASKUSE in this .HLB
                     to avoid unsatisfied external.
   
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   ASPEVE                                                                          
        |---- ASKINE                                                               
                   |----  BDROP                               External             
                   |----  BLIST                               External             
                   |----  RDMIN                                                    
                   |----  IRNDJO                              External             
                   |----  RDMOUT                                                   
                   |----  ASKSIN                                                   
                   |----  ASKUSE                                                   
                   |----  ALTELL                              External             
   
 
3 ASKSIN
         SUBROUTINE ASKSIN (IDEV,ISTA,NITR,NIVX,ECMS,WEIT)
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
    - R.BEUSELINCK - 830623   for GALEPH 3.2
                                          modified by F.RANJARD - 871029
   Generate a single track particle of a given type in a given range
      of momentum and cosine(theta).
   - Output arguments:
            IDEV     = particle type
            ISTA     = event status word  ( 0 means OK )
            NITR     = # of generated tracks
            NIVX     = # of generated vertices
            ECMS     = particle momentum
            WEIT     = event weight
      BKINJO(4) = particle type
             5    minimum value of the momentum
             6    maximum value of the momentum
             7    minimum value of cos(theta)
             8    maximum value of cos(theta)
    - called by    ASKINE when TKINJO = PART             from this .HLB
    - calls        RANNOR , RNDM                         from KERNLIB
                   KBVERT, KBKINE                        from this .HLB
   
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   ASKINE                                                                          
        |---- ASKSIN                                                               
                   |----  RANNOR                              External             
                   |----  BKINJO                              External             
                   |----  INTCHA                              External             
                   |----  KBVERT                              External             
                   |----  ALTELL                              External             
                   |----  RNDM                                                     
                   |----  SQRT                                External             
                   |----  COS                                 External             
                   |----  SIN                                 External             
                   |----  NINT                                External             
                   |----  KBKINE                              External             
   
 
3 ASKTRK
         SUBROUTINE ASKTRK
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   - B.Bloch-Devaux - 850315                       F.Ranjard - 860929
   Store new tracks:
      - in the kinematic banks if Pmod > 1.Gev  or Pmod > 0.1Gev in the
        inner part of the apparatus.
      - other tracks are stored in the stack.
    - called from    GUSTEP                            from this .HLB
    - calls          GSVERT, GSKINE, GSKING            from GEANT3 pam
                     IUCOMP                            from KERNLIB
   
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   GUSTEP                                                                          
        |---- ASKTRK                                                               
                   |----  INT                                 External             
                   |----  CHAHOL                              External             
                   |----  SQRT                                External             
                   |----  REAL                                External             
                   |----  GSKING                              External             
                   |----  GSVERT                              External             
                   |----  ALBOS                               External             
                   |----  INTCHA                              External             
   
 
3 ASKUSE
         SUBROUTINE ASKUSE (IDEV,ISTA,NITR,NIVX,ECMS,WEIT)
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Calls the user event generator
   - Output arguments:
            IDEV     = event process identification
            ISTA     = event status word  ( 0 means OK )
            NITR     = # of generated tracks
            NIVX     = # of generated vertices
            ECMS     = beam energy
            WEIT     = event weight
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   ASKINE                                                                          
        |---- ASKUSE.                                                              
   
 
3 ASKUSI
         SUBROUTINE ASKUSI (IGCOD)
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Initializes the user event generator
   - Output arguments:
            IGCOD     = generator code
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   ASRTYP                                                                          
        |---- ASKUSI.                                                              
   
 
3 ASPEVE
         SUBROUTINE ASPEVE
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
    - F.RANJARD - 850328                modified - 890210
   Process current event # nevtjo
    - Execute each processor in turn if required :
        KINE, TRAC(incl. hits), ASIG, DIGI, TRIG, RDST
    - Drop the 'T'list at the end : it contents banks which do not go
      onto the output.
    - called by    ASPRUN                                  from this .HLB
    - Calls        ASKINE, ASTRAC, ASASIG, ASDIGI          from this .HLB
                   ASTRIG
                   BDROP                                   from BOS77.lib
   
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   ASPRUN                                                                          
        |---- ASPEVE                                                               
                   |----  ALBOS                               External             
                   |----  IPROJO                              External             
                   |----  ASKINE                                                   
                   |----  INTCHA                              External             
                   |----  ASTGEA                                                   
                   |----  ASTRAC                                                   
                   |----  ASASIG                                                   
                   |----  ASDIGI                                                   
                   |----  ASTRIG                                                   
                   |----  BDROP                               External             
   
 
3 ASPRUN
         SUBROUTINE ASPRUN
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   - F.RANJARD - 850326
   Loop over events
    - called by    GALEPH                                 from this .HLB
    - calls        ASIEVE, ASPEVE, ASCEVE, ASCRUN, ASRRUN from this .HLB
                   ABRSEL, ABWSEL                         from ALEPHLIB
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   QNEXT                                                                           
        |---- ASPRUN                                                               
                   |----  ASIEVE                                                   
                   |----  ASPEVE                                                   
                   |----  ASCEVE                                                   
   
 
3 ASREAD
         SUBROUTINE ASREAD
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
    - F.RANJARD - 850329
   Read asll input files
    - Read input tape on unit# LGETIO
    - Read data base
    - called by    ASIJOB                           from this .HLB
   -  calls        ABRSEL, ABUNIT, BKINJO           from ALEPHLIB
                   BLIST, MDARD                     from BOS77
                   ASIRUN                           from this .HLB
   
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   ASIJOB                                                                          
        |---- ASREAD                                                               
                   |----  ABRSEL                              External             
                   |----  ALTELL                              External             
                   |----  ABUNIT                              External             
                   |----  AUBLIS                              External             
                   |----  IPRIJO                              External             
                   |----  BLIST                               External             
                   |----  AOPEWR                              External             
                   |----  MDARD                               External             
                   |----  BKFMT                               External             
                   |----  NAMIND                              External             
                   |----  ASRTYP                                                   
                   |----  ALRUNH                              External             
   
 
3 ASREDC
         SUBROUTINE ASREDC
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
    - F.RANJARD - 850200                  last change - 860108
   Read bos data cards
    Check consistency of flags set.
   
    - modified by : F.Ranjard - 911002
                    add SICAL in print list
                    add setting of SICAL run conditions
    - called from    ASIRUN                                from this .HLB
    - calls          BREADC, MREADC, NDROP, CHAINT         from BOS lib
                     NPRNT                                 from BOS lib
   
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   ASIJOB                                                                          
        |---- ASREDC                                                               
                   |----  NDROP                               External             
                   |----  MREADC                              External             
                   |----  CHAINT                              External             
                   |----  TGEOJO                              External             
                   |----  NPRNT                               External             
                   |----  ALTELL                              External             
                   |----  FYREDC                              External             
                   |----  MOD                                 External             
                   |----  MAX                                 External             
                   |----  XINPFORMAT                          External             
                   |----  NAMIND                              External             
                   |----  NBANK                               External             
   
 
3 ASREVE
         SUBROUTINE ASREVE
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   - F.Ranjard - 861015
   Decode eveh kevh and asev banks
   - Called by : ASIEVE                                 from this .HLB
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   ASIEVE                                                                          
        |---- ASREVE                                                               
                   |----  UCOPY                               External             
                   |----  ALTELL                              External             
                   |----  IPROJO                              External             
                   |----  VZERO                               External             
   
 
3 ASRKIN
         SUBROUTINE ASRKIN
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   - F.Ranjard - 851023
   - Transfer contents of 'VERT' banks to Geant3 'VERT' banks
     and do the same for 'KINE' banks
   - Drop 'VERT' and 'KINE' BOS banks
     release space.
   - Called from    ASRETP                    from this .HLB
   - Calls          MZBOOK                    from ZEBRA.lib
                    BDROP                     from BOS77.hlb
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   ASTGEA                                                                          
        |---- ASRKIN                                                               
                   |----  SQRT                                External             
                   |----  NLINK                               External             
                   |----  KIAVER                              External             
                   |----  MZBOOK                              External             
                   |----  MAX                                 External             
   
 
3 ASRRUN
         SUBROUTINE ASRRUN
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   - F.Ranjard - 861013
   Decode contents of runh and asru
   - Called from   ASIJOB, ASPRUN                  from this .HLB
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   ASIRUN                                                                          
        |---- ASRRUN                                                               
                   |----  ALTELL                              External             
                   |----  MIN                                 External             
                   |----  NAMIND                              External             
                   |----  REAL                                External             
                   |----  CHAINT                              External             
                   |----  UCOPY                               External             
                   |----  BKINJO                              External             
                   |----  IPROJO                              External             
   
 
3 ASRTYP
         SUBROUTINE ASRTYP
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   - F.Ranjard - 861028
   Build run type iproki
   - Called by  ASIRUN                                 from this .HLB
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   ASREAD                                                                          
        |---- ASRTYP                                                               
                   |----  ALTELL                              External             
                   |----  ALKRUN                              External             
                   |----  INT                                 External             
                   |----  BKINJO                              External             
                   |----  ASKUSI                                                   
   
 
3 ASRUST
         SUBROUTINE ASRUST
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
    - F.RANJARD - 850325
   Build the galeph run header banks
      ATIT,ACUT,AFID,ARUN,APRO,AJOB,AKIN,ASIM
   - modified by : F.Ranjard -911002
                   modified word(JAJOSD) in AJOB bank
                   the word contains 1 bit per detector starting
                   at bit 0. The bit is set to 1 if the detector
                   was selected on the SETS data card.
                   add SICAL run conditions in ARUN bank
    - called by    ASIRUN                           from this .HLB
    - Calls        BLIST                            from BOS.HLB
                   UCOPY, BUNCH                     from CERNlibs
   
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   ASIRUN                                                                          
        |---- ASRUST                                                               
                   |----  NAMIND                              External             
                   |----  BLIST                               External             
                   |----  BKFMT                               External             
                   |----  ALBOS                               External             
                   |----  NINT                                External             
                   |----  IDETJO                              External             
                   |----  BUNCH                               External             
                   |----  INT                                 External             
                   |----  LENOCC                              External             
                   |----  ALINST                              External             
                   |----  INTCHA                              External             
                   |----  UCOPY                               External             
                   |----  IPROJO                              External             
                   |----  IRNDJO                              External             
                   |----  MIN                                 External             
                   |----  MAX                                 External             
   
 
3 ASTDEB
         SUBROUTINE ASTDEB
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   - F.Ranjard - 870813
   Debug after a tracking step
    this routine is called by GUSTEP after every step when
    FGALJO is true to perform various tasks such as:
    - IMPAct banks if required
    - large debug printout if required
    - specific output to retreive energy deposited in ALEPH
   - called by GUSTEP                         from this .HLB
   - calls     ASTIMP                         from this .HLB
               GPCXYZ, GSXYZ, GDCXYZ          from GEANT3 lib
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   GUSTEP                                                                          
        |---- ASTDEB                                                               
                   |----  IDETJO                              External             
                   |----  ASTIMP                                                   
                   |----  IPRIJO                              External             
                   |----  GPCXYZ                              External             
                   |----  CHAHOL                              External             
   
 
3 ASTGEA
         SUBROUTINE ASTGEA
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   - F.Ranjard - 880408 / 881005
   Clean kine bos banks and transfert to geant
   - called by   ASPEVE                        from this .HLB
   - calls       ASRKIN                        from this .HLB
                 FYTOKI                        from ALEPHLIB
                 NDROP,NLINK                   from BOSlib
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   ASPEVE                                                                          
        |---- ASTGEA                                                               
                   |----  SQRT                                External             
                   |----  NLINK                               External             
                   |----  FYTOKI                              External             
                   |----  NDROP                               External             
                   |----  BDROP                               External             
                   |----  PRKINE                              External             
                   |----  IPRIJO                              External             
                   |----  BLIST                               External             
                   |----  ASRKIN                                                   
   
 
3 ASTIMP
         SUBROUTINE ASTIMP
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
        O.Callot    11-jun-86
                                      modified by F.Ranjard - 861216
   Fill 'impa' banks
     Store in bank IMPA, NR=Geant-track-number, the track's parameters
     at the detector entrance, as defined by AGDIMP
     Called by GUSTEP                                   this .HLB
     Calls     BLIST,NLINK                              BOS77
               ALBOS                                    this .HLB
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   ASTDEB                                                                          
        |---- ASTIMP                                                               
                   |----  LAGIMP                              External             
                   |----  NLINK                               External             
                   |----  ALBOS                               External             
                   |----  UCOPY                               External             
   
 
3 ASTRAC
         SUBROUTINE ASTRAC
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
    - F.RANJARD - 850328
   Tracking steering routine
    - Called from    ASPEVE                           from this .HLB
   -              ASCTRA                         from this .HLB
   - Calls         BDROP, BLIST                    from BOS77.lib
   
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   ASPEVE                                                                          
        |---- ASTRAC                                                               
                   |----  RDMIN                                                    
                   |----  IRNDJO                              External             
                   |----  RDMOUT                                                   
                   |----  GTREVE                              External             
                   |----  ASCTRA                                                   
   
 
3 ASTRIG
         SUBROUTINE ASTRIG
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   
    - Author   : A. Putzer  - 86/08/08  FOR GALEPH 13.0
    - Modified : A. Putzer  - 95/01/18  FOR GALEPH 300.
   
   Apply trigger conditions
   
    - This routine acts as the steering routine for the application
      of the Level1 and Level2 trigger
    - Level 1        EC, HC, LC , Si and IT are used
    - Level 2        TP is used for Level 1 track triggers
   
    - Called by      ASPEVE                        from this .HLB
   
    - Calls          X1TRIG                        from ALEPHLIB
    -                X2TRIG                        from ALEPHLIB
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   ASPEVE                                                                          
        |---- ASTRIG                                                               
                   |----  X1TRIG                              External             
                   |----  X1PRNT                              External             
                   |----  IPRIJO                              External             
                   |----  X2TRIG                              External             
                   |----  X2PRIN                              External             
   
 
3 ASWKIN
         SUBROUTINE ASWKIN
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   - F.RANJARD - 860308
   Interface geant3/bos kine banks
   - Translate GEANT banks : 'VERT' and 'KINE' into similar
     BOS banks.
   - Called by    ASEVST                       from this .HLB
   - Calls        NBANK, BLIST, NAMIND, BKFMT  from BOS77.hlb
                  ALBOS                        from this .HLB
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   ASCTRA                                                                          
        |---- ASWKIN                                                               
                   |----  SQRT                                External             
                   |----  NLINK                               External             
                   |----  INT                                 External             
                   |----  KIAVER                              External             
                   |----  ALBOS                               External             
   
 
3 ASWRTP
         SUBROUTINE ASWRTP (LIST)
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   - F.Ranjard - 850903
   Write output file
   - Input   : LIST   / A  = 'C' or 'E'  list
   - Called by    ASCEVE                                  from this .HLB
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   ASCEVE                                                                          
   ASCRUN                                                                          
   ASIEVE                                                                          
   ASIRUN                                                                          
        |---- ASWRTP                                                               
                   |----  ALRUNR                              External             
                   |----  NLISTF                              External             
                   |----  BDROP                               External             
                   |----  BLIST                               External             
                   |----  NAMIND                              External             
                   |----  BWRITE                              External             
                   |----  ABWSEL                              External             
   
 
3 ASWSUM
         SUBROUTINE ASWSUM
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
    - F.RANJARD - 850328    modified - 920131
   Print statistic for this run
    - Called from    ASCJOB                            from this .HLB
    - Calls          TIMEX                             from KERNLIB
                     GFTITL                            from GEANT3 pam
                     BOSTA                             from BOS77.hlb
   
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   ASCJOB                                                                          
        |---- ASWSUM                                                               
                   |----  CHAINT                              External             
                   |----  TIMEX                               External             
                   |----  TIMEJO                              External             
                   |----  BKINJO                              External             
                   |----  NINT                                External             
                   |----  INT                                 External             
                   |----  ABS                                 External             
                   |----  TCUTJO                              External             
                   |----  ALSEED                                                   
                   |----  MOD                                 External             
                   |----  FORMAT                              External             
                   |----  ALFIELFORMAT                        External             
                   |----  IGEOJO                              External             
                   |----  TGEOJO                              External             
                   |----  NEVTJOFORMAT                        External             
                   |----  NRNDJOFORMAT                        External             
                   |----  IPROJO                              External             
                   |----  NSTAJO                              External             
                   |----  MBINJO                              External             
                   |----  BOSTA                               External             
                   |----  MZEND                               External             
   

2 TPC

  >>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>
    CKEY 
     1st entry in TPC set
  <<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<
     TPASIG     Compress and sort tcp banks
     TPCOOR     M.mermikides -  860202                     f.ranjard - 861002
     TPDIGI     Run tpcsim (fast version) or make fake tpco banks.
     TPGETH 
     TPHDIF 
     TPHIT 
     TPHSRT 
     TPIBOS 
     TPIRUN 
     TPUGEO     Fill commom blocks tpgeom,tpgeop,tpgeow,tpgeot
     TPWSUM     Brief run summary for tpc
     TTGETH 

3 TPASIG
         SUBROUTINE TPASIG
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   - TPC user operations after event tracking
   Compress and sort tcp banks
    - Called from          ASASIG                     from GALEPH.HLB
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   ASASIG                                                                          
        |---- TPASIG                                                               
                   |----  AUBPRS                              External             
                   |----  IUCHAN                              External             
                   |----  FLOAT                               External             
                   |----  TPHSRT                                                   
                   |----  IPRIJO                              External             
                   |----  ICTPJO                              External             
                   |----  TPRHIT                              External             
   
 
3 TPCOOR
         SUBROUTINE TPCOOR
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   M.mermikides -  860202                     f.ranjard - 861002
    - Simulate TPC pad hit coordinates from intersections
      using simple error parametrisation.
      The purpose of this routine is to provide input for the track
      reconstruction in the absence of pad digitisations.
      input : NATHT  name-index of the hit bank TPHT
      output: Banks TPCO, TPCH, TCRL
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   TPDIGI                                                                          
        |---- TPCOOR                                                               
                   |----  NLINK                               External             
                   |----  WBANK                               External             
                   |----  INTCHA                              External             
                   |----  TPPROW                              External             
                   |----  MOD                                 External             
                   |----  ITPTYP                              External             
                   |----  ITPSEC                              External             
                   |----  ABS                                 External             
                   |----  RANNOR                              External             
                   |----  SQRT                                External             
                   |----  TPHDIF                                                   
                   |----  TPPHI0                              External             
                   |----  TPDPHW                              External             
                   |----  TPDPHS                              External             
                   |----  RNDM                                                     
                   |----  ALBOS                               External             
                   |----  BLIST                               External             
                   |----  IENDTP                              External             
                   |----  WDROP                               External             
                   |----  ALTELL                              External             
   
 
3 TPDIGI
         SUBROUTINE TPDIGI
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   - F.Ranjard - 861001
   Run tpcsim (fast version) or make fake tpco banks.
   - Called from    ASDIGI                            from this .HLB
   - Calls          TPCOOR,TPRCOO                     from this .HLB
   -                TGTEER                            from TPCSIM.HLB
   - D.Cowen/P.Janot  30-6-88  --  Incorporate TPCSIM.
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   ASDIGI                                                                          
        |---- TPDIGI                                                               
                   |----  BDROP                               External             
                   |----  ICTPJO                              External             
                   |----  TPCOOR                                                   
                   |----  AUBPRS                              External             
                   |----  IPRIJO                              External             
                   |----  TPRCOO                              External             
                   |----  TGTEER                              External             
   
 
3 TPGETH
         SUBROUTINE TPGETH(ITE)
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
    - M.MERMIKIDES - 851206
    - Compute intersections(hits) of charged track element ITE
      with padrows
    - Banks created:
                   TPHT  Intersections with padrows
                   TPHE  References to track elements
   
    -Called from   TPHIT
    -Calls         ALBOS
                   BKFMT,BLIST
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   TPHIT                                                                           
        |---- TPGETH                                                               
                   |----  ALBOS                               External             
                   |----  BLIST                               External             
                   |----  ICTPJO                              External             
                   |----  SQRT                                External             
                   |----  TPPROW                              External             
                   |----  GICYL                               External             
                   |----  TPHDIF                                                   
                   |----  TPPHI0                              External             
                   |----  IENDTP                              External             
                   |----  ITPTYP                              External             
                   |----  ABS                                 External             
                   |----  TPDPHF                              External             
                   |----  INT                                 External             
                   |----  TPDPHW                              External             
                   |----  TPDPHS                              External             
   
 
3 TPHDIF
         FUNCTION TPHDIF(PHI1,PHI2)
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
    Returns difference between PHI1 and PHI2 in range -pi to + pi
    (PHI1, PHI2 are in range 0 - 2pi)
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   TPCOOR                                                                          
   TPGETH                                                                          
   TTGETH                                                                          
        |---- TPHDIF.                                                              
   
 
3 TPHIT
         SUBROUTINE TPHIT
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
    M.Mermikides                                       24/7/85
    Steering for computation of track intersectons with padrows
    using current track element parameters.
   -Track elements are saved (optionally) in BOS bank 'TPTE' in the form
     (Track ID, x,y,z,dx/ds,dy/ds/dz/ds,p,s,TOF,m,Q)
    for detailed simulation in TPDIGI. These are also useful for
    display purposes.
   -First order pad hits (intersections) are computed in routine TPGETH
   -To avoid excessive numbers of track elements and hits, we stop
    following low momentum tracks after a given path length)
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   GUSTEP                                                                          
        |---- TPHIT                                                                
                   |----  FBEGJO                              External             
                   |----  TPIBOS                                                   
                   |----  ICTPJO                              External             
                   |----  ALBOS                               External             
                   |----  BLIST                               External             
                   |----  UCOPY                               External             
                   |----  NINT                                External             
                   |----  TPGETH                                                   
                   |----  TTGETH                                                   
   
 
3 TPHSRT
         SUBROUTINE TPHSRT(NAMH,NAMR)
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
    - M.Mermikides -  860202
   
    -  Sorts hit bank and track element ref. bank in increasing radius
       NAMH is name index of hit bank to be sorted
       NAMR  "   "    "      track element ref. bank
       (NB It is implied that the 2nd word (ChanID) is the sort key)
   
    -  Calls           NDROP,WBANK,WDROP              from BOS77 lib
                       UCOCOP,SORTZV                  from CERN lib
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   TPASIG                                                                          
        |---- TPHSRT                                                               
                   |----  WBANK                               External             
                   |----  SORTZV                              External             
                   |----  UCOCOP                              External             
                   |----  UCOPY                               External             
                   |----  WDROP                               External             
                   |----  ALTELL                              External             
   
 
3 TPIBOS
         SUBROUTINE TPIBOS
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   - F.RANJARD - 860414
   - called at the 1st entry into TPC of an event
   - drop banks if they exist ( read from disk)
   - Called from   TPHIT                    from this .HLB
   - Calls         NDROP                    from BOS77.hlb
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   TPHIT                                                                           
        |---- TPIBOS                                                               
                   |----  NDROP                               External             
                   |----  ICTPJO                              External             
   
 
3 TPIRUN
         SUBROUTINE TPIRUN
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
    - Clear name indices
    - Initialise DetectorDescription and SimulationConst
      for TPC simulation
    - Get user geometry
    - Called from         ASIMOD                     from GALEPH.HLB
    - Calls                NAMIND, BKFMT              from BOS77.hlb
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   ASIMOD                                                                          
        |---- TPIRUN                                                               
                   |----  NAMIND                              External             
                   |----  BKFMT                               External             
                   |----  TRDDAF                              External             
                   |----  TGEPRI                              External             
                   |----  IPRIJO                              External             
                   |----  ICTPJO                              External             
                   |----  TGINIT                              External             
                   |----  TPCVER                              External             
   
 
3 TPUGEO
         SUBROUTINE TPUGEO
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
    - M.Mermikides - 860921
   Fill commom blocks tpgeom,tpgeop,tpgeow,tpgeot
      with useful TPC geometric quantities derived from data base
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
              TPUGEO                                                               
                   |----  NAMIND                              External             
                   |----  ALTELL                              External             
                   |----  FLOAT                               External             
                   |----  COS                                 External             
                   |----  SIN                                 External             
                   |----  IPRIJO                              External             
                   |----  FORMAT                              External             
   
 
3 TPWSUM
         SUBROUTINE TPWSUM
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
    - M. MERMIKIDES   860415
   Brief run summary for tpc
    - Called by      ASCRUN                          from GALEPH.HLB
    - Modifications:
         1. D.Cowen/P.Janot 30-6-88  --  Add TPCSIM closings.
         2. P.Janot         30-9-88  --  Add time statistics.
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   ASCJOB                                                                          
        |---- TPWSUM                                                               
                   |----  ICTPJO                              External             
                   |----  TGFINI                              External             
                   |----  FLOAT                               External             
                   |----  LVELJO                              External             
   
 
3 TTGETH
         SUBROUTINE TTGETH(ITE)
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
    - M.MERMIKIDES - 851206
    - Compute intersections(hits) of charged track element ITE
      with trigger pad rows
    - Banks created:
                   TTHT  Intersections with padrows
                   TTHE  References to track elements
   
    -Called from   TTHIT
    -Calls         ALBOS
                   BKFMT,BLIST
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   TPHIT                                                                           
        |---- TTGETH                                                               
                   |----  ALBOS                               External             
                   |----  BLIST                               External             
                   |----  ICTPJO                              External             
                   |----  SQRT                                External             
                   |----  TPTROW                              External             
                   |----  GICYL                               External             
                   |----  TPHDIF                                                   
                   |----  TPPHI0                              External             
                   |----  ITPTYP                              External             
                   |----  TPTPHC                              External             
                   |----  TPTPHW                              External             
                   |----  ABS                                 External             
   

2 VDET

  >>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>
    CKEY 
     1st entry into VDET set
    
     ! GALEPH 30.4 correction 10.
       - VFNDEL : access properly parallel noise in VDEP bank
    
     ! GALEPH 30.2
       - GUSTEP,AGVDET,VDHIT,VDHITE,VDASIG,VDMKLO,VDMKTE,GDRAY
    
         1. NEW improved treatment of DELTA RAY production.
            Delta rays are important since they generate
            on average a nearby 3-D hit for 5% of the real hits.
         2. Let GEANT treat the Landau fluctuations in the energy
            deposition within the silicon.
    
         Induced by changes in the above routines and the
         database banks VTME,VVOL,VDEP,VGPA,VVOL,VPOS and VMAT
         which are made for setup code 6 onwards.
         Thus these changes will only take effect for Monte Carlo
         simulations of data from DATE 94 onwards.
         (Easy to change if needed.)
         The routine GDRAY is a copy of a GEANT routine in which
         the energy of each delta ray produced in the VDET region
         is multiplied by a FACTOR (1.4), which effectively give
         a cross-section increase of the same amount. This factor is
         used to give optimal agreement between data and monte carlo.
    
       - VDLAND,VDMKLA
          No longer used could be droped
    
       VDFOOB - bug fix related to maximum pulse height allowed
       VFNDMP - Take into account different multiplexing
                schemes between VDET92 and VDET200 for the computation
                of strip capacitances
       VDCLU  - Stop clustering when the wafer boundary is reached
                (for VDET92, z-view)
       VDPRTE - create electron clouds only if the track element is
                in the active region
    
     ! GALEPH 30.1
       - VFNDEL, VDFOOB, VDMKLO : remove bugs
    
     ! GALEPH 30.0
       ALEPHLIB 204 is mandatory.
    
       remove OLD VDET code.
       redesign VDET package using NEW VDET geometry package.
    
       Suppress manipulation of lists of strips
       Process one wafer at a time, use array of strips
       Process one module at a time, use array of readout channels
    
       Include correct treatment of Landau fluctuations inside silicon
       (optional)
    
       Details are given in Aleph note :  ALEPH 94-152, MINIV 94-05
    
     ! GALEPH 25.4
       VRDGAL,VDDIGI : use ALGTDB instecd of MDARD to get bank depending
                       on the setup code
       VDCLU,VDNOCL  : setupcode < or = LROWS('VDEL')
    
  <<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<
     VAENCL     Convert strip-channel-in-module to electronics channel and pack it
     VDASIG     Compute analog signals
     VDB2DD     Give position of vdb2 box, relative to vdbx
     VDBOOK     Book histograms for vdet
     VDCLU      Find clusters
     VDDIGI     Generate vdet digitizings
     VDFILL     Fill vdet histograms
     VDFIRW     Compute signal in fired strips for one wafer
     VDFOOB     Reformat output banks according to on-line conventions
     VDHIT      Compute hits for vdet
     VDHITE     Updates end segment flag in vdss when track leaves the active volume
     VDIRUN     Initialize run for vdet
     VDMKLO     Compute local coordinates produced by a hit
     VDMKTE     Make the small track elements for one track hit
     VDNOIS     Generate noise on fired strips
     VDPRTE     Process one track element in vdet
     VDROCH     Compute signal on readout channels
     VDWSUM     Print run summary for vdet
     VFNDEL     Get electronic parameters for one module
     VFNDMC     Get max number of r/o cahnnels, r/o pich and mux length
     VFNDMP     Find module parameters for one module
     VFNDTH     Get clustering thresholds for one module
     VGWCNS     Get wafer constants from daf
     VINSTC     Insert truth relation between r/o channel and monte carlo track
     VINSTS     Insert truth relation between strip and monte carlo track

3 VAENCL
         SUBROUTINE VAENCL (IADDR,MMOD,IVIEW,ISCM,NSCH,ISCMF,IECOR)
  ------------------------------------------------------------------------------
    CKEY VDET ENCODE
  ------------------------------------------------------------------------------
   Convert strip-channel-in-module to electronics channel and pack it
   - Steve Wasserbaech, 7 November 1994
     This function converts the strip-channel-in-module number of the
     first strip channel in a cluster into electronics channel number;
     if the readout direction is -1, the electronics channel number of
     the last channel in the cluster is used.  The cluster address is
     packed using VADDPK.  The strip-channel-in-module number of the
     first or last strip (whichever one has the smallest electronics
     channel number) is returned, along with the readout direction,
     to facilitate subsequent loops over the strip-channels-in-module
     in the order of increasing electronics channel number.
   - Input:
     MMOD   / I  Signed global module number
     IVIEW  / I  View number (=1 for z, =2 for r-phi)
     ISCM   / I  First strip-channel-in-module number in cluster
     NSCH   / I  Number of strip channels in cluster
   - Output:
     IADDR  / I  Packed cluster address including number of channels;
                 see VADDPK for packing scheme.
     ISCMF  / I  = ISCM        if readout direction = +1;
                 = ISCM+NSCH-1 if readout direction = -1
     IECOR  / I  Readout direction for this view
                 = +1 if strip channels and electronics channels are
                   numbered in the same direction;
                 = -1 if in opposite directions.
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   VDFOOB                                                                          
   VINSTC                                                                          
        |---- VAENCL                                                               
                   |----  VSCMSC                              External             
                   |----  MAX                                 External             
                   |----  VCSCEC                              External             
                   |----  VIMODM                              External             
                   |----  VPKADD                              External             
                   |----  VSCMEC                              External             
   
 
3 VDASIG
         SUBROUTINE VDASIG
  ------------------------------------------------------------------------------
    CKEY VDET DIGITIZING
  ------------------------------------------------------------------------------
   Compute analog signals
   
     Author         F.Forti        11/6/86
     Modified       A. Bonissent   15/02/94
                                   Suppress usage of work bank
   
     Description
     ===========
     This routine does very little now that VDHT bank is created
     directly in VDHIT routine.
   
     No noise is added here, as Minivertex noise must be added strip by
     strip in the digitization part.
     In fact, all the processing of Vdet is done later, by routine VDDIGI
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   ASASIG                                                                          
        |---- VDASIG                                                               
                   |----  NAMIND                              External             
                   |----  BDROP                               External             
                   |----  AUBPRS                              External             
                   |----  ALBOS                               External             
                   |----  BLIST                               External             
                   |----  ALTELL                              External             
                   |----  ICVDJO                              External             
                   |----  VDPRHT                              External             
                   |----  IPRIJO                              External             
   
 
3 VDB2DD
         SUBROUTINE VDB2DD(D2)
  ------------------------------------------------------------------------------
    CKEY VDET GEOM
  ------------------------------------------------------------------------------
   Give position of vdb2 box, relative to vdbx
    Author : A. Bonissent  15/08/94
    Temporary routine, should be replaced by something more appropriate
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
              VDB2DD                                                               
                   |----  VNRWAF                              External             
   
 
3 VDBOOK
         SUBROUTINE VDBOOK
  ------------------------------------------------------------------------------
    CKEY VDET HISTO
  ------------------------------------------------------------------------------
   Book histograms for vdet
   
     Author         F.Forti         7/08/86
     Modified       G.Triggiani     7/06/88
     Modified       P.Cattaneo      17/10/88
     Modified       A. Bonissent    10/05/94
        Bug fix : two histos with index 110 were booked. Use 111
   
     Description
     ===========
     If Mini-vertex is active book HBOOK4 histograms for it and
     specify options
   
     Called by :    ASBOOK                        from this .HLB
     Calls     :    HBOOK1,HIDOPT                 from HBOOK4
   
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   ASBOOK                                                                          
        |---- VDBOOK                                                               
                   |----  FHISJO                              External             
                   |----  HBOOK1                              External             
                   |----  HIDOPT                              External             
   
 
3 VDCLU
         SUBROUTINE VDCLU(IMOD,NHITM)
  ------------------------------------------------------------------------------
    CKEY VDET DIGITIZE
  ------------------------------------------------------------------------------
   Find clusters
   
     Author         A. Bonissent 15-Jan-1994
   
     Description
     ===========
   
      Find clusters
      Input is the arrays (banks VWC1 and VWC2) of all R/O channels
      in one module
   
      For each view
      Say that we start from channel 1 and finish at last channel
      If first and last channels are fired and it is new Vdet (95)
                         and it is view 1 then
            there is a cluster spanning over last and first channels
            find first not fired channel,
            and say that we shall start the clustering from there
            and process Nchannels (equal to tot. nr channels in module)
            if channel number is larger than max, will be reduced to
               ichannel-nmax
      endif
      Start a cluster when a strip above 0 is found
      Finish it when a fired strip is found,
          or last channel is reached
      Keep a cluster only if at least one strip is above threshold
   -       Do iloop = 1, maxchannels
             ich =iloop+ibeg
   -         if (signal(ich) .ne. 0) then
   -           if (nsiz .eq. 0) ibeg = ich
               if signal above threshold, cluster is good
   -           nsiz = nsiz + 1
   -           endif
   -           if (nsiz .gt. 0) then
   -             if (signal(ich).eq.0 .or. ich.eq.maxchannels) then
                    If cluster is good then
   -                  --  here the cluster has been found;  starting
   -                  --  ibeg, made of nsiz channels, out put to bank
                    endif
   -             nsiz = 0
   -           endif
   -         endif
   -       Enddo
   -       end
      endloop on views
   
   
    Input :  VWC1,VWC2  banks : readout channel content
    Input : Module number and number of hits (tracks) for this module
   
    Output : VCLU bank
   
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   VDDIGI                                                                          
        |---- VDCLU                                                                
                   |----  NAMIND                              External             
                   |----  VNRWAF                              External             
                   |----  VFNDTH                                                   
                   |----  BDROP                               External             
                   |----  ALBOS                               External             
                   |----  AUBPRS                              External             
   
 
3 VDDIGI
         SUBROUTINE VDDIGI
  ------------------------------------------------------------------------------
    CKEY VDET DIGITIZE
  ------------------------------------------------------------------------------
   Generate vdet digitizings
   
     Author         A. Bonissent  15-Jan-1994
   
     Description
     ===========
     Steering routine for the Vdet digitizings.
     Calls appropriate routines to :
           compute hit positions in local wafer coordinates  VDMKLO
           generate charge on fired strips                   VDFIRW
           compute charge on readout channels                VDROCH
           generate noise                                    VDNOIS
           find clusters                                     VDCLU
           fill final output banks                           VDFOOB
   
    Input :  VDHT bank
   
    Output : VPLS and VHLS banks (IN VDFOOB)
   
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   ASDIGI                                                                          
        |---- VDDIGI                                                               
                   |----  NAMIND                              External             
                   |----  VDMKLO                                                   
                   |----  VZERO                               External             
                   |----  BDROP                               External             
                   |----  VFNDMC                                                   
                   |----  ALBOS                               External             
                   |----  VPHSTM                              External             
                   |----  VFNDMP                                                   
                   |----  VDFIRW                                                   
                   |----  VDROCH                                                   
                   |----  VDFILL                                                   
                   |----  VDNOIS                                                   
                   |----  VDCLU                                                    
                   |----  VDFOOB                                                   
                   |----  AUBPRS                              External             
                   |----  BLIST                               External             
   
 
3 VDFILL
         SUBROUTINE VDFILL(TYPE,IARG)
  ------------------------------------------------------------------------------
    CKEY VDET HISTO
  ------------------------------------------------------------------------------
   Fill vdet histograms
   
     Author         A. Bonissent 15-Jan-1994
   
     Description
     ===========
     Fill Vdet histograms
     and accumulate statistics
   
    Input :   TYPE : type of operations to be done. Can be :
                     'INIT'
                     'WAFER'
                     'MODULE'
                     'EVENT'
                     'SUMMARY'
   
              IARG : Operation dependent input arguments
   
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   VDDIGI                                                                          
   VDIRUN                                                                          
   VDWSUM                                                                          
        |---- VDFILL                                                               
                   |----  NAMIND                              External             
                   |----  VFNDEL                                                   
                   |----  I                                   External             
                   |----  J                                   External             
                   |----  VDIST                               External             
                   |----  AMIN1                               External             
                   |----  HF1                                 External             
                   |----  FHISJO                              External             
                   |----  FLOAT                               External             
                   |----  VFNDTH                                                   
                   |----  VUNADD                              External             
                   |----  VDPRDI                              External             
                   |----  IPRIJO                              External             
   
 
3 VDFIRW
         SUBROUTINE VDFIRW(IFIRS,ILAST,IMOD,IWAF)
  ------------------------------------------------------------------------------
    CKEY VDET DIGITIZE
  ------------------------------------------------------------------------------
   Compute signal in fired strips for one wafer
   
     Author         A. Bonissent 15-Jan-1994
   
     Description
     ===========
     For each row in VDLH bank,
           build the list of all track segments (routine VDMKTE)
           Then, call VDPRTE to process them.
           Then, go to next hit
   
    Input :  IFIRS : first row in bank VDLH for this wafer             I
             ILAST : last  row in bank VDLH for this wafer             I
             IMOD  : module number                                     I
             IWAF  : Wafer number                                      I
   
    Input :  VDLH bank
   
    Output : VWS1, VWS2 banks, created by VDPRTE
   
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   VDDIGI                                                                          
        |---- VDFIRW                                                               
                   |----  NAMIND                              External             
                   |----  VZERO                               External             
                   |----  VDMKTE                                                   
                   |----  VDPRTE                                                   
   
 
3 VDFOOB
         SUBROUTINE VDFOOB(IMOD,NHMAX)
  ------------------------------------------------------------------------------
    CKEY VDET DIGITIZE
  ------------------------------------------------------------------------------
   Reformat output banks according to on-line conventions
   
     Author         A. Bonissent 15-Jan-1994
       Input : IMOD : Module number,
               NHMAX number of hits in this module
   
     Description
     ===========
    Format depends on year
   
   
    Input :  VCLU, VWC1, VWC2  banks
   
    Output : VPLH, VHLS  banks
   
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   VDDIGI                                                                          
        |---- VDFOOB                                                               
                   |----  NAMIND                              External             
                   |----  VFNDEL                                                   
                   |----  ALBOS                               External             
                   |----  VAENCL                                                   
                   |----  MAX                                 External             
                   |----  INT                                 External             
                   |----  MOD                                 External             
                   |----  MVBITS                              External             
   
 
3 VDHIT
         SUBROUTINE VDHIT
  ------------------------------------------------------------------------------
    CKEY VDET DIGITIZE
  ------------------------------------------------------------------------------
   Compute hits for vdet
   
   
     Author         F.Forti        12/6/86
     Modified       G.Triggiani    02/02/88
                    F.Ranjard      30/05/90
                    A. Bonissent   15/02/94
                                   Suppress usage of work bank
                    G.Taylor       1/08/95
                                   use GEANT to treat landau
                                   fluctuations inside the VDET
   
     Description
     ===========
     When control is given to this routine, data from the
     common block TRKCOM are use to accumulate hit information in
     VDSS bank
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   GUSTEP                                                                          
        |---- VDHIT                                                                
                   |----  NAMIND                              External             
                   |----  FBEGJO                              External             
                   |----  ALBOS                               External             
                   |----  BLIST                               External             
                   |----  ICVDJO                              External             
                   |----  VIFACI                              External             
   
 
3 VDHITE
         SUBROUTINE VDHITE
  ------------------------------------------------------------------------------
    CKEY VDET DIGITIZE
  ------------------------------------------------------------------------------
   Updates end segment flag in vdss when track leaves the active volume
   
   
     Author         G. Taylor       1/8/95
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
              VDHITE                                                               
                   |----  NAMIND                              External             
   
 
3 VDIRUN
         SUBROUTINE VDIRUN
  ------------------------------------------------------------------------------
    CKEY VDET
  ------------------------------------------------------------------------------
   Initialize run for vdet
   
   
     Author         F.Forti        10/6/86
     Modified       G.Triggiani    17/02/88
     Modified       A. Bonissent   10/05/94
   
     Description
     ===========
     Read Data Base constants for VDET, Format hits and digits banks,
   
     Called by :    ASIMOD                        from this .HLB
     Calls     :    BKFMT                         from BOS77
                    VRDDAF,VDGDMP,ALTELL          from  ALEPHLIB
   
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   ASIMOD                                                                          
        |---- VDIRUN                                                               
                   |----  VRDDAF                              External             
                   |----  ALTELL                              External             
                   |----  JUNIDB                              External             
                   |----  GTSTUP                              External             
                   |----  ALGTDB                              External             
                   |----  NAMIND                              External             
                   |----  VDFILL                                                   
                   |----  BKFMT                               External             
                   |----  IPRIJO                              External             
                   |----  VDGDMP                              External             
   
 
3 VDMKLO
         SUBROUTINE VDMKLO
  ------------------------------------------------------------------------------
    CKEY VDET DIGITIZE
  ------------------------------------------------------------------------------
   Compute local coordinates produced by a hit
   
   
     Author         Manoj Thulasidas 15-Dec-1993
   
     Description
     ===========
     VDet MaKe LOCal hits will perform a global to local to transformatio
     of the hit positions (using the GEOM package routing VDGTOL), create
     the local info bank and sorts it so that all the hit modules and waf
     are in a sequence.
   
   
    Input :  VDSS bank, Global hits bank, indexed by geant track #
   
    Output : VDLH bank, Local hits bank.
   
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   VDDIGI                                                                          
        |---- VDMKLO                                                               
                   |----  NAMIND                              External             
                   |----  BDROP                               External             
                   |----  ALBOS                               External             
                   |----  VDIST                               External             
                   |----  IMOD                                External             
                   |----  IWAF                                External             
                   |----  ISIGN                               External             
                   |----  ALTELL                              External             
                   |----  AUBPRS                              External             
                   |----  SORTIQ                              External             
   
 
3 VDMKTE
         SUBROUTINE VDMKTE(IVDLH,IVDHT)
  ------------------------------------------------------------------------------
    CKEY VDET DIGITIZE
  ------------------------------------------------------------------------------
   Make the small track elements for one track hit
   
   
     Author         A. Bonissent 15-Jan-1994
   
     Description
     ===========
     Call VDMKLA which will return array of track elements
     with their position and energy, Landau fluctuation included
   
     fill the bank
   
    Input :  IVDLH  : row number in the VDLH bank which we process     I
             IVDHT  : VDHT hit          number                         I
    Input :  VDLH bank
   
    Output : VDTE bank
   
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   VDFIRW                                                                          
        |---- VDMKTE                                                               
                   |----  NAMIND                              External             
                   |----  VWTHCK                              External             
                   |----  SQRT                                External             
                   |----  ALBOS                               External             
                   |----  VDIST                               External             
                   |----  VSUB                                External             
                   |----  MAX                                 External             
                   |----  ABS                                 External             
                   |----  INT                                 External             
                   |----  MIN                                 External             
                   |----  REAL                                External             
                   |----  VSCALE                              External             
                   |----  VADD                                External             
                   |----  VFILL                               External             
   
 
3 VDNOIS
         SUBROUTINE VDNOIS(IMOD)
   ------------------------------------------------------------------------------
     CKEY
   ------------------------------------------------------------------------------
   Generate noise on fired strips
    noise outside of hits not implemented yet
   
     Author         A. Bonissent 15-Jan-1994
   
     Description
     ===========
     Algorithm copied from VDNOFS from P. Cattaneo :
     Compute electronic noise for fired readout channel
     and their neighbours, but no more than once per channel
     then, compute the noise on each channel due to capacitive couplings
     Finally, compute the parallel noise for each channel where there is
     signal
   
    Input :  VWC1, VWC2 banks
    Input :  Module number
    Output : VWC1, VWC2 banks
   
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   VDDIGI                                                                          
        |---- VDNOIS                                                               
                   |----  NAMIND                              External             
                   |----  VFNDMP                                                   
                   |----  VFNDEL                                                   
                   |----  MAX                                 External             
                   |----  MIN                                 External             
                   |----  RANNOR                              External             
   
 
3 VDPRTE
         SUBROUTINE VDPRTE(IMOD,IWAF,IVDHT,NHITW)
  ------------------------------------------------------------------------------
    CKEY VDET DIGITIZE
  ------------------------------------------------------------------------------
   Process one track element in vdet
   
   
     Author         A. Bonissent 15-Jan-1994
   
     Description
     ===========
     Algorithm copied from VDFIRS routine by F.Forti,G.Triggiani
                                               and P.Cattaneo
     For each small segment along the track :
         get the energy released
         for each view
           compute the parameters of the electronic cloud on wafer face
               taking into account magnetic and electric field,
                   and diffusion coefficients.
            get the list of fired strips from routine VDFIRS
            insert them in the strips arrays
   
   
    Input :  IMOD  : module                                        I
             IWAF  : wafer                                         I
             IVDHT : VDHT hit number                               I
             NHITW : number of hits in the wafer                   I
    Input :  VDTE bank
   
    Output : VWS1,VWS2 banks
   
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   VDFIRW                                                                          
        |---- VDPRTE                                                               
                   |----  NAMIND                              External             
                   |----  VGWCNS                                                   
                   |----  VMMFLD                              External             
                   |----  SIGN                                External             
                   |----  ABS                                 External             
                   |----  VWTHCK                              External             
                   |----  LOG                                 External             
                   |----  SQRT                                External             
                   |----  VINSEN                              External             
                   |----  VINSTS                                                   
   
 
3 VDROCH
         SUBROUTINE VDROCH(IMOD,IWAF,NHITT)
  ------------------------------------------------------------------------------
    CKEY VDET DIGITIZE
  ------------------------------------------------------------------------------
   Compute signal on readout channels
   
   
     Author         A. Bonissent 15-Jan-1994
   
     Description
     ===========
     Algorithm copied from VDROST, by P. Cattaneo :
     For each fired strip,
         deposit charge on the neighbouring readout channels,
         proportional to the capacitive coupling coefficients
     The readout channel number has to take into account
     possible multiplexing
   
    Input :  IMOD, IWAF : Input, module and wafer numbers
             NHITT : total number of hits in the event
    Input :  VWS1, VWS2 banks
   
    Output : VWC1, VWC2 banks
   
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   VDDIGI                                                                          
        |---- VDROCH                                                               
                   |----  NAMIND                              External             
                   |----  VFNDMP                                                   
                   |----  VFNDMC                                                   
                   |----  VNIRFS                              External             
                   |----  MAX                                 External             
                   |----  MIN                                 External             
                   |----  IABS                                External             
                   |----  VINSTC                                                   
                   |----  VZERO                               External             
   
 
3 VDWSUM
         SUBROUTINE VDWSUM
  ------------------------------------------------------------------------------
    CKEY VDET
  ------------------------------------------------------------------------------
   Print run summary for vdet
   
   
     Author         G.Triggiani     7/06/88
     Modified       A. Bonissent    10/05/94
        Replace use of common VDSTAT by call to VDFILL
        with argument 'SUMMARY'
   
     Description
     ===========
     Print out statistics accumulated during the run for Mini-Vertex
     detector
   
     Called by :    ASCRUN                        from this .HLB
     Calls     :
   
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   ASCJOB                                                                          
        |---- VDWSUM                                                               
                   |----  VDFILL                                                   
                   |----  FLOAT                               External             
   
 
3 VFNDEL
         SUBROUTINE VFNDEL (IMOD,NBCLN,NVDCR,VDSLP,VDPAL,VDELC,
  ------------------------------------------------------------------------------
    CKEY VDET DBASE
  ------------------------------------------------------------------------------
        $                   MXCSI,MXCNO,VELGV,VDLCO,IOFSET,NBITSH)
   Get electronic parameters for one module
   
   
     Author         A. Bonissent 15-Jan-1994
     modif :        A. Bonissent 09-Oct-1996: access properly
   
   
   
     Description
     ===========
    Input : IMOD module number
    Output : NBCLN  number of noisy strips added to a cluster
             NVDCR  number of strips contributing to correlated noise
             VDSLP  noise slope in electron/pf
             VDPAL  parallel noise in electrons
             VDELC  electronic input capacitance in pf
             VELGV  Gev equivalent to an electron
             VDLCO  conversion factor from electron to counts
             NBITSH Offset added when converting digitizings into integers
             MXCNO  number of strips contributing to correlated noise
             MXCSI  number of strips contributing to signal
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   VDFILL                                                                          
   VDFOOB                                                                          
   VDNOIS                                                                          
   VFNDMP                                                                          
   VFNDTH                                                                          
   VINSTC                                                                          
        |---- VFNDEL                                                               
                   |----  NAMIND                              External             
   
 
3 VFNDMC
         SUBROUTINE VFNDMC(IMOD,MAXC,NROS,MUXL,IPICH)
  ------------------------------------------------------------------------------
    CKEY VDET DBASE
  ------------------------------------------------------------------------------
   Get max number of r/o cahnnels, r/o pich and mux length
   
     Author         A. Bonissent 15-Jan-1994
   
    Input : IMOD module number
    Output : MAXC  Number of r/o channels
             NROS  Number of r/o strips
             MUXL  Multiplexing length
             IPICH Readout pitch
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   VDDIGI                                                                          
   VDROCH                                                                          
   VFNDMP                                                                          
        |---- VFNDMC                                                               
                   |----  VROSTM                              External             
                   |----  VNSTCM                              External             
   
 
3 VFNDMP
         SUBROUTINE VFNDMP (IMOD,MAXS,IPICH,MAXC,MUXL,COEFS,
  ------------------------------------------------------------------------------
    CKEY VDET DBASE
  ------------------------------------------------------------------------------
        $                   COEFN,CSTRP,ICDIM,MXCPL)
   Find module parameters for one module
   
   
     Author         A. Bonissent 15-Jan-1994
   
     Description
     ===========
     Input : IMOD module number
     Output : MAXS  Nb strips in one module
              IPICH Readout pitch
              MAXC  Nb readout channels in one module
              MUXL  Multiplexing length
              COEFS Coupling coefficients for signal
              COEFN Coupling coefficients for signal
              CSTRP Strip capacitance
              ICDIM Dimension of arrays above
              MXCPL Max number of neighbours to be taken into account
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   VDDIGI                                                                          
   VDNOIS                                                                          
   VDROCH                                                                          
        |---- VFNDMP                                                               
                   |----  NAMIND                              External             
                   |----  VFNDEL                                                   
                   |----  VSENSI                              External             
                   |----  VNRSSC                              External             
                   |----  VPHSTM                              External             
                   |----  VFNDMC                                                   
                   |----  VZERO                               External             
   
 
3 VFNDTH
         SUBROUTINE VFNDTH(IMOD,THRES)
  ------------------------------------------------------------------------------
    CKEY VDET DBASE
  ------------------------------------------------------------------------------
   Get clustering thresholds for one module
   
     Author         A. Bonissent 15-Jan-1994
   
     ===========
    Input : IMOD module number
    Output : THRES thresholds in 2 views
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   VDCLU                                                                           
   VDFILL                                                                          
        |---- VFNDTH                                                               
                   |----  VFNDEL                                                   
                   |----  JUNIDB                              External             
                   |----  MDARD                               External             
                   |----  NAMIND                              External             
   
 
3 VGWCNS
         SUBROUTINE VGWCNS(IMOD,IWAF,VDEPL,VMU,VTE,VDTHL,VFPOS,VDAPP)
  ------------------------------------------------------------------------------
    CKEY VDET DBASE
  ------------------------------------------------------------------------------
   Get wafer constants from daf
   
     Author         A. Bonissent 15-Jan-1994
   
     Description
     ===========
    Get Vdet constants for one wafer
    Input : IMOD module number
            IWAF wafer number
    Output : VDEPL Depletion voltage
             VMU   Electron or holes mobility
             VTE   Electron or holes temperature
             VDTHL Electron or holes mobility in silicon
             VFPOS Face position in local coordinates
             VDAPP Applied voltage
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   VDPRTE                                                                          
        |---- VGWCNS                                                               
                   |----  NAMIND                              External             
                   |----  ALFIEL                              External             
                   |----  VWTHCK                              External             
   
 
3 VINSTC
         SUBROUTINE VINSTC(IROC,ISTRI,CC,IMOD,IV,NHITT,IROLD,IRNEW)
  ------------------------------------------------------------------------------
    CKEY VDET DIGITIZE TRUTH
  ------------------------------------------------------------------------------
   Insert truth relation between r/o channel and monte carlo track
   
   
     Author         A. Bonissent 15-Jan-1994
   
     Description
     ===========
     For each track which deposited charge in this given strip :
     find the charge;
     search if a relation already exists for this channel and this track
               if yes, add the charge to this relation
               if no, add a new row into the relation bank, and
                         update the pointers for the chain link
                         of each relation to the next relation for the
                         same channel
   
    Input :   IROC  -  readout channel number                          I
              ISTRI - strip number                                     I
              IMOD  - module number                                    I
              IV   - view                                              I
              NHITT - total number of hits in the event                I
              IROLD - (previous) first relation for this channel       I
    Output:   IRNEW - (new) first relation for this channel            O
   
    Intput : VTSK bank
   
    Output : VTRS bank (created or updated)
   
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   VDROCH                                                                          
        |---- VINSTC                                                               
                   |----  NAMIND                              External             
                   |----  VFNDEL                                                   
                   |----  ALBOS                               External             
                   |----  VAENCL                                                   
   
 
3 VINSTS
         SUBROUTINE VINSTS(ISTRI,IVDHT,CHGE,IROL,NHITS,IRNW)
  ------------------------------------------------------------------------------
    CKEY VDET DIGITIZE TRUTH
  ------------------------------------------------------------------------------
   Insert truth relation between strip and monte carlo track
   
   
     Author         A. Bonissent 15-Jan-1994
   
     Description
     ===========
     search if a relation already exists fro this track and this strip
               if yes, add the charge to this relation
               if no, add a new row into the relation bank, and
                         update the pointers for the chain link
                         of each relation to the next relation for the
                         same strip
   
    Input :   ISTRI - strip number                                     I
              IVDHT - monte carlo track index                          I
              CHGE  - charge deposited by this track on this strip     I
              IROL  - (previous) first relation for this strip         I
              NHITS - total number of hits in the wafer                I
              IRNW  - (new) first relation for this strip              O
   
    Output : VTSK bank (created or updated)
   
   
   ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
   -------------------------------------------------------------------------------
   VDPRTE                                                                          
        |---- VINSTS                                                               
                   |----  NAMIND                              External             
                   |----  ALBOS                               External             
   
