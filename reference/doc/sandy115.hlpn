1 SANDY   

  >>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>
    CKEY
      First entry of <QFNBTAG> set of ALPHA QFNDIP + QIPBTAG routines
       Please read the Aleph Note 92-47 ( March 1992 ) from D. Brown
       before using the QFNDIP package
       and  read the Aleph Note 92-124 ( August 1992 ) from D. Brown and M. Fran
       before using the QIPBTAG package
 
  <<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<
     SANDY     Speedy Analysis on the Nano-Dst, by Yves
     NMINIT    Main routine for the SANDY initialisation
     NOUTTY    Set machine type and terminal output logical unit
     NMLOOP    Main routine to loop over events
     NMREAD    Read next event
     NFILL     Read the nanoDST banks and fill the SANDY arrays
     NEWRUN    Called for every new run
     NEWFIL    Initialisation for new nano-DST file
     NUNEWR    Called at each run change
     NMTERM    Main termination routine
     NWRITE    Set the flag to write the event to the output file
     NMWRIT    Write the event to the output file
     NMAKSE    Produces a SEVT cards file
     MAKSEV    Produces an SEVT card for the current event
     NWERRC    Print an error message according to the error flag from ACDA
     KVNEW     Create a new track
     KVCOPY    Copies track ITK into a new track
     QCOPY     Copies track ITKI into track ITKO
     QVSETM    Set mass of track ITRK to AMASS
     QVADD2    Add tracks ITK1 and ITK2 and put sum into ISUM
     QVADD3    Add tracks ITK1, ITK2 and ITK3 and put sum into ISUM
     QVADD4    Add tracks ITK1, ITK2, ITK3 and ITK4 and put sum into ISUM
     QVADD5    Add tracks ITK1, ITK2, ITK3, ITK4 and ITK5 and put sum into
     QVGET3    Copy the momentum 3-vector of track ITK into array P
     QVGET4    Copy the momentum 4-vector of track ITK into array P
     QVSET3    Copy the array P into the momentum 3-vector of track ITK
     QVSET4    Copy the array P into the momentum 4-vector of track ITK
     QDECA2    For the 2-body decay M --> m(I) + m(J), this function calcul
     QDECAN    For the decay M(I) --> m(J)+...+m(n), this function calculat
     NPRINT    Print the event
     KNMTCH    Returns number of matched tracks
     KNMOTH    Returns number of mothers
     KMOTH     Returns the track number of the mother
     KMTCH     Returns the best matched reconstructed track
     QZFR      Returns the z value of the fragmentation
     QEIDRI    Returns electron estimator N for track I
     CQPART    Return particle name CQPART for particle code N
     KPART     ENTRY KPART: Get particle code KPART for particle name CNAM
     KCANTI    Return IPC (if IANTI = 0) or anti-particle code (if IANTI .n
     QPMASS    Particle mass
     QPCHAR    Particle charge
     QPLIFE    Particle life time
     QPWIDT    Particle width
     KPCOMP    Get particle code from PART. Input : particle name CINP
     NDEDX     DE/dx analysis in SANDY
     NDEDXM
     NDEDXK    Fast, simple dE/dx simulation of a single track.
     NKBLOK    Bethe-Bloch parameterization of TPC dE/dx which always uses
     GETJUV    Returns the JULIA version used for reconstruction
     GETVER    Returns version and correction file number used for producti
     GETMCF    Returns T if Monte Carlo data
     DECSEA    Find all MC tracks ITKS that come from IMOTH
     PRIDEC    Print the decay tree of MC particle ITK
     DAUSEA    Find all MC tracks ITKS of type KODE that come from IMOTH
     NINFO     Print NanoDST production parameters
     QWMESE    Print message and run/event number.
     QWMESS    Print message.
     DUMMY     User initialisation
     FILLV0    Create and fill YRFT from NDV0
     NJMMCL    Call NGJMMC, the improved, generalised jade algorithm jet fi
     NEWJET    Call NGJMMC, the improved, generalised jade algorithm jet fi
     NGJMMC    Set up and call FJMMCL jet finding routine.
     QPI0DO    Find pi0 candidates from GAMPEC photons
     PI0LIM
     XXP0F1
     KINEFIT
     QPI0BK
     PI0DEB
     NLASTD    Get the pointer to the last daughter
     KDAU      Get the Ith daughter if track ITK
     NREPAR
     NGPUT
     LEPTAG
     LTHIST
     GTYEAR
     LTNANO
     FCALPOID  CALPOIDS FORTRAN  VERSION # 2.0
     PPTCBIN
     INDICE
     FILLDATA
     FUNPROB
     XBINF
     BTAG_PAR  Define cuts and histos for QIPBTAG
     JETERR    Error on jet angular resolution
     BTAGEV    Probability for a jet to come from a b-quark
     BTAGTR    Calculate the probability of the track to come from IP
     QIPBTAG   User routine for the B-tagging by the impact parameter metho

2 SANDY
        PROGRAM SANDY
  ------------------------------------------------------------------------------
    CKEY
  ------------------------------------------------------------------------------
    - Speedy Analysis on the Nano-Dst, by Yves
 
     Author   :- Yves A. Maumary        2-OCT-1990
 
     Description
     ===========
     Main program
 
2 NMINIT
        SUBROUTINE NMINIT
  ------------------------------------------------------------------------------
    CKEY SANDY /INTERNAL
  ------------------------------------------------------------------------------
    - Main routine for the SANDY initialisation
 
     Author   :- Yves A. Maumary        2-OCT-1990
     Modified :- Yves A. Maumary       24-AUG-1992   Version 111
     Modified :- Yves A. Maumary       29-JAN-1993   Version 111.2
                                                     Fix SEVT behavior
 
     Libraries required: ALEPHLIB, BOS77, HBOOK, KERNLIB
 
     Description
     ===========
     Initialises BOS and HBOOK.
     Reads the cards from unit 7.
     Calls the user initialisation routine NUINIT.
 
 
  ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
  ------------------------------------------------------------------------------
 
              NMINIT                                          File     : NMACR
                   |----  SIGN                                External
                   |----  SQRT                                External
                   |----  ABS                                 External
                   |----  NINT                                External
                   |----  ATG                                 External
                   |----  IAND                                External
                   |----  ISHFT                               External
                   |----  FLOAT                               External
                   |----  BTEST                               External
                   |----  SIN                                 External
                   |----  COS                                 External
                   |----  ACOS                                External
                   |----  TIMAX
                   |----  NOUTTY                              - Set machine ty
                   |----  ALVERS                              Return the Aleph
                   |----  BNAMES                              External
                   |----  BOS                                 External
                   |----  BREADC                              External
                   |----  MRESET                              External
                   |----  ACDARG                              get arguments of
                   |----  NWERRC                              - Print an error
                   |----  AOPEN                               set BOS file for
                   |----  ALTELL                              Print text and t
                   |----  QWMESS                              print message.
                   |----  AOPDBS                              OPEN  ALEPH data
                   |----  ADBVER                              set of intrinsic
                   |----  HLIMIT                              External
                   |----  ACARD3                              Tests the parame
                   |----  AINQUI                              INQUIRE on VAX a
                   |----  ACARD1                              Return index for
                   |----  HROPEN                              External
                   |----  INTRAC                              External
                   |----  NAMIND                              External
                   |----  MOD                                 External
  ------------------------------------------------------------------------------
2 NOUTTY
        SUBROUTINE NOUTTY(MACHI,LUN)
  ------------------------------------------------------------------------------
    CKEY SANDY /INTERNAL
  ------------------------------------------------------------------------------
    - Set machine type and terminal output logical unit
 
     Author   :- Yves A. Maumary        1-OCT-1992
 
     Outputs:
          - MACHI /CHAR : machine type
          - LUN   /I    : terminal output logical unit
 
     Libraries required: KERNLIB
 
 
  ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
  ------------------------------------------------------------------------------
   NMINIT                                                     File     : NMACR
        |---- NOUTTY                                          - Set machine ty
                   |----  INTRAC                              External
  ------------------------------------------------------------------------------
 
2 NMLOOP
        SUBROUTINE NMLOOP
  ------------------------------------------------------------------------------
    CKEY SANDY /INTERNAL
  ------------------------------------------------------------------------------
    - Main routine to loop over events
 
     Author   :- Yves A. Maumary        2-OCT-1990
     Modified :- Yves A. Maumary       24-AUG-1992  Version 111
 
     Libraries required: ALEPHLIB
 
     Description
     ===========
     Calls NMREAD to read in next event.
     Calls NFILL to fill SANDY arrays.
     Calls the user event processing routine NUEVNT.
 
 
  ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
  ------------------------------------------------------------------------------
 
              NMLOOP                                          - Main routine t
                   |----  JOBNAM                              External
                   |----  STR                                 External
                   |----  TRIM                                External
                   |----  TIMAX
                   |----  NMREAD                              - Read next even
                   |----  NMTERM                              - Main terminati
                   |----  NFILL                               File     : NMACR
                   |----  QWMESE                              print message an
                   |----  NUEVNT                              - User event ana
                   |----  NMWRIT                              - Write the even
                   |----  MOD                                 External
                   |----  SYS                                 External
                   |----  SETPRN                              External
                   |----  FIND_FILE                           External
                   |----  INDEX                               External
  ------------------------------------------------------------------------------
2 NMREAD
        SUBROUTINE NMREAD(IEND)
  ------------------------------------------------------------------------------
    CKEY SANDY /INTERNAL
  ------------------------------------------------------------------------------
    - Read next event
 
     Author   :- Yves A. Maumary       20-NOV-1992
 
     Inputs:
          - none
 
     Outputs:
          - IEND  / I    : 0 = next event ready
                           1 = end of input data
 
     Libraries required: ALEPHLIB
 
     Description
     ===========
     Read in next event by calling ABRSEL.
 
 
  ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
  ------------------------------------------------------------------------------
   NMLOOP                                                     - Main routine t
        |---- NMREAD                                          - Read next even
                   |----  ABRSEL                              ALPHARD steering
                   |----  ABRUEV                              Returns current
                   |----  QWMESE                              print message an
                   |----  NEWRUN                              .CALL USER RUN I
                   |----  NEWFIL                              - Initialisation
  ------------------------------------------------------------------------------
 
2 NFILL
        SUBROUTINE NFILL(IRET)
  ------------------------------------------------------------------------------
    CKEY SANDY /INTERNAL
  ------------------------------------------------------------------------------
    - Read the nanoDST banks and fill the SANDY arrays
 
     Author   :- Yves A. Maumary       20-NOV-1992
     Modified :- Yves A. Maumary        5-FEB-1993  Add V0 stuff
                                                    (G.Graefe)
     Modified :- Yves A. Maumary       17-FEB-1993  Add KSTABC
     Modified :- Yves A. Maumary       19-FEB-1993  Add new MC pointers
                                                    KQ1,KQ2,KFPAR,KLPAR
     Modified :- Gerrit Graefe         21-FEB-1994  change V0 stuff
                                                    Add gamma conversions
     Modified :- Gerrit Graefe         13-MAY-1994  Implemented restoring of
                                                    PART bank.
 
     Inputs:
          - none
 
     Outputs:
          - IRET  / I    :  0 = ok
                           >0 = warning
                           <0 = data useless, event should be skipped
 
                            1 = missing bank(s)
                           -1 = NDHE bank not found
                           -2 = invalid data
 
     Libraries required: BOS77
 
 
  ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
  ------------------------------------------------------------------------------
   NMLOOP                                                     - Main routine t
        |---- NFILL                                           File     : NMACR
                   |----  SIGN                                External
                   |----  SQRT                                External
                   |----  ABS                                 External
                   |----  NINT                                External
                   |----  ATG                                 External
                   |----  IAND                                External
                   |----  ISHFT                               External
                   |----  FLOAT                               External
                   |----  BTEST                               External
                   |----  SIN                                 External
                   |----  COS                                 External
                   |----  ACOS                                External
                   |----  NREPAR                              ..WIDTH
                   |----  VZERO                               External
                   |----  QWMESE                              print message an
                   |----  IBITS                               External
                   |----  QWMESS                              print message.
  ------------------------------------------------------------------------------
 
2 NEWRUN
        SUBROUTINE NEWRUN(IROLD,IRNEW)
  ------------------------------------------------------------------------------
    CKEY SANDY /INTERNAL
  ------------------------------------------------------------------------------
    - Called for every new run
 
     Author   :- Yves A. Maumary       21-NOV-1992
     Modified :- Yves A. Maumary       29-JAN-1993  Check prod version
 
     Inputs:
          - IROLD / I    : old run number
          - IRNEW / I    : new run number
 
     Outputs:
          - none
 
     Libraries required: ALEPHLIB, BOS77
 
     Description
     ===========
     Looks for RUNH bank. Calls NUNEWR.
 
 
  ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
  ------------------------------------------------------------------------------
   NMREAD                                                     - Read next even
        |---- NEWRUN                                          .CALL USER RUN I
                   |----  SIGN                                External
                   |----  SQRT                                External
                   |----  ABS                                 External
                   |----  NINT                                External
                   |----  ATG                                 External
                   |----  IAND                                External
                   |----  ISHFT                               External
                   |----  FLOAT                               External
                   |----  BTEST                               External
                   |----  SIN                                 External
                   |----  COS                                 External
                   |----  ACOS                                External
                   |----  GETVER                              .LOOP OVER ROWS
                   |----  ALTELL                              Print text and t
                   |----  NAMIND                              External
                   |----  VZERO                               External
                   |----  GETLEP                              set of intrinsic
                   |----  MDARD                               External
                   |----  JUNIDB                              return the data
                   |----  QPMASS                              Particle mass
                   |----  NUNEWR                              - Called at each
  ------------------------------------------------------------------------------
 
2 NEWFIL
        SUBROUTINE NEWFIL
  ------------------------------------------------------------------------------
    CKEY SANDY /INTERNAL
  ------------------------------------------------------------------------------
    - Initialisation for new nano-DST file
 
     Author   :- Yves A. Maumary       21-NOV-1992
     Modified :- Yves A. Maumary       29-JAN-1993  Handling of the 'no
                                                    NDST bank' case
 
     Libraries required: ALEPHLIB,BOS77
 
     Description
     ===========
     Look for the NDST bank.
     Checks if NDST parameters are different than those from the
     previous file.
 
 
  ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
  ------------------------------------------------------------------------------
   NMREAD                                                     - Read next even
        |---- NEWFIL                                          - Initialisation
                   |----  GETVER                              .LOOP OVER ROWS
                   |----  ABUNIT                              Subr. ABRREC : R
                   |----  FLOAT                               External
                   |----  CHAINT                              External
                   |----  ALTELL                              Print text and t
                   |----  VZERO                               External
                   |----  INDEX                               External
                   |----  QWMESS                              print message.
                   |----  IBSET                               External
                   |----  BTEST                               External
                   |----  NDROP                               External
                   |----  BLIST                               External
                   |----  GETMCF                              .LOOP OVER ROWS
  ------------------------------------------------------------------------------
 
2 NUNEWR
        SUBROUTINE NUNEWR(IROLD,IRNEW)
  ------------------------------------------------------------------------------
    CKEY SANDY /USER
  ------------------------------------------------------------------------------
    - Called at each run change
 
     Author   :- Yves A. Maumary        2-MAY-1990
 
     Inputs:
          - IROLD /I   : run number of the previous run (0 if first run)
          - IRNEW /I   : run number of the new run
 
     Outputs:
          - none
 
     Libraries required:
 
     Description
     ===========
     Prints the run number and LEP energy in the log file
 
2 NMTERM
        SUBROUTINE NMTERM(MESS)
  ------------------------------------------------------------------------------
    CKEY SANDY /USER
  ------------------------------------------------------------------------------
    - Main termination routine
 
     Author   :- Yves A. Maumary       23-FEB-1990
 
     Libraries required: HBOOK (CERNLIB)
 
     Inputs:
          - none
 
     Outputs:
          - MESS  /CHAR: optional message
 
     Description
     ===========
     Calls the user termination routine, and writes the histograms file.
 
 
  ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
  ------------------------------------------------------------------------------
   NMLOOP                                                     - Main routine t
   KVNEW                                                      File     : NMACR
   KVCOPY                                                     File     : NMACR
   NDEDXK                                                     File     : NMACR
   NKBLOK                                                     File     : NMACR
        |---- NMTERM                                          - Main terminati
                   |----  TIMAX
                   |----  QWMESS                              print message.
                   |----  QWMESE                              print message an
                   |----  NUTERM                              - User terminati
                   |----  HISTDO                              External
                   |----  HROUT                               External
                   |----  HREND                               External
                   |----  NMAKSE                              - Produces a SEV
                   |----  ABWEND                              close output fil
                   |----  ACLOSE                              Purpose   : Clos
                   |----  TIMAL
                   |----  INT                                 External
                   |----  FLOAT                               External
  ------------------------------------------------------------------------------
 
2 NWRITE
        SUBROUTINE NWRITE
  ------------------------------------------------------------------------------
    CKEY SANDY IO /USER
  ------------------------------------------------------------------------------
    - Set the flag to write the event to the output file
 
     Author   :- Yves A. Maumary       24-OCT-1990
 
     Description
     ===========
     Set the flag to write the event to the output file.
 
2 NMWRIT
        SUBROUTINE NMWRIT
  ------------------------------------------------------------------------------
    CKEY SANDY IO /INTERNAL
  ------------------------------------------------------------------------------
    - Write the event to the output file
 
     Author   :- Yves A. Maumary       24-OCT-1990
 
     Libraries required: BOS77
 
     Description
     ===========
     Checks if the corresponding run record has already been written,
     if yes, write only the event list.
     If the NDST bank has to be written, then the logical XDN should be
     set to T, so that the bank gets dropped at the next event. It
     should not be dropped now, as ABWSEL only sets a flag, the record
     being output at the next ABRSEL call.
 
 
  ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
  ------------------------------------------------------------------------------
   NMLOOP                                                     - Main routine t
        |---- NMWRIT                                          - Write the even
                   |----  NDROP                               External
                   |----  BLIST                               External
                   |----  ABWSEL                              set write-event
  ------------------------------------------------------------------------------
 
2 NMAKSE
        SUBROUTINE NMAKSE
  ------------------------------------------------------------------------------
    CKEY SANDY IO /INTERNAL
  ------------------------------------------------------------------------------
    - Produces a SEVT cards file
 
     Author   :- Yves A. Maumary       11-OCT-1990
 
     Libraries required: KERNLIB
 
     Description
     ===========
     Creates the SEVT cards file, one card per run.
     If NSELEV is different from 0, make a SEVT cards file.
     Get file name from NSEL card, give default name if no card found.
 
  ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
  ------------------------------------------------------------------------------
   NMTERM                                                     - Main terminati
        |---- NMAKSE                                          - Produces a SEV
                   |----  ACDARG                              get arguments of
                   |----  NWERRC                              - Print an error
                   |----  QWMESS                              print message.
  ------------------------------------------------------------------------------
 
2 MAKSEV
        SUBROUTINE MAKSEV
  ------------------------------------------------------------------------------
    CKEY SANDY IO /USER
  ------------------------------------------------------------------------------
    - Produces an SEVT card for the current event
 
     Author   :- Yves A. Maumary       11-OCT-1990
 
     Description
     ===========
     Fills the 2-dim array ICARDS with the current run and event number
     and increments the counter.
     NSELEV has to be initialised to 0 in NMINIT, then a file is created
     if NSELEV is different from 0.
 
  ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
  ------------------------------------------------------------------------------
 
              MAKSEV                                          - Produces an SE
                   |----  QWMESS                              print message.
  ------------------------------------------------------------------------------
2 NWERRC
        SUBROUTINE NWERRC(IER,RNAM,FNAM)
  ------------------------------------------------------------------------------
    CKEY SANDY /INTERNAL
  ------------------------------------------------------------------------------
    - Print an error message according to the error flag from ACDARG
 
     Author   :- Yves A. Maumary       31-OCT-1990
 
     Inputs:
          - IER   /I    : error flag from ACDARG
          - RNAM  /CHAR : routine name from where ACDARG was called
          - FNAM  /CHAR : file name
 
 
  ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
  ------------------------------------------------------------------------------
   NMINIT                                                     File     : NMACR
   NMAKSE                                                     - Produces a SEV
        |---- NWERRC.                                         - Print an error
  ------------------------------------------------------------------------------
 
2 KVNEW
        FUNCTION KVNEW(DUMMY)
  ------------------------------------------------------------------------------
    CKEY SANDY VECTOR /USER
  ------------------------------------------------------------------------------
    - Create a new track
 
     Author   :- Yves A. Maumary       12-MAR-1990
     Modified :- Yves A. Maumary        4-FEB-1993  Enlarge NVEC if full
 
     Inputs:
          - DUMMY /R    = dummy variable
 
     Value returned: new track number
 
     Libraries required: KERNLIB
 
     Description
     ===========
     Checks if the work bank NVEC not full yet,
     if not, returns the next free track number.
     If NVEC full, enlarge it.
 
 
  ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
  ------------------------------------------------------------------------------
   NJMMCL                                                     File     : NMACR
        |---- KVNEW                                           File     : NMACR
                   |----  SIGN                                External
                   |----  SQRT                                External
                   |----  ABS                                 External
                   |----  NINT                                External
                   |----  ATG                                 External
                   |----  IAND                                External
                   |----  ISHFT                               External
                   |----  FLOAT                               External
                   |----  BTEST                               External
                   |----  SIN                                 External
                   |----  COS                                 External
                   |----  ACOS                                External
                   |----  NBANK                               External
                   |----  NMTERM                              - Main terminati
                   |----  QWMESE                              print message an
                   |----  VZERO                               External
  ------------------------------------------------------------------------------
 
2 KVCOPY
        FUNCTION KVCOPY(ITK)
  ------------------------------------------------------------------------------
    CKEY SANDY VECTOR /USER
  ------------------------------------------------------------------------------
    - Copies track ITK into a new track
 
     Author   :- Yves A. Maumary       21-JUN-1991
     Modified :- Yves A. Maumary        4-FEB-1993  Enlarge NVEC if full
 
     Inputs:
          - ITK   /I    = track to be copied
 
     Value returned: new track number
 
     Libraries required: KERNLIB
 
     Description
     ===========
     Checks if the work bank NVEC not full yet,
     if not, returns the next free track number after copying the
     attributes of track ITK into it.
     If NVEC full, enlarge it.
 
 
  ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
  ------------------------------------------------------------------------------
 
              KVCOPY                                          File     : NMACR
                   |----  SIGN                                External
                   |----  SQRT                                External
                   |----  ABS                                 External
                   |----  NINT                                External
                   |----  ATG                                 External
                   |----  IAND                                External
                   |----  ISHFT                               External
                   |----  FLOAT                               External
                   |----  BTEST                               External
                   |----  SIN                                 External
                   |----  COS                                 External
                   |----  ACOS                                External
                   |----  NBANK                               External
                   |----  NMTERM                              - Main terminati
                   |----  QWMESE                              print message an
                   |----  UCOPY                               External
  ------------------------------------------------------------------------------
2 QCOPY
        SUBROUTINE QCOPY(ITKI,ITKO)
  ------------------------------------------------------------------------------
    CKEY SANDY VECTOR /USER
  ------------------------------------------------------------------------------
    - Copies track ITKI into track ITKO
 
     Author   :- Yves A. Maumary       21-JUN-1991
 
     Inputs:
          - ITKI  /I    = track to be copied
          - ITKO  /I    = output track
 
     Description
     ===========
     Copies the attributes of track ITKI into track ITKO.
 
 
  ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
  ------------------------------------------------------------------------------
 
              QCOPY                                           File     : NMACR
                   |----  SIGN                                External
                   |----  SQRT                                External
                   |----  ABS                                 External
                   |----  NINT                                External
                   |----  ATG                                 External
                   |----  IAND                                External
                   |----  ISHFT                               External
                   |----  FLOAT                               External
                   |----  BTEST                               External
                   |----  SIN                                 External
                   |----  COS                                 External
                   |----  ACOS                                External
                   |----  UCOPY                               External
  ------------------------------------------------------------------------------
2 QVSETM
        SUBROUTINE QVSETM(ITRK,AMASS)
  ------------------------------------------------------------------------------
    CKEY SANDY KINEMATICS /USER
  ------------------------------------------------------------------------------
    - Set mass of track ITRK to AMASS
 
     Author   :- Yves A. Maumary       26-FEB-1990
 
     Inputs:
          - ITRK  /I    = track number
          - AMASS /R    = mass to assign to track ITRK
 
     Description
     ===========
     Sets mass of track ITRK equal to AMASS.
     Recomputes the energy for track ITRK.
 
 
  ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
  ------------------------------------------------------------------------------
 
              QVSETM                                          File     : NMACR
                   |----  SIGN                                External
                   |----  SQRT                                External
                   |----  ABS                                 External
                   |----  NINT                                External
                   |----  ATG                                 External
                   |----  IAND                                External
                   |----  ISHFT                               External
                   |----  FLOAT                               External
                   |----  BTEST                               External
                   |----  SIN                                 External
                   |----  COS                                 External
                   |----  ACOS                                External
  ------------------------------------------------------------------------------
2 QVADD2
        SUBROUTINE QVADD2(ISUM,ITK1,ITK2)
  ------------------------------------------------------------------------------
    CKEY SANDY KINEMATICS /USER
  ------------------------------------------------------------------------------
    - Add tracks ITK1 and ITK2 and put sum into ISUM
 
     Author   :- Yves A. Maumary       26-FEB-1990
 
     Inputs:
          - ITK1  /I    = first track number
          - ITK2  /I    = second track number
          - ISUM  /I    = track number of the sum
 
     Libraries required: KERNLIB
 
     Description
     ===========
     Adds the 4-vectors and charges of tracks ITK1 and ITK2, computes
     total momentum and invariant mass.
     The sum is put in track ISUM. The jet assignment is from track ITK1
 
  ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
  ------------------------------------------------------------------------------
 
              QVADD2                                          File     : NMACR
                   |----  SIGN                                External
                   |----  SQRT                                External
                   |----  ABS                                 External
                   |----  NINT                                External
                   |----  ATG                                 External
                   |----  IAND                                External
                   |----  ISHFT                               External
                   |----  FLOAT                               External
                   |----  BTEST                               External
                   |----  SIN                                 External
                   |----  COS                                 External
                   |----  ACOS                                External
                   |----  VZERO                               External
  ------------------------------------------------------------------------------
2 QVADD3
        SUBROUTINE QVADD3(ISUM,ITK1,ITK2,ITK3)
  ------------------------------------------------------------------------------
    CKEY SANDY KINEMATICS /USER
  ------------------------------------------------------------------------------
    - Add tracks ITK1, ITK2 and ITK3 and put sum into ISUM
 
     Author   :- Yves A. Maumary       26-FEB-1990
 
     Inputs:
          - ITK1  /I    = first track number
          - ITK2  /I    = second track number
          - ITK3  /I    = third track number
          - ISUM  /I    = track number of the sum
 
     Libraries required: KERNLIB
 
     Description
     ===========
     Adds the 4-vectors and charges of tracks ITK1, ITK2 and ITK3,
     computes total momentum and invariant mass.
     The sum is put in track ISUM. The jet assignment is from track ITK1
 
  ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
  ------------------------------------------------------------------------------
 
              QVADD3                                          File     : NMACR
                   |----  SIGN                                External
                   |----  SQRT                                External
                   |----  ABS                                 External
                   |----  NINT                                External
                   |----  ATG                                 External
                   |----  IAND                                External
                   |----  ISHFT                               External
                   |----  FLOAT                               External
                   |----  BTEST                               External
                   |----  SIN                                 External
                   |----  COS                                 External
                   |----  ACOS                                External
                   |----  VZERO                               External
  ------------------------------------------------------------------------------
2 QVADD4
        SUBROUTINE QVADD4(ISUM,ITK1,ITK2,ITK3,ITK4)
  ------------------------------------------------------------------------------
    CKEY SANDY KINEMATICS /USER
  ------------------------------------------------------------------------------
    - Add tracks ITK1, ITK2, ITK3 and ITK4 and put sum into ISUM
 
     Author   :- Yves A. Maumary       26-FEB-1990
 
     Inputs:
          - ITK1  /I    = first track number
          - ITK2  /I    = second track number
          - ITK3  /I    = third track number
          - ITK4  /I    = fourth track number
          - ISUM  /I    = track number of the sum
 
     Libraries required: KERNLIB
 
     Description
     ===========
     Adds the 4-vectors and charges of tracks ITK1, ITK2, ITK3 and ITK4,
     computes total momentum and invariant mass.
     The sum is put in track ISUM. The jet assignment is from track ITK1
 
  ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
  ------------------------------------------------------------------------------
 
              QVADD4                                          File     : NMACR
                   |----  SIGN                                External
                   |----  SQRT                                External
                   |----  ABS                                 External
                   |----  NINT                                External
                   |----  ATG                                 External
                   |----  IAND                                External
                   |----  ISHFT                               External
                   |----  FLOAT                               External
                   |----  BTEST                               External
                   |----  SIN                                 External
                   |----  COS                                 External
                   |----  ACOS                                External
                   |----  VZERO                               External
  ------------------------------------------------------------------------------
2 QVADD5
        SUBROUTINE QVADD5(ISUM,ITK1,ITK2,ITK3,ITK4,ITK5)
  ------------------------------------------------------------------------------
    CKEY SANDY KINEMATICS /USER
  ------------------------------------------------------------------------------
    - Add tracks ITK1, ITK2, ITK3, ITK4 and ITK5 and put sum into ISUM
 
     Author   :- Yves A. Maumary       26-FEB-1990
 
     Inputs:
          - ITK1  /I    = first track number
          - ITK2  /I    = second track number
          - ITK3  /I    = third track number
          - ITK4  /I    = fourth track number
          - ITK5  /I    = fifth track number
          - ISUM  /I    = track number of the sum
 
     Libraries required: KERNLIB
 
     Description
     ===========
     Adds the 4-vectors and charges of tracks ITK1, ITK2, ITK3, ITK4 and
     ITK5, computes total momentum and invariant mass.
     The sum is put in track ISUM. The jet assignment is from track ITK1
 
  ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
  ------------------------------------------------------------------------------
 
              QVADD5                                          File     : NMACR
                   |----  SIGN                                External
                   |----  SQRT                                External
                   |----  ABS                                 External
                   |----  NINT                                External
                   |----  ATG                                 External
                   |----  IAND                                External
                   |----  ISHFT                               External
                   |----  FLOAT                               External
                   |----  BTEST                               External
                   |----  SIN                                 External
                   |----  COS                                 External
                   |----  ACOS                                External
                   |----  VZERO                               External
  ------------------------------------------------------------------------------
2 QVGET3
        SUBROUTINE QVGET3(P,ITK)
  ------------------------------------------------------------------------------
    CKEY SANDY VECTOR /USER
  ------------------------------------------------------------------------------
    - Copy the momentum 3-vector of track ITK into array P
 
     Author   :- Yves A. Maumary        8-JUN-1990
 
     Inputs:
          - ITK   /I    : SANDY track number
 
     Outputs:
          - P     /R    : momentum 3-vector of track ITK
 
2 QVGET4
        SUBROUTINE QVGET4(P,ITK)
  ------------------------------------------------------------------------------
    CKEY SANDY VECTOR /USER
  ------------------------------------------------------------------------------
    - Copy the momentum 4-vector of track ITK into array P
 
     Author   :- Yves A. Maumary        8-JUN-1990
 
     Inputs:
          - ITK   /I    : SANDY track number
 
     Outputs:
          - P     /R    : momentum 4-vector of track ITK
 
2 QVSET3
        SUBROUTINE QVSET3(ITK,P)
  ------------------------------------------------------------------------------
    CKEY SANDY VECTOR /USER
  ------------------------------------------------------------------------------
    - Copy the array P into the momentum 3-vector of track ITK
 
     Author   :- Yves A. Maumary        8-JUN-1990
     Modified :- Yves A. Maumary       18-DEC-1991  Add check
 
     Inputs:
          - P     /R    : momentum 3-vector of track ITK
          - ITK   /I    : SANDY track number
 
     Description
     ===========
     Copies the array P into the momentum 3-vector of track ITK, compute
     the total momentum and the energy (assuming the mass is properly
     set).
 
 
  ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
  ------------------------------------------------------------------------------
 
              QVSET3                                          File     : NMACR
                   |----  SIGN                                External
                   |----  SQRT                                External
                   |----  ABS                                 External
                   |----  NINT                                External
                   |----  ATG                                 External
                   |----  IAND                                External
                   |----  ISHFT                               External
                   |----  FLOAT                               External
                   |----  BTEST                               External
                   |----  SIN                                 External
                   |----  COS                                 External
                   |----  ACOS                                External
                   |----  QWMESE                              print message an
  ------------------------------------------------------------------------------
2 QVSET4
        SUBROUTINE QVSET4(ITK,P)
  ------------------------------------------------------------------------------
    CKEY SANDY VECTOR /USER
  ------------------------------------------------------------------------------
    - Copy the array P into the momentum 4-vector of track ITK
 
     Author   :- Yves A. Maumary        8-JUN-1990
     Modified :- Yves A. Maumary       18-DEC-1991  Recompute the mass
 
     Inputs:
          - P     /R    : momentum 4-vector of track ITK
          - ITK   /I    : SANDY track number
 
     Description
     ===========
     Copies the array P into the momentum 4-vector of track ITK, compute
     the total momentum and the mass.
 
 
  ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
  ------------------------------------------------------------------------------
 
              QVSET4                                          File     : NMACR
                   |----  SIGN                                External
                   |----  SQRT                                External
                   |----  ABS                                 External
                   |----  NINT                                External
                   |----  ATG                                 External
                   |----  IAND                                External
                   |----  ISHFT                               External
                   |----  FLOAT                               External
                   |----  BTEST                               External
                   |----  SIN                                 External
                   |----  COS                                 External
                   |----  ACOS                                External
                   |----  QWMESE                              print message an
  ------------------------------------------------------------------------------
2 QDECA2
        FUNCTION QDECA2 (I,J)
  ------------------------------------------------------------------------------
    CKEY SANDY KINEMATICS /USER
  ------------------------------------------------------------------------------
     Author   : E. Blucher      7-OCT-1988
     Modified : Y. Maumary     13-MAR-1990 Adapted for Nano-DST
     Purpose:
     ===========
    For the 2-body decay M --> m(I) + m(J), this function calculates
    the cosine of the angle between the M momentum vector and the m(I)
    momentum vector in the M rest frame.
 
  ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
  ------------------------------------------------------------------------------
 
              QDECA2                                          File     : NMACR
                   |----  SIGN                                External
                   |----  SQRT                                External
                   |----  ABS                                 External
                   |----  NINT                                External
                   |----  ATG                                 External
                   |----  IAND                                External
                   |----  ISHFT                               External
                   |----  FLOAT                               External
                   |----  BTEST                               External
                   |----  SIN                                 External
                   |----  COS                                 External
                   |----  ACOS                                External
                   |----  DBLE                                External
                   |----  REAL                                External
  ------------------------------------------------------------------------------
2 QDECAN
        FUNCTION QDECAN (I,J)
  ------------------------------------------------------------------------------
    CKEY SANDY KINEMATICS /USER
  ------------------------------------------------------------------------------
     Author   : E. Blucher     27-JAN-1989
     Modified : Y. Maumary     13-MAR-1990 Adapted for Nano-DST
     Purpose:
     ===========
    For the decay M(I) --> m(J)+...+m(n), this function calculates
    the cosine of the angle between the M(I) momentum vector and the
    m(J) momentum vector in the M(I) rest frame.
 
 
  ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
  ------------------------------------------------------------------------------
 
              QDECAN                                          File     : NMACR
                   |----  SIGN                                External
                   |----  SQRT                                External
                   |----  ABS                                 External
                   |----  NINT                                External
                   |----  ATG                                 External
                   |----  IAND                                External
                   |----  ISHFT                               External
                   |----  FLOAT                               External
                   |----  BTEST                               External
                   |----  SIN                                 External
                   |----  COS                                 External
                   |----  ACOS                                External
                   |----  QWMESE                              print message an
  ------------------------------------------------------------------------------
2 NPRINT
        SUBROUTINE NPRINT
  ------------------------------------------------------------------------------
    CKEY SANDY IO /USER
  ------------------------------------------------------------------------------
    - Print the event
 
     Author   :- Yves A. Maumary       11-MAR-1990
 
     Description
     ===========
     Prints the charged tracks and the jets on the log file.
 
 
  ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
  ------------------------------------------------------------------------------
 
              NPRINT                                          File     : NMACR
                   |----  SIGN                                External
                   |----  SQRT                                External
                   |----  ABS                                 External
                   |----  NINT                                External
                   |----  ATG                                 External
                   |----  IAND                                External
                   |----  ISHFT                               External
                   |----  FLOAT                               External
                   |----  BTEST                               External
                   |----  SIN                                 External
                   |----  COS                                 External
                   |----  ACOS                                External
                   |----  CQPART                              return particle
                   |----  QZFR                                File     : NMACR
                   |----  KDAU                                Get the Ith daug
                   |----  KMOTH                               File     : NMACR
                   |----  KMTCH                               File     : NMACR
  ------------------------------------------------------------------------------
2 KNMTCH
        FUNCTION KNMTCH(ITK)
  ------------------------------------------------------------------------------
    CKEY SANDY MONTE /USER
  ------------------------------------------------------------------------------
    - Returns number of matched tracks
 
     Author   :- Yves A. Maumary       23-APR-1990
 
     Inputs:
          - ITK   /I    : MC track number
 
     Outputs:
          - none
 
     Description
     ===========
     Returns 1 if there is a matching track, else 0.
 
 
  ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
  ------------------------------------------------------------------------------
 
              KNMTCH                                          File     : NMACR
                   |----  SIGN                                External
                   |----  SQRT                                External
                   |----  ABS                                 External
                   |----  NINT                                External
                   |----  ATG                                 External
                   |----  IAND                                External
                   |----  ISHFT                               External
                   |----  FLOAT                               External
                   |----  BTEST                               External
                   |----  SIN                                 External
                   |----  COS                                 External
                   |----  ACOS                                External
                   |----  KMTCH                               File     : NMACR
  ------------------------------------------------------------------------------
2 KNMOTH
        FUNCTION KNMOTH(ITK)
  ------------------------------------------------------------------------------
    CKEY SANDY MONTE /USER
  ------------------------------------------------------------------------------
    - Returns number of mothers
 
     Author   :- Yves A. Maumary       23-APR-1990
 
     Inputs:
          - ITK   /I    : MC track number
 
     Outputs:
          - none
 
     Description
     ===========
     Returns 1 if there is a mother track, else 0.
 
 
  ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
  ------------------------------------------------------------------------------
 
              KNMOTH                                          File     : NMACR
                   |----  SIGN                                External
                   |----  SQRT                                External
                   |----  ABS                                 External
                   |----  NINT                                External
                   |----  ATG                                 External
                   |----  IAND                                External
                   |----  ISHFT                               External
                   |----  FLOAT                               External
                   |----  BTEST                               External
                   |----  SIN                                 External
                   |----  COS                                 External
                   |----  ACOS                                External
                   |----  KMOTH                               File     : NMACR
  ------------------------------------------------------------------------------
2 KMOTH
        FUNCTION KMOTH(ITK)
  ------------------------------------------------------------------------------
    CKEY SANDY MONTE /USER
  ------------------------------------------------------------------------------
    - Returns the track number of the mother
 
     Author   :- M. Maggi               5-Jun-1990
     Modified :- Yves A. Maumary        7-JAN-1993  Changes: MC in NVEC
 
     Inputs:
          - ITK   /I    : MC track number
 
     Outputs:
          - none
 
     Description
     ===========
     Returns the track number of the mother
 
 
  ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
  ------------------------------------------------------------------------------
   NPRINT                                                     File     : NMACR
   KNMOTH                                                     File     : NMACR
   DECSEA                                                     File     : NMACR
   PRIDEC                                                     File     : NMACR
   DAUSEA                                                     File     : NMACR
        |---- KMOTH                                           File     : NMACR
                   |----  SIGN                                External
                   |----  SQRT                                External
                   |----  ABS                                 External
                   |----  NINT                                External
                   |----  ATG                                 External
                   |----  IAND                                External
                   |----  ISHFT                               External
                   |----  FLOAT                               External
                   |----  BTEST                               External
                   |----  SIN                                 External
                   |----  COS                                 External
                   |----  ACOS                                External
  ------------------------------------------------------------------------------
 
2 KMTCH
        FUNCTION KMTCH(ITK)
  ------------------------------------------------------------------------------
    CKEY SANDY MONTE /USER
  ------------------------------------------------------------------------------
    - Returns the best matched reconstructed track
 
     Author   :- Yves A. Maumary       14-MAR-1991
     Modified :- Yves A. Maumary        7-JAN-1993  Changes: MC in NVEC
 
     Inputs:
          - ITK   /I    : MC track number
 
     Outputs:
          - none
 
     Description
     ===========
     Returns the SANDY track number of the reconstructed track
     for photons or charged track and 0 if there is no reconstructed
     track. Gives an error if called for an unstable track.
 
 
  ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
  ------------------------------------------------------------------------------
   NPRINT                                                     File     : NMACR
   KNMTCH                                                     File     : NMACR
   NDEDXM                                                     File     : NMACR
   NMTAIL                                                     File     : NMACR
   PRIDEC                                                     File     : NMACR
        |---- KMTCH                                           File     : NMACR
                   |----  SIGN                                External
                   |----  SQRT                                External
                   |----  ABS                                 External
                   |----  NINT                                External
                   |----  ATG                                 External
                   |----  IAND                                External
                   |----  ISHFT                               External
                   |----  FLOAT                               External
                   |----  BTEST                               External
                   |----  SIN                                 External
                   |----  COS                                 External
                   |----  ACOS                                External
  ------------------------------------------------------------------------------
 
2 QZFR
        FUNCTION QZFR(ITK)
  ------------------------------------------------------------------------------
    CKEY SANDY MONTE /USER
  ------------------------------------------------------------------------------
    - Returns the z value of the fragmentation
 
     Author   :- Yves A. Maumary       14-MAR-1991
     Modified :- Yves A. Maumary        7-JAN-1993  Changes: MC in NVEC
 
     Inputs:
          - ITK   /I    : MC track number
 
     Outputs:
          - none
 
     Description
     ===========
     Returns the z value from fragmentation if there. Gives an error if
     called for a stable track.
 
 
  ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
  ------------------------------------------------------------------------------
   NPRINT                                                     File     : NMACR
        |---- QZFR                                            File     : NMACR
                   |----  SIGN                                External
                   |----  SQRT                                External
                   |----  ABS                                 External
                   |----  NINT                                External
                   |----  ATG                                 External
                   |----  IAND                                External
                   |----  ISHFT                               External
                   |----  FLOAT                               External
                   |----  BTEST                               External
                   |----  SIN                                 External
                   |----  COS                                 External
                   |----  ACOS                                External
                   |----  QWMESE                              print message an
  ------------------------------------------------------------------------------
 
2 QEIDRI
        FUNCTION QEIDRI(I,N)
  ------------------------------------------------------------------------------
    CKEY SANDY PHYSICS /USER
  ------------------------------------------------------------------------------
    - Returns electron estimator N for track I
 
     Author   :- Yves A. Maumary       21-FEB-1991
 
     Inputs:
          - I     / I    : SANDY track number (now DUMMY)
          - N     / I    : estimator          (now DUMMY)
 
     Outputs:
          - none
 
 
     Description
     ===========
 
     Now a dummy routine because change to BMLT bank.
 
     Returns the electron estimator N for track I, provided it exists.
     One has to check if electron ID is available for track I with XEID.
 
 
  ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
  ------------------------------------------------------------------------------
 
              QEIDRI                                          File     : NMACR
                   |----  SIGN                                External
                   |----  SQRT                                External
                   |----  ABS                                 External
                   |----  NINT                                External
                   |----  ATG                                 External
                   |----  IAND                                External
                   |----  ISHFT                               External
                   |----  FLOAT                               External
                   |----  BTEST                               External
                   |----  SIN                                 External
                   |----  COS                                 External
                   |----  ACOS                                External
                   |----  QWMESE                              print message an
  ------------------------------------------------------------------------------
2 CQPART
        FUNCTION CQPART (N)
  ------------------------------------------------------------------------------
    CKEY SANDY PART /USER
  ------------------------------------------------------------------------------
   return particle name CQPART for particle code N
   called from anywhere
                                                     H.Albrecht 18.10.88
                                           Modified: Y. Maumary 21.08.92
 
  ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
  ------------------------------------------------------------------------------
   NPRINT                                                     File     : NMACR
   PRIDEC                                                     File     : NMACR
        |---- CQPART                                          return particle
                   |----  CHAINT                              External
  ------------------------------------------------------------------------------
 
2 KPART
        FUNCTION KPINIT (CINP)
  ------------------------------------------------------------------------------
    CKEY SANDY PART /INTERNAL
  ------------------------------------------------------------------------------
   ENTRY KPART: Get particle code KPART for particle name CNAM
 
         initialisation for KPART. This is simply a fast GOTO.
                                                     H.Albrecht 27.11.88
                                           Modified: Y. Maumary 21.08.92
 
  ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
  ------------------------------------------------------------------------------
   QPMASS                                                     Particle mass
   QPCHAR                                                     Particle charge
   QPLIFE                                                     Particle life ti
   QPWIDT                                                     Particle width
   DECSEA                                                     File     : NMACR
   DAUSEA                                                     File     : NMACR
        |---- KPART                                           Get particle cod
                   |----  LEN                                 External
                   |----  KPCOMP                              Get particle cod
                   |----  QWMESS                              print message.
  ------------------------------------------------------------------------------
 
2 KCANTI
        FUNCTION KCANTI (IPC,IANTI)
  ------------------------------------------------------------------------------
    CKEY SANDY PART /USER
  ------------------------------------------------------------------------------
   Return IPC (if IANTI = 0) or anti-particle code (if IANTI .ne. 0)
                                                    H.Albrecht 27.11.88
                                           Modified: Y. Maumary 21.08.92
 
  ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
  ------------------------------------------------------------------------------
   DECSEA                                                     File     : NMACR
   DAUSEA                                                     File     : NMACR
        |---- KCANTI.                                         Return IPC (if I
  ------------------------------------------------------------------------------
 
2 QPMASS
        FUNCTION QPMASS (CPAR)
  ------------------------------------------------------------------------------
    CKEY SANDY PART /USER
  ------------------------------------------------------------------------------
   Particle mass
                                                     H.Albrecht 27.11.88
                                           Modified: Y. Maumary 21.08.92
 
  ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
  ------------------------------------------------------------------------------
   NEWRUN                                                     .CALL USER RUN I
   NDEDXM                                                     File     : NMACR
   NMTAIL                                                     File     : NMACR
        |---- QPMASS                                          Particle mass
                   |----  KPART                               Get particle cod
  ------------------------------------------------------------------------------
 
2 QPCHAR
        FUNCTION QPCHAR (CPAR)
  ------------------------------------------------------------------------------
    CKEY SANDY PART /USER
  ------------------------------------------------------------------------------
   Particle charge
                                                     H.Albrecht 27.11.88
                                           Modified: Y. Maumary 21.08.92
 
  ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
  ------------------------------------------------------------------------------
 
              QPCHAR                                          Particle charge
                   |----  KPART                               Get particle cod
  ------------------------------------------------------------------------------
2 QPLIFE
        FUNCTION QPLIFE (CPAR)
  ------------------------------------------------------------------------------
    CKEY SANDY PART /USER
  ------------------------------------------------------------------------------
   Particle life time
                                                     H.Albrecht 27.11.88
                                           Modified: Y. Maumary 21.08.92
 
  ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
  ------------------------------------------------------------------------------
 
              QPLIFE                                          Particle life ti
                   |----  KPART                               Get particle cod
  ------------------------------------------------------------------------------
2 QPWIDT
        FUNCTION QPWIDT (CPAR)
  ------------------------------------------------------------------------------
    CKEY SANDY PART /USER
  ------------------------------------------------------------------------------
   Particle width
                                                     H.Albrecht 27.11.88
                                           Modified: Y. Maumary 21.08.92
 
  ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
  ------------------------------------------------------------------------------
 
              QPWIDT                                          Particle width
                   |----  KPART                               Get particle cod
  ------------------------------------------------------------------------------
2 KPCOMP
        FUNCTION KPCOMP (CINP)
  ------------------------------------------------------------------------------
    CKEY SANDY PART /INTERNAL
  ------------------------------------------------------------------------------
   Get particle code from PART. Input : particle name CINP
                                                     H.Albrecht 27.11.88
                                                     Y.Maumary  26.08.92
 
  ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
  ------------------------------------------------------------------------------
   KPINIT                                                     Get particle cod
   KPANTI                                                     Get particle cod
   KPART                                                      Get particle cod
        |---- KPCOMP                                          Get particle cod
                   |----  SPACES                              External
                   |----  CLTOU                               External
                   |----  CHAINT                              External
  ------------------------------------------------------------------------------
 
2 NDEDX
        SUBROUTINE NDEDX(ITK,N,RMASS,QH,RI,NS,TL,RIEXP,SIGMA,IER)
  ------------------------------------------------------------------------------
    CKEY SANDY DEDX /USER
  ------------------------------------------------------------------------------
    - dE/dx analysis in SANDY
 
     Author   :- Yves A. Maumary       23-OCT-1992
     Modified version of R. Johnson's QDEDX routine
 
      Input:   ITK      /I       SANDY track number
               N        /I       Number of hypothesis to try
               RMASS(n) /R       Mass hypotheses
               QH(n)    /R       Charge hypotheses (sign doesn't matter)
      Output:  RI       /R       Measured ionization (1.O=minion, Q=1)
               NS       /I       Number of useful wire samples on track
               TL       /R       Useful length of the track (cm)
               RIEXP(n) /R       Expected ionization for the given
                                 mass hypothesis (1.0=minion, Q=1)
               SIGMA(n) /R       Sigma of dE/dx measurement error,
                                 including the momentum error.
                                 Note that one can calculate a
                                 chi-squared with 1 d.o.f. as:
                                 chi2 = ((RI-RIEXP)/SIGMA)**2
               IER      /I       Error return= 0 for success
                                 1= can't find track bank or not
                                    a reconstructed charged track
                                 2= can't find dE/dx bank
                                 3= track has no dE/dx information
                                 4= can't find calibration banks
                                    TC1X, TC2X, and/or TC3X
                                 5= cannot find RUNH or EVEH bank
                                    from which to get the run number
 
     Libraries required: ALEPHLIB
 
     Description
     ===========
     Get the TC3X calibration bank for the current run, apply it on the
     measured ionisation from QRIMES (TC3X is NOT applied at the nanoDST
     production step), and finally call TXDEDX for the expected
     ionisation and error for the various mass hypotheses.
 
 
  ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
  ------------------------------------------------------------------------------
   NDEDXM                                                     File     : NMACR
   NMTAIL                                                     File     : NMACR
        |---- NDEDX                                           File     : NMACR
                   |----  SIGN                                External
                   |----  SQRT                                External
                   |----  ABS                                 External
                   |----  NINT                                External
                   |----  ATG                                 External
                   |----  IAND                                External
                   |----  ISHFT                               External
                   |----  FLOAT                               External
                   |----  BTEST                               External
                   |----  SIN                                 External
                   |----  COS                                 External
                   |----  ACOS                                External
                   |----  NAMIND                              External
                   |----  ABRUEV                              Returns current
                   |----  GTSTUP                              set of intrinsic
                   |----  ALGTDB                              Load  list LIST
                   |----  JUNIDB                              return the data
                   |----  QWMESE                              print message an
                   |----  ALOG                                External
                   |----  TXDEDX                              Get banks from D
  ------------------------------------------------------------------------------
 
2 NDEDXM
        SUBROUTINE NDEDXM(ITK,N,RMASS,QH,RI,NS,TL,RIEXP,SIGMA,IER)
  ------------------------------------------------------------------------------
    CKEY SANDY DEDX /USER
  ------------------------------------------------------------------------------
 
   Modified version of R. Johnson's QDEDXM program for SANDY.
   On production, RI, RSIG, TL and NS from TPCSIM are stored.
 
     Author   :- R. Johnson   10-5-90
     Modified :- Yves A. Maumary       27-OCT-1992 For SANDY 111
     Modified :- Gerrit Graefe         13-MAY-1994 For SANDY 115 added some
                                                       corrections.
     Modified :- Gerrit Graefe         10-MAY-1994 Added Dave Caspars bug
                                                   fixes for early 92 MC
 
   Analyse dE/dx for Monte Carlo events by faking the ionization
   with a gaussian random number.  If called for real data, the
   result will be the same as if QDEDX were called.
 
 
      Input:   ITK      /I       SANDY track number
               N        /I       Number of hypothesis to try
               RMASS(n) /R       Mass hypotheses
               QH(n)    /R       Charge hypotheses (sign doesn't matter)
      Output:  RI       /R       Measured ionization (1.O=minion, Q=1)
               NS       /I       Number of useful wire samples on track
               TL       /R       Useful length of the track (cm)
               RIEXP(n) /R       Expected ionization for the given
                                 mass hypothesis (1.0=minion, Q=1)
               SIGMA(n) /R       Sigma of dE/dx measurement error,
                                 including the momentum error.
                                 Note that one can calculate a
                                 chi-squared with 1 d.o.f. as:
                                 chi2 = ((RI-RIEXP)/SIGMA)**2
               IER      /I       Error return= 0 for success
                                 1= can't find track bank or not
                                    a reconstructed charged track
                                 3= track has no dE/dx information
                                 4= can't find calibration banks
                                    TC1X, TC2X, and/or TC3X, TC4X
                                 6= No MC truth
     Input to the entry point NMTAIL.  This entry may be called to
     -----                    ------   set the parameter TAIL, which
                                       otherwise defaults to 999. It
                                       only need be called once.
               TAIL     /R        If the dE/dx from TPCSIM is more than
                                  TAIL sigmas from the "true" mean dE/dx
                                  then the TPCSIM dE/dx will be kept.
                                  This is to allow one to retain some
                                  of the simulation of tails, which
                                  usually arise from track overlap.
                                  If TAIL is set less than 3.0, then
                                  the value 3.0 is used. Set to a large
                                  value if you don't want this feature.
 
 
  ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
  ------------------------------------------------------------------------------
 
              NDEDXM                                          File     : NMACR
                   |----  SIGN                                External
                   |----  SQRT                                External
                   |----  ABS                                 External
                   |----  NINT                                External
                   |----  ATG                                 External
                   |----  IAND                                External
                   |----  ISHFT                               External
                   |----  FLOAT                               External
                   |----  BTEST                               External
                   |----  SIN                                 External
                   |----  COS                                 External
                   |----  ACOS                                External
                   |----  NDEDX                               File     : NMACR
                   |----  NAMIND                              External
                   |----  CHAINT                              External
                   |----  QWMESE                              print message an
                   |----  KMTCH                               File     : NMACR
                   |----  QPMASS                              Particle mass
                   |----  INT                                 External
                   |----  RDMIN                               External
                   |----  RANNOR                              External
                   |----  NDEDXK                              File     : NMACR
                   |----  NKBLOK                              File     : NMACR
  ------------------------------------------------------------------------------
2 NDEDXK
        SUBROUTINE NDEDXK(IRUN,P,Q,RMASS,DX,NSMP,DEDX,EDEDX,SIGMA)
  ------------------------------------------------------------------------------
    CKEY SANDY DEDX MONTE /INTERNAL
  ------------------------------------------------------------------------------
   Fast, simple dE/dx simulation of a single track.
 
     Author   :- R. Johnson   5-02-90
     Modified :- Yves A. Maumary       27-OCT-1992 For SANDY 111
 
    Input:    IRUN       /I       Run number for calibration constants
              P          /R       Track momentum
              Q          /R       Particle charge
              RMASS      /R       Particle mass
              DX         /R       Average sample length
              NSMP       /I       Number of dE/dx samples
    Output:   DEDX       /R       Simulated dE/dx
              EDEDX      /R       Expected mean dE/dx
              SIGMA      /R       dE/dx resolution
 
  ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
  ------------------------------------------------------------------------------
   NDEDXM                                                     File     : NMACR
   NMTAIL                                                     File     : NMACR
        |---- NDEDXK                                          File     : NMACR
                   |----  SIGN                                External
                   |----  SQRT                                External
                   |----  ABS                                 External
                   |----  NINT                                External
                   |----  ATG                                 External
                   |----  IAND                                External
                   |----  ISHFT                               External
                   |----  FLOAT                               External
                   |----  BTEST                               External
                   |----  SIN                                 External
                   |----  COS                                 External
                   |----  ACOS                                External
                   |----  NDANR                               External
                   |----  JUNIDB                              return the data
                   |----  NMTERM                              - Main terminati
                   |----  MDARD                               External
                   |----  NDROP                               External
                   |----  NKBLOK                              File     : NMACR
                   |----  RANNOR                              External
  ------------------------------------------------------------------------------
 
2 NKBLOK
        FUNCTION NKBLOK(IRUN,BG,Q)
  ------------------------------------------------------------------------------
    CKEY SANDY DEDX /INTERNAL
  ------------------------------------------------------------------------------
   Bethe-Bloch parameterization of TPC dE/dx which always uses the
   parameterization for data (run 6001) regardless of current run
   number (this is to be used for MC simulation).
 
     Created by Robert P. Johnson     22-AUG-1988
     Modified :- Gerrit Graefe        13-MAY-1994 For SANDY 115
                                                  replaces TBBLOK
 
     Inputs    : IRUN      /I      Run number for calibration constants
                 BG        /R      beta*gamma
                 Q         /R      particle charge
     Outputs   : NKBLOK    /R      dE/dx with minion=1.0
                                   Set to zero if Q=0 or if the
                                   calibration cannot be found.
 
 
  ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
  ------------------------------------------------------------------------------
   NDEDXM                                                     File     : NMACR
   NMTAIL                                                     File     : NMACR
   NDEDXK                                                     File     : NMACR
        |---- NKBLOK                                          File     : NMACR
                   |----  SIGN                                External
                   |----  SQRT                                External
                   |----  ABS                                 External
                   |----  NINT                                External
                   |----  ATG                                 External
                   |----  IAND                                External
                   |----  ISHFT                               External
                   |----  FLOAT                               External
                   |----  BTEST                               External
                   |----  SIN                                 External
                   |----  COS                                 External
                   |----  ACOS                                External
                   |----  NDANR                               External
                   |----  JUNIDB                              return the data
                   |----  NMTERM                              - Main terminati
                   |----  MDARD                               External
                   |----  NDROP                               External
                   |----  ALOG                                External
  ------------------------------------------------------------------------------
 
2 GETJUV
        SUBROUTINE GETJUV(JUVER)
  ------------------------------------------------------------------------------
    CKEY SANDY /INTERNAL
  ------------------------------------------------------------------------------
    - Returns the JULIA version used for reconstruction
 
     Author   :- Yves A. Maumary       17-JAN-1992
     Modified :- Yves A. Maumary       14-AUG-1992  Bug correction
 
     Inputs:
          - none
 
     Outputs:
          - JUVER /I    : JULIA version
 
     Libraries required: BOS77
 
     Description
     ===========
     Input bank : RHAH  ( Run Header Analysis History )
 
 
  ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
  ------------------------------------------------------------------------------
 
              GETJUV                                          .LOOP OVER ALL R
                   |----  NAMIND                              External
                   |----  ALTELL                              Print text and t
                   |----  CHAINT                              External
  ------------------------------------------------------------------------------
2 GETVER
        SUBROUTINE GETVER(IVERP,ICORP)
  ------------------------------------------------------------------------------
    CKEY SANDY /INTERNAL
  ------------------------------------------------------------------------------
    - Returns version and correction file number used for production
 
     Author   :- Yves A. Maumary       29-JAN-1993
 
     Inputs:
          - none
 
     Outputs:
          - IVERP /I    : version number
          - ICORP /I    : correction file number
 
     Libraries required: BOS77
 
     Description
     ===========
     Input bank : RHAH  ( Run Header Analysis History )
 
 
  ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
  ------------------------------------------------------------------------------
   NEWRUN                                                     .CALL USER RUN I
   NEWFIL                                                     - Initialisation
        |---- GETVER                                          .LOOP OVER ROWS
                   |----  NAMIND                              External
                   |----  ALTELL                              Print text and t
                   |----  CHAINT                              External
  ------------------------------------------------------------------------------
 
2 GETMCF
        SUBROUTINE GETMCF(FLAG)
  ------------------------------------------------------------------------------
    CKEY SANDY /INTERNAL
  ------------------------------------------------------------------------------
    - Returns T if Monte Carlo data
 
     Author   :- Yves A. Maumary       29-JAN-1993
     Modified :- Yves A. Maumary       19-FEB-1993  Kill blanks in
                                                    ONLINE if necessary
 
     Inputs:
          - none
 
     Outputs:
          - FLAG  /L    : MC flag
 
     Libraries required: BOS77
 
     Description
     ===========
     Input bank : RHAH  ( Run Header Analysis History )
     The input is considered to be REAL DATA if 'ONLINE' is found in one
     of the rows, else it is Monte Carlo.
 
  ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
  ------------------------------------------------------------------------------
   NEWFIL                                                     - Initialisation
        |---- GETMCF                                          .LOOP OVER ROWS
                   |----  NAMIND                              External
                   |----  ALTELL                              Print text and t
                   |----  CHAINT                              External
                   |----  SPACES                              External
  ------------------------------------------------------------------------------
 
2 DECSEA
        SUBROUTINE DECSEA(IMOTH,ND,NSTA,ITKA)
  ------------------------------------------------------------------------------
    CKEY SANDY MONTE /USER
  ------------------------------------------------------------------------------
    - Find all MC tracks ITKS that come from IMOTH
 
     Author   :- Yves A. Maumary       15-NOV-1991
 
     Inputs:
          - IMOTH /I    : SANDY track number of mother
 
     Outputs:
          - ND    /I    : number of [[grand]^n -]daughters
          - NSTA  /I    : number of 'stable' particles
          - ITKA  /I    : 2-dim array with
                          (1,i) the SANDY track number of the
                                [[grand]^n -]daughter
                          (2,i) the generation (mother is generation 0)
                                Negative generation means 'stable'
                                particle
                          The array starts at generation 1.
 
     Libraries required: none
 
     Description
     ===========
     For all tracks in the list of MC track, make an iterative search
     up the parenthood tree until we find the [[grand]^n -]mother
     IMOTH or 0. If the end result is 0, then that particle does not
     originate from IMOTH.
     Does NOT count particles from decays of 'usually stable' particles
     such as pions, kaons and protons (i.e. if the mother of a particle
     is a charged pion, charged kaon, or proton, it will not be
     considered as a daughter).
     A 'stable' particle means: the particle has 0 daughters or it is
     an electron, muon charged pion, charged kaon or proton.
     Anti-particles are always implied.
 
  ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
  ------------------------------------------------------------------------------
   PRIDEC                                                     File     : NMACR
        |---- DECSEA                                          File     : NMACR
                   |----  SIGN                                External
                   |----  SQRT                                External
                   |----  ABS                                 External
                   |----  NINT                                External
                   |----  ATG                                 External
                   |----  IAND                                External
                   |----  ISHFT                               External
                   |----  FLOAT                               External
                   |----  BTEST                               External
                   |----  SIN                                 External
                   |----  COS                                 External
                   |----  ACOS                                External
                   |----  KPART                               Get particle cod
                   |----  KMOTH                               File     : NMACR
                   |----  KCANTI                              Return IPC (if I
  ------------------------------------------------------------------------------
 
2 PRIDEC
        SUBROUTINE PRIDEC(ITK)
  ------------------------------------------------------------------------------
    CKEY SANDY MONTE /USER
  ------------------------------------------------------------------------------
    - Print the decay tree of MC particle ITK
 
     Author   :- Yves A. Maumary       15-NOV-1991
 
     Inputs:
          - ITK   /I    : SANDY track number
 
     Outputs:
          - none
 
     Libraries required: none
 
     Description
     ===========
     First calls DECSEA to get all the descendants, then print the
     decay tree in the log file. A # means 'stable' particle (see
     description of routine DECSEA).
 
  ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
  ------------------------------------------------------------------------------
 
              PRIDEC                                          File     : NMACR
                   |----  SIGN                                External
                   |----  SQRT                                External
                   |----  ABS                                 External
                   |----  NINT                                External
                   |----  ATG                                 External
                   |----  IAND                                External
                   |----  ISHFT                               External
                   |----  FLOAT                               External
                   |----  BTEST                               External
                   |----  SIN                                 External
                   |----  COS                                 External
                   |----  ACOS                                External
                   |----  DECSEA                              File     : NMACR
                   |----  QWMESE                              print message an
                   |----  CQPART                              return particle
                   |----  KMOTH                               File     : NMACR
                   |----  KMTCH                               File     : NMACR
  ------------------------------------------------------------------------------
2 DAUSEA
        SUBROUTINE DAUSEA(IMOTH,KODE,NBD,ITKS)
  ------------------------------------------------------------------------------
    CKEY SANDY MONTE /USER
  ------------------------------------------------------------------------------
    - Find all MC tracks ITKS of type KODE that come from IMOTH
 
     Author   :- Yves A. Maumary       20-JUN-1991
 
     Inputs:
          - IMOTH /I    : SANDY track number of mother
          - KODE  /I    : particle code
 
     Outputs:
          - NBD   /I    : number of [[grand]^n -]daughters of type code
          - ITKS  /I    : array with the SANDY track number of the
                          [[grand]^n -]daughters
 
     Libraries required: none
 
     Description
     ===========
     For all tracks of type KODE in the list of MC track, make an
     iterative search up the parenthood tree until we find the
     [[grand]^n -]mother IMOTH or 0. If the end result is 0, then that
     particle does not originate from IMOTH.
     Does NOT count particles from decays of 'usually stable' particles
     such as pions, kaons and protons (i.e. if the mother of a particle
     is a charged pion, charged kaon, or proton, it will not be
     considered).
 
  ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
  ------------------------------------------------------------------------------
 
              DAUSEA                                          File     : NMACR
                   |----  SIGN                                External
                   |----  SQRT                                External
                   |----  ABS                                 External
                   |----  NINT                                External
                   |----  ATG                                 External
                   |----  IAND                                External
                   |----  ISHFT                               External
                   |----  FLOAT                               External
                   |----  BTEST                               External
                   |----  SIN                                 External
                   |----  COS                                 External
                   |----  ACOS                                External
                   |----  KPART                               Get particle cod
                   |----  KMOTH                               File     : NMACR
                   |----  KCANTI                              Return IPC (if I
  ------------------------------------------------------------------------------
2 NINFO
        SUBROUTINE NINFO
  ------------------------------------------------------------------------------
    CKEY SANDY IO /USER
  ------------------------------------------------------------------------------
    - Print NanoDST production parameters
 
     Author   :- Yves A. Maumary       11-DEC-1991
     Modified :- Yves A. Maumary       29-JAN-1993  Exit if no NDST bank
                                                    read yet
     Modified :- Gerrit Graefe         13-APR-1994  implemented new banks
 
 
  ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
  ------------------------------------------------------------------------------
 
              NINFO                                           File     : NMACR
                   |----  SIGN                                External
                   |----  SQRT                                External
                   |----  ABS                                 External
                   |----  NINT                                External
                   |----  ATG                                 External
                   |----  IAND                                External
                   |----  ISHFT                               External
                   |----  FLOAT                               External
                   |----  BTEST                               External
                   |----  SIN                                 External
                   |----  COS                                 External
                   |----  ACOS                                External
                   |----  PRRHAH                              set of intrinsic
                   |----  INDEX                               External
  ------------------------------------------------------------------------------
2 QWMESE
        SUBROUTINE QWMESE(TEXT)
  ------------------------------------------------------------------------------
    CKEY SANDY IO /USER
  ------------------------------------------------------------------------------
   print message and run/event number.
   called from : anywhere
                                                     H.Albrecht 20.09.88
                                           Modified: E. Blucher 31.08.89
                                           Modified: Y. Maumary 18.12.91
 
  ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
  ------------------------------------------------------------------------------
   NMLOOP                                                     - Main routine t
   NMREAD                                                     - Read next even
   NFILL                                                      File     : NMACR
   NMTERM                                                     - Main terminati
   KVNEW                                                      File     : NMACR
   KVCOPY                                                     File     : NMACR
   QVSET3                                                     File     : NMACR
   QVSET4                                                     File     : NMACR
   QDECAN                                                     File     : NMACR
   QZFR                                                       File     : NMACR
   QEIDRI                                                     File     : NMACR
   NDEDX                                                      File     : NMACR
   NDEDXM                                                     File     : NMACR
   NMTAIL                                                     File     : NMACR
   PRIDEC                                                     File     : NMACR
   NEWJET                                                     File     : NMACR
   NGJMMC                                                     File     : NMACR
   QPI0DO                                                     File     : NMACR
   NREPAR                                                     ..WIDTH
        |---- QWMESE                                          print message an
                   |----  LEN                                 External
  ------------------------------------------------------------------------------
 
2 QWMESS
        SUBROUTINE QWMESS(TEXT)
  ------------------------------------------------------------------------------
    CKEY SANDY IO /USER
  ------------------------------------------------------------------------------
   print message.
   called from : anywhere
                                                     H.Albrecht 20.09.88
                                           Modified: E. Blucher 31.08.89
                                           Modified: Y. Maumary 18.12.91
 
  ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
  ------------------------------------------------------------------------------
   NMINIT                                                     File     : NMACR
   NFILL                                                      File     : NMACR
   NEWFIL                                                     - Initialisation
   NMTERM                                                     - Main terminati
   NMAKSE                                                     - Produces a SEV
   MAKSEV                                                     - Produces an SE
   KPINIT                                                     Get particle cod
   KPANTI                                                     Get particle cod
   KPART                                                      Get particle cod
   QPI0DO                                                     File     : NMACR
        |---- QWMESS                                          print message.
                   |----  LEN                                 External
  ------------------------------------------------------------------------------
 
2 DUMMY
        SUBROUTINE NUINIT
  ------------------------------------------------------------------------------
    CKEY
  ------------------------------------------------------------------------------
    - User initialisation
        END
        SUBROUTINE NUEVNT
    - User event analysis routine
        END
        SUBROUTINE NUTERM
    - User termination
        END
2 FILLV0
        SUBROUTINE FILLV0(IRET)
  ------------------------------------------------------------------------------
    CKEY SANDY V0 /USER
  ------------------------------------------------------------------------------
    - Create and fill YRFT from NDV0
 
     Author   :- Yves A. Maumary       30-SEP-1992
     Modified :- Gerrit Graefe         06-JUL-1994 removed code and print
                                                   warning
 
     Inputs:
          - none
 
     Outputs:
          - IRET  /I  = 1 if bank was created
                        0 else
 
     Libraries required: ALEPHLIB, BOS77
 
     Description
     ===========
     Create bank YRFT and fill it from NDV0.
     The pointer JNVEPO of the charged tracks points to the row number
     of YRFT if the charged tracks comes from a V0.
 
 
  ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
  ------------------------------------------------------------------------------
 
              FILLV0                                          - Create and fil
                   |----  ALTELL                              Print text and t
  ------------------------------------------------------------------------------
2 NJMMCL
        SUBROUTINE NJMMCL(NJETS,KFI,KLI,KFO,KLO,RMCUT,EVIS)
  ------------------------------------------------------------------------------
    CKEY SANDY JETS /USER
  ------------------------------------------------------------------------------
     Author   : P. Perez       28-MAR-1989
     Modified : C. Bowdery      5-OCT-1990
     Modified : C. Bowdery     18-APR-1991 to use the E scheme explicitly
     Modified : C. Bowdery     28-APR-1991 to use the NORMAL algorithm
     Modified : C. Bowdery     18-OCT-1991 to call QGJMMC
     Modified : H. Duarte      08-OCT-1992 to be used in SANDY 111
     Modified : Yves Maumary   28-OCT-1992 change interface
 
     Description
     ===========
     Call NGJMMC, the improved, generalised jade algorithm jet finder
     with the arguments set to 'E' scheme and normal JADE algorithm
     for SANDY.
 
    Input   : KFI             SANDY track number of first object
              KLI             SANDY track number of last object
              RMCUT           cluster mass cut value
                              ( Ycut = (RMCUT/EVIS)**2 )
              EVIS            visible energy for normalisation
                              (if EVIS=0., it is computed from the
                               input particle energies)
 
    Output  : NJETS           number of jets found or error code if <0
              KFO             SANDY track number of first new object
              KLO             SANDY track number of last new object
 
 
  ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
  ------------------------------------------------------------------------------
 
              NJMMCL                                          File     : NMACR
                   |----  SIGN                                External
                   |----  SQRT                                External
                   |----  ABS                                 External
                   |----  NINT                                External
                   |----  ATG                                 External
                   |----  IAND                                External
                   |----  ISHFT                               External
                   |----  FLOAT                               External
                   |----  BTEST                               External
                   |----  SIN                                 External
                   |----  COS                                 External
                   |----  ACOS                                External
                   |----  NGJMMC                              File     : NMACR
                   |----  VZERO                               External
                   |----  KVNEW                               File     : NMACR
  ------------------------------------------------------------------------------
2 NEWJET
        SUBROUTINE NEWJET(NJETS,RMCUT)
  ------------------------------------------------------------------------------
    CKEY SANDY JETS /USER
  ------------------------------------------------------------------------------
     Author   : Yves Maumary   28-OCT-1992
 
     Description
     ===========
     Call NGJMMC, the improved, generalised jade algorithm jet finder
     with the arguments set to 'E' scheme and normal JADE algorithm
     for SANDY.
 
    Input   : RMCUT           cluster mass cut value
                              ( Ycut = (RMCUT/EVIS)**2 )
 
    Output  : NJETS           number of jets found or error code if <0
 
 
  ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
  ------------------------------------------------------------------------------
 
              NEWJET                                          File     : NMACR
                   |----  SIGN                                External
                   |----  SQRT                                External
                   |----  ABS                                 External
                   |----  NINT                                External
                   |----  ATG                                 External
                   |----  IAND                                External
                   |----  ISHFT                               External
                   |----  FLOAT                               External
                   |----  BTEST                               External
                   |----  SIN                                 External
                   |----  COS                                 External
                   |----  ACOS                                External
                   |----  QWMESE                              print message an
                   |----  NGJMMC                              File     : NMACR
                   |----  VZERO                               External
  ------------------------------------------------------------------------------
2 NGJMMC
        SUBROUTINE NGJMMC(NJETO,PXJETO,PYJETO,PZJETO,ENJETO,NMAXO,
  ------------------------------------------------------------------------------
    CKEY SANDY JETS /INTERNAL
  ------------------------------------------------------------------------------
       &                  NJETI,PXJETI,PYJETI,PZJETI,ENJETI,NJETOF,
       &                  YCUT,EVIS,SCHEME,VERSN)
 
     Author   : C. Bowdery     18-APR-1991 based on QJMMCL by P. Perez
     Modified : C. Bowdery     28-APR-1991 add VERSN argument
     Modified : C. Bowdery     18-OCT-1991 new name
     Modified : C. Bowdery     24-OCT-1991 work bank index corrected
     Modified : C. Bowdery     24-OCT-1991 remove call to SJMMCL
     Modified : H. Duarte      08-OCT-1992 to be used in SANDY 111
     Modified : Yves Maumary   28-OCT-1992 change interface
 
     Description
     ===========
     Set up and call FJMMCL jet finding routine.
 
 
    Input   : NJETI           num of input objects
              PXJETI,PYJETI,PZJETI,ENJETI
                              4-momentum of input objects
              NMAXO           maximum number of output objects
              YCUT            Ycut value ( (M/EVIS)**2 )
              EVIS            visible energy
                              (if EVIS=0., it is computed from the
                               input particle energies)
              SCHEME          CHAR*2, combination scheme 'E ', 'E0', 'P '
              VERSN           CHAR*6, 'NORMAL' or 'BETTER' JADE algorithm
 
    Output  : NJETO           number of jets found or error code if <0
              PXJETO,PYJETO,PZJETO,ENJETO
                              4-momentum of output objects
              NJETOF          correspondance new/old jets
 
 
  ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
  ------------------------------------------------------------------------------
   NJMMCL                                                     File     : NMACR
   NEWJET                                                     File     : NMACR
        |---- NGJMMC                                          File     : NMACR
                   |----  SIGN                                External
                   |----  SQRT                                External
                   |----  ABS                                 External
                   |----  NINT                                External
                   |----  ATG                                 External
                   |----  IAND                                External
                   |----  ISHFT                               External
                   |----  FLOAT                               External
                   |----  BTEST                               External
                   |----  SIN                                 External
                   |----  COS                                 External
                   |----  ACOS                                External
                   |----  QWMESE                              print message an
                   |----  WBANK                               External
                   |----  FJMMCL                              Find jets using
                   |----  WDROP                               External
  ------------------------------------------------------------------------------
 
2 QPI0DO
        SUBROUTINE QPI0DO
  ------------------------------------------------------------------------------
    CKEY SANDY PI0 /USER
  ------------------------------------------------------------------------------
    - Find pi0 candidates from GAMPEC photons                        +
                                                                      +
     Author   :- J.-P. Lees                                          +
     Modified :- Yves A. Maumary        1-FEB-1993 Adapted for SANDY +
                                                                      +
   Build pi0 candidates from GAMPEC photons taken in the GAM section  +
   of SANDY, and refit their Energy/momentum applying pi0 mass        +
   constraint 2*w1*w2(1-cos(theta12))=m(pi0)                          +
   we neglect the error on the angles of the 2 photons and find,      +
   with a Lagrange multipliers approximate solution, the refitted     +
   energies w1, w2 minimizing chi2=((E1-w1)/S1)**2+((E2-w2)/S2)**2    +
   with w1, w2 the refitted energies                                  +
        E1, E2 the measured energies                                  +
        S1, S2 the error on these energies                            +
   Results of this computation are stored in common GAMPI0            +
                                                                      +
                                                                      +
   QPI0DO user guide:                                                 +
   ------------------                                                 +
   To build pi0's using QPI0DO, just add in your main program         +
   a CALL QPI0DO, and the COMMON GAMPI0 will be filled. its           +
   content is described below.                                        +
   Beware that the mass cut used to find pi0 candidates from gampec   +
   photons is quite wide. For some specific analysis, a tighter cut   +
   can be needed, in that case you have to come back to the original  +
   GAMPEC photons and check their invariant mass                      +
   Description of common GAMPI0:                                      +
  ------------------------------                                      +
   IQPI0           : return code  0-->OK, 1-->0, 2-->N pi0>MXPI0      +
   PIOMOM(4,MXPI0) : PI0 refitted 4 momentum                          +
   IPI0GAM(2,MXPI0): gam 1 & 2 number in the GAT section              +
   CHIPI0(MXPI0)   : chi2 value after refit (-999. if no convergence) +
   ITYPI0(MXPI0)   : pi0 type, see below                              +
   Description of pi0 types:                                          +
  --------------------------                                          +
    TY=1: 2 photons in same PECO, with N=2 photons in the PECO        +
    TY=2: 2 photons in same PECO, with N>2 photons in the PECO        +
    TY=3: 2 photons in different PECO, with N=1 photons in each PECO  +
    TY=4: 2 photons in different PECO, with N>1 photons in one PECO   +
 
  ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
  ------------------------------------------------------------------------------
 
              QPI0DO                                          File     : NMACR
                   |----  SIGN                                External
                   |----  SQRT                                External
                   |----  ABS                                 External
                   |----  NINT                                External
                   |----  ATG                                 External
                   |----  IAND                                External
                   |----  ISHFT                               External
                   |----  FLOAT                               External
                   |----  BTEST                               External
                   |----  SIN                                 External
                   |----  COS                                 External
                   |----  ACOS                                External
                   |----  VZERO                               External
                   |----  QWMESE                              print message an
                   |----  QWMESS                              print message.
                   |----  HF2                                 External
                   |----  PI0LIM
                   |----  XXP0F1
                   |----  KINEFIT                             ================
                   |----  VADD                                External
                   |----  UCOPY                               External
  ------------------------------------------------------------------------------
2 PI0LIM
        SUBROUTINE PI0LIM(E,AMEAN,SIGM,CORFAC)
  ------------------------------------------------------------------------------
    CKEY SANDY PI0 /INTERNAL
  ------------------------------------------------------------------------------
   input : E gamma-gamma energy
   output: AMEAN mean pi0 mass from gampec
           SIGM  pi0 mass width from gampec
           CORFAC correction factor for SQRT(1-cos(theta)):
           CORFAC =(.135/AMEAN) IF E>8    (used by XXP0F1)
   given photon pair energy E compute mass limits for defining
   pi0 candidate taking into account GAMPEC mass shift and resolution
2 XXP0F1
        SUBROUTINE XXP0F1(IRET, PGAM1,PGAM2,CORFAC,P0FIT,XMFIT,CHI2)
  ------------------------------------------------------------------------------
    CKEY SANDY PI0 /INTERNAL
  ------------------------------------------------------------------------------
 
        Subroutine to constraint the p0 mass.
        Uses a lagrange multipliers technique
        G.BATIGNANI 10 / APR /1992     VERSION 1.0
                    10 / APR /1992     VERSION 1.1 -MODIFIED ERROR-
        J.P.Lees    20 / may /1992     VERSION 1.2  MODIFIED ARGUMENTS
                                        TO RUN OUTSIDE ALPHA
        Input  arguments :
              PGAM1         first photon 4 momentum
              PGAM2        second photon 4 momentum
              CORFAC       correction factor for angle overestimation
                           by GAMPEC
        Remarks:   1.   the 4-momentum of IPI0 must be the sum of
                        the two 4-momenta of IG1 and IG2, in order
                        to have a significant fit.
                   2.   the invariant mass of IPI0 should lie in the
                        range 50 - 250 Mev.   If not, the energy of
                        the p0  is redefined badly.
 
        Output arguments :
 
               IRET     return code :  -1 and -2 : the fit is failed and
                                       P0FIT and XMFIT are set to 0,
                                      from 1 to 5 : the fit has converged
                                      and the P0 new mass is within 0.2
                                      MeV around the nominal P0 mass and
                                     the fit has converged in IRET iter.,
                                      6  : the fit has not converged in
                                      less than 5 iteration and the
                                      fitted values are the ones calculat
                                      at the 5-th iteration.
               P0FIT(I)  fitted 4-momentum of P0 ( p,E) : it MUST be
                         dimensioned 4 in the calling routine.
               XMFIT     inveriant mass after the fit
 
        Remarks : -so far the fit has always converged in 1,2 or 3
                   iterations, so the invariant mass is the nominal p0
                   mass (  within 0.2 MeV ).   However, it is better
                   to check IRET > 0.
                  -(repeated) : call this routine only if the p0
                   invariant mass ( of IPI0 ) is in the range 50-200 MeV.
                  - in first approximation this routine redefines the
                    p0 energy (and not the direction) and improves the
                    energy resolution from (roughly) 26%/sqrt(E) to
                    6%  (constant with energy).
 
 
  ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
  ------------------------------------------------------------------------------
   QPI0DO                                                     File     : NMACR
        |---- XXP0F1
                   |----  VADD                                External
                   |----  SQRT                                External
                   |----  UCOPY                               External
                   |----  ABS                                 External
  ------------------------------------------------------------------------------
 
2 KINEFIT
        SUBROUTINE KINEFIT(PGAM1,PGAM2,PPI0,CHISQ,PROBP0,IFAIL)
  ------------------------------------------------------------------------------
    CKEY SANDY PI0 /INTERNAL
  ------------------------------------------------------------------------------
 
     Author   :- Marcello Maggi        27-JAN-1992
 
     Inputs:
          - PGAM1         : 4 momentum of first photon
          - PGAM2         : 4 momentum of second photon
 
     Outputs:
          - PROBP0  /R    : probability to form a pi0
          - IFAIL   /I    : return code (0 means OK!)
          - PPI0    /R    : Refitted pi0 momentum
     Description
     ===========
 
   This set of routines perform a kinematical fit to the pi0 mass.
   The chisquare is defined as:
     ((E1measured-E1fitted)/Sigma1Erisolution))**2 +
     ((E2measured-E2fitted)/Sigma2Erisolution))**2 +
     ( ((cos(angle between photon)-(1-pimass**2/2/E1fitted/e2fitted))/
                                     SigmacoshtetaRisolution) *
    and it is minimized by a Newtonian iterative procedure, getting
    E1fitted and E2fitted as the risult of the fit.
    The resolution are taken from the nonimal resolution ECAL and
    depend on the Energy fitted.
    The Probability is then computed for 1 d.o.f.
 
  ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
  ------------------------------------------------------------------------------
   QPI0DO                                                     File     : NMACR
        |---- KINEFIT                                         ================
                   |----  DBLE                                External
                   |----  ACOS                                External
                   |----  ATAN2                               External
                   |----  VDOTN                               External
                   |----  DSQRT                               External
                   |----  DECOS
                   |----  CHISCOM
                   |----  HESSE
                   |----  DERIV
                   |----  NEWTONIT
                   |----  DABS                                External
                   |----  SNGL                                External
                   |----  VSCALE                              External
                   |----  VADD                                External
                   |----  VDOT                                External
                   |----  SQRT                                External
                   |----  PROB                                External
  ------------------------------------------------------------------------------
 
2 QPI0BK
        SUBROUTINE QPI0BK
  ------------------------------------------------------------------------------
    CKEY SANDY PI0 /USER
  ------------------------------------------------------------------------------
   Book some control histograms filled by qpi0do
 
  ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
  ------------------------------------------------------------------------------
 
              QPI0BK
                   |----  HBOOK2                              External
  ------------------------------------------------------------------------------
2 PI0DEB
        SUBROUTINE PI0DEB
  ------------------------------------------------------------------------------
    CKEY SANDY PI0 /USER
  ------------------------------------------------------------------------------
   Full debug of pi0 found by GAMPEC                                  +
 
  ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
  ------------------------------------------------------------------------------
 
              PI0DEB                                          File     : NMACR
                   |----  SIGN                                External
                   |----  SQRT                                External
                   |----  ABS                                 External
                   |----  NINT                                External
                   |----  ATG                                 External
                   |----  IAND                                External
                   |----  ISHFT                               External
                   |----  FLOAT                               External
                   |----  BTEST                               External
                   |----  SIN                                 External
                   |----  COS                                 External
                   |----  ACOS                                External
  ------------------------------------------------------------------------------
2 NLASTD
        FUNCTION NLASTD(IM)
  ------------------------------------------------------------------------------
    CKEY SANDY MONTE /INTERNAL
  ------------------------------------------------------------------------------
   Get the pointer to the last daughter
                                                     Y.Maumary 19.02.93
2 KDAU
        FUNCTION KDAU(ITK,I)
  ------------------------------------------------------------------------------
    CKEY SANDY MONTE /USER
  ------------------------------------------------------------------------------
   Get the Ith daughter if track ITK
                                                     Y.Maumary 19.02.93
2 NREPAR
        SUBROUTINE NREPAR(IRET)
  ------------------------------------------------------------------------------
    CKEY
  ------------------------------------------------------------------------------
 
 
     Author   :- Gerrit Graefe         10-MAY-1994
     Modified :- Gerrit Graefe         30-NOV-1994 convert EBCDIC to ASCII
 
     Inputs:
          - none
 
     Outputs:
          - IRET / I        return code  0=created PART from NDAR
                                         1=can't find NDAR
                                         2=no space to book PART
                                         3=unknown error
 
     Libraries required: ALPHA,BOS77
 
     Description
     ===========
 
     This subroutine creates the bank PART from the NDAR bank.
 
 
  ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
  ------------------------------------------------------------------------------
   NFILL                                                      File     : NMACR
        |---- NREPAR                                          ..WIDTH
                   |----  SIGN                                External
                   |----  SQRT                                External
                   |----  ABS                                 External
                   |----  NINT                                External
                   |----  ATG                                 External
                   |----  IAND                                External
                   |----  ISHFT                               External
                   |----  FLOAT                               External
                   |----  BTEST                               External
                   |----  SIN                                 External
                   |----  COS                                 External
                   |----  ACOS                                External
                   |----  BLIST                               External
                   |----  NDROP                               External
                   |----  NAMIND                              External
                   |----  AUBOS                               Book/enlarge a b
                   |----  QWMESE                              print message an
                   |----  BKFMT                               External
                   |----  CHAR                                External
  ------------------------------------------------------------------------------
 
2 NGPUT
        SUBROUTINE NGPUT(RM,IE,RO)
  ------------------------------------------------------------------------------
    CKEY SANDY PART /INTERNAL
  ------------------------------------------------------------------------------
 
 
     Author   :- Gerrit Graefe         15-FEB-1994
 
     Inputs:
          - RM   / F    mantisse of a floating point number
                        has to be in the range -1.0.lt.RM.lt.1.0
            IE   / I    exponent of a floating point number
                        has to be in the range -37.le.IE.le.37
 
     Outputs:
          - RO   / F    RO=RM*(10.0**IE)
 
     Libraries required: NONE
 
 
  ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
  ------------------------------------------------------------------------------
 
              NGPUT
                   |----  ABS                                 External
  ------------------------------------------------------------------------------
2 LEPTAG
        SUBROUTINE LEPTAG(LDEBUG,LTOUT,IERR)
  ------------------------------------------------------------------------------
    CKEY
  ------------------------------------------------------------------------------
 
      L    EEEEE PPPP  TTTTT  A    GGG
      L    E     P   P   T   A A  G                      Version 4.1 S
      L    EEE   PPPP    T  A   A G  GG
      L    E     P       T  AAAAA G   G               13th July 1994
      LLLL EEEEE P       T  A   A  GGG
      ---------------------------------
 
      Mark Parsons                       Ingrid Ten Have
      University of Edinburgh            University of Glasgow
      -----------------------            ---------------------
 
      Revision history: Version 1.0 - 5th June 1992
 
                                      Initial version used to create the
                                      first production of the BTAGDST. Worked
                                      with ALMU260, QMUIDO 7.0, ENFLW 2.05,
                                      QEID113, and ALPHA113.
 
                        Version 2.0 - 3rd November 1992
 
                                      Revised version. Calling parameters
                                      changed to allow jets of any Alpha
                                      name to be used. All references to QEIDO
                                      deleted. Error returns, histograms, and
                                      comments tidied up. Designed and tested
                                      to work with Alephlib QMUIDO, ENFLW 114,
                                      and ALPHA 114. Added event HV and DAQ
                                      status cut.
 
                        Version 2.1 - 21st November 1992
 
                                      Added XMCEV test to stop HV on test
                                      failing for monte carlo data. Mended
                                      the jet pointer value stored in word 3
                                      of the BMLT bank.
 
                        Version 2.2 - 18th January 1993
 
                                      Modified to work with EFT objects
                                      as opposed to ENFW objects. This change
                                      is NOT backwards compatible. LEPTAG will
                                      only work now if EFT objects have been
                                      used to create the jets. ENFLW should
                                      not be called. Some extra protections
                                      added - should be user transparent.
                                      (V2.2 never officially released).
 
                        Version 3.0 - 3rd February 1993
 
                                      Added calls to Pascal Perret's CALPOIDS
                                      routines to calculate the overall and
                                      source prediction weights. Increased the
                                      size of the BMLT bank to 20 words per
                                      lpeton and rearranged entries. Filling
                                      of weights controlled by LTFW card.
                                      Histogram booking bug removed. Bank
                                      filling code rearranged and new error
                                      return to signal if Data/MC year cannot
                                      be calculated added. LEPTAG INC updated
                                      to reflect the above changes.
 
                        Version 3.1 - 14th April 1993
 
                                      Experimental version not generally
                                      released. Changes not included in 3.2.
 
                        Version 3.2 - 27th September 1993
 
                                      Calls to QLUTRK added to properly unlock
                                      all tracks on exit from the LEPTAG
                                      subroutine. In previous versions some EF
                                      tracks remained locked causing subsequent
                                      EFT jet creation to "lose" tracks. The
                                      LEPTAG.INC file has been preincluded into
                                      the source code to comply with UPHY rules.
 
                        Version 3.21- 2nd November 1993
 
                                      Bug correction in BADTRK function. ABS()
                                      added around call to QCT. Effect was to
                                      categorise some tracks as good which
                                      should have failed the track cuts. Bug
                                      found by ITH.
 
                        Version 4.0 - 18th February 1994
 
                                      Call to LEPDCY and subroutine removed.
                                      replaced with call to external FINLEP
                                      subroutine. Bank description updated
                                      accordingly. LEPDCY histograms removed.
                                      Parent hadron found using JMBEST.
 
                        Version 4.1 - 13th July 1994
 
                                      Adjust LEPTAG to handle nano events
                                      If XNANO is true then the NDBM is
                                      unpacked and the additional infor-
                                      mation is recalculated and packed
                                      into the BMLT bank.  This is done
                                      by the new subroutine LTNANO.
                                      Adjustment for new CALPOIDS code.
                                      Protection word 19 KTPCOD(0) repla-
                                      ced by 0.
 
                        Version 4.1 S - 27th July 1994
 
                                      Gerrit Graefe
                                      University of Heidelberg
                                      ------------------------
 
                                      Removed all code except that for unpacking
                                      the NDBM bank. This was done to put LEPTAG
                                      into SANDY. Even some input arguments were
                                      removed as they have no meaning in SANDY
                                      because no 'real' lepton tag is performed.
 
 
      Last Modified:    13/07/94    - Ingrid ten Have
 
   This subroutine implements the lepton selection definition given in
   Aleph-note ALEPH 92-101 "Lepton and jet definitions for the lepton paper"
   (D. Abbaneo et al). It finds all high momentum e+,e-,mu+, and mu- particles
   in an event and calculates their inclusive and exclusive Pt. If monte
   carlo truth is available for the event then the lepton source is calculated.
   All of this information is returned to the user in the BMLT BOS bank which
   the routine creates and fills if any leptons were found.
 
   Inputs:
   -------
             CHARACTER JETNAM = A character string containing the name of the
                                energy flow object jets created by the user
                                before the call to LEPTAG. Maximum length of
                                the string is 13 characters in keeping with
                                Alpha object naming.
             LOGICAL LHISTO   = Controls whether histograms will be filled
                                (.TRUE.) as the leptons are selected or not
                                (.FALSE.) for this event.
             LOGICAL LDEBUG   = Controls whether or not debugging information
                                should be written out (.TRUE.) or not (.FALSE.).
             INTEGER LTOUT    = Unit number on which debug and leptag error
                                information is to be written.
   Outputs:
   --------
             INTEGER IERR     = Completion return code defined as follows:
 
       IERR > 0     ! The number of leptons found and stored in the BMLT bank.
       IERR = 0     ! No suitable leptons found in event.
       IERR < 0     ! An error occured while processing the event.
 
       IERR = -1    ! Too few good tracks.
       IERR = -2    ! LEP energy too low or too high.
       IERR = -3    ! Less than 10% of LEP energy visible.
       IERR = -4    ! While trying to find the charge of a lepton
                    ! ALPHA returned the "incorrect" charge.
       IERR = -5    ! The BOS space booked for leptons and the number
                    ! of leptons written out differ.
       IERR = -6    ! BOS was unable to book the space requested.
       IERR = -7    ! There were less than 2 jets in this event.
       IERR = -8    ! Lepton to jet search failed.
       IERR = -9    ! Lepton Pt calculation failed.
       IERR = -10   ! Event has bad HV or DAQ status.
       IERR = -11   ! Event has either no tracks or no energy flow objects.
       IERR = -12   ! Unable to calculate the year corresponding to this run.
       IERR = -13   ! FINLEP returned an undocumented value.
 
   The BMLT BOS bank description
   -----------------------------
 
   Values of type IF should be converted to REAL and divided by 1000000.
 
   *------*                                               *------*
   | BMLT |                                               | BMLT |
   *------*                                               *------*
   ...............................................................
              1      I    Number of words per lepton (=20)
              2      I    Number of leptons
   ...............................................................
              1  TN  I    JULIA track number                 [1,*]
              2  PA  I    Particle type:                    [2,23]
                             2 => e+
                            12 => e+ in crack region
                            22 => e+ in overlap region
                             3 => e-
                            13 => e- in crack region
                            23 => e- in overlap region
                             5 => mu+
                             6 => mu-
              3  JT  I    Pointer to jet in jet section      [1,*]
              4  PI  IF   Transverse momentum                [0,*]
                             lepton inclusive
              5  PE  IF   Transverse momentum                [0,*]
                             lepton exclusive
              6  TR  I    IDF/Truth flag                     [1,*]
                             Bit 0: Muon IDF 13
                             Bit 1: Muon IDF 14
                             Bit 2: Genuine electron/
                                            positron
              7  MO  IF   Total momentum                     [0,*]
              8  LW  IF   MC efficiency correction weight    [*,*]
              9  W1  IF   Source weight: b -> l              [*,*]
             10  W2  IF   Source weight: b -> tau -> l       [*,*]
             11  W3  IF   Source weight: b -> c   -> l       [*,*]
             12  W4  IF   Source weight: b -> W   -> c -> l  [*,*]
             13  W5  IF   Source weight: c -> l              [*,*]
             14  W6  IF   Source weight: misid -> l (uds)    [*,*]
             15  W7  IF   Source weight: misid -> l (c)      [*,*]
             16  W8  IF   Source weight: misid -> l (b)      [*,*]
             17  FL  I    Primary quark flavour from FINLEP  [0,5]
                             0 => not a MC q-qbar event
                             1 => d quark
                             2 => u quark
                             3 => s quark
                             4 => c quark
                             5 => b quark
             18  DC  I    Decay category from FINLEP      [-35,35]
                             1 => b -> mu + charmed hadron
                             2 => b -> mu + non charmed hadron
                             3 => b -> tau -> mu
                             4 => b -> c -> mu
                             5 => b -> cbar -> mu
                             6 => c -> mu
                             7 => c -> tau -> mu
                             8 => b -> c -> tau -> mu
                             9 => K -> mu or pi -> mu
                            10 => gamma -> mu
                            11 => J/psi -> mu
                            12 => psi' -> mu
                            13 => other decays to muon
                            14 => tau decay
                            15 => muon from other sources
                            16 => misidentified hadron
                            17 => muon -> electron
                            18 => others
                            19 => error in finding some mother
                            20 => assoc. Kingal track not found
                         21-35 => as 1-15 but e instead of mu
                        negtve => parent quark is from gluon
             19  LP  I    Lepton parent                      [0,367]
             20  ET  I    Energy flow object number          [1,*]
   ...............................................................
        CALL LTNANO(LDEBUG,LTOUT,IERR)
        RETURN
        END
 
  ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
  ------------------------------------------------------------------------------
 
              LEPTAG
                   |----  LTNANO                              File     : NMACR
  ------------------------------------------------------------------------------
2 LTHIST
 
  ------------------------------------------------------------------------------
    CKEY
  ------------------------------------------------------------------------------
 
        SUBROUTINE LTHIST
 
   This routine books the histograms which are filled by LEPTAG if the LHISTO
   logical has been set to .TRUE. in the call to LEPTAG.
 
 
   First book the electron/positron histograms
 
        CALL HBOOK2(100,'RT (R2) vs RL (R3) after kinematic cuts',
       @            40,-10.,10.,40,-10.,10.,0.)
        CALL HBOOK1(101,'RL (R3) after kinematic cuts',
       @            40,-10.,10.,0.)
        CALL HBOOK2(102,'RT (R2) after kinematic+RL cuts vs P',
       @            40,2.,10.,40,-10.,10.,0.)
        CALL HBOOK1(103,'RT (R2) after kinematic+RL cuts',
       @            40,-10.,10.,0.)
        CALL HBOOK2(104,'RI (R5) after kinematic+RL+RT cuts vs P',
       @            90,2.,20.,40,-10.,6.,0.)
        CALL HBOOK1(105,'RI (R5) after kinematic+RL+RT cuts',
       @            40,-10.,6.,0.)
        CALL HBOOK1(106,'RL (R3) genuine e+/e- before conv. check',
       @            40,-10.,10.,0.)
        CALL HBOOK1(107,'RT (R2) genuine e+/e- before conv. check',
       @            40,-10.,10.,0.)
        CALL HBOOK1(108,'RI (R5) genuine e+/e- before conv. check',
       @            40,-10.,6.,0.)
 
   Look at the electrons and positrons separately
 
   Electrons
 
        CALL HBOOK1(110,'Momentum genuine electrons',
       @            100,0.,50.,0.)
        CALL HBOOK1(111,'Pt inclusive, genuine electrons',
       @            100,0.,10.,0.)
        CALL HBOOK1(112,'Pt exclusive, genuine electrons',
       @            100,0.,10.,0.)
        CALL HBOOK1(113,'Cos(theta), genuine electrons',
       @             100,-1.,1.,0.)
        CALL HBOOK1(114,'Phi, genuine electrons',
       @             72,0.,6.3,0.)
 
   Positron histograms
 
        CALL HBOOK1(120,'Momentum genuine positrons',
       @            100,0.,50.,0.)
        CALL HBOOK1(121,'Pt inclusive, genuine positrons',
       @            100,0.,10.,0.)
        CALL HBOOK1(122,'Pt exclusive, genuine positrons',
       @            100,0.,10.,0.)
        CALL HBOOK1(123,'Cos(theta), genuine positrons',
       @             100,-1.,1.,0.)
        CALL HBOOK1(124,'Phi, genuine positrons',
       @             72,0.,6.3,0.)
 
   Now book the muon histograms
 
        CALL HBOOK2(200,'No. planes in last 10 vs fired/exp',
       @            20,0.,1.,20,.5,10.5,0.)
 
   Also book x and y projections of histo id=200
 
        CALL HBPRO(200,0.)
        CALL HBOOK2(201,'No. planes in last 3 vs fired/exp',
       @            20,0.,1.,6,.5,3.5,0.)
 
   Also book a y projection of histo id=201
 
        CALL HBPROY(201,0.)
        CALL HBOOK1(202,'IDF value returned by QMUIDO all muons',
       @            32,-.5,15.5,0.)
        CALL HBOOK1(203,'Genuine muons fired/exp no. planes',
       @            20,0.,1.,0.)
        CALL HBOOK1(204,'Genuine muons no. planes in last 10',
       @            20,0.5,10.5,0.)
        CALL HBOOK1(205,'Genuine muons no. planes in last 3',
       @            6,0.5,3.5,0.)
 
   Look at the details of the muons and antimuons separately
 
   Muons
 
        CALL HBOOK1(210,'Genuine muon momentum',
       @            100,0.,50.,0.)
        CALL HBOOK1(211,'Pt inclusive, genuine muons',
       @             100,0.,10.,0.)
        CALL HBOOK1(212,'Pt exclusive, genuine muons',
       @             100,0.,10.,0.)
        CALL HBOOK1(213,'Cos(theta), genuine muons',
       @             100,-1.,1.,0.)
        CALL HBOOK1(214,'Phi, genuine muons',
       @              72,0.,6.3,0.)
 
   Antimuons
 
        CALL HBOOK1(220,'Genuine antimuon momentum',
       @            100,0.,50.,0.)
        CALL HBOOK1(221,'Pt inclusive, genuine antimuons',
       @             100,0.,10.,0.)
        CALL HBOOK1(222,'Pt exclusive, genuine antimuons',
       @             100,0.,10.,0.)
        CALL HBOOK1(223,'Cos(theta), genuine antimuons',
       @             100,-1.,1.,0.)
        CALL HBOOK1(224,'Phi, genuine antimuons',
       @             72,0.,6.3,0.)
 
   Some general histograms
 
        CALL HBOOK1(300,'Lepton count',10,0.,10.,0.)
        CALL HBOOK1(301,'Number of leptons per event',
       @  10,0.,5.,0.)
 
        RETURN
        END
 
  ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
  ------------------------------------------------------------------------------
 
              LTHIST
                   |----  HBOOK2                              External
                   |----  HBOOK1                              External
                   |----  HBPRO                               External
                   |----  HBPROY                              External
  ------------------------------------------------------------------------------
2 GTYEAR
        SUBROUTINE GTYEAR
  ------------------------------------------------------------------------------
    CKEY
  ------------------------------------------------------------------------------
 
   Calculates the year the data was taken in or the year a MC run is
   supposed to represent.
 
        IMPLICIT NONE
 
   Private variables and common initialised by LTINIT.
 
        INTEGER LASTRN,NLPTEV,YEARID,LTFWCD
        LOGICAL LTFRST
        COMMON /LTPRIV/ LASTRN,NLPTEV,LTFRST,YEARID,LTFWCD
 
   Variables.
 
        INTEGER IDBANK,NLINK
 
   Preincluded LEPTAG include file. Used to set up the LEPCNT array.
 
   Start of include file:
 
        REAL LTSCFA
        PARAMETER(LTSCFA = 1000000.)
 
        INTEGER NCNT
        PARAMETER(NCNT = 25)
        INTEGER LEPCNT(NCNT)
 
       LEPTAG counters
 
        INTEGER LTNCHR,LTQLPR,LTECHR,LTACHR,LTBOSC,LTBOSS,LTNJET,LTJTAS,
       @        LTPTFL,LTHVDQ,LTHAD ,LTNLEP,LTYLEP,LTCONV,LTELMU,LTNEMI,
       @        LTNEPL,LTNMMI,LTNMPL,LTNCNV,LTCALL,LTNEFO,LTGTYF,LTCPDF,
       @        LTBRFL
 
        PARAMETER(LTNCHR= 1,LTQLPR= 2,LTECHR= 3,LTACHR= 4,LTBOSC= 5,
       @          LTBOSS= 6,LTNJET= 7,LTJTAS= 8,LTPTFL= 9,LTHVDQ=10,
       @          LTHAD =11,LTNLEP=12,LTYLEP=13,LTCONV=14,LTELMU=15,
       @          LTNEMI=16,LTNEPL=17,LTNMMI=18,LTNMPL=19,LTNCNV=20,
       @          LTCALL=21,LTNEFO=22,LTGTYF=23,LTCPDF=24,LTBRFL=25)
 
         COMMON /LPTPUB/ LEPCNT
 
   End of include file.
 
 
        YEARID = 0
        IF (XMCEV) THEN
          IDBANK = NLINK('ASIM',0)
          IF (IDBANK.GT.0) YEARID = (ITABL(IDBANK,1,1)/100)+1900
          IF (YEARID.LT.1989.OR.YEARID.GT.1999) YEARID = 0
        ELSE
          IF (KRUN.LT.25000) THEN
            IF (KRUN.GE.4000) YEARID = 1989
            IF (KRUN.GE.6000) YEARID = 1990
            IF (KRUN.GE.10000) YEARID = 1991
            IF (KRUN.GE.14000) YEARID = 1992
            IF (KRUN.GE.20000) YEARID = 1993
          ELSE
            IDBANK = NLINK('EVEH',0)
            IF (IDBANK.GT.0) YEARID = (IW(IDBANK+4)/10000)+1900
            IF (YEARID.LT.1989.OR.YEARID.GT.1999) YEARID = 0
          ENDIF
        ENDIF
 
        RETURN
 
        END
 
  ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
  ------------------------------------------------------------------------------
   LTNANO                                                     File     : NMACR
        |---- GTYEAR                                          File     : NMACR
                   |----  SIGN                                External
                   |----  SQRT                                External
                   |----  ABS                                 External
                   |----  NINT                                External
                   |----  ATG                                 External
                   |----  IAND                                External
                   |----  ISHFT                               External
                   |----  FLOAT                               External
                   |----  BTEST                               External
                   |----  SIN                                 External
                   |----  COS                                 External
                   |----  ACOS                                External
                   |----  NLINK                               External
  ------------------------------------------------------------------------------
 
2 LTNANO
        SUBROUTINE LTNANO(LDEBUG,LTOUT,IRET)
  ------------------------------------------------------------------------------
    CKEY
  ------------------------------------------------------------------------------
 
   This routine is called when the data read in are found to be NANO's   les
   It will unpack the information already stored on the NDBM bank, expandults
   it to the full BMLT bank and add the missing information from CALPOIDSy.
 
        IMPLICIT NONE
 
   Subroutine parameters and function prototypes
 
        INTEGER NAMIND,NBANK,NLINK,ISTORE
        REAL FCALPOID,FUNPROB
        LOGICAL LHISTO,LDEBUG
        INTEGER LTOUT,IERR,NATR,IRET
 
   Variables
 
        INTEGER IDBMLT,NWBMLT,IDX,ITK,NGOOD,NLEPT,NPOSI,NELEC,NMUPL,
       @        NMUMI,NCONV,NBOTH,IEREL,NS,IERDEX,NC1,NC2,
       @        IERQPA,IRUN,IBE,IBT,IM1,IM2,NEXP,NFIR,N10,N03,ISHAD,
       @        IDF,IMCF,IERMU,SIZE,
       @        IDJET,LSJET,JETID,II,NJET,ETK,NTRACK,
       @        CPYEAR,CPIDL,SIDX,IDLTFW,
       @        IMCFL,IFLAV,IMCT,JMBEST,IPAR
        REAL    ETOT,R2,R3,RI,TL,RIEXP,SIGMA,R5,DXY,DZ0,DZ2,DTH,RMA,
       @        ZMA,XMA,P(3),XMULT,RAPP,ANG,SUDNT,EXPFIR,
       @        PLEPT(3),PJET(4),VINP,COSTHE,SINTHE,PTINC,PTEXCL,
       @        DIN1,DIN2,EJET,WEIGHT
 
   Private variables and common initialised by LTINIT.
 
        INTEGER LASTRN,NLPTEV,YEARID,LTFWCD
        LOGICAL LTFRST
        COMMON /LTPRIV/ LASTRN,NLPTEV,LTFRST,YEARID,LTFWCD
 
   Preincluded LEPTAG include file. Used to set up the LEPCNT array.
 
   Start of include file:
 
        REAL LTSCFA
        PARAMETER(LTSCFA = 1000000.)
 
        INTEGER NCNT
        PARAMETER(NCNT = 25)
        INTEGER LEPCNT(NCNT)
 
       LEPTAG counters
 
        INTEGER LTNCHR,LTQLPR,LTECHR,LTACHR,LTBOSC,LTBOSS,LTNJET,LTJTAS,
       @        LTPTFL,LTHVDQ,LTHAD ,LTNLEP,LTYLEP,LTCONV,LTELMU,LTNEMI,
       @        LTNEPL,LTNMMI,LTNMPL,LTNCNV,LTCALL,LTNEFO,LTGTYF,LTCPDF,
       @        LTBRFL
 
        PARAMETER(LTNCHR= 1,LTQLPR= 2,LTECHR= 3,LTACHR= 4,LTBOSC= 5,
       @          LTBOSS= 6,LTNJET= 7,LTJTAS= 8,LTPTFL= 9,LTHVDQ=10,
       @          LTHAD =11,LTNLEP=12,LTYLEP=13,LTCONV=14,LTELMU=15,
       @          LTNEMI=16,LTNEPL=17,LTNMMI=18,LTNMPL=19,LTNCNV=20,
       @          LTCALL=21,LTNEFO=22,LTGTYF=23,LTCPDF=24,LTBRFL=25)
 
         COMMON /LPTPUB/ LEPCNT
 
   End of include file.
 
   Number of words in the BMLT bank
 
        DATA NWBMLT /20/
 
   Internal variables for LTNANO
 
        INTEGER IDNDBM,IW1,IW2,IW3,IW4,IBITS
        INTEGER ITP,IJT,I13,I14,IEL
       @ ,IENFLW
 
   Macros
 
 
 
 
   If this is the first call to leptag then initialize the bank format and
   write out the welcome message. Also work what type and year of data this
   is.
 
        IF (LTFRST) THEN
          LASTRN = KRUN
          CALL GTYEAR
          WRITE(LTOUT,1000)
          WRITE(LTOUT,1001)
          WRITE(LTOUT,1002)
          WRITE(LTOUT,1003)
          WRITE(LTOUT,1004)
          WRITE(LTOUT,1005)
          WRITE(LTOUT,1006)
          IF (LTFWCD.EQ.0) WRITE(LTOUT,1007)
          IF (LTFWCD.EQ.1) WRITE(LTOUT,1008)
          IF (LTFWCD.EQ.2) WRITE(LTOUT,1009)
          IF (XMCEV) THEN
            WRITE(LTOUT,1010) YEARID
          ELSE
            WRITE(LTOUT,1011) YEARID
          ENDIF
          WRITE(LTOUT,1000)
          IF (LDEBUG) WRITE(LTOUT,*) 'Initializing bank format'
          CALL BKFMT('BMLT','2I,(20I)')
          CALL GTYEAR
          IF (YEARID.GE.1992) THEN
            WRITE(LTOUT,*) '****************************************'
            WRITE(LTOUT,*) '****************************************'
            WRITE(LTOUT,*) '**                                    *
            WRITE(LTOUT,*) '**  CALPOIDS  WARNING:                *
            WRITE(LTOUT,*) '**  ==================                *
            WRITE(LTOUT,*) '**                                    *
            WRITE(LTOUT,*) '**  FUNPROB:                          *
            WRITE(LTOUT,*) '**  no tables provided beyond 1991    *
            WRITE(LTOUT,*) '**  FCALPOID:                         *
            WRITE(LTOUT,*) '**  If IAN > 1991 IAN-2 is used!!!!   *
            WRITE(LTOUT,*) '**                                    *
            WRITE(LTOUT,*) '****************************************'
            WRITE(LTOUT,*) '****************************************'
          ENDIF
          LTFRST = .FALSE.
        ENDIF
 
   Check to see that the run number hasn't changed. If it has then
   re-calculate the year we are running on.
 
        IRET=0
        IF (LASTRN.NE.KRUN) THEN
          LASTRN = KRUN
          CALL GTYEAR
          IF (LDEBUG) WRITE(LTOUT,*) 'Year from GTYEAR = ',YEARID
        ENDIF
        IF (YEARID.EQ.0) THEN
          WRITE(LTOUT,*) 'Unable to calculate the year'
          RETURN
        ENDIF
 
   Occasionally BOS will not drop the BMLT bank created during the previous
   event. This is checked for here and if a spurious BMLT bank is found  t
   is dropped before proceeding.
 
        IDBMLT = NAMIND('BMLT')
        IDX = IW(IDBMLT)
        IF (IDX.NE.0) CALL BDROP(IW,'BMLT')
        IF (LDEBUG) WRITE(LTOUT,*) 'Is BMLT already present? IDX>0: ',IDX
 
   Check if there is lepton information, ie an NDBM bank
 
        IDNDBM = IW(NAMIND('NDBM'))
        IF (IDNDBM.EQ.0) RETURN
        IF (LDEBUG) WRITE(LTOUT,*) '------------------------------------'
        IF (LDEBUG) WRITE(LTOUT,*) 'Run,Event',KRUN,KEVT
        IF (LDEBUG) WRITE(LTOUT,*) 'Linking to the NDBM bank',IDNDBM
        IF (LDEBUG) WRITE(LTOUT,*) 'BMLT Link',IDBMLT
        IF (LDEBUG) WRITE(LTOUT,*) '# words',IW(IDNDBM+1)
        IF (LDEBUG) WRITE(LTOUT,*) '# leptons',IW(IDNDBM+2)
        NLEPT = IW(IDNDBM+2)
 
   Reserve enough room for the bank. This is the bank size * the number of
   leptons + 2 for the bank size + number of rows information. After this
   point if an error occurs the BMLT bank is always dropped before leaving
   LEPTAG.
 
        IF (LDEBUG) WRITE(LTOUT,*) 'Found ',NLEPT,' leptons'
        SIZE = NLEPT*NWBMLT + LMHLEN
        IDX = NBANK('BMLT',0,SIZE)
        call BKFMT('BMLT','I')
        IDBMLT = IW(NAMIND('BMLT'))
        IF (IDBMLT.EQ.0) THEN
          WRITE(LTOUT,*) 'Incorrect BMLT bank link'
          RETURN
        ENDIF
        IF (LDEBUG) WRITE(LTOUT,*) 'Reserved a bank of ',SIZE,' words'
 
   Fill the first 2 words of BMLT so that the BMLT bank obeys the Aleph
   bank standard. The first word corresponds to the number of words
   per lepton. The second corresponds to the number of leptons.
 
        IW(IDBMLT+1) = NWBMLT
        IW(IDBMLT+2) = IW(IDNDBM+2)
 
   Initialisation for bank filling
 
        IDX = 0
 
   Start filling the BMLT bank
 
        DO 500 ITK=1,NLEPT
 
   Fill the BMLT bank word by word.
 
          IDX = IDX+1
 
   Word 1.    Julia track number
 
          IW1 = ITABL(IDNDBM,IDX,1)
          IW(IDBMLT+(IDX-1)*NWBMLT+LMHLEN+1) = IBITS(IW1,0,8)
          IF (LDEBUG) WRITE(LTOUT,*) 'Julia track #',IBITS(IW1,0,8)
 
   Word 2.    Lepton type
 
   For the electrons/positrons the particle code is multiplied by 10* the
   track's quality flag returned by KEIDIF.
   KEIDIF = 0 - good
          = 1 - estimation done in crack region
          = 2 - estimation done in overlap region
   To remove this information just do a mod 10 on the stored word....
 
          IW(IDBMLT+(IDX-1)*NWBMLT+LMHLEN+2) = IBITS(IW1,8,8)
          IF (LDEBUG) WRITE(LTOUT,*) 'Lepton type',IBITS(IW1,8,8)
 
 
   Word 3.      Lepton jet
 
          IW(IDBMLT+(IDX-1)*NWBMLT+LMHLEN+3)  =
       @    IBITS(IW1,16,8)
          IF (LDEBUG) WRITE(LTOUT,*) 'Lepton jet',IBITS(IW1,16,8)
 
 
   Word 4.     Pt inclusive
 
          IW2 = ITABL(IDNDBM,IDX,2)
          IW(IDBMLT+(IDX-1)*NWBMLT+LMHLEN+4)  =
       @      ITABL(IDNDBM,IDX,2)
          IF (LDEBUG) WRITE(LTOUT,*) 'incl. pt',FLOAT(IW2)/LTSCFA
 
 
   Word 5.    Pt exclusive
 
          IW3 = ITABL(IDNDBM,IDX,3)
          PTEXCL = ITABL(IDNDBM,IDX,3)/LTSCFA
          IW(IDBMLT+(IDX-1)*NWBMLT+LMHLEN+5)  =
       @      ITABL(IDNDBM,IDX,3)
          IF (LDEBUG) WRITE(LTOUT,*) 'excl. pt',FLOAT(IW3)/LTSCFA
 
          I13 = IBITS(IW1,24,1)
          I14 = IBITS(IW1,25,1)
          IEL = IBITS(IW1,26,1)
 
   Word 6.       Genuine e+ or e- or QMUIDO IDF flag
 
          IF (IEL.EQ.1) IW(IDBMLT+(IDX-1)*NWBMLT+LMHLEN+6) = 4
          IF (I13.EQ.1) IW(IDBMLT+(IDX-1)*NWBMLT+LMHLEN+6) = 1
          IF (I14.EQ.1) IW(IDBMLT+(IDX-1)*NWBMLT+LMHLEN+6) = 2
          IF (LDEBUG) WRITE(LTOUT,*) 'IDF 13, 14, electron',I13, I14, IEL
   Word 7.      Momentum
 
 
     Get the corresponding ALPHA track, IF YOU CAN....
 
            DO I = KFCHT,KLCHT
              IF (KTN(I).EQ.IBITS(IW1,0,8)) THEN
                ISTORE = I
               GOTO 11
              ENDIF
            ENDDO
     11   CONTINUE
          IW(IDBMLT+(IDX-1)*NWBMLT+LMHLEN+7)  =
       @      INT(QP(ISTORE)*LTSCFA)
 
   Word 8.
 
   Fill the weights using Pascal Perret's FCALPOID routine if a either a
   LTFW 1 (Altarelli) or LTFW 2 (ISGW) card was found by LTINIT. Monte carlo
   events (1990 and 1991) do not correctly represent the data where lepton
   detection is concerned. A weight is therefore calculated which, if used to
   count the number of leptons, will ensure the total number of leptons at a
   given P, Pt and cos(theta) found in data and monte carlo should match.
   This value is only calculated for monte carlo events; +1.0 is stored for
   data events. Zero is stored for 1992 monte carlo events as the correction
   values have still to be calculated.
 
          LTFWCD = 0
          IDLTFW = NLINK('LTFW',0)
          IF (IDLTFW.GT.0) THEN
            IF (IW(IDLTFW).EQ.1) THEN
              IF (IW(IDLTFW+1).EQ.1.OR.IW(IDLTFW+1).EQ.2) THEN
                LTFWCD = IW(IDLTFW+1)
              ENDIF
            ENDIF
          ENDIF
          IF (LTFWCD.EQ.1.OR.LTFWCD.EQ.2) THEN
            IF (YEARID.LE.1989) CPYEAR = 0
            IF (YEARID.EQ.1990) CPYEAR = 1
            IF (YEARID.EQ.1991) CPYEAR = 2
            IF (YEARID.EQ.1992) CPYEAR = 3
            IF (YEARID.EQ.1993) CPYEAR = 4
            CPIDL = 0
            IF (IEL.EQ.1) CPIDL = 1
            IF (I13.EQ.1.OR.I14.EQ.1) CPIDL = 2
            NATR = 1
            IF (XMCEV) THEN
              IF (CPYEAR.NE.0) THEN
                WEIGHT = FCALPOID(QP(ISTORE),PTEXCL,QCT(ISTORE)
       @          ,CPIDL,NATR,CPYEAR)
                IF (WEIGHT.EQ.-1.0) LEPCNT(LTCPDF) = LEPCNT(LTCPDF)+1
              ELSE
                WEIGHT = 0.0
              ENDIF
            ELSE
              WEIGHT = 1.0
            ENDIF
            IW(IDBMLT+(IDX-1)*NWBMLT+LMHLEN+8)  =
       @      INT(WEIGHT*LTSCFA)                        ! Lepton mc/data   weigh
 
   Words 9->16.
 
   The probablity that the lepton comes from various sources (described in
   the BMLT bank description) is filled for data and monte carlo events
   corresponding to 1990 and 1991. Probabilities for the 1992 data and monte
   carlo have not yet been calculated. The Altarelli model is used.
 
            DO 560 SIDX = 1,8
              IF (CPYEAR.NE.0) THEN
                IF (PTEXCL.EQ.0.000000)PTEXCL = 0.000001
                WEIGHT = FUNPROB(CPYEAR,LTFWCD,CPIDL,SIDX,
       @          QP(ISTORE),PTEXCL)
                IF (WEIGHT.EQ.-1.0) LEPCNT(LTCPDF) = LEPCNT(LTCPDF)+1
                IW(IDBMLT+(IDX-1)*NWBMLT+LMHLEN+SIDX+8) =
       @            INT(WEIGHT*LTSCFA)                    ! Probability weight n
              ELSE
                IW(IDBMLT+(IDX-1)*NWBMLT+LMHLEN+SIDX+8) = 0
              ENDIF
    560     CONTINUE
 
   If no (or an incorrect) LTFW card existed set all the weights to zero.
 
          ELSE
            DO 565 SIDX = 8,16
              IW(IDBMLT+(IDX-1)*NWBMLT+LMHLEN+SIDX) = 0 ! No LTFW card
    565     CONTINUE
          ENDIF
 
   Word 17.   FINLEP Flavour
 
          IW4 = ITABL(IDNDBM,IDX,4)
          IW(IDBMLT+(IDX-1)*NWBMLT+LMHLEN+17) = IBITS(IW4,0,4)
          IF (LDEBUG) WRITE(LTOUT,*) 'Quark flavour',IBITS(IW4,0,4)
 
   Word 18.   FINLEP decay type code
 
          IW(IDBMLT+(IDX-1)*NWBMLT+LMHLEN+18) = IBITS(IW4,4,8)-36
          IF (LDEBUG) WRITE(LTOUT,*) 'FINLEP code',(IBITS(IW4,4,8)-36)
 
   Word 19.   FINLEP lepton parent
 
          IW(IDBMLT+(IDX-1)*NWBMLT+LMHLEN+19) = IBITS(IW4,12,10)
          IF (LDEBUG) WRITE(LTOUT,*) 'Lepton parent',IBITS(IW4,12,10)
 
   Word 20.   Energy flow object
 
          IW(IDBMLT+(IDX-1)*NWBMLT+LMHLEN+20) = IBITS(IW4,22,10)
          IF (LDEBUG) WRITE(LTOUT,*) 'Enflw object',IBITS(IW4,22,10)
          IF (LDEBUG) WRITE(LTOUT,*) '----------------------------------'
   500  CONTINUE
 
   Format statements.
 
   1000 FORMAT(1X,'+--------------------------------------------+')
   1001 FORMAT(1X,'| Welcome to LEPTAG Version 4.1              |')
   1002 FORMAT(1X,'| -----------------------------              |')
   1003 FORMAT(1X,'|                                            |')
   1004 FORMAT(1X,'| Note: This is the nano expansion of the    |')
   1005 FORMAT(1X,'| NDBM bank, no further input is needed.     |')
   1006 FORMAT(1X,'|                                            |')
   1007 FORMAT(1X,'| Weights will not be filled.                |')
   1008 FORMAT(1X,'| Weight filling selected (Altarelli model). |')
   1009 FORMAT(1X,'| Weight filling selected (ISGW model).      |')
   1010 FORMAT(1X,'| You are using ',I4,' monte carlo data.       |')
   1011 FORMAT(1X,'| You are using ',I4,' real data.              |')
        IRET=NLEPT
        RETURN
        END
 
  ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
  ------------------------------------------------------------------------------
   LEPTAG
        |---- LTNANO                                          File     : NMACR
                   |----  SIGN                                External
                   |----  SQRT                                External
                   |----  ABS                                 External
                   |----  NINT                                External
                   |----  ATG                                 External
                   |----  IAND                                External
                   |----  ISHFT                               External
                   |----  FLOAT                               External
                   |----  BTEST                               External
                   |----  SIN                                 External
                   |----  COS                                 External
                   |----  ACOS                                External
                   |----  GTYEAR                              File     : NMACR
                   |----  BKFMT                               External
                   |----  NAMIND                              External
                   |----  BDROP                               External
                   |----  NBANK                               External
                   |----  IBITS                               External
                   |----  INT                                 External
                   |----  NLINK                               External
                   |----  FCALPOID                            CALPOIDS FORTRAN
                   |----  FUNPROB                             External
  ------------------------------------------------------------------------------
 
2 FCALPOID
        REAL FUNCTION FCALPOID(P,PT,COST,IDL,NATR,IAN)
  ------------------------------------------------------------------------------
    CKEY
  ------------------------------------------------------------------------------
                  CALPOIDS FORTRAN  VERSION # 2.0
 
          For any problem  contact  PERRET @ FRCPN11
 
     This package contains 2 real functions :
         FCALPOID and FUNPROB to allow you to compute :
         - the weight to correct the M C by the right factors.
         - the probabilty that a lepton comes from some decays
 
     The STANDARD criteria to select leptons must be used to get
     right answers !
 
     To use HEVLEP you MUST LOAD this package .
 
      BUT, you can use it  outside QLEPSEL or HEVLEP :
      *  if you work inside ALPHA load also HEVLEP and
           the weight to apply to your event will be
 
               WEIGHT = FUNPOIDS(P,PT,IDL,ITK)
      FUNPOIDS is a real function
 
             you need P the momentum of the lepton
                      Pt it's transverse momentum
                      IDL = 1 for an electron
                            2     a muon
                      ITK the charge track number
 
            The program computes the other quantities used :
               the year of the M
               if the track is a lepton or a misidentification ( with
                                                                 the true
               the cosinus of the lepton angle / z beam axis to correct
                  the mu efficiency
 
       * You can use it directly outside ALPHA in a FORTRAN code :
            The weight is :
                 WEIGHT = FCALPOID(P,PT,COST,IDL,NATR,IAN)
 
                    where COST is the cosinus of the lepton angle
                          NATR allows to weight differently the track by
                               efficiency OR purity corrections factor
                               if its a lepton or a misid
                               6 conversion
                              10 misid
                               1 for instance for a true lepton
                           IAN  to choose the year of the corrections
                                1  1990 and 2 1991
                                3  1992 with the new 1992 MC
                                4  1993 with the new 1992 MC
 
   with that you can correct the M C by the right factors.
                           *******
       The real function FUNPROB allows you to compute the probabilty
        that a lepton comes from some decays
               YOU CAN USE IT OUTSIDE ALPHA OR HEVLEP :
       The probabilty that a lepton comes from ISOURCE is :
            PROBA = FUNPROB(IAN,IMODEL,IDL,ISOURCE,P,PT)
             you need P the momentum of the lepton
                      Pt it's transverse momentum
                      IDL = 1 for an electron
                            2     a muon
                      IAN  to choose the year of the corrections
                                1  1990 and 2 1991
                      IMODEL : 1 to use the altarelli model
                               2            GISW (with 32 % D**)
   ISOURCE =  1         b --> l                 ( l = e or mu )
              2         b --> tau --> l
              3         b --> c   --> l
              4         b --> W   --> c --> l
              5         c --> l
              6         hadron or other source of l coming from uds event
              7         hadron or other source of l coming from c   event
              8         hadron or other source of l coming from b   event
 
 
  c This function must be used only for the M C
  c    The output is correct ONLY if we use our standard criteria to
  c     identify the leptons : electrons ECAL + dE/dX ( ielec = 1)
  c                            muons                  ( imuon = 1)
  c Return the weight of a lepton to take into account the corrections
  c due to the discrepancy for the efficiency identification and the
  c purity between the Data and the M C
  c        inputs  :
                      P     = momentum of the lepton
  c                    PT    = tranverse momentum of the lepton
  c                    COST  = cosinus of the lepton angle / z beam axis
  c                    IDL   = identification flag of the lepton
  c                          = 1 electron
  c                          = 2 muon
 
  c                    NATR   = nature of the lepton (1-15)
  c                             6  decay ( conversion) corrected
  c                                to have the good rate
  c                             10 misid or punch through corrected
  c                                by purity factors
  c                            ELSE   leptons corrected by efficiency
  c                                   factors
 
  c                    IAN    = M C year
  c                           = 1  for 1990
  c                           = 2  for 1991
                             = 3 for the new 1992 MC to correct 1992 data
                             = 4 for the new 1992 MC to correct 1993 data
        PARAMETER (NBAN = 2 , NPTE = 2 , NCOSE = 4 , NPEDX = 7
       >,NPTEDX = 7 , NCOSEDX = 5 , NPBACE = 2 , NPTBACE = 2 , NCOSM = 20)
        PARAMETER (NBAN2= 4 , NCOSE2= 6 , NPBACE2= 5 , NCOSM2= 25)
 
        COMMON /EFFI/EFIECAL(NBAN,NPTE,NCOSE),EFIDEDX(NBAN2,NPEDX,NPTEDX
       >             ,NCOSEDX),CBACKGE(NBAN,NPBACE,NPTBACE),EFIV0(NBAN2)
       >             ,EFIMU(NBAN,NCOSM),CBACKGM(NBAN2)
       >            ,EFIECAL2(NBAN,NCOSE2),CBACKGE2(NBAN,NPBACE2,NPTBACE)
       >             ,EFIMU2(NBAN,NCOSM2),EFIRI(NBAN,NCOSEDX)
        LOGICAL XBINF
        EXTERNAL XBINF
        LOGICAL IFIRST
        DATA IFIRST /.TRUE./
        IF(IFIRST) THEN
          IFIRST = .FALSE.
          PRINT*
          PRINT*,'   *****************************************'
          PRINT*,'   **                                     **'
          PRINT*,'   **             WELCOME !               **'
          PRINT*,'   **        You are using FCALPOID       **'
          PRINT*,'   **         VERSION 2.0(24/04/94)       **'
          PRINT*,'   **  to correct efficiency and purity   **'
          PRINT*,'   **  of the lepton identification in    **'
          PRINT*,'   **      the MC to reproduce data       **'
          PRINT*,'   **                                     **'
          PRINT*,'   **   Pascal Perret -  Clermont - Fd    **'
          PRINT*,'   **   ( PERRET @ FRCPN11 )              **'
          PRINT*,'   *****************************************'
          PRINT*
          CALL  FILLDATA
        ENDIF
 
         FCALPOID = -1.
        IF(P.LT.2.)      RETURN
        IF(PT.LT.0.)     RETURN
        IF(COST.LT.-1.)  RETURN
        IF(COST.GT. 1.)  RETURN
        IF(XBINF(IAN,4)) RETURN
        IF(XBINF(IDL,2)) RETURN
 
          CALL PPTCBIN(IAN,P,PT,COST,IPTE,ICOSE,IPEDX,IPTEDX,ICOSEDX
       >  ,IPBACE,IPTBACE,ICOSMU)
  ........
             POIDS = 1.
        IF(IAN.LE.2) THEN
  muons
         IF(IDL.EQ.2) THEN
           POIDS = EFIMU(IAN,ICOSMU)
           IF(NATR.EQ.10) POIDS = CBACKGM(IAN)
         ELSE
  c..electron
           POIDS=EFIDEDX(IAN,IPEDX,IPTEDX,ICOSEDX)*EFIECAL(IAN,IPTE,ICOSE)
           IF(NATR.EQ.6) POIDS = POIDS * EFIV0(IAN)
           IF(NATR.EQ.10) POIDS = CBACKGE(IAN,IPBACE,IPTBACE)
         ENDIF
  c
        ELSE        !  ian > 2
  muons
         IF(IDL.EQ.2) THEN
           POIDS = EFIMU2(IAN-2,ICOSMU)
           IF(NATR.EQ.10) POIDS = CBACKGM(IAN)
         ELSE
  c..electron
           POIDS=EFIDEDX(IAN,IPEDX,IPTEDX,ICOSEDX)*EFIECAL2(IAN-2,ICOSE)
       >         * EFIRI(IAN-2,ICOSEDX)
           IF(NATR.EQ.6) POIDS = POIDS * EFIV0(IAN)
           IF(NATR.EQ.10) POIDS = CBACKGE2(IAN-2,IPBACE,IPTBACE)
         ENDIF
  c
        ENDIF
  c
         FCALPOID = POIDS
  c
        RETURN
        END
 
  ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
  ------------------------------------------------------------------------------
   LTNANO                                                     File     : NMACR
        |---- FCALPOID                                        CALPOIDS FORTRAN
                   |----  FILLDATA                            External
                   |----  XBINF
                   |----  PPTCBIN
  ------------------------------------------------------------------------------
 
2 PPTCBIN
        SUBROUTINE PPTCBIN(IAN,P,PT,COST,IPTE,ICOSE,IPEDX,IPTEDX,ICOSEDX
  ------------------------------------------------------------------------------
    CKEY
  ------------------------------------------------------------------------------
       >                      ,IPBACE,IPTBACE,ICOSMU)
          inputs :   p,pt,cost
  c        outputs:
                     IPTE ,ICOSE          : ECAL  binning
                     IPEDX,IPTEDX,ICOSEDX : DE/DX binning
                     IBACE,IPTBACE        : BACKGROUND electron binning
                     ICOSMU               : MUONS binning
  .......................................................................
          EXTERNAL   INDICE
 
          COSTS=ABS(COST)
 
  c... binning electrons
          IPTE    = INDICE (PT,0.,0.25,0.25,2)
          IF(COSTS.GE.0.00)   ICOSE = 1
          IF(COSTS.GE.0.73)   ICOSE = 2
          IF(COSTS.GE.0.78)   ICOSE = 3
          IF(COSTS.GE.0.90)   ICOSE = 4
 
          IPEDX   = INDICE (P,2.,20.,3.,7)
          IPTEDX  = INDICE (PT,0.,1.5,0.25,7)
          ICOSEDX = INDICE (COSTS,0.,0.8,0.2,5)
 
          IPBACE  = INDICE (P,2.,5.,3.,2)
          IPTBACE = INDICE (PT,0.,0.5,0.5,2)
  c... binning muons
          ICOSMU  = INDICE (COST,-1.0,0.9,0.1,20)
 
    binning computation to apply to the new 1992 MC to correct
    1992 and 1993 data.
        IF(IAN.GE.3) THEN
  c... new binning electrons
          IPTE    = 1
          IF(COSTS.GE.0.00)   ICOSE = 1
          IF(COSTS.GE.0.73)   ICOSE = 2
          IF(COST .GE.0.78)   ICOSE = 3
          IF(COST .GE.0.90)   ICOSE = 4
          IF(COST .LE.-0.78)  ICOSE = 5
          IF(COST .LE.-0.90)  ICOSE = 6
 
          IPBACE  = INDICE (P,2.,15.,3.,5)
          IPTBACE = INDICE (PT,0.,1.25,1.25,2)
  c... binning muons
          ICOSMU  = INDICE (COST,-1.0,0.95,0.08,25)
 
        ENDIF
          RETURN
          END
 
  ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
  ------------------------------------------------------------------------------
   FCALPOID                                                   CALPOIDS FORTRAN
        |---- PPTCBIN
                   |----  ABS                                 External
                   |----  INDICE
  ------------------------------------------------------------------------------
 
2 INDICE
        INTEGER  FUNCTION INDICE (X,XDEBU,XFIN,XPAS,NBIN)
  ------------------------------------------------------------------------------
    CKEY
  ------------------------------------------------------------------------------
  c.... give the bin contening  X
  c ...............nbin : total number of  bins
            IF(X.LE.XDEBU)THEN
             INDICE = 1
             WRITE(53,*) 'Warning in INDICE function from CALPOIDS
       >    package, indice out of range : ',X,'<',XDEBU
            ELSE IF(X.LT.XFIN)THEN
             INDICE=INT((X-XDEBU)/XPAS)+1
            ELSE
             INDICE = NBIN
            ENDIF
            RETURN
            END
 
  ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
  ------------------------------------------------------------------------------
   PPTCBIN
        |---- INDICE
                   |----  INT                                 External
  ------------------------------------------------------------------------------
 
2 FILLDATA
        SUBROUTINE FILLDATA
  ------------------------------------------------------------------------------
    CKEY
  ------------------------------------------------------------------------------
        PARAMETER (NBAN = 2 , NPTE = 2 , NCOSE = 4 , NPEDX = 7
       >,NPTEDX = 7 , NCOSEDX = 5 , NPBACE = 2 , NPTBACE = 2 , NCOSM = 20)
        PARAMETER (NBAN2= 4 , NCOSE2= 6 , NPBACE2= 5 , NCOSM2= 25)
 
        COMMON /EFFI/EFIECAL(NBAN,NPTE,NCOSE),EFIDEDX(NBAN2,NPEDX,NPTEDX
       >             ,NCOSEDX),CBACKGE(NBAN,NPBACE,NPTBACE),EFIV0(NBAN2)
       >             ,EFIMU(NBAN,NCOSM),CBACKGM(NBAN2)
       >            ,EFIECAL2(NBAN,NCOSE2),CBACKGE2(NBAN,NPBACE2,NPTBACE)
       >             ,EFIMU2(NBAN,NCOSM2),EFIRI(NBAN,NCOSEDX)
 
        DIMENSION EFIECALI(NBAN,NPTE,NCOSE),EFIDEDXI(NBAN2,NPEDX,NPTEDX
       >          ,NCOSEDX),CBACKGEI(NBAN,NPBACE,NPTBACE),EFIV0I(NBAN2)
       >          ,EFIMUI(NBAN,NCOSM),CBACKGMI(NBAN2)
       >          ,EFIECAI2(NBAN,NCOSE2),CBAKGEI2(NBAN,NPBACE2,NPTBACE)
       >          ,EFIMUI2(NBAN,NCOSM2),EFIRII(NBAN,NCOSEDX)
      Corrections  90           ELECTRONS
   effi MC90/data 90 ECAL
        DATA ((EFIECALI(1,I,J),J=1,NCOSE),I=1,NPTE)/
       > 0.956 E0,1.21  E0,0.856 E0 ,0.901 E0 ,
       > 1.000 E0,1.01  E0,0.828 E0 ,0.726 E0  /
    corrections background
        DATA ((CBACKGEI(1,I,J),I=1,NPBACE),J=1,NPTBACE) /
       >  0.82  E0, 1.12  E0
       > ,1.25  E0, 1.32  E0  /
 
  correction de/dx : p.pt,cos(t)
 
         DATA (((EFIDEDXI(1,I,J,K),I=1,NPEDX),J=1,NPTEDX),K=1,NCOSEDX)/
       > 0.8780E+00, 0.8545E+00, 0.8601E+00, 0.7915E+00, 3*0.8727E+00,
       > 0.8981E+00, 0.8729E+00, 0.8471E+00, 0.8093E+00, 3*0.9197E+00,
       > 0.9263E+00, 0.9042E+00, 0.8742E+00, 0.8762E+00, 3*0.8972E+00,
       > 0.9389E+00, 0.9198E+00, 0.8961E+00, 0.8718E+00, 3*0.8604E+00,
       > 0.9674E+00, 0.9651E+00, 0.9000E+00, 0.9090E+00, 3*0.8760E+00,
       > 0.9830E+00, 0.9478E+00, 0.9289E+00, 0.9294E+00, 3*0.8528E+00,
       > 0.9905E+00, 0.9849E+00, 0.9648E+00, 0.9577E+00, 3*0.9727E+00,
 
       > 0.8585E+00, 0.8211E+00, 0.7451E+00, 0.8516E+00, 3*0.9070E+00,
       > 0.8888E+00, 0.8662E+00, 0.8362E+00, 0.8692E+00, 3*0.8100E+00,
       > 0.9376E+00, 0.8908E+00, 0.8426E+00, 0.8172E+00, 3*0.8660E+00,
       > 0.9529E+00, 0.9178E+00, 0.8886E+00, 0.8715E+00, 3*0.8320E+00,
       > 0.9704E+00, 0.9325E+00, 0.8821E+00, 0.9214E+00, 3*0.8824E+00,
       > 0.9753E+00, 0.9763E+00, 0.9005E+00, 0.8846E+00, 3*0.9412E+00,
       > 0.9751E+00, 0.9765E+00, 0.9594E+00, 0.9592E+00, 3*0.9026E+00,
 
       > 0.8616E+00, 0.8185E+00, 0.8022E+00, 0.7880E+00, 3*0.8215E+00,
       > 0.9015E+00, 0.8530E+00, 0.8639E+00, 0.8409E+00, 3*0.8402E+00,
       > 0.9363E+00, 0.8979E+00, 0.8464E+00, 0.8255E+00, 3*0.8871E+00,
       > 0.9581E+00, 0.9355E+00, 0.8935E+00, 0.8601E+00, 3*0.8876E+00,
       > 0.9664E+00, 0.9443E+00, 0.9018E+00, 0.8783E+00, 3*0.9227E+00,
       > 0.9790E+00, 0.9691E+00, 0.9465E+00, 0.9550E+00, 3*0.8839E+00,
       > 0.9838E+00, 0.9628E+00, 0.9753E+00, 0.9492E+00, 3*0.9444E+00,
 
       > 0.9207E+00, 0.8798E+00, 0.8566E+00, 0.8311E+00, 3*0.8608E+00,
       > 0.9294E+00, 0.9065E+00, 0.8802E+00, 0.9068E+00, 3*0.9217E+00,
       > 0.9494E+00, 0.9311E+00, 0.9029E+00, 0.8732E+00, 3*0.8725E+00,
       > 0.9713E+00, 0.9557E+00, 0.9086E+00, 0.9045E+00, 3*0.9061E+00,
       > 0.9838E+00, 0.9618E+00, 0.9537E+00, 0.9147E+00, 3*0.9150E+00,
       > 0.9860E+00, 0.9773E+00, 0.9626E+00, 0.9512E+00, 3*0.9209E+00,
       > 0.9935E+00, 0.9727E+00, 0.9644E+00, 0.9568E+00, 3*0.9492E+00,
 
       > 0.9455E+00, 0.9429E+00, 0.9415E+00, 0.9273E+00, 3*0.9124E+00,
       > 0.9588E+00, 0.9459E+00, 0.9519E+00, 0.9367E+00, 3*0.9607E+00,
       > 0.9801E+00, 0.9630E+00, 0.9547E+00, 0.9495E+00, 3*0.9314E+00,
       > 0.9765E+00, 0.9790E+00, 0.9603E+00, 0.9549E+00, 3*0.9311E+00,
       > 0.9984E+00, 0.9968E+00, 0.9518E+00, 0.9606E+00, 3*0.9454E+00,
       > 0.9858E+00, 0.9859E+00, 0.9795E+00, 0.9726E+00, 3*0.9494E+00,
       > 0.1001E+01, 0.9944E+00, 0.9871E+00, 0.9906E+00, 3*0.9775E+00 /
    corrections conversion
        DATA  EFIV0I (1) /1.057/
      Corrections  91           ELECTRONS
   effi MC91/data 91  ECAL    :PT,COST
 
        DATA ((EFIECALI(2,I,J),J=1,NCOSE),I=1,NPTE)/
       > 0.938 E0,0.972 E0,0.894 E0 ,0.945 E0 ,
       > 0.969 E0,1.15  E0,0.873 E0 ,0.88  E0  /
 
  corrections dE/dX : p,pt cost
 
         DATA (((EFIDEDXI (2,I,J,K),I=1,NPEDX),J=1,NPTEDX),K=1,NCOSEDX)/
       > 0.1053E+01, 0.1087E+01, 0.1097E+01, 0.1169E+01, 3*0.1127E+01,
       > 0.1041E+01, 0.1067E+01, 0.1079E+01, 0.1078E+01, 3*0.1069E+01,
       > 0.1023E+01, 0.1051E+01, 0.1058E+01, 0.1079E+01, 3*0.1101E+01,
       > 0.1020E+01, 0.1028E+01, 0.1043E+01, 0.1083E+01, 3*0.1088E+01,
       > 0.1016E+01, 0.1026E+01, 0.1048E+01, 0.1079E+01, 3*0.1093E+01,
       > 0.1010E+01, 0.1035E+01, 0.1033E+01, 0.1055E+01, 3*0.1015E+01,
       > 0.1007E+01, 0.1022E+01, 0.1051E+01, 0.1050E+01, 3*0.1029E+01,
       > 0.1062E+01, 0.1076E+01, 0.1078E+01, 0.1064E+01, 3*0.1059E+01,
       > 0.1034E+01, 0.1053E+01, 0.1055E+01, 0.1083E+01, 3*0.1041E+01,
       > 0.1027E+01, 0.1046E+01, 0.1061E+01, 0.1053E+01, 3*0.1087E+01,
       > 0.1016E+01, 0.1039E+01, 0.1054E+01, 0.1094E+01, 3*0.1080E+01,
       > 0.1018E+01, 0.1024E+01, 0.1053E+01, 0.1069E+01, 3*0.1070E+01,
       > 0.1017E+01, 0.1014E+01, 0.1047E+01, 0.1061E+01, 3*0.1065E+01,
       > 0.1004E+01, 0.1022E+01, 0.1027E+01, 0.1036E+01, 3*0.1076E+01,
       > 0.1043E+01, 0.1070E+01, 0.1033E+01, 0.1010E+01, 3*0.1077E+01,
       > 0.1025E+01, 0.1037E+01, 0.1061E+01, 0.1072E+01, 3*0.1007E+01,
       > 0.1012E+01, 0.1028E+01, 0.1040E+01, 0.1066E+01, 3*0.1059E+01,
       > 0.1015E+01, 0.1023E+01, 0.1034E+01, 0.1028E+01, 3*0.1033E+01,
       > 0.1008E+01, 0.1023E+01, 0.1015E+01, 0.1059E+01, 3*0.1049E+01,
       > 0.1005E+01, 0.1021E+01, 0.1031E+01, 0.1037E+01, 3*0.1036E+01,
       > 0.1007E+01, 0.1014E+01, 0.1020E+01, 0.1018E+01, 3*0.1046E+01,
       > 0.1022E+01, 0.1030E+01, 0.1037E+01, 0.1008E+01, 3*0.1022E+01,
       > 0.1012E+01, 0.1020E+01, 0.1035E+01, 0.1017E+01, 3*0.1047E+01,
       > 0.1009E+01, 0.1015E+01, 0.1018E+01, 0.1031E+01, 3*0.1040E+01,
       > 0.1006E+01, 0.1014E+01, 0.1019E+01, 0.1017E+01, 3*0.1010E+01,
       > 0.1007E+01, 0.1008E+01, 0.1018E+01, 0.1016E+01, 3*0.1010E+01,
       > 0.1004E+01, 0.9992E+00, 0.9970E+00, 0.9999E+00, 3*0.1033E+01,
       > 0.1002E+01, 0.1006E+01, 0.1002E+01, 0.1006E+01, 3*0.1011E+01,
       > 0.1026E+01, 0.1036E+01, 0.1025E+01, 0.1030E+01, 3*0.9800E+00,
       > 0.1015E+01, 0.1028E+01, 0.1027E+01, 0.1040E+01, 3*0.1024E+01,
       > 0.1010E+01, 0.1020E+01, 0.1022E+01, 0.1017E+01, 3*0.1036E+01,
       > 0.1005E+01, 0.1014E+01, 0.1011E+01, 0.1014E+01, 3*0.1021E+01,
       > 0.1004E+01, 0.1009E+01, 0.1015E+01, 0.1025E+01, 3*0.1030E+01,
       > 0.9994E+00, 0.1002E+01, 0.1008E+01, 0.1005E+01, 3*0.1034E+01,
       > 0.1000E+01, 0.1006E+01, 0.1012E+01, 0.1017E+01, 3*0.1023E+01  /
    corrections background
        DATA ((CBACKGEI(2,I,J),I=1,NPBACE),J=1,NPTBACE) /
       >  0.835 E0, 0.729 E0
       > ,0.917 E0, 0.825 E0  /
    corrections conversion
        DATA  EFIV0I (2) /1.052E0/
      Corrections  92           ELECTRONS
   effi MC92/data 92  ECAL    :   COST
 
        DATA (EFIECAI2(1,J),J=1,NCOSE2)/
       > 0.984 E0,0.943 E0,0.954 E0 ,0.992 E0 ,0.916 E0,1.027 E0 /
 
  corrections dE/dX : p,pt cost
 
         DATA (((EFIDEDXI (3,I,J,K),I=1,NPEDX),J=1,NPTEDX),K=1,NCOSEDX)/
       > 0.1084E+01, 0.1106E+01, 0.1120E+01, 0.1140E+01, 3*0.1189E+01,
       > 0.1047E+01, 0.1070E+01, 0.1112E+01, 0.1126E+01, 3*0.1093E+01,
       > 0.1034E+01, 0.1055E+01, 0.1081E+01, 0.1106E+01, 3*0.1102E+01,
       > 0.1017E+01, 0.1045E+01, 0.1073E+01, 0.1095E+01, 3*0.1096E+01,
       > 0.1015E+01, 0.1030E+01, 0.1053E+01, 0.1079E+01, 3*0.1092E+01,
       > 0.1011E+01, 0.1030E+01, 0.1056E+01, 0.1107E+01, 3*0.1042E+01,
       > 0.1016E+01, 0.1024E+01, 0.1050E+01, 0.1053E+01, 3*0.1050E+01,
 
       > 0.1069E+01, 0.1088E+01, 0.1079E+01, 0.1132E+01, 3*0.1164E+01,
       > 0.1043E+01, 0.1060E+01, 0.1097E+01, 0.1112E+01, 3*0.1143E+01,
       > 0.1026E+01, 0.1051E+01, 0.1074E+01, 0.1090E+01, 3*0.1102E+01,
       > 0.1019E+01, 0.1039E+01, 0.1071E+01, 0.1084E+01, 3*0.1078E+01,
       > 0.1019E+01, 0.1034E+01, 0.1049E+01, 0.1051E+01, 3*0.1062E+01,
       > 0.1020E+01, 0.1038E+01, 0.1062E+01, 0.1049E+01, 3*0.1089E+01,
       > 0.1013E+01, 0.1026E+01, 0.1049E+01, 0.1062E+01, 3*0.1058E+01,
 
       > 0.1057E+01, 0.1069E+01, 0.1100E+01, 0.1095E+01, 3*0.1070E+01,
       > 0.1029E+01, 0.1053E+01, 0.1070E+01, 0.1080E+01, 3*0.1094E+01,
       > 0.1021E+01, 0.1039E+01, 0.1048E+01, 0.1071E+01, 3*0.1069E+01,
       > 0.1014E+01, 0.1032E+01, 0.1040E+01, 0.1074E+01, 3*0.1055E+01,
       > 0.1011E+01, 0.1028E+01, 0.1028E+01, 0.1056E+01, 3*0.1046E+01,
       > 0.1008E+01, 0.1020E+01, 0.1044E+01, 0.1038E+01, 3*0.1048E+01,
       > 0.1010E+01, 0.1018E+01, 0.1028E+01, 0.1035E+01, 3*0.1038E+01,
 
       > 0.1029E+01, 0.1032E+01, 0.1041E+01, 0.1035E+01, 3*0.1052E+01,
       > 0.1014E+01, 0.1023E+01, 0.1037E+01, 0.1036E+01, 3*0.1044E+01,
       > 0.1010E+01, 0.1019E+01, 0.1029E+01, 0.1028E+01, 3*0.1047E+01,
       > 0.1008E+01, 0.1020E+01, 0.1021E+01, 0.1019E+01, 3*0.1031E+01,
       > 0.1006E+01, 0.1016E+01, 0.1022E+01, 0.1026E+01, 3*0.1031E+01,
       > 0.1004E+01, 0.1006E+01, 0.1009E+01, 0.1019E+01, 3*0.1032E+01,
       > 0.1006E+01, 0.1007E+01, 0.1015E+01, 0.1019E+01, 3*0.1017E+01,
 
       > 0.1019E+01, 0.1041E+01, 0.1030E+01, 0.1038E+01, 3*0.1073E+01,
       > 0.1014E+01, 0.1023E+01, 0.1024E+01, 0.1038E+01, 3*0.1021E+01,
       > 0.1011E+01, 0.1018E+01, 0.1022E+01, 0.1024E+01, 3*0.1025E+01,
       > 0.1007E+01, 0.1011E+01, 0.1026E+01, 0.1016E+01, 3*0.1020E+01,
       > 0.1006E+01, 0.1010E+01, 0.1020E+01, 0.1026E+01, 3*0.1033E+01,
       > 0.1004E+01, 0.1004E+01, 0.1018E+01, 0.1022E+01, 3*0.1034E+01,
       > 0.1001E+01, 0.1009E+01, 0.1011E+01, 0.1022E+01, 3*0.1020E+01 /
 
  corrections Ri    :  cost
        DATA (EFIRII(1,I),I=1,NCOSEDX)/
       > 1.022 E0,1.018 E0,1.016 E0 ,1.000 E0 ,0.984 E0 /
    corrections background
        DATA ((CBAKGEI2(1,I,J),I=1,NPBACE2),J=1,NPTBACE) /
       >  0.95 E0, 1.12 E0, 1.10 E0, 0.85 E0, 0.83 E0
       > ,5*1.16 E0  /
    corrections conversion
        DATA  EFIV0I (3) /1.070 E0 /
      Corrections  93           ELECTRONS
   effi MC92/data 93  ECAL    :   COST
 
        DATA (EFIECAI2(2,J),J=1,NCOSE2)/
       > 0.983 E0,0.974 E0,0.898 E0 ,1.021 E0 ,0.907 E0,0.933 E0 /
 
  corrections dE/dX : p,pt cost
 
         DATA (((EFIDEDXI (4,I,J,K),I=1,NPEDX),J=1,NPTEDX),K=1,NCOSEDX)/
       > 0.1074E+01, 0.1075E+01, 0.1080E+01, 0.1153E+01, 3*0.1159E+01,
       > 0.1039E+01, 0.1071E+01, 0.1087E+01, 0.1137E+01, 3*0.1078E+01,
       > 0.1028E+01, 0.1053E+01, 0.1074E+01, 0.1087E+01, 3*0.1082E+01,
       > 0.1023E+01, 0.1031E+01, 0.1061E+01, 0.1062E+01, 3*0.1079E+01,
       > 0.1015E+01, 0.1027E+01, 0.1047E+01, 0.1061E+01, 3*0.1095E+01,
       > 0.1010E+01, 0.1031E+01, 0.1051E+01, 0.1112E+01, 3*0.1037E+01,
       > 0.1013E+01, 0.1027E+01, 0.1035E+01, 0.1038E+01, 3*0.1050E+01,
 
       > 0.1055E+01, 0.1077E+01, 0.1074E+01, 0.1094E+01, 3*0.1160E+01,
       > 0.1030E+01, 0.1050E+01, 0.1070E+01, 0.1099E+01, 3*0.1133E+01,
       > 0.1024E+01, 0.1041E+01, 0.1062E+01, 0.1063E+01, 3*0.1057E+01,
       > 0.1018E+01, 0.1034E+01, 0.1058E+01, 0.1083E+01, 3*0.1096E+01,
       > 0.1015E+01, 0.1026E+01, 0.1056E+01, 0.1045E+01, 3*0.1058E+01,
       > 0.1014E+01, 0.1022E+01, 0.1043E+01, 0.1052E+01, 3*0.1061E+01,
       > 0.1014E+01, 0.1022E+01, 0.1038E+01, 0.1044E+01, 3*0.1045E+01,
 
       > 0.1040E+01, 0.1050E+01, 0.1044E+01, 0.1046E+01, 3*0.1079E+01,
       > 0.1019E+01, 0.1040E+01, 0.1034E+01, 0.1050E+01, 3*0.1053E+01,
       > 0.1014E+01, 0.1024E+01, 0.1035E+01, 0.1055E+01, 3*0.1052E+01,
       > 0.1015E+01, 0.1018E+01, 0.1031E+01, 0.1066E+01, 3*0.1052E+01,
       > 0.1010E+01, 0.1032E+01, 0.1029E+01, 0.1058E+01, 3*0.1044E+01,
       > 0.1011E+01, 0.1025E+01, 0.1043E+01, 0.1053E+01, 3*0.1037E+01,
       > 0.1008E+01, 0.1016E+01, 0.1026E+01, 0.1035E+01, 3*0.1026E+01,
 
       > 0.1014E+01, 0.1016E+01, 0.1022E+01, 0.1020E+01, 3*0.1044E+01,
       > 0.1009E+01, 0.1013E+01, 0.1022E+01, 0.1026E+01, 3*0.1039E+01,
       > 0.1009E+01, 0.1013E+01, 0.1017E+01, 0.1028E+01, 3*0.1028E+01,
       > 0.1005E+01, 0.1016E+01, 0.1010E+01, 0.1017E+01, 3*0.1035E+01,
       > 0.1003E+01, 0.1011E+01, 0.1010E+01, 0.1017E+01, 3*0.1014E+01,
       > 0.1004E+01, 0.1007E+01, 0.1011E+01, 0.1008E+01, 3*0.1017E+01,
       > 0.1005E+01, 0.1007E+01, 0.1013E+01, 0.1018E+01, 3*0.1017E+01,
 
       > 0.1017E+01, 0.1025E+01, 0.1037E+01, 0.1035E+01, 3*0.1037E+01,
       > 0.1016E+01, 0.1020E+01, 0.1024E+01, 0.1048E+01, 3*0.1024E+01,
       > 0.1009E+01, 0.1020E+01, 0.1025E+01, 0.1028E+01, 3*0.1030E+01,
       > 0.1004E+01, 0.1010E+01, 0.1028E+01, 0.1027E+01, 3*0.1026E+01,
       > 0.1005E+01, 0.1013E+01, 0.1015E+01, 0.1024E+01, 3*0.1032E+01,
       > 0.1003E+01, 0.1013E+01, 0.1015E+01, 0.1019E+01, 3*0.1027E+01,
       > 0.1000E+01, 0.1010E+01, 0.1011E+01, 0.1021E+01, 3*0.1027E+01 /
 
  corrections Ri    :  cost
        DATA (EFIRII(2,I),I=1,NCOSEDX)/
       > 1.020 E0,1.027 E0,1.022 E0 ,1.013 E0 ,1.000 E0 /
    corrections background
        DATA ((CBAKGEI2(2,I,J),I=1,NPBACE2),J=1,NPTBACE) /
       >  1.31 E0, 1.41 E0, 1.28 E0, 1.05 E0, 0.97 E0
       > ,5*1.26 E0  /
    corrections conversion
        DATA  EFIV0I (4) /1.089 E0 /
   ---------------------------  MUONS --------------------------------
    Muons Efficiency  function of cos T
        DATA (EFIMUI(1,I),I=1,NCOSM)/
       >  0.9142 E0, 0.9551 E0 , 1.0267 E0, 1.0334 E0,0.9589 E0 ,
       >  0.9767 E0, 0.9110 E0 , 0.9439 E0, 0.9577 E0,0.9881 E0 ,
       >  0.9745 E0, 0.9846 E0 , 1.0032 E0, 0.9494 E0,1.0484 E0 ,
       >  1.0336 E0, 0.9517 E0 , 1.0304 E0, 0.9866 E0,0.9289 E0  /
    Punch Through correction
        DATA CBACKGMI(1) / 1.16 E0 /
 
    Muons Efficiency  function of cos T
        DATA (EFIMUI(2,I),I=1,NCOSM)/
       >  0.9142 E0, 0.9551 E0 , 1.0267 E0, 1.0334 E0,0.9589 E0 ,
       >  0.9767 E0, 0.9110 E0 , 0.9439 E0, 0.9577 E0,0.9881 E0 ,
       >  0.9745 E0, 0.9846 E0 , 1.0032 E0, 0.9494 E0,1.0484 E0 ,
       >  1.0336 E0, 0.9517 E0 , 1.0304 E0, 0.9866 E0,0.9289 E0  /
    Punch Through correction
        DATA CBACKGMI(2) / 1.16 E0 /
 
    Muons Efficiency  function of cos T    92
        DATA (EFIMUI2(1,I),I=1,NCOSM2)/
       > 0.8129E+00, 0.9400E+00, 0.9860E+00, 0.1039E+01, 0.1005E+01,
       > 0.9789E+00, 0.9930E+00, 0.9851E+00, 0.9795E+00, 0.1004E+01,
       > 0.9880E+00, 0.9780E+00, 0.1013E+01, 0.9853E+00, 0.1001E+01,
       > 0.1002E+01, 0.9715E+00, 0.1000E+01, 0.9910E+00, 0.9727E+00,
       > 0.1013E+01, 0.1019E+01, 0.9741E+00, 0.9475E+00, 0.8239E+00/
    Punch Through correction
        DATA CBACKGMI(3) / 1.19 E0 /
 
    Muons Efficiency  function of cos T    93
        DATA (EFIMUI2(2,I),I=1,NCOSM2)/
       > 0.7678E+00, 0.9330E+00, 0.9740E+00, 0.1042E+01, 0.9924E+00,
       > 0.9687E+00, 0.9458E+00, 0.9504E+00, 0.9225E+00, 0.9555E+00,
       > 0.9515E+00, 0.9760E+00, 0.9765E+00, 0.9560E+00, 0.9690E+00,
       > 0.9739E+00, 0.9642E+00, 0.9766E+00, 0.9675E+00, 0.9700E+00,
       > 0.1044E+01, 0.1025E+01, 0.9678E+00, 0.9440E+00, 0.8118E+00/
    Punch Through correction
        DATA CBACKGMI(4) / 1.16 E0 /
        DO 1 I = 1, NBAN
           DO 2 IPTE = 1, NPTE
           DO 2 ICOSE = 1, NCOSE
            EFIECAL(I,IPTE,ICOSE) = EFIECALI(I,IPTE,ICOSE)
    2      CONTINUE
           DO 3 ICOSE2 = 1, NCOSE2
            EFIECAL2(I,ICOSE2) = EFIECAI2(I,ICOSE2)
    3      CONTINUE
           DO 4 ICOSEDX = 1, NCOSEDX
            EFIRI(I,ICOSEDX)=EFIRII(I,ICOSEDX)
    4      CONTINUE
           DO 5 IPACE = 1, NPBACE
           DO 5 IPTBACE = 1, NPTBACE
            CBACKGE(I,IPACE,IPTBACE) = CBACKGEI(I,IPACE,IPTBACE)
    5      CONTINUE
           DO 6 IPACE2 = 1, NPBACE2
           DO 6 IPTBACE = 1, NPTBACE
            CBACKGE2(I,IPACE2,IPTBACE) = CBAKGEI2(I,IPACE2,IPTBACE)
    6      CONTINUE
           DO 7 ICOSM = 1, NCOSM
            EFIMU(I,ICOSM) = EFIMUI(I,ICOSM)
    7      CONTINUE
           DO 8 ICOSM2 = 1, NCOSM2
            EFIMU2(I,ICOSM2) = EFIMUI2(I,ICOSM2)
    8      CONTINUE
    1   CONTINUE
        DO 10 I = 1, NBAN2
           DO 11 IPEDX = 1, NPEDX
           DO 11 IPTEDX = 1, NPTEDX
           DO 11 ICOSEDX = 1, NCOSEDX
          EFIDEDX(I,IPEDX,IPTEDX,ICOSEDX)=EFIDEDXI(I,IPEDX,IPTEDX,ICOSEDX)
    11      CONTINUE
           EFIV0(I) = EFIV0I(I)
           CBACKGM(I) = CBACKGMI(I)
   10   CONTINUE
        RETURN
        END
2 FUNPROB
        REAL FUNCTION FUNPROB(IAN,IMODEL,IDL,ISOURCE,P,PT)
  ------------------------------------------------------------------------------
    CKEY
  ------------------------------------------------------------------------------
  c  WARNING !!!
  c This function must be used only with the standard selection cuts !
  c Return the probability of a track  to be in a P, P_t bin :
         ISOURCE
  c          1           b --> l                 ( l = e or mu )
  c          2           b --> tau --> l
  c          3           b --> c   --> l
  c          4           b --> W   --> c --> l
  c          5           c --> l
  c          6           hadron or other source of l coming from uds event
  c          7           hadron or other source of l coming from c   event
  c          8           hadron or other source of l coming from b   event
  c        inputs  :
                      P     = momentum of the lepton
  c                    PT    = tranverse momentum of the lepton
  c                    IDL   = identification flag of the lep
  c                          = 1 electron
  c                          = 2 muon
  c                    IAN    = M C year
  c                           = 1  for 1990
  c                           = 2  for 1991
                      IMODEL = 1 ALTARELLI
  c                             2 GISW
                      ISOURCE= 1 - 8
        PARAMETER (NP = 7 , NPT  = 8 ,NANNEE = 2, NMODEL = 2, NSOURCE = 8
       > , NLEP = 2 )
        DIMENSION PROBA(NANNEE,NMODEL,NLEP,NSOURCE,NP,NPT)
        LOGICAL XBINF
        EXTERNAL   INDICE,XBINF
        LOGICAL IFIRST
        DATA IFIRST /.TRUE./
        IF(IFIRST) THEN
          IFIRST = .FALSE.
          PRINT*
          PRINT*,'   ******************************************'
          PRINT*,'   **                                      **'
          PRINT*,'   **             WELCOME !                **'
          print*,'   **        you are using FUNPROB         **'
          PRINT*,'   **         VERSION 1.0(12/11/92)        **'
          print*,'   **    This function gives you the       **'
          print*,'   **  probability that a lepton comes     **'
          print*,'   **       from a given sources.          **'
          PRINT*,'   **  WARNING  leptons must be identified **'
          PRINT*,'   **  with the standard criteria given    **'
          PRINT*,'   **            by HEVLEP                 **'
          PRINT*,'   **                                      **'
          PRINT*,'   **   Pascal Perret -  Clermont - Fd     **'
          PRINT*,'   **   ( PERRET @ FRCPN11 )               **'
          PRINT*,'   ******************************************'
          PRINT*
        ENDIF
                    PROBA 91  ALTARELLI
    PROB B  E
          DATA ((PROBA(2,1,1,1,I,J),I=1,NP),J=1,NPT) /
       >  0.0430,  0.0735,  0.1219,  0.2226,  0.3208,  0.2769,  0.2512,
       >  0.1147,  0.1312,  0.1710,  0.2331,  0.3666,  0.3819,  0.6649,
       >  0.3775,  0.3195,  0.3459,  0.3779,  0.4726,  0.5481,  0.6196,
       >  0.7003,  0.5925,  0.6004,  0.5664,  0.5635,  0.6360,  0.6169,
       >  0.8409,  0.8101,  0.7565,  0.7066,  0.6861,  0.7649,  0.7853,
       >  0.8377,  0.8794,  0.8714,  0.8440,  0.8216,  0.8050,  0.7551,
       >  0.7945,  0.9277,  0.9151,  0.9081,  0.8934,  0.8873,  0.8614,
       >  0.8807,  0.8717,  0.9328,  0.9383,  0.9276,  0.9334,  0.9196/
 
    PROB B  T E
          DATA ((PROBA(2,1,1,2,I,J),I=1,NP),J=1,NPT) /
       >  0.0118,  0.0104,  0.0126,  0.0000,  0.0170,  0.0000,  0.0000,
       >  0.0185,  0.0174,  0.0132,  0.0146,  0.0000,  0.0000,  0.0000,
       >  0.0422,  0.0316,  0.0246,  0.0110,  0.0000,  0.0000,  0.0000,
       >  0.0285,  0.0371,  0.0322,  0.0204,  0.0047,  0.0164,  0.0114,
       >  0.0183,  0.0221,  0.0166,  0.0289,  0.0134,  0.0092,  0.0000,
       >  0.0045,  0.0202,  0.0164,  0.0128,  0.0196,  0.0000,  0.0103,
       >  0.0343,  0.0081,  0.0110,  0.0116,  0.0101,  0.0092,  0.0000,
       >  0.0000,  0.0121,  0.0127,  0.0020,  0.0185,  0.0028,  0.0061/
 
    PROB B  C
          DATA ((PROBA(2,1,1,3,I,J),I=1,NP),J=1,NPT) /
       >  0.1292,  0.1194,  0.0858,  0.0611,  0.0183,  0.0205,  0.0835,
       >  0.2219,  0.1618,  0.1059,  0.0529,  0.0357,  0.0689,  0.0297,
       >  0.2541,  0.2015,  0.1289,  0.0836,  0.0413,  0.0569,  0.0080,
       >  0.1371,  0.1756,  0.1350,  0.1069,  0.0499,  0.0161,  0.0182,
       >  0.0651,  0.0817,  0.1120,  0.0920,  0.0623,  0.0320,  0.0262,
       >  0.0584,  0.0564,  0.0667,  0.0621,  0.0454,  0.0318,  0.0181,
       >  0.0306,  0.0311,  0.0372,  0.0504,  0.0515,  0.0198,  0.0268,
       >  0.0307,  0.0448,  0.0323,  0.0358,  0.0352,  0.0339,  0.0274/
 
    PROB B WC E
          DATA ((PROBA(2,1,1,4,I,J),I=1,NP),J=1,NPT) /
       >  0.0207,  0.0189,  0.0095,  0.0000,  0.0000,  0.0000,  0.0000,
       >  0.0349,  0.0285,  0.0229,  0.0110,  0.0045,  0.0000,  0.0000,
       >  0.0343,  0.0277,  0.0175,  0.0064,  0.0000,  0.0000,  0.0000,
       >  0.0091,  0.0144,  0.0124,  0.0089,  0.0035,  0.0000,  0.0000,
       >  0.0025,  0.0037,  0.0064,  0.0017,  0.0036,  0.0000,  0.0000,
       >  0.0000,  0.0000,  0.0011,  0.0000,  0.0069,  0.0065,  0.0000,
       >  0.0205,  0.0000,  0.0000,  0.0000,  0.0000,  0.0000,  0.0000,
       >  0.0000,  0.0039,  0.0019,  0.0000,  0.0000,  0.0000,  0.0000/
 
    PROB C    E
          DATA ((PROBA(2,1,1,5,I,J),I=1,NP),J=1,NPT) /
       >  0.1994,  0.2806,  0.3487,  0.4171,  0.4983,  0.2704,  0.2826,
       >  0.2582,  0.3276,  0.3692,  0.3658,  0.3687,  0.3232,  0.1821,
       >  0.1174,  0.2428,  0.3360,  0.3759,  0.3561,  0.1936,  0.2135,
       >  0.0534,  0.1016,  0.1619,  0.2149,  0.3035,  0.2434,  0.2040,
       >  0.0272,  0.0455,  0.0825,  0.1170,  0.1810,  0.1146,  0.1125,
       >  0.0436,  0.0252,  0.0343,  0.0491,  0.0921,  0.1294,  0.1174,
       >  0.0246,  0.0104,  0.0203,  0.0174,  0.0241,  0.0689,  0.0607,
       >  0.0125,  0.0200,  0.0121,  0.0143,  0.0088,  0.0147,  0.0179/
 
    PROB X  U E
          DATA ((PROBA(2,1,1,6,I,J),I=1,NP),J=1,NPT) /
       >  0.4009,  0.3669,  0.3374,  0.2461,  0.1329,  0.4008,  0.1963,
       >  0.2132,  0.2411,  0.2438,  0.2756,  0.1864,  0.1957,  0.1235,
       >  0.1037,  0.1109,  0.1035,  0.0999,  0.1134,  0.1866,  0.1591,
       >  0.0405,  0.0430,  0.0317,  0.0559,  0.0527,  0.0759,  0.1496,
       >  0.0361,  0.0140,  0.0132,  0.0320,  0.0398,  0.0601,  0.0668,
       >  0.0300,  0.0115,  0.0051,  0.0109,  0.0105,  0.0206,  0.0833,
       >  0.0491,  0.0133,  0.0098,  0.0000,  0.0165,  0.0080,  0.0322,
       >  0.0360,  0.0387,  0.0025,  0.0020,  0.0084,  0.0132,  0.0187/
 
    PROB X  C
          DATA ((PROBA(2,1,1,7,I,J),I=1,NP),J=1,NPT) /
       >  0.1034,  0.0797,  0.0571,  0.0440,  0.0000,  0.0325,  0.1891,
       >  0.0566,  0.0495,  0.0466,  0.0263,  0.0172,  0.0106,  0.0000,
       >  0.0244,  0.0206,  0.0253,  0.0269,  0.0104,  0.0152,  0.0000,
       >  0.0114,  0.0099,  0.0101,  0.0162,  0.0127,  0.0124,  0.0000,
       >  0.0014,  0.0065,  0.0040,  0.0097,  0.0104,  0.0140,  0.0094,
       >  0.0074,  0.0000,  0.0000,  0.0039,  0.0000,  0.0000,  0.0085,
       >  0.0115,  0.0034,  0.0000,  0.0000,  0.0045,  0.0000,  0.0062,
       >  0.0107,  0.0000,  0.0000,  0.0000,  0.0015,  0.0000,  0.0064/
 
    PROB X  B E
          DATA ((PROBA(2,1,1,8,I,J),I=1,NP),J=1,NPT) /
       >  0.0922,  0.0515,  0.0278,  0.0097,  0.0128,  0.0000,  0.0000,
       >  0.0819,  0.0431,  0.0280,  0.0211,  0.0212,  0.0199,  0.0000,
       >  0.0461,  0.0453,  0.0185,  0.0187,  0.0064,  0.0000,  0.0000,
       >  0.0197,  0.0258,  0.0163,  0.0105,  0.0095,  0.0000,  0.0000,
       >  0.0084,  0.0164,  0.0088,  0.0122,  0.0034,  0.0054,  0.0000,
       >  0.0184,  0.0073,  0.0050,  0.0171,  0.0037,  0.0066,  0.0075,
       >  0.0348,  0.0060,  0.0065,  0.0124,  0.0000,  0.0066,  0.0127,
       >  0.0292,  0.0086,  0.0056,  0.0074,  0.0000,  0.0019,  0.0040/
 
 
    PROB B  M
          DATA ((PROBA(2,1,2,1,I,J),I=1,NP),J=1,NPT) /
       >  0.0177,  0.0293,  0.0777,  0.1036,  0.1330,  0.2728,  0.3491,
       >  0.0464,  0.0614,  0.0908,  0.1513,  0.2223,  0.3377,  0.3699,
       >  0.1977,  0.1823,  0.1829,  0.2605,  0.3230,  0.3874,  0.4382,
       >  0.5213,  0.4576,  0.4297,  0.4138,  0.4346,  0.5077,  0.4978,
       >  0.6994,  0.6825,  0.6392,  0.6205,  0.6494,  0.6122,  0.6027,
       >  0.6757,  0.8030,  0.7850,  0.7468,  0.7628,  0.7744,  0.6749,
       >  0.7080,  0.8280,  0.8794,  0.8541,  0.8401,  0.8320,  0.7599,
       >  0.7181,  0.8271,  0.8977,  0.8929,  0.9049,  0.9049,  0.8584/
 
    PROB B  T M
          DATA ((PROBA(2,1,2,2,I,J),I=1,NP),J=1,NPT) /
       >  0.0081,  0.0064,  0.0076,  0.0064,  0.0088,  0.0000,  0.0000,
       >  0.0143,  0.0157,  0.0114,  0.0132,  0.0030,  0.0000,  0.0106,
       >  0.0283,  0.0268,  0.0210,  0.0181,  0.0053,  0.0000,  0.0000,
       >  0.0239,  0.0245,  0.0239,  0.0223,  0.0085,  0.0000,  0.0000,
       >  0.0199,  0.0266,  0.0296,  0.0073,  0.0059,  0.0157,  0.0000,
       >  0.0065,  0.0151,  0.0294,  0.0202,  0.0094,  0.0104,  0.0000,
       >  0.0000,  0.0110,  0.0191,  0.0111,  0.0100,  0.0117,  0.0000,
       >  0.0074,  0.0181,  0.0109,  0.0130,  0.0092,  0.0049,  0.0032/
 
    PROB B  C
          DATA ((PROBA(2,1,2,3,I,J),I=1,NP),J=1,NPT) /
       >  0.1167,  0.1119,  0.0878,  0.0649,  0.0473,  0.0696,  0.0000,
       >  0.1611,  0.1321,  0.1064,  0.0688,  0.0328,  0.0101,  0.0132,
       >  0.1975,  0.1847,  0.1290,  0.0837,  0.0425,  0.0246,  0.0041,
       >  0.1188,  0.1759,  0.1293,  0.0872,  0.0677,  0.0322,  0.0379,
       >  0.0432,  0.1036,  0.1104,  0.1020,  0.0581,  0.0367,  0.0202,
       >  0.0557,  0.0679,  0.0781,  0.0696,  0.0436,  0.0245,  0.0324,
       >  0.0479,  0.0345,  0.0443,  0.0528,  0.0479,  0.0181,  0.0139,
       >  0.0141,  0.0387,  0.0305,  0.0372,  0.0325,  0.0392,  0.0270/
 
    PROB B WC M
          DATA ((PROBA(2,1,2,4,I,J),I=1,NP),J=1,NPT) /
       >  0.0214,  0.0220,  0.0124,  0.0048,  0.0062,  0.0000,  0.0000,
       >  0.0311,  0.0250,  0.0138,  0.0058,  0.0020,  0.0000,  0.0074,
       >  0.0263,  0.0232,  0.0180,  0.0137,  0.0077,  0.0038,  0.0000,
       >  0.0080,  0.0152,  0.0129,  0.0081,  0.0058,  0.0043,  0.0000,
       >  0.0033,  0.0060,  0.0046,  0.0051,  0.0041,  0.0000,  0.0000,
       >  0.0000,  0.0026,  0.0042,  0.0015,  0.0000,  0.0000,  0.0000,
       >  0.0000,  0.0038,  0.0000,  0.0031,  0.0024,  0.0000,  0.0000,
       >  0.0000,  0.0000,  0.0011,  0.0000,  0.0000,  0.0000,  0.0000/
 
    PROB C   M
          DATA ((PROBA(2,1,2,5,I,J),I=1,NP),J=1,NPT) /
       >  0.1733,  0.2573,  0.3004,  0.3538,  0.3800,  0.2335,  0.2387,
       >  0.1835,  0.2825,  0.3322,  0.3368,  0.3145,  0.2437,  0.1129,
       >  0.0965,  0.2045,  0.3214,  0.3365,  0.3174,  0.2702,  0.1965,
       >  0.0472,  0.0967,  0.1933,  0.2261,  0.2645,  0.2469,  0.1763,
       >  0.0261,  0.0395,  0.0793,  0.1563,  0.1495,  0.1518,  0.1604,
       >  0.0241,  0.0176,  0.0309,  0.0599,  0.0638,  0.0882,  0.1076,
       >  0.0265,  0.0286,  0.0176,  0.0197,  0.0377,  0.0497,  0.0763,
       >  0.0352,  0.0204,  0.0157,  0.0219,  0.0284,  0.0170,  0.0322/
 
    PROB X  U M
          DATA ((PROBA(2,1,2,6,I,J),I=1,NP),J=1,NPT) /
       >  0.3829,  0.3483,  0.3448,  0.3342,  0.3422,  0.2768,  0.3542,
       >  0.3129,  0.2867,  0.2993,  0.3047,  0.3233,  0.3335,  0.3829,
       >  0.2492,  0.1917,  0.1887,  0.1859,  0.2110,  0.2410,  0.2876,
       >  0.1409,  0.1186,  0.1074,  0.1380,  0.1359,  0.1434,  0.2220,
       >  0.1189,  0.0718,  0.0656,  0.0562,  0.0757,  0.1491,  0.1798,
       >  0.1394,  0.0343,  0.0315,  0.0537,  0.0824,  0.0729,  0.1312,
       >  0.1332,  0.0520,  0.0129,  0.0226,  0.0347,  0.0592,  0.1091,
       >  0.1670,  0.0543,  0.0269,  0.0197,  0.0176,  0.0183,  0.0646/
 
    PROB X  C
          DATA ((PROBA(2,1,2,7,I,J),I=1,NP),J=1,NPT) /
       >  0.1276,  0.1306,  0.1091,  0.0999,  0.0531,  0.0932,  0.0401,
       >  0.1019,  0.0983,  0.0983,  0.0867,  0.0711,  0.0584,  0.0816,
       >  0.0716,  0.0772,  0.0703,  0.0707,  0.0695,  0.0702,  0.0598,
       >  0.0494,  0.0322,  0.0385,  0.0570,  0.0556,  0.0459,  0.0372,
       >  0.0359,  0.0153,  0.0227,  0.0214,  0.0377,  0.0200,  0.0175,
       >  0.0494,  0.0237,  0.0122,  0.0109,  0.0141,  0.0190,  0.0415,
       >  0.0258,  0.0142,  0.0027,  0.0101,  0.0103,  0.0172,  0.0294,
       >  0.0329,  0.0205,  0.0037,  0.0027,  0.0020,  0.0089,  0.0096/
 
    PROB X  B  M
          DATA ((PROBA(2,1,2,8,I,J),I=1,NP),J=1,NPT) /
       >  0.1522,  0.0950,  0.0613,  0.0336,  0.0302,  0.0548,  0.0187,
       >  0.1485,  0.0986,  0.0488,  0.0338,  0.0319,  0.0176,  0.0227,
       >  0.1324,  0.1093,  0.0689,  0.0315,  0.0245,  0.0040,  0.0147,
       >  0.0902,  0.0787,  0.0648,  0.0479,  0.0280,  0.0200,  0.0292,
       >  0.0533,  0.0542,  0.0484,  0.0311,  0.0197,  0.0147,  0.0195,
       >  0.0493,  0.0357,  0.0284,  0.0371,  0.0239,  0.0108,  0.0130,
       >  0.0582,  0.0277,  0.0237,  0.0262,  0.0169,  0.0122,  0.0118,
       >  0.0257,  0.0210,  0.0134,  0.0125,  0.0054,  0.0069,  0.0051/
 
                    PROBA 91  GISW
 
    PROB B  E
          DATA ((PROBA(2,2,1,1,I,J),I=1,NP),J=1,NPT) /
       >  0.0521,  0.0867,  0.1374,  0.2412,  0.3522,  0.2738,  0.2571,
       >  0.1408,  0.1557,  0.1920,  0.2480,  0.3718,  0.3944,  0.6490,
       >  0.4289,  0.3629,  0.3794,  0.3982,  0.4838,  0.5390,  0.6114,
       >  0.7199,  0.6313,  0.6357,  0.5917,  0.5730,  0.6411,  0.5888,
       >  0.8451,  0.8223,  0.7767,  0.7265,  0.7026,  0.7648,  0.7759,
       >  0.8335,  0.8810,  0.8781,  0.8514,  0.8217,  0.8024,  0.7432,
       >  0.7922,  0.9249,  0.9169,  0.9111,  0.8942,  0.8868,  0.8557,
       >  0.8803,  0.8715,  0.9331,  0.9377,  0.9280,  0.9289,  0.9132/
 
    PROB B  T E
          DATA ((PROBA(2,2,1,2,I,J),I=1,NP),J=1,NPT) /
       >  0.0124,  0.0119,  0.0122,  0.0000,  0.0153,  0.0000,  0.0000,
       >  0.0203,  0.0179,  0.0142,  0.0153,  0.0000,  0.0000,  0.0000,
       >  0.0429,  0.0317,  0.0248,  0.0100,  0.0000,  0.0000,  0.0000,
       >  0.0286,  0.0354,  0.0313,  0.0187,  0.0049,  0.0164,  0.0104,
       >  0.0170,  0.0211,  0.0156,  0.0261,  0.0125,  0.0078,  0.0000,
       >  0.0049,  0.0203,  0.0151,  0.0124,  0.0183,  0.0000,  0.0094,
       >  0.0347,  0.0074,  0.0104,  0.0094,  0.0088,  0.0091,  0.0000,
       >  0.0000,  0.0106,  0.0114,  0.0021,  0.0173,  0.0024,  0.0064/
 
    PROB B  C
          DATA ((PROBA(2,2,1,3,I,J),I=1,NP),J=1,NPT) /
       >  0.1158,  0.1075,  0.0772,  0.0565,  0.0171,  0.0183,  0.0979,
       >  0.1982,  0.1451,  0.0949,  0.0472,  0.0322,  0.0643,  0.0325,
       >  0.2168,  0.1749,  0.1131,  0.0750,  0.0387,  0.0527,  0.0077,
       >  0.1187,  0.1497,  0.1165,  0.0957,  0.0442,  0.0159,  0.0189,
       >  0.0607,  0.0726,  0.0977,  0.0825,  0.0573,  0.0304,  0.0271,
       >  0.0563,  0.0536,  0.0610,  0.0569,  0.0426,  0.0329,  0.0187,
       >  0.0308,  0.0316,  0.0357,  0.0487,  0.0502,  0.0190,  0.0292,
       >  0.0300,  0.0444,  0.0334,  0.0362,  0.0357,  0.0371,  0.0319/
 
    PROB B WC E
          DATA ((PROBA(2,2,1,4,I,J),I=1,NP),J=1,NPT) /
       >  0.0215,  0.0197,  0.0098,  0.0000,  0.0000,  0.0000,  0.0000,
       >  0.0362,  0.0296,  0.0237,  0.0113,  0.0045,  0.0000,  0.0000,
       >  0.0339,  0.0278,  0.0177,  0.0065,  0.0000,  0.0000,  0.0000,
       >  0.0091,  0.0142,  0.0123,  0.0092,  0.0036,  0.0000,  0.0000,
       >  0.0026,  0.0037,  0.0064,  0.0017,  0.0037,  0.0000,  0.0000,
       >  0.0000,  0.0000,  0.0011,  0.0000,  0.0072,  0.0071,  0.0000,
       >  0.0214,  0.0000,  0.0000,  0.0000,  0.0000,  0.0000,  0.0000,
       >  0.0000,  0.0044,  0.0020,  0.0000,  0.0000,  0.0000,  0.0000/
 
    PROB C    E
          DATA ((PROBA(2,2,1,5,I,J),I=1,NP),J=1,NPT) /
       >  0.1948,  0.2732,  0.3380,  0.4018,  0.4748,  0.2718,  0.2747,
       >  0.2502,  0.3171,  0.3575,  0.3566,  0.3656,  0.3185,  0.1868,
       >  0.1091,  0.2291,  0.3199,  0.3654,  0.3483,  0.1981,  0.2205,
       >  0.0527,  0.0943,  0.1493,  0.2043,  0.2990,  0.2392,  0.2222,
       >  0.0277,  0.0437,  0.0784,  0.1109,  0.1720,  0.1161,  0.1180,
       >  0.0470,  0.0257,  0.0347,  0.0477,  0.0955,  0.1302,  0.1265,
       >  0.0248,  0.0117,  0.0204,  0.0181,  0.0253,  0.0697,  0.0637,
       >  0.0139,  0.0217,  0.0117,  0.0148,  0.0090,  0.0159,  0.0186/
 
    PROB X  U E
          DATA ((PROBA(2,2,1,6,I,J),I=1,NP),J=1,NPT) /
       >  0.4069,  0.3705,  0.3413,  0.2479,  0.1286,  0.4052,  0.1903,
       >  0.2153,  0.2426,  0.2443,  0.2754,  0.1879,  0.1933,  0.1321,
       >  0.1005,  0.1089,  0.1023,  0.0998,  0.1130,  0.1953,  0.1610,
       >  0.0402,  0.0410,  0.0301,  0.0546,  0.0531,  0.0755,  0.1603,
       >  0.0369,  0.0139,  0.0129,  0.0308,  0.0387,  0.0615,  0.0696,
       >  0.0318,  0.0117,  0.0051,  0.0108,  0.0108,  0.0208,  0.0861,
       >  0.0492,  0.0143,  0.0098,  0.0000,  0.0170,  0.0084,  0.0324,
       >  0.0347,  0.0381,  0.0026,  0.0015,  0.0086,  0.0137,  0.0194/
 
    PROB X  C
          DATA ((PROBA(2,2,1,7,I,J),I=1,NP),J=1,NPT) /
       >  0.1007,  0.0772,  0.0554,  0.0425,  0.0000,  0.0315,  0.1759,
       >  0.0548,  0.0478,  0.0448,  0.0252,  0.0167,  0.0100,  0.0000,
       >  0.0227,  0.0194,  0.0240,  0.0258,  0.0099,  0.0153,  0.0000,
       >  0.0109,  0.0091,  0.0092,  0.0152,  0.0123,  0.0118,  0.0000,
       >  0.0014,  0.0062,  0.0038,  0.0092,  0.0097,  0.0137,  0.0094,
       >  0.0077,  0.0000,  0.0000,  0.0037,  0.0000,  0.0000,  0.0085,
       >  0.0113,  0.0036,  0.0000,  0.0000,  0.0044,  0.0000,  0.0060,
       >  0.0106,  0.0000,  0.0000,  0.0000,  0.0015,  0.0000,  0.0064/
 
    PROB X  B E
          DATA ((PROBA(2,2,1,8,I,J),I=1,NP),J=1,NPT) /
       >  0.0955,  0.0531,  0.0287,  0.0100,  0.0126,  0.0000,  0.0000,
       >  0.0844,  0.0443,  0.0286,  0.0216,  0.0218,  0.0201,  0.0000,
       >  0.0455,  0.0455,  0.0187,  0.0191,  0.0066,  0.0000,  0.0000,
       >  0.0200,  0.0252,  0.0158,  0.0105,  0.0098,  0.0000,  0.0000,
       >  0.0088,  0.0165,  0.0087,  0.0123,  0.0033,  0.0056,  0.0000,
       >  0.0189,  0.0078,  0.0051,  0.0172,  0.0039,  0.0068,  0.0079,
       >  0.0357,  0.0064,  0.0068,  0.0128,  0.0000,  0.0071,  0.0130,
       >  0.0306,  0.0094,  0.0058,  0.0078,  0.0000,  0.0020,  0.0042/
 
 
    PROB B  M
          DATA ((PROBA(2,2,2,1,I,J),I=1,NP),J=1,NPT) /
       >  0.0229,  0.0376,  0.0932,  0.1210,  0.1560,  0.2546,  0.3817,
       >  0.0600,  0.0777,  0.1079,  0.1687,  0.2304,  0.3496,  0.3585,
       >  0.2337,  0.2159,  0.2110,  0.2837,  0.3386,  0.3907,  0.4343,
       >  0.5415,  0.4994,  0.4700,  0.4432,  0.4476,  0.5199,  0.4757,
       >  0.7009,  0.6999,  0.6653,  0.6412,  0.6667,  0.6105,  0.5988,
       >  0.6619,  0.8052,  0.7921,  0.7585,  0.7646,  0.7778,  0.6648,
       >  0.7030,  0.8219,  0.8800,  0.8552,  0.8423,  0.8327,  0.7527,
       >  0.7182,  0.8216,  0.8982,  0.8921,  0.9042,  0.9010,  0.8529/
 
    PROB B  T M
          DATA ((PROBA(2,2,2,2,I,J),I=1,NP),J=1,NPT) /
       >  0.0088,  0.0072,  0.0075,  0.0063,  0.0091,  0.0000,  0.0000,
       >  0.0158,  0.0165,  0.0121,  0.0122,  0.0024,  0.0000,  0.0094,
       >  0.0300,  0.0283,  0.0214,  0.0175,  0.0054,  0.0000,  0.0000,
       >  0.0238,  0.0244,  0.0238,  0.0221,  0.0079,  0.0000,  0.0000,
       >  0.0192,  0.0257,  0.0268,  0.0070,  0.0056,  0.0139,  0.0000,
       >  0.0060,  0.0144,  0.0288,  0.0198,  0.0091,  0.0085,  0.0000,
       >  0.0000,  0.0100,  0.0184,  0.0113,  0.0090,  0.0111,  0.0000,
       >  0.0066,  0.0179,  0.0098,  0.0126,  0.0087,  0.0045,  0.0028/
 
    PROB B  C
          DATA ((PROBA(2,2,2,3,I,J),I=1,NP),J=1,NPT) /
       >  0.1047,  0.1011,  0.0784,  0.0593,  0.0450,  0.0641,  0.0000,
       >  0.1442,  0.1187,  0.0956,  0.0609,  0.0289,  0.0092,  0.0127,
       >  0.1717,  0.1618,  0.1141,  0.0739,  0.0379,  0.0226,  0.0039,
       >  0.1024,  0.1501,  0.1121,  0.0774,  0.0615,  0.0304,  0.0369,
       >  0.0391,  0.0912,  0.0957,  0.0911,  0.0524,  0.0358,  0.0194,
       >  0.0522,  0.0634,  0.0710,  0.0626,  0.0398,  0.0231,  0.0337,
       >  0.0469,  0.0337,  0.0424,  0.0509,  0.0450,  0.0175,  0.0142,
       >  0.0143,  0.0378,  0.0310,  0.0373,  0.0326,  0.0413,  0.0304/
 
    PROB B WC M
          DATA ((PROBA(2,2,2,4,I,J),I=1,NP),J=1,NPT) /
       >  0.0223,  0.0231,  0.0128,  0.0050,  0.0068,  0.0000,  0.0000,
       >  0.0323,  0.0261,  0.0143,  0.0060,  0.0020,  0.0000,  0.0083,
       >  0.0265,  0.0235,  0.0185,  0.0140,  0.0079,  0.0039,  0.0000,
       >  0.0080,  0.0150,  0.0129,  0.0083,  0.0060,  0.0046,  0.0000,
       >  0.0034,  0.0060,  0.0046,  0.0052,  0.0043,  0.0000,  0.0000,
       >  0.0000,  0.0027,  0.0044,  0.0015,  0.0000,  0.0000,  0.0000,
       >  0.0000,  0.0041,  0.0000,  0.0032,  0.0025,  0.0000,  0.0000,
       >  0.0000,  0.0000,  0.0012,  0.0000,  0.0000,  0.0000,  0.0000/
 
    PROB C   M
          DATA ((PROBA(2,2,2,5,I,J),I=1,NP),J=1,NPT) /
       >  0.1694,  0.2515,  0.2905,  0.3404,  0.3673,  0.2415,  0.2275,
       >  0.1784,  0.2743,  0.3230,  0.3288,  0.3104,  0.2396,  0.1117,
       >  0.0914,  0.1949,  0.3090,  0.3255,  0.3090,  0.2679,  0.2009,
       >  0.0465,  0.0901,  0.1798,  0.2140,  0.2587,  0.2401,  0.1876,
       >  0.0261,  0.0379,  0.0752,  0.1488,  0.1420,  0.1533,  0.1633,
       >  0.0254,  0.0177,  0.0314,  0.0578,  0.0652,  0.0881,  0.1139,
       >  0.0268,  0.0300,  0.0180,  0.0203,  0.0387,  0.0489,  0.0809,
       >  0.0384,  0.0218,  0.0154,  0.0226,  0.0290,  0.0183,  0.0332/
 
    PROB X  U M
          DATA ((PROBA(2,2,2,6,I,J),I=1,NP),J=1,NPT) /
       >  0.3891,  0.3531,  0.3479,  0.3362,  0.3358,  0.2878,  0.3367,
       >  0.3168,  0.2894,  0.3011,  0.3050,  0.3245,  0.3287,  0.3945,
       >  0.2459,  0.1907,  0.1882,  0.1851,  0.2094,  0.2416,  0.2881,
       >  0.1398,  0.1142,  0.1027,  0.1340,  0.1360,  0.1411,  0.2324,
       >  0.1208,  0.0705,  0.0633,  0.0553,  0.0736,  0.1519,  0.1819,
       >  0.1497,  0.0353,  0.0315,  0.0526,  0.0832,  0.0731,  0.1333,
       >  0.1363,  0.0557,  0.0134,  0.0227,  0.0351,  0.0603,  0.1110,
       >  0.1647,  0.0574,  0.0273,  0.0200,  0.0180,  0.0187,  0.0661/
 
    PROB X  C
          DATA ((PROBA(2,2,2,7,I,J),I=1,NP),J=1,NPT) /
       >  0.1244,  0.1270,  0.1057,  0.0964,  0.0500,  0.0930,  0.0365,
       >  0.0990,  0.0951,  0.0949,  0.0832,  0.0685,  0.0552,  0.0806,
       >  0.0678,  0.0737,  0.0673,  0.0675,  0.0662,  0.0683,  0.0575,
       >  0.0471,  0.0297,  0.0354,  0.0531,  0.0534,  0.0433,  0.0373,
       >  0.0351,  0.0145,  0.0211,  0.0202,  0.0352,  0.0196,  0.0170,
       >  0.0508,  0.0235,  0.0117,  0.0103,  0.0136,  0.0183,  0.0405,
       >  0.0257,  0.0145,  0.0027,  0.0097,  0.0100,  0.0168,  0.0287,
       >  0.0317,  0.0209,  0.0037,  0.0027,  0.0019,  0.0087,  0.0095/
 
    PROB X  B  M
          DATA ((PROBA(2,2,2,8,I,J),I=1,NP),J=1,NPT) /
       >  0.1580,  0.0983,  0.0632,  0.0345,  0.0302,  0.0581,  0.0182,
       >  0.1535,  0.1016,  0.0501,  0.0345,  0.0327,  0.0177,  0.0239,
       >  0.1333,  0.1109,  0.0702,  0.0321,  0.0248,  0.0041,  0.0150,
       >  0.0910,  0.0774,  0.0633,  0.0475,  0.0282,  0.0201,  0.0302,
       >  0.0554,  0.0546,  0.0479,  0.0312,  0.0196,  0.0153,  0.0202,
       >  0.0537,  0.0375,  0.0291,  0.0372,  0.0246,  0.0111,  0.0135,
       >  0.0617,  0.0303,  0.0252,  0.0268,  0.0174,  0.0127,  0.0122,
       >  0.0261,  0.0224,  0.0135,  0.0129,  0.0057,  0.0073,  0.0053/
 
 
                    PROBA 90  ALTARELLI
 
    PROB B  E
          DATA ((PROBA(1,1,1,1,I,J),I=1,NP),J=1,NPT) /
       >  0.0477,  0.0606,  0.1115,  0.1600,  0.2873,  0.3881,  0.3041,
       >  0.1196,  0.1041,  0.1681,  0.2298,  0.2922,  0.4404,  0.7252,
       >  0.3809,  0.3080,  0.2844,  0.3492,  0.4012,  0.6011,  0.6151,
       >  0.7091,  0.6123,  0.5780,  0.5291,  0.5009,  0.6837,  0.6920,
       >  0.8332,  0.8275,  0.7545,  0.6854,  0.7374,  0.7598,  0.8015,
       >  0.8586,  0.9038,  0.8771,  0.8246,  0.8306,  0.8779,  0.8617,
       >  0.8588,  0.9195,  0.9293,  0.8890,  0.8667,  0.9015,  0.8409,
       >  0.8258,  0.9035,  0.8962,  0.9181,  0.9053,  0.9505,  0.9008/
 
    PROB B  T E
          DATA ((PROBA(1,1,1,2,I,J),I=1,NP),J=1,NPT) /
       >  0.0116,  0.0093,  0.0059,  0.0224,  0.0000,  0.0000,  0.0000,
       >  0.0159,  0.0159,  0.0138,  0.0232,  0.0000,  0.0000,  0.0000,
       >  0.0431,  0.0212,  0.0219,  0.0084,  0.0084,  0.0000,  0.0000,
       >  0.0212,  0.0257,  0.0281,  0.0180,  0.0000,  0.0000,  0.0559,
       >  0.0107,  0.0275,  0.0354,  0.0298,  0.0295,  0.0000,  0.0000,
       >  0.0175,  0.0028,  0.0162,  0.0116,  0.0240,  0.0144,  0.0000,
       >  0.0000,  0.0078,  0.0143,  0.0054,  0.0073,  0.0000,  0.0000,
       >  0.0389,  0.0274,  0.0171,  0.0107,  0.0079,  0.0000,  0.0366/
 
    PROB B  C
          DATA ((PROBA(1,1,1,3,I,J),I=1,NP),J=1,NPT) /
       >  0.1513,  0.1240,  0.0805,  0.0616,  0.0465,  0.0000,  0.0000,
       >  0.2444,  0.1710,  0.0868,  0.0867,  0.0452,  0.0573,  0.0308,
       >  0.2677,  0.2310,  0.1203,  0.0903,  0.0416,  0.0681,  0.0409,
       >  0.1380,  0.1966,  0.1713,  0.1061,  0.0750,  0.0393,  0.0197,
       >  0.0692,  0.0926,  0.0987,  0.0697,  0.0492,  0.0398,  0.0227,
       >  0.0430,  0.0571,  0.0532,  0.0601,  0.0490,  0.0190,  0.0159,
       >  0.1109,  0.0310,  0.0404,  0.0688,  0.0523,  0.0522,  0.0283,
       >  0.0431,  0.0141,  0.0444,  0.0592,  0.0366,  0.0330,  0.0130/
 
    PROB B WC E
          DATA ((PROBA(1,1,1,4,I,J),I=1,NP),J=1,NPT) /
       >  0.0228,  0.0143,  0.0178,  0.0000,  0.0000,  0.0000,  0.0000,
       >  0.0413,  0.0252,  0.0181,  0.0000,  0.0000,  0.0000,  0.0000,
       >  0.0292,  0.0359,  0.0139,  0.0113,  0.0069,  0.0000,  0.0000,
       >  0.0051,  0.0132,  0.0114,  0.0108,  0.0000,  0.0125,  0.0000,
       >  0.0027,  0.0014,  0.0086,  0.0068,  0.0000,  0.0000,  0.0000,
       >  0.0062,  0.0000,  0.0028,  0.0071,  0.0000,  0.0000,  0.0000,
       >  0.0000,  0.0000,  0.0000,  0.0000,  0.0000,  0.0000,  0.0000,
       >  0.0000,  0.0136,  0.0000,  0.0000,  0.0031,  0.0000,  0.0000/
 
    PROB C    E
          DATA ((PROBA(1,1,1,5,I,J),I=1,NP),J=1,NPT) /
       >  0.2337,  0.2732,  0.2670,  0.3209,  0.2368,  0.2229,  0.1990,
       >  0.2740,  0.3330,  0.3864,  0.3078,  0.3524,  0.3156,  0.1453,
       >  0.1375,  0.2444,  0.3212,  0.3301,  0.2695,  0.1531,  0.1977,
       >  0.0590,  0.0979,  0.1525,  0.2278,  0.2023,  0.2331,  0.1029,
       >  0.0437,  0.0372,  0.0625,  0.0925,  0.1305,  0.1646,  0.0715,
       >  0.0497,  0.0129,  0.0271,  0.0613,  0.0460,  0.0640,  0.0808,
       >  0.0303,  0.0052,  0.0125,  0.0198,  0.0459,  0.0463,  0.0563,
       >  0.0000,  0.0112,  0.0160,  0.0022,  0.0141,  0.0165,  0.0093/
 
    PROB X  U E
          DATA ((PROBA(1,1,1,6,I,J),I=1,NP),J=1,NPT) /
       >  0.3473,  0.3991,  0.4139,  0.3588,  0.3724,  0.3902,  0.4985,
       >  0.1773,  0.2323,  0.2572,  0.3126,  0.2241,  0.1873,  0.0648,
       >  0.0788,  0.0959,  0.1919,  0.1813,  0.2376,  0.1643,  0.1280,
       >  0.0397,  0.0270,  0.0336,  0.0780,  0.1786,  0.0000,  0.1300,
       >  0.0318,  0.0089,  0.0184,  0.0949,  0.0536,  0.0000,  0.0705,
       >  0.0122,  0.0164,  0.0058,  0.0181,  0.0323,  0.0247,  0.0000,
       >  0.0000,  0.0235,  0.0000,  0.0171,  0.0214,  0.0000,  0.0747,
       >  0.0592,  0.0000,  0.0230,  0.0074,  0.0176,  0.0000,  0.0311/
 
    PROB X  C
          DATA ((PROBA(1,1,1,7,I,J),I=1,NP),J=1,NPT) /
       >  0.1033,  0.0743,  0.0761,  0.0693,  0.0318,  0.0000,  0.0000,
       >  0.0518,  0.0694,  0.0418,  0.0329,  0.0664,  0.0000,  0.0357,
       >  0.0202,  0.0273,  0.0253,  0.0128,  0.0185,  0.0000,  0.0195,
       >  0.0110,  0.0046,  0.0120,  0.0123,  0.0095,  0.0113,  0.0000,
       >  0.0000,  0.0015,  0.0000,  0.0081,  0.0000,  0.0000,  0.0174,
       >  0.0000,  0.0052,  0.0067,  0.0000,  0.0065,  0.0000,  0.0000,
       >  0.0000,  0.0000,  0.0036,  0.0000,  0.0000,  0.0000,  0.0000,
       >  0.0171,  0.0074,  0.0000,  0.0000,  0.0000,  0.0000,  0.0028/
 
    PROB X  B E
          DATA ((PROBA(1,1,1,8,I,J),I=1,NP),J=1,NPT) /
       >  0.0840,  0.0475,  0.0306,  0.0107,  0.0266,  0.0000,  0.0000,
       >  0.0750,  0.0506,  0.0291,  0.0091,  0.0224,  0.0000,  0.0000,
       >  0.0418,  0.0361,  0.0218,  0.0170,  0.0171,  0.0133,  0.0000,
       >  0.0168,  0.0220,  0.0130,  0.0178,  0.0330,  0.0197,  0.0000,
       >  0.0084,  0.0034,  0.0211,  0.0129,  0.0000,  0.0342,  0.0167,
       >  0.0130,  0.0020,  0.0112,  0.0165,  0.0113,  0.0000,  0.0397,
       >  0.0000,  0.0124,  0.0000,  0.0000,  0.0062,  0.0000,  0.0000,
       >  0.0161,  0.0220,  0.0032,  0.0025,  0.0147,  0.0000,  0.0063/
 
 
    PROB B  M
          DATA ((PROBA(1,1,2,1,I,J),I=1,NP),J=1,NPT) /
       >  0.0115,  0.0314,  0.0659,  0.1080,  0.2621,  0.1642,  0.5055,
       >  0.0446,  0.0559,  0.0984,  0.1703,  0.2270,  0.3129,  0.2927,
       >  0.2050,  0.1753,  0.1796,  0.2316,  0.3598,  0.3173,  0.5504,
       >  0.5237,  0.4201,  0.4064,  0.4210,  0.4431,  0.4014,  0.5354,
       >  0.6698,  0.6882,  0.6173,  0.6245,  0.6169,  0.6067,  0.6378,
       >  0.7266,  0.8157,  0.7860,  0.7278,  0.7070,  0.6951,  0.7512,
       >  0.6907,  0.8509,  0.8604,  0.8428,  0.8350,  0.8284,  0.6976,
       >  0.8128,  0.8191,  0.8949,  0.8991,  0.9313,  0.9393,  0.8888/
 
    PROB B  T M
          DATA ((PROBA(1,1,2,2,I,J),I=1,NP),J=1,NPT) /
       >  0.0066,  0.0057,  0.0078,  0.0070,  0.0000,  0.0000,  0.0000,
       >  0.0148,  0.0143,  0.0104,  0.0091,  0.0000,  0.0000,  0.0000,
       >  0.0267,  0.0263,  0.0222,  0.0162,  0.0107,  0.0217,  0.0000,
       >  0.0247,  0.0335,  0.0233,  0.0167,  0.0112,  0.0108,  0.0125,
       >  0.0204,  0.0342,  0.0219,  0.0100,  0.0133,  0.0000,  0.0000,
       >  0.0150,  0.0092,  0.0228,  0.0084,  0.0076,  0.0479,  0.0000,
       >  0.0200,  0.0000,  0.0146,  0.0140,  0.0229,  0.0000,  0.0138,
       >  0.0000,  0.0137,  0.0100,  0.0343,  0.0078,  0.0068,  0.0000/
 
    PROB B  C
          DATA ((PROBA(1,1,2,3,I,J),I=1,NP),J=1,NPT) /
       >  0.1325,  0.1263,  0.0707,  0.0860,  0.0568,  0.0330,  0.0000,
       >  0.1696,  0.1450,  0.1032,  0.0857,  0.0362,  0.0241,  0.0283,
       >  0.2094,  0.1953,  0.1400,  0.0828,  0.0632,  0.0453,  0.0115,
       >  0.1309,  0.1779,  0.1576,  0.0763,  0.0733,  0.0302,  0.0081,
       >  0.0670,  0.0953,  0.1460,  0.1164,  0.0358,  0.0516,  0.0153,
       >  0.0522,  0.0561,  0.0667,  0.0980,  0.0850,  0.0170,  0.0172,
       >  0.0124,  0.0642,  0.0368,  0.0667,  0.0509,  0.0169,  0.0084,
       >  0.0125,  0.0237,  0.0263,  0.0330,  0.0283,  0.0275,  0.0200/
 
    PROB B WC M
          DATA ((PROBA(1,1,2,4,I,J),I=1,NP),J=1,NPT) /
       >  0.0217,  0.0200,  0.0135,  0.0050,  0.0000,  0.0000,  0.0000,
       >  0.0279,  0.0227,  0.0100,  0.0069,  0.0000,  0.0000,  0.0000,
       >  0.0277,  0.0236,  0.0163,  0.0037,  0.0079,  0.0000,  0.0000,
       >  0.0085,  0.0160,  0.0119,  0.0127,  0.0039,  0.0000,  0.0000,
       >  0.0037,  0.0043,  0.0064,  0.0076,  0.0047,  0.0000,  0.0000,
       >  0.0000,  0.0017,  0.0020,  0.0000,  0.0000,  0.0000,  0.0000,
       >  0.0000,  0.0043,  0.0000,  0.0069,  0.0000,  0.0000,  0.0000,
       >  0.0000,  0.0000,  0.0000,  0.0000,  0.0000,  0.0000,  0.0000/
 
    PROB C   M
          DATA ((PROBA(1,1,2,5,I,J),I=1,NP),J=1,NPT) /
       >  0.1905,  0.2371,  0.2931,  0.3509,  0.2610,  0.2134,  0.0943,
       >  0.1915,  0.2708,  0.3271,  0.3335,  0.3211,  0.1560,  0.1388,
       >  0.0995,  0.2033,  0.2866,  0.3348,  0.2465,  0.2478,  0.1276,
       >  0.0459,  0.0967,  0.1368,  0.2382,  0.1834,  0.2280,  0.1077,
       >  0.0259,  0.0447,  0.0524,  0.0917,  0.1326,  0.1459,  0.1019,
       >  0.0144,  0.0336,  0.0345,  0.0612,  0.0705,  0.0854,  0.0477,
       >  0.0207,  0.0038,  0.0218,  0.0241,  0.0461,  0.0893,  0.0474,
       >  0.0242,  0.0147,  0.0045,  0.0067,  0.0104,  0.0079,  0.0223/
 
    PROB X  U M
          DATA ((PROBA(1,1,2,6,I,J),I=1,NP),J=1,NPT) /
       >  0.3623,  0.3530,  0.3571,  0.3412,  0.2816,  0.5913,  0.3586,
       >  0.3004,  0.2937,  0.2929,  0.2816,  0.3267,  0.4545,  0.4252,
       >  0.2265,  0.1952,  0.1989,  0.2116,  0.2122,  0.2748,  0.2539,
       >  0.1427,  0.1292,  0.1206,  0.1360,  0.2028,  0.2502,  0.2618,
       >  0.1423,  0.0606,  0.0755,  0.0826,  0.1457,  0.1278,  0.2111,
       >  0.1216,  0.0431,  0.0362,  0.0401,  0.0816,  0.1145,  0.1179,
       >  0.2017,  0.0363,  0.0236,  0.0157,  0.0000,  0.0193,  0.1841,
       >  0.0834,  0.0543,  0.0333,  0.0144,  0.0163,  0.0108,  0.0530/
 
    PROB X  C
          DATA ((PROBA(1,1,2,7,I,J),I=1,NP),J=1,NPT) /
       >  0.1388,  0.1399,  0.1218,  0.0592,  0.1116,  0.0000,  0.0449,
       >  0.0959,  0.1059,  0.0978,  0.0904,  0.0761,  0.0565,  0.0884,
       >  0.0806,  0.0721,  0.0776,  0.0869,  0.0761,  0.0895,  0.0601,
       >  0.0478,  0.0390,  0.0591,  0.0651,  0.0519,  0.0640,  0.0689,
       >  0.0269,  0.0146,  0.0246,  0.0203,  0.0196,  0.0382,  0.0276,
       >  0.0298,  0.0093,  0.0156,  0.0214,  0.0066,  0.0100,  0.0379,
       >  0.0281,  0.0229,  0.0088,  0.0037,  0.0131,  0.0289,  0.0425,
       >  0.0147,  0.0118,  0.0072,  0.0000,  0.0019,  0.0025,  0.0055/
 
    PROB X  B  M
          DATA ((PROBA(1,1,2,8,I,J),I=1,NP),J=1,NPT) /
       >  0.1371,  0.0898,  0.0731,  0.0444,  0.0314,  0.0000,  0.0000,
       >  0.1532,  0.0931,  0.0626,  0.0263,  0.0166,  0.0000,  0.0305,
       >  0.1229,  0.1077,  0.0792,  0.0353,  0.0266,  0.0082,  0.0000,
       >  0.0749,  0.0857,  0.0833,  0.0357,  0.0318,  0.0180,  0.0093,
       >  0.0436,  0.0563,  0.0546,  0.0459,  0.0314,  0.0305,  0.0079,
       >  0.0402,  0.0305,  0.0354,  0.0422,  0.0403,  0.0295,  0.0288,
       >  0.0270,  0.0179,  0.0330,  0.0251,  0.0311,  0.0178,  0.0083,
       >  0.0509,  0.0611,  0.0231,  0.0119,  0.0040,  0.0050,  0.0104/
 
 
                    PROBA 90  GISW
    PROB B  E
          DATA ((PROBA(1,2,1,1,I,J),I=1,NP),J=1,NPT) /
       >  0.0597,  0.0716,  0.1260,  0.1737,  0.3195,  0.3827,  0.3137,
       >  0.1483,  0.1245,  0.1917,  0.2492,  0.3016,  0.4487,  0.7177,
       >  0.4315,  0.3509,  0.3094,  0.3716,  0.4139,  0.6040,  0.6168,
       >  0.7316,  0.6545,  0.6203,  0.5573,  0.5083,  0.6957,  0.6784,
       >  0.8369,  0.8430,  0.7757,  0.7038,  0.7487,  0.7580,  0.7903,
       >  0.8583,  0.9072,  0.8853,  0.8320,  0.8358,  0.8770,  0.8569,
       >  0.8600,  0.9180,  0.9315,  0.8940,  0.8694,  0.9013,  0.8426,
       >  0.8233,  0.9021,  0.8934,  0.9187,  0.9024,  0.9491,  0.9023/
 
    PROB B  T E
          DATA ((PROBA(1,2,1,2,I,J),I=1,NP),J=1,NPT) /
       >  0.0121,  0.0103,  0.0049,  0.0228,  0.0000,  0.0000,  0.0000,
       >  0.0174,  0.0171,  0.0144,  0.0219,  0.0000,  0.0000,  0.0000,
       >  0.0449,  0.0214,  0.0221,  0.0078,  0.0086,  0.0000,  0.0000,
       >  0.0220,  0.0267,  0.0267,  0.0196,  0.0000,  0.0000,  0.0505,
       >  0.0113,  0.0259,  0.0337,  0.0274,  0.0261,  0.0000,  0.0000,
       >  0.0161,  0.0029,  0.0153,  0.0125,  0.0224,  0.0158,  0.0000,
       >  0.0000,  0.0065,  0.0144,  0.0057,  0.0078,  0.0000,  0.0000,
       >  0.0424,  0.0256,  0.0176,  0.0100,  0.0080,  0.0000,  0.0315/
 
    PROB B  C
          DATA ((PROBA(1,2,1,3,I,J),I=1,NP),J=1,NPT) /
       >  0.1341,  0.1106,  0.0711,  0.0554,  0.0431,  0.0000,  0.0000,
       >  0.2154,  0.1523,  0.0764,  0.0764,  0.0389,  0.0530,  0.0300,
       >  0.2268,  0.1990,  0.1059,  0.0791,  0.0367,  0.0631,  0.0421,
       >  0.1176,  0.1642,  0.1455,  0.0930,  0.0673,  0.0396,  0.0220,
       >  0.0630,  0.0807,  0.0846,  0.0607,  0.0478,  0.0371,  0.0247,
       >  0.0417,  0.0539,  0.0468,  0.0540,  0.0447,  0.0179,  0.0181,
       >  0.1087,  0.0290,  0.0379,  0.0640,  0.0489,  0.0528,  0.0293,
       >  0.0422,  0.0143,  0.0455,  0.0597,  0.0386,  0.0346,  0.0151/
 
    PROB B WC E
          DATA ((PROBA(1,2,1,4,I,J),I=1,NP),J=1,NPT) /
       >  0.0235,  0.0149,  0.0183,  0.0000,  0.0000,  0.0000,  0.0000,
       >  0.0425,  0.0261,  0.0185,  0.0000,  0.0000,  0.0000,  0.0000,
       >  0.0288,  0.0361,  0.0141,  0.0115,  0.0071,  0.0000,  0.0000,
       >  0.0050,  0.0128,  0.0112,  0.0110,  0.0000,  0.0132,  0.0000,
       >  0.0028,  0.0014,  0.0085,  0.0068,  0.0000,  0.0000,  0.0000,
       >  0.0066,  0.0000,  0.0028,  0.0073,  0.0000,  0.0000,  0.0000,
       >  0.0000,  0.0000,  0.0000,  0.0000,  0.0000,  0.0000,  0.0000,
       >  0.0000,  0.0149,  0.0000,  0.0000,  0.0035,  0.0000,  0.0000/
 
    PROB C    E
          DATA ((PROBA(1,2,1,5,I,J),I=1,NP),J=1,NPT) /
       >  0.2316,  0.2697,  0.2617,  0.3135,  0.2229,  0.2214,  0.1923,
       >  0.2700,  0.3276,  0.3749,  0.3003,  0.3469,  0.3101,  0.1488,
       >  0.1305,  0.2358,  0.3119,  0.3206,  0.2622,  0.1521,  0.1941,
       >  0.0573,  0.0907,  0.1408,  0.2149,  0.1999,  0.2210,  0.1085,
       >  0.0442,  0.0357,  0.0586,  0.0881,  0.1251,  0.1675,  0.0739,
       >  0.0526,  0.0130,  0.0266,  0.0591,  0.0457,  0.0640,  0.0816,
       >  0.0313,  0.0057,  0.0126,  0.0192,  0.0455,  0.0460,  0.0541,
       >  0.0000,  0.0114,  0.0162,  0.0022,  0.0140,  0.0163,  0.0094/
 
    PROB X  U E
          DATA ((PROBA(1,2,1,6,I,J),I=1,NP),J=1,NPT) /
       >  0.3511,  0.4022,  0.4142,  0.3581,  0.3592,  0.3968,  0.4952,
       >  0.1781,  0.2332,  0.2548,  0.3120,  0.2257,  0.1887,  0.0679,
       >  0.0766,  0.0942,  0.1904,  0.1801,  0.2366,  0.1671,  0.1286,
       >  0.0389,  0.0253,  0.0317,  0.0752,  0.1807,  0.0000,  0.1409,
       >  0.0329,  0.0084,  0.0177,  0.0926,  0.0525,  0.0000,  0.0749,
       >  0.0131,  0.0158,  0.0058,  0.0179,  0.0331,  0.0254,  0.0000,
       >  0.0000,  0.0270,  0.0000,  0.0171,  0.0218,  0.0000,  0.0741,
       >  0.0584,  0.0000,  0.0240,  0.0076,  0.0180,  0.0000,  0.0323/
 
    PROB X  C
          DATA ((PROBA(1,2,1,7,I,J),I=1,NP),J=1,NPT) /
       >  0.1023,  0.0734,  0.0747,  0.0679,  0.0301,  0.0000,  0.0000,
       >  0.0510,  0.0683,  0.0406,  0.0322,  0.0656,  0.0000,  0.0367,
       >  0.0192,  0.0264,  0.0246,  0.0125,  0.0181,  0.0000,  0.0192,
       >  0.0107,  0.0043,  0.0111,  0.0116,  0.0095,  0.0107,  0.0000,
       >  0.0000,  0.0015,  0.0000,  0.0077,  0.0000,  0.0000,  0.0181,
       >  0.0000,  0.0052,  0.0066,  0.0000,  0.0065,  0.0000,  0.0000,
       >  0.0000,  0.0000,  0.0037,  0.0000,  0.0000,  0.0000,  0.0000,
       >  0.0171,  0.0077,  0.0000,  0.0000,  0.0000,  0.0000,  0.0029/
 
    PROB X  B E
          DATA ((PROBA(1,2,1,8,I,J),I=1,NP),J=1,NPT) /
       >  0.0866,  0.0488,  0.0312,  0.0109,  0.0261,  0.0000,  0.0000,
       >  0.0768,  0.0518,  0.0294,  0.0092,  0.0230,  0.0000,  0.0000,
       >  0.0413,  0.0362,  0.0221,  0.0172,  0.0174,  0.0137,  0.0000,
       >  0.0170,  0.0212,  0.0125,  0.0175,  0.0341,  0.0195,  0.0000,
       >  0.0088,  0.0034,  0.0206,  0.0129,  0.0000,  0.0365,  0.0181,
       >  0.0116,  0.0021,  0.0108,  0.0167,  0.0118,  0.0000,  0.0423,
       >  0.0000,  0.0135,  0.0000,  0.0000,  0.0065,  0.0000,  0.0000,
       >  0.0168,  0.0236,  0.0034,  0.0018,  0.0153,  0.0000,  0.0066/
 
 
    PROB B  M
          DATA ((PROBA(1,2,2,1,I,J),I=1,NP),J=1,NPT) /
       >  0.0150,  0.0411,  0.0775,  0.1226,  0.2904,  0.1590,  0.5263,
       >  0.0586,  0.0685,  0.1150,  0.1897,  0.2308,  0.3078,  0.2864,
       >  0.2432,  0.2096,  0.2088,  0.2563,  0.3709,  0.3190,  0.5439,
       >  0.5467,  0.4633,  0.4473,  0.4493,  0.4561,  0.4187,  0.5136,
       >  0.6708,  0.7079,  0.6478,  0.6526,  0.6334,  0.6123,  0.6271,
       >  0.7183,  0.8178,  0.7953,  0.7435,  0.7134,  0.7065,  0.7442,
       >  0.6829,  0.8469,  0.8617,  0.8487,  0.8413,  0.8287,  0.6941,
       >  0.8155,  0.8201,  0.8923,  0.9034,  0.9309,  0.9386,  0.8853/
 
    PROB B  T M
          DATA ((PROBA(1,2,2,2,I,J),I=1,NP),J=1,NPT) /
       >  0.0071,  0.0055,  0.0080,  0.0073,  0.0000,  0.0000,  0.0000,
       >  0.0163,  0.0153,  0.0108,  0.0084,  0.0000,  0.0000,  0.0000,
       >  0.0287,  0.0275,  0.0220,  0.0160,  0.0098,  0.0201,  0.0000,
       >  0.0248,  0.0330,  0.0231,  0.0152,  0.0100,  0.0085,  0.0135,
       >  0.0211,  0.0332,  0.0211,  0.0086,  0.0117,  0.0000,  0.0000,
       >  0.0142,  0.0081,  0.0225,  0.0083,  0.0074,  0.0419,  0.0000,
       >  0.0226,  0.0000,  0.0149,  0.0128,  0.0204,  0.0000,  0.0118,
       >  0.0000,  0.0131,  0.0109,  0.0293,  0.0074,  0.0058,  0.0000/
 
    PROB B  C
          DATA ((PROBA(1,2,2,3,I,J),I=1,NP),J=1,NPT) /
       >  0.1180,  0.1128,  0.0623,  0.0775,  0.0531,  0.0295,  0.0000,
       >  0.1502,  0.1293,  0.0916,  0.0755,  0.0326,  0.0224,  0.0289,
       >  0.1800,  0.1693,  0.1221,  0.0725,  0.0572,  0.0404,  0.0111,
       >  0.1115,  0.1508,  0.1359,  0.0674,  0.0653,  0.0289,  0.0087,
       >  0.0601,  0.0820,  0.1251,  0.1004,  0.0322,  0.0477,  0.0150,
       >  0.0483,  0.0515,  0.0598,  0.0873,  0.0783,  0.0155,  0.0167,
       >  0.0110,  0.0615,  0.0340,  0.0632,  0.0475,  0.0157,  0.0082,
       >  0.0117,  0.0242,  0.0265,  0.0324,  0.0288,  0.0288,  0.0223/
 
    PROB B WC M
          DATA ((PROBA(1,2,2,4,I,J),I=1,NP),J=1,NPT) /
       >  0.0226,  0.0209,  0.0139,  0.0053,  0.0000,  0.0000,  0.0000,
       >  0.0288,  0.0236,  0.0103,  0.0070,  0.0000,  0.0000,  0.0000,
       >  0.0278,  0.0239,  0.0166,  0.0038,  0.0082,  0.0000,  0.0000,
       >  0.0084,  0.0157,  0.0119,  0.0130,  0.0040,  0.0000,  0.0000,
       >  0.0038,  0.0043,  0.0064,  0.0076,  0.0048,  0.0000,  0.0000,
       >  0.0000,  0.0017,  0.0020,  0.0000,  0.0000,  0.0000,  0.0000,
       >  0.0000,  0.0047,  0.0000,  0.0071,  0.0000,  0.0000,  0.0000,
       >  0.0000,  0.0000,  0.0000,  0.0000,  0.0000,  0.0000,  0.0000/
 
    PROB C   M
          DATA ((PROBA(1,2,2,5,I,J),I=1,NP),J=1,NPT) /
       >  0.1896,  0.2345,  0.2877,  0.3437,  0.2477,  0.2118,  0.0882,
       >  0.1894,  0.2675,  0.3206,  0.3253,  0.3167,  0.1545,  0.1372,
       >  0.0960,  0.1972,  0.2782,  0.3239,  0.2412,  0.2462,  0.1274,
       >  0.0446,  0.0911,  0.1284,  0.2264,  0.1792,  0.2192,  0.1101,
       >  0.0260,  0.0426,  0.0493,  0.0863,  0.1261,  0.1429,  0.1030,
       >  0.0152,  0.0342,  0.0332,  0.0585,  0.0693,  0.0826,  0.0479,
       >  0.0206,  0.0040,  0.0218,  0.0232,  0.0452,  0.0889,  0.0471,
       >  0.0244,  0.0151,  0.0045,  0.0069,  0.0103,  0.0078,  0.0221/
 
    PROB X  U M
          DATA ((PROBA(1,2,2,6,I,J),I=1,NP),J=1,NPT) /
       >  0.3680,  0.3563,  0.3580,  0.3414,  0.2738,  0.6011,  0.3451,
       >  0.3029,  0.2961,  0.2932,  0.2811,  0.3298,  0.4616,  0.4307,
       >  0.2226,  0.1930,  0.1973,  0.2094,  0.2126,  0.2794,  0.2596,
       >  0.1414,  0.1243,  0.1157,  0.1322,  0.2028,  0.2464,  0.2753,
       >  0.1456,  0.0592,  0.0727,  0.0797,  0.1418,  0.1285,  0.2195,
       >  0.1275,  0.0447,  0.0360,  0.0393,  0.0826,  0.1137,  0.1225,
       >  0.2068,  0.0392,  0.0242,  0.0155,  0.0000,  0.0196,  0.1887,
       >  0.0790,  0.0537,  0.0341,  0.0150,  0.0165,  0.0112,  0.0540/
 
    PROB X  C
          DATA ((PROBA(1,2,2,7,I,J),I=1,NP),J=1,NPT) /
       >  0.1382,  0.1384,  0.1197,  0.0581,  0.1064,  0.0000,  0.0423,
       >  0.0948,  0.1047,  0.0959,  0.0884,  0.0753,  0.0562,  0.0878,
       >  0.0776,  0.0700,  0.0754,  0.0843,  0.0747,  0.0892,  0.0602,
       >  0.0464,  0.0367,  0.0556,  0.0620,  0.0509,  0.0618,  0.0710,
       >  0.0269,  0.0140,  0.0232,  0.0192,  0.0187,  0.0377,  0.0281,
       >  0.0317,  0.0095,  0.0151,  0.0205,  0.0066,  0.0098,  0.0386,
       >  0.0282,  0.0242,  0.0089,  0.0036,  0.0129,  0.0289,  0.0427,
       >  0.0149,  0.0120,  0.0072,  0.0000,  0.0019,  0.0026,  0.0055/
 
    PROB X  B  M
          DATA ((PROBA(1,2,2,8,I,J),I=1,NP),J=1,NPT) /
       >  0.1420,  0.0924,  0.0748,  0.0453,  0.0311,  0.0000,  0.0000,
       >  0.1576,  0.0958,  0.0639,  0.0268,  0.0171,  0.0000,  0.0315,
       >  0.1232,  0.1087,  0.0799,  0.0356,  0.0272,  0.0085,  0.0000,
       >  0.0756,  0.0841,  0.0815,  0.0353,  0.0325,  0.0181,  0.0100,
       >  0.0455,  0.0558,  0.0537,  0.0451,  0.0312,  0.0313,  0.0084,
       >  0.0446,  0.0320,  0.0354,  0.0421,  0.0416,  0.0299,  0.0305,
       >  0.0283,  0.0197,  0.0340,  0.0253,  0.0320,  0.0185,  0.0087,
       >  0.0537,  0.0609,  0.0242,  0.0127,  0.0041,  0.0053,  0.0108/
 
   Binning des leptons
          IBINP   = INDICE (P,2.,20.,3.,NP)
          IBINPT  = INDICE (PT,0.,2.5,0.35,NPT)
 
  ........
         FUNPROB = - 1.
 
        IF(XBINF(ISOURCE,NSOURCE)) RETURN
        IF(XBINF(IBINP,NP))        RETURN
        IF(XBINF(IBINPT,NPT))      RETURN
        IF(XBINF(IAN,NANNEE))      RETURN
        IF(XBINF(IMODEL,NMODEL))   RETURN
        IF(XBINF(IDL,NLEP))        RETURN
 
         FUNPROB = PROBA(IAN,IMODEL,IDL,ISOURCE,IBINP,IBINPT)
 
        RETURN
        END
2 XBINF
        LOGICAL FUNCTION XBINF(IBIN,IBINMAX)
  ------------------------------------------------------------------------------
    CKEY
  ------------------------------------------------------------------------------
    Retrun true if IBIN is not in the good range ( 1 - IBINMAX )
        XBINF = .TRUE.
        IF(IBIN.LT.1) RETURN
        IF(IBIN.GT.IBINMAX) RETURN
        XBINF = .FALSE.
        RETURN
        END
2 BTAG_PAR
        SUBROUTINE BTAG_PAR
  ------------------------------------------------------------------------------
    CKEY   QIPBTAG / INTERNAL
  ------------------------------------------------------------------------------
   Define cuts and histos for QIPBTAG
    Called from QIPBTAG
 
    read the cuts used for the B-tagging and then store them
    All cards are now optional.
 
    Author  Dave Brown  29-1-93
 
  ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
  ------------------------------------------------------------------------------
   QIPBTAG                                                    User routine for
        |---- BTAG_PAR                                        File     : NMACR
                   |----  IW                                  External
                   |----  MIN                                 External
                   |----  JETERR                              Error on jet ang
                   |----  HBOOK1                              External
                   |----  HBOOKB                              External
                   |----  HBARX                               External
  ------------------------------------------------------------------------------
 
2 JETERR
        SUBROUTINE JETERR(NJET,JETS,JET_SIG2)
  ------------------------------------------------------------------------------
    CKEY   QFNDIP  QIPBTAG / INTERNAL
  ------------------------------------------------------------------------------
   Error on jet angular resolution
    Give the error on the jet angular resolution (relative
    to the b meson in Zbb events) as a function of their
    momentum.  Dave Brown, 15-10-93
    Called from FINDIP or FINDDMIN
 
    INPUTS; NJET, JETS   :  # and jet momentum vectors
 
    OUTPUTS; JET_SIG2    :  Array of squares of jet angular resolution (radians)
2 BTAGEV
        SUBROUTINE BTAGEV (NTRACK,NJET,JJET,JHEMI,PTRACK,NEGPROB,
  ------------------------------------------------------------------------------
    CKEY   QIPBTAG / INTERNAL
  ------------------------------------------------------------------------------
       >                   PROBJET,PROBHEMI,PROBEVT)
   Probability for a jet to come from a b-quark
    Called from QIPBTAG
    SUBROUTINE BTAGEV
    =================
       PURPOSE :
               calculate the probability of a jet to have the origine
               in a B-Quark from the probabilities of the tracks
 
       INPUT :
               NTRACK               Number of good tracks
               NJET                 Number of good jets
               PTRACK(1:ntrack)     array with track-probabilities
               JJET(1:ntrack)       Assignment of tracks to jets
               JHEMI(1:ntrack)      Assignment of tracks to hemispheres
               NEGPROB              Flag whether to use negative tracks
 
       OUTPUT :
               PROBJET(1:njet)      probability for each jet
               PROBHEMI(1:2)        probability for hemispheres
               PROBEVT              probability for event
 
       CALLS   : VZERO
                                        D. Brown,  M.Frank 13/1/92
            revisions
               D. BROWN 19-1-92       Add JJET,JHEMI,PWIND,PCUT  as arguments
                        11-2-92       Protect factorials
               M. FRANK 23-3-92       Protect exponentials
               D. Brown 14-10-92      Protect agains underflows
               D. Rousseau 7-5-93     Implement negative track probabilities
 
  ------------------------------------------------------------------------------
   Caller(s)  Node        Calls                               Description
  ------------------------------------------------------------------------------
   QIPBTAG                                                    User routine for
        |---- BTAGEV                                          Probability for
                   |----  VZERO                               External
                   |----  MIN                                 External
                   |----  PTRACK                              External
  ------------------------------------------------------------------------------
 
2 BTAGTR
        SUBROUTINE BTAGTR(FITP,NTRACK,DMIN,S_DMIN,TFLAG,PROBTRK)
  ------------------------------------------------------------------------------
    CKEY   QIPBTAG / INTERNAL
  ------------------------------------------------------------------------------
   Calculate the probability of the track to come from IP
    Called from QIPBTAG
    Author  Dave Brown  29-1-93
 
    SUBROUTINE BTAGTR
    ==================
 
    INPUT :
            FITP      #koeffizents of track fit polynomial...
 
            NTRACK == # OF TRACKS PASSED FOR ANALYSIS
 
            DMIN(i)                                           i=1,ntrack
            --  distance of track from the primary vertex
 
            S_DMIN(i)                                         i=1,ntrack
            --  error on this distance
 
            TFLAG(i)                                         i=1,ntrack
            --  flag for this track
 
   OUTPUT:
            PROBTRK(i)
            --  probability of a track
 
2 QIPBTAG
        SUBROUTINE QIPBTAG (IRET,NTRACK,NJET,TRKJET,FRF2TRK,
  ------------------------------------------------------------------------------
    CKEY   QIPBTAG / USER
  ------------------------------------------------------------------------------
       &                   PROBTRK,PROBJET,PROBHEMI,PROBEVT)
   User routine for the B-tagging by the impact parameter method
    SUBROUTINE QIPBTAG
    =================
 
    Called by the user
    Calls : BTAG_PAR,JETCLU,QFNDIP,QFNDV0,TRSEL,FINDDMIN,TRSEL2,
            BTAGTR,BTAGEV
 
       INPUT:
          none
 
       OUTPUT:
          iret :          >0   if event not useful for analysis
                          <0   if error during analysis
                          = 0  else = O.K.
          list of iret:
                 iret=    0   good event , analysis performed
                          1   Number of jets less than 2
                          2   Jets outside solid angle cuts
                         -2   No beam spot information
                        3,4   No tracks for btag analysis found
                         -3   error in interaction point finding
                         -4   Error in finding thrust axis
 
          ntrack          = # of tracks used to calculate PROBJET/HEMI/EVT
          njet :          # of jet found
          TRKJET          = ALPHA track number of jets (ordered by energy)
          FRF2TRK         = FRFT,2 row number of tracks used for analysis
          probtrk(ntrack) array(ntrack) with probabilities of each track
                                 with indices as in FRF2TRK
          probjet(njet)   array(njet) with probabilities of each jet
                                 with indices as in TRKJET
          probhemi(2)     array(2)    with probabilities of hemisphere
                                hemisphere(1) is defined by the leading jet
          probevt         probability of the event
 
       -- The parameters for this routine are given
          by the BOS cards 'JETF','FITP','TRA2','VCUT'
 
       -- The tracks are selected
 
       -- V0s are made and used (new 10-9-93) DNB
 
       -- The calculation of of the track probabilities is performed
 
       -- The calculation of of the event probabilities is performed
 
                                    D BROWN,  M FRANK   13/1/92
 

